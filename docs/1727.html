<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Introducing zeroCPR: An Approach to Finding Complementary Products</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Introducing zeroCPR: An Approach to Finding Complementary Products</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-zerocpr-an-approach-to-finding-complementary-products-20f2b98c5d03?source=collection_archive---------8-----------------------#2024-07-15">https://towardsdatascience.com/introducing-zerocpr-an-approach-to-finding-complementary-products-20f2b98c5d03?source=collection_archive---------8-----------------------#2024-07-15</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="3742" class="fo fp fq bf b dy fr fs ft fu fv fw dx fx" aria-label="kicker paragraph">Recommendation Systems</h2><div/><div><h2 id="0031" class="pw-subtitle-paragraph gs fz fq bf b gt gu gv gw gx gy gz ha hb hc hd he hf hg hh cq dx">Current ML models can recommend similar products, but how about complementary?</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hi hj hk hl hm ab"><div><div class="ab hn"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@ardito.bryan?source=post_page---byline--20f2b98c5d03--------------------------------" rel="noopener follow"><div class="l ho hp by hq hr"><div class="l ed"><img alt="Michelangiolo Mazzeschi" class="l ep by dd de cx" src="../Images/9211748ac638d2ed07679ac73ea17296.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/2*MkUxrUogzkaAyb_Nf76wRQ.jpeg"/><div class="hs by l dd de em n ht eo"/></div></div></a></div></div><div class="hu ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--20f2b98c5d03--------------------------------" rel="noopener follow"><div class="l hv hw by hq hx"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hy cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hs by l br hy em n ht eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hz ab q"><div class="ab q ia"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ib ic bk"><a class="af ag ah ai aj ak al am an ao ap aq ar id" data-testid="authorName" href="https://medium.com/@ardito.bryan?source=post_page---byline--20f2b98c5d03--------------------------------" rel="noopener follow">Michelangiolo Mazzeschi</a></p></div></div></div><span class="ie if" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b ib ic dx"><button class="ig ih ah ai aj ak al am an ao ap aq ar ii ij ik" disabled="">Follow</button></p></div></div></span></div></div><div class="l il"><span class="bf b bg z dx"><div class="ab cn im in io"><div class="ip iq ab"><div class="bf b bg z dx ab ir"><span class="is l il">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar id ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--20f2b98c5d03--------------------------------" rel="noopener follow"><p class="bf b bg z it iu iv iw ix iy iz ja bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ie if" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">9 min read</span><div class="jb jc l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jul 15, 2024</span></div></span></div></span></div></div></div><div class="ab cp jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js"><div class="h k w ea eb q"><div class="ki l"><div class="ab q kj kk"><div class="pw-multi-vote-icon ed is kl km kn"><div class=""><div class="ko kp kq kr ks kt ku am kv kw kx kn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ky kz la lb lc ld le"><p class="bf b dy z dx"><span class="kp">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao ko lh li ab q ee lj lk" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lg"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lf lg">1</span></p></button></div></div></div><div class="ab q jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh"><div class="ll k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lm an ao ap ii ln lo lp" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lq cn"><div class="l ae"><div class="ab cb"><div class="lr ls lt lu lv lw ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="37ea" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk"><em class="nk">Full zeroCPR code is open-source and available at my </em><a class="af nl" href="https://github.com/atlantis-nova/zeroCPR" rel="noopener ugc nofollow" target="_blank"><em class="nk">Github repo</em></a></p><p id="d4ba" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">In the domain of <strong class="mq ga">AI Recommendation Systems</strong>, Machine Learning models have been heavily used to recommend <strong class="mq ga">similar samples</strong>, whether products, content or even suggesting similar contacts. Most of these pre-trained models are open-source and can be used without training a model from scratch. However, with the lack of Big Data, there is no open-source technology we can rely on for the recommendation of complementary products.</p><p id="4edc" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">In the following article, I am proposing a framework (with code in the form of a <strong class="mq ga">user-friendly library</strong>) that exploits LLM for the discovery of complementary products in a non-expensive way.</p><p id="d331" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">My goal for introducing this framework is for it to be:</p><ul class=""><li id="ec3e" class="mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nm nn no bk"><strong class="mq ga">Scalable</strong><br/>It is a framework that should not require supervision when running, that does not risk breaking, and the output should be easily structured to be used in combination with additional tools.</li><li id="0e23" class="mo mp fq mq b gt np ms mt gw nq mv mw mx nr mz na nb ns nd ne nf nt nh ni nj nm nn no bk"><strong class="mq ga">Affordable</strong><br/>It should be affordable to find the complementary of thousands of products with <strong class="mq ga">minimum spending (approx. 1 USD per 1000 computed products — using groq pricing)</strong>, in addition, without requiring any fine-tuning (this means that it could even be tested on a single product).</li></ul><p id="a464" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk"><em class="nk">***Feel free to contact me for support or feature requests. In this article, I am introducing both the framework (and its respective library) </em><strong class="mq ga"><em class="nk">zeroCPR </em></strong><em class="nk">and a new prompting technique that I call </em><strong class="mq ga"><em class="nk">Chain-of-DataFrame</em></strong><em class="nk"> for list reasoning.</em></p><h1 id="b129" class="nu nv fq bf nw nx ny gv nz oa ob gy oc od oe of og oh oi oj ok ol om on oo op bk">Understanding the problem</h1><p id="4f77" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">Before digging into the theory of the zeroCPR framework, let us understand why current technology is limited in this very domain:</p><h2 id="8b7c" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">Why do neural networks excel at recommending similar products?</h2><p id="bb19" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">These models excel at this task because neural networks innately group samples with common features in the same space region. To simplify, if, for example, a neural network is trained on top of the human language, it will allocate in the same space region words or sentences that have <strong class="mq ga">similar meanings</strong>. Following the same principle, if trained on top of customer behavior, customers sharing similar behavior will be arranged in similar space regions.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv ed pw bh px"><div class="pl pm pn"><img src="../Images/bc7435d04a61d724196aaefd4203328a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_IPVx3_5eHc--iqy3bBDg.png"/></div></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">visualization of an embedding, Image from source: <a class="af nl" href="https://projector.tensorflow.org/" rel="noopener ugc nofollow" target="_blank">https://projector.tensorflow.org/</a></figcaption></figure><p id="56f2" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">The models capable of recommending similar sentences are called semantic models, and they are both <strong class="mq ga">light and accessible</strong>, allowing the creation of recommendation systems that <strong class="mq ga">rely on language similarity </strong>rather than customer behavior.</p><p id="238b" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">A retail company that lacks customer data can easily recommend similar products by exploiting the capabilities of a semantic model.</p><h2 id="8e61" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">What about complementary products?</h2><p id="9da2" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">However, recommending <strong class="mq ga">complementary products</strong> is a totally different task. To my knowledge, <strong class="mq ga">no open-source model is </strong>capable of performing such an enterprise. Retail companies train their custom complementary recommender systems based on their data, resulting in models that are difficult to generalize, and that are industry-specific.</p><h1 id="24ee" class="nu nv fq bf nw nx ny gv nz oa ob gy oc od oe of og oh oi oj ok ol om on oo op bk">The zeroCPR framework</h1><p id="10c9" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk"><strong class="mq ga">zeroCPR</strong> stands for <strong class="mq ga">zero-shot complementary product recommender</strong>. The functioning is simple. By receiving a <strong class="mq ga">list of your available products</strong> and <strong class="mq ga">reference products</strong>, it tried to find if in your list there are complementary products that can be recommended.</p><p id="1b10" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">Large Language Models can easily recommend complementary products. You can ask ChatGPT to output what products can be paired with a toothbrush, and it will likely recommend <strong class="mq ga">dental floss</strong> and <strong class="mq ga">toothpaste</strong>.</p><p id="33f3" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">However, my goal is to create an <strong class="mq ga">enterprise-grade tool</strong> that can work with our custom data. ChatGPT may be correct, but it is generating an unstructured output that cannot be integrated with our list of products.</p><p id="58e7" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">The <strong class="mq ga">zeroCPR framework</strong> can be outlined as follows, where we apply the following 3 steps for each product in our product list:</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv ed pw bh px"><div class="pl pm qe"><img src="../Images/e3ec98c4fe0f08e574e41a46ee8a1df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-6D_RdL4Pi-7tDM-CS5Ifw.png"/></div></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">zeroCPR framework, Image by author</figcaption></figure><h2 id="c505" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">1. List complementary products</h2><p id="8c78" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">As explained, the first bottleneck to solve is finding actual complementary products. Because similarity models are out of the question, we need to use a LLM. The execution of the first step is quite simple. Given an <strong class="mq ga">input product (ex. Coca-Cola)</strong>, produce a list of valid complementary products a user may purchase with it.</p><p id="7bc1" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">I have asked the LLM to output a perfectly parsable list using Python: once parsed, we can visualize the output.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div class="pl pm qf"><img src="../Images/e9eb66118a65fcdb9167d5f8879bd8d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*3-YdrYWVFgyKDXIXUJ0NDw.png"/></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">list of valid complementary products, Image by author</figcaption></figure><p id="f964" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">The results are not bad at all: these are all products that are likely to be purchased <strong class="mq ga">in pairs with Coca-Cola</strong>. There is, however, a small issue: THESE PRODUCTS MAY NOT BE IN OUR DATA.</p><h2 id="ba9d" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">2. Matching the available products in our data</h2><p id="0fd4" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">The next step is trying to match every complementary product suggested by the LLM with a corresponding product in our dataset. For example, we want to match “Nachos” with the closest possible product in our dataset.</p><p id="fb57" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">We can perform this matching using vector search. For each LLM product, we will match it with the most semantically similar in our dataset.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div class="pl pm qg"><img src="../Images/c24f77f37759972448a8d7bb6d3b8a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*S5Nw1SaNpAuwthpuwqAE0A.png"/></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">similarity matching, Image by author</figcaption></figure><p id="30a0" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">As we can see, the results are far from accurate. <strong class="mq ga">“Nachos” </strong>will be matched with <strong class="mq ga">“SET OF SALT AND PEPPER TOADSTOOLS”</strong>, while the closest match with<strong class="mq ga"> “Burgers”</strong> is<strong class="mq ga"> “S/2 BEACH HUT STOOLS”</strong>.<strong class="mq ga"> </strong>Some of the matches are valid (we can look at Napkins), but if there are no valid matches, a semantic search will still fit it with an irrelevant candidate. Using a <strong class="mq ga">cosine similarity threshold</strong> is, by experience, a terrible method for selecting valid choices. Instead, I will use an LLM again to validate the data.</p><h2 id="52c4" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">3. Select correct complements using Chain-of-DataFrame</h2><p id="1c24" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">The goal is now to validate the matching of the previous step. My first attempts to match the products recommended by an LLM were frustrated by the lack of coherence in the output. Though being a 70B model, when I was passing in the prompt a list of products to match, the output was less than desirable (with combinations of errors in the formatting and highly unrealistic output).</p><p id="aa9a" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">However, I have noticed that by inputting a list of products and asking the model to <strong class="mq ga">reason on each sample</strong> and <strong class="mq ga">output a score (0 or 1)</strong>: (following the format of a pandas dataframe and applying a transformation to a single column), the model is much more reliable (in terms of format and output). I call this prompting paradigm Chain-of-Dataframe, in reference to the well-known pandas data structure:</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv ed pw bh px"><div class="pl pm qh"><img src="../Images/f8d446fb66c0b5aec8834c30ca220621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKJCuxcpWB9uFlwnedQMYw.png"/></div></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">Chain-of-DataFrame, Image by author</figcaption></figure><p id="e2a3" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">To give you an idea of the Chain-of-Dataframe prompting. In the following example, the<strong class="mq ga"> {product_name}</strong> is coca-cola, while the <strong class="mq ga">{complementary_list}</strong> is the <strong class="mq ga">column called recommended_product</strong> we can see in the image below:</p><pre class="po pp pq pr ps qi qj qk bp ql bb bk"><span id="29f6" class="qm nv fq qj b bg qn qo l qp qq">A customer is doing shopping and buys the following product<br/>product_name: {product_name}<br/><br/>A junior shopping expert recommends the following products to be bought together, however he still has to learn:<br/>given the following<br/>complementary_list: {complementary_list}<br/><br/>Output a parsable python list using python, no comments or extra text, in the following format:<br/>[<br/>    [&lt;product_name 1&gt;, &lt;reason why it is complementary or not&gt;, &lt;0 or 1&gt;],<br/>    [&lt;product_name 2&gt;, &lt;reason why it is complementary or not&gt;, &lt;0 or 1&gt;],<br/>    [&lt;product_name 3&gt;, &lt;reason why it is complementary or not&gt;, &lt;0 or 1&gt;],<br/>    ...<br/>]<br/>the customer is only interested in **products that can be paired with the existing one** to enrich his experience, not substitutes<br/>THE ORDER OF THE OUTPUT MUST EQUAL THE ORDER OF ELEMENTS IN  complementary_list<br/><br/>Take it easy, take a big breath to relax and be accurate. Output must start with [, end with ], no extra text</span></pre><p id="75b0" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">The output is a multidimensional list that can be parsed easily and immediately converted again into a <strong class="mq ga">pandas dataframe</strong>.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv ed pw bh px"><div class="pl pm qr"><img src="../Images/95385a6ee7acf88510883bae38ad20e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1X61VBYVVZOp00M3BAa6A.png"/></div></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">Chain-of-Dataframe output, Image by author: Michelangiolo Mazzeschi</figcaption></figure><p id="901a" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">Notice the <strong class="mq ga">reasoning </strong>and <strong class="mq ga">score</strong> columns generated by the model to find the <strong class="mq ga">best complementary products</strong>. With this last step, we have been able to filter out most of the irrelevant matches.</p><p id="fc80" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">***The algorithm may look similar to <a class="af nl" href="https://arxiv.org/pdf/2401.04398" rel="noopener ugc nofollow" target="_blank">CHAIN-OF-TABLE: EVOLVING TABLES IN THE REASONING CHAIN FOR TABLE UNDERSTANDING</a>, but I deem the one proposed above is much simpler and uses a different structure. Feel free to comment if you think otherwise.</p><h2 id="1995" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">4. Dealing with little data: Nearest Substitute Filling</h2><p id="0ec5" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">There is <strong class="mq ga">one last issue we need to address</strong>. It is likely that, due to the lack of data, the number of recommended products is minimal. In the example above, we can recommend 6 complementary products, but there might be cases where we can only recommend 2 or 3. How can we improve the user experience, and expand the number of valid recommendations, given the limitations imposed by our data?</p></div></div><div class="pt"><div class="ab cb"><div class="lr qs ls qt lt qu cf qv cg qw ci bh"><figure class="po pp pq pr ps pt qy qz paragraph-image"><div role="button" tabindex="0" class="pu pv ed pw bh px"><div class="pl pm qx"><img src="../Images/c5c2160c9515207737bd2e2a01c2f5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*aiSMipfXmr0M8Y1xgek_8w.png"/></div></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">Nearest Substitute Filling, Image by author</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="3223" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">One solution that came to mind is, as usual, a simple one. The output from zeroCPR are all complementary products (the first row of the image you can see above). To fill in missing recommendations, we can find k substitutes of each complementary product through semantic similarity.</p><h1 id="95fe" class="nu nv fq bf nw nx ny gv nz oa ob gy oc od oe of og oh oi oj ok ol om on oo op bk">Running the zeroCPR engine</h1><p id="3d37" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">You can refer to the following <a class="af nl" href="https://github.com/atlantis-nova/zeroCPR/blob/main/notebooks/example_notebook.ipynb" rel="noopener ugc nofollow" target="_blank">EXAMPLE NOTEBOOK</a> to run the code smoothly: clone the full repository maintain the file structure, and the notebook should run adjusting to the correct path.</p><p id="ce05" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">In the repository, I am using the product list obtained from the <a class="af nl" href="https://www.kaggle.com/datasets/ramzanzdemir/online-retail-gift-products" rel="noopener ugc nofollow" target="_blank">following Kaggle dataset</a>. The more products there are in your list, the more the search will have a chance to be accurate. For now, the library only supports <a class="af nl" href="https://groq.com/" rel="noopener ugc nofollow" target="_blank">GroqCloud</a>.</p><p id="c12f" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">Also, do recall that the framework performs well with a 70B model, and has not been designed or tested to match in performance with small language models (ex. llama3-8B).</p><pre class="po pp pq pr ps qi qj qk bp ql bb bk"><span id="18d5" class="qm nv fq qj b bg qn qo l qp qq">from zeroCPR import engine<br/><br/># initiate engine<br/>myagent = engine.agent(groq_api_key='&lt;your_api_key&gt;')</span></pre><p id="ef60" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">The next step is preparing a list of products (in the format of a python list).</p><pre class="po pp pq pr ps qi qj qk bp ql bb bk"><span id="bfdd" class="qm nv fq qj b bg qn qo l qp qq">df = pd.read_excel('notebooks/df_raw.xlsx')<br/>product_list = list(set(df['Description'].dropna().tolist()))<br/>product_list = [x for x in product_list if isinstance(x, str)]<br/>product_list = [x.strip() for x in product_list]<br/>product_list<br/><br/>&gt;&gt;&gt;<br/>['BLACK AND WHITE PAISLEY FLOWER MUG',<br/> 'ASSORTED MINI MADRAS NOTEBOOK',<br/> 'VICTORIAN METAL POSTCARD CHRISTMAS',<br/> 'METAL SIGN EMPIRE TEA',<br/> 'RED WALL CLOCK',<br/> 'CRYSTAL KEY+LOCK PHONE CHARM',<br/> 'MOTORING TISSUE BOX',<br/> 'SILK PURSE RUSSIAN DOLL PINK',<br/> 'VINTAGE SILVER TINSEL REEL',<br/> 'RETRO SPOT TRADITIONAL TEAPOT',<br/>...</span></pre><p id="46b1" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">The library utilizes <a class="af nl" href="https://sbert.net/" rel="noopener ugc nofollow" target="_blank">sentence-transformers</a> to encode the list into vectors, so you won’t have to implement this feature yourself:</p><pre class="po pp pq pr ps qi qj qk bp ql bb bk"><span id="7e19" class="qm nv fq qj b bg qn qo l qp qq">df_encoded = myagent.encode_products(product_list)<br/><br/>&gt;&gt;&gt;<br/>100%|██████████| 4678/4678 [02:01&lt;00:00, 38.47it/s]</span></pre><h2 id="1216" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">Finding complementaries of a single product</h2><p id="4581" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">This function has been built to test the performance of the engine on a single product (a very inexpensive test, but with impressive results,</p><pre class="po pp pq pr ps qi qj qk bp ql bb bk"><span id="e35d" class="qm nv fq qj b bg qn qo l qp qq">df_candidates, df_filtered = myagent.find_product_complementaries(['pizza'])<br/>display(df_filtered)</span></pre><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv ed pw bh px"><div class="pl pm qr"><img src="../Images/95385a6ee7acf88510883bae38ad20e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1X61VBYVVZOp00M3BAa6A.png"/></div></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">complementary products of a single item, Image by author</figcaption></figure><h2 id="247f" class="ov nv fq bf nw ow ox oy nz oz pa pb oc mx pc pd pe nb pf pg ph nf pi pj pk fw bk">Finding complementaries of a list</h2><p id="b35a" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">The core of the entire library is contained in this function. The code runs the previous function on a list (it could be 10, or even 1000 products), and builds a dataframe with all complementaries. The reason this function differs from the previous one is not only that it can take a list as input (otherwise we could have simply used a for cycle on the previous library).</p><pre class="po pp pq pr ps qi qj qk bp ql bb bk"><span id="e54e" class="qm nv fq qj b bg qn qo l qp qq">df_complementaries = myagent.find_product_complementaries(product_list[50:60])<br/><br/>&gt;&gt;&gt;<br/>** SET 3 WICKER LOG BASKETS<br/>** FUNKY GIRLZ ASST MAGNETIC MEMO PAD<br/>** BLACK GEMSTONE BRACELET<br/>ERR<br/>** TOY TIDY PINK POLKADOT<br/>** CROCHET WHITE RABBIT KEYRING<br/>** MAGNETS PACK OF 4 HOME SWEET HOME<br/>** POPCORN HOLDER , SMALL<br/>** FLOWER BURST SILVER RING GREEN<br/>** CRYSTAL DIAMANTE EXPANDABLE RING<br/>** ASSORTED EASTER GIFT TAGS</span></pre><p id="ecf1" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">Because we are dealing with a LLM, the process sometimes can fail: we cannot let this inconvenience break the code. The function is designed to run an iterative process of trial and error for each sample. As you can see from the output, when trying to find complementaries for BLACK GEMSTONE BRACELET, the first iteration was a fail (may have been because of <strong class="mq ga">a wrong parsing</strong>, or maybe <strong class="mq ga">a HTTPS request failure</strong>).</p><p id="814f" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">The pipeline is designed to try a maximum of 5 times before giving up on a product and proceeding to the next one.</p><figure class="po pp pq pr ps pt pl pm paragraph-image"><div role="button" tabindex="0" class="pu pv ed pw bh px"><div class="pl pm ra"><img src="../Images/3668b347f4bdd5d07bc505ff3f5094ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U4O1Wsu6HY5tpdT0COnI6g.png"/></div></div><figcaption class="pz qa qb pl pm qc qd bf b bg z dx">Final output: complementary list of inputted products, Image by author</figcaption></figure><p id="730d" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">Immediately at the end of this process, I am saving the output dataframe into a file.</p><pre class="po pp pq pr ps qi qj qk bp ql bb bk"><span id="8f6f" class="qm nv fq qj b bg qn qo l qp qq">df_complementaries.to_parquet('notebooks/df_complementaries.parquet', index=None)</span></pre><h1 id="3ac7" class="nu nv fq bf nw nx ny gv nz oa ob gy oc od oe of og oh oi oj ok ol om on oo op bk">Enjoy!</h1><p id="1c5d" class="pw-post-body-paragraph mo mp fq mq b gt oq ms mt gw or mv mw mx os mz na nb ot nd ne nf ou nh ni nj fj bk">This library is an attempt to allow for the search for complementary products with a lack of data, which is a common problem in emerging businesses. In combination with its main goal, it also shows how Large Language Models can be used on structured data without resulting in tedious prompt tuning.</p><p id="3035" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">There is a huge disparity separating the businesses that own data from the ones that just started. The goal of this class of algorithms is to ameliorate this discrepancy, allowing even the small startup to access enterprise-tier technology.</p><p id="db48" class="pw-post-body-paragraph mo mp fq mq b gt mr ms mt gw mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj fj bk">This is one of my first open-source libraries based on one of my latest experiments. With some luck, this library can grow to reach a bigger audience and grow accordingly. I hope you enjoy the article, and that the code provided will serve you well. Godspeed!</p></div></div></div></div>    
</body>
</html>