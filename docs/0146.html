<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Visualizing Routes on Interactive Maps with Python: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Visualizing Routes on Interactive Maps with Python: Part 1</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761?source=collection_archive---------2-----------------------#2024-01-16">https://towardsdatascience.com/visualizing-routes-on-interactive-maps-with-python-part-1-44f8d25d0761?source=collection_archive---------2-----------------------#2024-01-16</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="c558" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">A pragmatic guide to interactive data visualization for transportation problems with Folium</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@carlosjuribe?source=post_page---byline--44f8d25d0761--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Carlos Jimenez Uribe" class="l ep by dd de cx" src="../Images/902c5f4ac5d404dd99916f145be6756c.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*ord3a4QIL0hwGovfjfAJ-A.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--44f8d25d0761--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@carlosjuribe?source=post_page---byline--44f8d25d0761--------------------------------" rel="noopener follow">Carlos Jimenez Uribe</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--44f8d25d0761--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">20 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 16, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">10</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/3d98e632e08ebe44fd2fb3edfc7b2b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PWOMPBfwn7zPibtp-iUQOA.jpeg"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image generated by DALL·E 3 with author’s prompt: “a route in Paris on top of an interactive map”</figcaption></figure><blockquote class="nc nd ne"><p id="48ef" class="nf ng nh ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">👁️ <strong class="ni fr">This is article #6 of the series covering the project “</strong><a class="af oc" href="https://medium.com/@carlosjuribe/list/an-intelligent-decision-support-system-for-tourism-in-python-b6ba165b4236" rel="noopener"><strong class="ni fr">An Intelligent Decision Support System for Tourism in Python</strong></a><strong class="ni fr">”.</strong> Please note <strong class="ni fr">the present article is self-contained and independent of the previous ones in the series</strong>, so you can read it and code along without needing to read the previous ones. Just ignore any references to previous articles when you encounter them.</p></blockquote><p id="6df2" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">This article is two things at once: <strong class="ni fr">a tutorial on using </strong><code class="cx od oe of og b"><strong class="ni fr">folium</strong></code><strong class="ni fr"> to display routes</strong>, and <strong class="ni fr">a guide to <em class="nh">incremental</em> data visualization</strong>, where the priorities are to (1) have something <em class="nh">working</em>, then (2) something <em class="nh">useful</em>, and only then (3) something <em class="nh">beautiful</em>. As such, this guide will be a valuable tool for people developing <strong class="ni fr">general routing applications</strong>, especially when the goal is <strong class="ni fr">to have a prototype, fast</strong>. One such routing application is <a class="af oc" href="https://medium.com/@carlosjuribe/plan-an-optimal-trip-for-your-next-holidays-with-the-help-of-operations-research-and-python-481b1ea38fef" rel="noopener"><strong class="ni fr">trip plan optimization</strong></a>, the unifying theme of this article series. I invite you to take a look at it if you want to learn about how to design and incrementally build a decision support system from scratch. If, however, you only want to <strong class="ni fr">visualize routes in an interactive way for faster time-to-insights</strong>, this article will demonstrate <strong class="ni fr">a quick but powerful approach</strong> to doing so—because I know you need to get it <em class="nh">done</em>, and then get it <em class="nh">good</em>. Part 2 will demonstrate a <strong class="ni fr">slower but more robust approach</strong> to doing the same.</p></div></div></div><div class="ab cb oh oi oj ok" role="separator"><span class="ol by bm om on oo"/><span class="ol by bm om on oo"/><span class="ol by bm om on"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="bdc3" class="op oq fq bf or os ot gq ou ov ow gt ox oy oz pa pb pc pd pe pf pg ph pi pj pk bk">Table of contents</h1><h2 id="c973" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk"><a class="af oc" href="#136d" rel="noopener ugc nofollow">1. Previous sprint recap</a></h2><h2 id="c014" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk"><a class="af oc" href="#fe23" rel="noopener ugc nofollow">2. Data and dependencies set up</a></h2><h2 id="d4f8" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk"><a class="af oc" href="#aa07" rel="noopener ugc nofollow">3. Showing routes on maps: a pragmatic approach</a></h2><ul class=""><li id="343d" class="nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob qh qi qj bk"><a class="af oc" href="#85d2" rel="noopener ugc nofollow">3.1 Displaying <strong class="ni fr">sites</strong></a></li><li id="cf56" class="nf ng fq ni b go qk nk nl gr ql nn no np qm nr ns nt qn nv nw nx qo nz oa ob qh qi qj bk"><a class="af oc" href="#9910" rel="noopener ugc nofollow">3.2 Displaying <strong class="ni fr">routes</strong></a></li><li id="22de" class="nf ng fq ni b go qk nk nl gr ql nn no np qm nr ns nt qn nv nw nx qo nz oa ob qh qi qj bk"><a class="af oc" href="#601f" rel="noopener ugc nofollow">3.3 Enriching the map with <strong class="ni fr">interactive information</strong></a></li><li id="4d94" class="nf ng fq ni b go qk nk nl gr ql nn no np qm nr ns nt qn nv nw nx qo nz oa ob qh qi qj bk"><a class="af oc" href="#97a1" rel="noopener ugc nofollow">3.4 Dealing with closed routes, a.k.a. <strong class="ni fr">tours</strong></a></li><li id="5a0e" class="nf ng fq ni b go qk nk nl gr ql nn no np qm nr ns nt qn nv nw nx qo nz oa ob qh qi qj bk"><a class="af oc" href="#d73b" rel="noopener ugc nofollow">3.5 <strong class="ni fr">Bonus:</strong> Adding <strong class="ni fr">KPIs </strong>to the map</a></li></ul><h2 id="7e17" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk"><a class="af oc" href="#6468" rel="noopener ugc nofollow">4. Conclusion (or planning for next sprint)</a></h2></div></div></div><div class="ab cb oh oi oj ok" role="separator"><span class="ol by bm om on oo"/><span class="ol by bm om on oo"/><span class="ol by bm om on"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="136d" class="op oq fq bf or os ot gq ou ov ow gt ox oy oz pa pb pc pd pe pf pg ph pi pj pk bk">1. Previous sprint recap</h1><p id="1fb8" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">In the <a class="af oc" rel="noopener" target="_blank" href="/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9">previous article</a>, we created an optimizer class <em class="nh">à la</em> scikit-learn to solve the Traveling Salesman Problem (TSP) for an arbitrary set of locations in just one simple method call. Long story short, if you have a dataframe with site locations, <strong class="ni fr">this optimizer can be “fitted” to those locations to automatically provide the optimal (minimal distance) tour</strong>. For more details see:</p><div class="qp qq qr qs qt qu"><a rel="noopener follow" target="_blank" href="/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9?source=post_page-----44f8d25d0761--------------------------------"><div class="qv ab ig"><div class="qw ab co cb qx qy"><h2 class="bf fr hw z io qz iq ir ra it iv fp bk">A classy approach to solving Traveling Salesman Problems effectively with Python</h2><div class="rb l"><h3 class="bf b hw z io qz iq ir ra it iv dx">Implementing the TSP model in a scikit-learn-like fashion to ease the building and solving of routing optimization…</h3></div><div class="rc l"><p class="bf b dy z io qz iq ir ra it iv dx">towardsdatascience.com</p></div></div><div class="rd l"><div class="re l rf rg rh rd ri lr qu"/></div></div></a></div><p id="f312" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">At the end of it, we concluded that, even though <strong class="ni fr">solving the TSP in </strong><a class="af oc" rel="noopener" target="_blank" href="/a-classy-approach-to-solving-traveling-salesman-problems-effectively-dbb44e7d30b9#:~:text=this%20one%2Dliner%20has%20you%20covered%3A"><strong class="ni fr">a one-liner</strong></a><strong class="ni fr"> is super convenient</strong>, the output of such optimizer was not enough for a finished prototype. We needed a way to visualize that output quickly, to intuitively verify it and share it with others. Hence, that need is what motivates the goal of this sprint, the sixth in the series: take the output of the optimizer, <em class="nh">i.e.</em>, a <strong class="ni fr">route in the form of ordered locations, and show it graphically on a map</strong>. Note that the optimizer’s output, a dataframe storing the optimal route, is now our input, and the output we need to make is the route displayed on a map. The input is general: just <strong class="ni fr">an ordered sequence of locations</strong> that could represent any kind of route: the stops a transit bus does on any given day, the set of addresses a postal service worker visits to deliver the mail, the path a rider of a food delivery company travels to service many residencies. What matters to us is <strong class="ni fr">the visualization of <em class="nh">generic</em> routes</strong>, and we’ll develop the functionality to do that in this article.</p></div></div></div><div class="ab cb oh oi oj ok" role="separator"><span class="ol by bm om on oo"/><span class="ol by bm om on oo"/><span class="ol by bm om on"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="fe23" class="op oq fq bf or os ot gq ou ov ow gt ox oy oz pa pb pc pd pe pf pg ph pi pj pk bk">2. Data and dependencies set up</h1><h2 id="a12f" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk">2.1 Install dependencies</h2><p id="0431" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">We’ll use the beautiful <a class="af oc" href="http://localhost:8888/files/TWDS/traveling_tourist_problem/link/to/pip?_xsrf=2%7C7eacd5cc%7Ca559055af22bb4f0efe1c6967f5f14f6%7C1704496168" rel="noopener ugc nofollow" target="_blank">Folium library</a> to create maps, which uses the <a class="af oc" href="http://localhost:8888/files/TWDS/traveling_tourist_problem/link/to/library?_xsrf=2%7C7eacd5cc%7Ca559055af22bb4f0efe1c6967f5f14f6%7C1704496168" rel="noopener ugc nofollow" target="_blank">Leaflet.js</a> library under the hood to allow Python programmers to easily create interactive maps. We’ll also need <a class="af oc" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">Geopy</a>, a powerful geocoding library (which you already installed if you created the <a class="af oc" href="https://medium.com/@carlosjuribe/plan-optimal-trips-automatically-with-python-and-operations-research-models-part-2-fc7ee8198b6c#:~:text=I%20recommend%20creating%20a%20separate%20virtual%20environment%20in%20which%20to%20install%20all%20the%20libraries%20needed%20to%20follow%20the%20articles%20in%20this%20series.%20Copy%20this%20text" rel="noopener">virtual environment</a> at the beginning of the series). Both are standard packages installable through <code class="cx od oe of og b">pip</code> or <code class="cx od oe of og b">conda</code>. Choose one of these two commands for installation:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="7b90" class="rm oq fq og b bg rn ro l rp rq">conda install -y -c conda-forge geopy folium<br/><br/>pip install geopy folium<br/><br/># In case of errors, use these specific versions (used for this article)<br/># folium              0.14.0<br/># geopy               2.3.0<br/># pandas              2.0.3</span></pre><h2 id="4eb0" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk">2.2 Prepare input data</h2><p id="73ba" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">For the introductory example, let’s take a set of famous sites in Paris.</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="d894" class="rm oq fq og b bg rn ro l rp rq">from typing import Tuple, List, Dict<br/><br/>import pandas as pd<br/>import folium<br/><br/>pd.set_option('display.precision', 2)<br/><br/><br/>df_sites = pd.DataFrame(<br/>    [['hotel',              48.8527, 2.3542],<br/>     ['Sacre Coeur',        48.8867, 2.3431],<br/>     ['Louvre',             48.8607, 2.3376],<br/>     ['Montmartre',         48.8872, 2.3388],<br/>     ['Port de Suffren',    48.8577, 2.2902],<br/>     ['Arc de Triomphe',    48.8739, 2.2950],<br/>     ['Av. Champs Élysées', 48.8710, 2.3036],<br/>     ['Notre Dame',         48.8531, 2.3498],<br/>     ['Tour Eiffel',        48.8585, 2.2945]],<br/>    columns=pd.Index(['site', 'latitude', 'longitude'], name='paris')<br/>)<br/><br/>df_sites</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rr"><img src="../Images/f2d9238f1bc6fcf3ac1ae326dfc8493a.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*ohCdnAz4z1jarjJx2e6XGw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Note: </strong>every image in this article is by the author, unless otherwise stated.</figcaption></figure><p id="dab6" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Let’s see a “quick” way to plot these sites on a map using <code class="cx od oe of og b">folium</code>.</p></div></div></div><div class="ab cb oh oi oj ok" role="separator"><span class="ol by bm om on oo"/><span class="ol by bm om on oo"/><span class="ol by bm om on"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="aa07" class="op oq fq bf or os ot gq ou ov ow gt ox oy oz pa pb pc pd pe pf pg ph pi pj pk bk">3. Showing routes on maps: a pragmatic approach</h1><p id="5d89" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">In case you are not following this article series, let me point out that we’re following an <strong class="ni fr">agile approach </strong>in the creation of a decision support system, so we build it incrementally in so-called “sprints”. This entails we first want to arrive at <strong class="ni fr">a working prototype that solves the </strong><a class="af oc" href="https://medium.com/@carlosjuribe/plan-an-optimal-trip-for-your-next-holidays-with-the-help-of-operations-research-and-python-481b1ea38fef#:~:text=a%20workable%20solution.-,2.2.%20Identifying%20the%20Minimum%20Valuable%20Problem,start%20designing%20a%20minimum%20viable%20product%20that%20will%20be%20also%20valuable.,-To%20plan%20the" rel="noopener"><strong class="ni fr"><em class="nh">minimum valuable problem</em></strong></a> for a trip planning system. This prototype can’t be considered complete until we have a minimalist visualization functionality, hence this article. <strong class="ni fr">Once we have the prototype ready</strong>, <em class="nh">i.e.</em>, once the first version of the system is usable in a way that adds marginal value, we can start <strong class="ni fr">perfecting its implementation to make it easy to extend</strong>, so we can <em class="nh">add to the system more realistic features</em> of the real, more general problem. Thus, we’re interested now in <em class="nh">a good enough way</em> — not the <em class="nh">definitive</em> way — to display a route on a map in some meaningful manner. The <em class="nh">more definite way</em> will come in part 2 and part 3, where we will refactor the code created here so it follows an <a class="af oc" href="https://en.wikipedia.org/wiki/Object-oriented_programming" rel="noopener ugc nofollow" target="_blank">object-oriented design</a> (custom types and classes) that can better handle the growing complexity of the routes that emerge from the addition of more details and requirements to the trip planning problem. But for now, this article (part 1) attempts to demonstrate a pragmatic and quicker way of creating interactive routes with Python. Let’s see how.</p><h2 id="85d2" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk">3.1 Displaying sites</h2><p id="c216" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">We first need to create a map of Paris. We can center it at the average location of our group of sites:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="6b8a" class="rm oq fq og b bg rn ro l rp rq">avg_location = df_sites[['latitude', 'longitude']].mean()<br/>map_paris = folium.Map(location=avg_location, zoom_start=13)</span></pre><p id="c1c2" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Then, to display the sites on top of it, we create one marker for each of the sites, and add it to the map. Markers only need a location, but to quickly recognize which site is at each marker, we pass the site name to the <code class="cx od oe of og b">tooltip</code> attribute, so we see a pop-up with the name of the site any time we hover over the markers:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="141a" class="rm oq fq og b bg rn ro l rp rq">for site in df_sites.itertuples():<br/>    marker = folium.Marker(location=(site.latitude, site.longitude),<br/>                           tooltip=site.site)<br/>    marker.add_to(map_paris)<br/><br/>map_paris</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/1677ba0c1b0696e0817d650c5184d455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRnH64lIOGY0tqhzlHCZrA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.1.</strong> Site markers on top of the map</figcaption></figure><p id="aaa6" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Of course, you can zoom in and out, and move around the map if you need to, with the <code class="cx od oe of og b">+ | -</code> buttons in the upper-left corner and by click-and-drag.</p><h1 id="9910" class="op oq fq bf or os rt gq ou ov ru gt ox oy rv pa pb pc rw pe pf pg rx pi pj pk bk">3.2 Displaying routes</h1><p id="4c8e" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">The sites we just displayed aren’t really ordered, but let’s pretend they are. Let’s say the dataframe contains <strong class="ni fr">a route in the city</strong>, where the numbers in the index indicate the visit order of those sites:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="1510" class="rm oq fq og b bg rn ro l rp rq">df_route = df_sites.copy()<br/>df_route.index.name = 'visit_order'<br/><br/>df_route</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk ry"><img src="../Images/4b98ed2d3e943684bc81b0493cbd4858.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*0NpXA_swCq-fHCiJmW6kpw.png"/></div></figure><p id="904f" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Now the sites are “connected” in a specific order (the visit order), so we should also represent that fact in the map by <strong class="ni fr">adding lines connecting consecutive stops in the route</strong>. These lines, or more precisely, “segments”, are created with <code class="cx od oe of og b">folium.PolyLine</code> objects. To add them to the map in one go we create some more columns in <code class="cx od oe of og b">df_route</code>, holding the information of the "next stops", so each stop is mapped to its following stop, constituting a route segment. That way, <strong class="ni fr">each row can store info about both the stops and the segments of the route</strong>.</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="ae56" class="rm oq fq og b bg rn ro l rp rq">df_route_segments = df_route.join(<br/>    df_route.shift(-1),  # map each stop to its next stop<br/>    rsuffix='_next'<br/>).dropna()  # last stop has no "next one", so drop it<br/><br/>df_route_segments</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rz"><img src="../Images/eed33700b4b1559bf081ba43f77ce8f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tqqzRvJv5pOXesK0_hLY6g.png"/></div></div></figure><p id="3b60" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">For a fixed row, the first three columns hold information for the “current” site, and the next three columns hold information for the “next site” in the route. This allows us to create a marker <em class="nh">and</em> a segment in the same for-loop iteration:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="2b2a" class="rm oq fq og b bg rn ro l rp rq">map_paris = folium.Map(location=avg_location, zoom_start=13)<br/><br/>for stop in df_route_segments.itertuples():<br/>    # marker for current stop<br/>    marker = folium.Marker(location=(stop.latitude, stop.longitude),<br/>                           tooltip=stop.site)<br/>    # line for the route segment connecting current to next stop<br/>    line = folium.PolyLine(<br/>        locations=[(stop.latitude, stop.longitude), <br/>                   (stop.latitude_next, stop.longitude_next)],<br/>        tooltip=f"{stop.site} to {stop.site_next}",<br/>    )<br/>    # add elements to the map<br/>    marker.add_to(map_paris)<br/>    line.add_to(map_paris)<br/><br/># maker for last stop wasn't added in for loop, so adding it now <br/>folium.Marker(location=(stop.latitude_next, stop.longitude_next),<br/>              tooltip=stop.site_next).add_to(map_paris);<br/><br/>map_paris</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/70230ad30828b59b0859ed5cd8b56318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYooUGuVg36kJKAENuMTfw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.2.</strong> Site markers connected through lines</figcaption></figure><p id="67ac" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Now the order in which the stops are visited is clear, and when you hover over each line with the mouse you see which two stops the line is connecting. The same is true for markers, the names of the sites they reference are displayed when hovering over them.</p><h2 id="601f" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk">3.3 Enriching the map with interactive information</h2><p id="4c17" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">This is all well and good to get a rough idea of what the route looks like, but we can make the map a bit more insightful with little extra effort by <strong class="ni fr">adding more information that can be displayed interactively</strong>. For starters, where does the route start? With the current view, it’s not straightforward which of the sites is the “initial one”. There are two markers that are connected to only one segment, so it must be one of these, but we’d have to look at the dataframe to distinguish the “start” from the “finish” site. A better way is to <strong class="ni fr">indicate the initial site with a special icon </strong>so that we can recognize it at a glance. We do that by adding a <code class="cx od oe of og b">folium.Icon</code> object to each marker, making the initial site have a distinct icon:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="ca3a" class="rm oq fq og b bg rn ro l rp rq">map_paris = folium.Map(location=avg_location, zoom_start=13)<br/><br/>for stop in df_route_segments.itertuples():<br/>    initial_stop = stop.Index == 0<br/>    # icon for current stop<br/>    icon = folium.Icon(icon='home' if initial_stop else 'info-sign', <br/>                       color='cadetblue' if initial_stop else 'red')<br/>    # marker for current stop<br/>    marker = folium.Marker(location=(stop.latitude, stop.longitude),<br/>                           icon=icon, tooltip=stop.site)<br/>    # line for the route segment connecting current to next stop<br/>    line = folium.PolyLine(<br/>        locations=[(stop.latitude, stop.longitude), <br/>                   (stop.latitude_next, stop.longitude_next)],<br/>        tooltip=f"{stop.site} to {stop.site_next}",<br/>    )<br/>    # add elements to the map<br/>    marker.add_to(map_paris)<br/>    line.add_to(map_paris)<br/><br/># When for loop ends, the stop variable has the second-to-last <br/># stop in the route, so the marker for the last stop is missing <br/># We add it now using the "next" columns of the last row<br/>folium.Marker(<br/>    location=(stop.latitude_next, stop.longitude_next),<br/>    tooltip=stop.site_next, <br/>    icon = folium.Icon(icon='info-sign', color='red')<br/>).add_to(map_paris);<br/><br/>map_paris  # show map</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk sa"><img src="../Images/dfa8722beb98a4ee063af5e7c0f896d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yD2uK8HefYx-X_43wMS23w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.3.</strong> Route with stop markers colored by type</figcaption></figure><p id="4f49" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">At a glance, it’s clear now that the route starts at the marker with a “home” icon. Let’s exploit the interactivity a little further by showing some more information on the map that helps us understand the route even better. The basic info we’ll add is the <strong class="ni fr">distances between stops </strong>and<strong class="ni fr"> the visit order number of each stop</strong>. Since we have in each row of <code class="cx od oe of og b">df_route_segments</code> both the starting and ending points of segments, we can easily add a column with the distance between consecutive stops.</p><blockquote class="nc nd ne"><p id="76a8" class="nf ng nh ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk"><strong class="ni fr"><em class="fq">For readers interested in the current article only (</em>i.e.<em class="fq">, not in the past articles)</em></strong><em class="fq">, I have declared the function </em><code class="cx od oe of og b"><em class="fq">ellipsoidal_distance</em></code><em class="fq"> below. If, on the contrary, you've followed along in the article series, you already know about </em><a class="af oc" rel="noopener" target="_blank" href="/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e#:~:text=Here%E2%80%99s%20a%20function%20that%20computes%20the%20ellipsoidal%20distance%20between%20point%201%20and%20point%202%2C%20in%20meters%3A"><em class="fq">that function</em></a><em class="fq">, as we developed it (and made the case for it) in </em><a class="af oc" rel="noopener" target="_blank" href="/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e"><em class="fq">the article on computing distance matrices</em></a><em class="fq">. Feel free to re-use that function here, to avoid duplicated code. To get the distance in meters between location </em><code class="cx od oe of og b"><em class="fq">loc1</em></code><em class="fq"> and location </em><code class="cx od oe of og b"><em class="fq">loc2</em></code><em class="fq">, you just need to:</em></p><p id="efca" class="nf ng nh ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk"><code class="cx od oe of og b"><strong class="ni fr"><em class="fq">from</em></strong><em class="fq"> geoutils </em><strong class="ni fr"><em class="fq">import</em></strong><em class="fq"> GeoAnalyzer</em></code></p><p id="a08d" class="nf ng nh ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk"><code class="cx od oe of og b"><em class="fq">distance </em><strong class="ni fr"><em class="fq">=</em></strong><em class="fq"> GeoAnalyzer.</em><strong class="ni fr"><em class="fq">ellipsoidal_distance</em></strong><em class="fq">(loc1, loc2)</em></code></p></blockquote><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="0ea1" class="rm oq fq og b bg rn ro l rp rq">from geopy.distance import geodesic<br/><br/>_Location = Tuple[float, float]<br/><br/><br/>def ellipsoidal_distance(point1: _Location, point2: _Location) -&gt; float:<br/>    """Calculate ellipsoidal distance (in meters) between point1 and <br/>    point2 where each point is represented as a tuple (lat, lon)"""<br/>    return geodesic(point1, point2).meters</span></pre><p id="ada6" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">The function <code class="cx od oe of og b">ellipsoidal_distance</code> accepts two locations (two tuples of coordinates) and returns the <a class="af oc" href="https://en.wikipedia.org/wiki/Geodesic" rel="noopener ugc nofollow" target="_blank">geodesic distance</a> between them, in meters. For a more in-depth explanation and <em class="nh">justification </em>of the geodesic distance, I invite you to read the <a class="af oc" rel="noopener" target="_blank" href="/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e">article where we created it</a>:</p><div class="qp qq qr qs qt qu"><a rel="noopener follow" target="_blank" href="/compute-the-distance-matrix-of-a-set-of-sites-from-their-coordinates-in-python-d5fc92a0ba9e?source=post_page-----44f8d25d0761--------------------------------"><div class="qv ab ig"><div class="qw ab co cb qx qy"><h2 class="bf fr hw z io qz iq ir ra it iv fp bk">Compute the Distance Matrix of a Set of Sites from Their Coordinates in Python</h2><div class="rb l"><h3 class="bf b hw z io qz iq ir ra it iv dx">Estimate the distance between any pair of sites from their geographical coordinates as a stepping stone to solving…</h3></div><div class="rc l"><p class="bf b dy z io qz iq ir ra it iv dx">towardsdatascience.com</p></div></div><div class="rd l"><div class="sb l rf rg rh rd ri lr qu"/></div></div></a></div><p id="942f" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">We can add the new column <code class="cx od oe of og b">'distance_seg'</code> because we have both endpoints of the segment in each row:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="2cbd" class="rm oq fq og b bg rn ro l rp rq">df_route_segments['distance_seg'] = df_route_segments.apply(<br/>    lambda stop: ellipsoidal_distance(<br/>        (stop.latitude, stop.longitude), <br/>        (stop.latitude_next, stop.longitude_next)), <br/>    axis=1<br/>)<br/><br/>df_route_segments</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk sc"><img src="../Images/5fdf24994639e120b905277d9b1395b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ojxwpKovExgWCyK4VkzkRQ.png"/></div></div></figure><p id="756e" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Having this new column, we can take their values and include them in the string we pass to <code class="cx od oe of og b">tooltip</code> when creating the lines of the map, thereby <strong class="ni fr">making each segment’s distance available at the tip of the cursor</strong>. While we're at it, let's add the "stop numbers" to the markers too, so that more context is given to each marker on the overall route:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="15af" class="rm oq fq og b bg rn ro l rp rq">map_paris = folium.Map(location=avg_location, zoom_start=13)<br/><br/>for stop in df_route_segments.itertuples():<br/>    initial_stop = stop.Index == 0<br/>    # marker for current stop<br/>    icon = folium.Icon(icon='home' if initial_stop else 'info-sign', <br/>                       color='cadetblue' if initial_stop else 'red')<br/>    marker = folium.Marker(<br/>        location=(stop.latitude, stop.longitude),<br/>        icon=icon, <br/>        # display the name and stop number at each site's marker<br/>        tooltip=f"&lt;b&gt;Name&lt;/b&gt;: {stop.site} &lt;br&gt;" \<br/>              + f"&lt;b&gt;Stop number&lt;/b&gt;: {stop.Index} &lt;br&gt;"<br/>    )<br/>    # line for the route segment connecting current to next stop<br/>    line = folium.PolyLine(<br/>        locations=[(stop.latitude, stop.longitude), <br/>                   (stop.latitude_next, stop.longitude_next)],<br/>        # display the start, end, and distance of each segment<br/>        tooltip=f"&lt;b&gt;From&lt;/b&gt;: {stop.site} &lt;br&gt;" \<br/>              + f"&lt;b&gt;To&lt;/b&gt;: {stop.site_next} &lt;br&gt;" \<br/>              + f"&lt;b&gt;Distance&lt;/b&gt;: {stop.distance_seg:.0f} m",<br/>    )<br/>    # add elements to the map<br/>    marker.add_to(map_paris)<br/>    line.add_to(map_paris)<br/><br/># add route's last marker, as it wasn't included in for loop<br/>folium.Marker(<br/>    location=(stop.latitude_next, stop.longitude_next),<br/>    tooltip=f"&lt;b&gt;Name&lt;/b&gt;: {stop.site_next} &lt;br&gt;" \<br/>          + f"&lt;b&gt;Stop number&lt;/b&gt;: {stop.Index + 1} &lt;br&gt;", <br/>    icon = folium.Icon(icon='info-sign', color='red')<br/>).add_to(map_paris);<br/><br/>map_paris  # show map</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk sd"><img src="../Images/87b5e9ccfc0b1c831442855f6e50e9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*lnn2mlLY0fkcCvugiaaWrA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.4.</strong> Interactive information popping up when hovering over a marker</figcaption></figure><p id="933b" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Note how we’ve used a bit of HTML to render the “hover text” displayed on markers and lines more nicely.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk se"><img src="../Images/34dadd5309a7e1769f25ef83838b095d.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*UwsMqhRmTuxrCxA5cmA3fQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.5.</strong> Interactive information popping up when hovering over a route segment</figcaption></figure><p id="74b7" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">The current behavior seems general enough to be encapsulated into some helper functions:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="2fb4" class="rm oq fq og b bg rn ro l rp rq">def _make_route_segments_df(df_route: pd.DataFrame) -&gt; pd.DataFrame:<br/>    """Given a dataframe whose rows are ordered stops in a route, <br/>    and where the index has integers representing the visit order of those<br/>    stops, return a dataframe having new columns with the information of <br/>    each stop's next site"""<br/>    df_route_segments = df_route.join(<br/>        df_route.shift(-1),  # map each stop to its next<br/>        rsuffix='_next').dropna()<br/><br/>    df_route_segments['distance_seg'] = df_route_segments.apply(<br/>        lambda stop: ellipsoidal_distance(<br/>            (stop.latitude, stop.longitude), <br/>            (stop.latitude_next, stop.longitude_next)<br/>        ), axis=1<br/>    )<br/>    return df_route_segments<br/><br/><br/>def plot_route_on_map(df_route: pd.DataFrame) -&gt; folium.Map:<br/>    """Takes a dataframe of a route and displays it on a map, adding <br/>    a marker for each stop and a line for each pair of consecutive <br/>    stops"""<br/>    df_route_segments = _make_route_segments_df(df_route)<br/>    <br/>    # create empty map<br/>    avg_location = df_route[['latitude', 'longitude']].mean()<br/>    map_route = folium.Map(location=avg_location, zoom_start=13)<br/><br/>    for stop in df_route_segments.itertuples():<br/>        initial_stop = stop.Index == 0<br/>        # marker for current stop<br/>        icon = folium.Icon(icon='home' if initial_stop else 'info-sign', <br/>                           color='cadetblue' if initial_stop else 'red')<br/>        marker = folium.Marker(<br/>            location=(stop.latitude, stop.longitude),<br/>            icon=icon, <br/>            tooltip=f"&lt;b&gt;Name&lt;/b&gt;: {stop.site} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;Stop number&lt;/b&gt;: {stop.Index} &lt;br&gt;"<br/>        )<br/>        # line for the route segment connecting current to next stop<br/>        line = folium.PolyLine(<br/>            locations=[(stop.latitude, stop.longitude), <br/>                       (stop.latitude_next, stop.longitude_next)],<br/>            # add to each line its start, end, and distance<br/>            tooltip=f"&lt;b&gt;From&lt;/b&gt;: {stop.site} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;To&lt;/b&gt;: {stop.site_next} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;Distance&lt;/b&gt;: {stop.distance_seg:.0f} m",<br/>        )<br/>        # add elements to the map<br/>        marker.add_to(map_route)<br/>        line.add_to(map_route)<br/>    <br/>    # When for loop ends, the stop variable has the second-to-last stop in <br/>    # the route, so the marker for the last stop is missing, and we add it <br/>    # now using the "next" columns of the last row<br/>    folium.Marker(<br/>        location=(stop.latitude_next, stop.longitude_next),<br/>        tooltip=f"&lt;b&gt;Name&lt;/b&gt;: {stop.site_next} &lt;br&gt;" \<br/>              + f"&lt;b&gt;Stop number&lt;/b&gt;: {stop.Index + 1} &lt;br&gt;", <br/>        icon = folium.Icon(icon='info-sign', color='red')<br/>    ).add_to(map_route)<br/>    <br/>    return map_route</span></pre><h2 id="97a1" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk">3.4 Dealing with closed routes, a.k.a. tours</h2><p id="8647" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">What happens if we have a dataframe <code class="cx od oe of og b">df_route</code> representing a <strong class="ni fr">closed tour</strong>, <em class="nh">i.e.</em>, a route that starts and ends at the same site? How will the map reflect that? Let's build such a dataframe and test it. We take the previous <code class="cx od oe of og b">df_route</code>, having an open route, and add a new row at the end with the same info as in the first row, thus making the route closed:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="ffb5" class="rm oq fq og b bg rn ro l rp rq">df_route_closed = pd.concat(<br/>   [df_route, df_route.head(1)], ignore_index=True<br/>)<br/>df_route_closed.index.name = df_route.index.name<br/><br/>df_route_closed</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk sf"><img src="../Images/bcca8409f3c17da3142f7e5454f8f0f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*MSodGcELz4NS2RS8abuZzw.png"/></div></figure><p id="9d8e" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Thanks to setting <code class="cx od oe of og b">ignore_index=True</code>, the index number, which represents the visit order, has been incremented in one unit automatically. Now we just proceed as before, creating the map, but this time with our new helper function <code class="cx od oe of og b">plot_route_on_map</code>:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="8474" class="rm oq fq og b bg rn ro l rp rq">plot_route_on_map(df_route_closed)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk sg"><img src="../Images/b7a7a6f6de4a883ea751087295a450b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*15Av-NW8g1segBvg2q2ung.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.6.</strong> The blue marker indicating the initial site is buried by the red marker of the final site</figcaption></figure><p id="9546" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">It works <em class="nh">almost fine, </em>because<em class="nh"> </em>the new line representing the “closing” segment is created as it should, but there’s a problem with the markers: <strong class="ni fr">a new red marker is added on top of the previously added blue marker for the initial site</strong>, hiding it. This is simply how Folium works, adding elements on top of elements (notice how the marker’s shadow is darker for the ‘hotel’ than for the other markers, a subtle way of saying that there’s more than one marker in that location). To avoid losing that helpful blue “home” icon indicating the starting stop of the route, we need to skip adding the last marker (after the <code class="cx od oe of og b">for</code>-loop ends) <em class="nh">only when the last stop coincides with the starting site of the route</em>. We can do that by checking the condition directly, on <code class="cx od oe of og b">df_route</code>, and by only adding this last marker <strong class="ni fr">if the route is not closed</strong>:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="4886" class="rm oq fq og b bg rn ro l rp rq"># NOTE: trimmed down function for reference only, do not copy-paste.<br/>def plot_route_on_map(df_route: pd.DataFrame) -&gt; folium.Map:<br/>    #----- map is created here -----<br/>    # ...<br/>    #----- markers are created here -----<br/>    for stop in df_route_segments.itertuples():<br/>        # ...<br/>        # ( ఠ ͟ʖ ఠ)<br/>        # ...<br/>        # for loop ends!<br/><br/>    ### 𝗡𝗲𝘄 𝗰𝗼𝗻𝗱𝗶𝘁𝗶𝗼𝗻 𝗰𝗵𝗲𝗰𝗸𝗲𝗿 ###<br/>    # check if first site's name and location coincide with last's?<br/>    first_stop = df_route.iloc[0][['site', 'latitude', 'longitude']]<br/>    last_stop = df_route.iloc[-1][['site', 'latitude', 'longitude']]<br/>    is_closed_tour = (first_stop == last_stop).all()<br/>    <br/>    # When for loop ends, the marker for the last stop is missing <br/>    # (**unless the route is closed**). if the route is not closed, <br/>    # we add it now using the "next" columns of the last row<br/>    if not is_closed_tour:<br/>        folium.Marker(<br/>            location=(stop.latitude_next, stop.longitude_next),<br/>            tooltip=f"&lt;b&gt;Name&lt;/b&gt;: {stop.site_next} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;Stop number&lt;/b&gt;: {stop.Index + 1} &lt;br&gt;", <br/>            icon = folium.Icon(icon='info-sign', color='red')<br/>        ).add_to(map_route)<br/>    <br/>    return map_route</span></pre><p id="18d9" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">After editing <code class="cx od oe of og b">plot_route_on_map</code> as indicated above, the desired behavior is restored, <em class="nh">i.e.</em>, the “home” icon for the initial site is not overridden by the last stop in the tour:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="385b" class="rm oq fq og b bg rn ro l rp rq">plot_route_on_map(df_route_closed)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk sh"><img src="../Images/0a7ea8abc0572b2ea3188d82e3a8df86.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*bndYx0Tdw3CgKufJ3yAfgw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.7.</strong> Marker signaling the initial site is visible again</figcaption></figure><p id="d7e1" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">With this final view, <em class="nh">we can easily know the distance between two consecutive stops</em> (and the sites it’s connecting) <em class="nh">with just one move of the cursor</em>. Besides, <em class="nh">we can check the chronological order in which sites are visited just by hovering over them</em>. <strong class="ni fr">This interactivity can help us evaluate the quality of the routes we deal with, regardless of the routing problem at hand.</strong></p><h2 id="d73b" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk">3.5 Bonus: Adding KPIs to the map</h2><p id="b396" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">To cap it all, let’s add a feature that can make the map even more insightful.</p><blockquote class="si"><p id="0ccc" class="sj sk fq bf sl sm sn so sp sq sr ob dx">There’s always information that is not directly associated with any site or segment in a route, but with the route as a whole. This information is important to know about too, and tends to be global properties, like IDs or names, or relevant metrics associated with the routes. We can display them too on a folium map with a simple trick.</p></blockquote><p id="a089" class="pw-post-body-paragraph nf ng fq ni b go ss nk nl gr st nn no np su nr ns nt sv nv nw nx sw nz oa ob fj bk">If we want to display information that isn’t linked to any single marker or line, but that pertains to the route as a whole, we can <strong class="ni fr">add it as text blocks in folium maps</strong>. This is useful for business dashboards, for example, where one usually wants to display things like <strong class="ni fr">the name/ID of the route or various metrics that attempt to summarize it</strong> in some relevant sense.</p><p id="7f74" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">As an example, I’ll add at the top-left corner a <strong class="ni fr">title for the map</strong>, and at the bottom-right corner <strong class="ni fr">two very basic KPIs for routes</strong>: the <em class="nh">number of stops</em> and the <em class="nh">total distance</em> it traverses. We define the names of the different pieces of text we want to display (in the <code class="cx od oe of og b">TAG_</code> constants), and extract their respective values from <code class="cx od oe of og b">df_route_segments</code>, the dataframe having all the "segments data":</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="fdc6" class="rm oq fq og b bg rn ro l rp rq">TAG_ROUTE_NAME = "Name"<br/>TAG_NUMBER_STOPS = "Num stops"<br/>TAG_TOTAL_DISTANCE = "Distance"<br/>_SPACE_HTML = "&amp;nbsp"  # needed to add empty spaces between KPIs<br/><br/># get summary info to display on map<br/>name = df_route_segments.columns.name.capitalize()<br/>n_stops = df_route_segments['site'].size<br/>route_distance = df_route_segments['distance_seg'].sum().round(0)</span></pre><p id="3171" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">For each piece of text we want to add, we need to convert it to HTML and add it to the map in a special way. The string having the HTML code for the text needs to go inside a <code class="cx od oe of og b">folium.Element</code>. These are the steps: (1) Make a <em class="nh">basic</em> HTML string with the info to be displayed, (2) style it with more HTML, and (3) add it to the map’s root HTML element. I know, talking about maps gets me lost too, so let’s just do it.</p><blockquote class="nc nd ne"><p id="9a01" class="nf ng nh ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk"><strong class="ni fr">💡Tip:</strong> If you’re using Jupyter Notebook or Lab, I recommend you use the <code class="cx od oe of og b">IPython.display.HTML</code> class to gain quick feedback on your HTML code, like this:</p></blockquote><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="5a09" class="rm oq fq og b bg rn ro l rp rq">from IPython.display import HTML, display<br/># show a hello world message in blue and bold <br/>display(HTML("&lt;span style='color:steelblue'&gt;Hello &lt;b&gt;world&lt;/b&gt;&lt;/span&gt;"))</span></pre><h2 id="16df" class="pl oq fq bf or pm pn po ou pp pq pr ox np ps pt pu nt pv pw px nx py pz qa qb bk">Adding a title to the map</h2><p id="12c6" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">First, create the basic HTML string for the title:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="2e18" class="rm oq fq og b bg rn ro l rp rq">_html_text_title = f"&lt;b&gt;{TAG_ROUTE_NAME}&lt;/b&gt;: {name}"<br/><br/>display(HTML(_html_text_title))  # [Out]: 𝗡𝗮𝗺𝗲: Paris</span></pre><p id="9c75" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Second, style this basic HTML string as you wish. Here, I want the title to be black, located at the top-left of the map, and, <strong class="ni fr">for improved readability, I want the text to have some background white shadow:</strong></p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="6256" class="rm oq fq og b bg rn ro l rp rq">STYLE_TITLE = (<br/>    "position:absolute;z-index:100000;left:5vw;color:black;"<br/>    "font-size:30px;text-shadow:-1px 0 white, 0 1px white, 0 1px white"<br/>)<br/>html_title = f'&lt;h3 style="{STYLE_TITLE}"&gt;{_html_text_title}&lt;/h3&gt;'<br/><br/># let's see how that title looks like on the map (run all in same cell):<br/>map_with_title = plot_route_on_map(df_route)<br/><br/>root_map = map_with_title.get_root()<br/>root_map.html.add_child(folium.Element(html_title))<br/><br/>map_with_title</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk sx"><img src="../Images/a80195cb4a8cdd736d9e79e6042ac78b.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*ulZKtjXkbX7XA27cIZ_pwg.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.8.</strong> Title of the map, invariant to zoom level</figcaption></figure><p id="ad49" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">That looks nice. Now, the same thing for the KPIs:</p><p id="51b6" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk"><strong class="ni fr">Adding KPIs to the map</strong></p><p id="9ea6" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">As we did before, first, we create the basic HTML string for the KPIs. For this case, the display will be different, and of course, it depends on personal taste: I like my KPIs displayed horizontally at the bottom-right of the map. Feel free to change the style parameters to ones that suit your aesthetic preferences.</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="f3e1" class="rm oq fq og b bg rn ro l rp rq">_html_text_summary = f"""<br/>&lt;b&gt;{TAG_NUMBER_STOPS}&lt;/b&gt; &lt;b&gt;{TAG_TOTAL_DISTANCE}&lt;/b&gt;<br/>&lt;br&gt;<br/>{n_stops} {16 * _SPACE_HTML} {route_distance:.0f} m<br/>"""<br/><br/>display(HTML(_html_text_summary))<br/># [Out]:<br/># 𝐍𝐮𝐦 𝐬𝐭𝐨𝐩𝐬  𝐃𝐢𝐬𝐭𝐚𝐧𝐜𝐞<br/># 8          25158 m</span></pre><p id="e2d2" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">The style is very similar, the only change is a slightly smaller font size. We keep the white background shadow as it’s key for the clarity of the KPIs displayed:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="99f8" class="rm oq fq og b bg rn ro l rp rq">STYLE_SUMMARY = (<br/>    "position:absolute;z-index:100000;font-size:20px;"<br/>    "right:0;bottom:0;color:black;"<br/>    "text-shadow:-1px 0 white, 0 1px white, 0 1px white"<br/>)<br/>html_summary = f'&lt;h2 style="{STYLE_SUMMARY}"&gt;{_html_text_summary}&lt;/h2&gt;'<br/><br/># let's see how the KPIs look like (run all in same cell):<br/>map_with_kpis = plot_route_on_map(df_route)<br/><br/>root_map = map_with_kpis.get_root()<br/>root_map.html.add_child(folium.Element(html_summary))<br/><br/>map_with_kpis</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk sy"><img src="../Images/113d40a7fb08134fb884cabf905fb1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiLgsIXPCxTqzGi2Lwog9w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.9.</strong> KPIs on top of the map, invariant to zoom level</figcaption></figure><p id="b0e1" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Alright, this is starting to look great! Let’s combine both the title and KPIs now!</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="2884" class="rm oq fq og b bg rn ro l rp rq">my_map = plot_route_on_map(df_route)<br/><br/>root_map = my_map.get_root()<br/>root_map.html.add_child(folium.Element(html_title))  # add title<br/>root_map.html.add_child(folium.Element(html_summary))  # add summary KPIs<br/>my_map  # check it out</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk sz"><img src="../Images/b7446aa528e9fd1534d9d3f85362f53f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWTiIF3r22GBCM7Pl5jkug.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.10.</strong> Summary information of the route, title at the top and KPIs at the bottom, invariant to zoom level</figcaption></figure><p id="3d50" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Thanks to the text we’ve added, the map now conveys more useful information on the route (and looks more professional, doesn’t it?). Without even moving the mouse, <strong class="ni fr">we can see valuable information on the corners; and thanks to interactivity, with a very quick hovering around, we can see the names and visiting order of the different sites, as well as the distance between any pair of stops</strong>. <em class="nh">Let’s make this functionality </em><strong class="ni fr"><em class="nh">reusable</em></strong><em class="nh"> by wrapping it up into helper functions</em>, and let’s create a new, more general function, <code class="cx od oe of og b">display_route_on_map</code>, that will create a map like <code class="cx od oe of og b">plot_route_on_map</code> did, with the added option of including the name and KPI information to the map. First, the functions to obtain the HTML strings:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="fe5e" class="rm oq fq og b bg rn ro l rp rq">def _get_text_for_title(df_route_segments):<br/>    """Given a dataframe representing a route, where the column index has <br/>    the name of the route, returns an HTML string with a nice display of <br/>    this name"""<br/>    # 1) get the info to display<br/>    name = df_route_segments.columns.name<br/>    name = name.capitalize() if name else ''<br/>    <br/>    # 2) parse the info as HTML for addition to map<br/>    _html_text_title = f"&lt;b&gt;{TAG_ROUTE_NAME}&lt;/b&gt;: {name}"<br/>    html_title = f'&lt;h3 style="{STYLE_TITLE}"&gt;{_html_text_title}&lt;/h3&gt;'<br/>    return html_title<br/><br/><br/>def _get_kpis_to_display_on_map(df_route_segments):<br/>    """Given a dataframe representing a route, and having columns 'site' <br/>    and 'distance_seg', returns an HTML string with a nice display of <br/>    the number of sites and the total distance of the route"""<br/>    # 1) get the info to display<br/>    n_stops = df_route_segments['site'].size<br/>    route_distance = df_route_segments['distance_seg'].sum().round(0)<br/>    <br/>    # 2) parse the info as HTML for addition to map<br/>    _html_text_summary = f"""<br/>    &lt;b&gt;{TAG_NUMBER_STOPS}&lt;/b&gt; &lt;b&gt;{TAG_TOTAL_DISTANCE}&lt;/b&gt;<br/>    &lt;br&gt;<br/>    {n_stops} {16 * _SPACE_HTML} {route_distance:.0f} m<br/>    """<br/>    html_summary = f'&lt;h2 style="{STYLE_SUMMARY}"&gt;{_html_text_summary}&lt;/h2&gt;'<br/>    return html_summary</span></pre><p id="e973" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">We can control the addition of the title and KPIs to the map with the attribute <code class="cx od oe of og b">include_kpis</code> of the new function:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="87da" class="rm oq fq og b bg rn ro l rp rq">def display_route_on_map(df_route, include_kpis=True) -&gt; folium.Map:<br/>    """Given a dataframe representing a route, creates a folium map <br/>    and adds markers for the stops and lines for the route segments, <br/>    with the option to also add an automatic title and 2 KPIs: <br/>     - number of stops in the route<br/>     - total distance of route<br/>    <br/>    Parameters<br/>    ----------<br/>    df_route : pd.DataFrame<br/>      A dataframe representing a route, whereby each row contains<br/>      information on a different stop of the route, and rows are sorted <br/>      by stop visiting order.<br/>    include_kpis : bool (default=True)<br/>      Whether to include the title and the 2 KPIs in the map<br/><br/>    Returns<br/>    -------<br/>    A folium map that can be displayed or re-used"""<br/>    # 1) create empty map<br/>    avg_location = df_route[['latitude', 'longitude']].mean()<br/>    map_route = folium.Map(location=avg_location, zoom_start=13)<br/><br/>    # 2) create DF with segment information<br/>    df_route_segments = _make_route_segments_df(df_route)<br/>    <br/>    # 3) add title and KPIs to the map<br/>    if include_kpis:<br/>        html_title = _get_text_for_title(df_route_segments)<br/>        html_summary = _get_kpis_to_display_on_map(df_route_segments)<br/>        root_map = map_route.get_root()<br/>        root_map.html.add_child(folium.Element(html_title))  # add title<br/>        root_map.html.add_child(folium.Element(html_summary))  # add KPIs<br/><br/>    # 4) add route to the map<br/>    for stop in df_route_segments.itertuples():<br/>        initial_stop = stop.Index == 0<br/>        # marker for current stop<br/>        icon = folium.Icon(icon='home' if initial_stop else 'info-sign', <br/>                           color='cadetblue' if initial_stop else 'red')<br/>        marker = folium.Marker(<br/>            location=(stop.latitude, stop.longitude),<br/>            icon=icon, <br/>            tooltip=f"&lt;b&gt;Name&lt;/b&gt;: {stop.site} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;Stop number&lt;/b&gt;: {stop.Index} &lt;br&gt;"<br/>        )<br/>        # line for the route segment connecting current to next stop<br/>        line = folium.PolyLine(<br/>            locations=[(stop.latitude, stop.longitude), <br/>                       (stop.latitude_next, stop.longitude_next)],<br/>            # add to each line its start, end, and distance<br/>            tooltip=f"&lt;b&gt;From&lt;/b&gt;: {stop.site} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;To&lt;/b&gt;: {stop.site_next} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;Distance&lt;/b&gt;: {stop.distance_seg:.0f} m",<br/>        )<br/>        # add elements to the map<br/>        marker.add_to(map_route)<br/>        line.add_to(map_route)<br/><br/>    # does the first site's name and location coincide with the last's?<br/>    first_stop = df_route.iloc[0][['site', 'latitude', 'longitude']]<br/>    last_stop = df_route.iloc[-1][['site', 'latitude', 'longitude']]<br/>    is_closed_tour = (first_stop == last_stop).all()<br/>    <br/>    # When for loop ends, the stop variable has the second-to-last <br/>    # stop in the route, so the marker for the last stop is missing <br/>    # (**unless the route is closed**). We add it now using <br/>    # the "next" columns of the last row, if the route is open<br/>    if not is_closed_tour:<br/>        folium.Marker(<br/>            location=(stop.latitude_next, stop.longitude_next),<br/>            tooltip=f"&lt;b&gt;Name&lt;/b&gt;: {stop.site_next} &lt;br&gt;" \<br/>                  + f"&lt;b&gt;Stop number&lt;/b&gt;: {stop.Index + 1} &lt;br&gt;", <br/>            icon = folium.Icon(icon='info-sign', color='red')<br/>        ).add_to(map_route)<br/><br/>    return map_route</span></pre><p id="7864" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Let’s do a final test of our <code class="cx od oe of og b">display_route_on_map</code> function with a tour on a different city: <strong class="ni fr">New York</strong>. The dataframe below has a set of iconic sites of the city (and a random hotel) in no particular order:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="2fd5" class="rm oq fq og b bg rn ro l rp rq">df_route_ny = pd.DataFrame(<br/>    [['hotel',                  40.710400, -74.006670],<br/>     ['One World Trade Center', 40.713658, -74.013285],<br/>     ['Federal Hall',           40.708051, -74.010223],<br/>     ['Tenement Museum',        40.718807, -73.990051],<br/>     ['Flatiron Building',      40.739665, -73.989976],<br/>     ['Chrysler Building',      40.750542, -73.975632],<br/>     ['New York City Library',  40.752471, -73.982162],<br/>     ['Empire State Building',  40.747814, -73.985289],<br/>     ['Madison Square Garden',  40.749924, -73.993853],<br/>     ['Chelsea Market',         40.742750, -74.006877]],<br/>    columns=pd.Index(['site', 'latitude', 'longitude'], name='new york')<br/>)<br/>df_route_ny.index.name = 'visit_order'<br/><br/>df_route_ny</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk ta"><img src="../Images/401caa233636364b644aaf54e86c5e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*A6AM-vmLG30W1u-kq2p5KA.png"/></div></figure><p id="9db5" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">With the dataframe of the route ready, a nice visualization is just a single function call away:</p><pre class="mm mn mo mp mq rj og rk bp rl bb bk"><span id="4bff" class="rm oq fq og b bg rn ro l rp rq">display_route_on_map(df_route_ny)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk tb"><img src="../Images/712885bbfb26632d9d605e6015d2e28b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgqcZBC2yEVKk-4t7dXtuw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf or">Figure 6.11.</strong> Interactive map for a random route in New York</figcaption></figure><p id="589a" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">We get a simple, yet powerful visualization of the route on top of Manhattan. At a glance, we know how much distance the route covers, and we don’t even need to bother counting red markers: the “Num stops” KPI is telling us already. For more context, <strong class="ni fr">all markers and route segments are interactive and will display some useful information in pop-ups</strong> when we caringly pass our mouse over them. Mission accomplished!</p></div></div></div><div class="ab cb oh oi oj ok" role="separator"><span class="ol by bm om on oo"/><span class="ol by bm om on oo"/><span class="ol by bm om on"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="6468" class="op oq fq bf or os ot gq ou ov ow gt ox oy oz pa pb pc pd pe pf pg ph pi pj pk bk">4. Conclusion (or planning for next sprint)</h1><p id="bf2a" class="pw-post-body-paragraph nf ng fq ni b go qc nk nl gr qd nn no np qe nr ns nt qf nv nw nx qg nz oa ob fj bk">In this article, we’ve developed a pragmatic approach to taking generic routes stored in dataframes and displaying them on top of maps using interactive markers and segments that help us gain more context and get more information. If that was all you were after, I hope I’ve served you well and you’re able to expand on it for your own projects.</p><p id="001c" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">If you’re a reader of the <a class="af oc" href="https://medium.com/@carlosjuribe/list/an-intelligent-decision-support-system-for-tourism-in-python-b6ba165b4236" rel="noopener">“<strong class="ni fr">An Intelligent Decision Support System for Tourism in Python</strong>” article series</a>, and you want to keep learning <strong class="ni fr">applied prescriptive analytics </strong>through the building of a trip planning system, please keep on reading, as in the next sprint <strong class="ni fr">we’re going to integrate this mapping functionality with the Traveling Salesman Optimizer</strong> we created in the previous sprint, so we can easily evaluate the optimal tours we generate. Stay tuned to witness the <em class="nh">tour de force </em>we’re gonna build together!</p><div class="qp qq qr qs qt"><div role="button" tabindex="0" class="ab bx cp ke io tc td bp te lr ao"><div class="tf l"><div class="ab q"><div class="l ed"><img alt="Carlos Jimenez Uribe" class="l ep by tg th cx" src="../Images/5bbb2a597db31fdc3ff42b2ff8a4aa78.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*ord3a4QIL0hwGovfjfAJ-A.png"/><div class="el by l tg th em n ay vr"/></div><div class="ti l ig"><p class="bf b dy z io ip iq ir is it iu iv dx"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/@carlosjuribe?source=post_page-----44f8d25d0761--------------------------------" rel="noopener follow" target="_top">Carlos Jimenez Uribe</a></p></div></div><div class="cq tl hk l"><h2 class="bf fr yo hx io yp iq ir ra it iv fp bk">An intelligent decision support system for tourism in Python</h2></div><div class="ab q"><div class="l ig"><a class="bf b dy z bk yq xq xr xs xt le xu xv wc id xw xx xy wg wh wi ep bm wj my" href="https://medium.com/@carlosjuribe/list/an-intelligent-decision-support-system-for-tourism-in-python-b6ba165b4236?source=post_page-----44f8d25d0761--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="yr l ig"><span class="bf b dy z dx">6 stories</span></div></div></div><div class="tu dz tv io ab tw ig ed"><div class="ed to bx tp tq"><div class="dz l"><img alt="" class="dz" src="../Images/4d41d313535ec5ba63dd9f3d2c823d70.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*VJ9Rn0cAEmD06PcDOhAo9A.jpeg"/></div></div><div class="ed to bx kf tr ts"><div class="dz l"><img alt="" class="dz" src="../Images/f50edafda4058f43f32e514b3400fbbd.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*-Q3hwOg5On_JChtl44lFhg.jpeg"/></div></div><div class="ed bx hs tt ts"><div class="dz l"><img alt="" class="dz" src="../Images/84bde15c0216d8a1a8bba8a299b5ba52.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*ys9CCx_Iir2-Etx26fBk6Q.jpeg"/></div></div></div></div></div></div></div></div><div class="ab cb oh oi oj ok" role="separator"><span class="ol by bm om on oo"/><span class="ol by bm om on oo"/><span class="ol by bm om on"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="11b0" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Thanks for reading, and see you in the next one! 📈😊</p><p id="c349" class="pw-post-body-paragraph nf ng fq ni b go nj nk nl gr nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob fj bk">Feel free to follow me, ask me questions, <strong class="ni fr">give me feedback</strong>, or contact me on <a class="af oc" href="https://www.linkedin.com/in/carlosjuribe/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</p></div></div></div></div>    
</body>
</html>