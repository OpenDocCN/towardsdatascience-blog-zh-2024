<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Things No One Tells You About Testing Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Things No One Tells You About Testing Machine Learning</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/things-no-one-tells-you-about-testing-machine-learning-28b7a3df3bca?source=collection_archive---------6-----------------------#2024-01-04">https://towardsdatascience.com/things-no-one-tells-you-about-testing-machine-learning-28b7a3df3bca?source=collection_archive---------6-----------------------#2024-01-04</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="c0d3" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">How to avoid disaster</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@ryan.feather?source=post_page---byline--28b7a3df3bca--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Ryan Feather" class="l ep by dd de cx" src="../Images/085e617055a63eed8c00837edef17837.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/2*brqoLP3vLlF7KuEW4uNqwg.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--28b7a3df3bca--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@ryan.feather?source=post_page---byline--28b7a3df3bca--------------------------------" rel="noopener follow">Ryan Feather</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--28b7a3df3bca--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 4, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="6535" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">You’re ready to deploy your smartly conceived, expertly tuned, and accurately trained algorithm into that final frontier called “production.” You have collected a quality test set and are feeling cheerful about your algorithm’s performance. Time to ship it and call it a good day’s work! Not so fast.</p><p id="7c4a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">No one wants to be called on after the fact to fix an embarrassingly broken ML application. If your customers have called out that something is amiss, you’ve lost trust. Now it’s time to frantically attempt to debug and fix a system whose inner workings may involve billions of automatically learned parameters.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng nh"><img src="../Images/9267516a16e656b2cc2a69feebc53c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aj1Hw3d9nnSHinCsUtiUrg.jpeg"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Image created by author using Stable Diffusion</figcaption></figure><p id="050d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">If any of this sounds abstract or unlikely, here are some examples from my own career of real world results from models that performed well on the “test” set:</p><ul class=""><li id="4d3c" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne ny nz oa bk">A model for predicting the energy savings from a building energy audit was accurate for most test buildings. However, on live data it predicted that a single premise would save more energy than the entire state consumed. The users understandably noticed the outlier more than the good predictions.</li><li id="70ac" class="mj mk fq ml b go ob mn mo gr oc mq mr ms od mu mv mw oe my mz na of nc nd ne ny nz oa bk">A model to understand which equipment is driving energy use in buildings suddenly gave wild results when an upstream system filled missing home area data with zero instead the expected null. This led to a weeks long, multi-team effort to fix the issue and regenerate the results.</li></ul><p id="9bd8" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Of course, you know that even though the real value is the ML, you’ve built software and all of the normal rules apply. You need unit tests, scrutiny on integration points, and monitoring to catch the many issues that arise in real systems. But how do you do that effectively? The outputs are expected to change as you improve the model, and your trained in assumptions are at the mercy of a changing world.</p><h1 id="0775" class="og oh fq bf oi oj ok gq ol om on gt oo op oq or os ot ou ov ow ox oy oz pa pb bk"><strong class="al">(Approximately) unit test around the model</strong></h1><pre class="ni nj nk nl nm pc pd pe bp pf bb bk"><span id="221c" class="pg oh fq pd b bg ph pi l pj pk"># Not a great use of test code<br/>def test_predict(model_instance, features):<br/>    prediction = model_instance.predict(features)<br/>    assert prediction == 0.133713371337</span></pre><p id="64f6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">It should be obvious that the above is a really brittle test that doesn’t catch many potential issues. It only tests that our model produces the results that we expected when it was first trained. Differing software and hardware stacks between local and production environments make it likely to break as you progress towards deployment. As your model evolves, this is going to create more maintenance than it’s worth. The vast majority of your prediction pipeline’s complexity consists of gathering data, preprocessing, cleaning, feature engineering, and wrapping that prediction into a useful output format. That’s where better tests can make the task much easier.</p><p id="8512" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Here’s what you should do instead.</p><ul class=""><li id="da50" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne ny nz oa bk"><strong class="ml fr">Unit test your feature generation and post-processing thoroughly.</strong> Your feature engineering should be deterministic and will likely involve munging multiple data sources as well as some non-trivial transformations. This is a great opportunity to unit test.</li><li id="7d0d" class="mj mk fq ml b go ob mn mo gr oc mq mr ms od mu mv mw oe my mz na of nc nd ne ny nz oa bk"><strong class="ml fr">Unit test all of your cleaning and bounds checking. </strong>You do have some code dedicated to cleaning your input data and ensuring that it all resembles the data that you trained on, right? If you don’t, read on. Once you do, test those checks. Ensure that all of the assertions, clipping, and substitutions are keeping your prediction safe from the daunting world of real data. Assert that exceptions happen when they should.</li><li id="6129" class="mj mk fq ml b go ob mn mo gr oc mq mr ms od mu mv mw oe my mz na of nc nd ne ny nz oa bk"><strong class="ml fr">Extra credit: use approximate asserts. </strong>In case you aren’t already aware, there are easy ways to avoid the elusive failures that result from asserting on precise floating points. Numpy provides a suite of <a class="af pl" href="https://numpy.org/doc/stable/reference/routines.testing.html" rel="noopener ugc nofollow" target="_blank">approximate asserts</a> that test at the precision level that matters for your application.</li></ul><h1 id="b592" class="og oh fq bf oi oj ok gq ol om on gt oo op oq or os ot ou ov ow ox oy oz pa pb bk"><strong class="al">Suspect the integration</strong></h1><p id="a31c" class="pw-post-body-paragraph mj mk fq ml b go pm mn mo gr pn mq mr ms po mu mv mw pp my mz na pq nc nd ne fj bk">Ever play the game of telephone? <strong class="ml fr">At each hand-off, understanding decreases. Complex systems have many hand-offs.</strong> How much faith do you have in the thorough documentation and communication of data semantics by every member of a team trying to deliver quickly? Alternatively, how well do you trust yourself to remember all of those things precisely when you make changes months or years later?</p><p id="7152" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The plumbing in complex software is where countless problems arise. The solution is to create a suite of black box test cases that test the outputs of the entire pipeline. While this will require regular updates if your model or code change frequently, it covers a large swath of code and can detect unforeseen impacts quickly. The time spent is well worth it.</p><pre class="ni nj nk nl nm pc pd pe bp pf bb bk"><span id="37ec" class="pg oh fq pd b bg ph pi l pj pk">def test_pipeline(pipeline_instance):<br/>    # Execute the entire pipeline over a set of test configurations that <br/>    # exemplify the important cases<br/><br/>    # complex inputs, file paths, and whatever your pipeline needs<br/>    test_configuration = 'some config here'<br/><br/>    # Run the entire flow. Data munging, feature engineering, prediction, <br/>    # post processing<br/>    result = pipline_instance.run(test_configuration)<br/>    assert np.testing.assert_almost_equal(result, 0.1337)</span></pre><p id="bb48" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Testing whole pipelines keeps ML applications healthy.</p><h2 id="7bf6" class="pr oh fq bf oi ps pt pu ol pv pw px oo ms py pz qa mw qb qc qd na qe qf qg qh bk">Trust has a cost</h2><p id="0296" class="pw-post-body-paragraph mj mk fq ml b go pm mn mo gr pn mq mr ms po mu mv mw pp my mz na pq nc nd ne fj bk">Paranoia is a virtue when developing ML pipelines. The more complex your pipeline and dependencies grow, the more likely something is going to go awry that your algorithm vitally depends on. Even if your upstream dependencies are managed by competent teams, can you really expect they’ll never make a mistake? <strong class="ml fr">Is there zero chance that your inputs will never be corrupted</strong>? <strong class="ml fr">Probably not.</strong> But, the formula for preparing for humans being humans is simple.</p><ol class=""><li id="6577" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne qi nz oa bk">Stick to known inputs ranges.</li><li id="4c09" class="mj mk fq ml b go ob mn mo gr oc mq mr ms od mu mv mw oe my mz na of nc nd ne qi nz oa bk">Fail fast.</li><li id="c452" class="mj mk fq ml b go ob mn mo gr oc mq mr ms od mu mv mw oe my mz na of nc nd ne qi nz oa bk">Fail loud.</li></ol><p id="ee18" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The simplest way to do this is check for known input ranges as early as possible in your pipeline. You can manually set these or learn them along with your model training.</p><pre class="ni nj nk nl nm pc pd pe bp pf bb bk"><span id="9ef9" class="pg oh fq pd b bg ph pi l pj pk">def check_inputs(frame):<br/>  """ In this scenario we're checking areas<br/>  for a wide but  plausible range. The goal is really just to make sure<br/>  nothing has gone completely wrong in the inputs."""<br/><br/>  conforms = frame['square_footage'].apply(lambda x: 1 &lt; x &lt; 1000000)<br/><br/>  if not conforms.all():<br/>    # Fail loud. We're no longer in the state the pipeline was designed for.<br/>    raise ValueError("Some square_footage values are not in plausible range")<br/></span></pre><p id="080c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The example above demonstrates the formula. Simply repeat for every input. Put it first in your pipeline. Noisy validation functions are quick to implement and save your team from unfortunate consequences. This simple type of check would have saved us from that unfortunate null-to-zero swap. However, these tests don’t catch every scenario involving multivariate interactions. That’s where the MLOps techniques touched on later come into play to level up the robustness level significantly.</p><h1 id="bf2a" class="og oh fq bf oi oj ok gq ol om on gt oo op oq or os ot ou ov ow ox oy oz pa pb bk">Run the real data obstacle course</h1><p id="ef5c" class="pw-post-body-paragraph mj mk fq ml b go pm mn mo gr pn mq mr ms po mu mv mw pp my mz na pq nc nd ne fj bk">Unit tests are a scalpel with fine grained control that exercise exact paths through code. Integration tests are great for checking that data is flowing through the whole system as expected. However, <strong class="ml fr">there are always “unknown unknowns” in real data</strong>.</p><p id="7cf9" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The ideal pre-deployment check is to execute your ML pipeline against as much of your real data as cost and time allow. Follow that with dissection of the results to spot outliers, errors, and edge cases. As a side benefit, you can use this large scale execution to performance test and infrastructure cost estimation.</p><p id="bb60" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Another great strategy is to “soft launch” your model. Roll it out to a small portion of users before general launch. This lets you spot any negative user feedback and find real world failures at small scale instead of big scale. This is a great time to also A/B test against existing or alternative solutions.</p><h1 id="a32d" class="og oh fq bf oi oj ok gq ol om on gt oo op oq or os ot ou ov ow ox oy oz pa pb bk"><strong class="al">Testing is never enough</strong></h1><p id="09ad" class="pw-post-body-paragraph mj mk fq ml b go pm mn mo gr pn mq mr ms po mu mv mw pp my mz na pq nc nd ne fj bk">Creating and diligently maintaining unit tests is only the start. It’s no secret that live software requires an exception handling strategy, monitoring, and alerting. This is doubly so when software relies on a learned model that might go out of date quickly.</p><p id="79aa" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The field of MLOps has evolved to solve exactly these challenge. I won’t give a deep overview on the state of MLOps in this article. However, here are a few quick ideas of things to monitor beyond “<a class="af pl" href="https://sre.google/sre-book/monitoring-distributed-systems/#xref_monitoring_golden-signals" rel="noopener ugc nofollow" target="_blank">golden signals</a>” for ML applications.</p><ul class=""><li id="7b76" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne ny nz oa bk"><strong class="ml fr">Look for target drift — the deviation of the predicted distribution to a long term or test average.</strong> For example, over a large enough sample predicted categories should be distributed similarly to the base rate. You can monitor divergence of your most recent predictions from the expected distribution for a sign that something is changing.</li><li id="45ec" class="mj mk fq ml b go ob mn mo gr oc mq mr ms od mu mv mw oe my mz na of nc nd ne ny nz oa bk"><strong class="ml fr">Feature drift is equally if not more important to monitor than prediction drift. </strong>Features are your snapshot of the world. If their relationships stop matching the one learned by the model, prediction validity plummets. Similar to monitoring predictions, the key is to monitor the divergence of features from the initial distribution. Monitoring changes to the relationships between features is even more powerful. Feature monitoring would have caught that savings model predicting impossible values before the users did.</li></ul><p id="37c7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The big cloud tools like Azure AI, Vertex AI, and SageMaker all provide built in drift detection capabilities. Other options include <a class="af pl" href="https://www.fiddler.ai/" rel="noopener ugc nofollow" target="_blank">Fiddler AI</a> and <a class="af pl" href="https://www.evidentlyai.com/" rel="noopener ugc nofollow" target="_blank">EvidentlyAI</a>. For more thoughts on how to choose an ML stack, see <a class="af pl" href="https://medium.com/towards-data-science/machine-learning-scaling-options-for-every-team-5e713d66bf03" rel="noopener">Machine Learning Scaling Options for Every Team</a>.</p><h1 id="2e66" class="og oh fq bf oi oj ok gq ol om on gt oo op oq or os ot ou ov ow ox oy oz pa pb bk">Conclusion</h1><p id="c090" class="pw-post-body-paragraph mj mk fq ml b go pm mn mo gr pn mq mr ms po mu mv mw pp my mz na pq nc nd ne fj bk">Keeping ML pipelines in top shape from training to deployment and beyond is a challenge. Fortunately, it’s completely manageable with a savvy testing and monitoring strategy. Keep a vigilant watch on a few key signals to head off impending catastrophe! Unit test pipelines to detect breakage across large code bases. Leverage your production data as much as possible in the process. Monitor predictions and features to make sure that your models remain relevant.</p></div></div></div></div>    
</body>
</html>