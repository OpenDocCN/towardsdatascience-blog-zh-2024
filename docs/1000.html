<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Calculating the Previous Value in Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Calculating the Previous Value in Power BI</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/calculating-the-previous-value-in-power-bi-9ddc062ef2df?source=collection_archive---------8-----------------------#2024-04-19">https://towardsdatascience.com/calculating-the-previous-value-in-power-bi-9ddc062ef2df?source=collection_archive---------8-----------------------#2024-04-19</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="c50d" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Calculating the consumption based on meter data looks easy. However, complex situations can be challenging. Let’s see how we can solve this.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@salvatorecagliari?source=post_page---byline--9ddc062ef2df--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Salvatore Cagliari" class="l ep by dd de cx" src="../Images/a24b0cefab6e707cfee06cde9e857559.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/da:true/resize:fill:88:88/0*pOkUYGxmbbFyWocH"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--9ddc062ef2df--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@salvatorecagliari?source=post_page---byline--9ddc062ef2df--------------------------------" rel="noopener follow">Salvatore Cagliari</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--9ddc062ef2df--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">10 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Apr 19, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="7380" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk"><em class="nf">When we have Meter data, like we can get from our energy or water meters at home, we want to calculate consumption from these values over time. What is very simple with one meter can be complicated if we have multiple meters for different areas, values, etc. Let’s see how we can solve this in Power BI.</em></p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh ni"><img src="../Images/3c6e4c7004e145b72d8aa37563ad2bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f2DJbThxZp0zVH5U"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Photo by <a class="af nz" href="https://unsplash.com/@d_morgan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Doris Morgan</a> on <a class="af nz" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="cb91" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Introduction</h1><p id="314f" class="pw-post-body-paragraph mj mk fq ml b go ow mn mo gr ox mq mr ms oy mu mv mw oz my mz na pa nc nd ne fj bk">Most of the time, we work with transactional data.</p><p id="4451" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Each row describes one event (or transaction) from the source system.</p><p id="7c8e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Then we have stock data, like the number of units of a specific product in our store, which can change over time.</p><p id="2cbc" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Or we have meter data, which changes over time, like, for example, the electricity meter at home.</p><p id="1023" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">When we want to calculate the consumption, we order the data by the date and time we got the value from the meter and subtract the current value from the previous value. Et voila, we have the consumption.</p><p id="10b1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now imagine we have multiple houses at different addresses and with multiple meters in each home.</p><p id="7bb7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">In this case, we must calculate the previous value for each meter and get the correct value.</p><p id="4e8a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This poses some challenges when we must do it in Power BI.</p><p id="5d81" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">By the way, in SQL, we have some techniques to solve this challenge with minimal effort. So, when you have your data in a relational Database, do it there. It’s much easier.</p><p id="f674" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">So, let’s see how we can solve it in Power BI.</p><p id="ffb0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I do it once in Power Query and then with DAX.</p><h1 id="d4eb" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">The Data</h1><p id="8691" class="pw-post-body-paragraph mj mk fq ml b go ow mn mo gr ox mq mr ms oy mu mv mw oz my mz na pa nc nd ne fj bk">I generate the data from my Date table to load the result in a table with the following SQL Query:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="0307" class="pf ob fq pc b bg pg ph l pi pj">DECLARE @dimId int = 2;<br/>DECLARE @value decimal(18,5) = RAND() * 12;<br/><br/>INSERT INTO [dbo].[MeterData]<br/>  ([DateKey]<br/>  ,[Value]<br/>  ,[House]<br/>  ,[Meter])<br/>SELECT [DateKey]<br/>    ,DATEDIFF(dd, '20000101', [Date]) + (DATEDIFF(dd, '20000101', [Date]) * @value%@dimId)<br/>    ,'House ID ' + CAST(([DateKey]%3) + 1 AS varchar(15)) AS [House]<br/>    ,'Meter ID ' + CAST(@dimId - 1 AS varchar(15)) AS [Meter]<br/>  FROM [dbo].[Date]<br/>    WHERE [DateKey] BETWEEN 20210101 AND 20240415;</span></pre><p id="d73d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I execute this query multiple times to get the needed data while setting the variable @dimId to values between 2 and 6.</p><p id="5a45" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The result is a list of changing values over time for each Meter ID:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh pk"><img src="../Images/5985f0a4a1189c4861ee7337c03921a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*xCplrNd0E5IkEf6F9iuuKw.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 1 — Data for my scenario (Figure by the Author)</figcaption></figure><p id="05cc" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I import this table into Power BI twice and name them:</p><ul class=""><li id="5f46" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl pm pn bk">MeterData_PQ → For the Power Query approach</li><li id="2ec6" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne pl pm pn bk">MeterData_DAX → For the DAX approach</li></ul><p id="5042" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I need these two tables to compare them side-by-side after completion to analyze which approach could be better.</p><h1 id="d676" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Doing it in Power Query</h1><p id="074b" class="pw-post-body-paragraph mj mk fq ml b go ow mn mo gr ox mq mr ms oy mu mv mw oz my mz na pa nc nd ne fj bk">I found this approach after a little search on the Internet.</p><p id="3d6a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I added a link to the original article in the Reference section below.</p><p id="05f8" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To ensure that the data is in the right order for the next step, I add a Sorting Expression by House, Meter, and DateKey to ensure that all rows are together:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="0967" class="pf ob fq pc b bg pg ph l pi pj">= Table.Sort(#"Changed Type",{{"House", Order.Ascending}, {"Meter", Order.Ascending}, {"DateKey", Order.Ascending}})</span></pre><p id="c603" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is the result after sorting the data:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh pt"><img src="../Images/9e78062f3cb7c7d6315884599e506a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RNqqa0oqxMILORY23r5fg.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 2 — Table after sorting operation (Figure by the Author)</figcaption></figure><p id="7aac" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This pattern is repeated automatically for each nested table.</p><p id="a365" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now, I use the Group By transformation in Power Query to group all rows for each combination of House and Meter together:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh pu"><img src="../Images/deeb6dbcce7b185f1cbb7cb2deac4b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*SK56ru-lUQ_99J07N1r06Q.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 3 — Group all Value rows together (Figure by the Author)</figcaption></figure><p id="8a20" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now the data looks like this:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh pv"><img src="../Images/44b1ee9245b7ef3ed438a36444cd8871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*2YB8T4gUTdg6k0KzkXLScQ.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 4 — Data after grouping (Figure by the Author)</figcaption></figure><p id="4631" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">When I click on a cell for the ValueTable column, I see all rows associated with that row as a nested table:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh pw"><img src="../Images/f0f169a45083a598f1429d07338f5a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*pXQTGtjhmSvpZEZ7bClOOQ.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 5 — Nested table for each combination of House and Meter (Figure by the Author)</figcaption></figure><p id="d5a3" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The subsequent transformations must be applied to the nested tables. The Power Query Interface doesn’t support such operations.</p><p id="da22" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Therefore, I must add the successive transformations as manual steps:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh px"><img src="../Images/41492a771947706e023b3bb290dffdd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*j6xYtCO2Bep0ETcu9lV-ig.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 6 — Add a new step to Power Query (Figure by the Author)</figcaption></figure><p id="24d5" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I enter the following expression to add an Index column to the data:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="94f2" class="pf ob fq pc b bg pg ph l pi pj">= Table.TransformColumns(<br/>    #"Grouped Rows",<br/>    {{"ValueTable", each Table.AddIndexColumn(_,"Index")}}<br/>    )</span></pre><p id="29e2" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is the result inside the nested table:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh py"><img src="../Images/19de2020f63559739873d351d4d3ca84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*K_GZLlRUgw7I4UlElYiq3Q.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 7 — Adding an Index to the nested tables (Figure by the Author)</figcaption></figure><p id="d01a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The Index column is calculated based on the order of the data. This is why we must order the data accordingly before we add this index.</p><p id="40a1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To make this more readable, I rename this step to “AddIndexColumn”.</p><p id="8809" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now, I add another step to get the previous value:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="d15a" class="pf ob fq pc b bg pg ph l pi pj">= Table.AddColumn(AddIndexColumn, "PrevValue", each let<br/>    AllDataTable = [ValueTable],<br/>    PrevRowValue = Table.AddColumn(AllDataTable, "PrevValue",<br/>                        each try AllDataTable [Value] { [Index] -1 }<br/>                        otherwise null<br/>                        )<br/><br/>                    in<br/>                    PrevRowValue)</span></pre><p id="3130" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The result of the new column in the nested table(s) is the following:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh ch"><img src="../Images/b3b5feae21e9f5649ea202f6ec16a599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*BxI_B5h3Vc8IiivhpirZiQ.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 8 — Nested table with the previous value (Figure by the Author)</figcaption></figure><p id="c5f5" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Next, I use the Drill Down transformation to expand the nested table(s) into the original table:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh pz"><img src="../Images/3035522d1db3a924ac7b05912dd631bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*Lggz3gmVdURvol6wX3StNw.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 9 — Drill down into the nested table(s) (Figure by the Author)</figcaption></figure><p id="e971" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now I have a List with all nested tables. I add a new step to do it with the following expression:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="a66d" class="pf ob fq pc b bg pg ph l pi pj">= Table.Combine( #"Drill down PrevValue"<br/>              ,{"DateKey", "House", "Meter", "Value", "PrevValue"}<br/>              )</span></pre><p id="da26" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The result is the table with all original rows but with the additional column “PrevValue”.</p><p id="5bfe" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To complete the task, I can add a new calculated column to detract the column “Value” from “PrevValue” to get the needed consumption:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qa"><img src="../Images/60ca6527aa9b504749742dd31b31a5b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-JXoLcfDd4nvmB2P8sfiA.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 10 — Calculate the consumption (Figure by the Author)</figcaption></figure><p id="51f6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Lastly, I must set the correct data type for the new numeric columns to “Decimal Number”.</p><p id="0ff5" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">After loading the result into Power BI, I can create a consumption chart per Meter and House:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qb"><img src="../Images/9d8a80dc192911b8397dbe3c08e17c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJrAcMKdYQ9EKfXu9mJE-Q.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 11 — Consumption over time for each House and Meter (Figure by the Author)</figcaption></figure><p id="bab1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is the expected result, and I can start creating a nice report and useful visualizations.</p><p id="00e6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">But first, I wanted to show you the approach with DAX.</p><h1 id="3eb9" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Doing it in DAX</h1><p id="0472" class="pw-post-body-paragraph mj mk fq ml b go ow mn mo gr ox mq mr ms oy mu mv mw oz my mz na pa nc nd ne fj bk">After seeing how to do it in Power Query, let’s do it in DAX.</p><p id="c2e0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Here we have two possible scenarios:</p><ul class=""><li id="4e67" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl pm pn bk">Fixed intervals between the readings of the Meters.</li><li id="9823" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne pl pm pn bk">Changing interval between the readings.</li></ul><p id="5033" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To get the consumption of the first scenario is easy:</p><ol class=""><li id="ab51" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne qc pm pn bk">I must identify the row with the previous day’s value.</li><li id="4a50" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne qc pm pn bk">Get the value from that row.</li><li id="8bbe" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne qc pm pn bk">Calculate the consumption.</li></ol><p id="4449" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Let’s do it:</p><p id="22fa" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I do it by creating two Key columns:</p><ol class=""><li id="c434" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne qc pm pn bk">One for the current reading</li><li id="50b8" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne qc pm pn bk">One for the reading of the previous day (This can be the previous day, week, month, or whichever interval you have).</li></ol><p id="84d2" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Due to how I generated my data, I have one reading for every Meter ID.</p><p id="427a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Therefore, to create the first key column, I create a calculated column with the following expression (ignoring the House column for now):</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="134d" class="pf ob fq pc b bg pg ph l pi pj">CurrentKey =<br/>VAR RowKey = FORMAT('MeterData_DAX'[Date], "YYYYMMDD") &amp; "_" &amp; 'MeterData_DAX'[Meter]<br/><br/>RETURN<br/>  RowKey</span></pre><p id="6e4e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Note: I use the format “YYYYMMDD” for better readability of the result as it’s a general format.</p><p id="7409" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I need the date from the date table for the previous day to apply date calculations, like <a class="af nz" href="https://dax.guide/dateadd/" rel="noopener ugc nofollow" target="_blank">DATEADD()</a>.</p><p id="8ea7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Then I can go back by one day:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="b523" class="pf ob fq pc b bg pg ph l pi pj">PreviousKey =<br/>VAR PreviousDate = FORMAT(DATEADD('MeterData_DAX'[Date], -1, DAY), "YYYYMMDD")<br/>VAR RowKey =<br/>      PreviousDate &amp; "_" &amp; 'MeterData_DAX'[Meter]<br/><br/>RETURN<br/>  RowKey<br/></span></pre><p id="5772" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Lastly, I can use <a class="af nz" href="https://dax.guide/lookupvalue/" rel="noopener ugc nofollow" target="_blank">LOOKUPVALUE()</a> to get the previous value:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="b182" class="pf ob fq pc b bg pg ph l pi pj">Previous Value = LOOKUPVALUE('MeterData_DAX'[Value]<br/>                            ,'MeterData_DAX'[CurrentKey]<br/>                                ,'MeterData_DAX'[PreviousKey]<br/>                                )</span></pre><p id="bb68" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Or I can use <a class="af nz" href="https://dax.guide/calculate/" rel="noopener ugc nofollow" target="_blank">CALCULATE()</a> to achieve the same result:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="e459" class="pf ob fq pc b bg pg ph l pi pj">PrevValue =<br/>VAR PreviousKey = 'MeterData_DAX'[PreviousKey]<br/><br/>RETURN<br/>  CALCULATE(<br/>      MAX('MeterData_DAX'[Value])<br/>      ,REMOVEFILTERS('MeterData_DAX')<br/>      ,'MeterData_DAX'[CurrentKey] = PreviousKey<br/>      )</span></pre><p id="2a95" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is the result of these three expressions:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qd"><img src="../Images/cb4137e6b5e1349ad635af58eb5841e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H92ZXackrgHMa8iVIlA5tw.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 12 — Results for the previous values on day-by-day readings (Figure by the Author)</figcaption></figure><p id="6055" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">But this approach doesn’t work with irregular readings.</p><p id="c21c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">When I look at my data (including the Houses), I see this:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh qe"><img src="../Images/7171389c369957350f0fa35e028c4160.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*Gon4hMheQQhF3Me1sTAIcw.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 13 — Filtered view of the readings by house and Meter (Figure by the Author)</figcaption></figure><p id="aea6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">As you can see, there are intervals between the readings.</p><p id="4018" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To get the correct result, I use an approach with two steps:</p><ol class=""><li id="7143" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne qc pm pn bk">Get the date of the previous readings.</li><li id="48e8" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne qc pm pn bk">Get the value for that date.</li></ol><p id="6fae" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I create a Measure for the first step:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="cfd5" class="pf ob fq pc b bg pg ph l pi pj">Previous reading date =<br/>VAR CurrentDate = SELECTEDVALUE('MeterData_DAX'[DateKey])<br/>VAR CurrentHouse = SELECTEDVALUE('MeterData_DAX'[House])<br/>VAR CurrentMeter = SELECTEDVALUE('MeterData_DAX'[Meter])<br/><br/>RETURN<br/>  CALCULATE(MAX('MeterData_DAX'[DateKey])<br/>          ,REMOVEFILTERS('MeterData_DAX')<br/>          ,'MeterData_DAX'[House] = CurrentHouse<br/>          ,'MeterData_DAX'[Meter] = CurrentMeter<br/>          ,'MeterData_DAX'[DateKey] &lt; CurrentDate<br/>          )</span></pre><p id="9e5c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">First, I store the current Date, House, and Meter in variables.</p><p id="0def" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Then, I calculate the highest value for DateKey while removing all Filters from the table, adding Filters for the Current House and Meter, and including only the DateKey lower than the current DateKey.</p><p id="9b11" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With a table with more columns, I might have used a slightly different approach by not removing all filters from the tables but only for the columns I must, for example, only for DateKey, House, and Meter.</p><p id="608e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">But the result is as needed:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh qf"><img src="../Images/7c80c9686a15771fcbcaeb48b5d471ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*wR5-8PUciW3-f_IP_mCUlg.png"/></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 14 — Result of the Measure to get the date of the previous reading (Figure by the Author)</figcaption></figure><p id="d9fb" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">By using Context Transition, I can use this Measure to create a new version of the Previous Key column (I include the House in the expression for the CurrentKey column as well):</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="0b95" class="pf ob fq pc b bg pg ph l pi pj">PreviousKey =<br/>VAR PreviousDate = [Previous reading date]<br/>VAR RowKey = PreviousDate &amp; "_" &amp; 'MeterData_DAX'[House] &amp; "_" &amp; 'MeterData_DAX'[Meter]<br/><br/>RETURN<br/>  RowKey</span></pre><p id="c8fa" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now, I can use the same expression as before to get the previous value based on the two Key columns to get the needed result:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qg"><img src="../Images/ebc4b0ccf9beab330741d3c60766193e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*COJc1x908ulbN-43fA8jZg.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 15 — Result to calculate the previous value with variable intervals (Figure by the Author)</figcaption></figure><p id="d7ed" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">After adding the same line Visual as before, the result is identical to the results I get from data manipulated with Power Query:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qh"><img src="../Images/2a179c0eff88350824620d1e49c07a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySmFwrQM-ghMObVAPzll2Q.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 16 — Chart for 2024 with the calculation done in DAX (Figure by the Author)</figcaption></figure><p id="2805" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Lastly, I can get rid of the intermediate Key columns by calculating them directly within a compacted and self-contained version of the Previous Value columns:</p><pre class="nj nk nl nm nn pb pc pd bp pe bb bk"><span id="7e85" class="pf ob fq pc b bg pg ph l pi pj">PreviousValue Compact =<br/>VAR PreviousDate = [Previous reading date]<br/>VAR PreviousRowKey = PreviousDate &amp; "_" &amp; 'MeterData_DAX'[House] &amp; "_" &amp; 'MeterData_DAX'[Meter]<br/><br/>RETURN<br/>  CALCULATE(MIN('MeterData_DAX'[Value])<br/>          ,REMOVEFILTERS('MeterData_DAX')<br/>          ,FORMAT('MeterData_DAX'[Date], "YYYYMMDD") &amp; "_" &amp; 'MeterData_DAX'[House] &amp; "_" &amp; 'MeterData_DAX'[Meter] = PreviousRowKey<br/>)</span></pre><p id="f511" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Here the results, side-by-side, which are identical:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qi"><img src="../Images/0f8354093ce3feb4ac0dd1c3d1e005ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GqUeqeac51VI2f6oQR0dxA.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 17 — Result to calculate the previous value with the intermediate Key-columns and with the compacted (self-contained) version (Figure by the Author)</figcaption></figure><p id="5b60" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now that we have multiple solutions, which one is the better one?</p><h1 id="5f43" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Which one is better</h1><p id="2163" class="pw-post-body-paragraph mj mk fq ml b go ow mn mo gr ox mq mr ms oy mu mv mw oz my mz na pa nc nd ne fj bk">How should we decide which approach is the better one?</p><p id="53a2" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">In my opinion, it comes down to the skills available.</p><p id="aa73" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">By this, I mean the skills available in the team of those who must maintain the solution. This can be you or a client team.</p><p id="a7e0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Which is my preferred approach?</p><ul class=""><li id="7dbb" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl pm pn bk">Do I want to prepare all the data as early as possible?</li><li id="5610" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne pl pm pn bk">Or do I want to have the simplest solution?</li><li id="bc48" class="mj mk fq ml b go po mn mo gr pp mq mr ms pq mu mv mw pr my mz na ps nc nd ne pl pm pn bk">Or do I have a preference for a Language?</li></ul><p id="6710" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">In this case, it is about using Power Query or DAX.</p><p id="a4ab" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I prefer to prepare my data as early as possible.</p><p id="904f" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Therefore, I prefer using Power Query to prepare the data and have it ready to use without the need to add calculated columns in Power BI.</p><p id="530c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">However, considering the simplicity, I must confess that the approach with the self-contained calculated column with DAX is the best solution.</p><p id="b157" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">But it’s not that easy to exactly understand what happens and why.</p><p id="6d73" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now, we can use hard facts to analyze the efficiency of the two approaches: Model statistics.</p><p id="dc7b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I use DAX Studio to get the Metrics (Advanced Menu and View Metrics).</p><p id="d178" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I get the following information:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qj"><img src="../Images/807bf8c298739f4f278c0617b8647399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6-3SVvJ4gS1z5pQJu8yXw.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Figure 18 — Metrics of the Data model with both tables (Figure by the Author)</figcaption></figure><p id="8995" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I can see that the Approach with the calculated columns in DAX uses much more memory than the Power Query approach.</p><p id="e670" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">But when we detract the size of the two Key columns (Above in red), we get:</p><p id="3893" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">930’634–332’745–332’813 = 265’076 bytes</p><p id="d084" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Then, I must detract one of the two columns for the Previous Value (Above in blue): 265’076–48’248 = 207’828 bytes.</p><p id="945b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The difference in space compared to the table prepared with Power Query is marginal in this case.</p><p id="0ff7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">But I have only 6’005 rows. It can make a huge difference when we have hundreds of thousands or even millions of rows.</p><p id="563a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I already had situations where the client wanted the solution in a specific way, as he wasn’t familiar with the other approach, even though it would deliver the solution more efficiently.</p><p id="f162" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Deciding on the best approach is challenging, as you might have to consider different factors.</p><p id="045a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now that you have the information for two solutions, it’s your turn to choose the right one.</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh qk"><img src="../Images/c9e479b08dbd0f22ce24e760264d3437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LpL_r7L5GnsGNzK1"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Photo by <a class="af nz" href="https://unsplash.com/@bdchu614?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brendan Church</a> on <a class="af nz" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="bbe2" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">References</h1><p id="beeb" class="pw-post-body-paragraph mj mk fq ml b go ow mn mo gr ox mq mr ms oy mu mv mw oz my mz na pa nc nd ne fj bk">As mentioned above, the data is self-generated without relation to the real world.</p><p id="8203" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The Approach with Power Query is deduced from this Blog Post and Video:</p><p id="6132" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk"><a class="af nz" href="https://gorilla.bi/power-query/get-previous-row-value/#:~:text=The%20earlier%20row%20has%20an,a%20table%20to%20merge%20with" rel="noopener ugc nofollow" target="_blank">https://gorilla.bi/power-query/get-previous-row-value/#:~:text=The%20earlier%20row%20has%20an,a%20table%20to%20merge%20with</a>.</p><figure class="nj nk nl nm nn no"><div class="ql io l ed"><div class="qm qn l"/></div></figure><p id="c9b6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Here is my article about Context Transition:</p><div class="qo qp qq qr qs qt"><a rel="noopener follow" target="_blank" href="/whats-fancy-about-context-transition-in-dax-efb5d5bc4c01?source=post_page-----9ddc062ef2df--------------------------------"><div class="qu ab ig"><div class="qv ab co cb qw qx"><h2 class="bf fr hw z io qy iq ir qz it iv fp bk">What’s fancy about context transition in DAX</h2><div class="ra l"><h3 class="bf b hw z io qy iq ir qz it iv dx">Row and filter context are well-known concepts in DAX. But we can switch between these two with context transition.</h3></div><div class="rb l"><p class="bf b dy z io qy iq ir qz it iv dx">towardsdatascience.com</p></div></div><div class="rc l"><div class="rd l re rf rg rc rh lr qt"/></div></div></a></div><p id="c096" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Other solutions and approaches include using single M-expressions in Power Query. I decided to use this one because it is straightforward to implement and easy to understand what happens.</p><p id="bbe8" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Please consider Following me and Subscribe to get E-Mails as soon as I add new content:</p><div class="qo qp qq qr qs qt"><a href="https://medium.com/@salvatorecagliari/subscribe?source=post_page-----9ddc062ef2df--------------------------------" rel="noopener follow" target="_blank"><div class="qu ab ig"><div class="qv ab co cb qw qx"><h2 class="bf fr hw z io qy iq ir qz it iv fp bk">Get an email whenever Salvatore Cagliari publishes.</h2><div class="ra l"><h3 class="bf b hw z io qy iq ir qz it iv dx">Get an email whenever Salvatore Cagliari publishes. By signing up, you will create a Medium account if you don't…</h3></div><div class="rb l"><p class="bf b dy z io qy iq ir qz it iv dx">medium.com</p></div></div><div class="rc l"><div class="ri l re rf rg rc rh lr qt"/></div></div></a></div><p id="0c76" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">I make my articles accessible to everyone, even though Medium has a paywall. This allows me to earn a little for each reader, but I turn it off so you can read my pieces without cost.</p><p id="727b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">You can support my work, which I do during my free time, through</p><p id="50f7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk"><a class="af nz" href="https://buymeacoffee.com/salvatorecagliari" rel="noopener ugc nofollow" target="_blank">https://buymeacoffee.com/salvatorecagliari</a></p><p id="44e7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Or scan this QR Code:</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div class="ng nh rj"><img src="../Images/e7ac062070dcd7a00dcf995ad7e95434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btH95UXO7gboS30eZMk6ug.png"/></div></figure><p id="1036" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Any support is greatly appreciated and helps me find more time to create more content for you.</p><p id="3702" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Thank you a lot.</p></div></div></div></div>    
</body>
</html>