<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>How to Pivot Tables in SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>How to Pivot Tables in SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-pivot-tables-in-sql-88ef2ada5d96?source=collection_archive---------2-----------------------#2024-06-12">https://towardsdatascience.com/how-to-pivot-tables-in-sql-88ef2ada5d96?source=collection_archive---------2-----------------------#2024-06-12</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="b63b" class="fo fp fq bf b dy fr fs ft fu fv fw dx fx" aria-label="kicker paragraph">DATA SCIENCE, SQL, ETL</h2><div/><div><h2 id="8a44" class="pw-subtitle-paragraph gs fz fq bf b gt gu gv gw gx gy gz ha hb hc hd he hf hg hh cq dx">A comprehensive guide to creating pivot tables in SQL for enhanced data analysis</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hi hj hk hl hm ab"><div><div class="ab hn"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@yunglinchang?source=post_page---byline--88ef2ada5d96--------------------------------" rel="noopener follow"><div class="l ho hp by hq hr"><div class="l ed"><img alt="Jack Chang" class="l ep by dd de cx" src="../Images/6783c539c3523b2fd58ada3770c2c99a.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*0QnHKsyWQb7Ek-KpDg9OYA.jpeg"/><div class="hs by l dd de em n ht eo"/></div></div></a></div></div><div class="hu ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--88ef2ada5d96--------------------------------" rel="noopener follow"><div class="l hv hw by hq hx"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hy cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hs by l br hy em n ht eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hz ab q"><div class="ab q ia"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ib ic bk"><a class="af ag ah ai aj ak al am an ao ap aq ar id" data-testid="authorName" href="https://medium.com/@yunglinchang?source=post_page---byline--88ef2ada5d96--------------------------------" rel="noopener follow">Jack Chang</a></p></div></div></div><span class="ie if" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b ib ic dx"><button class="ig ih ah ai aj ak al am an ao ap aq ar ii ij ik" disabled="">Follow</button></p></div></div></span></div></div><div class="l il"><span class="bf b bg z dx"><div class="ab cn im in io"><div class="ip iq ab"><div class="bf b bg z dx ab ir"><span class="is l il">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar id ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--88ef2ada5d96--------------------------------" rel="noopener follow"><p class="bf b bg z it iu iv iw ix iy iz ja bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ie if" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">11 min read</span><div class="jb jc l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jun 12, 2024</span></div></span></div></span></div></div></div><div class="ab cp jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js"><div class="h k w ea eb q"><div class="ki l"><div class="ab q kj kk"><div class="pw-multi-vote-icon ed is kl km kn"><div class=""><div class="ko kp kq kr ks kt ku am kv kw kx kn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ky kz la lb lc ld le"><p class="bf b dy z dx"><span class="kp">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao ko lh li ab q ee lj lk" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lg"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lf lg">1</span></p></button></div></div></div><div class="ab q jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh"><div class="ll k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lm an ao ap ii ln lo lp" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lq cn"><div class="l ae"><div class="ab cb"><div class="lr ls lt lu lv lw ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp mq"><img src="../Images/3c4d61dc0a7e693c31ccfd1ad8255352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nGOapdVI1n34lqFc"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Photo by <a class="af nh" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mika Baumeister</a> on <a class="af nh" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="9274" class="ni nj fq bf nk nl nm gv nn no np gy nq nr ns nt nu nv nw nx ny nz oa ob oc od bk">Preface</h1><p id="e7b3" class="pw-post-body-paragraph oe of fq og b gt oh oi oj gw ok ol om on oo op oq or os ot ou ov ow ox oy oz fj bk"><a class="af nh" href="https://en.wikipedia.org/wiki/SQL" rel="noopener ugc nofollow" target="_blank">Structured Query Language (SQL)</a> is an essential tool for data professionals such as data scientists and data analysts as it allows them to retrieve, manipulate, and analyze large datasets efficiently and effectively. It is a widely used tool in the industry, making it an important skill to have. <strong class="og ga">In this article, I want to share how to create Pivot tables in SQL.</strong> This article follows up on my last article “<a class="af nh" href="https://medium.com/towards-data-science/pandas-what-ive-learned-after-my-1st-on-site-technical-interview-4fb94dbc1b45" rel="noopener">Pandas!!! What I’ve Learned after my 1st On-site Technical Interview</a>”, where I shared my learnings on Pandas.</p><blockquote class="pa"><p id="24ed" class="pb pc fq bf pd pe pf pg ph pi pj oz dx">Did you know that SQL can be used to analyze data?</p></blockquote><p id="68a0" class="pw-post-body-paragraph oe of fq og b gt pk oi oj gw pl ol om on pm op oq or pn ot ou ov po ox oy oz fj bk">In SQL, a Pivot table is a technique used to transform data from rows to columns.</p><p id="51f2" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Joan Casteel’s <a class="af nh" href="https://a.co/d/2Uwgbqd" rel="noopener ugc nofollow" target="_blank">Oracle 12c: SQL</a> book mentions that “<strong class="og ga">a pivot table is a presentation of multidimensional data.</strong>” With a pivot table, a user can view different aggregations of different data dimensions. It is a powerful tool for data analysis, as it allows users to aggregate, summarize, and present data in a more intuitive and easy-to-read format.</p><p id="b903" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">For instance, an owner of an ice cream shop may want to analyze which flavor of ice cream has sold the best in the past week. A pivot table would be useful in this case, with two dimensions of data — ice cream flavor and day of the week. Revenue can be summed up as the aggregation for the analysis.</p><p id="7697" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">The ice cream shop owner can easily use a pivot table to compare sales by ice cream flavor and day of the week. The pivot table will transform the data, making it easier to spot patterns and trends. With this information, the owner can make data-driven decisions, such as increasing the supply of the most popular ice cream flavor or adjusting the prices based on demand.</p><p id="bd1a" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Overall, pivot tables are an excellent tool for data analysis, allowing users to summarize and present multidimensional data in a more intuitive and meaningful way. They are widely used in industries such as finance, retail, and healthcare, where there is a need to analyze large amounts of complex data.</p><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp pu"><img src="../Images/186a5b835a755ae284ea4f11a994e567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Phj1Otjzr5N1k7Bj"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Photo by <a class="af nh" href="https://unsplash.com/@lamaroscu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lama Roscu</a> on <a class="af nh" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div></div><div class="ab cb pv pw px py" role="separator"><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="324d" class="ni nj fq bf nk nl qd gv nn no qe gy nq nr qf nt nu nv qg nx ny nz qh ob oc od bk">Overview</h1><p id="1ae2" class="pw-post-body-paragraph oe of fq og b gt oh oi oj gw ok ol om on oo op oq or os ot ou ov ow ox oy oz fj bk"><strong class="og ga">This article will be based on the analytic function in Oracle, typically the “PIVOT” function.</strong> It is organized to provide a comprehensive view of utilizing pivot tables in SQL in different situations. We will not only go through the most naive way to create a pivot table but also the easiest and most common way to do the job with the PIVOT function. Last but not least, I will also talk about some of the limitations of the PIVOT function.</p><h2 id="7821" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">FYI:</h2><ul class=""><li id="8ce9" class="oe of fq og b gt oh oi oj gw ok ol om on oo op oq or os ot ou ov ow ox oy oz qy qz ra bk">I will use Oracle 11g, but the functions are the same in the newer Oracle 12c and above.</li><li id="78fb" class="oe of fq og b gt rb oi oj gw rc ol om on rd op oq or re ot ou ov rf ox oy oz qy qz ra bk">The demonstration dataset is <a class="af nh" href="https://github.com/microsoft" rel="noopener ugc nofollow" target="_blank">Microsoft</a>’s <a class="af nh" href="https://github.com/microsoft/sql-server-samples/tree/master/samples/databases/northwind-pubs" rel="noopener ugc nofollow" target="_blank">Northwind dataset</a>. The sales data for Northwind Traders, a fictitious specialty foods export­/import company. The database is <a class="af nh" href="https://github.com/microsoft/sql-server-samples/blob/master/license.txt" rel="noopener ugc nofollow" target="_blank">free of use</a> and widely distributed for learning and demonstration purposes. Be sure to set up the database environment beforehand! I also attached the Northwind schema below:</li></ul><pre class="mr ms mt mu mv rg rh ri rj ay rk bk"><span id="18f2" class="qi nj fq rh b ib rl rm l ir rn"><strong class="rh ga">REGION </strong>(RegionID, RDescription)</span><span id="13c8" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">TERRITORIES</strong> ( TerritoryID, TDescription, RegionID@)</span><span id="a26a" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">CATEGORIES </strong>(CategoryID, CategoryName, Description)</span><span id="a86b" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">SUPPLIERS </strong>(SupplierID, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone)</span><span id="83fa" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">CUSTOMERS</strong> (CustomerID, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone)</span><span id="aaaf" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">SHIPPERS </strong>(ShipperID, CompanyName, Phone)</span><span id="0487" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">PRODUCTS </strong>(ProductID, ProductName, SupplierID@, CategoryID@, QuantityPerUnit, UnitPrice, UnitsInStock, UnitsOnOrder, ReorderLevel, Discontinued)</span><span id="bc55" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">EMPLOYEES</strong> (EmployeeID, LastName, FirstName, Title, BirthDate, HireDate, Address, City, RegionID@, PostalCode, Country, HomePhone, Extension, ReportsTo@)</span><span id="e87c" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">EMPLOYEETERRITORIES </strong>(EmployeeID@, TerritoryID@)</span><span id="d1cc" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">ORDERS</strong> (OrderID, CustomerID@, EmployeeID@, TerritoryID@, OrderDate, RequiredDate, ShippedDate, ShipVia@, Freight, ShipName, ShipAddress, ShipCity, ShipRegion, ShipPostalCode, ShipCountry)</span><span id="a9c6" class="qi nj fq rh b ib ro rm l ir rn"><strong class="rh ga">ORDERDETAILS</strong> (OrderID@, ProductID@, UnitPrice, Quantity, Discount)</span></pre><ul class=""><li id="b009" class="oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz qy qz ra bk">If you are unfamiliar with SQL*Plus, check on Oracle’s <a class="af nh" href="https://docs.oracle.com/cd/B19306_01/server.102/b14357/qstart.htm" rel="noopener ugc nofollow" target="_blank">SQL*Plus Quick Start</a> before starting.</li></ul><p id="e348" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Without further ado, let’s get started!</p></div></div></div><div class="ab cb pv pw px py" role="separator"><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="39fe" class="ni nj fq bf nk nl qd gv nn no qe gy nq nr qf nt nu nv qg nx ny nz qh ob oc od bk">Pivot Tables with “DECODE”</h1><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp rp"><img src="../Images/74a9451ab9ff3d7249015797d4488746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i3_VvAC_msUn0CTQ"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Photo by <a class="af nh" href="https://unsplash.com/@jipy32?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jean-Philippe Delberghe</a> on <a class="af nh" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cc1f" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">The crudest way to pivot a table is to utilize the function: <a class="af nh" href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/DECODE.html#GUID-39341D91-3442-4730-BD34-D3CF5D4701CE" rel="noopener ugc nofollow" target="_blank"><strong class="og ga">DECODE()</strong></a>. DECODE() function is like an if else statement. It compares the input with each value and produces an output.</p><blockquote class="rq rr rs"><p id="49d7" class="oe of rt og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">DECODE(input, value1, return1, value2, return2, …, default)</p></blockquote><ul class=""><li id="c5dc" class="oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz qy qz ra bk"><strong class="og ga">input/value</strong>: “input” is compared with all the “values”.</li><li id="6242" class="oe of fq og b gt rb oi oj gw rc ol om on rd op oq or re ot ou ov rf ox oy oz qy qz ra bk"><strong class="og ga">return</strong>: if input = value, then “return” is the output.</li><li id="74fc" class="oe of fq og b gt rb oi oj gw rc ol om on rd op oq or re ot ou ov rf ox oy oz qy qz ra bk"><strong class="og ga">default (optional)</strong>: if input != all of the values, then “default” is the output.</li></ul><p id="894d" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">When we know how DECODE() works, it is time to make our first pivot table.</p><h2 id="4b39" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">1st Version: Pivot table without total column and row</h2><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp ru"><img src="../Images/01c28e4ecd251f365a719f825518832c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U993yTlHewoHOGjb-q5-uA@2x.jpeg"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Pivot table without total column and row, Source: Me</figcaption></figure><p id="c945" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">With DECODE(), we can map out a pseudocode of a pivot table for the ice cream shop owner. When the “day of the week” matches each weekday, DECODE() returns the day’s revenue; if it does not match, 0 is returned instead.</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="a7b8" class="rx nj fq rh b bg ry rz l sa rn">SELECT ice cream flavor, <br/>SUM(DECODE(day of the week, 'Monday', revenue, 0)) AS MONDAY, SUM(DECODE(day of the week, 'Tuesday', revenue, 0)) AS TUESDAY,<br/>SUM(DECODE(day of the week, 'Wednesday', revenue, 0)) AS WEDNESDAY,<br/>SUM(DECODE(day of the week, 'Thursday', revenue, 0)) AS THURSDAY,<br/>SUM(DECODE(day of the week, 'Friday', revenue, 0)) AS FRIDAY,<br/>SUM(DECODE(day of the week, 'Saturday', revenue, 0)) AS SATURDAY,<br/>SUM(DECODE(day of the week, 'Sunday', revenue, 0)) AS SUNDAY<br/>FROM ice cream shop dataset<br/>WHERE date between last Monday and last Sunday;</span></pre><h2 id="0c5c" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">2nd Version: Pivot table with total column and row</h2><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp sb"><img src="../Images/3a58fe26e6b3c13ffbe6a4ba3bddd4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFBGkWN6fs46gMzQTnrYTQ@2x.jpeg"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Pivot table with total column and row, Source: Me</figcaption></figure><p id="6968" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Great job! Now the ice cream shop owner wants to know more about what happened with last week's sales. You could upgrade your pivot table by adding a total column and total row.</p><p id="264a" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">This could be accomplished using the <a class="af nh" href="https://docs.oracle.com/cd/E93962_01/bigData.Doc/eql_onPrem/src/reql_aggregation_grouping_sets.html" rel="noopener ugc nofollow" target="_blank">GROUPING SETS Expression</a> in a GROUP BY statement. A GROUPING SETS Expression defines criteria for multiple GROUP BY aggregations.</p><blockquote class="rq rr rs"><p id="737f" class="oe of rt og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">GROUPING SETS (attribute1, …, ())</p></blockquote><ul class=""><li id="1e78" class="oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz qy qz ra bk"><strong class="og ga">attribute</strong>: a single element or a list of elements to GROUP BY</li><li id="fbb5" class="oe of fq og b gt rb oi oj gw rc ol om on rd op oq or re ot ou ov rf ox oy oz qy qz ra bk"><strong class="og ga">()</strong>: an empty group, which will become the pivot table’s TOTAL row</li></ul><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="868e" class="rx nj fq rh b bg ry rz l sa rn">SELECT NVL(ice cream flavor, 'TOTAL') "ICE CREAM FLAVOR", <br/>SUM(DECODE(day of the week, 'Monday', revenue, 0)) AS MONDAY, SUM(DECODE(day of the week, 'Tuesday', revenue, 0)) AS TUESDAY,<br/>SUM(DECODE(day of the week, 'Wednesday', revenue, 0)) AS WEDNESDAY,<br/>SUM(DECODE(day of the week, 'Thursday', revenue, 0)) AS THURSDAY,<br/>SUM(DECODE(day of the week, 'Friday', revenue, 0)) AS FRIDAY,<br/>SUM(DECODE(day of the week, 'Saturday', revenue, 0)) AS SATURDAY,<br/>SUM(DECODE(day of the week, 'Sunday', revenue, 0)) AS SUNDAY, <br/>SUM(revenue) AS TOTAL<br/>FROM ice cream shop dataset<br/>WHERE date between last Monday and last Sunday<br/>GROUP BY GROUPING SETS (ice cream flavor, ());</span></pre><p id="bec6" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Note: NVL() replaces the null row created by () with ‘TOTAL.’ If you are unfamiliar with <a class="af nh" href="https://docs.oracle.com/en/database/oracle/oracle-database/19/sqlrf/NVL.html#GUID-3AB61E54-9201-4D6A-B48A-79F4C4A034B2" rel="noopener ugc nofollow" target="_blank">NVL()</a>, it is simply a function to replace null values.</p><p id="c060" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Another way of calculating the TOTAL column is to add all the revenue from MONDAY to SUNDAY:</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="e612" class="rx nj fq rh b bg ry rz l sa rn">SUM(DECODE(day of the week, 'Monday', revenue, 0)) <br/>+ SUM(DECODE(day of the week, 'Tuesday', revenue, 0)) <br/>+ SUM(DECODE(day of the week, 'Wednesday', revenue, 0)) <br/>+ SUM(DECODE(day of the week, 'Thursday', revenue, 0)) <br/>+ SUM(DECODE(day of the week, 'Friday', revenue, 0)) <br/>+ SUM(DECODE(day of the week, 'Saturday', revenue, 0))<br/>+ SUM(DECODE(day of the week, 'Sunday', revenue, 0)) AS TOTAL</span></pre><h2 id="57c7" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">3rd Version: Pivot table with total column and row and other totals</h2><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp sc"><img src="../Images/b51145e9666531e26b0b454773076572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ljd-Et9926G17MS6DaZ8zQ@2x.jpeg"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Pivot table with total column and row and other totals, Source: Me</figcaption></figure><p id="c375" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Say that the ice cream owner wanted one more column on the pivot table you provided: the total number of purchases of each flavor of ice cream. No problem! You can add another “TOTAL” column with the same concept!</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="8a8b" class="rx nj fq rh b bg ry rz l sa rn">SELECT NVL(ice cream flavor, 'TOTAL') "ICE CREAM FLAVOR", <br/>SUM(DECODE(day of the week, 'Monday', revenue, 0)) AS MONDAY, SUM(DECODE(day of the week, 'Tuesday', revenue, 0)) AS TUESDAY,<br/>SUM(DECODE(day of the week, 'Wednesday', revenue, 0)) AS WEDNESDAY,<br/>SUM(DECODE(day of the week, 'Thursday', revenue, 0)) AS THURSDAY,<br/>SUM(DECODE(day of the week, 'Friday', revenue, 0)) AS FRIDAY,<br/>SUM(DECODE(day of the week, 'Saturday', revenue, 0)) AS SATURDAY,<br/>SUM(DECODE(day of the week, 'Sunday', revenue, 0)) AS SUNDAY, <br/>SUM(revenue) AS TOTAL,<br/>SUM(purchase ID) "OTHER TOTAL"<br/>FROM ice cream shop dataset<br/>WHERE date between last Monday and last Sunday<br/>GROUP BY GROUPING SETS (ice cream flavor, ());</span></pre></div></div></div><div class="ab cb pv pw px py" role="separator"><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="22b0" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Now that you know how to do a pivot table with DECODE(), let’s try three exercises with the Northwind dataset!</p><p id="92ea" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk sd"><span class="l se sf sg bo sh si sj sk sl ed">Q</span>1. Let’s say we want to find out how many employees in each of their origin countries serve in each region.</p><p id="623e" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">To break up this question, first, we can query all distinct regions in the REGION table. Also, check what countries the employees are from.</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="37b5" class="rx nj fq rh b bg ry rz l sa rn">SELECT DISTINCT REGIONID||' '||RDescription AS REGION<br/>FROM REGION<br/>ORDER BY 1;</span></pre><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div class="mo mp sm"><img src="../Images/3627116e1d54ed0917364c2a13a43fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*99AV1hOzcUkNCQiCL158Yw@2x.jpeg"/></div></figure><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="eeb0" class="rx nj fq rh b bg ry rz l sa rn">SELECT DISTINCT Country<br/>FROM EMPLOYEES<br/>ORDER BY 1;</span></pre><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div class="mo mp sn"><img src="../Images/80132a8d40c683c0db3caebce861de5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*tz4ootF4uq8ZqD6vpBB4ZA@2x.jpeg"/></div></figure><p id="0dfd" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">We will have to make a 2 * 4 pivot table for this question.</p><p id="b4a9" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Next, we can make a pivot table using DECODE(). A sample answer and output are outlined below:</p><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp so"><img src="../Images/2961edeea876bc9ccf18d701f9e086b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5Huq74rsfvr5EQnaR28yg@2x.jpeg"/></div></div></figure><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="fbd8" class="rx nj fq rh b bg ry rz l sa rn">SELECT NVL(Country, 'TOTAL') AS COUNTRY, <br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '1 eastern', 1, 0)) "1 EASTERN",<br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '2 western', 1, 0)) "2 WESTERN",<br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '3 northern', 1, 0)) "3 NORTHERN",<br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '4 southern', 1, 0)) "4 SOUTHERN",<br/>SUM(EmployeeID) AS TOTAL<br/>FROM EMPLOYEES<br/>JOIN REGION USING (REGIONID)<br/>GROUP BY GROUPING SETS (Country, ());</span></pre><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp sp"><img src="../Images/1c753723386af8721f3b7d2ea9cb6ec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YBiU0a00B-AMAe_XQi99xg@2x.jpeg"/></div></div></figure><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="073b" class="rx nj fq rh b bg ry rz l sa rn">--Q1<br/>SELECT Country, <br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '1 eastern', 1, 0)) "1 EASTERN",<br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '2 western', 1, 0)) "2 WESTERN",<br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '3 northern', 1, 0)) "3 NORTHERN",<br/>SUM(DECODE(LOWER(REGIONID||' '||RDescription), '4 southern', 1, 0)) "4 SOUTHERN",<br/>SUM() AS TOTAL<br/>FROM EMPLOYEES<br/>JOIN REGION USING (REGIONID)<br/>GROUP BY Country;</span></pre><p id="e946" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk sd"><span class="l se sf sg bo sh si sj sk sl ed">Q</span>2. For each month in 2010, show the revenue of orders processed by each employee. Also, round to the nearest dollar and display the total revenue made and the total number of orders.</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="51d4" class="rx nj fq rh b bg ry rz l sa rn">--Q2<br/>COLUMN EMPLOYEE FORMAT A18<br/>SELECT NVL(EmployeeID||' '||FirstName||' '||LastName, 'TOTAL') AS EMPLOYEE,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 1, (UnitPrice * Quantity - Discount), 0)), '$990') AS JAN,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 2, (UnitPrice * Quantity - Discount), 0)), '$990') AS FEB,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 3, (UnitPrice * Quantity - Discount), 0)), '$990') AS MAR,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 4, (UnitPrice * Quantity - Discount), 0)), '$990') AS APR,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 5, (UnitPrice * Quantity - Discount), 0)), '$990') AS MAY,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 6, (UnitPrice * Quantity - Discount), 0)), '$990') AS JUN,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 7, (UnitPrice * Quantity - Discount), 0)), '$99,990') AS JUL,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 8, (UnitPrice * Quantity - Discount), 0)), '$99,990') AS AUG,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 9, (UnitPrice * Quantity - Discount), 0)), '$99,990') AS SEP,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 10, (UnitPrice * Quantity - Discount), 0)), '$99,990') AS OCT,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 11, (UnitPrice * Quantity - Discount), 0)), '$99,990') AS NOV,<br/>TO_CHAR(SUM(DECODE(EXTRACT(MONTH FROM OrderDate), 12, (UnitPrice * Quantity - Discount), 0)), '$99,990') AS DEC, <br/>TO_CHAR(SUM((UnitPrice * Quantity - Discount)), '$999,990') AS TOTAL<br/>FROM ORDERS <br/>JOIN ORDERDETAILS USING (OrderID)<br/>JOIN EMPLOYEES USING (EmployeeID)<br/>WHERE EXTRACT(YEAR FROM OrderDate) = 2010<br/>GROUP BY GROUPING SETS (EmployeeID||' '||FirstName||' '||LastName, ())<br/>ORDER BY 1;</span></pre><p id="5f0a" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Note: Notice the FORMAT command and TO_CHAR() function are for formatting purposes. If you want to learn more, please check out the <a class="af nh" href="https://docs.oracle.com/en/database/oracle/oracle-database/19/sqlrf/Format-Models.html#GUID-DFB23985-2943-4C6A-96DF-DF0F664CED96" rel="noopener ugc nofollow" target="_blank">Format Models</a> and <a class="af nh" href="https://docs.oracle.com/database/121/SQPUG/ch_six.htm#SQPUG016" rel="noopener ugc nofollow" target="_blank">Formatting SQL*Plus Reports</a> section on Oracle’s website.</p><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp sq"><img src="../Images/20c3ea352b3155d73bf77da29769b3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTRjvwd6qBl37TThx8_HRA@2x.jpeg"/></div></div></figure></div></div></div><div class="ab cb pv pw px py" role="separator"><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="2500" class="ni nj fq bf nk nl qd gv nn no qe gy nq nr qf nt nu nv qg nx ny nz qh ob oc od bk">Pivot Tables with “PIVOT”</h1><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp sr"><img src="../Images/93e298803a661c1d579b990d24846251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y719xdsZdRqfVJol"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Photo by <a class="af nh" href="https://unsplash.com/@noahwindler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Noah Windler</a> on <a class="af nh" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6176" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Now that you know how to make a pivot table with DECODE(), we can move on to the PIVOT() clause introduced to Oracle in its 11g version.</p><blockquote class="rq rr rs"><p id="3572" class="oe of rt og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">SELECT * <br/>FROM ( query)<br/>PIVOT (aggr FOR column IN (value1, value2, …)<br/>);</p></blockquote><ul class=""><li id="94ae" class="oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz qy qz ra bk"><strong class="og ga">aggr</strong>: function such as SUM, COUNT, MIN, MAX, or AVG</li><li id="73a7" class="oe of fq og b gt rb oi oj gw rc ol om on rd op oq or re ot ou ov rf ox oy oz qy qz ra bk"><strong class="og ga">value</strong>: A list of values for <em class="rt">column</em> to pivot into headings in the cross-tabulation query results</li></ul><p id="7f7a" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Let’s get back to the ice cream shop example. Here is how we can make it with the PIVOT() clause:</p><h2 id="280f" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">1st Version: Pivot table without total column and row</h2><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="2c5b" class="rx nj fq rh b bg ry rz l sa rn">SELECT *<br/>FROM (<br/>      SELECT day of the week, ice cream flavor, revenue<br/>      FROM ice cream shop dataset <br/>      WHERE date between last Monday and last Sunday<br/>)<br/>PIVOT (<br/>       SUM(revenue) <br/>       FOR day of the week IN ('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday')<br/>);</span></pre><h2 id="ac84" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">2nd Version: Pivot table with total column and row</h2><p id="8994" class="pw-post-body-paragraph oe of fq og b gt oh oi oj gw ok ol om on oo op oq or os ot ou ov ow ox oy oz fj bk">If you want to add a total column to your pivot table, doing it with the NVL() function is a great way.</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="9ad1" class="rx nj fq rh b bg ry rz l sa rn">SELECT *<br/>FROM (<br/>      SELECT NVL(ice cream flavor, 'TOTAL') AS ice cream flavor,<br/>             NVL(day of the week, -1) AS DOW, <br/>             SUM(revenue) AS REV<br/>      FROM ice cream shop dataset <br/>      WHERE date between last Monday and last Sunday<br/>      GROUP BY CUBE (ice cream flavor, day of the week) <br/>)<br/>PIVOT (<br/>       SUM(REV) <br/>       FOR DOW IN ('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday', -1 AS TOTAL)<br/>);</span></pre><h2 id="ace8" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">3rd Version: Pivot table with total column and row and other totals</h2><p id="8753" class="pw-post-body-paragraph oe of fq og b gt oh oi oj gw ok ol om on oo op oq or os ot ou ov ow ox oy oz fj bk">When other totals come into the scene, there is only one way to solve the problem. That is by using the JOIN() clause:</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="0b30" class="rx nj fq rh b bg ry rz l sa rn">SELECT ice cream flavor, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday, TOTAL, OTHER TOTAL<br/>FROM (<br/>      SELECT NVL(ice cream flavor, 'TOTAL') AS ice cream flavor,<br/>             NVL(day of the week, -1) AS DOW, <br/>             SUM(revenue) AS REV<br/>      FROM ice cream shop dataset <br/>      WHERE date between last Monday and last Sunday<br/>      GROUP BY CUBE (ice cream flavor, day of the week) <br/>)<br/>PIVOT (<br/>       SUM(REV) <br/>       FOR DOW IN ('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday', -1 AS TOTAL)<br/>)<br/>JOIN (<br/>      SELECT NVL(ice cream flavor, 'TOTAL') AS ice cream flavor, <br/>             SUM(purchase ID) "OTHER TOTAL"<br/>      FROM ice cream shop dataset <br/>      WHERE date between last Monday and last Sunday<br/>      GROUP BY ROLLUP (ice cream flavor)<br/>) USING (ice cream flavor);</span></pre><p id="13ed" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Note: In the pseudocode above, We utilize the CUBE and ROLLUP Extension in GROUP BY. A small explanation will do the job.</p><ul class=""><li id="b8f7" class="oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz qy qz ra bk"><strong class="og ga">CUBE(A, B, C)</strong>: (A, B, C), (A, B), (A, C), (B, C), (A), (B), (C), ()</li><li id="9fa0" class="oe of fq og b gt rb oi oj gw rc ol om on rd op oq or re ot ou ov rf ox oy oz qy qz ra bk"><strong class="og ga">ROLLUP(A, B, C)</strong>: (A, B, C), (A, B), (A), ()</li></ul><p id="b985" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk">Once we know how the PIVOT() clause work, can you practice it with the Northwind dataset we have in part 1?</p><p id="d6aa" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk sd"><span class="l se sf sg bo sh si sj sk sl ed">Q</span>1. Let’s say we want to find out how many employees in each of their origin countries serve in each region.</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="bd57" class="rx nj fq rh b bg ry rz l sa rn">--Q1<br/>--Try it out!</span></pre><p id="d6f9" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk sd"><span class="l se sf sg bo sh si sj sk sl ed">Q</span>2. For each month in 2010, show the revenue of orders processed by each employee. Also, round to the nearest dollar and display the total revenue made and the total number of orders.</p><pre class="mr ms mt mu mv rg rh rv bp rw bb bk"><span id="22cd" class="rx nj fq rh b bg ry rz l sa rn">--Q2<br/>--Try it out!</span></pre></div></div></div><div class="ab cb pv pw px py" role="separator"><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb qc"/><span class="pz by bm qa qb"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="d762" class="ni nj fq bf nk nl qd gv nn no qe gy nq nr qf nt nu nv qg nx ny nz qh ob oc od bk">Epilogue</h1><p id="0e59" class="pw-post-body-paragraph oe of fq og b gt oh oi oj gw ok ol om on oo op oq or os ot ou ov ow ox oy oz fj bk">In this guide, we’ve explored the powerful capabilities of pivot tables in SQL, focusing on both the <strong class="og ga">DECODE()</strong> and <strong class="og ga">PIVOT()</strong> functions. We began with an introduction to pivot tables and their significance in transforming rows into columns for enhanced data analysis. We then walked through the process of creating pivot tables using DECODE() and examined the more streamlined PIVOT() function introduced in Oracle 11g, which simplifies pivot table creation. By applying these techniques, we’ve demonstrated how to efficiently analyze multidimensional data with practical examples, such as the ice cream shop dataset.</p><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp ss"><img src="../Images/99f5eaa3aca6a02bd505db3ffccfd7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AqS40aCS4dlKhZyB"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Photo by <a class="af nh" href="https://unsplash.com/@kmus07?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">karl muscat</a> on <a class="af nh" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="5688" class="qi nj fq bf nk qj qk ql nn qm qn qo nq on qp qq qr or qs qt qu ov qv qw qx fw bk">Recap and Takeaways</h2><ol class=""><li id="7797" class="oe of fq og b gt oh oi oj gw ok ol om on oo op oq or os ot ou ov ow ox oy oz st qz ra bk"><strong class="og ga">Pivot tables with DECODE()</strong>: A fundamental approach using the DECODE() function to manually pivot data.</li><li id="a441" class="oe of fq og b gt rb oi oj gw rc ol om on rd op oq or re ot ou ov rf ox oy oz st qz ra bk"><strong class="og ga">Pivot tables with PIVOT()</strong>: Utilizing the PIVOT() function for a more efficient and readable pivot table creation.</li></ol><p id="a60d" class="pw-post-body-paragraph oe of fq og b gt pp oi oj gw pq ol om on pr op oq or ps ot ou ov pt ox oy oz fj bk"><strong class="og ga">Feel free to share your answers in the comments.</strong> I love to learn about data and reflect on (write about) what I’ve learned in practical applications. If you enjoyed this article, please give it a clap to show your support. You can contact me via <a class="af nh" href="https://www.linkedin.com/in/yung-linchang/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> and <a class="af nh" href="https://twitter.com/yunglinchang" rel="noopener ugc nofollow" target="_blank">Twitter</a> if you have more to discuss. Also, feel free to follow me on Medium for more data science articles to come!</p><blockquote class="pa"><p id="e769" class="pb pc fq bf pd pe pf pg ph pi pj oz dx">Come play along in the data science playground!</p></blockquote></div></div></div></div>    
</body>
</html>