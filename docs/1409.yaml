- en: The Perils of Chasing p99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/perils-of-chasing-p99-578caefa9694?source=collection_archive---------10-----------------------#2024-06-05](https://towardsdatascience.com/perils-of-chasing-p99-578caefa9694?source=collection_archive---------10-----------------------#2024-06-05)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Hidden correlations can mislead optimization strategies
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://kkrao.medium.com/?source=post_page---byline--578caefa9694--------------------------------)[![Krishna
    Rao](../Images/8abebd03fe281f212b7e9d4143c85daa.png)](https://kkrao.medium.com/?source=post_page---byline--578caefa9694--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--578caefa9694--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--578caefa9694--------------------------------)
    [Krishna Rao](https://kkrao.medium.com/?source=post_page---byline--578caefa9694--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--578caefa9694--------------------------------)
    ·5 min read·Jun 5, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/995209c88f774b4e192f3826b3fb44e7.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Chun Kit Soo](https://unsplash.com/@soochunkit?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: p99, or the value below which 99% of observations fall, is widely used to track
    and optimize worst-case performance across industries. For example, the time taken
    for a page to load, fulfill a shopping order or deliver a shipment can all be
    optimized by tracking p99.
  prefs: []
  type: TYPE_NORMAL
- en: While p99 is undoubtedly valuable, it’s crucial to recognize that it ignores
    the top 1% of observations, which may have an unexpectedly large impact when they
    are correlated with other critical business metrics. Blindly chasing p99 without
    checking for such correlations can potentially undermine other business objectives.
  prefs: []
  type: TYPE_NORMAL
- en: In this article, we will analyze the limitations of p99 through an example with
    dummy data, understand when to rely on p99, and explore alternate metrics.
  prefs: []
  type: TYPE_NORMAL
- en: The Correlation Conundrum
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Consider an e-commerce platform where a team is tasked with optimizing the shopping
    cart checkout experience. The team has received customer complaints that checking
    out is rather slow compared to other platforms. So, the team grabs the latest
    1,000 checkouts and analyzes the time taken for checking out. (I created some
    dummy data for this, you are free to use it and tinker with it without restrictions)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/bc71420c8e4ba560e55b7ccb387be51d.png)'
  prefs: []
  type: TYPE_IMG
- en: Distribution of order checkout times. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: As expected, most shopping cart checkouts seem to be completing within a few
    seconds. And 99% of the checkouts happen within 12.1 seconds. In other words,
    the p99 is 12.1 seconds. There are a few long-tail cases that take as long as
    30 seconds. Since they are so few, they may be outliers and should be safe to
    ignore, right?
  prefs: []
  type: TYPE_NORMAL
- en: Now, if we don’t pause and analyze the implication of the last sentence, it
    could be quite dangerous. **Is it really safe to ignore the top 1%?** Are we sure
    checkout times are not correlated with any other business metric?
  prefs: []
  type: TYPE_NORMAL
- en: Let’s say our e-commerce company also cares about gross merchandise value (GMV)
    and has an overall company-level objective to increase it. We should immediately
    check whether the time taken to checkout is correlated with GMV before we ignore
    the top 1%.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/e15a41f722a2e36da09a782d7f2d842b.png)'
  prefs: []
  type: TYPE_IMG
- en: Relationship between order value and fulfillment time. Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: Oh boy! Not only is the cart value correlated with checkout times, it increases
    exponentially for longer checkout times. What’s the penalty of ignoring the top
    1% of checkout times?
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: If we only focused on p99, we would ignore 27% of revenue (27 times greater
    than the 1% we thought we were ignoring). **That is, p99 of checkout times is
    p73 of revenue.** Focusing on p99 in this case inadvertently harms the business.
    It ignores the needs of our highest-value shoppers.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/2c4e0ace05f4f07e7c55b1d8ae5b61bc.png)'
  prefs: []
  type: TYPE_IMG
- en: Cumulative distribution function of order fulfillment times and order value.
    Image by author.
  prefs: []
  type: TYPE_NORMAL
- en: Above, we see why there is a large mismatch between the percentiles of checkout
    times and GMV. The GMV curve rises sharply near the 99th percentile of orders,
    resulting in the top 1% of orders having an outsize impact on GMV.
  prefs: []
  type: TYPE_NORMAL
- en: This is not just an artifact of our dummy data. Such extreme correlations are
    quite common. For example, the top 1% of Slack’s customers account for [50% of
    revenue](https://thetaclv.com/resource/slack-very-attractive-unit-economics-but-with-a-very-long-payback-period/).
    About 12% of UPS’s revenue comes from [just 1 customer](https://seekingalpha.com/article/4666085-united-parcel-service-inc-ups-q4-2023-earnings-call-transcript)
    (Amazon).
  prefs: []
  type: TYPE_NORMAL
- en: A Balanced Approach
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To avoid the pitfalls of optimizing for p99 alone, we can take a more holistic
    approach.
  prefs: []
  type: TYPE_NORMAL
- en: One solution is to track both p99 and p100 (the maximum value) simultaneously.
    This way, we won’t be prone to ignore high-value users.
  prefs: []
  type: TYPE_NORMAL
- en: Another solution is to use revenue-weighted p99 (or weighted by gross merchandise
    value, profit, or any other business metrics of interest), which assigns greater
    importance to observations with higher associated revenue. This metric ensures
    that optimization efforts prioritize the most valuable transactions or processes,
    rather than treating all observations equally.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, when high correlations exist between the performance and business metrics,
    a more stringent p99.5 or p99.9 can mitigate the risk of ignoring high-value users.
  prefs: []
  type: TYPE_NORMAL
- en: Recap
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It’s tempting to rely solely on metrics like p99 for optimization efforts. However,
    as we saw, ignoring the top 1% of observations can negatively impact a large percentage
    of other business outcomes. Tracking both p99 and p100 or using revenue-weighted
    p99 can provide a more comprehensive view and mitigate the risks of optimizing
    for p99 alone. At the very least, let’s remember to avoid narrowly focusing on
    some performance metric while losing sight of overall customer outcomes.
  prefs: []
  type: TYPE_NORMAL
- en: Written with the help of Perplexity (for definitions and background research,
    chat [here](https://www.perplexity.ai/search/I-want-to-S6YgwU.GQnCh1tHTBpMvVQ))
    and ChatGPT (for spellcheck, chat [here](https://chatgpt.com/share/7df5deb8-fa8a-4279-bac6-6500f71f1b4f)).
  prefs: []
  type: TYPE_NORMAL
