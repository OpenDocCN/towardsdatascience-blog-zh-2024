<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Using OpenAI and PandasAI for Series Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Using OpenAI and PandasAI for Series Operations</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-openai-and-pandasai-for-series-operations-2978d539fb66?source=collection_archive---------1-----------------------#2024-06-29">https://towardsdatascience.com/using-openai-and-pandasai-for-series-operations-2978d539fb66?source=collection_archive---------1-----------------------#2024-06-29</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="d30e" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Incorporate natural language queries and operations into your Python data cleaning workflow.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://michaelbrucewalker.medium.com/?source=post_page---byline--2978d539fb66--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Michael B Walker" class="l ep by dd de cx" src="../Images/c8537da4fca3c542e1729771675bc059.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/da:true/resize:fill:88:88/0*_6BPxS_ABUBBpBxi"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--2978d539fb66--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://michaelbrucewalker.medium.com/?source=post_page---byline--2978d539fb66--------------------------------" rel="noopener follow">Michael B Walker</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--2978d539fb66--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">6 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jun 29, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/ba6fcadd6ed048d35c8b0a0ea7df7a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_-CLoJs6Mk17K8v1KZj2Q.jpeg"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Red panda drawing donated by Karen Walker, the artist.</figcaption></figure><p id="e729" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Many of the series operations we need to do in our pandas data cleaning projects can be assisted by AI tools, including by PandasAI. PandasAI takes advantage of large language models, such as that from OpenAI, to enable natural language queries and operations on data columns. In this post, we examine how to use PandasAI to query Series values, create new Series, set Series values conditionally, and reshape our data.</p><p id="fae9" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">You can install PandasAI by entering pip install pandasai into a terminal or into Windows Powershell. You will also need to get a token from openai.com to send a request to the OpenAI API.</p><p id="773d" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">As the PandasAI library is developing rapidly, you can anticipate different results depending on the versions of PandasAI and pandas you are using. In this article, I use version 1.4.8 of PandasAI and version 1.5.3 of pandas.</p><p id="d467" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We will work with data from the National Longitudinal Study of Youth (NLS) conducted by the United States Bureau of Labor Statistics. The NLS has surveyed the same cohort of high school students for over 25 years, and has useful data items on educational outcomes and weeks worked for each of those years, among many other variables. It is available for public use at nlsinfo.org. (The NLS public releases are covered by the United States government <a class="af nx" href="https://digital.gov/resources/open-data-policy-m-13-13/#:~:text=Making%20information%20resources%20accessible%2C%20discoverable,contribute%20significantly%20to%20job%20creation." rel="noopener ugc nofollow" target="_blank">Open Data Policy</a>, which permits both non-commercial and commercial use.)</p><p id="486b" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We will also work with COVID-19 data provided by <em class="ny">Our World in Data. </em>That dataset has one row per country per day with number of new cases and new deaths. This dataset is available for download at <a class="af nx" href="https://ourworldindata.org/covid-cases" rel="noopener ugc nofollow" target="_blank">ourworldindata.org/covid-cases</a>, with a Creative Commons CC BY 4.0 license. You can also download all code and data used in this post from <a class="af nx" href="https://github.com/PacktPublishing/Python-Data-Cleaning-Cookbook-Second-Edition/tree/main/6.%20SeriesOperations" rel="noopener ugc nofollow" target="_blank">GitHub</a>.</p><p id="90be" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We start by importing the OpenAI and SmartDataframe modules from PandasAI. We also have to instantiate an llm object:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="dfc9" class="od oe fq oa b bg of og l oh oi">import pandas as pd<br/>from pandasai.llm.openai import OpenAI<br/>from pandasai import SmartDataframe<br/>llm = OpenAI(api_token="Your API Token")</span></pre><p id="2ed3" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Next, we load the DataFrames we will be using and create a SmartDataframe object from the NLS pandas DataFrame:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="82f9" class="od oe fq oa b bg of og l oh oi">covidcases = pd.read_csv("data/covidcases.csv")<br/>nls97 = pd.read_csv("data/nls97f.csv")<br/>nls97.set_index("personid", inplace=True)<br/>nls97sdf = SmartDataframe(nls97, config={"llm": llm})</span></pre><p id="3e78" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Now we are ready to generate summary statistics on Series from our SmartDataframe. We can ask for the average for a single Series, or for multiple Series:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="ee60" class="od oe fq oa b bg of og l oh oi">nls97sdf.chat("Show average of gpaoverall")<br/><br/>2.8184077281812128<br/><br/>nls97sdf.chat("Show average for each weeks worked column")<br/><br/>               Average Weeks Worked<br/>                  0<br/>weeksworked00 26.42<br/>weeksworked01 29.78<br/>weeksworked02 31.83<br/>weeksworked03 33.51<br/>weeksworked04 35.10<br/>weeksworked05 37.34<br/>weeksworked06 38.44<br/>weeksworked07 39.29<br/>weeksworked08 39.33<br/>weeksworked09 37.51<br/>weeksworked10 37.12<br/>weeksworked11 38.06<br/>weeksworked12 38.15<br/>weeksworked13 38.79<br/>weeksworked14 38.73<br/>weeksworked15 39.67<br/>weeksworked16 40.19<br/>weeksworked17 40.37<br/>weeksworked18 40.01<br/>weeksworked19 41.22<br/>weeksworked20 38.35<br/>weeksworked21 36.17<br/>weeksworked22 11.43</span></pre><p id="d496" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can also summarize Series values by another Series, usually one that is categorical:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="6fff" class="od oe fq oa b bg of og l oh oi">nls97sdf.chat("Show satmath average by gender")<br/><br/>   Female   Male<br/>0  486.65 516.88</span></pre><p id="07f3" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can also create a new Series with the <code class="cx oj ok ol oa b">chat</code> method of SmartDataframe. We do not need to use the actual column names. For example, PandasAI will figure out that we want the <em class="ny">childathome</em> Series when we write child at home:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="7bd2" class="od oe fq oa b bg of og l oh oi">nls97sdf = nls97sdf.chat("Set childnum to child at home plus child not at<br/>  home")<br/>nls97sdf[['childnum','childathome','childnotathome']].\<br/>  sample(5, random_state=1)<br/><br/>         childnum  childathome  childnotathome<br/>personid                                       <br/>211230        2.00         2.00            0.00<br/>990746        3.00         3.00            0.00<br/>308169        3.00         1.00            2.00<br/>798458         NaN          NaN             NaN<br/>312009         NaN          NaN             NaN</span></pre><p id="9691" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can use the <code class="cx oj ok ol oa b">chat</code> method to create Series values conditionally:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="8b02" class="od oe fq oa b bg of og l oh oi">nls97sdf = nls97sdf.chat("evermarried is 'No' when maritalstatus is<br/>  'Never-married', else 'Yes'")<br/>nls97sdf.groupby(['evermarried','maritalstatus']).size()<br/><br/>evermarried  maritalstatus<br/>No           Never-married    2767<br/>Yes          Divorced          669<br/>             Married          3068<br/>             Separated         148<br/>             Widowed            23<br/>dtype: int64</span></pre><p id="b37b" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">PandasAI is quite flexible regarding the language you might use here. For example, the following provides the same results:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="862a" class="od oe fq oa b bg of og l oh oi">nls97sdf = nls97sdf.chat("if maritalstatus is 'Never-married' set<br/>  evermarried2 to 'No', otherwise 'Yes'")<br/>nls97sdf.groupby(['evermarried2','maritalstatus']).size()<br/><br/>evermarried2  maritalstatus<br/>No            Never-married    2767<br/>Yes           Divorced          669<br/>              Married          3068<br/>              Separated         148<br/>              Widowed            23<br/>dtype: int64</span></pre><p id="9c83" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can do calculations across a number of similarly named columns:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="14ba" class="od oe fq oa b bg of og l oh oi">nls97sdf = nls97sdf.chat("Set weeksworked for each row to the average of<br/>  all weeksworked columns for that row")</span></pre><p id="a2ea" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">This will calculate the average of all weeksworked00-weeksworked22 columns and assign that to a new column called weeksworked.</p><p id="4806" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can easily impute values where they are missing based on summary statistics:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="6441" class="od oe fq oa b bg of og l oh oi">nls97sdf.gpaenglish.describe()<br/><br/>count   5,798<br/>mean      273<br/>std        74<br/>min         0<br/>25%       227<br/>50%       284<br/>75%       323<br/>max       418<br/>Name: gpaenglish, dtype: float64<br/><br/>nls97sdf = nls97sdf.chat("set missing gpaenglish to the average")<br/>nls97sdf.gpaenglish.describe()<br/><br/>count   8,984<br/>mean      273<br/>std        59<br/>min         0<br/>25%       264<br/>50%       273<br/>75%       298<br/>max       418<br/>Name: gpaenglish, dtype: float64</span></pre><p id="4ede" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can also use PandasAI to do some reshaping. Recall that the COVID-19 case data has new cases for each day for each country. Let’s say we only want the first row of data for each country. We can do that the traditional way with <em class="ny">drop_duplicates</em>:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="e04f" class="od oe fq oa b bg of og l oh oi">firstcase = covidcases.\<br/>  sort_values(['location','casedate']).\<br/>  drop_duplicates(['location'], keep='first')<br/><br/>firstcase.set_index('location', inplace=True)<br/><br/>firstcase.shape<br/><br/>(231, 67)<br/><br/>firstcase[['iso_code','continent','casedate',<br/>  'total_cases','new_cases']].head(2).T<br/><br/>location    Afghanistan     Albania<br/>iso_code            AFG         ALB<br/>continent          Asia      Europe<br/>casedate     2020-03-01  2020-03-15<br/>total_cases        1.00       33.00<br/>new_cases          1.00       33.00</span></pre><p id="4ff0" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can get the same results by creating a SmartDataframe and using the <code class="cx oj ok ol oa b">chat</code> method. The natural language I use here is remarkably straightforward, <em class="ny">Show first casedate and location and other values for each country</em>:</p><pre class="ml mm mn mo mp nz oa ob bp oc bb bk"><span id="0f79" class="od oe fq oa b bg of og l oh oi">covidcasessdf = SmartDataframe(covidcases, config={"llm": llm})<br/>firstcasesdf = covidcasessdf.chat("Show first casedate and location and<br/>other values for each country.")<br/><br/>firstcasesdf.shape<br/>(231, 7)<br/><br/>firstcasesdf[['location','continent','casedate',<br/>  'total_cases','new_cases']].head(2).T<br/><br/>iso_code               ABW          AFG<br/>location             Aruba  Afghanistan<br/>continent    North America         Asia<br/>casedate        2020-03-22   2020-03-01<br/>total_cases           5.00         1.00<br/>new_cases             5.00         1.00</span></pre><p id="249e" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Notice that PandasAI makes smart choices about the columns to get. We get the columns we need rather than all of them. We could have also just passed the names of the columns we wanted to <code class="cx oj ok ol oa b">chat</code>. (PandasAI sorted the rows by iso_code, rather than by location, which is why the first row is different.)</p><p id="b927" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Much of the work when using PandasAI is really just importing the relevant libraries and instantiating large language model and SmartDataframe objects. Once that’s done, simple sentences sent to the <code class="cx oj ok ol oa b">chat</code> method of the SmartDataframe are sufficient to summarize Series values and create new Series.</p><p id="51e5" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">PandasAI excels at generating simple statistics from Series. We don’t even need to remember the Series name exactly. Often the natural language we might use can be more intuitive than traditional pandas methods like groupby. The <em class="ny">Show satmath average by gender </em>value passed to <code class="cx oj ok ol oa b">chat</code> is a good example of that.</p><p id="de29" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Operations on Series, including the creation of a new Series, is also quite straightforward. We created a total number of children Series (childnum) by instructing the SmartDataframe to add the number of children living at home to the number of children not living at home. We didn’t even provide the literal Series names, childathome and childnotathome respectively. PandasAI figured out what we meant.</p><p id="f26e" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Since we are passing natural language instructions to <code class="cx oj ok ol oa b">chat</code> for our Series operations, there is no one right way to get what we want. For example, we get the same result when we passed <code class="cx oj ok ol oa b">evermarried is ‘No’ when maritalstatus is ‘Never-married’, else ‘Yes’</code> to <code class="cx oj ok ol oa b">chat</code> as we did with <code class="cx oj ok ol oa b">if maritalstatus is ‘Never-married’ set evermarried2 to ‘No’, otherwise ‘Yes’</code>.</p><p id="a573" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can also do fairly extensive DataFrame reshaping with simple natural language instructions, as in the last command we provided. We add <code class="cx oj ok ol oa b">and other values</code> to the instructions to get columns other than casedate. PandasAI also figures out that location makes sense as the index.</p><p id="7bd5" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">You can read more about how to use PandasAI and SmartDataframes here:</p><div class="om on oo op oq or"><a href="https://docs.pandas-ai.com/llms?source=post_page-----2978d539fb66--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="os ab ig"><div class="ot ab co cb ou ov"><h2 class="bf fr hw z io ow iq ir ox it iv fp bk">Large Language Models - PandasAI</h2><div class="oy l"><h3 class="bf b hw z io ow iq ir ox it iv dx">PandasAI supports several large language models (LLMs) that are used to generate code from natural language queries.</h3></div><div class="oz l"><p class="bf b dy z io ow iq ir ox it iv dx">docs.pandas-ai.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf lq or"/></div></div></a></div><p id="39b6" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Or in the second edition of my book, Python Data Cleaning Cookbook:</p><div class="om on oo op oq or"><a href="https://packt.link/hKI1y?source=post_page-----2978d539fb66--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="os ab ig"><div class="ot ab co cb ou ov"><h2 class="bf fr hw z io ow iq ir ox it iv fp bk">Python Data Cleaning Cookbook - Second Edition: Prepare your data for analysis with pandas, NumPy…</h2><div class="oy l"><h3 class="bf b hw z io ow iq ir ox it iv dx">Python Data Cleaning Cookbook - Second Edition: Prepare your data for analysis with pandas, NumPy, Matplotlib…</h3></div><div class="oz l"><p class="bf b dy z io ow iq ir ox it iv dx">packt.link</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf lq or"/></div></div></a></div><p id="5dcc" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Good luck with your data cleaning and I would love to hear how things are going!</p></div></div></div></div>    
</body>
</html>