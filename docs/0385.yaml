- en: Drawing From a Random Distribution in SQL
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åœ¨ SQL ä¸­ä»éšæœºåˆ†å¸ƒä¸­æŠ½æ ·
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/drawing-from-a-random-distribution-in-sql-b6c97c89e45c?source=collection_archive---------10-----------------------#2024-02-09](https://towardsdatascience.com/drawing-from-a-random-distribution-in-sql-b6c97c89e45c?source=collection_archive---------10-----------------------#2024-02-09)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/drawing-from-a-random-distribution-in-sql-b6c97c89e45c?source=collection_archive---------10-----------------------#2024-02-09](https://towardsdatascience.com/drawing-from-a-random-distribution-in-sql-b6c97c89e45c?source=collection_archive---------10-----------------------#2024-02-09)
- en: From a probability density function to random samples
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä»æ¦‚ç‡å¯†åº¦å‡½æ•°åˆ°éšæœºæ ·æœ¬
- en: '[](https://medium.com/@samiabboud?source=post_page---byline--b6c97c89e45c--------------------------------)[![Sami
    Abboud](../Images/546a33fe92a194068816e6173eaa854a.png)](https://medium.com/@samiabboud?source=post_page---byline--b6c97c89e45c--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--b6c97c89e45c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--b6c97c89e45c--------------------------------)
    [Sami Abboud](https://medium.com/@samiabboud?source=post_page---byline--b6c97c89e45c--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@samiabboud?source=post_page---byline--b6c97c89e45c--------------------------------)[![Sami
    Abboud](../Images/546a33fe92a194068816e6173eaa854a.png)](https://medium.com/@samiabboud?source=post_page---byline--b6c97c89e45c--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--b6c97c89e45c--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--b6c97c89e45c--------------------------------)
    [Sami Abboud](https://medium.com/@samiabboud?source=post_page---byline--b6c97c89e45c--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--b6c97c89e45c--------------------------------)
    Â·8 min readÂ·Feb 9, 2024
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--b6c97c89e45c--------------------------------)
    Â·8åˆ†é’Ÿé˜…è¯»Â·2024å¹´2æœˆ9æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/22d2395939286048baeef0d7e72e1687.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/22d2395939286048baeef0d7e72e1687.png)'
- en: Photo by [Moritz Kindler](https://unsplash.com/@moritz_photography?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
    on [Unsplash](https://unsplash.com/photos/white-and-black-polka-dot-ceramic-mug-with-water-okiy0SxOaBg?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡æ¥è‡ª [Moritz Kindler](https://unsplash.com/@moritz_photography?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
    ï¼Œå‘å¸ƒäº [Unsplash](https://unsplash.com/photos/white-and-black-polka-dot-ceramic-mug-with-water-okiy0SxOaBg?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
- en: There are different methods for updating a reinforcement learning agentâ€™s policy
    at each iteration. A few weeks ago we started experimenting with replacing our
    current method with a Bayesian inference step. Some of the data workloads within
    our agent are written in SQL that is executed on GCPâ€™s BigQuery engine. We use
    this stack because it provides scalable computational capabilities, ML packages
    and a straightforward SQL interface.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ›´æ–°å¼ºåŒ–å­¦ä¹ ä»£ç†çš„ç­–ç•¥æœ‰ä¸åŒçš„æ–¹æ³•ã€‚å‡ å‘¨å‰ï¼Œæˆ‘ä»¬å¼€å§‹å°è¯•ç”¨è´å¶æ–¯æ¨ç†æ­¥éª¤æ›¿æ¢å½“å‰çš„æ–¹æ³•ã€‚æˆ‘ä»¬ä»£ç†ä¸­çš„ä¸€äº›æ•°æ®å·¥ä½œè´Ÿè½½æ˜¯ç”¨ SQL ç¼–å†™çš„ï¼Œå¹¶åœ¨
    GCP çš„ BigQuery å¼•æ“ä¸Šæ‰§è¡Œã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæŠ€æœ¯æ ˆï¼Œå› ä¸ºå®ƒæä¾›äº†å¯æ‰©å±•çš„è®¡ç®—èƒ½åŠ›ã€æœºå™¨å­¦ä¹ åŒ…å’Œä¸€ä¸ªç›´è§‚çš„ SQL æ¥å£ã€‚
- en: The Bayesian inference step we looked to implement uses one of the [alternative
    parametrizations of a beta distribution](https://en.wikipedia.org/wiki/Beta_distribution#Mean_and_sample_size).
    Which means that we will need to be able to draw from a beta distribution in SQL.
    While working on this, I discovered that drawing from the random distribution
    in SQL is a topic with very few well documented examples. So Iâ€™m writing about
    it here..
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è®¡åˆ’å®ç°çš„è´å¶æ–¯æ¨ç†æ­¥éª¤ä½¿ç”¨çš„æ˜¯ [è´å¡”åˆ†å¸ƒçš„æ›¿ä»£å‚æ•°åŒ–æ–¹å¼](https://en.wikipedia.org/wiki/Beta_distribution#Mean_and_sample_size)ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿåœ¨
    SQL ä¸­ä»è´å¡”åˆ†å¸ƒä¸­æŠ½æ ·ã€‚åœ¨ç ”ç©¶è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘å‘ç° SQL ä¸­ä»éšæœºåˆ†å¸ƒä¸­æŠ½æ ·æ˜¯ä¸€ä¸ªå‡ ä¹æ²¡æœ‰å¥½æ–‡æ¡£ç¤ºä¾‹çš„è¯é¢˜ã€‚æ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå†™ä¸€ä¸‹ã€‚
- en: 'Step 1: How hard could it be?'
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€æ­¥ï¼šè¿™æœ‰å¤šéš¾ï¼Ÿ
- en: BigQuery doesnâ€™t have a beta distribution. It doesnâ€™t have the capability to
    draw from *any* random distribution. So my first intuition was to take the definition
    of the beta distribution, write it in SQL, set the parameters using a CTA, draw
    a random number between 0 and 1 and compute the value of that function.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery æ²¡æœ‰è´å¡”åˆ†å¸ƒã€‚å®ƒä¹Ÿæ²¡æœ‰ä»*ä»»ä½•*éšæœºåˆ†å¸ƒä¸­æŠ½æ ·çš„èƒ½åŠ›ã€‚æ‰€ä»¥æˆ‘æœ€åˆçš„æƒ³æ³•æ˜¯ï¼Œæ‹¿è´å¡”åˆ†å¸ƒçš„å®šä¹‰ï¼Œç”¨ SQL å†™å‡ºæ¥ï¼Œä½¿ç”¨ CTA è®¾ç½®å‚æ•°ï¼Œä»
    0 åˆ° 1 ä¹‹é—´æŠ½ä¸€ä¸ªéšæœºæ•°ï¼Œå¹¶è®¡ç®—è¯¥å‡½æ•°çš„å€¼ã€‚
- en: 'But itâ€™s 2024, so I asked ChatGPT how it would do it:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†è¿™æ˜¯ 2024 å¹´ï¼Œæ‰€ä»¥æˆ‘é—®äº† ChatGPT å®ƒä¼šæ€ä¹ˆåšï¼š
- en: '**Me**: â€œâ€‹How do you create random draws from a beta distribution in BigQuery?'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**æˆ‘**ï¼šâ€œå¦‚ä½•åœ¨ BigQuery ä¸­ä»è´å¡”åˆ†å¸ƒä¸­æŠ½å–éšæœºæ ·æœ¬ï¼Ÿâ€'
- en: '**ChatGPT**:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '**ChatGPT**ï¼š'
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**Me** *thinking to myself*: Right, so that clearly wonâ€™t work.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '**æˆ‘** *è‡ªè¨€è‡ªè¯­*ï¼šå¯¹äº†ï¼Œè¿™æ˜¾ç„¶è¡Œä¸é€šã€‚'
- en: 'Do you see the problem in the code? ChatGPT draws two *different* x values
    for the presumed beta distribution PDF. I fixed this, cleaned up the query a little
    and sampled 1,000 values. And hereâ€™s the SQL code for doing that:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ åœ¨ä»£ç ä¸­çœ‹åˆ°äº†é—®é¢˜å—ï¼ŸChatGPT ä¸ºå‡å®šçš„ Beta åˆ†å¸ƒ PDF ç»˜åˆ¶äº†ä¸¤ä¸ª *ä¸åŒ* çš„ x å€¼ã€‚æˆ‘ä¿®æ­£äº†è¿™ä¸ªé—®é¢˜ï¼Œç¨å¾®æ¸…ç†äº†ä¸€ä¸‹æŸ¥è¯¢ï¼Œå¹¶æŠ½æ ·äº†
    1,000 ä¸ªå€¼ã€‚ä¸‹é¢æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„ SQL ä»£ç ï¼š
- en: '[PRE1]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Thank you all, thatâ€™s a wrap ğŸ See you in the next post!
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: æ„Ÿè°¢å¤§å®¶ï¼Œä»Šå¤©å°±åˆ°è¿™é‡Œ ğŸ ä¸‹ç¯‡æ–‡ç« è§ï¼
- en: WRONG! ğŸ”´
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: é”™è¯¯ï¼ğŸ”´
- en: Letâ€™s take a trusted implementation of drawing from a beta distribution using
    the same parameters and compare the results. Iâ€™ve used SciPyâ€™s `beta.rvs()` in
    Python and here are two 100-bin histograms that will allow comparing the two drawn
    distributions.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ç”¨ç›¸åŒçš„å‚æ•°ï¼Œå–ä¸€ä¸ªç»è¿‡éªŒè¯çš„ Beta åˆ†å¸ƒæŠ½æ ·å®ç°ï¼Œå¹¶å¯¹æ¯”ç»“æœã€‚æˆ‘ä½¿ç”¨äº† Python ä¸­ SciPy çš„ `beta.rvs()`ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ª
    100-bin çš„ç›´æ–¹å›¾ï¼Œå¯ä»¥ç”¨æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªæŠ½æ ·åˆ†å¸ƒã€‚
- en: '[PRE2]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](../Images/8fd72857adf2b4861d92580c4316de1f.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8fd72857adf2b4861d92580c4316de1f.png)'
- en: '(**Left)**: Naive draws using BigQuery. (**Right**): Draws using SciPyâ€™s beta.rvs()'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ï¼ˆ**å·¦ä¾§**ï¼‰ï¼šä½¿ç”¨ BigQuery çš„ç®€å•æŠ½æ ·ã€‚ï¼ˆ**å³ä¾§**ï¼‰ï¼šä½¿ç”¨ SciPy çš„ beta.rvs() æŠ½æ ·
- en: Well, it doesnâ€™t take a magnifying glass to realize that the distributions are
    different. I went back the beta distribution definition and realized that it might
    be because the beta distribution also has a scaling constant which depends on
    the [gamma function](https://en.wikipedia.org/wiki/Gamma_function) that I didnâ€™t
    include in the calculation ğŸ¤¦.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: å¥½å§ï¼Œä»”ç»†çœ‹å°±èƒ½å‘ç°åˆ†å¸ƒæ˜¯ä¸åŒçš„ã€‚æˆ‘å›è¿‡å¤´æŸ¥çœ‹äº† Beta åˆ†å¸ƒçš„å®šä¹‰ï¼Œæ„è¯†åˆ°å¯èƒ½æ˜¯å› ä¸º Beta åˆ†å¸ƒä¹Ÿæœ‰ä¸€ä¸ªä¾èµ–äº [ä¼½é©¬å‡½æ•°](https://en.wikipedia.org/wiki/Gamma_function)
    çš„ç¼©æ”¾å¸¸æ•°ï¼Œè€Œæˆ‘åœ¨è®¡ç®—ä¸­æ²¡æœ‰åŒ…æ‹¬å®ƒ ğŸ¤¦ã€‚
- en: '**Problem:** the gamma function does not have a [closed-form expression](https://en.wikipedia.org/wiki/Closed-form_expression),
    and BigQuery doesnâ€™t provide an implementation that approximates it. So at this
    point I decided to switch to Python, a language that Iâ€™m more familiar with and
    will make my experimentation more efficient. The thinking was that if I nail it
    down in Python, Iâ€™ll be able to translate it to SQL. I would still need some way
    to approximate a gamma function, but one step at a time.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '**é—®é¢˜**ï¼šä¼½é©¬å‡½æ•°æ²¡æœ‰ [å°é—­å¼è¡¨è¾¾å¼](https://en.wikipedia.org/wiki/Closed-form_expression)ï¼Œè€Œ
    BigQuery ä¹Ÿæ²¡æœ‰æä¾›è¿‘ä¼¼çš„å®ç°ã€‚å› æ­¤ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘å†³å®šè½¬å‘ Pythonï¼Œè¿™æ˜¯æˆ‘æ›´ç†Ÿæ‚‰çš„è¯­è¨€ï¼Œå¹¶ä¸”å¯ä»¥æé«˜æˆ‘çš„å®éªŒæ•ˆç‡ã€‚æˆ‘æƒ³åˆ°ï¼Œå¦‚æœåœ¨ Python
    ä¸­æå®šäº†ï¼Œæˆ‘å°±èƒ½æŠŠå®ƒè½¬åˆ° SQL ä¸­å»ã€‚è™½ç„¶æˆ‘ä»ç„¶éœ€è¦æŸç§æ–¹æ³•æ¥è¿‘ä¼¼ä¼½é©¬å‡½æ•°ï¼Œä½†ä¸€æ­¥ä¸€æ­¥æ¥ã€‚'
- en: 'Step 2: What does drawing from a random distribution actually mean?'
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ­¥éª¤ 2ï¼šä»éšæœºåˆ†å¸ƒæŠ½æ ·åˆ°åº•æ„å‘³ç€ä»€ä¹ˆï¼Ÿ
- en: 'Letâ€™s implement a manual draw from a beta distribution in Python, but now with
    the correct constant using SciPyâ€™s gamma function:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬åœ¨ Python ä¸­å®ç°ä» Beta åˆ†å¸ƒæ‰‹åŠ¨æŠ½æ ·ï¼Œä½†è¿™æ¬¡ä½¿ç”¨ SciPy çš„ä¼½é©¬å‡½æ•°æ¥æ­£ç¡®è®¡ç®—å¸¸æ•°ï¼š
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Letâ€™s examine the distribution using a 100-bin histogram again:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬å†æ¬¡ç”¨ä¸€ä¸ª 100-bin çš„ç›´æ–¹å›¾æ¥æ£€æŸ¥åˆ†å¸ƒï¼š
- en: '![](../Images/de29f9bc9661da1f062515f5e5ea0db7.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/de29f9bc9661da1f062515f5e5ea0db7.png)'
- en: Naive draws using Python
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ Python çš„ç®€å•æŠ½æ ·
- en: The first thing we notice is that the scale is now different, but the distribution
    still looks like the one drawn in BigQuery.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ°çš„æ˜¯ï¼Œè§„æ¨¡ç°åœ¨ä¸åŒäº†ï¼Œä½†åˆ†å¸ƒä»ç„¶çœ‹èµ·æ¥åƒæ˜¯åœ¨ BigQuery ä¸­ç»˜åˆ¶çš„é‚£æ ·ã€‚
- en: '*â€¦ something is wrongâ€¦* itâ€™s time for a short walk to think ğŸš¶'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '*... æœ‰äº›åœ°æ–¹ä¸å¯¹...* æ˜¯æ—¶å€™å»æ•£æ­¥æ€è€ƒä¸€ä¸‹äº† ğŸš¶'
- en: â€¦
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: â€¦
- en: '*After a short walk:*'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '*çŸ­æš‚æ•£æ­¥åï¼š*'
- en: What does drawing from a random distribution actually mean? What Iâ€™ve implemented
    so far is randomly sampling from the beta probability density function (PDF) and
    it wasnâ€™t working.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ä»éšæœºåˆ†å¸ƒæŠ½æ ·åˆ°åº•æ„å‘³ç€ä»€ä¹ˆï¼Ÿåˆ°ç›®å‰ä¸ºæ­¢æˆ‘å®ç°çš„æ˜¯ä» Beta æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰ä¸­éšæœºæŠ½æ ·ï¼Œä½†å®ƒå¹¶æ²¡æœ‰æˆåŠŸã€‚
- en: So I had to dig up some statistics classes.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥æˆ‘ä¸å¾—ä¸ç¿»é˜…ä¸€äº›ç»Ÿè®¡å­¦è¯¾ç¨‹ã€‚
- en: 'Here are a couple of good refreshers on:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œæœ‰ä¸€äº›å¾ˆå¥½çš„å¤ä¹ èµ„æ–™ï¼š
- en: '[Probability Density Functions (PDFs) and Cumulative Distribution Functions
    (CDFs) for Continuous Random Variables](https://stats.libretexts.org/Courses/Saint_Mary''s_College_Notre_Dame/MATH_345__-_Probability_(Kuter)/4%3A_Continuous_Random_Variables/4.1%3A_Probability_Density_Functions_(PDFs)_and_Cumulative_Distribution_Functions_(CDFs)_for_Continuous_Random_Variables),
    and'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[è¿ç»­éšæœºå˜é‡çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰å’Œç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰](https://stats.libretexts.org/Courses/Saint_Mary''s_College_Notre_Dame/MATH_345__-_Probability_(Kuter)/4%3A_Continuous_Random_Variables/4.1%3A_Probability_Density_Functions_(PDFs)_and_Cumulative_Distribution_Functions_(CDFs)_for_Continuous_Random_Variables)ï¼Œä»¥åŠ'
- en: '[Generating Samples from Probability Distributions](https://web.mit.edu/urban_or_book/www/book/chapter7/7.1.3.html)
    that I found helpful.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘å‘ç°éå¸¸æœ‰ç”¨çš„ [ä»æ¦‚ç‡åˆ†å¸ƒç”Ÿæˆæ ·æœ¬](https://web.mit.edu/urban_or_book/www/book/chapter7/7.1.3.html)ã€‚
- en: In short, the conclusion is that drawing from a random variable actually means
    **sampling from the inverse cumulative distribution function (CDF)**, not from
    the probability density function (PDF) like I was doing so far.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: ç®€è€Œè¨€ä¹‹ï¼Œç»“è®ºæ˜¯ä»éšæœºå˜é‡ä¸­æŠ½æ ·å®é™…ä¸Šæ„å‘³ç€**ä»é€†ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDFï¼‰ä¸­æŠ½æ ·**ï¼Œè€Œä¸æ˜¯åƒæˆ‘ä¹‹å‰åšçš„é‚£æ ·ä»æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰ä¸­æŠ½æ ·ã€‚
- en: Of course ğŸ¤¦. My [probability professor](https://web.iem.technion.ac.il/dmitry-dima-ioffe-1963-2020/),
    who I just learned had passed away from illness in 2020, would have encouraged
    me to â€œreview the basicsâ€ at this point..
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶äº† ğŸ¤¦ã€‚æˆ‘çš„[æ¦‚ç‡è®ºæ•™æˆ](https://web.iem.technion.ac.il/dmitry-dima-ioffe-1963-2020/)ï¼Œæˆ‘åˆšå¾—çŸ¥ä»–åœ¨
    2020 å¹´å› ç—…å»ä¸–äº†ï¼Œä»–æœ¬è¯¥é¼“åŠ±æˆ‘åœ¨è¿™ä¸ªæ—¶å€™â€œå¤ä¹ åŸºç¡€çŸ¥è¯†â€ã€‚
- en: 'Ok. Letâ€™s revisit the Python code, now drawing samples from the inverse CDF
    (which is also called [the quantile function](https://en.wikipedia.org/wiki/Quantile_function))
    of our beta distribution, and compare it to the distribution drawn using SciPyâ€™s
    beta.rvs():'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: å¥½çš„ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ Python ä»£ç ï¼Œç°åœ¨å®ƒæ˜¯ä»æˆ‘ä»¬ beta åˆ†å¸ƒçš„é€† CDFï¼ˆä¹Ÿç§°ä¸º[åˆ†ä½æ•°å‡½æ•°](https://en.wikipedia.org/wiki/Quantile_function)ï¼‰ä¸­æŠ½æ ·ï¼Œå¹¶ä¸ä½¿ç”¨
    SciPy çš„ beta.rvs() æŠ½æ ·çš„åˆ†å¸ƒè¿›è¡Œæ¯”è¾ƒï¼š
- en: '[PRE4]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '*phew* this looks much better:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '*å‘¼* è¿™ä¸ªçœ‹èµ·æ¥å¥½å¤šäº†ï¼š'
- en: '![](../Images/eb08d3d0bc8cb8c045eba5cf4cbc73fe.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/eb08d3d0bc8cb8c045eba5cf4cbc73fe.png)'
- en: An overlay of two histograms comparing a 1,000 draws using SciPyâ€™s beta.rvs()
    and a manual draw
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸¤ä¸ªç›´æ–¹å›¾çš„å åŠ ï¼Œæ¯”è¾ƒä½¿ç”¨ SciPy çš„ beta.rvs() å’Œæ‰‹åŠ¨æŠ½æ ·çš„ 1,000 æ¬¡æŠ½æ ·ç»“æœ
- en: 'Step 3: Back to SQL'
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¬¬ 3 æ­¥ï¼šå›åˆ° SQL
- en: Now that weâ€™ve got drawing samples from a random variable straight, itâ€™s time
    to move back to SQL. For the sake of simplicity, and because BigQuery does not
    readily come with an implementation of a Gamma functionÂ¹ Iâ€™m going to draw from
    the [logistic distribution](https://en.wikipedia.org/wiki/Logistic_distribution)
    (with parameters a=0 and b=1).
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å·²ç»æ­£ç¡®åœ°ä»éšæœºå˜é‡ä¸­æŠ½æ ·ï¼Œæ˜¯æ—¶å€™å›åˆ° SQL äº†ã€‚ä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œå¹¶ä¸”å› ä¸º BigQuery å¹¶æœªç›´æ¥æä¾› Gamma å‡½æ•°çš„å®ç°Â¹ï¼Œæˆ‘å°†ä»[é€»è¾‘æ–¯è’‚åˆ†å¸ƒ](https://en.wikipedia.org/wiki/Logistic_distribution)ä¸­æŠ½æ ·ï¼ˆå‚æ•°
    a=0ï¼Œb=1ï¼‰ã€‚
- en: '[PRE5]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Letâ€™s now compare the distributions of the three sampling methods:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬æ¯”è¾ƒè¿™ä¸‰ç§æŠ½æ ·æ–¹æ³•çš„åˆ†å¸ƒï¼š
- en: SciPyâ€™s `logistic.rvs()`
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: SciPy çš„ `logistic.rvs()`
- en: Manually sampling the logistic distribution PDF in Python and drawing a random
    sample as per Step 2 above
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨ Python ä¸­æ‰‹åŠ¨ä»é€»è¾‘æ–¯è’‚åˆ†å¸ƒçš„ PDF ä¸­æŠ½æ ·ï¼Œå¹¶æŒ‰ç…§ä¸Šé¢ç¬¬ 2 æ­¥çš„æ–¹å¼è¿›è¡ŒéšæœºæŠ½æ ·
- en: Doing the same in SQL
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨ SQL ä¸­æ‰§è¡Œç›¸åŒæ“ä½œ
- en: '![](../Images/48e0f6a2ad13082a144664db8a95f8dc.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/48e0f6a2ad13082a144664db8a95f8dc.png)'
- en: An overlay of three histograms comparing 1,000 draws using SciPyâ€™s beta.rvs(),
    a manual draw in Python and a manual draw in SQL
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‰ä¸ªç›´æ–¹å›¾çš„å åŠ ï¼Œæ¯”è¾ƒä½¿ç”¨ SciPy çš„ beta.rvs()ã€Python ä¸­çš„æ‰‹åŠ¨æŠ½æ ·å’Œ SQL ä¸­çš„æ‰‹åŠ¨æŠ½æ ·çš„ 1,000 æ¬¡æŠ½æ ·ç»“æœ
- en: This looks like a success to me! ğŸ’ª
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: çœ‹èµ·æ¥è¿™æ˜¯ä¸€æ¬¡æˆåŠŸï¼ğŸ’ª
- en: This SQL code above samples from the logistic distribution, but it should work
    on any distribution where you are able to get a discrete representation of the
    PDF by sampling it at consistent intervals!
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸Šé¢çš„ SQL ä»£ç ä»é€»è¾‘æ–¯è’‚åˆ†å¸ƒä¸­æŠ½æ ·ï¼Œä½†å®ƒåº”è¯¥é€‚ç”¨äºä»»ä½•åˆ†å¸ƒï¼Œåªè¦ä½ èƒ½é€šè¿‡åœ¨ä¸€è‡´çš„é—´éš”å†…æŠ½æ ·æ¥è·å¾—æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰çš„ç¦»æ•£è¡¨ç¤ºï¼
- en: '[1] I did go looking for an approximation of the Gamma function in SQL and
    eventually gave up. It is most probably possible to code an approximation of the
    Gamma function in SQL but that will need more research than I had time allocated.
    Beware of naively copy/pasting an approximation (e.g. translating one the of snippets
    in Rosetta Code to SQL) because those make assumptions on the gamma parameter
    that are not always obvious. For example, the Python snippet (translated from
    Ada) is only accurate for small gamma values.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '[1] æˆ‘ç¡®å®æ›¾å°è¯•å¯»æ‰¾ SQL ä¸­çš„ Gamma å‡½æ•°è¿‘ä¼¼å®ç°ï¼Œæœ€åæ”¾å¼ƒäº†ã€‚å¾ˆå¯èƒ½åœ¨ SQL ä¸­ç¼–å†™ Gamma å‡½æ•°çš„è¿‘ä¼¼æ˜¯å¯èƒ½çš„ï¼Œä½†è¿™éœ€è¦æ›´å¤šçš„ç ”ç©¶ï¼Œè€Œæˆ‘åˆ†é…çš„æ—¶é—´å¹¶ä¸è¶³å¤Ÿã€‚è¯·å°å¿ƒç›²ç›®å¤åˆ¶ç²˜è´´ä¸€ä¸ªè¿‘ä¼¼å®ç°ï¼ˆä¾‹å¦‚ï¼Œå°†
    Rosetta Code ä¸­çš„æŸæ®µä»£ç ç¿»è¯‘æˆ SQLï¼‰ï¼Œå› ä¸ºè¿™äº›å®ç°ä¼šå‡è®¾ Gamma å‚æ•°ï¼Œè€Œè¿™äº›å‡è®¾å¹¶ä¸æ€»æ˜¯æ˜¾è€Œæ˜“è§ã€‚ä¾‹å¦‚ï¼ŒPython ä»£ç ï¼ˆç”± Ada
    è½¬è¯‘è€Œæ¥ï¼‰å¯¹äºå° Gamma å€¼æ‰æ˜¯å‡†ç¡®çš„ã€‚'
- en: â€”
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: â€”
- en: '**This is the kind of work we do to keep improving Aampe, a reinforcement learning
    agent that personalizes emails, web/push notifications, SMS and WhatsApp messages
    for users.**'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '**è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä¸æ–­æ”¹è¿› Aampe æ‰€åšçš„å·¥ä½œï¼ŒAampe æ˜¯ä¸€ä¸ªå¼ºåŒ–å­¦ä¹ ä»£ç†ï¼Œèƒ½å¤Ÿä¸ºç”¨æˆ·ä¸ªæ€§åŒ–ç”µå­é‚®ä»¶ã€ç½‘é¡µ/æ¨é€é€šçŸ¥ã€çŸ­ä¿¡å’Œ WhatsApp
    æ¶ˆæ¯ã€‚**'
- en: '*Unless stated otherwise, all images are by the author.*'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '*é™¤éå¦æœ‰è¯´æ˜ï¼Œæ‰€æœ‰å›¾ç‰‡å‡ç”±ä½œè€…æä¾›ã€‚*'
