- en: Validating the Causal Impact of the Synthetic Control Method
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/validating-the-causal-impact-of-the-synthetic-control-method-2f3bf185f266?source=collection_archive---------6-----------------------#2024-06-08](https://towardsdatascience.com/validating-the-causal-impact-of-the-synthetic-control-method-2f3bf185f266?source=collection_archive---------6-----------------------#2024-06-08)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Causal AI, exploring the integration of causal reasoning into machine learning
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@raz1470?source=post_page---byline--2f3bf185f266--------------------------------)[![Ryan
    O''Sullivan](../Images/7cd161d38d67d2c0b7da2d8f3e7d33fe.png)](https://medium.com/@raz1470?source=post_page---byline--2f3bf185f266--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--2f3bf185f266--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--2f3bf185f266--------------------------------)
    [Ryan O''Sullivan](https://medium.com/@raz1470?source=post_page---byline--2f3bf185f266--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--2f3bf185f266--------------------------------)
    ·10 min read·Jun 8, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/242fd31202ca191c89090516f0165385.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Irina Inga](https://unsplash.com/@irinainga05?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: What is this series of articles about?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Welcome to my series on Causal AI, where we will explore the integration of
    causal reasoning into machine learning models. Expect to explore a number of practical
    applications across different business contexts.
  prefs: []
  type: TYPE_NORMAL
- en: In the last article we covered *measuring the intrinsic causal influence of
    your marketing campaigns*. In this article we will move onto *validating the causal
    impact of the synthetic controls*.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you missed the last article on intrinsic causal influence, check it out
    here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/measuring-the-intrinsic-causal-influence-of-your-marketing-campaigns-aa8354c26b7b?source=post_page-----2f3bf185f266--------------------------------)
    [## Measuring The Intrinsic Causal Influence Of Your Marketing Campaigns'
  prefs: []
  type: TYPE_NORMAL
- en: Causal AI, exploring the integration of causal reasoning into machine learning
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/measuring-the-intrinsic-causal-influence-of-your-marketing-campaigns-aa8354c26b7b?source=post_page-----2f3bf185f266--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this article we will focus on understanding the synthetic control method
    and exploring how we can validate the estimated causal impact.
  prefs: []
  type: TYPE_NORMAL
- en: '**The following aspects will be covered:**'
  prefs: []
  type: TYPE_NORMAL
- en: What is the synthetic control method?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What challenge does it try to overcome?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How can we validate the estimated causal impact?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A Python case study using realistic google trend data, demonstrating how we
    can validate the estimated causal impact of the synthetic controls.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The full notebook can be found here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/raz1470/causal_ai/blob/main/notebooks/synthetic%20controls%20-%20model%20training.ipynb?source=post_page-----2f3bf185f266--------------------------------)
    [## causal_ai/notebooks/synthetic controls - model training.ipynb at main · raz1470/causal_ai'
  prefs: []
  type: TYPE_NORMAL
- en: This project introduces Causal AI and how it can drive business value. - causal_ai/notebooks/synthetic
    controls - model…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/raz1470/causal_ai/blob/main/notebooks/synthetic%20controls%20-%20model%20training.ipynb?source=post_page-----2f3bf185f266--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Synthetic Control Method
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: What is it?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The synthetic control method is a causal technique which can be used to assess
    the causal impact of an intervention or treatment when a randomised control trial
    (RCT) or A/B test was not possible. It was originally proposed in 2003 by Abadie
    and Gardezabal. The following paper includes a great case study to help you understand
    the proposed method:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://web.stanford.edu/~jhain/Paper/JASA2010.pdf](https://web.stanford.edu/~jhain/Paper/JASA2010.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4876ac9837822ae299d7afa75560fe05.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: Let’s cover some of the basics ourselves… The synthetic control method creates
    a counterfactual version of the treatment unit by creating a weighted combination
    of control units that did not receive the intervention or treatment.
  prefs: []
  type: TYPE_NORMAL
- en: '**Treated unit:** The unit which receives the intervention.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Control units:** A set of similar units which did not receive the intervention.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Counterfactual:** Created as a weighted combination of the control units.
    Aim is to find weights for each control unit that result in a counterfactual which
    closely matches the treated unit in the pre-intervention period.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Causal impact:** The difference between the post-intervention treatment unit
    and counterfactual.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If we wanted to really simplify things, we could think of it as linear regression
    where each control unit is a feature and the treatment unit is the target. The
    pre-intervention period is our train set, and we use the model to score our post-intervention
    period. The difference between the actual and predicted is the causal impact.
  prefs: []
  type: TYPE_NORMAL
- en: 'Below are a couple examples to bring it to life when we might consider using
    it:'
  prefs: []
  type: TYPE_NORMAL
- en: When running a TV marketing campaign, we are unable to randomly assign the audience
    into those that can and can’t see the campaign. We could however, carefully select
    a region to trial the campaign and use the remaining regions as control units.
    Once we have measured the effect the campaign could be rolled out to other regions.
    This is often called a geo-lift test.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Policy changes which are brought into some regions but not others — For example
    a local council may bring a policy change into force to reduce unemployment. Other
    regions where the policy wasn’t in place could be used as control units.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What challenge does it try to overcome?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When we combine high-dimensionality (lots of features) with limited observations,
    we can get a model which overfits.
  prefs: []
  type: TYPE_NORMAL
- en: Let’s take the geo-lift example to illustrate. If we use weekly data from the
    last year as our pre-intervention period, this gives us 52 observations. If we
    then decide to test our intervention across countries in Europe, that will give
    us an observation to feature ratio of 1:1!
  prefs: []
  type: TYPE_NORMAL
- en: Earlier we talked about how the synthetic control method could be implemented
    using linear regression. However, the observation to feature ratio mean it is
    very likely linear regression will overfit resulting in a poor causal impact estimate
    in the post-intervention period.
  prefs: []
  type: TYPE_NORMAL
- en: 'In linear regression the weights (coefficients) for each feature (control unit)
    could be negative or positive and they may sum to a number greater than 1\. However,
    the synthetic control method learns the weights whilst applying the below constraints:'
  prefs: []
  type: TYPE_NORMAL
- en: Constraining weights to sum to 1
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Constraining weights to be ≥ 0
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/ab8a2f8a1d158f245bef617fcefd96b5.png)'
  prefs: []
  type: TYPE_IMG
- en: User generate image
  prefs: []
  type: TYPE_NORMAL
- en: These constraints help with regularisation and avoid extrapolation beyond the
    range of the observed data.
  prefs: []
  type: TYPE_NORMAL
- en: It is worth noting that in terms of regularisation, Ridge and Lasso regression
    can achieve this, and in some cases are reasonable alternatives. But we will test
    this out in the case study!
  prefs: []
  type: TYPE_NORMAL
- en: How can we validate the estimated causal impact?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: An arguably bigger challenge is the fact that we are unable to validate the
    estimated causal impact in the post-intervention period.
  prefs: []
  type: TYPE_NORMAL
- en: How long should my pre-intervention period be? Are we sure we haven’t overfit
    our pre-intervention period? How can we know whether our model generalises well
    in the post intervention period? What if I want to try out different implementations
    of synthetic control method?
  prefs: []
  type: TYPE_NORMAL
- en: We could randomly select a few observations from the pre-intervention period
    and hold them back for validation — But we have already highlighted the challenge
    which comes from having limited observations so we may make things even worse!
  prefs: []
  type: TYPE_NORMAL
- en: What if we could run some sort of pre-intervention simulation? Could that help
    us answer some of the questions highlighted above and gain confidence in our models
    estimated causal impact? All will be explained in the case study!
  prefs: []
  type: TYPE_NORMAL
- en: Case study
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Background
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After convincing Finance that brand marketing is driving some serious value,
    the marketing team approach you to ask about geo-lift testing. Someone from Facebook
    has told them it’s the next big thing (although it was the same person who told
    them Prophet was a good forecasting model) and they want to know whether they
    could use it to measure their new TV campaign which is coming up.
  prefs: []
  type: TYPE_NORMAL
- en: You are a little concerned, as the last time you ran a geo-lift test the marketing
    analytics team thought it was a good idea to play around with the pre-intervention
    period used until they had a nice big causal impact.
  prefs: []
  type: TYPE_NORMAL
- en: This time round, you suggest that they run a “pre-intervention simulation” after
    which you propose that the pre-intervention period is agreed before the test begins.
  prefs: []
  type: TYPE_NORMAL
- en: So let’s explore what a “pre-intervention simulation” looks like!
  prefs: []
  type: TYPE_NORMAL
- en: Creating the data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To make this as realistic as possible, I extracted some google trend data for
    the majority of countries in Europe. What the search term was isn’t relevant,
    just pretend it’s the sales for you company (and that you operate across Europe).
  prefs: []
  type: TYPE_NORMAL
- en: 'However, if you are interested in how I got the google trend data, check out
    my notebook:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/raz1470/causal_ai/blob/main/notebooks/synthetic%20controls%20-%20data%20collection.ipynb?source=post_page-----2f3bf185f266--------------------------------)
    [## causal_ai/notebooks/synthetic controls - data collection.ipynb at main · raz1470/causal_ai'
  prefs: []
  type: TYPE_NORMAL
- en: This project introduces Causal AI and how it can drive business value. - causal_ai/notebooks/synthetic
    controls - data…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/raz1470/causal_ai/blob/main/notebooks/synthetic%20controls%20-%20data%20collection.ipynb?source=post_page-----2f3bf185f266--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: Below we can see the dataframe. We have sales for the past 3 years across 50
    European countries. The marketing team plan to run their TV campaign in Great
    Britain.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/38a31d9ec200cba9a45b6c09bc9347b3.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: Now here comes the clever bit. We will simulate an intervention in the last
    7 weeks of the time series.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Now let’s plot the actual and counterfactual sales across GB to bring what
    we have done to life:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/4876ac9837822ae299d7afa75560fe05.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: So now we have simulated an intervention, we can explore how well the synthetic
    control method will work.
  prefs: []
  type: TYPE_NORMAL
- en: Pre-processing
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: All of the European countries apart from GB are set as control units (features).
    The treatment unit (target) is the sales in GB with the intervention applied.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Regression
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Below I have setup a function which we can re-use with different pre-intervention
    periods and different regression models (e.g. Ridge, Lasso):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'To start us off we keep things simple and use linear regression to estimate
    the causal impact, using a small pre-intervention period:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/e48bd5832d392f66cc7bd5be1945b135.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: Looking at the results, linear regression doesn’t do great. But this isn’t surprising
    given the observation to feature ratio.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/5995e5ef2df8c9ec4a57f4df245e8be3.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: Synthetic control method
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let’s jump right in and see how it compares to the synthetic control method.
    Below I have setup a similar function as before, but applying the synthetic control
    method using sciPy:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'I keep the pre-intervention period the same to create a fair comparison to
    linear regression:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/bb483c51df63e0e5df556624775d4e4e.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: Wow! I’ll be the first to admit I wasn’t expecting such a significant improvement!
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/8593cd13b5533eec365a1c92006b5ca2.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: Comparison of results
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let’s not get too carried away yet. Below we run a few more experiments exploring
    model types and pre-interventions periods:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'We will use the code below to visualise the results:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/36d5fbbe62a6070db05e30c377ffbfe3.png)'
  prefs: []
  type: TYPE_IMG
- en: User generated image
  prefs: []
  type: TYPE_NORMAL
- en: The results for the small dataset are really interesting! As expected, regularisation
    helped improve the causal impact estimates. The synthetic control then took it
    one step further!
  prefs: []
  type: TYPE_NORMAL
- en: The results of the large dataset suggest that longer pre-intervention periods
    aren’t always better.
  prefs: []
  type: TYPE_NORMAL
- en: However, the thing I want you to take away is how valuable carrying out a pre-intervention
    simulation is. There are so many avenues you could explore with your own dataset!
  prefs: []
  type: TYPE_NORMAL
- en: Closing thoughts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Today we explored the synthetic control method and how you can validate the
    causal impact. I’ll leave you with a few final thoughts:'
  prefs: []
  type: TYPE_NORMAL
- en: The simplicity of the synthetic control method make it one of the most widely
    used technique from the causal AI toolbox.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unfortunately it is also the most widely abused — Lets run the R CausalImpact
    package, changing the pre-intervention period until we see an uplift we like.
    😭
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This is where I highly recommend running pre-intervention simulations to agree
    test design upfront.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Synthetic control method is a heavily researched area. It’s worth checking out
    the proposed adaptions Augmented SC, Robust SC and Penalized SC.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Resources
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '*Alberto Abadie, Alexis Diamond & Jens Hainmueller (2010) Synthetic Control
    Methods for Comparative Case Studies: Estimating the Effect of California’s Tobacco
    Control Program, Journal of the American Statistical Association, 105:490, 493–505,
    DOI: 10.1198/jasa.2009.ap08746*'
  prefs: []
  type: TYPE_NORMAL
- en: Follow me if you want to continue this journey into Causal AI — In the next
    article we will look at enhancing marketing mix modelling with Causal AI.
  prefs: []
  type: TYPE_NORMAL
