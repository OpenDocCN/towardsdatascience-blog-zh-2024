<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Create an AI-Driven Movie Quiz with Gemini LLM, Python, FastAPI, Pydantic, RAG and more</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Create an AI-Driven Movie Quiz with Gemini LLM, Python, FastAPI, Pydantic, RAG and more</h1>
<blockquote>ÂéüÊñáÔºö<a href="https://towardsdatascience.com/create-an-ai-driven-movie-quiz-with-gemini-llm-python-fastapi-pydantic-rag-and-more-e15322be4f66?source=collection_archive---------0-----------------------#2024-04-18">https://towardsdatascience.com/create-an-ai-driven-movie-quiz-with-gemini-llm-python-fastapi-pydantic-rag-and-more-e15322be4f66?source=collection_archive---------0-----------------------#2024-04-18</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="bf57" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Discover the basics of using Gemini with Python via VertexAI, creating APIs with FastAPI, data validation with Pydantic and the fundamentals of Retrieval-Augmented Generation (RAG)</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://vojay.medium.com/?source=post_page---byline--e15322be4f66--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Volker Janz" class="l ep by dd de cx" src="../Images/0825160d6d521f4152948f0187cf354b.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*UKWFUrD3gzsvYC0QKsPT3g.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--e15322be4f66--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://vojay.medium.com/?source=post_page---byline--e15322be4f66--------------------------------" rel="noopener follow">Volker Janz</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">¬∑</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--e15322be4f66--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">¬∑</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">21 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">¬∑</span></span></div><span data-testid="storyPublishDate">Apr 18, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">4</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div></div></div><div class="mj"><div class="ab cb"><div class="lm mk ln ml lo mm cf mn cg mo ci bh"><figure class="ms mt mu mv mw mj mx my paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq mr"><img src="../Images/50e962ece900e09fb6fcb997adafede4.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/0*Qnw88gAD0ZSspoCG"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Photo by <a class="af nj" href="https://unsplash.com/@neonbrand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kenny Eliason</a> on <a class="af nj" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="e871" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk og"><span class="l oh oi oj bo ok ol om on oo ed">W</span>ithin this article, I share some of the basics to create a LLM-driven web-application, using various technologies, such as: Python, <a class="af nj" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">FastAPI</a>, <a class="af nj" href="https://docs.pydantic.dev/latest/" rel="noopener ugc nofollow" target="_blank">Pydantic</a>, <a class="af nj" href="https://cloud.google.com/vertex-ai" rel="noopener ugc nofollow" target="_blank">VertexAI</a> and more.</p><blockquote class="op"><p id="1074" class="oq or fq bf os ot ou ov ow ox oy of dx">You will learn how to create such a project from the very beginning and get an overview of the underlying concepts, including <strong class="al">Retrieval-Augmented Generation</strong> (RAG).</p></blockquote><p id="c709" class="pw-post-body-paragraph nk nl fq nm b go oz no np gr pa nr ns nt pb nv nw nx pc nz oa ob pd od oe of fj bk"><em class="pe">Disclaimer: I am using data from The Movie Database within this project. The API is free to use for non-commercial purposes and complies with the Digital Millennium Copyright Act (DMCA). For further information about TMDB data usage, please </em><a class="af nj" href="https://developer.themoviedb.org/docs/faq" rel="noopener ugc nofollow" target="_blank"><em class="pe">read the official FAQ</em></a><em class="pe">.</em></p></div></div></div><div class="ab cb pf pg ph pi" role="separator"><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="7a0d" class="pn po fq bf pp pq pr gq ps pt pu gt pv pw px py pz qa qb qc qd qe qf qg qh qi bk">Table of contents</h1><p id="85e6" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">‚Äì <a class="af nj" href="#bf8e" rel="noopener ugc nofollow">Inspiration</a><br/>‚Äì <a class="af nj" href="#a588" rel="noopener ugc nofollow">System Architecture</a><br/>‚Äì <a class="af nj" href="#d0b3" rel="noopener ugc nofollow">Understanding Retrieval-Augmented Generation (RAG)</a><br/>‚Äì <a class="af nj" href="#4cfd" rel="noopener ugc nofollow">Python projects with Poetry</a><br/>‚Äì <a class="af nj" href="#ca13" rel="noopener ugc nofollow">Create the API with FastAPI</a><br/>‚Äì <a class="af nj" href="#103f" rel="noopener ugc nofollow">Data validation and quality with Pydantic</a><br/>‚Äì <a class="af nj" href="#fe62" rel="noopener ugc nofollow">TMDB client with httpx</a><br/>‚Äì <a class="af nj" href="#040c" rel="noopener ugc nofollow">Gemini LLM client with VertexAI</a><br/>‚Äì <a class="af nj" href="#2bf6" rel="noopener ugc nofollow">Modular prompt generator with Jinja</a><br/>‚Äì <a class="af nj" href="#f4be" rel="noopener ugc nofollow">Frontend</a><br/>‚Äì <a class="af nj" href="#809a" rel="noopener ugc nofollow">API examples</a><br/>‚Äì <a class="af nj" href="#165c" rel="noopener ugc nofollow">Conclusion</a></p></div></div></div><div class="ab cb pf pg ph pi" role="separator"><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="635e" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The best way to share this knowledge is through a practical example. Hence, I‚Äôll use my project <strong class="nm fr">Gemini Movie Detectives</strong> to cover the various aspects. The project was created as part of the <a class="af nj" href="https://googleai.devpost.com/" rel="noopener ugc nofollow" target="_blank">Google AI Hackathon 2024</a>, which is still running while I am writing this.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq qo"><img src="../Images/3d44844866ab4bb81b2e6b5acaf52bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wyZefMe8ovBUPmPN8h_blQ.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Gemini Movie Detectives (by author)</figcaption></figure><p id="3c44" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Gemini Movie Detectives is a project aimed at leveraging the power of the Gemini Pro model via VertexAI to create an engaging quiz game using the latest movie data from <a class="af nj" href="https://www.themoviedb.org/" rel="noopener ugc nofollow" target="_blank">The Movie Database (TMDB)</a>.</p><p id="c0d6" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Part of the project was also to make it deployable with Docker and to create a live version. Try it yourself: <a class="af nj" href="https://movie-detectives.com/" rel="noopener ugc nofollow" target="_blank">movie-detectives.com</a>. Keep in mind that this is a simple prototype, so there might be unexpected issues. Also, I had to add some limitations in order to control costs that might be generated by using GCP and VertexAI.</p></div></div><div class="mj"><div class="ab cb"><div class="lm mk ln ml lo mm cf mn cg mo ci bh"><figure class="ms mt mu mv mw mj mx my paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq qo"><img src="../Images/f949342e71bc028936d5836525e42f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*nxCYo-5BtIZIvGm4fm31fA.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Gemini Movie Detectives (by author)</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="c80c" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The project is <strong class="nm fr">fully open-source</strong> and is split into two separate repositories:</p><ul class=""><li id="d193" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk"><strong class="nm fr">üöÄ Github repository for backend</strong>: <a class="af nj" href="https://github.com/vojay-dev/gemini-movie-detectives-api" rel="noopener ugc nofollow" target="_blank">https://github.com/vojay-dev/gemini-movie-detectives-api</a></li><li id="3935" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><strong class="nm fr">üñ•Ô∏è Github repository for frontend</strong>: <a class="af nj" href="https://github.com/vojay-dev/gemini-movie-detectives-ui" rel="noopener ugc nofollow" target="_blank">https://github.com/vojay-dev/gemini-movie-detectives-ui</a></li></ul><p id="75a4" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The focus of the article is the backend project and underlying concepts. It will therefore only briefly explain the frontend and its components.</p></div></div></div><div class="ab cb pf pg ph pi" role="separator"><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="8e31" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In the following video, I also give an overview over the project and its components:</p><figure class="ms mt mu mv mw mj"><div class="qx io l ed"><div class="qy qz l"/></div></figure></div></div></div><div class="ab cb pf pg ph pi" role="separator"><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="bf8e" class="pn po fq bf pp pq pr gq ps pt pu gt pv pw px py pz qa qb qc qd qe qf qg qh qi bk">Inspiration</h1><p id="bf7b" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">Growing up as a passionate gamer and now working as a Data Engineer, I‚Äôve always been drawn to the intersection of gaming and data. With this project, I combined two of my greatest passions: gaming and data. Back in the 90‚Äô I always enjoyed the video game series You Don‚Äôt Know Jack, a delightful blend of trivia and comedy that not only entertained but also taught me a thing or two. Generally, the usage of games for educational purposes is another concept that fascinates me.</p><p id="26cc" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In 2023, I organized a workshop to teach kids and young adults game development. They learned about mathematical concepts behind collision detection, yet they had fun as everything was framed in the context of gaming. It was eye-opening that gaming is not only a huge market but also holds a great potential for knowledge sharing.</p><p id="0bdf" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">With this project, called Movie Detectives, I aim to showcase the magic of Gemini, and AI in general, in crafting engaging trivia and educational games, but also how game design can profit from these technologies in general.</p><p id="2cdb" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">By feeding the Gemini LLM with accurate and up-to-date movie metadata, I could ensure the accuracy of the questions from Gemini. An important aspect, because without this Retrieval-Augmented Generation (RAG) methodology to enrich queries with real-time metadata, there‚Äôs a risk of propagating misinformation ‚Äî a typical pitfall when using AI for this purpose.</p><p id="ec24" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Another game-changer lies in the modular prompt generation framework I‚Äôve crafted using Jinja templates. It‚Äôs like having a Swiss Army knife for game design ‚Äî effortlessly swapping show master personalities to tailor the game experience. And with the language module, translating the quiz into multiple languages is a breeze, eliminating the need for costly translation processes.</p><p id="4e62" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Taking that on a business perspective, it can be used to reach a much broader audience of customers, without the need of expensive translation processes.</p><p id="ad81" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">From a business standpoint, this modularization opens doors to a wider customer base, transcending language barriers without breaking a sweat. And personally, I‚Äôve experienced firsthand the transformative power of these modules. Switching from the default quiz master to the dad-joke-quiz-master was a riot ‚Äî a nostalgic nod to the heyday of You Don‚Äôt Know Jack, and a testament to the versatility of this project.</p></div></div><div class="mj"><div class="ab cb"><div class="lm mk ln ml lo mm cf mn cg mo ci bh"><figure class="ms mt mu mv mw mj mx my paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq ra"><img src="../Images/44ed0a40a77f059c48e616639864e51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*k96CbwHu2DFPsYr8rvpsxg.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Movie Detectives ‚Äî Example: Santa Claus personality (by author)</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="a588" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">System Architecture</h1><p id="a370" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">Before we jump into details, let‚Äôs get an overview of how the application was built.</p><p id="e451" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><strong class="nm fr">Tech Stack: üöÄ Backend</strong></p><ul class=""><li id="7cdc" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk">Python 3.12 + <a class="af nj" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">FastAPI</a> API development</li><li id="9400" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://www.python-httpx.org/" rel="noopener ugc nofollow" target="_blank">httpx</a> for TMDB integration</li><li id="3583" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://jinja.palletsprojects.com/" rel="noopener ugc nofollow" target="_blank">Jinja</a> templating for modular prompt generation</li><li id="e47b" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://docs.pydantic.dev/latest/" rel="noopener ugc nofollow" target="_blank">Pydantic</a> for data modeling and validation</li><li id="847b" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://python-poetry.org/" rel="noopener ugc nofollow" target="_blank">Poetry</a> for dependency management</li><li id="9f20" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">Docker</a> for deployment</li><li id="9eec" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://www.themoviedb.org/" rel="noopener ugc nofollow" target="_blank">TMDB API</a> for movie data</li><li id="ac15" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://cloud.google.com/vertex-ai" rel="noopener ugc nofollow" target="_blank">VertexAI</a> and <a class="af nj" href="https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini" rel="noopener ugc nofollow" target="_blank">Gemini</a> for generating quiz questions and evaluating answers</li><li id="f036" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://docs.astral.sh/ruff/" rel="noopener ugc nofollow" target="_blank">Ruff</a> as linter and code formatter together with <a class="af nj" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">pre-commit</a> hooks</li><li id="974e" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk">Github Actions to automatically run tests and linter on every push</li></ul><p id="f883" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><strong class="nm fr">Tech Stack: üñ•Ô∏è Frontend</strong></p><ul class=""><li id="be5c" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk"><a class="af nj" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank">VueJS</a> 3.4 as the frontend framework</li><li id="be3b" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank">Vite</a> for frontend tooling</li></ul><p id="7903" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Essentially, the application fetches up-to-date movie metadata from an external API (TMDB), constructs a prompt based on different modules (personality, language, ‚Ä¶), enriches this prompt with the metadata and that way, uses Gemini to initiate a movie quiz in which the user has to guess the correct title.</p><p id="e9e8" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The backend infrastructure is built with FastAPI and Python, employing the Retrieval-Augmented Generation (RAG) methodology to enrich queries with real-time metadata. Utilizing Jinja templating, the backend modularizes prompt generation into base, personality, and data enhancement templates, enabling the generation of accurate and engaging quiz questions.</p><p id="4345" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The frontend is powered by Vue 3 and Vite, supported by daisyUI and Tailwind CSS for efficient frontend development. Together, these tools provide users with a sleek and modern interface for seamless interaction with the backend.</p><p id="f82d" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In Movie Detectives, quiz answers are interpreted by the Language Model (LLM) once again, allowing for dynamic scoring and personalized responses. This showcases the potential of integrating LLM with RAG in game design and development, paving the way for truly individualized gaming experiences. Furthermore, it demonstrates the potential for creating engaging quiz trivia or educational games by involving LLM. Adding and changing personalities or languages is as easy as adding more Jinja template modules. With very little effort, this can change the full game experience, reducing the effort for developers.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq rg"><img src="../Images/b33ff35fa8348020b98001d766fc0b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lG3xbgzzNqNsOlCGZhvt7A.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">System Overview (by author)</figcaption></figure><p id="e735" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">As can be seen in the overview, Retrieval-Augmented Generation (RAG) is one of the essential ideas of the backend. Let‚Äôs have a closer look at this particular paradigm.</p><h1 id="d0b3" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">Understanding Retrieval-Augmented Generation (RAG)</h1><p id="c97b" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">In the realm of Large Language Models (LLM) and AI, one paradigm becoming more and more popular is Retrieval-Augmented Generation (RAG). But what does RAG entail, and how does it influence the landscape of AI development?</p><p id="b761" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">At its essence, RAG enhances LLM systems by incorporating external data to enrich their predictions. Which means, you pass relevant context to the LLM as an additional part of the prompt, but how do you find relevant context? Usually, this data can be automatically retrieved from a database with vector search or dedicated vector databases. Vector databases are especially useful, since they store data in a way, so that it can be queried for similar data quickly. The LLM then generates the output based on both, the query and the retrieved documents.</p><p id="ed54" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Picture this: you have an LLM capable of generating text based on a given prompt. RAG takes this a step further by infusing additional context from external sources, like up-to-date movie data, to enhance the relevance and accuracy of the generated text.</p><p id="a559" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Let‚Äôs break down the key components of RAG:</p><ul class=""><li id="e391" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk"><strong class="nm fr">LLMs</strong>: LLMs serve as the backbone of RAG workflows. These models, trained on vast amounts of text data, possess the ability to understand and generate human-like text.</li><li id="8991" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><strong class="nm fr">Vector Indexes for contextual enrichment</strong>: A crucial aspect of RAG is the use of vector indexes, which store embeddings of text data in a format understandable by LLMs. These indexes allow for efficient retrieval of relevant information during the generation process. In the context of the project this could be a database of movie metadata.</li><li id="fdee" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><strong class="nm fr">Retrieval process</strong>: RAG involves retrieving pertinent documents or information based on the given context or prompt. This retrieved data acts as the additional input for the LLM, supplementing its understanding and enhancing the quality of generated responses. This could be getting all relevant information known and connected to a specific movie.</li><li id="2617" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><strong class="nm fr">Generative Output</strong>: With the combined knowledge from both the LLM and the retrieved context, the system generates text that is not only coherent but also contextually relevant, thanks to the augmented data.</li></ul></div></div><div class="mj"><div class="ab cb"><div class="lm mk ln ml lo mm cf mn cg mo ci bh"><figure class="ms mt mu mv mw mj mx my paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq rh"><img src="../Images/256066ba8bd31d76d97009fb106ed7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*x7D_nLRW2jBuYLplTLMvPA.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">RAG architecture (by author)</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="4807" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">While in the Gemini Movie Detectives project, the prompt is enhanced with external API data from The Movie Database, RAG typically involves the use of vector indexes to streamline this process. It is using much more complex documents as well as a much higher amount of data for enhancement. Thus, these indexes act like signposts, guiding the system to relevant external sources quickly.</p><p id="5ba3" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In this project, it is therefore a mini version of RAG but showing the basic idea at least, demonstrating the power of external data to augment LLM capabilities.</p><p id="1776" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In more general terms, RAG is a very important concept, especially when crafting trivia quizzes or educational games using LLMs like Gemini. This concept can avoid the risk of false positives, asking wrong questions, or misinterpreting answers from the users.</p><p id="950b" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Here are some open-source projects that might be helpful when approaching RAG in one of your projects:</p><ul class=""><li id="d4c1" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk"><a class="af nj" href="https://github.com/neuml/txtai" rel="noopener ugc nofollow" target="_blank"><strong class="nm fr">txtai</strong></a>: All-in-one open-source embeddings database for semantic search, LLM orchestration and language model workflows.</li><li id="17ae" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://python.langchain.com/" rel="noopener ugc nofollow" target="_blank"><strong class="nm fr">LangChain</strong></a>: LangChain is a framework for developing applications powered by large language models (LLMs).</li><li id="dab5" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://github.com/qdrant/qdrant" rel="noopener ugc nofollow" target="_blank"><strong class="nm fr">Qdrant</strong></a>: Vector Search Engine for the next generation of AI applications.</li><li id="344b" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><a class="af nj" href="https://github.com/weaviate/weaviate" rel="noopener ugc nofollow" target="_blank"><strong class="nm fr">Weaviate</strong></a>: Weaviate is a cloud-native, open source vector database that is robust, fast, and scalable.</li></ul><p id="5210" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Of course, with the potential value of this approach for LLM-based applications, there are many more open- and close-source alternatives, but with these, you should be able to get your research on the topic started.</p><h1 id="4cfd" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">Python projects with Poetry</h1><p id="2553" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">Now that the main concepts are clear, let‚Äôs have a closer look how the project was created and how dependencies are managed in general.</p><p id="1ac1" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The three main tasks Poetry can help you with are: Build, Publish and Track. The idea is to have a deterministic way to manage dependencies, to share your project and to track dependency states.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq ri"><img src="../Images/989ff4a10f32ee19b1a7a4fcd1be4171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*87AtYUgSxkZZ4pDO"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Photo by <a class="af nj" href="https://unsplash.com/@kat_von_wood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kat von Wood</a> on <a class="af nj" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d3d4" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Poetry also handles the creation of virtual environments for you. Per default, those are in a centralized folder within your system. However, if you prefer to have the virtual environment of project in the project folder, like I do, it is a simple config change:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="d863" class="rn po fq rk b bg ro rp l rq rr">poetry config virtualenvs.in-project true</span></pre><p id="d215" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">With <code class="cx rs rt ru rk b">poetry new</code> you can then create a new Python project. It will create a virtual environment linking you systems default Python. If you combine this with <a class="af nj" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank">pyenv</a>, you get a flexible way to create projects using specific versions. Alternatively, you can also tell Poetry directly which Python version to use: <code class="cx rs rt ru rk b">poetry env use /full/path/to/python</code>.</p><p id="7478" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Once you have a new project, you can use <code class="cx rs rt ru rk b">poetry add</code> to add dependencies to it.</p><p id="0c4a" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">With this, I created the project for Gemini Movie Detectives:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="13f8" class="rn po fq rk b bg ro rp l rq rr">poetry config virtualenvs.in-project true<br/>poetry new gemini-movie-detectives-api<br/><br/>cd gemini-movie-detectives-api<br/><br/>poetry add 'uvicorn[standard]'<br/>poetry add fastapi<br/>poetry add pydantic-settings<br/>poetry add httpx<br/>poetry add 'google-cloud-aiplatform&gt;=1.38'<br/>poetry add jinja2</span></pre><p id="ae89" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The metadata about your projects, including the dependencies with the respective versions, are stored in the <code class="cx rs rt ru rk b">poetry.toml</code> and <code class="cx rs rt ru rk b">poetry.lock</code> files. I added more dependencies later, which resulted in the following <code class="cx rs rt ru rk b">poetry.toml</code> for the project:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="0d15" class="rn po fq rk b bg ro rp l rq rr">[tool.poetry]<br/>name = "gemini-movie-detectives-api"<br/>version = "0.1.0"<br/>description = "Use Gemini Pro LLM via VertexAI to create an engaging quiz game incorporating TMDB API data"<br/>authors = ["Volker Janz &lt;volker@janz.sh&gt;"]<br/>readme = "README.md"<br/><br/>[tool.poetry.dependencies]<br/>python = "^3.12"<br/>fastapi = "^0.110.1"<br/>uvicorn = {extras = ["standard"], version = "^0.29.0"}<br/>python-dotenv = "^1.0.1"<br/>httpx = "^0.27.0"<br/>pydantic-settings = "^2.2.1"<br/>google-cloud-aiplatform = "&gt;=1.38"<br/>jinja2 = "^3.1.3"<br/>ruff = "^0.3.5"<br/>pre-commit = "^3.7.0"<br/><br/><br/>[build-system]<br/>requires = ["poetry-core"]<br/>build-backend = "poetry.core.masonry.api"</span></pre><h1 id="ca13" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">Create the API with FastAPI</h1><p id="107e" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">FastAPI is a Python framework that allows for rapid API development. Built on open standards, it offers a seamless experience without new syntax to learn. With automatic documentation generation, robust validation, and integrated security, FastAPI streamlines development while ensuring great performance.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq rv"><img src="../Images/65d620d2f1c52e0d1241ecb8e0fbd0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zou7YLbuGrikYviH"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Photo by <a class="af nj" href="https://unsplash.com/@flo_stk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Florian Steciuk</a> on <a class="af nj" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8831" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Implementing the API for the Gemini Movie Detectives projects, I simply started from a Hello World application and extended it from there. Here is how to get started:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="43b3" class="rn po fq rk b bg ro rp l rq rr">from fastapi import FastAPI<br/><br/>app = FastAPI()<br/><br/><br/>@app.get("/")<br/>def read_root():<br/>    return {"Hello": "World"}</span></pre><p id="5faf" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Assuming you also keep the virtual environment within the project folder as <code class="cx rs rt ru rk b">.venv/</code> and use uvicorn, this is how to start the API with the reload feature enabled, in order to test code changes without the need of a restart:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="e0bc" class="rn po fq rk b bg ro rp l rq rr">source .venv/bin/activate<br/>uvicorn gemini_movie_detectives_api.main:app --reload<br/>curl -s localhost:8000 | jq .</span></pre><p id="1479" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">If you have not yet installed <a class="af nj" href="https://jqlang.github.io/jq/" rel="noopener ugc nofollow" target="_blank">jq</a>, I highly recommend doing it now. I might cover this wonderful JSON Swiss Army knife in a future article. This is how the response looks like:</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq rw"><img src="../Images/154da389d897c5178844dd5d3a349398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELE6hciX2bkYS0NIna1tgA.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Hello FastAPI (by author)</figcaption></figure><p id="2b30" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">From here, you can develop your API endpoints as needed. This is how the API endpoint implementation to start a movie quiz in Gemini Movie Detectives looks like for example:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="419a" class="rn po fq rk b bg ro rp l rq rr">@app.post('/quiz')<br/>@rate_limit<br/>@retry(max_retries=settings.quiz_max_retries)<br/>def start_quiz(quiz_config: QuizConfig = QuizConfig()):<br/>    movie = tmdb_client.get_random_movie(<br/>        page_min=_get_page_min(quiz_config.popularity),<br/>        page_max=_get_page_max(quiz_config.popularity),<br/>        vote_avg_min=quiz_config.vote_avg_min,<br/>        vote_count_min=quiz_config.vote_count_min<br/>    )<br/><br/>    if not movie:<br/>        logger.info('could not find movie with quiz config: %s', quiz_config.dict())<br/>        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail='No movie found with given criteria')<br/><br/>    try:<br/>        genres = [genre['name'] for genre in movie['genres']]<br/><br/>        prompt = prompt_generator.generate_question_prompt(<br/>            movie_title=movie['title'],<br/>            language=get_language_by_name(quiz_config.language),<br/>            personality=get_personality_by_name(quiz_config.personality),<br/>            tagline=movie['tagline'],<br/>            overview=movie['overview'],<br/>            genres=', '.join(genres),<br/>            budget=movie['budget'],<br/>            revenue=movie['revenue'],<br/>            average_rating=movie['vote_average'],<br/>            rating_count=movie['vote_count'],<br/>            release_date=movie['release_date'],<br/>            runtime=movie['runtime']<br/>        )<br/><br/>        chat = gemini_client.start_chat()<br/><br/>        logger.debug('starting quiz with generated prompt: %s', prompt)<br/>        gemini_reply = gemini_client.get_chat_response(chat, prompt)<br/>        gemini_question = gemini_client.parse_gemini_question(gemini_reply)<br/><br/>        quiz_id = str(uuid.uuid4())<br/>        session_cache[quiz_id] = SessionData(<br/>            quiz_id=quiz_id,<br/>            chat=chat,<br/>            question=gemini_question,<br/>            movie=movie,<br/>            started_at=datetime.now()<br/>        )<br/><br/>        return StartQuizResponse(quiz_id=quiz_id, question=gemini_question, movie=movie)<br/>    except GoogleAPIError as e:<br/>        raise HTTPException(status_code=status.HTTP_500_INTERNAL_SERVER_ERROR, detail=f'Google API error: {e}')<br/>    except Exception as e:<br/>        raise HTTPException(status_code=status.HTTP_500_INTERNAL_SERVER_ERROR, detail=f'Internal server error: {e}')</span></pre><p id="3b00" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Within this code, you can see already three of the main components of the backend:</p><ul class=""><li id="c484" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk"><code class="cx rs rt ru rk b">tmdb_client</code>: A client I implemented using <code class="cx rs rt ru rk b">httpx</code> to fetch data from The Movie Database (TMDB).</li><li id="9c68" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><code class="cx rs rt ru rk b">prompt_generator</code>: A class that helps to generate modular prompts based on Jinja templates.</li><li id="03c6" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><code class="cx rs rt ru rk b">gemini_client</code>: A client to interact with the Gemini LLM via VertexAI in Google Cloud.</li></ul><p id="a459" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">We will look at these components in detail later, but first some more helpful insights regarding the usage of FastAPI.</p><p id="2d71" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">FastAPI makes it really easy to define the HTTP method and data to be transferred to the backend. For this particular function, I expect a <code class="cx rs rt ru rk b">POST</code> request as this creates a new quiz. This can be done with the <code class="cx rs rt ru rk b">post</code> decorator:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="ac32" class="rn po fq rk b bg ro rp l rq rr">@app.post('/quiz')</span></pre><p id="1a22" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Also, I am expecting some data within the request sent as JSON in the body. In this case, I am expecting an instance of <code class="cx rs rt ru rk b">QuizConfig</code> as JSON. I simply defined <code class="cx rs rt ru rk b">QuizConfig</code> as a subclass of <code class="cx rs rt ru rk b">BaseModel</code> from Pydantic (<em class="pe">will be covered later</em>) and with that, I can pass it in the API function and FastAPI will do the rest:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="b1f4" class="rn po fq rk b bg ro rp l rq rr">class QuizConfig(BaseModel):<br/>    vote_avg_min: float = Field(5.0, ge=0.0, le=9.0)<br/>    vote_count_min: float = Field(1000.0, ge=0.0)<br/>    popularity: int = Field(1, ge=1, le=3)<br/>    personality: str = Personality.DEFAULT.name<br/>    language: str = Language.DEFAULT.name<br/># ...<br/>def start_quiz(quiz_config: QuizConfig = QuizConfig()):</span></pre><p id="1de5" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Furthermore, you might notice two custom decorators:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="5600" class="rn po fq rk b bg ro rp l rq rr">@rate_limit<br/>@retry(max_retries=settings.quiz_max_retries)</span></pre><p id="d6db" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">These I implemented to reduce duplicate code. They wrap the API function to retry the function in case of errors and to introduce a global rate limit of how many movie quizzes can be started per day.</p><p id="e5c0" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">What I also liked personally is the error handling with FastAPI. You can simply raise a <code class="cx rs rt ru rk b">HTTPException</code>, give it the desired status code and the user will then receive a proper response, for example, if no movie could be found with a given configuration:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="03ce" class="rn po fq rk b bg ro rp l rq rr">raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail='No movie found with given criteria')</span></pre><p id="22e9" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">With this, you should have an overview of creating an API like the one for Gemini Movie Detectives with FastAPI. Keep in mind: all code is open-source, so feel free to have a look at the <a class="af nj" href="https://github.com/vojay-dev/gemini-movie-detectives-api" rel="noopener ugc nofollow" target="_blank">API repository on Github</a>.</p><h1 id="103f" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">Data validation and quality with Pydantic</h1><p id="f59d" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">One of the main challenges with todays AI/ML projects is data quality. But that does not only apply to ETL/ELT pipelines, which prepare datasets to be used in model training or prediction, but also to the AI/ML application itself. Using Python for example usually enables Data Engineers and Scientist to get a reasonable result with little code but being (mostly) dynamically typed, Python lacks of data validation when used in a naive way.</p><p id="e445" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">That is why in this project, I combined FastAPI with Pydantic, a powerful data validation library for Python. The goal was to make the API lightweight but strict and strong, when it comes to data quality and validation. Instead of plain dictionaries for example, the Movie Detectives API strictly uses custom classes inherited from the <code class="cx rs rt ru rk b">BaseModel</code> provided by Pydantic. This is the configuration for a quiz for example:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="96cc" class="rn po fq rk b bg ro rp l rq rr">class QuizConfig(BaseModel):<br/>    vote_avg_min: float = Field(5.0, ge=0.0, le=9.0)<br/>    vote_count_min: float = Field(1000.0, ge=0.0)<br/>    popularity: int = Field(1, ge=1, le=3)<br/>    personality: str = Personality.DEFAULT.name<br/>    language: str = Language.DEFAULT.name</span></pre><p id="93a8" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">This example illustrates, how not only correct type is ensured, but also further validation is applied to the actual values.</p><p id="d9e8" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Furthermore, up-to-date Python features, like <code class="cx rs rt ru rk b">StrEnum</code> are used to distinguish certain types, like personalities:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="ad12" class="rn po fq rk b bg ro rp l rq rr">class Personality(StrEnum):<br/>    DEFAULT = 'default.jinja'<br/>    CHRISTMAS = 'christmas.jinja'<br/>    SCIENTIST = 'scientist.jinja'<br/>    DAD = 'dad.jinja'</span></pre><p id="ffed" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Also, duplicate code is avoided by defining custom decorators. For example, the following decorator limits the number of quiz sessions today, to have control over GCP costs:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="1121" class="rn po fq rk b bg ro rp l rq rr">call_count = 0<br/>last_reset_time = datetime.now()<br/><br/><br/>def rate_limit(func: callable) -&gt; callable:<br/>    @wraps(func)<br/>    def wrapper(*args, **kwargs) -&gt; callable:<br/>        global call_count<br/>        global last_reset_time<br/><br/>        # reset call count if the day has changed<br/>        if datetime.now().date() &gt; last_reset_time.date():<br/>            call_count = 0<br/>            last_reset_time = datetime.now()<br/><br/>        if call_count &gt;= settings.quiz_rate_limit:<br/>            raise HTTPException(status_code=status.HTTP_400_BAD_REQUEST, detail='Daily limit reached')<br/><br/>        call_count += 1<br/>        return func(*args, **kwargs)<br/><br/>    return wrapper</span></pre><p id="af93" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">It is then simply applied to the related API function:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="6b9b" class="rn po fq rk b bg ro rp l rq rr">@app.post('/quiz')<br/>@rate_limit<br/>@retry(max_retries=settings.quiz_max_retries)<br/>def start_quiz(quiz_config: QuizConfig = QuizConfig()):</span></pre><p id="63cc" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The combination of up-to-date Python features and libraries, such as FastAPI, Pydantic or Ruff makes the backend less verbose but still very stable and ensures a certain data quality, to ensure the LLM output has the expected quality.</p><h1 id="fe62" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">TMDB client with httpx</h1><p id="6ebf" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">The TMDB Client class is using <a class="af nj" href="https://www.python-httpx.org/" rel="noopener ugc nofollow" target="_blank">httpx</a> to perform requests against the TMDB API.</p><p id="6ae3" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx rs rt ru rk b">httpx</code> is a rising star in the world of Python libraries. While <code class="cx rs rt ru rk b">requests</code> has long been the go-to choice for making HTTP requests, <code class="cx rs rt ru rk b">httpx</code> offers a valid alternative. One of its key strengths is asynchronous functionality. <code class="cx rs rt ru rk b">httpx</code> allows you to write code that can handle multiple requests concurrently, potentially leading to significant performance improvements in applications that deal with a high volume of HTTP interactions. Additionally, <code class="cx rs rt ru rk b">httpx</code> aims for broad compatibility with <code class="cx rs rt ru rk b">requests</code>, making it easier for developers to pick it up.</p><p id="355c" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In case of Gemini Movie Detectives, there are two main requests:</p><ul class=""><li id="ff74" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk"><code class="cx rs rt ru rk b">get_movies</code>: Get a list of random movies based on specific settings, like average number of votes</li><li id="e7eb" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><code class="cx rs rt ru rk b">get_movie_details</code>: Get details for a specific movie to be used in a quiz</li></ul><p id="9561" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In order to reduce the amount of external requests, the latter one uses the <code class="cx rs rt ru rk b">lru_cache</code> decorator, which stands for ‚ÄúLeast Recently Used cache‚Äù. It‚Äôs used to cache the results of function calls so that if the same inputs occur again, the function doesn‚Äôt have to recompute the result. Instead, it returns the cached result, which can significantly improve the performance of the program, especially for functions with expensive computations. In our case, we cache the details for 1024 movies, so if 2 players get the same movie, we do not need to make a request again:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="0843" class="rn po fq rk b bg ro rp l rq rr">@lru_cache(maxsize=1024)<br/>def get_movie_details(self, movie_id: int):<br/>    response = httpx.get(f'https://api.themoviedb.org/3/movie/{movie_id}', headers={<br/>        'Authorization': f'Bearer {self.tmdb_api_key}'<br/>    }, params={<br/>        'language': 'en-US'<br/>    })<br/><br/>    movie = response.json()<br/>    movie['poster_url'] = self.get_poster_url(movie['poster_path'])<br/><br/>    return movie</span></pre><p id="5b12" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Accessing data from The Movie Database (TMDB) is for free for non-commercial usage, you can simply <a class="af nj" href="https://developer.themoviedb.org/docs/getting-started" rel="noopener ugc nofollow" target="_blank">generate an API key</a> and start making requests.</p><h1 id="040c" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">Gemini LLM client with VertexAI</h1><p id="a7e0" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">Before Gemini via VertexAI can be used, you need a Google Cloud project with VertexAI enabled and a Service Account with sufficient access together with its JSON key file.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq rx"><img src="../Images/45142cdb2203e3f44a702c25a5395b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVpF-bZO7VStBgxzwTup3Q.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Create GCP project (by author)</figcaption></figure><p id="39cf" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">After creating a new project, navigate to <em class="pe">APIs &amp; Services</em> ‚Äì&gt; <em class="pe">Enable APIs and service</em> ‚Äì&gt; search for <em class="pe">VertexAI API</em> ‚Äì&gt; <em class="pe">Enable</em>.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq ry"><img src="../Images/67fec39048c6afd73eb41b485431904b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Me1EO1WRFHbLlUUxkdMrww.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Enable VertexAI (by author)</figcaption></figure><p id="bd31" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">To create a Service Account, navigate to <em class="pe">IAM &amp; Admin</em> ‚Äì&gt; <em class="pe">Service Accounts</em> ‚Äì&gt; <em class="pe">Create service account</em>. Choose a proper name and go to the next step.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq ry"><img src="../Images/fc8a142ea8bcd0bd9da74ed24cd518e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWoMPNmw4FqHOPtUG-z27w.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Create Service Account (by author)</figcaption></figure><p id="6991" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Now ensure to assign the account the pre-defined role <em class="pe">Vertex AI User</em>.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq rz"><img src="../Images/3cfa198c9646a12a29bac51e718d2dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zqGJagkCYDVoWBmyU0iIKA.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Assign correct role (by author)</figcaption></figure><p id="7932" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Finally you can generate and download the JSON key file by clicking on the new user ‚Äì&gt; <em class="pe">Keys</em> ‚Äì&gt; <em class="pe">Add Key</em> ‚Äì&gt; <em class="pe">Create new key</em> ‚Äì&gt; <em class="pe">JSON</em>. With this file, you are good to go.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq sa"><img src="../Images/7e3e4f8e583b623603de57bb4a372e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pcKYrVuPw_tclhG_l9AVsg.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Create JSON key file (by author)</figcaption></figure><p id="1e79" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Using Gemini from Google with Python via VertexAI starts by adding the necessary dependency to the project:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="3c8d" class="rn po fq rk b bg ro rp l rq rr">poetry add 'google-cloud-aiplatform&gt;=1.38'</span></pre><p id="79ab" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">With that, you can import and initialize <code class="cx rs rt ru rk b">vertexai</code> with your JSON key file. Also you can load a model, like the newly released Gemini 1.5 Pro model, and start a chat session like this:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="b6c2" class="rn po fq rk b bg ro rp l rq rr">import vertexai<br/>from google.oauth2.service_account import Credentials<br/>from vertexai.generative_models import GenerativeModel<br/><br/>project_id = "my-project-id"<br/>location = "us-central1"<br/><br/>credentials = Credentials.from_service_account_file("credentials.json")<br/>model = "gemini-1.0-pro"<br/><br/>vertexai.init(project=project_id, location=location, credentials=credentials)<br/>model = GenerativeModel(model)<br/><br/>chat_session = model.start_chat()</span></pre><p id="cd8a" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">You can now use <code class="cx rs rt ru rk b">chat.send_message()</code> to send a prompt to the model. However, since you get the response in chunks of data, I recommend using a little helper function, so that you simply get the full response as one String:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="080e" class="rn po fq rk b bg ro rp l rq rr">def get_chat_response(chat: ChatSession, prompt: str) -&gt; str:<br/>    text_response = []<br/>    responses = chat.send_message(prompt, stream=True)<br/>    for chunk in responses:<br/>        text_response.append(chunk.text)<br/>    return ''.join(text_response)</span></pre><p id="47bf" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">A full example can then look like this:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="72f9" class="rn po fq rk b bg ro rp l rq rr">import vertexai<br/>from google.oauth2.service_account import Credentials<br/>from vertexai.generative_models import GenerativeModel, ChatSession<br/><br/>project_id = "my-project-id"<br/>location = "us-central1"<br/><br/>credentials = Credentials.from_service_account_file("credentials.json")<br/>model = "gemini-1.0-pro"<br/><br/>vertexai.init(project=project_id, location=location, credentials=credentials)<br/>model = GenerativeModel(model)<br/><br/>chat_session = model.start_chat()<br/><br/><br/>def get_chat_response(chat: ChatSession, prompt: str) -&gt; str:<br/>    text_response = []<br/>    responses = chat.send_message(prompt, stream=True)<br/>    for chunk in responses:<br/>        text_response.append(chunk.text)<br/>    return ''.join(text_response)<br/><br/><br/>response = get_chat_response(<br/>    chat_session,<br/>    "How to say 'you are awesome' in Spanish?"<br/>)<br/>print(response)</span></pre><p id="266d" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Running this, Gemini gave me the following response:</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq sb"><img src="../Images/cda38295b73a2e42d444a20a344055f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTDo85WW1eBLQKkWzWgY1Q.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">You are awesome (by author)</figcaption></figure><p id="2e2e" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">I agree with Gemini:</p><blockquote class="sc sd se"><p id="ef43" class="nk nl pe nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><strong class="nm fr"><em class="fq">Eres incre√≠ble</em></strong></p></blockquote><p id="e8ab" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Another hint when using this: you can also configure the model generation by passing a configuration to the <code class="cx rs rt ru rk b">generation_config</code> parameter as part of the <code class="cx rs rt ru rk b">send_message</code> function. For example:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="7cdd" class="rn po fq rk b bg ro rp l rq rr">generation_config = {<br/>    'temperature': 0.5<br/>}<br/><br/>responses = chat.send_message(<br/>    prompt,<br/>    generation_config=generation_config,<br/>    stream=True<br/>)</span></pre><p id="05a5" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">I am using this in Gemini Movie Detectives to set the <code class="cx rs rt ru rk b">temperature</code> to 0.5, which gave me best results. In this context <code class="cx rs rt ru rk b">temperature</code> means: how creative are the generated responses by Gemini. The value must be between 0.0 and 1.0, whereas closer to 1.0 means more creativity.</p><p id="964d" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">One of the main challenges apart from sending a prompt and receive the reply from Gemini is to parse the reply in order to extract the relevant information.</p><p id="b831" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">One learning from the project is:</p><blockquote class="sc sd se"><p id="d0e6" class="nk nl pe nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><strong class="nm fr"><em class="fq">Specify a format for Gemini, which does not rely on exact words but uses key symbols to separate information elements</em></strong></p></blockquote><p id="1f92" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">For example, the question prompt for Gemini contains this instruction:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="4a1a" class="rn po fq rk b bg ro rp l rq rr">Your reply must only consist of three lines! You must only reply strictly using the following template for the three lines:<br/>Question: &lt;Your question&gt;<br/>Hint 1: &lt;The first hint to help the participants&gt;<br/>Hint 2: &lt;The second hint to get the title more easily&gt;</span></pre><p id="537b" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The naive approach would be, to parse the answer by looking for a line that starts with <code class="cx rs rt ru rk b">Question:</code>. However, if we use another language, like German, the reply would look like: <code class="cx rs rt ru rk b">Antwort:</code>.</p><p id="4dc9" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Instead, focus on the structure and key symbols. Read the reply like this:</p><ul class=""><li id="8b07" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk">It has 3 lines</li><li id="110f" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk">The first line is the question</li><li id="36cf" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk">Second line the first hint</li><li id="3698" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk">Third line the second hint</li><li id="bd92" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk">Key and value are separated by <code class="cx rs rt ru rk b">:</code></li></ul><p id="111a" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">With this approach, the reply can be parsed language agnostic, and this is my implementation in the actual client:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="3fdd" class="rn po fq rk b bg ro rp l rq rr">@staticmethod<br/>def parse_gemini_question(gemini_reply: str) -&gt; GeminiQuestion:<br/>    result = re.findall(r'[^:]+: ([^\n]+)', gemini_reply, re.MULTILINE)<br/>    if len(result) != 3:<br/>        msg = f'Gemini replied with an unexpected format. Gemini reply: {gemini_reply}'<br/>        logger.warning(msg)<br/>        raise ValueError(msg)<br/><br/>    question = result[0]<br/>    hint1 = result[1]<br/>    hint2 = result[2]<br/><br/>    return GeminiQuestion(question=question, hint1=hint1, hint2=hint2)</span></pre><p id="2d09" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In the future, the parsing of responses will become even easier. During the Google Cloud Next ‚Äô24 conference, Google announced that Gemini 1.5 Pro is now publicly available and with that, they also announced some features including a JSON mode to have responses in JSON format. Checkout <a class="af nj" href="https://developers.googleblog.com/2024/04/gemini-15-pro-in-public-preview-with-new-features.html" rel="noopener ugc nofollow" target="_blank">this article</a> for more details.</p><p id="9ce2" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Apart from that, I wrapped the Gemini client into a configurable class. You can find the <a class="af nj" href="https://github.com/vojay-dev/gemini-movie-detectives-api/blob/main/gemini_movie_detectives_api/gemini.py" rel="noopener ugc nofollow" target="_blank">full implementation open-source on Github</a>.</p><h1 id="2bf6" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">Modular prompt generator with Jinja</h1><p id="5e34" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">The Prompt Generator is a class wich combines and renders Jinja2 template files to create a modular prompt.</p><p id="cd64" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">There are two base templates: one for generating the question and one for evaluating the answer. Apart from that, there is a metadata template to enrich the prompt with up-to-date movie data. Furthermore, there are language and personality templates, organized in separate folders with a template file for each option.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq sf"><img src="../Images/1ca5d024d4a77205380c152045e2a02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7NfGQYBVdEJaj2GR18heYg.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Prompt Generator (by author)</figcaption></figure><p id="3e2d" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Using Jinja2 allows to have advanced features like template inheritance, which is used for the metadata.</p><p id="f505" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">This makes it easy to extend this component, not only with more options for personalities and languages, but also to extract it into its own open-source project to make it available for other Gemini projects.</p><h1 id="f4be" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">Frontend</h1><p id="b1b9" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">The Gemini Movie Detectives frontend is split into four main components and uses <code class="cx rs rt ru rk b">vue-router</code> to navigate between them.</p><p id="ad03" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The Home component simply displays the welcome message.</p><p id="bb37" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The Quiz component displays the quiz itself and talks to the API via <code class="cx rs rt ru rk b">fetch</code>. To create a quiz, it sends a POST request to <code class="cx rs rt ru rk b">api/quiz</code> with the desired settings. The backend is then selecting a random movie based on the user settings, creates the prompt with the modular prompt generator, uses Gemini to generate the question and hints and finally returns everything back to the component so that the quiz can be rendered.</p><p id="1445" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Additionally, each quiz gets a session ID assigned in the backend and is stored in a limited LRU cache.</p><p id="5d8c" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">For debugging purposes, this component fetches data from the <code class="cx rs rt ru rk b">api/sessions</code> endpoint. This returns all <strong class="nm fr">active</strong> sessions from the cache.</p><p id="3001" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">This component displays statistics about the service. However, so far there is only one category of data displayed, which is the quiz limit. To limit the costs for VertexAI and GCP usage in general, there is a daily limit of quiz sessions, which will reset with the first quiz of the next day. Data is retrieved form the <code class="cx rs rt ru rk b">api/limit</code> endpoint.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq sg"><img src="../Images/260549abb360ab6e866e64b9ae1cd851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNJVUPq0NXGh_CjPU1JIgA.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Vue components (by author)</figcaption></figure><h1 id="809a" class="pn po fq bf pp pq rb gq ps pt rc gt pv pw rd py pz qa re qc qd qe rf qg qh qi bk">API examples</h1><p id="8fed" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">Of course using the frontend is a nice way to interact with the application, but it is also possible to just use the API.</p><p id="e432" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The following example shows how to start a quiz via the API using the Santa Claus / Christmas personality:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="9a45" class="rn po fq rk b bg ro rp l rq rr">curl -s -X POST https://movie-detectives.com/api/quiz \<br/>  -H 'Content-Type: application/json' \<br/>  -d '{"vote_avg_min": 5.0, "vote_count_min": 1000.0, "popularity": 3, "personality": "christmas"}' | jq .</span></pre><pre class="sh rj rk rl bp rm bb bk"><span id="023d" class="rn po fq rk b bg ro rp l rq rr">{<br/>  "quiz_id": "e1d298c3-fcb0-4ebe-8836-a22a51f87dc6",<br/>  "question": {<br/>    "question": "Ho ho ho, this movie takes place in a world of dreams, just like the dreams children have on Christmas Eve after seeing Santa Claus! It's about a team who enters people's dreams to steal their secrets. Can you guess the movie? Merry Christmas!",<br/>    "hint1": "The main character is like a skilled elf, sneaking into people's minds instead of houses. ",<br/>    "hint2": "I_c_p_i_n "<br/>  },<br/>  "movie": {...}<br/>}</span></pre></div></div><div class="mj"><div class="ab cb"><div class="lm mk ln ml lo mm cf mn cg mo ci bh"><figure class="ms mt mu mv mw mj mx my paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq ra"><img src="../Images/44ed0a40a77f059c48e616639864e51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*k96CbwHu2DFPsYr8rvpsxg.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Movie Detectives ‚Äî Example: Santa Claus personality (by author)</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="17e4" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">This example shows how to change the language for a quiz:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="681d" class="rn po fq rk b bg ro rp l rq rr">curl -s -X POST https://movie-detectives.com/api/quiz \<br/>  -H 'Content-Type: application/json' \<br/>  -d '{"vote_avg_min": 5.0, "vote_count_min": 1000.0, "popularity": 3, "language": "german"}' | jq .</span></pre><pre class="sh rj rk rl bp rm bb bk"><span id="6000" class="rn po fq rk b bg ro rp l rq rr">{<br/>  "quiz_id": "7f5f8cf5-4ded-42d3-a6f0-976e4f096c0e",<br/>  "question": {<br/>    "question": "Stellt euch vor, es g√§be riesige Monster, die auf der Erde herumtrampeln, als w√§re es ein Spielplatz! Einer ist ein echtes Urviech, eine Art wandelnde Riesenechse mit einem Atem, der so hei√ü ist, dass er euer Toastbrot in Sekundenschnelle r√∂sten k√∂nnte. Der andere ist ein gigantischer Affe, der so stark ist, dass er B√§ume ausrei√üt wie G√§nsebl√ºmchen. Und jetzt ratet mal, was passiert? Die beiden geraten aneinander, wie zwei Kinder, die sich um das letzte St√ºck Kuchen streiten! Wer wird wohl gewinnen, die Riesenechse oder der Superaffe? Das ist die Frage, die sich die ganze Welt stellt! ",<br/>    "hint1": "Der Film spielt in einer Zeit, in der Monster auf der Erde wandeln.",<br/>    "hint2": "G_dz_ll_ vs. K_ng "<br/>  },<br/>  "movie": {...}<br/>}</span></pre><p id="db85" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">And this is how to answer to a quiz via an API call:</p><pre class="ms mt mu mv mw rj rk rl bp rm bb bk"><span id="1308" class="rn po fq rk b bg ro rp l rq rr">curl -s -X POST https://movie-detectives.com/api/quiz/84c19425-c179-4198-9773-a8a1b71c9605/answer \<br/>  -H 'Content-Type: application/json' \<br/>  -d '{"answer": "Greenland"}' | jq .</span></pre><pre class="sh rj rk rl bp rm bb bk"><span id="f3e6" class="rn po fq rk b bg ro rp l rq rr">{<br/>  "quiz_id": "84c19425-c179-4198-9773-a8a1b71c9605",<br/>  "question": {...},<br/>  "movie": {...},<br/>  "user_answer": "Greenland",<br/>  "result": {<br/>    "points": "3",<br/>    "answer": "Congratulations! You got it! Greenland is the movie we were looking for. You're like a human GPS, always finding the right way!"<br/>  }<br/>}</span></pre></div></div></div><div class="ab cb pf pg ph pi" role="separator"><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl pm"/><span class="pj by bm pk pl"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="165c" class="pn po fq bf pp pq pr gq ps pt pu gt pv pw px py pz qa qb qc qd qe qf qg qh qi bk">Conclusion</h1><p id="03f7" class="pw-post-body-paragraph nk nl fq nm b go qj no np gr qk nr ns nt ql nv nw nx qm nz oa ob qn od oe of fj bk">After I finished the basic project, adding more personalities and languages was so easy with the modular prompt approach, that I was impressed by the possibilities this opens up for game design and development. I could change this game from a pure educational game about movies, into a comedy trivia ‚ÄúYou Don‚Äôt Know Jack‚Äù-like game within a minute by adding another personality.</p><p id="2e99" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Also, combining up-to-date Python functionality with validation libraries like Pydantic is very powerful and can be used to ensure good data quality for LLM input.</p><p id="e573" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">And there you have it, folks! You‚Äôre now equipped to craft your own LLM-powered web application.</p><p id="9ee3" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Feeling inspired but need a starting point? Check out the open-source code for the Gemini Movie Detectives project:</p><ul class=""><li id="2786" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qp qq qr bk"><strong class="nm fr">üöÄ Github repository for backend</strong>: <a class="af nj" href="https://github.com/vojay-dev/gemini-movie-detectives-api" rel="noopener ugc nofollow" target="_blank">https://github.com/vojay-dev/gemini-movie-detectives-api</a></li><li id="f192" class="nk nl fq nm b go qs no np gr qt nr ns nt qu nv nw nx qv nz oa ob qw od oe of qp qq qr bk"><strong class="nm fr">üñ•Ô∏è Github repository for frontend</strong>: <a class="af nj" href="https://github.com/vojay-dev/gemini-movie-detectives-ui" rel="noopener ugc nofollow" target="_blank">https://github.com/vojay-dev/gemini-movie-detectives-ui</a></li></ul><p id="31c6" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The future of AI-powered applications is bright, and you‚Äôre holding the paintbrush! Let‚Äôs go make something remarkable. And if you need a break, feel free to try <a class="af nj" href="https://movie-detectives.com/" rel="noopener ugc nofollow" target="_blank">https://movie-detectives.com/</a>.</p></div></div></div></div>    
</body>
</html>