- en: 'Stream Ordering: How And Why a Geo-Scientist Sometimes Needed to Rank Rivers
    on a Map'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/stream-ordering-how-and-why-a-geo-scientist-sometimes-needed-to-rank-rivers-on-a-map-360dce356df5?source=collection_archive---------4-----------------------#2024-02-14](https://towardsdatascience.com/stream-ordering-how-and-why-a-geo-scientist-sometimes-needed-to-rank-rivers-on-a-map-360dce356df5?source=collection_archive---------4-----------------------#2024-02-14)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '**Learn how to obtain Strahler or Shreve order on vector layer**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@mik.sarafanov?source=post_page---byline--360dce356df5--------------------------------)[![Mikhail
    Sarafanov](../Images/88869a3c6f664785c90539dd7aab6d74.png)](https://medium.com/@mik.sarafanov?source=post_page---byline--360dce356df5--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--360dce356df5--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--360dce356df5--------------------------------)
    [Mikhail Sarafanov](https://medium.com/@mik.sarafanov?source=post_page---byline--360dce356df5--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--360dce356df5--------------------------------)
    ·6 min read·Feb 14, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b6d08cd7cac722dd95e78caad843f3e4.png)'
  prefs: []
  type: TYPE_IMG
- en: Preview image (by author)
  prefs: []
  type: TYPE_NORMAL
- en: 'Dear reader, in this article, I would like to dive into one exciting hydrological
    topic. I will start with the picture:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/860173911eb3c2ea27e50b39ae2388a3.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1\. River depiction on the map in two versions (a vs b) (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: 'Disclaimer: this article is written both for geographers who face the problem
    of ranking river vector layer using geoinformation systems (GIS) and for people
    who have sometimes seen “nice rivers” on a map but do not know exactly how they
    are made. We will together sequentially explore how spatial data are represented
    in GIS applications, the way the structure of river networks can be analysed,
    and what visualisation techniques can be used.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Now the question is: Which map looks prettier? — For me, the one on the bottom
    (b).'
  prefs: []
  type: TYPE_NORMAL
- en: 'Actually, the second visualisation is more correct from a common sense point
    of view as well. The more tributaries flowing into the riverbed, the wider and
    fuller the river will be. For example, one of the largest rivers in the world,
    the Nile, at its source (high in the mountains), barely resembles a powerful river
    at its mouth: with each kilometer of the way to the sea, the river absorbs more
    and more tributaries and becomes more and more full-flowing.'
  prefs: []
  type: TYPE_NORMAL
- en: The map shown above (Figure 1b) was prepared on the basis of structural information
    on the river network. In this post I would like to discuss in which ways this
    additional information about rivers can be obtained and what tools can be used
    for this purpose.
  prefs: []
  type: TYPE_NORMAL
- en: '**What is the river**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let’s start by explaining how information about rivers is represented. In cartography
    and geo-sciences, rivers are represented as a linear vector layer: each river
    section is represented as a line with some characteristics. For example, the length
    of the section, its geographic coordinates (geometry of the object), ground type,
    average depth, flow velocity, etc. (Animation 1).'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/55068a35de90356381313aa1ade96dac.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Animation 1\. Linear vector layer for spatial objects. Important note: The
    geometries of individual linear segments can be defined not by two points, but
    by a great number of points (by author)'
  prefs: []
  type: TYPE_NORMAL
- en: So, generally, if you see a river on a map, you see a set of these simple [geometric
    primitives](https://en.wikipedia.org/wiki/Geometric_primitive) (individual rows
    in attrbute table) assembled into one big system. Different colours can be used
    to visualise stored characteristics (Figure 2).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1c5302b9689deb29c28beeec5131de7d.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 2\. Visualisation of the river sections using colours (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: Either programming languages or specialised applications such as [ArcGIS](https://desktop.arcgis.com/en/index.html)
    (proprietary software) or [QGIS](https://qgis.org/en/site/forusers/download.html)
    (open-source) are used for visualisation.
  prefs: []
  type: TYPE_NORMAL
- en: '**River structure**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Such information in the attributes table on rivers can be collected in different
    ways: from remote sensing data, expeditions, gauges, and hydrological stations.
    However, information about the river structure is usually assigned by the specialist
    at the very last moment, when he or she sees on the map what the whole system
    looks like. For example, a researcher can themselves add a new column to the vector
    layer description in which they assign a rank to each river segment (Figure 3).'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/44b3f232e3f8edf3ee8868145d211fa3.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 3\. Adding new field and visualise it using size (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we can see that the picture resembles the map from the beginning of the
    article (Figure 1b). But the question arises: what principle can be used to assign
    such values? — the answer is: a lot. There are several generally accepted systems
    for ranking watercourses in hydrology — see the [Stream order wiki page](https://en.wikipedia.org/wiki/Stream_order)
    or paper [Stream orders](https://link.springer.com/referenceworkentry/10.1007/3-540-31060-6_355).
    Below are a few approaches that I have used myself during the work (Figure 4).'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9f67eff28fcf357c19220ae1925efb8d.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 4\. Several approaches of stream ordering in hydrology (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: '**For what reason**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now it is time to answer the question of the purpose of such ranking systems.
    We can distinguish two reasons:'
  prefs: []
  type: TYPE_NORMAL
- en: Visualisation — using rank as an attribute of the size of a linear object on
    the map, it is possible to create nice maps (Figure 1);
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Further analysis.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Knowledge of river network structure can be combined with other characteristics
    for further analysis, e.g. to identify the following patterns (Figure 5).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/08030d53fc988b7eea3d1fe7e26893f6.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 5\. Flow velocity dependence on Shreve order (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: '**How to assign stream orders using existing tools**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'It is difficult to rank large systems manually, so specialised tools have been
    created for stream ordering. There are two fundamentally different ways:'
  prefs: []
  type: TYPE_NORMAL
- en: Stream ordering using raster data (digital elevation model);
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Stream ordering on vector layers.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Above, we have described how we can assign ranks to vector layers. However,
    spatial data are often represented in another format — as rasters (matrices) (Figure
    6). Digital elevation models (matrices where each pixel has a specific size, such
    as 90 by 90 metres, for example, and an elevation value above the sea level surface
    that is stored in each cell of that matrix) are particularly commonly used.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c0caa3bc20ec5ffa801383943e028a75.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6\. Digital elevation model (DEM) as raster layer. Often used to calculate
    flow direction and then stream order (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: 'The raster layer (digital elevation model — DEM) is used to calculate the flow
    direction matrix and flow accumulation. [The Stream Order (Spatial Analyst) tool
    in ArcGIS](https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/stream-order.htm),
    for example, works according to this principle. In this post I will not describe
    in detail how such an algorithm works, as there are quite nice visualisations
    and descriptions in the official documentation (please check [Flow Direction function](https://pro.arcgis.com/en/pro-app/latest/help/analysis/raster-functions/flow-direction-raster-function.htm)
    page if you want to know more). Below I have listed some of the tools you can
    use to get an Strahler order using raster data:'
  prefs: []
  type: TYPE_NORMAL
- en: 'ArcGIS: [Stream Order from a Digital Elevation Model (DEM) using ArcGIS](https://www.youtube.com/watch?v=NrBUd_cFXxc);'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'QGIS: [Calculate Strahler Stream Orders in QGIS](https://www.youtube.com/watch?v=mZKQI4kkAdQ);'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'GRASS: [r.stream.order tool](https://grass.osgeo.org/grass82/manuals/addons/r.stream.order.html).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: However, this all requires a lot of raster data manipulation. What should you
    do if you already have a vector layer? (This can happen if you have, for example,
    a vector layer of the river network loaded from OpenStreetMap.) I’ll tell you
    next!
  prefs: []
  type: TYPE_NORMAL
- en: '**How to obtain Shreve, Strahler and Topological order on vector layer using
    QGIS**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'During our work four years ago, my colleagues and I came up with an algorithm
    that allows us to calculate **Shreve**, **Strahler**, and **Topological** order
    based only on the vector layer and the final point (the point where the river
    system ends and flows into a lake / sea / ocean). The first version of the algorithm
    is described in my first article on medium: “[The Algorithm for Ranking the Segments
    of the River Network for Geographic Information Analysis Based on Graphs](https://medium.com/swlh/the-algorithm-for-ranking-the-segments-of-the-river-network-for-geographic-information-analysis-b25cffb0d167)”
    (wiping away a tear of nostalgia). Recently, I finally got around to writing some
    clearer [documentation](https://linesranking.readthedocs.io/en/latest/) for it
    and preparing a plugin update.'
  prefs: []
  type: TYPE_NORMAL
- en: In QGIS for stream ordering, the [Lines Ranking](https://plugins.qgis.org/plugins/lines_ranking/)
    plugin can be used. To use, it will require loading a vector layer, reprojecting
    it into the desired metric projection, and assigning a final point (you can just
    click on the map) — the following result will be obtained (Figure 7).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6974d9721fa58198b9fdc5ccf7030004.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7\. Topological stream order for Ob river using vector layer and QGIS
    Lines Ranking Plugin
  prefs: []
  type: TYPE_NORMAL
- en: Now you, dear reader, have dived a little deeper into the topic of stream ordering
    in hydrology and learned how to use different tools to get it from raw data (raster
    or vector). Once there is information about the river’s structure, you can prepare
    beautiful and clear visualisations, or continue the analysis by combining the
    obtained information with other characteristics.
  prefs: []
  type: TYPE_NORMAL
- en: 'Useful links:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Lines ranking plugin documentation: [https://linesranking.readthedocs.io/en/latest](https://linesranking.readthedocs.io/en/latest/?badge=latest)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Repository with source code of the plugin: [https://github.com/ChrisLisbon/QGIS_LinesRankingPlugin](https://github.com/ChrisLisbon/QGIS_LinesRankingPlugin)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The talk on stream ordering in hydrology was presented by [Mikhail Sarafanov](https://github.com/Dreamlone)
  prefs: []
  type: TYPE_NORMAL
