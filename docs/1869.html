<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Better A/B Testing with Survival Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Better A/B Testing with Survival Analysis</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/better-a-b-testing-with-survival-analysis-6205c3a2dc51?source=collection_archive---------12-----------------------#2024-07-31">https://towardsdatascience.com/better-a-b-testing-with-survival-analysis-6205c3a2dc51?source=collection_archive---------12-----------------------#2024-07-31</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="3c7f" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx"><em class="hd">When running experiments â€” donâ€™t forget to bring your survival kit</em></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://iyarlin.medium.com/?source=post_page---byline--6205c3a2dc51--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Iyar Lin" class="l ep by dd de cx" src="../Images/8d27b185b273b7ea035250cdbd3eddbf.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*3hRhNc-LappEySR6ROTLGQ.jpeg"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--6205c3a2dc51--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://iyarlin.medium.com/?source=post_page---byline--6205c3a2dc51--------------------------------" rel="noopener follow">Iyar Lin</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">Â·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--6205c3a2dc51--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">Â·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">5 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">Â·</span></span></div><span data-testid="storyPublishDate">Jul 31, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk lb lc ab q ee ld le" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap ie li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/56414e53785ef2532485fc1ca1f6cf4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*e4GbUIONUE5ZofYZ"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author, using DALL-E 3</figcaption></figure><p id="af33" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Iâ€™ve already made the case in several blog posts (<a class="af ny" href="https://iyarlin.github.io/2022/06/08/better_churn_modeling/" rel="noopener ugc nofollow" target="_blank">Here</a>, <a class="af ny" href="https://iyarlin.github.io/2022/10/31/better_churn_modeling_part_2/" rel="noopener ugc nofollow" target="_blank">here</a> and <a class="af ny" href="https://www.linkedin.com/pulse/better-churn-prediction-part-3-iyar-lin-ov5af/" rel="noopener ugc nofollow" target="_blank">here</a>) that using survival analysis can improve churn prediction.</p><p id="dc4e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In this blog post Iâ€™ll show another use case where survival analysis can improve on common practices: A/B testing!</p><h1 id="9b11" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">The problems with common A/B testing practices</h1><p id="72a1" class="pw-post-body-paragraph nc nd fq ne b go ov ng nh gr ow nj nk nl ox nn no np oy nr ns nt oz nv nw nx fj bk">Usually when running an A/B test analysts assign users randomly to variants over time and measure conversion rate as the ratio between the number of conversions and the number of users in each variant. Users who just entered the test and those who are in the test for 2 weeks get the same weight.</p><p id="1f41" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This can be enough for cases where a conversion either happens or not within a short time frame after assignment to a variant (e.g. Finishing an on-boarding flow).</p><p id="6ab2" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">There are however many instances where conversions are spread over a longer time frame. One example would be first order after visiting a site landing page. Such conversions may happen within minutes, but a large portion could still happen days after the first visit.</p><p id="0c45" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In such cases the business KPIs are usually â€œboundedâ€ to a certain period â€” e.g. â€œconversion within 7 daysâ€ or â€œchurn within 1 monthâ€.</p><p id="b4aa" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In those instances measuring conversions without considering their timing has 2 major flaws:</p><ol class=""><li id="14ba" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pa pb pc bk">It makes the statistic weâ€™re measuring unintelligible â€” Average conversions at any point in time does not translate to any bounded metric. In fact as the test keeps running â€” conversion rates will increase just because users get more time to convert. The experiment results will be thus hard to relate to the business KPIs.</li><li id="1f76" class="nc nd fq ne b go pd ng nh gr pe nj nk nl pf nn no np pg nr ns nt ph nv nw nx pa pb pc bk">It discards the timing information which could lead to reduced power compared with methods that do take conversion timing into account.</li></ol><p id="9f5c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">To demonstrate point #2 weâ€™ll run a small simulation study</p><p id="6c44" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Weâ€™ll have users join the experiment randomly over a 30 day period. Usersâ€™ time to convert will be simulated from a Weibull distribution with scale ğœ=30,000, ğ›¼_ctrl=0.18 for the control group and ğ›¼_trt=0.157 for the treatment group.</p><p id="67d1" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Below are the corresponding survival curves:</p><pre class="mm mn mo mp mq pi pj pk bp pl bb bk"><span id="dce5" class="pm oa fq pj b bg pn po l pp pq">alpha_ctrl &lt;- 0.18 <br/>alpha_trt &lt;- 0.157 <br/>sigma &lt;- 30000 <br/>conv_7d_ctrl &lt;- format_pct(pweibull(7, alpha_ctrl, sigma)) <br/>conv_7d_trt &lt;- format_pct(pweibull(7, alpha_trt, sigma)) <br/>t &lt;- seq(0, 7, 0.1) <br/>surv_ctrl &lt;- 1 - pweibull(t, alpha_ctrl, sigma) <br/>surv_trt &lt;- 1 - pweibull(t, alpha_trt, sigma) <br/>plot(t, surv_trt, type = "line", col = "red", ylab = "S(t)", xlab = "t (days)",<br/>  ylim = c(0.7, 1)) lines(t, surv_ctrl, col = "black") <br/>legend("topright", col = c("black", "red"), <br/>  legend = c("Control", "Treatment"), lty = 1, title = "Variant" )</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pr"><img src="../Images/5692debc5db3f2bcc1739bf3a5e29f62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*clmHjcu9vShVBcEv"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><p id="233d" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Assuming weâ€™re interested with conversions within 7 days, the true (unknown) conversion rate in the control group is 19.9% and in the treatment is 23.6%.</p><p id="2cc9" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Below is the function which will generate the simulation data:</p><pre class="mm mn mo mp mq pi pj pk bp pl bb bk"><span id="76f2" class="pm oa fq pj b bg pn po l pp pq">n &lt;- 2000 <br/>test_duration &lt;- 30 <br/>gen_surv_data &lt;- function(m, alpha){ <br/>  set.seed(m) <br/>  tstart &lt;- runif(n, 0, test_duration) <br/>  tconvert &lt;- rweibull(n, alpha, sigma) <br/>  status &lt;- as.integer(tstart + tconvert &lt; test_duration) <br/>  tstatus &lt;- ifelse(status == 0, test_duration - tstart, tconvert) <br/>  return(data.frame(tstatus=tstatus, status=status)) <br/>}</span></pre><p id="779b" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">To demonstrate the benefits of using survival in A/B testing weâ€™ll compare the power of 3 test statistics:</p><ol class=""><li id="7527" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pa pb pc bk">T-test on conversions (the common procedure)</li><li id="3852" class="nc nd fq ne b go pd ng nh gr pe nj nk nl pf nn no np pg nr ns nt ph nv nw nx pa pb pc bk">T-test on 7 day conversion (estimated using a Kaplan-Meier curve)</li><li id="8b22" class="nc nd fq ne b go pd ng nh gr pe nj nk nl pf nn no np pg nr ns nt ph nv nw nx pa pb pc bk">Peto &amp; Peto modification of the Gehan-Wilcoxon test</li></ol><p id="9c9d" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Below is the code that implements the above:</p><pre class="mm mn mo mp mq pi pj pk bp pl bb bk"><span id="7769" class="pm oa fq pj b bg pn po l pp pq">run_simulation &lt;- function(m, alpha1, alpha2){ <br/>  data_1 &lt;- gen_surv_data(m, alpha1) <br/>  data_2 &lt;- gen_surv_data(m+1, alpha2) <br/>  # T-test on conversions (the common procedure): <br/>  p1_hat &lt;- mean(data_1$status) <br/>  p1_var &lt;- p1_hat*(1-p1_hat)/length(data_1$status) <br/>  p2_hat &lt;- mean(data_2$status) <br/>  p2_var &lt;- p2_hat*(1-p2_hat)/length(data_2$status) <br/>  stat &lt;- abs(p2_hat - p1_hat)/sqrt(p1_var + p2_var) <br/>  ans1 &lt;- pnorm(stat, lower.tail = F)*2 <br/>  # T-test on 7 day conversion (estimated using a Kaplan-Meier curve): <br/>  data_1$variant &lt;- "control" <br/>  data_2$variant &lt;- "treatment" <br/>  surv_data &lt;- rbind(data_1, data_2) <br/>  surv_model &lt;- summary(survfit(Surv(tstatus, status)~variant, <br/>    data = surv_data), times = 7, extend = T) <br/>  p1_hat &lt;- 1 - surv_model$surv[1] <br/>  p1_var &lt;- surv_model$std.err[1]^2 <br/>  p2_hat &lt;- 1 - surv_model$surv[2] <br/>  p2_var &lt;- surv_model$std.err[2]^2 <br/>  stat &lt;- abs(p2_hat - p1_hat)/sqrt(p1_var + p2_var) <br/>  ans2 &lt;- pnorm(stat, lower.tail = F)*2 <br/>  # Peto &amp; Peto modification of the Gehan-Wilcoxon test: <br/>  mgw_test &lt;- survdiff(Surv(tstatus, status)~variant, data = surv_data, <br/>    rho = 1) <br/>  ans3 &lt;- mgw_test$pvalue <br/>  return(data.frame(<br/>    `T-test conversions` = ans1, <br/>    `T-test KM 7 day conversion` = ans2, <br/>    `Modified Gehan-Wilcoxon test` = ans3, check.names = F)) <br/>}</span></pre><p id="d7c1" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Before measuring power letâ€™s verify our statistics satisfy the desired false positive rate ğ›¼=0.05 (5%) when both variants have the same conversion rates:</p><pre class="mm mn mo mp mq pi pj pk bp pl bb bk"><span id="02dc" class="pm oa fq pj b bg pn po l pp pq">alpha &lt;- 0.05 <br/>M &lt;- 500 <br/>res &lt;- Reduce("rbind", lapply(1:M, function(m) <br/>  run_simulation(m, alpha_ctrl, alpha_ctrl))) <br/>res &lt;- data.frame(Statistic = names(res), <br/>  `False positive rate` = format_pct(sapply(res, function(x) mean(x&lt;=alpha))), <br/>  check.names = F, row.names = NULL) <br/>knitr::kable(res, align = "c")</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ps"><img src="../Images/3a3df2b9074fe78e55a53f0f51b9f3fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rENSf8znizYYMmhi"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><p id="0eac" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Next, letâ€™s examine power:</p><pre class="mm mn mo mp mq pi pj pk bp pl bb bk"><span id="22aa" class="pm oa fq pj b bg pn po l pp pq">M &lt;- 2000 <br/>res &lt;- Reduce("rbind", lapply(1:M, function(m) <br/>  run_simulation(m, alpha_ctrl, alpha_trt))) <br/>res &lt;- data.frame(<br/>  Statistic = names(res), <br/>  Power = sapply(res, function(x) mean(x&lt;=alpha)), <br/>  check.names = F, row.names = NULL) <br/>uplift_logrank &lt;- format_pct((res[3,2] - res[1,2])/res[1,2]) <br/>uplift_km &lt;- format_pct((res[2,2] - res[1,2])/res[1,2]) <br/>res$Power &lt;- format_pct(res$Power) knitr::kable(res, align = "c")</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pt"><img src="../Images/c43d8ca5d22569d3687844f0b084d3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uts4YQ3xi_9AMQ8v"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><p id="5c40" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">While the T-test on KM 7 day conversion relates better to business KPIs than the T-test on conversions (the common procedure), it is only marginally more powerful.</p><p id="a55d" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The modified Gehan-Wilcoxon statistic on the other hand yields a substantial uplift in power, while only weakly relating to the business KPIs like the regular conversions T-test.</p><p id="f453" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">It should be noted that the power gains vary somewhat according to the point compared on the survival curve, the actual survival curve shape, experiment duration etc.</p><p id="67f4" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In a future post I hope to further explore this topic over a wider set of scenarios and test statistics (The R <a class="af ny" href="https://cran.r-project.org/web/packages/ComparisonSurv/index.html?trk=article-ssr-frontend-pulse_little-text-block" rel="noopener ugc nofollow" target="_blank">ComparisonSurv</a> package looks promising).</p><p id="a329" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">When doing A/B testing in scenarios where time to convert varies â€” itâ€™s often useful to apply survival analysis to take advantage of the time dimension. Either compare a point of interest on the survival curve to make the result relate directly to the business KPIs, or use the modified Gehan-Wilcoxon statistic statistic for improved power.</p></div></div></div><div class="ab cb pu pv pw px" role="separator"><span class="py by bm pz qa qb"/><span class="py by bm pz qa qb"/><span class="py by bm pz qa"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="c6bd" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><em class="qc">Originally published at </em><a class="af ny" href="https://www.linkedin.com/pulse/better-ab-testing-survival-analysis-iyar-lin-o5cpf/?trackingId=fH3Lxwa%2FSEGg4WIp6DBomQ%3D%3D" rel="noopener ugc nofollow" target="_blank"><em class="qc">https://www.linkedin.com</em></a><em class="qc">.</em></p></div></div></div></div>    
</body>
</html>