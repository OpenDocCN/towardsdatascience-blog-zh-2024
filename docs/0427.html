<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Using LangChain ReAct Agents for Answering Multi-hop Questions in RAG Systems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Using LangChain ReAct Agents for Answering Multi-hop Questions in RAG Systems</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-langchain-react-agents-for-answering-multi-hop-questions-in-rag-systems-893208c1847e?source=collection_archive---------0-----------------------#2024-02-15">https://towardsdatascience.com/using-langchain-react-agents-for-answering-multi-hop-questions-in-rag-systems-893208c1847e?source=collection_archive---------0-----------------------#2024-02-15</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="45f9" class="fo fp fq bf b dy fr fs ft fu fv fw dx fx" aria-label="kicker paragraph">#LLM FOR BEGINNERS</h2><div/><div><h2 id="a7bf" class="pw-subtitle-paragraph gs fz fq bf b gt gu gv gw gx gy gz ha hb hc hd he hf hg hh cq dx">Useful when answering complex queries on internal documents in a step-by-step manner with ReAct and Open AI Tools agents.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hi hj hk hl hm ab"><div><div class="ab hn"><div><div class="bm" aria-hidden="false"><a href="https://varshitasher.medium.com/?source=post_page---byline--893208c1847e--------------------------------" rel="noopener follow"><div class="l ho hp by hq hr"><div class="l ed"><img alt="Dr. Varshita Sher" class="l ep by dd de cx" src="../Images/a3f2e9bf1dc1d8cbe018e54f9341f608.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*ImYwhIFTYTspDAzmdk7i6w.jpeg"/><div class="hs by l dd de em n ht eo"/></div></div></a></div></div><div class="hu ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--893208c1847e--------------------------------" rel="noopener follow"><div class="l hv hw by hq hx"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hy cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hs by l br hy em n ht eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hz ab q"><div class="ab q ia"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ib ic bk"><a class="af ag ah ai aj ak al am an ao ap aq ar id" data-testid="authorName" href="https://varshitasher.medium.com/?source=post_page---byline--893208c1847e--------------------------------" rel="noopener follow">Dr. Varshita Sher</a></p></div></div></div><span class="ie if" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b ib ic dx"><button class="ig ih ah ai aj ak al am an ao ap aq ar ii ij ik" disabled="">Follow</button></p></div></div></span></div></div><div class="l il"><span class="bf b bg z dx"><div class="ab cn im in io"><div class="ip iq ab"><div class="bf b bg z dx ab ir"><span class="is l il">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar id ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--893208c1847e--------------------------------" rel="noopener follow"><p class="bf b bg z it iu iv iw ix iy iz ja bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ie if" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">43 min read</span><div class="jb jc l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Feb 15, 2024</span></div></span></div></span></div></div></div><div class="ab cp jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js"><div class="h k w ea eb q"><div class="ki l"><div class="ab q kj kk"><div class="pw-multi-vote-icon ed is kl km kn"><div class=""><div class="ko kp kq kr ks kt ku am kv kw kx kn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ky kz la lb lc ld le"><p class="bf b dy z dx"><span class="kp">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao ko lh li ab q ee lj lk" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lg"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lf lg">8</span></p></button></div></div></div><div class="ab q jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh"><div class="ll k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lm an ao ap ii ln lo lp" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lq cn"><div class="l ae"><div class="ab cb"><div class="lr ls lt lu lv lw ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lm an ao ap ii lx ly lk lz ma mb mc md s me mf mg mh mi mj mk u ml mm mn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp mq"><img src="../Images/f9c86e008b8faef32897c564b10f8949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BBcEbwJk-tDGWtYIjvk_jg.png"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Image generated by Author (prompt engineering credits: Fabian Nitka)</figcaption></figure><h1 id="076b" class="nh ni fq bf nj nk nl gv nm nn no gy np nq nr ns nt nu nv nw nx ny nz oa ob oc bk">Motivation</h1><p id="1c6f" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">The basic RAG chatbots I have built in the past using standard LangChain components such as vectorstore, retrievers, etc have worked out well for me. Depending on the internal dataset I feed in, they are capable of handling humble questions such as “What is the parental leave policy in India” (source dataset: HR policy documents), “What are the main concerns regarding the flavor of our product” (source dataset: social media/Tweets), “What are the themes in Monet paintings” (source dataset: Art Journals), etc. More recently, the complexity of queries being fed to it has increased, for instance, “Has there been an increase in the concerns regarding flavor in the past 1 month”. Unless there is a specific section in the internal documents that specifically talks about the comparison, it is highly unlikely the chatbot would display the correct answer. The reason is — the correct answer requires the following steps to be planned/executed systematically:</p><ul class=""><li id="60a2" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk">STEP 1: calculate the <em class="ph">start</em> date and <em class="ph">end</em> date based on “past 1 month” and today’s date</li><li id="8d8b" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">STEP 2: fetch the queries mentioning flavor issues for the <em class="ph">start</em> date</li><li id="29f5" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">STEP 3: count the queries from Step 2</li><li id="f3f5" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">STEP 4: fetch the queries mentioning flavor issues for the <em class="ph">end</em> date</li><li id="aa83" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">STEP 5: count the queries from Step 4</li><li id="e2aa" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">STEP 6: calculate the percentage increase/decrease using counts from Step 3 and Step 5.</li></ul><p id="f351" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Luckily for us, LLMs are very good at such <em class="ph">planning</em>! And Langchain agents are the ones orchestrating this planning for us.</p><blockquote class="pn po pp"><p id="0205" class="od oe ph of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">The core idea of agents is to use a language model to choose a sequence of actions to take. In agents, a language model is used as a reasoning engine to determine which actions to take and in which order. [<a class="af pq" href="https://python.langchain.com/docs/modules/agents" rel="noopener ugc nofollow" target="_blank">Source</a>]</p></blockquote><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp pr"><img src="../Images/991e5a86b326cc3876bedba860b192a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R14cSTac-ZpJwnrNr38bBg.png"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Agent answering a multi-hop question in a step-by-step manner. (Image by Author)</figcaption></figure><p id="fbc6" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Agents typically require a set of tools to be specified at the time of their instantiation. For instance, to solve the aforementioned multi-hop question, we should define four tools:</p><ul class=""><li id="84e0" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk"><code class="cx ps pt pu pv b">Tool_Date</code>: A Python function that takes as input a relative time frame (such as the <em class="ph">past 6 months</em>) and calculates the start date by subtracting the time frame from today’s date (for Step#1)</li><li id="a70f" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk"><code class="cx ps pt pu pv b">Tool_Search</code>: A search engine that can take as input a search term and return the list of relevant documents (for Step#2 and Step#4)</li><li id="ea36" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk"><code class="cx ps pt pu pv b">Tool_Length</code>: A Python function that takes as input a list and returns the length of that list (for Step#3 and Step#5)</li><li id="9ce2" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk"><code class="cx ps pt pu pv b">Tool_PercCalculator</code>: A Python function that takes as input two numbers and returns the percent change calculation (for Step#6)</li></ul><p id="4505" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Generally speaking — be mindful of the choice of tools you provide an agent, as these are the <em class="ph">only</em> tools that the agent will use to answer each of the intermediate steps. If it finds a relevant tool — great, it will use it to get the answer. If it doesn’t, it will usually iterate a few times (i.e. trying one of the other available tools or its own logical reasoning) and finally return a sub-optimal answer.</p><p id="63eb" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Let’s begin by jumping straight into code, if you’d like to follow along, here’s the <a class="af pq" href="https://github.com/V-Sher/LangChain_ReAct_Demo" rel="noopener ugc nofollow" target="_blank">GitHub repo</a>.</p><h2 id="4328" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Dataset</h2><p id="a122" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">While I was tempted to use the ever-popular <code class="cx ps pt pu pv b"><a class="af pq" href="https://github.com/hwchase17/chat-your-data/blob/master/state_of_the_union.txt" rel="noopener ugc nofollow" target="_blank">state_of_the_union.txt</a></code> for this demo, I couldn’t come up with complex questions to ask that document. Hence, I have created a dummy HR document (using ChatGPT) for a fictitious company called GlobalCorp. You can view <code class="cx ps pt pu pv b">globalcorp_hr_policy.txt</code> <a class="af pq" href="https://github.com/V-Sher/LangChain_ReAct_Demo/blob/main/data/globalcorp_hr_policy.txt" rel="noopener ugc nofollow" target="_blank">here</a>. The main highlights of the file include (a) country-specific annual budgets (b) in different currencies and (c) country-specific leave policies.</p><h2 id="57b1" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">LLM and Embedding models</h2><p id="d4e8" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">We will be using Azure Open AI models (<code class="cx ps pt pu pv b">gpt3.5 turbo</code> , <code class="cx ps pt pu pv b">gpt-4-turbo</code> and <code class="cx ps pt pu pv b">ada-embeddings</code>) for this tutorial.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="7e36" class="qp ni fq pv b bg qq qr l qs qt">OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")<br/>OPENAI_DEPLOYMENT_NAME = "gpt-35-turbo-16k"<br/>OPENAI_DEPLOYMENT_ENDPOINT = "https://&lt;???&gt;.openai.azure.com/"<br/>OPENAI_DEPLOYMENT_VERSION = "2023-12-01-preview"<br/>OPENAI_MODEL_NAME = "gpt-35-turbo-16k"<br/><br/>OPENAI_ADA_EMBEDDING_DEPLOYMENT_NAME = "text-embedding-ada"<br/>OPENAI_ADA_EMBEDDING_MODEL_NAME = "text-embedding-ada-002"<br/><br/>llm = AzureChatOpenAI(<br/>    deployment_name=OPENAI_DEPLOYMENT_NAME,<br/>    model_name=OPENAI_MODEL_NAME,<br/>    openai_api_base=OPENAI_DEPLOYMENT_ENDPOINT,<br/>    openai_api_version=OPENAI_DEPLOYMENT_VERSION,<br/>    openai_api_key=OPENAI_API_KEY,<br/>    openai_api_type="azure",<br/>    temperature=0.1,<br/>)<br/><br/>embeddings = OpenAIEmbeddings(<br/>    deployment=OPENAI_ADA_EMBEDDING_DEPLOYMENT_NAME,<br/>    model=OPENAI_ADA_EMBEDDING_MODEL_NAME,<br/>    openai_api_base=OPENAI_DEPLOYMENT_ENDPOINT,<br/>    openai_api_type="azure",<br/>    chunk_size=1,<br/>    openai_api_key=OPENAI_API_KEY,<br/>    openai_api_version=OPENAI_DEPLOYMENT_VERSION,<br/>)</span></pre><p id="9dc7" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Disclaimer — I will be using the terms “RAG tool”, “Q&amp;A system”, and “QnA tool” interchangeably. For this tutorial, all refer to a tool that is capable of looking up a bunch of documents to answer a specific user query but does </em><strong class="of ga"><em class="ph">not</em></strong><em class="ph"> have any conversational memory i.e. you won’t be able to ask follow-up questions in a chat-like manner. However, that can be easily implemented in LangChain and will likely be covered in some future article. The focus here is just to get the multi-hop questions working.</em></p><h2 id="2232" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">RAG-based QnA</h2><p id="ca80" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">Let’s go ahead and build a standard Q&amp;A system using this data.</p><p id="18b8" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">We will be using <code class="cx ps pt pu pv b">TextLoader</code> for loading the dummy HR document.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="c7dd" class="qp ni fq pv b bg qq qr l qs qt"># Loading the document<br/>from langchain.document_loaders import TextLoader<br/><br/>loader = TextLoader("../data/globalcorp_hr_policy.txt")<br/>documents = loader.load()</span></pre><p id="23c0" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><code class="cx ps pt pu pv b">Chroma</code> as the vectorstore (for storing the document embeddings),</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="48e5" class="qp ni fq pv b bg qq qr l qs qt">persist_directory = "local_vectorstore"<br/>collection_name = "hrpolicy"<br/>PROJECT_ROOT = "...." #insert your project root directory name here<br/><br/>vectorstore = Chroma(<br/>    persist_directory=os.path.join(PROJECT_ROOT, "data", persist_directory),<br/>    collection_name=collection_name,<br/>    embedding_function=embeddings,<br/>)</span></pre><p id="4678" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><code class="cx ps pt pu pv b">LocalFileStore</code> as the docstore (for storing the parent documents),</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="7aff" class="qp ni fq pv b bg qq qr l qs qt">from langchain.storage._lc_store import create_kv_docstore<br/><br/># The storage layer for the parent documents<br/>local_store = "local_docstore"<br/>local_store = LocalFileStore(os.path.join(PROJECT_ROOT, "data", local_store))<br/>docstore = create_kv_docstore(local_store)</span></pre><p id="e623" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">PDR (<code class="cx ps pt pu pv b">parentdocumentretriever</code>) as the <code class="cx ps pt pu pv b">retriever</code> (for retrieving relevant data from the index).</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="bfb9" class="qp ni fq pv b bg qq qr l qs qt"># This text splitter is used to create the child documents<br/>parent_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=20)<br/>child_splitter = RecursiveCharacterTextSplitter(chunk_size=200, chunk_overlap=20)<br/><br/>retriever = ParentDocumentRetriever(<br/>    vectorstore=vectorstore,<br/>    docstore=docstore,<br/>    child_splitter=child_splitter,<br/>    parent_splitter=parent_splitter,<br/>)</span></pre><p id="e3dc" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">With all the setup done, we are ready to add our document to the retriever using <code class="cx ps pt pu pv b">add_documents()</code> command. Additionally, I also recommend persisting the vectorstore using <code class="cx ps pt pu pv b">.persist()</code> command (i.e. storing the contents of the vectorstore to your disk so you don’t have to recompute the embeddings again once you terminate your current session)</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="846a" class="qp ni fq pv b bg qq qr l qs qt"># run only once<br/># vectorstore.persist()<br/># retriever.add_documents(documents, ids=None)</span></pre><p id="779a" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Once you run these commands, you should see two folders — <code class="cx ps pt pu pv b">local_docstore</code> and <code class="cx ps pt pu pv b">local_vectorstore</code> — created in your working session. Feel free to check the contents for each.</p><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp qu"><img src="../Images/9eff59ac6709193585ebaefdf989691e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJZYlI_HG-2IhZbuLmSK7Q.png"/></div></div></figure><p id="e2d3" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Quick sanity check to see if the <code class="cx ps pt pu pv b">retriever</code> is set correctly:</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="c400" class="qp ni fq pv b bg qq qr l qs qt">retriever.get_relevant_documents("communication initiatives?")<br/><br/>## OUTPUT ##<br/>[Document(page_content='**Health and Safety:**\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\n\n**Communication:**\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\n\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\n\n1.\tRecruitment and Selection\n1.\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/> Document(page_content='•\ttwo satisfactory references;\n•\tconfirmation of the right to work in this country (if appropriate)\n•\tCriminal Records Disclosure (if appropriate).\n6.\tProbationary Period\n\t\n6.1\tAll appointments into the Company will be made subject to a probationary period of six calendar months. After three months a review meeting will take place between the post holder and their line manager to discuss progress. At the end of the probationary period, and subject to a satisfactory report by the appropriate head of section or line manager, employees will be notified in writing that they have successfully completed their probationary period. The probationary period can be extended by a further 3 months should the individuals line manager consider this appropriate.\n7.\tRecruitment Monitoring', metadata={'source': '../data/globalcorp_hr_policy.txt'})]</span></pre><p id="3761" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Finally, we’ll build the <code class="cx ps pt pu pv b">RetrievalQA</code> chain to do question-answering using all the aforementioned components.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="4335" class="qp ni fq pv b bg qq qr l qs qt">from langchain.chains import RetrievalQA<br/><br/>qa = RetrievalQA.from_chain_type(<br/>    llm=llm,<br/>    chain_type="stuff",<br/>    retriever=retriever,<br/>    return_source_documents=True,<br/>)</span></pre><h2 id="fb37" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Asking standard questions</h2><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="5c55" class="qp ni fq pv b bg qq qr l qs qt">qa({"query": "What is the allocated budget for communication initiatives?"})<br/><br/>## OUTPUT ##<br/>{'query': 'What is the allocated budget for communication initiatives?',<br/> 'result': 'The allocated budget for communication initiatives is $500,000 in the United States, €250,000 in Germany, and ¥25 million in Japan.',<br/> 'source_documents': [Document(page_content='**Health and Safety:**\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\n\n**Communication:**\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\n\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\n\n1.\tRecruitment and Selection\n1.\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}</span></pre><pre class="qv qm pv qn bp qo bb bk"><span id="0b04" class="qp ni fq pv b bg qq qr l qs qt">qa({"query": "What is the probationary period?"})<br/><br/>## OUTPUT ##<br/>{'query': 'What is the probationary period?',<br/> 'result': "The probationary period is a period of six calendar months during which an employee's performance and suitability for the job are assessed. At the end of the probationary period, if the employee's performance is satisfactory, they will be notified in writing that they have successfully completed their probationary period. The probationary period can be extended by a further 3 months if the employee's line manager deems it necessary.",<br/> 'source_documents': [Document(page_content='•\ttwo satisfactory references;\n•\tconfirmation of the right to work in this country (if appropriate)\n•\tCriminal Records Disclosure (if appropriate).\n6.\tProbationary Period\n\t\n6.1\tAll appointments into the Company will be made subject to a probationary period of six calendar months. After three months a review meeting will take place between the post holder and their line manager to discuss progress. At the end of the probationary period, and subject to a satisfactory report by the appropriate head of section or line manager, employees will be notified in writing that they have successfully completed their probationary period. The probationary period can be extended by a further 3 months should the individuals line manager consider this appropriate.\n7.\tRecruitment Monitoring', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}</span></pre><pre class="qv qm pv qn bp qo bb bk"><span id="6eed" class="qp ni fq pv b bg qq qr l qs qt">qa({"query": "What is the difference in the number of work hours in Germany vs. United States?"})<br/><br/>## OUTPUT ##<br/>{'query': 'What is the difference in the number of work hours in Germany vs. United States?',<br/> 'result': 'In Germany, the standard workweek is 38 hours (Monday to Friday, 8 AM to 5 PM), while in the United States, employees adhere to a standard 40-hour workweek (Monday to Friday, 9 AM to 5 PM). So, the difference in the number of work hours between Germany and the United States is 2 hours per week.',<br/> 'source_documents': [Document(page_content='**GlobalCorp Human Resources Policy**\n\nWelcome to GlobalCorp, where our Human Resources Policy is designed to provide a comprehensive framework for employees across our offices in the United States, Germany, and Japan. We operate under an at-will employment relationship, and any contractual agreements should be documented in writing.\n\nAt the core of our culture is a commitment to professionalism and ethical conduct. Clear and respectful communication is highly valued, and a business casual dress code is encouraged.\n\n**Work Hours:**\nEmployees in the United States adhere to a standard 40-hour workweek (Monday to Friday, 9 AM to 5 PM). In Germany, the standard workweek is 38 hours (Monday to Friday, 8 AM to 5 PM), and in Japan, employees work 40 hours per week (Monday to Friday, 9 AM to 6 PM). Punctuality is paramount, and employees are expected to arrive on time. Time-off requests follow country-specific guidelines.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}</span></pre><p id="7f76" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Having manually reviewed the policy document, it is safe to say the answers make sense.</p><h2 id="d3df" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Asking complex/multi-hop questions</h2><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="ce21" class="qp ni fq pv b bg qq qr l qs qt"># incorrect as the currency conversion used is wrong. We need to fix this!<br/>qa({"query": "What is the percentage difference in the annual budget for Japan and US?"})<br/><br/>## OUTPUT ##<br/>{'query': 'What is the percentage difference in the annual budget for Japan and US?',<br/> 'result': 'The annual budget for Japan is ¥50 million, and the annual budget for the United States is $500,000. To calculate the percentage difference, we need to convert the budgets to the same currency. Assuming an exchange rate of 1 USD = 100 JPY, the converted budget for Japan is ¥50 million = $500,000. \n\nThe percentage difference can be calculated as follows:\n\nPercentage Difference = ((Budget for Japan - Budget for US) / Budget for US) * 100\n\n= (($500,000 - $500,000) / $500,000) * 100\n\n= (0 / $500,000) * 100\n\n= 0%\n\nTherefore, the percentage difference in the annual budget for Japan and the United States is 0%.',<br/> 'source_documents': [Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}</span></pre><p id="9650" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Mathematically speaking, the response is not 100% correct. Even though the logic it used is correct (i.e. converting the amount from ¥ to $ ), the exchange rate used is out of date.</p><p id="b223" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Let’s try helping it by providing the exchange rate information (1 USD = 147.72 JPY) as part of the query itself.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="9ef9" class="qp ni fq pv b bg qq qr l qs qt"># Results are still slightly off!<br/>qa({"query": "What is the percentage difference in the annual budget for Japan and US if 1 USD = 147.72 JPY?"})<br/><br/>## OUTPUT ##<br/>{'query': 'What is the percentage difference in the annual budget for Japan and US if 1 USD = 147.72 JPY?',<br/> 'result': 'To calculate the percentage difference in the annual budget for Japan and the United States, we need to convert the budgets from their respective currencies to a common currency, such as USD. \n\nGiven that 1 USD = 147.72 JPY, we can convert the annual budget for Japan from JPY to USD by dividing it by the exchange rate:\n\nAnnual budget for Japan in USD = ¥50,000,000 / 147.72 = $338,164.25\n\nNow we can calculate the percentage difference between the annual budgets for Japan and the United States:\n\nPercentage difference = ((Annual budget for Japan - Annual budget for the United States) / Annual budget for the United States) * 100\n\nPercentage difference = (($338,164.25 - $1,000,000) / $1,000,000) * 100\n\nPercentage difference = (-$661,835.75 / $1,000,000) * 100\n\nPercentage difference = -66.18%\n\nTherefore, the percentage difference in the annual budget for Japan and the United States is approximately -66.18%.',<br/> 'source_documents': [Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}</span></pre><p id="6886" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Interestingly enough, LLM was able to use the exchange rate as part of the calculations and the answer it gave (i.e. $338,164.25) was very close to the actual answer (i.e. 338,478.20). Having said that, there’s still room for improvement.</p><p id="7b2b" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Let’s try another question, this time a comparison question:</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="fd49" class="qp ni fq pv b bg qq qr l qs qt"># incorrect as technically US has higher budget after conversion<br/>qa({"query": "Which country has the highest budget?"})<br/><br/>## OUTPUT ##<br/>{'query': 'Which country has the highest budget?',<br/> 'result': 'Japan has the highest budget for employee benefits, with an annual allocation of ¥50 million.',<br/> 'source_documents': [Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),<br/>  Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}</span></pre><p id="9735" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Again, the response is not correct since it didn’t do the currency conversion before comparing the budgets with other countries like the US, Germany, etc.</p><p id="3eac" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Observation</em>: All the aforementioned questions could be reliably answered if instead of jumping on a final answer, we had a systematic way of planning the intermediate steps. To do so, let’s introduce <code class="cx ps pt pu pv b">agents</code>.</p><h2 id="661d" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">ReAct Agent</h2><p id="f355" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">In this tutorial, we will be using LangChain’s implementation of the ReAct (Reason + Act) agent, first introduced in <a class="af pq" href="https://arxiv.org/abs/2210.03629" rel="noopener ugc nofollow" target="_blank">this</a> paper. The key takeaway from the paper is that if we prompt the LLM to generate both reasoning traces and task-specific actions in a step-by-step manner, its performance on the task improves. In other words, we are explicitly asking it to have multiple thought-action-observation steps to solve a task instance instead of coming to the final answer in one single jump (which ultimately leads to reduced hallucination).</p><p id="3f6d" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Apart from ReAct, LangChain supports other agents such as <code class="cx ps pt pu pv b">Open AI tools</code>, <code class="cx ps pt pu pv b">XML</code>, <code class="cx ps pt pu pv b">StructuredChat</code>, <code class="cx ps pt pu pv b">Self Ask with Search</code>, etc that I strongly encourage you to read about <a class="af pq" href="https://python.langchain.com/docs/modules/agents/agent_types/" rel="noopener ugc nofollow" target="_blank">here</a>. One key thing to note here is that ReAct agents can only support tools that can take only 1 input parameter (for instance, from the tools described above, it can support <code class="cx ps pt pu pv b">Tool_Length</code>, <code class="cx ps pt pu pv b">Tool_Date</code>, and <code class="cx ps pt pu pv b">Tool_Search</code> ). If you want to use tools that take more than 1 input (for instance <code class="cx ps pt pu pv b">Tool_PercCalculator</code>), you will be better off using <code class="cx ps pt pu pv b">Open AI Tools</code> agent or <code class="cx ps pt pu pv b">Open AI Functions</code> agent.</p><blockquote class="pn po pp"><p id="ff91" class="od oe ph of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Note: “OpenAI termed the capability to invoke a single function as <code class="cx ps pt pu pv b">functions</code>, and the capability to invoke one or more functions as <code class="cx ps pt pu pv b">tools</code>. As per the official website, <code class="cx ps pt pu pv b">functions</code> are now considered a legacy option that is deprecated in favor of <code class="cx ps pt pu pv b">tools</code>. So if you’re creating agents using OpenAI models, you should be using this <code class="cx ps pt pu pv b">OpenAI Tools</code> agent rather than the <code class="cx ps pt pu pv b">OpenAI functions</code> agent.” [<a class="af pq" href="https://python.langchain.com/docs/modules/agents/agent_types/openai_tools" rel="noopener ugc nofollow" target="_blank">Source</a>]</p></blockquote><h2 id="1ed8" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Defining the tools for the agent</h2><p id="4fd0" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">As I mentioned above, we first need to define the tools that this agent will have access to. For starters, we will only define one tool: <code class="cx ps pt pu pv b">tool_search</code>.</p><p id="56ae" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><code class="cx ps pt pu pv b">tool_search</code>: Given a search query, we need a tool that will return the relevant chunks of the HR document. But wait, isn’t that what our PDR retriever does anyway? In fact, we can easily convert our retriever into a tool using the <code class="cx ps pt pu pv b">create_retriever_tool()</code>.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="aa6c" class="qp ni fq pv b bg qq qr l qs qt">from langchain.tools.retriever import create_retriever_tool<br/><br/>tool_search = create_retriever_tool(<br/>    retriever=retriever,<br/>    name="search_hr_policy",<br/>    description="Searches and returns excerpts from the HR policy.",<br/>)</span></pre><p id="b271" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">A couple of pointers:</p><ul class=""><li id="47b2" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk">The <code class="cx ps pt pu pv b">name</code>and<code class="cx ps pt pu pv b">description</code> of the tool will be passed in the API call to the LLM, so make sure it is as unambiguous as possible for the agent to understand. In our case, we have clearly defined that this tool returns excerpts (i.e. chunks) from the HR policy.</li><li id="c25a" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">Under the hood, this tool uses the <code class="cx ps pt pu pv b">get_relevant_documents()</code> function of the <code class="cx ps pt pu pv b">retriever</code>. You can check it using <code class="cx ps pt pu pv b">.func</code>:</li></ul><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="a88a" class="qp ni fq pv b bg qq qr l qs qt">tool_search.func<br/><br/>## Output ##<br/>&lt;bound method BaseRetriever.get_relevant_documents of ParentDocumentRetriever(vectorstore=&lt;langchain_community.vectorstores.chroma.Chroma object at 0x11f0c5f10&gt;, docstore=&lt;langchain.storage.encoder_backed.EncoderBackedStore object at 0x11f0c5f40&gt;, child_splitter=&lt;langchain.text_splitter.RecursiveCharacterTextSplitter object at 0x11f0c5430&gt;)&gt;</span></pre><ul class=""><li id="7d22" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk">You can even check the schema of this tool using <code class="cx ps pt pu pv b">.schema()</code>. It is useful for verifying the <code class="cx ps pt pu pv b">required</code> parameters necessary for calling the tool.</li></ul><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="e195" class="qp ni fq pv b bg qq qr l qs qt">tool.args_schema.schema()<br/><br/>## Output ##<br/>{'title': 'RetrieverInput',<br/> 'description': 'Input to the retriever.',<br/> 'type': 'object',<br/> 'properties': {'query': {'title': 'Query',<br/>   'description': 'query to look up in retriever',<br/>   'type': 'string'}},<br/> 'required': ['query']}</span></pre><p id="6320" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Pro-tip: You can use </em><code class="cx ps pt pu pv b"><em class="ph">tool.invoke({"inp_param_name": inp_param_value})</em></code><em class="ph"> to quickly test if a custom tool has been set up properly. For example: </em><code class="cx ps pt pu pv b"><em class="ph">tool_search.invoke({“query”: “enter query here”})</em></code></p><p id="dc8c" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Finally, let’s set up the ReAct agent using a prompt that emphasizes multiple thought-action-observation steps. Luckily for us, this is already available on the LangChain hub (you can also override this by defining your own). The prompt template requires three input_variables i.e. <code class="cx ps pt pu pv b">tools</code>, <code class="cx ps pt pu pv b">input</code> and <code class="cx ps pt pu pv b">agent_scratchpad</code>.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="573b" class="qp ni fq pv b bg qq qr l qs qt">from langchain import hub<br/>prompt = hub.pull("hwchase17/react")<br/>print(prompt.template)<br/><br/>## OUTPUT ##<br/>Answer the following questions as best you can. You have access to the following tools:<br/><br/>{tools}<br/><br/>Use the following format:<br/><br/>Question: the input question you must answer<br/>Thought: you should always think about what to do<br/>Action: the action to take, should be one of [{tool_names}]<br/>Action Input: the input to the action<br/>Observation: the result of the action<br/>... (this Thought/Action/Action Input/Observation can repeat N times)<br/>Thought: I now know the final answer<br/>Final Answer: the final answer to the original input question<br/><br/>Begin!<br/><br/>Question: {input}<br/>Thought:{agent_scratchpad}</span></pre><p id="78ef" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Note 1: While this prompt works fine 8 out of 10 times, I highly recommend modifying it to suit your use case — especially if the agent is getting confused about the sequence of actions or thoughts. For instance, in one of the projects where the questions were comparison-based (such as ‘Compare the increase in sales between China and the US in the last 1 year’), this is how I updated the react prompt (and introduced a new input variable </em><code class="cx ps pt pu pv b"><em class="ph">{today_date}</em></code><em class="ph">:</em></p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="9895" class="qp ni fq pv b bg qq qr l qs qt">Use the context given to you to answer the question.<br/>When you come across time based questions like Has there been increase in sales from April last year and August last year,<br/>use today's date as {today_date} for fetching exact start and end dates. Then your first action should be to fetch the sales data with metadata time between April 1st to April 30th.<br/>That will be your answer 1. Your next action will be to fetch the sales data with metadata time between August 1st to<br/>August 31st, this will be your answer 2. Now analyse and understand each of answer 1 and answer 2, calculate the<br/>percentange change, compare them and answer the question.<br/><br/>You have access to the following tools:<br/><br/>{tools}<br/>Use the following format:<br/><br/>Question: the input question you must answer<br/>Thought: you should always think about what to do<br/>Action: the action to take, should be one of [{tool_names}]<br/>Action Input: the input to the action<br/>Observation: the result of the action<br/>... (this Thought/Action/Action Input/Observation can repeat N times)<br/>Thought: I now know the final answer<br/>Final Answer: the final answer to the original input question<br/><br/>Begin!<br/><br/>Question: {input}<br/>Thought:{agent_scratchpad}</span></pre><p id="3ae4" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Note 2: Doing the above (i.e. a more detailed/lengthy prompt) can exponentially increase the token count for your use case. My recommendation is to switch to the chaining of LLMs </em><strong class="of ga"><em class="ph">if </em></strong><em class="ph">(and this is a big if) you know beforehand the order in which the action/thoughts need to be executed. For example: if you know that the only type of questions your system needs to answer is comparison questions like the one I mentioned above, it makes more sense to create a sequential chain of calls to the LLM where output from one is fed as input to the other. I have touched upon the technical implementation of this in LangChain in my previous </em><a class="af pq" rel="noopener" target="_blank" href="/a-gentle-intro-to-chaining-llms-agents-and-utils-via-langchain-16cd385fca81"><em class="ph">article</em></a><em class="ph">.</em></p><h2 id="12e6" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Creating a ReAct agent</h2><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="969f" class="qp ni fq pv b bg qq qr l qs qt"># only creates the logical steps for us<br/>react_agent = create_react_agent(llm, [tool_search], prompt)</span></pre><p id="16dc" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">We also need to instantiate <code class="cx ps pt pu pv b">AgentExecutor</code> that will execute the logical steps that <code class="cx ps pt pu pv b">react_agent</code> will generate.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="8df9" class="qp ni fq pv b bg qq qr l qs qt"># executes the logical steps we created<br/>agent_executor = AgentExecutor(<br/>agent=react_agent, <br/>tools=[tool],<br/>verbose=True,<br/>handle_parsing_errors=True,<br/>max_iterations = 5 # useful when agent is stuck in a loop<br/>)</span></pre><h2 id="d8ec" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Testing the ReAct agent</h2><p id="7105" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">Finally, it is time to test it on the same sample queries as before.</p><p id="01b5" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Note: While I was tempted to cherry-pick examples for this article, it is important to show that these agents can be unreliable at times and a lot of testing needs to be done to establish their capabilities and limitations.</em></p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="3b70" class="qp ni fq pv b bg qq qr l qs qt">query = "Which country has the highest budget?"<br/>agent_executor.invoke({"input": query}) <br/><br/># if you are using the updated prompt with today's date passed to it<br/># agent_executor.invoke({"input": query, "today_date": date.today()})<br/><br/>## OUTPUT ##<br/>&gt; Entering new AgentExecutor chain...<br/>I don't have access to information about country budgets. I should try searching for this information.<br/>Action: search_hr_policy<br/>Action Input: "highest country budget"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\n\n**Communication:**\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\n\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\n\n1.\tRecruitment and Selection\n1.\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I found information about budgets in the HR policy, but it seems to be related to cybersecurity training, safety drills, and communication initiatives. It doesn't provide information about country budgets. I need to search for information about country budgets elsewhere.<br/>Action: search_hr_policy<br/>Action Input: "country budgets"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**GlobalCorp Human Resources Policy**\n\nWelcome to GlobalCorp, where our Human Resources Policy is designed to provide a comprehensive framework for employees across our offices in the United States, Germany, and Japan. We operate under an at-will employment relationship, and any contractual agreements should be documented in writing.\n\nAt the core of our culture is a commitment to professionalism and ethical conduct. Clear and respectful communication is highly valued, and a business casual dress code is encouraged.\n\n**Work Hours:**\nEmployees in the United States adhere to a standard 40-hour workweek (Monday to Friday, 9 AM to 5 PM). In Germany, the standard workweek is 38 hours (Monday to Friday, 8 AM to 5 PM), and in Japan, employees work 40 hours per week (Monday to Friday, 9 AM to 6 PM). Punctuality is paramount, and employees are expected to arrive on time. Time-off requests follow country-specific guidelines.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I still couldn't find information about country budgets in the HR policy. I should try searching for this information using a different tool or source.<br/>Action: search_external_source<br/>Action Input: "highest country budget"search_external_source is not a valid tool, try one of [search_hr_policy].I couldn't find information about country budgets in the HR policy or using the available tools. I need to consult a different source or resource to find the answer to this question.<br/>Final Answer: I don't have access to information about which country has the highest budget.</span></pre><p id="082d" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">A few points for consideration:</p><ul class=""><li id="015c" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk">Notice the <code class="cx ps pt pu pv b">Action Input</code> (i.e. “highest country budget”) for the first <code class="cx ps pt pu pv b">Action</code> . This is the search query that will be passed to the <code class="cx ps pt pu pv b">get_relevant_function()</code> of the PDR <code class="cx ps pt pu pv b">retriever</code> (rather than the actual input query i.e. <code class="cx ps pt pu pv b">Which country has the highest budget?</code>). That means, if there was a section in the underlying documents that talked about the highest country budget we would have been sorted! Sadly, that’s not the case here.</li><li id="0f66" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">The <code class="cx ps pt pu pv b">Observation</code> (i.e. the results from running the <code class="cx ps pt pu pv b">action</code> i.e. tool with the <code class="cx ps pt pu pv b">action inputs</code>) is printed right after <code class="cx ps pt pu pv b">Action Input</code>. In our case, it is the retrieved document (<code class="cx ps pt pu pv b">[Document(page_content=’**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are …</code>) and it contains the information necessary for answering the query. Even so, the final response is still incorrect. [P.S. Based on my testing, this happens mostly with gpt3.5.]</li><li id="b854" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">(To make it work with gpt-3.5) I tried updating the search query to <code class="cx ps pt pu pv b">"Which of the two countries has the highest budget — Japan or Unites States?"</code> , hoping the agent would pick up on the country names and make 2 consecutive calls to the retriever to fetch the relevant info. Unfortunately, the final answer was the same as above.</li><li id="4c8d" class="od oe fq of b gt pi oh oi gw pj ok ol om pk oo op oq pl os ot ou pm ow ox oy pe pf pg bk">Finally, after slight rewording, we have a query that works (with gpt3.5). <br/>Main takeaway: (1) Even for similar-looking prompts, the responses can vary drastically. (2) GPT4 is better suited than GPT3.5 for implementing ReAct agents.</li></ul><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="354b" class="qp ni fq pv b bg qq qr l qs qt">query = "Is the budget for Japan different than United States?"<br/>agent_executor.invoke({"input": query})<br/><br/>## OUTPUT ## <br/>&gt; Entering new AgentExecutor chain...<br/>I should check the HR policy to see if there is any information about budget differences between Japan and the United States.<br/>Action: search_hr_policy<br/>Action Input: "budget differences between Japan and United States"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.<br/>Action: search_hr_policy<br/>Action Input: "budget differences between Japan and United States"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.<br/>Action: search_hr_policy<br/>Action Input: "budget differences between Japan and United States"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.<br/>Action: search_hr_policy<br/>Action Input: "budget differences between Japan and United States"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.<br/>Final Answer: According to the HR policy, the annual budget for employee benefits in the United States is $1 million, while the budget for Japan is ¥50 million.<br/><br/>&gt; Finished chain.</span></pre><p id="a660" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">P.S. I was not too pleased with the unnecessary Action-Action Input loops even though the relevant answer was revealed in the first iteration itself. Again, something I am currently debugging.</em></p><h2 id="e7ef" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Understanding the implementation of the agent</h2><p id="2a19" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk"><em class="ph">LangChain library can be a bit daunting at first and if you would like to debug how things are working under the hood w.r.t. react agents, here are some useful </em><a class="af pq" rel="noopener" target="_blank" href="/how-to-make-most-of-your-python-debugger-in-vscode-9e05dfce533f"><em class="ph">breakpoints to set in your debugger</em></a><em class="ph">.</em></p><p id="5cca" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">I. <a class="af pq" href="https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/agents/react/agent.py#L113-L120" rel="noopener ugc nofollow" target="_blank">setup of the ReAct agent</a>: here you will find the 4 main steps (chained together through the <code class="cx ps pt pu pv b">|</code> symbol) that the agent will take at each iteration. (<em class="ph">I have also included snippets to show you inputs/outputs for each of the four steps in isolation).<br/>P.S. If it is your first time seeing this pipe symbol </em><code class="cx ps pt pu pv b"><em class="ph">|</em></code><em class="ph"> in LangChain, I recommend going through </em><a class="af pq" href="https://python.langchain.com/docs/expression_language/why" rel="noopener ugc nofollow" target="_blank"><em class="ph">this</em></a><em class="ph"> and </em><a class="af pq" href="https://python.langchain.com/docs/expression_language/cookbook/prompt_llm_parser" rel="noopener ugc nofollow" target="_blank"><em class="ph">this</em></a><em class="ph"> first. In simple terms, the </em><code class="cx ps pt pu pv b"><em class="ph">|</em></code><em class="ph">takes passes the output from the first step and passes it as input to the next step in the chain.</em></p><p id="d7ff" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">(a) <code class="cx ps pt pu pv b">Runnable.assign()</code>: updates <code class="cx ps pt pu pv b">agent_scratchpad</code> with observations i.e. all prior thought-action-observations and creates a dictionary that can be passed as input to the next step i.e. <code class="cx ps pt pu pv b">PromptTemplate</code>. <br/>While I have used dummy data in the snippet below, a typical <code class="cx ps pt pu pv b">agent_scratchpad</code> would look like this:<br/><code class="cx ps pt pu pv b">`I need to check if there is any information in the HR policy regarding budget allocation for different countries.\nAction: search_hr_policy\nAction Input: “budget allocation for different countries”\nObservation: [Document(page_content=\’**Griev....]metadata={\’source\’: \’../data/globalcorp_hr_policy.txt\’})]\nThought:</code></p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="d048" class="qp ni fq pv b bg qq qr l qs qt"># Testing Runnable in isolation<br/><br/>from langchain_core.agents import AgentAction<br/>from langchain_core.runnables import Runnable, RunnablePassthrough<br/><br/>agent_1 = RunnablePassthrough.assign(<br/>    agent_scratchpad=lambda x: format_log_to_str(x["intermediate_steps"])<br/>)<br/>input = {<br/>    "input": "I love programming",<br/>    "intermediate_steps": [<br/>        (AgentAction(tool="DummyTool", tool_input="Foo", log="Some log here"), "Result of the tool")<br/>    ],<br/>}<br/>output_1 = agent_1.invoke(input)<br/><br/>## OUTPUT ## <br/>{'input': 'I love programming',<br/> 'intermediate_steps': [(AgentAction(tool='DummyTool', tool_input='Foo', log='Some log here'),<br/>   'Result of the tool')],<br/> 'agent_scratchpad': 'Some log here\nObservation: Result of the tool\nThought: '}</span></pre><p id="6fe7" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">(b) <code class="cx ps pt pu pv b">PromptTemplate</code>: frames the final react prompt for the LLM call based on the updated <code class="cx ps pt pu pv b">agent_scratchpad</code> and creates a <code class="cx ps pt pu pv b">StringPromptValue</code> <br/>(Note: As per the react prompt template, we also need another <code class="cx ps pt pu pv b">input_variables</code> called <code class="cx ps pt pu pv b">tools</code> which is already appended using <code class="cx ps pt pu pv b">prompt.partial</code> <a class="af pq" href="https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/agents/react/agent.py#L99-L102" rel="noopener ugc nofollow" target="_blank">here</a>).</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="74f0" class="qp ni fq pv b bg qq qr l qs qt"># Testing PromptTemplate in isolation<br/><br/>agent_2 = prompt<br/>output_2 = agent_2.invoke(output_1)<br/><br/>## OUTPUT ##<br/>StringPromptValue(text='Answer the following questions as best you can. You have access to the following tools:\n\nsearch_hr_policy: Searches and returns excerpts from the HR policy.\n\nUse the following format:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: the action to take, should be one of [search_hr_policy]\nAction Input: the input to the action\nObservation: the result of the action\n... (this Thought/Action/Action Input/Observation can repeat N times)\nThought: I now know the final answer\nFinal Answer: the final answer to the original input question\n\nBegin!\n\nQuestion: I love programming\nThought:Some log here\nObservation: Result of the tool\nThought: ')</span></pre><p id="10cd" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">(c ) <code class="cx ps pt pu pv b">AzureChatOpenAI</code>: passes the prompt to the <code class="cx ps pt pu pv b">llm</code> for the generation step and fetches the response i.e. <code class="cx ps pt pu pv b">AIMessage</code></p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="4e25" class="qp ni fq pv b bg qq qr l qs qt"># Testing llm in isolation<br/><br/>from langchain_core.prompt_values import StringPromptValue<br/>inp = StringPromptValue(text='Repeat everything I say - "Parrot is a bird')<br/><br/>llm_with_stop = llm.bind(stop=["bird"])<br/>agent_3 = llm_with_stop<br/><br/>agent_3.invoke(inp)<br/><br/>## OUTPUT ##<br/>AIMessage(content='Parrot is a ')</span></pre><p id="b364" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">(d) <code class="cx ps pt pu pv b">ReActSingleInputOutputParser():</code> parses the output (i.e. <code class="cx ps pt pu pv b">AIMessage</code>) returned by the <code class="cx ps pt pu pv b">llm</code>.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="f79e" class="qp ni fq pv b bg qq qr l qs qt">from langchain_core.messages.ai import AIMessage<br/>content = AIMessage(content="I found information about the budget differences between US and Japan in the HR policy. I need to use the currency conversion tool to compare the budgets in USD.\nAction: Currency conversion\nAction Input: ¥50 million")<br/><br/>agent = ReActSingleInputOutputParser()<br/>agent.invoke(content)<br/><br/>## OUTPUT ##<br/>AgentAction(tool='Currency conversion', tool_input='¥50 million', log='I found information about the budget differences between US and Japan in the HR policy. I need to use the currency conversion tool to compare the budgets in USD.\nAction: Currency conversion\nAction Input: ¥50 million')</span></pre><p id="f102" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">II. <a class="af pq" href="https://github.com/langchain-ai/langchain/blob/ac970c9497e2aca1f6396c3f6954b4f6cd0ac879/libs/core/langchain_core/runnables/base.py#L2052" rel="noopener ugc nofollow" target="_blank">agent at work</a>: this is where you can see the <code class="cx ps pt pu pv b">for</code> loop for iterating over all four aforementioned steps. Feel free to set watch variables and investigate the intermediate results. After going through all four steps, the final response is either of type <code class="cx ps pt pu pv b">AgentAction</code> (whether to call another tool) or <code class="cx ps pt pu pv b">AgentFinish</code>(finish the loop). Here is a quick snapshot of my debugger at all the four steps:</p></div></div><div class="mw"><div class="ab cb"><div class="lr qw ls qx lt qy cf qz cg ra ci bh"><div class="mr ms mt mu mv ab kj"><figure class="lg mw rb rc rd re rf paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><img src="../Images/cd862def19b093e5e6607441b5d56fc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*dgomVT8B-zmrc_CSarMufw.png"/></div></figure><figure class="lg mw rg rc rd re rf paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><img src="../Images/8c10cfe73dfc902dfb6fa60b3d1193dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*mEzUmwddg_FkQrkQAbQEvA.png"/></div></figure></div><div class="ab kj"><figure class="lg mw rh rc rd re rf paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><img src="../Images/c6cb10ba661cd55ac44667c2f07c2671.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*KGZ-dWAuNGk4URpMF_pPtQ.png"/></div></figure><figure class="lg mw ri rc rd re rf paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><img src="../Images/d37a025c163ed34d555c12d8bd184cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*w0gfCC_fQJV_ua-GtnKIzg.png"/></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx rj ed rk rl">Intermediate output from the agent</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="66c7" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">III. D<a class="af pq" href="https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/agents/output_parsers/react_single_input.py#L51" rel="noopener ugc nofollow" target="_blank">eep dive into the </a><code class="cx ps pt pu pv b"><a class="af pq" href="https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/agents/output_parsers/react_single_input.py#L51" rel="noopener ugc nofollow" target="_blank">parse()</a></code><a class="af pq" href="https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/agents/output_parsers/react_single_input.py#L51" rel="noopener ugc nofollow" target="_blank"> of </a><code class="cx ps pt pu pv b"><a class="af pq" href="https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/agents/output_parsers/react_single_input.py#L51" rel="noopener ugc nofollow" target="_blank">ReactSingleInputOutputParser</a></code>: if you want to know how it’s decided whether <code class="cx ps pt pu pv b">AIMessage</code> should result in <code class="cx ps pt pu pv b">AgentAction</code> or <code class="cx ps pt pu pv b">AgentFinish</code>.</p><p id="0a4c" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">IV. <a class="af pq" href="https://github.com/langchain-ai/langchain/blob/ac970c9497e2aca1f6396c3f6954b4f6cd0ac879/libs/langchain/langchain/agents/agent.py#L1204" rel="noopener ugc nofollow" target="_blank">custom tool being used</a>: this is where you can see your custom tool being used by the agent (if <code class="cx ps pt pu pv b">AgentAction</code> was returned).</p><p id="7aa8" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">V. the <code class="cx ps pt pu pv b"><a class="af pq" href="https://github.com/langchain-ai/langchain/blob/ac970c9497e2aca1f6396c3f6954b4f6cd0ac879/libs/langchain/langchain/agents/agent.py#L1390" rel="noopener ugc nofollow" target="_blank">while</a></code><a class="af pq" href="https://github.com/langchain-ai/langchain/blob/ac970c9497e2aca1f6396c3f6954b4f6cd0ac879/libs/langchain/langchain/agents/agent.py#L1390" rel="noopener ugc nofollow" target="_blank"> loop</a> that keeps the agent looping (unless <code class="cx ps pt pu pv b">AgentFinish</code> is encountered or a time-out occurs) after <a class="af pq" href="https://github.com/langchain-ai/langchain/blob/ac970c9497e2aca1f6396c3f6954b4f6cd0ac879/libs/langchain/langchain/agents/agent.py#L1403" rel="noopener ugc nofollow" target="_blank">updating the intermediate steps</a> with the observations from the previous iteration.<br/><em class="ph">Note: Intermediate steps are a collection of observations and observations will often be the output of the tool. So in the case of the retriever tool, it will be a list of Documents, in the case of currency conversion, it will be a number, and so on.</em></p><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp rm"><img src="../Images/fa837b6676eef62a6ea1a41349a85fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*836lMTBO7EeIUwc2LCO0qg.png"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx">Example of intermediate steps</figcaption></figure><p id="3854" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Final thoughts: If the questions anticipated for a QnA system are fundamentally basic, meaning they can be adequately handled by a standard retrieval-based QA mechanism without the need for multi-hop reasoning, it’s best to steer clear of agents. This is especially true if the only tool required is a ‘retriever-turned-tool’. Introducing agents in such scenarios can needlessly complicate matters. Moreover, if you are using a retriever as a tool, the input to its <code class="cx ps pt pu pv b">get_relevant_function()</code> gets modified by the agent (as you noticed above) as it sees fit and you no longer have control over it. This may be an issue in some cases (although an easy fix for that is to update the description of the tool to <code class="cx ps pt pu pv b">tool_search.description = “Searches and returns excerpts from the HR policy. Input should be a fully formed question”</code>)</p><p id="7de8" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">The true potential of agents is unlocked when we give it complex questions and more tools to work with as we will see next.</p><h2 id="e961" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Introducing more tools</h2><p id="8d67" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">Let’s introduce another tool : <code class="cx ps pt pu pv b">currency_conversion</code> and run the same query as above.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="6d3b" class="qp ni fq pv b bg qq qr l qs qt">currency_conversion = Tool(<br/>    name="Currency conversion",<br/>    func=convert_currency_to_usd,<br/>    description="useful for converting currency into USD. Input should be an amount.",<br/>)</span></pre><p id="ca87" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Here are some helper functions this tool needs:</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="64fb" class="qp ni fq pv b bg qq qr l qs qt">def value_to_float(x):<br/>    if type(x) == float or type(x) == int:<br/>        return x<br/>    x = x.upper()<br/>    if "MILLION" in x:<br/>        if len(x) &gt; 1:<br/>            return float(x.replace("MILLION", "")) * 1000000<br/>        return 1000000.0<br/>    if "BILLION" in x:<br/>        return float(x.replace("BILLION", "")) * 1000000000<br/>    return 0.0<br/><br/>def convert_currency_to_usd(amount: str) -&gt; int:<br/>    "Converts currency into USD"<br/><br/>    if "¥" in amount:<br/>        exclude_symbol = amount.replace("¥", "")<br/>        amount_in_numbers = value_to_float(exclude_symbol)<br/>        return amount_in_numbers / 147.72 #harcoded the exchange rate here for simplicity<br/>    if "$" in amount:<br/>        exclude_symbol = amount.replace("$", "")<br/>        return value_to_float(exclude_symbol)</span></pre><p id="2eec" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Let’s re-run the earlier query:</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="159f" class="qp ni fq pv b bg qq qr l qs qt">tools = [tool_search, currency_conversion] <br/><br/>react_agent = create_react_agent(llm, tools, prompt)<br/>agent_executor = AgentExecutor(<br/>    agent=react_agent, tools=tools, verbose=True, handle_parsing_errors=True<br/>)<br/><br/>query = "Is the budget for Japan different than United States?"<br/>agent_executor.invoke({"input": query})<br/><br/>## OUTPUT ##<br/>&gt; Entering new AgentExecutor chain...<br/>I should check the HR policy to see if there is any information about budget differences between Japan and the United States.<br/>Action: search_hr_policy<br/>Action Input: "budget differences Japan United States"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\n\n**Communication:**\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\n\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\n\n1.\tRecruitment and Selection\n1.\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I found information about budget differences between Japan and the United States in the HR policy.<br/>Action: Currency conversion<br/>Action Input: ¥50 million338478.20200379094The budget for Japan is equivalent to $338,478.20 USD.<br/>Final Answer: The budget for Japan is different than the United States.<br/><br/>&gt; Finished chain.<br/><br/>{'input': 'Is the budget for Japan different than United States?',<br/> 'output': 'The budget for Japan is different than the United States.'}</span></pre><p id="d2f5" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">You may be wondering what’s the big deal about this answer. Even without this tool, the previous answer we received was correct. However, what’s noteworthy here is its capability to perform currency conversions to USD before arriving at the ultimate conclusion that the budgets are indeed different. This helps build trust in the responses. Without this tool, I am willing to bet that if the HR policy stated the budget for Japan and the US as ¥741 million and $5 million, respectively, the LLM would respond that they have different budgets even though after conversion (as per today’s rate) they should be same.</p><p id="3360" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">A couple of observations:</p><ul class=""><li id="3851" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk">Given that the tools and their description get appended to the prompt, the model knows it has access to these tools if needed. I believe it helps them utilize as many of these tools as they deem necessary during answering a query. Hence, the decision to use the currency conversion tool in the second action.</li></ul><p id="be20" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Let’s update the query to get the actual difference in figures.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="6aca" class="qp ni fq pv b bg qq qr l qs qt">query = "Calculate the difference in company budget for Japan and United States?"<br/>agent_executor.invoke({"input": query})<br/><br/>## OUTPUT ## <br/>&gt; Entering new AgentExecutor chain...<br/>I need to find the company budget for Japan and the United States and then calculate the difference.<br/>Action: search_hr_policy<br/>Action Input: "company budget Japan"[Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\n\n**Leave Policies - Japan:**\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\n\n**Performance Management:**\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\n\n**Communication:**\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\n\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\n\n1.\tRecruitment and Selection\n1.\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I need to find the company budget for Japan and the United States and then calculate the difference.<br/>Action: search_hr_policy<br/>Action Input: "company budget United States"[Document(page_content='**Grievance and Disciplinary Procedures:**\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\n\n**Confidentiality and Data Security:**\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\n\n**Compensation and Benefits - Germany:**\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\n\n**Compensation and Benefits - Japan:**\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\n\n**Leave Policies - United States:**\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\n\n**Communication:**\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\n\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\n\n1.\tRecruitment and Selection\n1.\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found the company budget for Japan and the United States. Now I can calculate the difference.<br/>Action: Currency conversion<br/>Action Input: ¥50 million338478.20200379094I have converted the budget for Japan into USD.<br/>Action: Currency conversion<br/>Action Input: $1 million1000000.0I have converted the budget for the United States into USD.<br/>Thought: I have the budgets for Japan and the United States in USD. Now I can calculate the difference.<br/>Final Answer: The difference in company budget for Japan and the United States is $661,521.80.<br/><br/>&gt; Finished chain.<br/><br/>{'input': 'Calculate the difference in company budget for Japan and United States?',<br/> 'output': 'The difference in company budget for Japan and the United States is $661,521.80.'}</span></pre><p id="41f6" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">The LLM has done a great job at handling the subtraction (although I remain cautious about relying on LLMs for any type of calculations.). If we want to make it even more robust, we can add another tool, say <code class="cx ps pt pu pv b">calculator_subtract</code> for calculating the difference between two numbers. As I mentioned before, ReAct agents cannot handle multi-input tools, and doing so would raise an error. This is where Open AI Tools agents come in picture.</p><h2 id="9478" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Open AI Tools Agent</h2><p id="05ad" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">Let’s create a new tool — <code class="cx ps pt pu pv b">perc_diff()</code>that takes two numbers as inputs and calculates the difference in percentage between these two numbers.</p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="de7e" class="qp ni fq pv b bg qq qr l qs qt">class Metrics(BaseModel):<br/>    num1: float = Field(description="Value 1")<br/>    num2: float = Field(description="Value 2")<br/><br/><br/>@tool(args_schema=Metrics)<br/>def perc_diff(num1: float, num2: float) -&gt; float:<br/>    """Calculates the percentage difference between two numbers"""<br/>    return (np.abs(num1 - num2) / ((num1+num2)/2)) * 100</span></pre><p id="62a5" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Note: Another way to initialize the same tool (giving more control over the setup)</em></p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="23b3" class="qp ni fq pv b bg qq qr l qs qt">from langchain.tools import BaseTool, StructuredTool<br/><br/>class Metrics(BaseModel):<br/>    num1: float = Field(description="Value 1")<br/>    num2: float = Field(description="Value 2")<br/><br/>def perc_diff(num1: float, num2: float) -&gt; float:<br/>    """Calculates the percentage difference between two numbers"""<br/>    return (np.abs(num1 - num2) / ((num1+num2)/2)) * 100<br/><br/>percentage_difference = StructuredTool.from_function(<br/>    func=perc_diff,<br/>    name="PercentageDifference", # make sure there are no spaces as OAI Tools agent will throw an error<br/>    description="calculates percentage difference between 2 numbers",<br/>    args_schema=Metrics,<br/>    return_direct=False,<br/>)</span></pre><p id="4810" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Finally, with all the pieces in place, let’s use <code class="cx ps pt pu pv b">create_openai_tools_agent</code></p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="cd3d" class="qp ni fq pv b bg qq qr l qs qt">tools = [tool_search, currency_conversion, perc_diff]<br/>prompt_oai_tools = hub.pull("hwchase17/openai-tools-agent")<br/>oaitools_agent = create_openai_tools_agent(llm, tools, prompt_oai_tools)<br/>oaitools_agent_executor = AgentExecutor(<br/>    agent=oaitools_agent, tools=tools, verbose=True, handle_parsing_errors=True<br/>)<br/><br/>query = "As per the HR policy, compare the budgets for Japan and US."<br/>oaitools_agent_executor.invoke({"input": query})<br/><br/>## OUTPUT ##<br/>&gt; Entering new AgentExecutor chain...<br/><br/>Invoking: `search_hr_policy` with `{'query': 'employee benefits budget Japan'}`<br/>[Document(page_content='**Compensation and Benefits - Japan:**\nIn Japan,....]<br/><br/>Invoking: `search_hr_policy` with `{'query': 'employee benefits budget US'}`<br/>[Document(page_content='**Compensation and Benefits - United States:**\nIn the United States,....]<br/><br/>Invoking: `Currency_conversion` with `JPY 50000000`<br/>338478.20200379094<br/><br/>Invoking: `Currency_conversion` with `USD 1000000`<br/>USD 1000000<br/><br/>Invoking: `percentage_difference` with `{'metric1': 338478.20200379094, 'metric2': 1000000}`<br/>98.85The percentage difference in budgets for employee benefits between Japan and the US is approximately 98.85%, with the US budget being higher.<br/><br/>&gt; Finished chain.<br/><br/>{'input': 'As per the HR policy, what is the percentage difference in budgets for employee benefits in Japan vs US.',<br/> 'output': 'The percentage difference in budgets for employee benefits between Japan and the US is approximately 98.85%, with the US budget being higher.'}</span></pre><p id="3ead" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">Note: Upon running this line of code, you may notice errors like </em><a class="af pq" href="https://github.com/Azure/azure-sdk-for-java/issues/38115" rel="noopener ugc nofollow" target="_blank"><em class="ph">this</em></a><em class="ph"> i.e.</em><code class="cx ps pt pu pv b"><em class="ph">Unrecognized request argument supplied: tools</em></code><em class="ph">. It means that under the hood when the API call is made to the </em><code class="cx ps pt pu pv b"><em class="ph">llm</em></code><em class="ph">, it does not recognize the </em><code class="cx ps pt pu pv b"><em class="ph">tools</em></code><em class="ph"> parameter. Given that only the newer version of the APIs recognize this parameter, it must mean you are using an older version of the model. You can fix this by:</em></p><ul class=""><li id="c4dc" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk"><em class="ph">if you are using Azure Open AI services — deploy one of the newer models (see image below) and update the </em><code class="cx ps pt pu pv b"><em class="ph">deployment_name</em></code><em class="ph"> in your codebase i.e. </em><code class="cx ps pt pu pv b"><em class="ph">llm=AzureChatOpenAI(deployment_name=..., )</em></code></li></ul><figure class="mr ms mt mu mv mw mo mp paragraph-image"><div role="button" tabindex="0" class="mx my ed mz bh na"><div class="mo mp rn"><img src="../Images/9a2a77e4aabc5f6ca5230d171c3c0344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zEdbDLEgNPZmRmxeJwtzUA.png"/></div></div><figcaption class="nc nd ne mo mp nf ng bf b bg z dx"><em class="ro">Available models on Azure Open AI</em></figcaption></figure><ul class=""><li id="c57c" class="od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy pe pf pg bk"><em class="ph">if you are using Open AI’s API directly — check that the model is a newer one from </em><a class="af pq" href="https://platform.openai.com/docs/models/gpt-3-5-turbo" rel="noopener ugc nofollow" target="_blank"><em class="ph">this</em></a><em class="ph"> list.</em></li></ul><p id="006f" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk"><em class="ph">To test this fixed the issue, here’s a comparison before and after the version update (complete code snippet can be found </em><a class="af pq" href="https://github.com/gkamradt/langchain-tutorials/blob/main/data_generation/Exploring%20ChatGPT%20Function%20Calling.ipynb" rel="noopener ugc nofollow" target="_blank"><em class="ph">here</em></a><em class="ph">):</em></p><pre class="mr ms mt mu mv qm pv qn bp qo bb bk"><span id="ae79" class="qp ni fq pv b bg qq qr l qs qt"># Before<br/># Model name: gpt-35-turbo<br/># Model version: 0301<br/>response = llm(messages=[message], tools=tools)<br/><br/>## OUTPUT ## <br/>openai.error.InvalidRequestError: Unrecognized request argument supplied: tools</span></pre><pre class="qv qm pv qn bp qo bb bk"><span id="82da" class="qp ni fq pv b bg qq qr l qs qt"># After<br/># Model name: gpt-35-turbo<br/># Model version: 0613<br/>response = llm(messages=[message], tools=tools)<br/><br/>## OUTPUT ##<br/>content='' additional_kwargs={'tool_calls': [&lt;OpenAIObject id=call_8lvikb3ZqflGrr2xGgPGWXoJ at 0x10aa67270&gt; JSON: {<br/>  "id": "call_8lvikb3ZqflGrr2xGgPGWXoJ",<br/>  "type": "function",<br/>  "function": {<br/>    "name": "get_current_weather",<br/>    "arguments": "{\n  \"location\": \"San Francisco\"\n}"<br/>  }<br/>}]}</span></pre></div></div></div><div class="ab cb rp rq rr rs" role="separator"><span class="rt by bm ru rv rw"/><span class="rt by bm ru rv rw"/><span class="rt by bm ru rv"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="05d5" class="pw ni fq bf nj px py pz nm qa qb qc np om qd qe qf oq qg qh qi ou qj qk ql fw bk">Conclusion</h2><p id="e686" class="pw-post-body-paragraph od oe fq of b gt og oh oi gw oj ok ol om on oo op oq or os ot ou ov ow ox oy fj bk">Having taken a deep dive into the inner workings of the ReAct agent, I hope you feel more confident implementing it for your projects. This article just scratched the surface, there is so much more to cover. For instance, how to add memory to these QnA systems so you can use them in a chat-like manner.</p><p id="cdd1" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">As always if there’s an easier way to do/explain some of the things mentioned in this article, do let me know. In general, refrain from unsolicited destructive/trash/hostile comments!</p><p id="3326" class="pw-post-body-paragraph od oe fq of b gt oz oh oi gw pa ok ol om pb oo op oq pc os ot ou pd ow ox oy fj bk">Until next time ✨</p><div class="rx ry rz sa sb sc"><a rel="noopener follow" target="_blank" href="/a-gentle-intro-to-chaining-llms-agents-and-utils-via-langchain-16cd385fca81?source=post_page-----893208c1847e--------------------------------"><div class="sd ab il"><div class="se ab co cb sf sg"><h2 class="bf ga ib z it sh iv iw si iy ja fz bk">A Gentle Intro to Chaining LLMs, Agents, and utils via LangChain</h2><div class="sj l"><h3 class="bf b ib z it sh iv iw si iy ja dx">Understand the basics of agents, tools, and prompts and some learnings along the way</h3></div><div class="gq l"><p class="bf b dy z it sh iv iw si iy ja dx">towardsdatascience.com</p></div></div><div class="sk l"><div class="sl l sm sn so sk sp lw sc"/></div></div></a></div><div class="rx ry rz sa sb sc"><a href="https://medium.com/illumination/3-apps-to-make-you-the-smartest-person-in-the-room-1cc2d927971d?source=post_page-----893208c1847e--------------------------------" rel="noopener follow" target="_blank"><div class="sd ab il"><div class="se ab co cb sf sg"><h2 class="bf ga ib z it sh iv iw si iy ja fz bk">3 Apps to Make You the Smartest Person in the Room</h2><div class="sj l"><h3 class="bf b ib z it sh iv iw si iy ja dx">With minimum daily time commitments</h3></div><div class="gq l"><p class="bf b dy z it sh iv iw si iy ja dx">medium.com</p></div></div><div class="sk l"><div class="sq l sm sn so sk sp lw sc"/></div></div></a></div><div class="rx ry rz sa sb sc"><a rel="noopener follow" target="_blank" href="/is-googles-notebooklm-going-to-disrupt-the-podcasting-industry-ea8e1ec7f431?source=post_page-----893208c1847e--------------------------------"><div class="sd ab il"><div class="se ab co cb sf sg"><h2 class="bf ga ib z it sh iv iw si iy ja fz bk">Is Google’s NotebookLM Going to Disrupt the Podcasting Industry?</h2><div class="sj l"><h3 class="bf b ib z it sh iv iw si iy ja dx">Especially if all it takes is 1 click to turn any content into podcast</h3></div><div class="gq l"><p class="bf b dy z it sh iv iw si iy ja dx">towardsdatascience.com</p></div></div><div class="sk l"><div class="sr l sm sn so sk sp lw sc"/></div></div></a></div></div></div></div></div>    
</body>
</html>