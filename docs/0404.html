<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Intersect two 3D Rays (Closest Point)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Intersect two 3D Rays (Closest Point)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3d-ray-intersection-closest-point-dc8c72122224?source=collection_archive---------8-----------------------#2024-02-12">https://towardsdatascience.com/3d-ray-intersection-closest-point-dc8c72122224?source=collection_archive---------8-----------------------#2024-02-12</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="4098" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx"><em class="hd">Let’s unravel the math behind 3D rays and demonstrate that it’s not significantly more challenging than the conventional 2D case.</em></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@thom01.rouch?source=post_page---byline--dc8c72122224--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Thomas Rouch" class="l ep by dd de cx" src="../Images/a8440bbed59cd8d9cdd752cf1fea2831.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*bzXmGPw5ErdKoJZ6gYLBsw.jpeg"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--dc8c72122224--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://medium.com/@thom01.rouch?source=post_page---byline--dc8c72122224--------------------------------" rel="noopener follow">Thomas Rouch</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--dc8c72122224--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Feb 12, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk ld le ab q ee lf lg" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lc"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lb lc">2</span></p></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lh k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al li an ao ap ie lj lk ll" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lm cn"><div class="l ae"><div class="ab cb"><div class="ln lo lp lq lr ls ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml mm"><img src="../Images/2e951c331eed729eaafe73a0d22c9723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1jaHZwjOTzUyC-RI"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Photo by <a class="af nd" href="https://unsplash.com/@tobiasc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tobias Cornille</a> on <a class="af nd" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="9316" class="ne nf fq bf ng nh ni gq nj nk nl gt nm nn no np nq nr ns nt nu nv nw nx ny nz bk">1. Introduction</h1><h2 id="f00c" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Motivation</h2><p id="31a6" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">In</span> fields like computer graphics, autonomous vehicle navigation or augmented reality, where immersive experiences are created through the manipulation of 3D environments, a deep understanding of ray intersection and triangulation algorithms empowers data scientists to craft lifelike simulations and interactive virtual worlds.</p><p id="22fc" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">It also demonstrates that mathematical principles such as pseudo-inverse matrices, least squares optimization, Cramer’s rule or triple scalar products aren’t just theoretical; they’re practical tools for solving real-world problems!</p><h2 id="7915" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Ray Definition</h2><p id="c62f" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">A</span> Ray starts from a given position and extends infinitely in a given direction, just like a laser beam or a ray of light.</p><blockquote class="qb"><p id="8b88" class="qc qd fq bf qe qf qg qh qi qj qk pm dx">Think of a ray as a one-way street with a fixed starting point, while a line is like a two-way street that stretches endlessly in both directions.</p></blockquote><p id="805d" class="pw-post-body-paragraph ou ov fq ow b go ql oy oz gr qm pb pc oh qn pe pf ol qo ph pi op qp pk pl pm fj bk">Mathematically, a ray is defined by its origin <code class="cx qq qr qs qt b">o</code> and direction <code class="cx qq qr qs qt b">d</code>. Since it’s a 1D space, any point along the ray is parametrized by its positive distance (or time) <code class="cx qq qr qs qt b">t</code> with respect to the origin.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml qu"><img src="../Images/b203aab18b69d9958f77df43a81e9975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/0*ME0kx_m7Ul9AIIlG"/></div></figure><h2 id="bc09" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Ray Intersection</h2><p id="771b" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">F</span>inding the intersection of two rays <code class="cx qq qr qs qt b">r1</code> and <code class="cx qq qr qs qt b">r2</code> means finding the two parameters <code class="cx qq qr qs qt b">t1</code> and <code class="cx qq qr qs qt b">t2</code>, respectively on the first and second ray, that result in the exact same point in space.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml qv"><img src="../Images/fa6b317505532185f1eb8b32ccdf6611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/0*WdgfcNAN4H_dBm1M"/></div></figure><p id="4c69" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">An interesting point to note is that we haven’t specified the dimension of the space in which our ray lives. It could be 2D, like a line drawn on a piece of paper, 3D like a laser beam, or even exist in higher dimensions!</p><p id="d9d1" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">Since we’re looking for the values of <code class="cx qq qr qs qt b">t1</code> and <code class="cx qq qr qs qt b">t2</code>, let’s concatenate them in a colum vector <code class="cx qq qr qs qt b">x</code>. It allows us to vectorize this equation into the canonical linear system <code class="cx qq qr qs qt b">Ax=b</code>. For better clarity, there’s an annotation below each term indicating the shape of the matrix or vector, with <code class="cx qq qr qs qt b">n</code> being the dimension of the space in which the ray is defined.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml qw"><img src="../Images/3c2ddf4a94f00d44736eae162b06d844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/0*z3UyMA7rRf2Lc6Gg"/></div></figure><blockquote class="qx qy qz"><p id="b273" class="ou ov ra ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">N.B. The matrix A is built by concatenating side by side the two directions as column vectors, with the second one being flipped.</p></blockquote><p id="cd2f" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">Solving <code class="cx qq qr qs qt b">Ax=b</code> gives us <code class="cx qq qr qs qt b">t1</code> and <code class="cx qq qr qs qt b">t2</code>. However, if either of these parameters is negative, it indicates that the intersection point lies behind one of the ray origins, meaning there’s no intersection between both rays.</p></div></div></div><div class="ab cb rb rc rd re" role="separator"><span class="rf by bm rg rh ri"/><span class="rf by bm rg rh ri"/><span class="rf by bm rg rh"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rj"><img src="../Images/8fb70caa8ddffaa0cae50ec66ecc0fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OdYKeqps6j1tYHJ5"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Photo by <a class="af nd" href="https://unsplash.com/@messrro?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mehdi MeSSrro</a> on <a class="af nd" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2211" class="ne nf fq bf ng nh ni gq nj nk nl gt nm nn no np nq nr ns nt nu nv nw nx ny nz bk">2. 2D Ray Intersection</h1><h2 id="098e" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Introduction</h2><p id="fc5f" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">T</span>he 2D case is the easiest one. Typically, unless they’re exactly parallel, two 2D lines will always converge at a unique common point.</p><p id="f274" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">In the image below, <code class="cx qq qr qs qt b">r1</code> and <code class="cx qq qr qs qt b">r2</code> intersect. However, <code class="cx qq qr qs qt b">r3</code> doesn’t intersect any ray because it’s parallel to <code class="cx qq qr qs qt b">r2</code> and meets <code class="cx qq qr qs qt b">r1</code> behind its origin.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rk"><img src="../Images/df05979d9169ef6e2dcab4efa40e235f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EWED_yRAUCcsuiqW1U8VPg.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">2D Ray intersection — Diagram by the author</figcaption></figure><h2 id="9129" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Solving the linear system</h2><p id="b666" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">T</span>he linear system of equations <code class="cx qq qr qs qt b">Ax=b</code> introduced above has <code class="cx qq qr qs qt b">n</code> equations and 2 unknowns. Thus, in the 2D case we end up with a system of 2 equations and 2 unknowns, meaning we just have to invert the matrix <code class="cx qq qr qs qt b">A</code>.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml rl"><img src="../Images/7524335da956aea1d4916fa9e6155511.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/0*NFmLjMvcby2qzlyN"/></div></figure><p id="3d8c" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">If the rays are parallel, the matrix <code class="cx qq qr qs qt b">A</code> won’t be invertible because its two columns, <code class="cx qq qr qs qt b">d1</code> and <code class="cx qq qr qs qt b">-d2</code>, will be collinear.</p><p id="76d4" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">If you’re not interesting in <code class="cx qq qr qs qt b">t1</code> and <code class="cx qq qr qs qt b">t2</code> and just want to know if there’s an intersection, computing the determinant of <code class="cx qq qr qs qt b">A</code> and comparing it against 0 is all you need.</p><p id="07d9" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">If you’re not interesting in having both <code class="cx qq qr qs qt b">t1</code> and <code class="cx qq qr qs qt b">t2</code>, e.g. if you’re looking for the actual 2D position of the intersection point, using Cramer’s rule is a smart trick. It expresses the solution using determinants of <code class="cx qq qr qs qt b">A</code> and modified matrices, where one column of <code class="cx qq qr qs qt b">A</code> is replaced by <code class="cx qq qr qs qt b">b</code>.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rm"><img src="../Images/f0408dbffe70f7d8077ce6d0bd328742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Cuj94ajoTaA8eTGl"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Cramer’s rule to identify t1 and t2. Operator |.| is the determinant. Commas separate matrix columns.</figcaption></figure></div></div></div><div class="ab cb rb rc rd re" role="separator"><span class="rf by bm rg rh ri"/><span class="rf by bm rg rh ri"/><span class="rf by bm rg rh"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rn"><img src="../Images/7915c7a151b0da57ffde63bd3b2a1c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h_xRRfY_y0kx4rxp"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Photo by <a class="af nd" href="https://unsplash.com/@vincefleming?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Vince Fleming</a> on <a class="af nd" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="c9c4" class="ne nf fq bf ng nh ni gq nj nk nl gt nm nn no np nq nr ns nt nu nv nw nx ny nz bk">3D Ray Intersection</h1><h2 id="8c46" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Introduction</h2><p id="1f4c" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">U</span>nlike the 2D case, it’s highly unlikely for two 3D rays to intersect. For instance, trying to make two laser pointers held by two different people intersect is very challenging.</p><p id="04ac" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">The linear system <code class="cx qq qr qs qt b">Ax=b</code> ends up having 3 equations for 2 unknowns, making it unsolvable unless there’s redundancy within the equations.</p><h2 id="e732" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Least-Squares</h2><p id="cb2e" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">G</span>iven the absence of a solution in most cases, the shortest line segment between both rays can be viewed as their intersection. Let’s denote <code class="cx qq qr qs qt b">p1</code> and <code class="cx qq qr qs qt b">p2</code> as the endpoints of this optimal segment, located on <code class="cx qq qr qs qt b">r1</code> and <code class="cx qq qr qs qt b">r2</code> respectively.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml ro"><img src="../Images/4894170beb6c75c51efbae2d6f75a13a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLbzAjTSHaO67-8C4dCxLg.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">3D Ray Intersection — Diagram by the author</figcaption></figure><p id="e7dd" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">Our task now transforms into a least-squares minimization problem. Its formulation is straightforward given that <code class="cx qq qr qs qt b">Ax-b</code> already represents the vector between <code class="cx qq qr qs qt b">p2</code> and <code class="cx qq qr qs qt b">p1</code>.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rp"><img src="../Images/6d39d07af994d5b66dbde274fe1eb9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*48U8UF9rWaPF4Glv"/></div></div></figure><p id="ce87" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">It’s a well-known problem. Zeroing the gradient at the optimum gives us the solution using the pseudo-inverse matrix, which is a convenient way to build a square and thus invertible matrix.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml rq"><img src="../Images/1ced4f49ef7b4ff584077985aa5387e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/0*ZCXhD8RSm6B91uJb"/></div></figure><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml rr"><img src="../Images/a6ec95ccf0a2d28401791aef1556ebac.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/0*bLWilWWkoTHNmXxn"/></div></figure><h2 id="2179" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Orthogonality</h2><p id="4d7b" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">W</span>hile it appears on the diagram above that the shortest segment is perpendicular to both rays, we have yet to formally prove this, even-though it sounds intuitive.</p><p id="5253" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">The zero gradient also implies that the dot product between the segment defined by <code class="cx qq qr qs qt b">p1</code> and <code class="cx qq qr qs qt b">p2</code> and both ray directions <code class="cx qq qr qs qt b">d1</code> and <code class="cx qq qr qs qt b">d2</code> is zero, which proves the orthogonality.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml rs"><img src="../Images/e2faa09fa96ff1eec553d68ebe4d10a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/0*yyLbeSJlimjcRN4Z"/></div></figure><h2 id="e45b" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Alternative Linear System</h2><p id="00b2" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">T</span>he Least-Squares approach works perfectly fine, but we can also introduce a third unknown variable to make our linear system solvable.</p><p id="2880" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">Given that the vectors <code class="cx qq qr qs qt b">d1</code>, <code class="cx qq qr qs qt b">d2</code> and <code class="cx qq qr qs qt b">p2-p1</code> constitute an orthogonal basis, we can build an orthogonal frame with <code class="cx qq qr qs qt b">o1</code> as the origin. The points <code class="cx qq qr qs qt b">p1</code> and <code class="cx qq qr qs qt b">p2</code> can then be derived by expressing the local coordinates of <code class="cx qq qr qs qt b">o2</code> with respect to this frame.</p><p id="0fa9" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">Note that the direction of the segment <code class="cx qq qr qs qt b">p2-p1</code> is given by the cross product between both ray directions. We’ll introduce the signed scale δ along this direction in the orthogonal basis. The actual distance between the two rays can be obtained by multiplying |δ| by the norm of the cross product.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml rt"><img src="../Images/aa98e49dbef95149487fb995fd4046b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/0*5JKkaDt-EdNLUpRx"/></div></figure><p id="216c" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">t1, δ and t2 can then be retrieved using a linear system of equations.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml ru"><img src="../Images/4d7b7ddccdaff497a2b02f78cd18d4aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mKghUqLFf-n0NgmI"/></div></div></figure><p id="cfac" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">The determinant of a 3x3 matrix can be derived via the scalar triple product, which involves the dot product of one column with the cross product of the other two.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rv"><img src="../Images/b20e72c430c427bae012dfff6fa8e9bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v4fBiaogS__r6X4_"/></div></div></figure><p id="11c4" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">In our case, simplifying the determinant equation is straightforward as the second column is already a cross product. Note that inserting the cross product as the final column would have resulted in the negation of the norm instead.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rw"><img src="../Images/8fe3951f383fdbfd31267ff4acd218a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5mhEVC8P-flNTlTZ"/></div></div></figure><p id="de96" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">Solving with Cramer’s rule gives us the optimal <code class="cx qq qr qs qt b">t1</code> and <code class="cx qq qr qs qt b">t2</code> , but also the signed scale δ.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rx"><img src="../Images/01a30c132c755c622503cb50496ebbe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wsl31IlJog-7Sq5W"/></div></div></figure><p id="219f" class="pw-post-body-paragraph ou ov fq ow b go pw oy oz gr px pb pc oh py pe pf ol pz ph pi op qa pk pl pm fj bk">If you love clean equations, you can re-order and swap columns to remove minus signs and make it look better!</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml ry"><img src="../Images/168bcd7adb3da59d325b4d21709a8d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7fiUuTXe9-UzIQnQ"/></div></div></figure><h2 id="1b52" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Intersection Point</h2><p id="6124" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">T</span>he intersection point can be defined as the middle of the shortest segment, i.e. <code class="cx qq qr qs qt b">0.5(p1+p2)</code>.</p><h2 id="e545" class="oa nf fq bf ng ob oc od nj oe of og nm oh oi oj ok ol om on oo op oq or os ot bk">Distance between rays</h2><p id="d2be" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk pn"><span class="l po pp pq bo pr ps pt pu pv ed">As</span> said previously, the signed scale δ must be multiplied by the norm of the cross product of both rays to retrieve the true distance between the rays.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml rz"><img src="../Images/89088b762943928dfe2be9d4f8d8b6c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*it4fLrtkfC9fl7SQ"/></div></div></figure></div></div></div><div class="ab cb rb rc rd re" role="separator"><span class="rf by bm rg rh ri"/><span class="rf by bm rg rh ri"/><span class="rf by bm rg rh"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="35ef" class="ne nf fq bf ng nh sa gq nj nk sb gt nm nn sc np nq nr sd nt nu nv se nx ny nz bk">Conclusion</h1><p id="240f" class="pw-post-body-paragraph ou ov fq ow b go ox oy oz gr pa pb pc oh pd pe pf ol pg ph pi op pj pk pl pm fj bk">I hope you enjoyed reading this article and that it gave you more insights on how to intersect 2D or 3D rays!</p></div></div></div></div>    
</body>
</html>