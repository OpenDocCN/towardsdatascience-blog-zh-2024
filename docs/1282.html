<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>LangChain’s Built-In Eval Metrics for AI Output: How Are They Different?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>LangChain’s Built-In Eval Metrics for AI Output: How Are They Different?</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/langchains-built-in-eval-metrics-for-ai-output-how-are-they-different-f9dd75e2de08?source=collection_archive---------9-----------------------#2024-05-22">https://towardsdatascience.com/langchains-built-in-eval-metrics-for-ai-output-how-are-they-different-f9dd75e2de08?source=collection_archive---------9-----------------------#2024-05-22</a></blockquote><div><div class="em ff fg fh fi fj"/><div class="fk fl fm fn fo"><div class="ab cb"><div class="ci bh ew ex ey ez"><div><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="gs gt gu gv gw ab"><div><div class="ab gx"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@jonathan.bennion?source=post_page---byline--f9dd75e2de08--------------------------------" rel="noopener follow"><div class="l gy gz by ha hb"><div class="l ed"><img alt="Jonathan Bennion" class="l ep by dd de cx" src="../Images/e2d9add564ee2ac0deb7863537b0ee73.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/0*6r8v2iMQ2xARWIzx.jpg"/><div class="hc by l dd de em n hd eo"/></div></div></a></div></div><div class="he ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--f9dd75e2de08--------------------------------" rel="noopener follow"><div class="l hf hg by ha hh"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hi cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hc by l br hi em n hd eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hj ab q"><div class="ab q hk"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hl hm bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hn" data-testid="authorName" href="https://medium.com/@jonathan.bennion?source=post_page---byline--f9dd75e2de08--------------------------------" rel="noopener follow">Jonathan Bennion</a></p></div></div></div><div class="ho hp l"><div class="ab hq"><div class="ab"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewbox="0 0 16 16"><path fill="#437AFF" d="M15.163 8c0 .65-.459 1.144-.863 1.575-.232.244-.471.5-.563.719s-.086.543-.092.875c-.006.606-.018 1.3-.49 1.781-.47.481-1.15.494-1.744.5-.324.006-.655.013-.857.094s-.465.337-.704.575c-.422.412-.906.881-1.542.881-.637 0-1.12-.469-1.543-.881-.239-.238-.49-.482-.704-.575-.214-.094-.532-.088-.857-.094-.593-.006-1.273-.019-1.744-.5s-.484-1.175-.49-1.781c-.006-.332-.012-.669-.092-.875-.08-.207-.33-.475-.563-.719-.404-.431-.863-.925-.863-1.575s.46-1.144.863-1.575c.233-.244.472-.5.563-.719.092-.219.086-.544.092-.875.006-.606.019-1.3.49-1.781s1.15-.494 1.744-.5c.325-.006.655-.012.857-.094.202-.081.465-.337.704-.575C7.188 1.47 7.671 1 8.308 1s1.12.469 1.542.881c.239.238.49.481.704.575s.533.088.857.094c.594.006 1.273.019 1.745.5.47.481.483 1.175.49 1.781.005.331.011.669.091.875s.33.475.563.719c.404.431.863.925.863 1.575"/><path fill="#fff" d="M7.328 10.5c.195 0 .381.08.519.22.137.141.215.331.216.53 0 .066.026.13.072.177a.24.24 0 0 0 .346 0 .25.25 0 0 0 .071-.177c.001-.199.079-.389.216-.53a.73.73 0 0 1 .519-.22h1.959c.13 0 .254-.053.346-.146a.5.5 0 0 0 .143-.354V6a.5.5 0 0 0-.143-.354.49.49 0 0 0-.346-.146h-1.47c-.324 0-.635.132-.865.366-.23.235-.359.552-.359.884v2.5c0 .066-.025.13-.071.177a.24.24 0 0 1-.346 0 .25.25 0 0 1-.072-.177v-2.5c0-.332-.13-.65-.359-.884A1.21 1.21 0 0 0 6.84 5.5h-1.47a.49.49 0 0 0-.346.146A.5.5 0 0 0 4.88 6v4c0 .133.051.26.143.354a.49.49 0 0 0 .347.146z"/></svg></div></div></div><span class="hr hs" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hl hm dx"><button class="ht hu ah ai aj ak al am an ao ap aq ar hv hw hx" disabled="">Follow</button></p></div></div></span></div></div><div class="l hy"><span class="bf b bg z dx"><div class="ab cn hz ia ib"><div class="ic id ab"><div class="bf b bg z dx ab ie"><span class="if l hy">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hn ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--f9dd75e2de08--------------------------------" rel="noopener follow"><p class="bf b bg z ig ih ii ij ik il im in bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hr hs" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">5 min read</span><div class="io ip l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">May 22, 2024</span></div></span></div></span></div></div></div><div class="ab cp iq ir is it iu iv iw ix iy iz ja jb jc jd je jf"><div class="h k w ea eb q"><div class="jv l"><div class="ab q jw jx"><div class="pw-multi-vote-icon ed if jy jz ka"><div class=""><div class="kb kc kd ke kf kg kh am ki kj kk ka"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kl km kn ko kp kq kr"><p class="bf b dy z dx"><span class="kc">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kb ks kt ab q ee ku kv" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="kw"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jg jh ji jj jk jl jm jn jo jp jq jr js jt ju"><div class="kx k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al ky an ao ap hv kz la lb" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lc cn"><div class="l ae"><div class="ab cb"><div class="ld le lf lg lh li ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al ky an ao ap hv lj lk kv ll lm ln lo lp s lq lr ls lt lu lv lw u lx ly lz"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al ky an ao ap hv lj lk kv ll lm ln lo lp s lq lr ls lt lu lv lw u lx ly lz"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al ky an ao ap hv lj lk kv ll lm ln lo lp s lq lr ls lt lu lv lw u lx ly lz"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="971a" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">I’ve created custom metrics most often for my own use cases, but have come across these built-in metrics for AI tools in LangChain repeatedly before I’d started using RAGAS and/or DeepEval for RAG evaluation, so finally was curious on how these metrics are created and ran a quick analysis (with all inherent bias of course).</p><p id="4f26" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk"><strong class="mc fs"><em class="my">TLDR is from the correlation matrix below:</em></strong></p><ul class=""><li id="44af" class="ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx mz na nb bk"><strong class="mc fs"><em class="my">Helpfulness and Coherence (0.46 correlation)</em></strong><em class="my">: This strong correlation suggests that the LLM (and by proxy, users) could find coherent responses more helpful, emphasizing the importance of logical structuring in responses. It is just correlation, but this relationship opens the possibility for this takeaway.</em></li><li id="fad8" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk"><strong class="mc fs"><em class="my">Controversiality and Criminality (0.44 correlation)</em></strong><em class="my">: This indicates that even controversial content could be deemed criminal, and vice versa, perhaps reflecting a user preference for engaging and thought-provoking material.</em></li><li id="2dc4" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk"><strong class="mc fs"><em class="my">Coherence vs. Depth:</em></strong> <em class="my">Despite coherence correlating with helpfulness, depth does not. This might suggest that users (again, assuming user preferences are inherent in the output of the LLM — this alone is a presumption and a bias that is important to be concious of) could prefer clear and concise answers over detailed ones, particularly in contexts where quick solutions are valued over comprehensive ones.</em></li></ul><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni nj"><img src="../Images/2934a7023672ad3ffd5a80c6b8bfbe3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*np0RX9_r4B1UTPFK00Q9kw.png"/></div></div></figure><p id="a5b5" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">The built-in metrics are found here (removing one that relates to ground truth and better handled elsewhere):</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="cab5" class="nz oa fr nw b bg ob oc l od oe"># Listing Criteria / LangChain's built-in metrics<br/>from langchain.evaluation import Criteria<br/>new_criteria_list = [item for i, item in enumerate(Criteria) if i != 2]<br/>new_criteria_list</span></pre><h2 id="72c3" class="of oa fr bf og oh oi oj ok ol om on oo ml op oq or mp os ot ou mt ov ow ox oy bk">The metrics:</h2><ul class=""><li id="50c9" class="ma mb fr mc b md oz mf mg mh pa mj mk ml pb mn mo mp pc mr ms mt pd mv mw mx mz na nb bk">Conciseness</li><li id="d967" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Detail</li><li id="46b7" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Relevance</li><li id="4862" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Coherence</li><li id="ebfe" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Harmfulness</li><li id="fdbd" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Insensitivity</li><li id="cc95" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Helpfulness</li><li id="ec48" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Controversiality</li><li id="eb4f" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Criminality</li><li id="3dcd" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Depth</li><li id="c731" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk">Creativity</li></ul><blockquote class="pe pf pg"><p id="136d" class="ma mb my mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">First, what do these mean, and why were they created?</p></blockquote><h2 id="5cdf" class="of oa fr bf og oh oi oj ok ol om on oo ml op oq or mp os ot ou mt ov ow ox oy bk">The hypothesis:</h2><ul class=""><li id="5eef" class="ma mb fr mc b md oz mf mg mh pa mj mk ml pb mn mo mp pc mr ms mt pd mv mw mx mz na nb bk">These were created in an attempt to define metrics that could explain output in relation to theoretical use case goals, and any correlation could be accidental but was generally avoided where possible.</li></ul><p id="2b9e" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">I have this hypothesis after seeing <a class="af ph" href="https://api.python.langchain.com/en/latest/_modules/langchain/evaluation/criteria/eval_chain.html" rel="noopener ugc nofollow" target="_blank">this source code here</a>.</p><blockquote class="pe pf pg"><p id="c5cc" class="ma mb my mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">Second, some of these seem similar and/or vague — so how are these different?</p></blockquote><p id="da32" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">I used a standard SQuAD dataset as a baseline to evaluate the differences (if any) between output from OpenAI’s GPT-3-Turbo model and the ground truth in this dataset, and compare.</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="2ddc" class="nz oa fr nw b bg ob oc l od oe"># Import a standard SQUAD dataset from HuggingFace (ran in colab)<br/>from google.colab import userdata<br/>HF_TOKEN = userdata.get('HF_TOKEN')<br/><br/>dataset = load_dataset("rajpurkar/squad")<br/>print(type(dataset))</span></pre><p id="ff67" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">I obtained a randomized set of rows for evaluation (could not afford timewise and compute for the whole thing), so this could be an entrypoint for more noise and/or bias.</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="e587" class="nz oa fr nw b bg ob oc l od oe"># Slice dataset to randomized selection of 100 rows<br/>validation_data = dataset['validation']<br/>validation_df = validation_data.to_pandas()<br/>sample_df = validation_df.sample(n=100, replace=False)</span></pre><p id="9c48" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">I defined an llm using ChatGPT 3.5 Turbo (to save on cost here, this is quick).</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="e4a4" class="nz oa fr nw b bg ob oc l od oe">import os<br/><br/># Import OAI API key<br/>OPENAI_API_KEY = userdata.get('OPENAI_API_KEY')<br/>os.environ['OPENAI_API_KEY'] = userdata.get('OPENAI_API_KEY')<br/># Define llm<br/>llm = ChatOpenAI(model_name='gpt-3.5-turbo', openai_api_key=OPENAI_API_KEY)</span></pre><p id="65be" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">Then iterated through the sampled rows to gather a comparison — there were unknown thresholds that LangChain used for ‘score’ in the evaluation criteria, but the assumption is that they are defined the same for all metrics.</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="35b5" class="nz oa fr nw b bg ob oc l od oe"># Loop through each question in random sample<br/>for index, row in sample_df.iterrows():<br/>    try:<br/>        prediction = " ".join(row['answers']['text'])<br/>        input_text = row['question']<br/><br/>        # Loop through each criteria\<br/>        for m in new_criteria_list:<br/>            evaluator = load_evaluator("criteria", llm=llm, criteria=m)<br/><br/>            eval_result = evaluator.evaluate_strings(<br/>                prediction=prediction,<br/>                input=input_text,<br/>                reference=None,<br/>                other_kwarg="value"  # adding more in future for compare<br/>            )<br/>            score = eval_result['score']<br/>            if m not in results:<br/>                results[m] = []<br/>            results[m].append(score)<br/>    except KeyError as e:<br/>        print(f"KeyError: {e} in row {index}")<br/>    except TypeError as e:<br/>        print(f"TypeError: {e} in row {index}")</span></pre><p id="7e54" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">Then I calculated means and CI at 95% confidence intervals.</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="9fab" class="nz oa fr nw b bg ob oc l od oe"># Calculate means and confidence intervals at 95%<br/>mean_scores = {}<br/>confidence_intervals = {}<br/><br/>for m, scores in results.items():<br/>    mean_score = np.mean(scores)<br/>    mean_scores[m] = mean_score<br/>    # Standard error of the mean * t-value for 95% confidence<br/>    ci = sem(scores) * t.ppf((1 + 0.95) / 2., len(scores)-1)<br/>    confidence_intervals[m] = (mean_score - ci, mean_score + ci)</span></pre><p id="7157" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">And plotted the results.</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="182e" class="nz oa fr nw b bg ob oc l od oe"># Plotting results by metric<br/>fig, ax = plt.subplots()<br/>m_labels = list(mean_scores.keys())<br/>means = list(mean_scores.values())<br/>cis = [confidence_intervals[m] for m in m_labels]<br/>error = [(mean - ci[0], ci[1] - mean) for mean, ci in zip(means, cis)]]<br/><br/>ax.bar(m_labels, means, yerr=np.array(error).T, capsize=5, color='lightblue', label='Mean Scores with 95% CI')<br/>ax.set_xlabel('Criteria')<br/>ax.set_ylabel('Average Score')<br/>ax.set_title('Evaluation Scores by Criteria')<br/>plt.xticks(rotation=90)<br/>plt.legend()<br/>plt.show()</span></pre><p id="e669" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">This is possibly intuitive that ‘Relevance’ is so much higher than the others, but interesting that overall they are so low (maybe thanks to GPT 3.5!), and that ‘Helpfulness’ is next highest metric (possibly reflecting RL techniques and optimizations).</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div class="nh ni pi"><img src="../Images/06c0aec539a408ad7380c763433a4d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*QUDHmxF4dbKSYzLIzNhvzw.png"/></div></figure><p id="54e5" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">To answer my question on correlation, I’d calculated a simple correlation matrix with the raw comparison dataframe.</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="2ba8" class="nz oa fr nw b bg ob oc l od oe"># Convert results to dataframe<br/>min_length = min(len(v) for v in results.values())<br/>dfdata = {k.name: v[:min_length] for k, v in results.items()}<br/>df = pd.DataFrame(dfdata)<br/><br/># Filtering out null values<br/>filtered_df = df.drop(columns=[col for col in df.columns if 'MALICIOUSNESS' in col or 'MISOGYNY' in col])<br/><br/># Create corr matrix<br/>correlation_matrix = filtered_df.corr()</span></pre><p id="ca9c" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">Then plotted the results (p values are created <a class="af ph" href="https://github.com/j-space-b/eval_analysis/blob/main/evaluation_metrics_corrplot.ipynb" rel="noopener ugc nofollow" target="_blank">further down in my code</a> and were all under .05)</p><pre class="nk nl nm nn no nv nw nx bp ny bb bk"><span id="3ace" class="nz oa fr nw b bg ob oc l od oe"># Plot corr matrix<br/>mask = np.triu(np.ones_like(correlation_matrix, dtype=bool))<br/>plt.figure(figsize=(10, 8))<br/>sns.heatmap(correlation_matrix, mask=mask, annot=True, fmt=".2f", cmap='coolwarm',<br/>            cbar_kws={"shrink": .8})<br/>plt.title('Correlation Matrix - Built-in Metrics from LangChain')<br/>plt.xticks(rotation=90)<br/>plt.yticks(rotation=0)<br/>plt.show()</span></pre><p id="ccb4" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">Was surprising that most do not correlate, given the nature of the descriptions in the LangChain codebase — this lends to something a bit more thought out, and am glad these are built-in for use.</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni nj"><img src="../Images/2934a7023672ad3ffd5a80c6b8bfbe3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*np0RX9_r4B1UTPFK00Q9kw.png"/></div></div></figure><p id="725e" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">From the correlation matrix, notable relationships emerge:</p><ul class=""><li id="b738" class="ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx mz na nb bk"><em class="my">Helpfulness and Coherence (0.46 correlation):</em> This strong correlation suggests that the LLM (as it is a proxy for users) could find coherent responses more helpful, emphasizing the importance of logical structuring in responses. Even though this is correlation, this relationship paves the way for this.</li><li id="73ef" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx mz na nb bk"><em class="my">Controversiality and Criminality (0.44 correlation):</em> This indicates that even controversial content could be deemed criminal, and vice versa, perhaps reflecting a user preference for engaging and thought-provoking material. Again, this is only correlation.</li></ul><p id="1117" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">Takeaways:</p><ol class=""><li id="31fe" class="ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx pj na nb bk"><strong class="mc fs">Coherence vs. Depth in Helpfulness: </strong>Despite coherence correlating with helpfulness, depth does not. This might suggest that users could prefer clear and concise answers over detailed ones, particularly in contexts where quick solutions are valued over comprehensive ones.</li><li id="1050" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx pj na nb bk"><strong class="mc fs">Leveraging Controversiality:</strong> The positive correlation between controversiality and criminality poses an interesting question: Can controversial topics be discussed in a way that is not criminal? This could potentially increase user engagement without compromising on content quality.</li><li id="65e3" class="ma mb fr mc b md nc mf mg mh nd mj mk ml ne mn mo mp nf mr ms mt ng mv mw mx pj na nb bk"><strong class="mc fs">Impact of Bias and Model Choice:</strong> The use of GPT-3.5 Turbo and the inherent biases in metric design could influence these correlations. Acknowledging these biases is essential for accurate interpretation and application of these metrics.</li></ol><p id="81b8" class="pw-post-body-paragraph ma mb fr mc b md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx fk bk">Unless otherwise noted, all images in this article created by the author.</p></div></div></div></div>    
</body>
</html>