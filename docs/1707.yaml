- en: 'Predictive Marketing Mix Modeling with GLOP: The Perfect Cocktail Shaker'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: ÂéüÊñáÔºö[https://towardsdatascience.com/predictive-marketing-mix-modeling-with-glop-the-perfect-cocktail-shaker-1f071b18efc4?source=collection_archive---------7-----------------------#2024-07-12](https://towardsdatascience.com/predictive-marketing-mix-modeling-with-glop-the-perfect-cocktail-shaker-1f071b18efc4?source=collection_archive---------7-----------------------#2024-07-12)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Maximizing profit using ML and GLOP (by Google) in the digital landscape
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@gonzaloespinosaduelo?source=post_page---byline--1f071b18efc4--------------------------------)[![Gonzalo
    Espinosa Duelo](../Images/bdd4d285728c682b619138ed6e5bffaf.png)](https://medium.com/@gonzaloespinosaduelo?source=post_page---byline--1f071b18efc4--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--1f071b18efc4--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--1f071b18efc4--------------------------------)
    [Gonzalo Espinosa Duelo](https://medium.com/@gonzaloespinosaduelo?source=post_page---byline--1f071b18efc4--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ¬∑Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--1f071b18efc4--------------------------------)
    ¬∑11 min read¬∑Jul 12, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cca3b59d4a7df611d19db4181f181e22.png)'
  prefs: []
  type: TYPE_IMG
- en: Image generated with DALL-E
  prefs: []
  type: TYPE_NORMAL
- en: üçπEngineering the perfect coktail
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Imagine walking into a sophisticated bar. Jazzy music is playing and a stylish
    bartender is preparing a fancy cocktail. The bartender, a maestro of mixology,
    is not just tossing random ingredients into a shaker and hoping for the best.
    He‚Äôs using all his knowledge and experience, refined over years of practice, to
    create the perfect blend. He knows which ingredients complement each other, which
    ratios produce the best flavors, and how to adjust the mix based on your preferences
    and feedback.
  prefs: []
  type: TYPE_NORMAL
- en: Like a bartender crafting the perfect cocktail, **marketers face the challenging
    task of finding the ideal mix of acquisition channels** to optimize their advertising
    budgets and maximize conversion.
  prefs: []
  type: TYPE_NORMAL
- en: In this process, Return on Ad Spend (ROAS) is the jigger ‚Äî the critical metric
    that can determine the success or failure of a campaign.
  prefs: []
  type: TYPE_NORMAL
- en: ROAS = Revenue attributable to ads / Cost of ads
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In today‚Äôs marketing context, many campaigns still operate on a **trial-and-error**
    basis. Marketers act **reactively** to performance. When a campaign performs well,
    they increase investment; otherwise, they reduce it.
  prefs: []
  type: TYPE_NORMAL
- en: For business models with a long maturation period, where the sales process takes
    several days to close, this trial-and-error strategy is less reactive and can
    be painful. They need a more proactive strategy.
  prefs: []
  type: TYPE_NORMAL
- en: Other traditional methods try to anticipate ROAS relying heavily on descriptive
    historical data. Marketers look at past performance, **balancing recent weeks
    and year-over-year (YoY) data** to identify trends and make educated guesses about
    what might work in the future.
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately, these assumptions also fail.
  prefs: []
  type: TYPE_NORMAL
- en: Market dynamics change rapidly, and competitors emerge with similar marketing
    strategies, resulting in a **conversion that appears volatile and leads to significant
    ROAS fluctuations**. Historical conversion patterns are insufficiently precise
    to anticipate campaign behavior.
  prefs: []
  type: TYPE_NORMAL
- en: For marketers, this **unpredictability** is more than just a nuisance ‚Äî it‚Äôs
    a significant roadblock. Every dollar spent on an ad campaign is a bet placed
    on the hope of a positive return. When campaigns fail to deliver, it not only
    impacts the bottom line, but also erodes confidence in marketing strategies from
    the sales team, whose chances of success are directly harmed when they receive
    lower quality leads.
  prefs: []
  type: TYPE_NORMAL
- en: Apart from achieving the best performance, marketers should focus on **providing
    leads to sales teams** and ensuring that all teams receive an adequate volume
    of leads. Marketing is responsible for sustaining the sales network, with both
    quantity and quality. A shortage of leads would constitute a serious problem that
    would negatively impact sales.
  prefs: []
  type: TYPE_NORMAL
- en: However, allocating campaign investments is a complex task. Marketers must precisely
    determine the budget assigned to each channel and campaign, despite the uncertainty
    surrounding CPLs, conversion rates, and the volume of leads generated.
  prefs: []
  type: TYPE_NORMAL
- en: Campaign calibration is a complex task, and marketers often struggle with it.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '**Predictive Marketing Mix Modeling (PMMM)** attends this marketer‚Äôs need.
    Determines the **best combination of investment** in each campaign or acquisition
    channel, attending both ROAS performance and volume constrains.'
  prefs: []
  type: TYPE_NORMAL
- en: The goal is to maximize profit while ensuring every sales team gets an appropriate
    number of leads.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In this article, I present how I approached PMMM by combining Linear Optimization
    and Machine Learning, addressing the classical **resource allocation** problem
    with a **predictive component** based on ML.
  prefs: []
  type: TYPE_NORMAL
- en: üìà Business Case
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In 2023, I faced a Marketing Mix Modeling case for a leading company in the
    education sector in Spain.
  prefs: []
  type: TYPE_NORMAL
- en: They were running permanent campaigns for **three** **product types** across
    **six different paid acquisition channels**. Some platforms had a fixed price
    per lead due to contracts with lead generators like Educaedu and Emagister. In
    contrast, other platforms, such as Google Ads and Meta Ads, provided leads with
    a **variable cost per lead** (CPL). This variability introduced the first level
    of **complexity and uncertainty** to the problem.
  prefs: []
  type: TYPE_NORMAL
- en: Understanding the effect of CPL in channels is crucial
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The MMM status of the company in the **previous quarter** was as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c7b62221636c740c32b2c8024095144d.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: As the table shows, the channel with better ROAS was Emagister, while Educaedu
    provided the worst. This should be translated in our MMM model, as **channels
    over the average ROAS likely are an opportunity of investment**.
  prefs: []
  type: TYPE_NORMAL
- en: What about Sales Force?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The company operated **15 educational institutions** across various locations
    in Spain. Naturally, their campaigns were segmented by region, as were their sales
    teams. Each team had a specific number of sales agents with a finite monthly capacity
    for handling leads.
  prefs: []
  type: TYPE_NORMAL
- en: 'This added constraints to our problem:'
  prefs: []
  type: TYPE_NORMAL
- en: We needed to ensure a minimum number of leads monthly for each center without
    exceeding the limit that would overwhelm the sales organization.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Considering a monthly budget allocated for marketing campaigns, the objective
    was to **select the amount to invest in each channel to maximize profit** while
    ensuring that the **sales force received sufficient leads**.
  prefs: []
  type: TYPE_NORMAL
- en: 'üö® **SPOILER**: The solution achieved an awesome **+13.8% profit** by combining
    GLOP and ML. Check out how I came to the solution below.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ü™µü™®ü™ô Resource allocation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Resource allocation involve the process of distributing available resources
    among various competing tasks in a manner that maximizes an objective. In our
    case, the key concepts that define the resource allocation problem are the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Key Concepts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Objective**: The goal that the allocation process aims to achieve. For this
    business case, the objective is maximixing profit.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Resources**: These can be anything that is required to complete tasks. In
    our case, **marketing budget and sales requirements.**'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Tasks**: The activities that require resources to be completed. In our case,
    **selecting channels and campaigns** that have the potential to offer the highest
    profit.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'This kind of problem faces with multiple challenges, briefly summarized as
    follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Complexity**: Many resource allocation problems are NP-hard, meaning they
    are computationally difficult to solve.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In our business case, I faced this complexity using **GLOP**. I addressed the
    complexity by considering some **validated assumptions** to be able to use a linear
    optimization. More detail below.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '**Constraints**: Real-world limitations, such as budget limits and resource
    capacities must be considered.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Uncertainty**: Future behaviours of campaign performance may be uncertain,
    complicating the estimates.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In this business case, the conversion rates (CR) of channels across different
    schools and products were uncertain and far from constant. Before using GLOP programming,
    I developed a Lead Scoring model based on **XGBoost** to predict conversion, as
    the sales lifecycle was too long to rely on short-term patterns. This model performed
    excellently, achieving an **AUC of 85% and a log-loss of 0.1** in out-of-time
    (OOT) testing, significantly reducing revenue uncertainty of CR. Having an accurate
    Lead Scoring model, the only thing left to do is to **average prediction values**
    to get the expected conversion for each segment.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ü§ì Formulation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To formulate the optimization problem based on the business case, let‚Äôs break
    down the necessary variables, objective and constraints.
  prefs: []
  type: TYPE_NORMAL
- en: Definitions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](../Images/e6d494d211bd3692364e04a4d2dcb6cc.png)'
  prefs: []
  type: TYPE_IMG
- en: Reminder that conversion rate is an expected value, which is predicted through
    a Lead Scoring model. Other components are based on averages from previous months
    of historical data.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Objective
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Maximize the sum of profit over channels, schools, and product type, depending
    on cost.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4e3ba38c708e2e7b4068fc94aca8276b.png)![](../Images/7df3b3cd6bef0e91b6b863a729f234c6.png)'
  prefs: []
  type: TYPE_IMG
- en: 'where volume is:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/839934c24216b5a839295abf5297d33b.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Substituting the profit expression, we get:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/f5879e148857088511235684fb06f129.png)'
  prefs: []
  type: TYPE_IMG
- en: Images by author
  prefs: []
  type: TYPE_NORMAL
- en: Constrains
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Non-negativity constraint:**'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The investment should be non-negative.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/002f4c2ad1133bb72a9994639b6b87d1.png)'
  prefs: []
  type: TYPE_IMG
- en: '2. **Budget Constraints**:'
  prefs: []
  type: TYPE_NORMAL
- en: The sum of all costs must exactly equal the total budget ***B***.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/284c1ba0457e5e4b0e64d5b7cd74657b.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Each channel *i* can exceed a specific budget***B****i*:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9cded16471af71809630d949345ded10.png)'
  prefs: []
  type: TYPE_IMG
- en: '3\. **Lead Generated**:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Each school *j* must receive a number of leads within a specified range, bounded
    by a minimum and a maximum ***L***:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/91441577ec37241106170e5fd6ba57a9.png)'
  prefs: []
  type: TYPE_IMG
- en: Images by author
  prefs: []
  type: TYPE_NORMAL
- en: 4\. **Deviation from baseline**
  prefs: []
  type: TYPE_NORMAL
- en: Apart from the required constraints, the company wanted to add an additional
    constraint referring to the maximum deviation from their baseline.
  prefs: []
  type: TYPE_NORMAL
- en: Every month, an investment baseline was defined by the company (calculated by
    a marketer). The output should deviate a maximum of 30%.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/84d51bdf9a50c2b082cc240aa83f7b5a.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: Assumptions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: From Non-Linear to Linear
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Note that, due to the dependency of CPL on cost for some channels (Google and
    Meta Ads), **this problem is inherently non-linear.**
  prefs: []
  type: TYPE_NORMAL
- en: However, if the range of cost deviations is limited, the variation in CPL is
    correspondingly constrained. Given that we are starting from a baseline and allowing
    for a maximum variation of 30%, we can reasonably assume that this condition holds,
    and an **approximately constant CPL for each channel can be assumed**.
  prefs: []
  type: TYPE_NORMAL
- en: To estimate the CPL, we will use the previous month‚Äôs CPL data. Although this
    approach may introduce some discrepancies compared to the actual CPL, it is still
    an improvement over the baseline.
  prefs: []
  type: TYPE_NORMAL
- en: In case you need a solution to cover significant changes in investments, you
    should use a non-linear optimizer. Often, the dependency of CPL vs. total investment
    in digital platforms is linear. It can be modeled with a simple linear regression,
    resulting in a quadratic programming. However, I recommend you check it with data.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'With a constant CPL, then:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/476085199734089adb1b02795174fb41.png)'
  prefs: []
  type: TYPE_IMG
- en: and
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1089c8cd45f2c3b4a22573a9e0dca6c6.png)'
  prefs: []
  type: TYPE_IMG
- en: Images by author
  prefs: []
  type: TYPE_NORMAL
- en: With such adjustment, the **problem became linear**.
  prefs: []
  type: TYPE_NORMAL
- en: 'Other assumptions:'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Given that in some campaigns *ijk* the volume of historical data was low, other
    assumptions were included as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**The conversion Rate (CR) does not depend on investment.** This is hard to
    assume. CR mainly depends on sales performance and market dynamics, but also on
    lead quality. Lead quality directly depends on the type of leads received from
    the channel. Some channels may provide better lead quality than others, what we
    are able to measure. However, each channel decides the quality of leads send us
    based on various factors and one can be the amount invested. For instance, they
    can decide whether to show our ad in the top position or not, and this decision
    can be influenced by our investment.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: I assumed that CR didn‚Äôt depend on investment because I could predict it with
    a low log-loss out-of-time error, indicating an excellent model fit. This means
    the variables used, which didn‚Äôt include investment, reduced other unseen factors
    to low-impact noise. The effect of investment on CR should be minimal.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**CPL is constant for each channel.** In fact, CPL may vary within a channel
    and should be calculated for each campaign (ijk), but some campaigns have low
    volume, increasing their uncertainty significantly. For this reason, I used the
    channel‚Äôs CPL. Then:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../Images/09f46021cb04980c4486883fd05097d0.png)'
  prefs: []
  type: TYPE_IMG
- en: and
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8fc9e2b1a4a3894891f6d5139e32c776.png)'
  prefs: []
  type: TYPE_IMG
- en: Images by author
  prefs: []
  type: TYPE_NORMAL
- en: üßÆ Solving an LP Problem using GLOP (by Google)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: GLOP (Google Linear Optimization Package) is a linear programming solver that
    is part of Google‚Äôs OR-Tools, an open-source software suite for optimization.
    GLOP is designed to solve linear programming problems, which involve finding the
    best outcome in a mathematical model whose requirements are represented by linear
    relationships.
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://developers.google.com/optimization/lp/lp_example?source=post_page-----1f071b18efc4--------------------------------)
    [## Solving an LP Problem | OR-Tools | Google for Developers'
  prefs: []
  type: TYPE_NORMAL
- en: 'The following sections present an example of an LP problem and show how to
    solve it. Here''s the problem: Maximize 3x +‚Ä¶'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: developers.google.com](https://developers.google.com/optimization/lp/lp_example?source=post_page-----1f071b18efc4--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: GLOP is a highly efficient implementation of a primal-dual hybrid algorithm,
    and it is super easy to implement. I used it to solve our resource allocation
    problem by coding it in a few hours.
  prefs: []
  type: TYPE_NORMAL
- en: Concretely, I used the module [**pywraplp**](https://developers.google.com/optimization/reference/python/linear_solver/pywraplp)from
    **or-tools**, where GLOP is one of the solvers provided.
  prefs: []
  type: TYPE_NORMAL
- en: By using this module, the formulation could be easily transformed into code,
    allowing to calculate the best solution.
  prefs: []
  type: TYPE_NORMAL
- en: üõéÔ∏è Please comment below if you are interested in the code.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: üöÄ Results
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The implementation of this MMM using GLOP was tested on the **next quarter**,
    providing impressive results as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/24eac96f0f418e5efe204ed3cca7f489.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: üí• The solution achieved an impressive +13.86% üí•
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The distribution of investment in channel changed significantly with respect
    to the baseline defined by the marketing team, without overpassing the 30% (as
    constrained).
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the **percentual difference in investment for each channel** during
    the first three months was as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e5a5df54e4b6f893a48351818f360eaa.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: Notice Emagister & Meta were the most underestimated, on the other hand, Educaedu
    and Google Ads were the most overvalued.
  prefs: []
  type: TYPE_NORMAL
- en: '**The channel distribution is correlated with ROAS, but does not precisely
    align with the observed lift in ROAS**. The optimal allocation is influenced by
    volume constraints and is contingent upon the efficacy of specific channels in
    generating leads for schools (based on location) and various products. Consequently,
    channel distribution may exhibit variability.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Note: The effectiveness of each platform depends on multiple factors like target
    audience, business model, type of campaigns and others. This is not marketing
    investment advice. It is just a specific example.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: üèÜ KEYS to SUCCESS
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: During the process of developing this project, I identified key points that
    were crucial to achieving that great performance.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is a summary:'
  prefs: []
  type: TYPE_NORMAL
- en: '**The impressive performance of GLOP.** This package quickly reaches the optimal
    solution, making it highly efficient for linear programming tasks. Its **speed
    and accuracy** in solving complex optimization problems significantly enhance
    project outcomes. Equally important is its their **intuitive classes and functions**,
    which make it easy to transform the formulation into code. GLOP has proven to
    be excellent for resource allocation problems.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Ability to accurately predict conversion rates (CR) through Predictive Lead
    Scoring based on machine learning (ML).** Special mention for achieving a **low
    log-loss error**, which not only allowed for good discrimination but was especially
    relevant in **minimizing the error between the average probability and the actual
    conversion rate**. This significantly reduce uncertainty.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**Ability to precisely identify the CPL for each segment through statistical
    analysis (without necessity of any ML).** This allows to identify the volume of
    leads provided in function of investment for each segment, as well as **simplify
    the complexity to a linear problem**. Watch out! It can be trickier if you use
    high variations in investments for campaigns, as the constant CPL couldn‚Äôt be
    assumed.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Final notes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Thank you for reading!
  prefs: []
  type: TYPE_NORMAL
- en: Please leave a comment if you have any thoughts or questions. Your feedback
    is valuable to me, and I appreciate hearing from readers.
  prefs: []
  type: TYPE_NORMAL
- en: Also, let me know if you are interested in more details about the ML model used
    as part of this algorithm or if you need more information about GLOP. I‚Äôm considering
    writing another article about it.
  prefs: []
  type: TYPE_NORMAL
- en: Stay tuned for more insightful articles and updates!
  prefs: []
  type: TYPE_NORMAL
- en: Don‚Äôt forget to follow for the latest content and discussions. Your support
    means everything to me!
  prefs: []
  type: TYPE_NORMAL
