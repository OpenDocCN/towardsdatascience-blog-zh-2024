<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Building a Research Assistant That Can Write to Google Docs (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Building a Research Assistant That Can Write to Google Docs (Part 2)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-research-assistant-that-can-write-to-google-docs-part-2-ac9dcacff4ff?source=collection_archive---------9-----------------------#2024-11-20">https://towardsdatascience.com/building-a-research-assistant-that-can-write-to-google-docs-part-2-ac9dcacff4ff?source=collection_archive---------9-----------------------#2024-11-20</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="fr fs ft fu fv fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp fq"><img src="../Images/84311f1635442fb3094ebc3095549255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NyLck27kmsq7AkmuDiHjzA.png"/></div></div><figcaption class="gd ge gf fo fp gg gh bf b bg z dx">Dalle-3’s interpretation of “An AI assistant throwing documents to the wind over a clear blue ocean”. Image generated by the author.</figcaption></figure><div/><div><h2 id="c4be" class="pw-subtitle-paragraph hh gj gk bf b hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw cq dx">A tool that might help with your homework</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hx hy hz ia ib ab"><div><div class="ab ic"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@rmartinshort?source=post_page---byline--ac9dcacff4ff--------------------------------" rel="noopener follow"><div class="l id ie by if ig"><div class="l ed"><img alt="Robert Martin-Short" class="l ep by dd de cx" src="../Images/e3910071b72a914255b185b850579a5a.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*-jfunT2ldyjlLaMX0t8PDA.jpeg"/><div class="ih by l dd de em n ii eo"/></div></div></a></div></div><div class="ij ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--ac9dcacff4ff--------------------------------" rel="noopener follow"><div class="l ik il by if im"><div class="l ed"><img alt="Towards Data Science" class="l ep by br in cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ih by l br in em n ii eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="io ab q"><div class="ab q ip"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b iq ir bk"><a class="af ag ah ai aj ak al am an ao ap aq ar is" data-testid="authorName" href="https://medium.com/@rmartinshort?source=post_page---byline--ac9dcacff4ff--------------------------------" rel="noopener follow">Robert Martin-Short</a></p></div></div></div><span class="it iu" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b iq ir dx"><button class="iv iw ah ai aj ak al am an ao ap aq ar ix iy iz" disabled="">Follow</button></p></div></div></span></div></div><div class="l ja"><span class="bf b bg z dx"><div class="ab cn jb jc jd"><div class="je jf ab"><div class="bf b bg z dx ab jg"><span class="jh l ja">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar is ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--ac9dcacff4ff--------------------------------" rel="noopener follow"><p class="bf b bg z ji jj jk jl jm jn jo jp bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="it iu" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">12 min read</span><div class="jq jr l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Nov 20, 2024</span></div></span></div></span></div></div></div><div class="ab cp js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh"><div class="h k w ea eb q"><div class="kx l"><div class="ab q ky kz"><div class="pw-multi-vote-icon ed jh la lb lc"><div class=""><div class="ld le lf lg lh li lj am lk ll lm lc"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ln lo lp lq lr ls lt"><p class="bf b dy z dx"><span class="le">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao ld lu lv ab q ee lw lx" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="ly"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q ki kj kk kl km kn ko kp kq kr ks kt ku kv kw"><div class="lz k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al ma an ao ap ix mb mc md" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep me cn"><div class="l ae"><div class="ab cb"><div class="mf mg mh mi mj gb ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al ma an ao ap ix mk ml lx mm mn mo mp mq s mr ms mt mu mv mw mx u my mz na"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al ma an ao ap ix mk ml lx mm mn mo mp mq s mr ms mt mu mv mw mx u my mz na"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al ma an ao ap ix mk ml lx mm mn mo mp mq s mr ms mt mu mv mw mx u my mz na"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div></div></div></div><div class="ab cb nb nc nd ne" role="separator"><span class="nf by bm ng nh ni"/><span class="nf by bm ng nh ni"/><span class="nf by bm ng nh"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="991b" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk"><strong class="nl gl"><em class="of">This article is the second of a two part series where we use LangGraph and Tavily to build a simple research agent, which writes and refines short articles. To keep track of the plans, articles and comments it generates we add the ability to programmatically create and edit Google Docs. In the first article we built the agent. Now we will build the docs connection. You can find all the relevant code</em></strong><a class="af og" href="https://github.com/rmartinshort/research_assist" rel="noopener ugc nofollow" target="_blank"><strong class="nl gl"><em class="of"> here</em></strong></a><strong class="nl gl"><em class="of">.</em></strong></p></div></div></div><div class="ab cb nb nc nd ne" role="separator"><span class="nf by bm ng nh ni"/><span class="nf by bm ng nh ni"/><span class="nf by bm ng nh"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="b909" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">In <a class="af og" rel="noopener" target="_blank" href="/building-a-research-agent-that-can-write-to-google-docs-part-1-4b49ea05a292">part 1 of this series</a> we discussed agents, and used tools from LangGraph and Tavily to build a minimal agent that can research, write, review and revise short articles. This is great for a demo, but what if we actually want to read those articles outside of a notebook? Or, more ambitiously, what if we can to make this agent into a tool that might actually be useful to someone learning about a new subject? This has the potential to become a full stack project, but here I will focus on just one interesting element — giving out system the ability to upload essays to Google Docs. Recall that we also save the intermediate steps that the agent takes in getting to the final answer too — probably its worth making a record of those as well.</p><h1 id="2603" class="oh oi gk bf oj ok ol hk om on oo hn op oq or os ot ou ov ow ox oy oz pa pb pc bk"><strong class="al">1. A minimal viable product</strong></h1><p id="942d" class="pw-post-body-paragraph nj nk gk nl b hi pd nn no hl pe nq nr ns pf nu nv nw pg ny nz oa ph oc od oe fj bk">In response to a question or topic prompt, our agent produces a long list of output. At a minimum, we’d like to dump this into a Google Doc with a title, and timestamp. We’d also like to control where in Google Drive this doc is to be written, and preferably have the option to create and name a folders so that our essays can be stored logically. We won’t focus too much on formatting here — although this is certainly possible using the Google Docs API — we are more interested in just getting the text into a place where someone would actually read it. Formatting could be a follow up, or simply left to the preference of the reader.</p><p id="77ce" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Once we have a docs connection set up, there’s a whole host of more advanced things we could do with our essay — what about using an LLM to reformat them for a presentation and uploading that into a Google Slides deck? Or scraping some referenced data source and uploading that to Google Sheets? We could add this functionality as tools inside the control flow of our agent and have it decide what to do. Clearly there’s a lot of options here but its good to start small.</p><h1 id="5c72" class="oh oi gk bf oj ok ol hk om on oo hn op oq or os ot ou ov ow ox oy oz pa pb pc bk">2. Connecting to Google Drive</h1><p id="24bf" class="pw-post-body-paragraph nj nk gk nl b hi pd nn no hl pe nq nr ns pf nu nv nw pg ny nz oa ph oc od oe fj bk">Let’s start by writing some code to interact with Google Docs in some basic ways. Some setup is required first: You will need a Google Cloud account and a new project. You will then need to enable the Google Drive and Google Docs APIs. To create some credentials for this project, we will be using a <a class="af og" href="https://cloud.google.com/iam/docs/service-account-overview#:~:text=A%20service%20account%20is%20a,is%20unique%20to%20the%20account." rel="noopener ugc nofollow" target="_blank">service account</a>, which can be set up using the instructions <a class="af og" href="https://developers.google.com/zero-touch/guides/customer/quickstart/python-service-account" rel="noopener ugc nofollow" target="_blank">here</a>. This process will create a private key in a <code class="cx pi pj pk pl b">.json</code> file, which you store on your local machine. Next, it’s a good idea to make a “master folder” for this project in your Google Drive. When that’s done, you can add your service account to this folder and give it write permissions. Now your service account has the authorization to programmatically interact with the contents of that folder.</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="e1e9" class="pu oi gk pl b bg pv pw l px py">from google.oauth2 import service_account<br/>from abc import ABC, abstractmethod<br/>from googleapiclient.discovery import build<br/># path to your .json credentials file<br/>from research_assist.gsuite.base.config import CREDENTIALS<br/>from typing import Any<br/><br/><br/>class GSuiteService(ABC):<br/>    """<br/>    An abstract base class for G Suite services.<br/><br/>    This class defines the structure for any G Suite service implementation,<br/>    requiring subclasses to specify the scopes and service creation logic.<br/><br/>    Attributes:<br/>        credential_path (str): The path to the credentials file.<br/>        SCOPES (list): The scopes required for the service.<br/>    """<br/><br/>    def __init__(self) -&gt; None:<br/>        """<br/>        Initializes the GSuiteService with the credential path and scopes.<br/>        """<br/>        # The name of the file containing your credentials<br/>        self.credential_path = CREDENTIALS<br/>        self.SCOPES = self.get_scopes()<br/><br/>    @abstractmethod<br/>    def get_scopes(self) -&gt; list[str]:<br/>        """<br/>        Retrieves the scopes required for the G Suite service.<br/><br/>        Returns:<br/>            list[str]: A list of scopes required for the service.<br/>        """<br/>        raise NotImplementedError("Subclasses must implement this method.")<br/><br/>    @abstractmethod<br/>    def get_service(self, credentials: Any) -&gt; Any:<br/>        """<br/>        Creates and returns the service object for the G Suite service.<br/><br/>        Args:<br/>            credentials (Any): The credentials to use for the service.<br/><br/>        Returns:<br/>            Any: The service object for the G Suite service.<br/>        """<br/>        raise NotImplementedError("Subclasses must implement this method.")<br/><br/>    def build(self) -&gt; Any:<br/>        """<br/>        Builds the G Suite service using the provided credentials.<br/><br/>        Returns:<br/>            Any: The constructed service object.<br/>        """<br/>        # Get credentials into the desired format<br/>        creds = service_account.Credentials.from_service_account_file(<br/>            self.credential_path, scopes=self.SCOPES<br/>        )<br/><br/>        service = self.get_service(creds)<br/>        return service<br/><br/><br/>class GoogleDriveService(GSuiteService):<br/>    """<br/>    A service class for interacting with Google Drive API.<br/><br/>    Inherits from GSuiteService and implements the methods to retrieve<br/>    the required scopes and create the Google Drive service.<br/><br/>    Methods:<br/>        get_scopes: Returns the scopes required for Google Drive API.<br/>        get_service: Creates and returns the Google Drive service object.<br/>    """<br/><br/>    def get_scopes(self) -&gt; list[str]:<br/>        """<br/>        Retrieves the scopes required for the Google Drive service.<br/><br/>        Returns:<br/>            list[str]: A list containing the required scopes for Google Drive API.<br/>        """<br/>        SCOPES = ["https://www.googleapis.com/auth/drive"]<br/>        return SCOPES<br/><br/>    def get_service(self, creds: Any) -&gt; Any:<br/>        """<br/>        Creates and returns the Google Drive service object.<br/><br/>        Args:<br/>            creds (Any): The credentials to use for the Google Drive service.<br/><br/>        Returns:<br/>            Any: The Google Drive service object.<br/>        """<br/>        return build("drive", "v3", credentials=creds, cache_discovery=False)</span></pre><p id="6083" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The code is set up like this because there are many GSuite APIs (drive, docs, sheets, slides etc) that we might want to use in future. They would all inherit from <code class="cx pi pj pk pl b">GSuiteService</code> and have their <code class="cx pi pj pk pl b">get_service</code> and <code class="cx pi pj pk pl b">get_scopes</code> methods overwritten with the specific details of that API.</p><p id="b3c6" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Once this is all set up, you’re ready to interact with drive. This is a great <a class="af og" href="https://medium.com/@matheodaly.md/using-google-drive-api-with-python-and-a-service-account-d6ae1f6456c2" rel="noopener">article</a> showing some of the main ways of doing so.</p><p id="fe09" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">In our implementation, the way we’ll interact with drive is via methods of <code class="cx pi pj pk pl b">GoogleDriveHelper</code> , which creates an instance of <code class="cx pi pj pk pl b">GoogleDriveService</code> on initialization. We start with giving it the name of our master folder</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="81c4" class="pu oi gk pl b bg pv pw l px py">from research_assist.gsuite.drive.GoogleDriveHelper import GoogleDriveHelper<br/><br/>master_folder_name = ai_assistant_research_projects<br/>drive_helper = GoogleDriveHelper(f"{master_folder_name}")</span></pre><p id="4bb1" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Now let’s say we want to create a project about the Voyager series of space probes, for example. We can get organized by setting up a folder for that inside the master folder:</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="4ef8" class="pu oi gk pl b bg pv pw l px py">project_folder_id = drive_helper.create_new_folder("voyager")</span></pre><p id="bce4" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">This creates the folder and returns its ID, which we can use to create a document there. There might be multiple versions of this project, so we can also make relevant subfolders</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="2042" class="pu oi gk pl b bg pv pw l px py">version_folder_id = drive_helper.create_new_folder(<br/>  "v1", <br/>  parent_folder_id=project_folder_id<br/>)</span></pre><p id="5126" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Now we’re ready to make a blank document, which we can also do with the drive service</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="da29" class="pu oi gk pl b bg pv pw l px py">final_report_id = drive_helper.create_basic_document(<br/>    "final report", parent_folder_id=version_folder_id<br/>)</span></pre><p id="9f07" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Under the hood, the drive helper is running the following code, which passes some metadata indicating that we want to make a document to the create method of <code class="cx pi pj pk pl b">googleapiclient.discovery.build</code> (i.e. what comes out of running <code class="cx pi pj pk pl b">GoogleDriveService().build()</code> )</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="0a93" class="pu oi gk pl b bg pv pw l px py">document_metadata = {<br/>            "name": document_name,<br/>            "mimeType": "application/vnd.google-apps.document",<br/>            "parents": [parent_folder_id],<br/>}<br/># make the document<br/>doc = (<br/>  self.drive_service.files()<br/>  .create(body=document_metadata, fields="id")<br/>  execute()<br/>)<br/>doc_id = doc.get("id")</span></pre><p id="9150" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">As you might imagine, the Google Drive API has a lot of different functionality and options that we’re not covering here. The most comprehensive python wrapper for it that I’ve found is <a class="af og" href="https://github.com/iterative/PyDrive2" rel="noopener ugc nofollow" target="_blank">this one</a>, which would be a good starting point if you want to explore further.</p><h1 id="b8c6" class="oh oi gk bf oj ok ol hk om on oo hn op oq or os ot ou ov ow ox oy oz pa pb pc bk"><strong class="al">3. Writing to Google Docs</strong></h1><p id="592c" class="pw-post-body-paragraph nj nk gk nl b hi pd nn no hl pe nq nr ns pf nu nv nw pg ny nz oa ph oc od oe fj bk">Now that we’ve made a blank document, let’s fill it with the final essay! This is where the <code class="cx pi pj pk pl b">GoogleDocsService</code> and <code class="cx pi pj pk pl b">GoogleDocsHelper</code> come in. <code class="cx pi pj pk pl b">GoogleDocsService</code> is very similar to <code class="cx pi pj pk pl b">GoogleDriveService</code> , and also inherits from <code class="cx pi pj pk pl b">GSuiteService</code> as we discussed in section 2. <code class="cx pi pj pk pl b">GoogleDocsHelper</code> contains some tools to write text and images to Google Docs. They’re very basic right now, but thats all we need for this project.</p><p id="b1ea" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">We can first use the agent we built in part 1 to write an essay about Voyager</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="8bc3" class="pu oi gk pl b bg pv pw l px py">from research_assist.researcher.Agent import ResearchAgent, load_secrets<br/>from langchain_openai import ChatOpenAI<br/>from tavily import TavilyClient<br/><br/>secrets = load_secrets()<br/>model = ChatOpenAI(<br/>    model="gpt-4o-mini", temperature=0, api_key=secrets["OPENAI_API_KEY"]<br/>)<br/>tavily = TavilyClient(api_key=secrets["TAVILY_API_KEY"])<br/><br/>agent = ResearchAgent(llm, tavily)<br/>agent.run_task(<br/>    task_description="The Voyager missions: What did we learn?", <br/>    max_revisions=3<br/><br/>)</span></pre><p id="96fe" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Recall that the various outputs of the agent are stored in its memory, which can be explored with the following. In the code, you can see that we’re using “user_id = 1” as a placeholder here, but in an application that has multiple users this id would allow the model to access the correct memory store.</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="629a" class="pu oi gk pl b bg pv pw l px py">memories = agent.in_memory_store.search(("1", "memories"))</span></pre><p id="f583" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The final report text can be found here, with the key names corresponding to the AgentState that we discussed in part 1. It’s at index -3 because it’s followed by a call to the editor node (which said yes) and the accept node, which right now just returns “True”. The accept node could be easily be extended to actually write this report to a doc automatically.</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="6d96" class="pu oi gk pl b bg pv pw l px py">final_essay = agent.in_memory_store.search(("1", "memories"))[-3].dict()["value"][<br/>    "memory"<br/>]["write"]["draft"]</span></pre><p id="978b" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Let’s see how we can put this text in a google doc. Recall that in section 2 we made a blank document with <code class="cx pi pj pk pl b">doc_id</code> . There are two basic methods of <code class="cx pi pj pk pl b">GoogleDocsHelper</code> which can do this. The first is designed to provide a title and basic metadata, which is just the date and time at which the document was written. The second will paste some text into the document.</p><p id="3fb5" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The code shows how to control aspects of the position and formatting of the text, which can be a bit confusing. We define a list of requests containing instructions like <code class="cx pi pj pk pl b">insertText</code> . When we insert text, we need to provide the index at which to start the insertion, which corresponds to a position in the document.</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="5171" class="pu oi gk pl b bg pv pw l px py">def create_doc_template_header(self, document_title: str, doc_id: str) -&gt; int:<br/>     """<br/>     Creates a header template for the document, <br/>     including the title and the current date.<br/><br/>     Args:<br/>         document_title (str): The title of the document.<br/>         doc_id (str): The ID of the document to update.<br/><br/>     Returns:<br/>         int: The index after the inserted header.<br/>     """<br/>     # add template header<br/>     title = f"""<br/>     {document_title}<br/>     """<br/>     template = f"""<br/>     Written on {datetime.date.today()} at {datetime.datetime.now().strftime("%H:%M:%S")}<br/>     """<br/>     requests: List[Dict[str, Any]] = [<br/>            {<br/>                "insertText": {<br/>                    "location": {<br/>                        "index": 1,<br/>                    },<br/>                    "text": template,<br/>                }<br/>            },<br/>            {<br/>                "insertText": {<br/>                    "location": {<br/>                        "index": 1,<br/>                    },<br/>                    "text": title,<br/>                }<br/>            },<br/>            {<br/>                "updateParagraphStyle": {<br/>                    "range": {<br/>                        "startIndex": 1,<br/>                        "endIndex": len(title),<br/>                    },<br/>                    "paragraphStyle": {<br/>                        "namedStyleType": "TITLE",<br/>                        "spaceAbove": {"magnitude": 1.0, "unit": "PT"},<br/>                        "spaceBelow": {"magnitude": 1.0, "unit": "PT"},<br/>                    },<br/>                    "fields": "namedStyleType,spaceAbove,spaceBelow",<br/>                }<br/>            },<br/>            {<br/>                "updateParagraphStyle": {<br/>                    "range": {<br/>                        "startIndex": len(title) + 1,<br/>                        "endIndex": len(title) + len(template),<br/>                    },<br/>                    "paragraphStyle": {<br/>                        "namedStyleType": "SUBTITLE",<br/>                        "spaceAbove": {"magnitude": 1.0, "unit": "PT"},<br/>                        "spaceBelow": {"magnitude": 1.0, "unit": "PT"},<br/>                    },<br/>                    "fields": "namedStyleType,spaceAbove,spaceBelow",<br/>                }<br/>            },<br/>        ]<br/>     result = (<br/>            self.docs_service.documents()<br/>            .batchUpdate(documentId=doc_id, body={"requests": requests})<br/>            .execute()<br/>     )<br/>     end_index = len(title) + len(template) + 1<br/>     return end_index<br/><br/>def write_text_to_doc(self, start_index: int, text: str, doc_id: str) -&gt; int:<br/>     """<br/>     Writes text to the document at the specified index.<br/><br/>     Args:<br/>         start_index (int): The index at which to insert the text.<br/>         text (str): The text to insert.<br/>         doc_id (str): The ID of the document to update.<br/><br/>     Returns:<br/>         int: The index after the inserted text.<br/>     """<br/>     end_index = start_index + len(text) + 1<br/><br/>     requests: List[Dict[str, Any]] = [<br/>            {<br/>                "insertText": {<br/>                    "location": {<br/>                        "index": start_index,<br/>                    },<br/>                    "text": text,<br/>                }<br/>            },<br/>            {<br/>                "updateParagraphStyle": {<br/>                    "range": {<br/>                        "startIndex": start_index,<br/>                        "endIndex": start_index + len(text),<br/>                    },<br/>                    "paragraphStyle": {<br/>                        "namedStyleType": "NORMAL_TEXT",<br/>                        "spaceAbove": {"magnitude": 1.0, "unit": "PT"},<br/>                        "spaceBelow": {"magnitude": 1.0, "unit": "PT"},<br/>                    },<br/>                    "fields": "namedStyleType,spaceAbove,spaceBelow",<br/>                }<br/>            },<br/>        ]<br/><br/>     result = (<br/>            self.docs_service.documents()<br/>            .batchUpdate(documentId=doc_id, body={"requests": requests})<br/>            .execute()<br/>        )<br/><br/>     return end_index</span></pre><p id="303e" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">You can learn more about how indices are defined<a class="af og" href="https://developers.google.com/docs/api/concepts/structure#indexes" rel="noopener ugc nofollow" target="_blank"> here</a>. When multiple <code class="cx pi pj pk pl b">insertText</code> calls, it appears to be easier to write the last piece of text first — for example in the code below <code class="cx pi pj pk pl b">template</code> (which is the metadata that’s supposed to appear below the title) appears first in the list at index 1. Then we write <code class="cx pi pj pk pl b">title</code> at index 1. This results in <code class="cx pi pj pk pl b">title</code> appearing first in the document and <code class="cx pi pj pk pl b">template</code> appearing below. Note how we also need to specify the <code class="cx pi pj pk pl b">startIndex</code> and <code class="cx pi pj pk pl b">endIndex</code> of the <code class="cx pi pj pk pl b">paragraphStyle</code> blocks in order to change the formatting of the text.</p><p id="196e" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Both methods in the code above return the end index of the current block of text so that it can be used as the start index of subsequent blocks to be appended. If you intend to get more creative with the style and formatting of documents, this <a class="af og" href="https://developers.google.com/docs/api/concepts/document" rel="noopener ugc nofollow" target="_blank">guide</a> will likely help.</p><p id="5f3b" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Now that we’ve seen the underlying code, we can call it to write our final report to a document.</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="29e9" class="pu oi gk pl b bg pv pw l px py">from research_assist.gsuite.docs.GoogleDocsHelper import GoogleDocsHelper<br/><br/>docs_helper = GoogleDocsHelper()<br/><br/># add the document title <br/>title_end_index = docs_helper.create_doc_template_header(<br/>    "voyager final report", doc_id<br/>)<br/><br/># add the text<br/>doc_end_index = docs_helper.write_text_to_doc(<br/>    start_index=title_end_index, text=final_essay, doc_id=doc_id<br/>)</span></pre><p id="0988" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Great! Now we have all the tools of docs at our disposal to edit, format and share the report that our agent generated. Interestingly, the agent formatted the text as markdown which is supported by Google Docs, but I was unable to find a way to get the document to automatically recognize this and convert the markdown into nice headers and subheaders. No doubt there is a way to do that and it would make the reports look much nicer.</p><p id="0939" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">After running the code above, the doc should look something like this.</p><figure class="pm pn po pp pq fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp pz"><img src="../Images/dd497a4dcc365990a44e1855caaf2128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_fqYndNfBtofDV-irgYWVg.png"/></div></div><figcaption class="gd ge gf fo fp gg gh bf b bg z dx">Screenshot of the document containing the agent-generated final report. Image generated by the author</figcaption></figure><h1 id="339e" class="oh oi gk bf oj ok ol hk om on oo hn op oq or os ot ou ov ow ox oy oz pa pb pc bk"><strong class="al">4. What about the other agent outputs?</strong></h1><p id="25bd" class="pw-post-body-paragraph nj nk gk nl b hi pd nn no hl pe nq nr ns pf nu nv nw pg ny nz oa ph oc od oe fj bk">We should be able to write all the information thats stored in the agent memory to docs, which will allow us to easily browse through the results of each stage. A somewhat hacky way to do this is as follows:</p><pre class="pm pn po pp pq pr pl ps bp pt bb bk"><span id="17df" class="pu oi gk pl b bg pv pw l px py">memories = agent.in_memory_store.search(("1", "memories"))<br/><br/># this is needed because we may call some nodes several times <br/># and we want to keep track of this so that we can make new documents<br/># for each call<br/>seen_keys = set()<br/>iterations = defaultdict(int)<br/><br/># folder id where we want to write the documents<br/>folder_id = f"{folder_id}"<br/><br/>for m in memories:<br/>    data = m.dict()["value"]["memory"]<br/>    available_keys = data.keys()<br/>    node_key = list(available_keys)[0]<br/>    unique_node_key = node_key + "_00"<br/>    if unique_node_key in seen_keys:<br/>        iterations[node_key] += 1<br/>        unique_node_key = unique_node_key.replace("_00", "") + "_{:02d}".format(<br/>            iterations[node_key]<br/>        )<br/><br/>    print("-" * 20)<br/>    print("Creating doc {}".format(unique_node_key))<br/><br/>    # get the text<br/>    text = data[node_key][list(data[node_key].keys())[0]]<br/>    <br/>    # the tavily research output is a list, so convert it to a string<br/>    if isinstance(text, List):<br/>        text = "\n\n".join(text)<br/>    <br/>    # if anything else is not a string (e.g. the output of the accept node)<br/>    # convert it to a string<br/>    if not isinstance(text, str):<br/>        text = str(text)<br/><br/>    # create document<br/>    report_id = drive_service.create_basic_document(<br/>        unique_node_key, parent_folder_id=folder_id<br/>    )<br/><br/>    # create header<br/>    end_index = docs_helper.create_doc_template_header(unique_node_key, report_id)<br/><br/>    # fill document<br/>    end_index = docs_helper.write_text_to_doc(<br/>        start_index=end_index, text=text, doc_id=report_id<br/>    )<br/><br/>    seen_keys.add(unique_node_key)</span></pre><p id="a1d1" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">This is going to make 7 documents, and we’ll take a look at some example screenshots below</p><figure class="pm pn po pp pq fw fo fp paragraph-image"><div class="fo fp qa"><img src="../Images/e354c6d90ddac665527ba3f8e7124e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*2eOBYBOc39mwXbXUHQMg8Q.png"/></div><figcaption class="gd ge gf fo fp gg gh bf b bg z dx">Outputs from the running the code above. Image generated by the author</figcaption></figure><p id="fc96" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The initial plan outlines the structure of the report. It’s interesting that the model seems to favor lots of short sections, which I think is appropriate given the prompt request to make it concise and digestible to a general readership.</p></div></div><div class="fw"><div class="ab cb"><div class="mf qb mg qc mh qd cf qe cg qf ci bh"><div class="pm pn po pp pq ab ky"><figure class="ly fw qg qh qi qj qk paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><img src="../Images/3a7eb62fe4a38648c0866643ef27dede.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*l6S88_mOIBGeAthTpVzW3Q.png"/></div></figure><figure class="ly fw ql qh qi qj qk paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><img src="../Images/9b48c7b1ec4952ca764da720e9929c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*LzjOh8YtJDebkPpOj1ISRw.png"/></div><figcaption class="gd ge gf fo fp gg gh bf b bg z dx qm ed qn qo">Screenshots of part of the initial plan and research documents written by the code snippet above. Images generated by the author.</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="26f5" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">At the research phase, Tavily search is called and returns small chunks of nicely formatted text relevant to the queries that were used. Some of these chunks are truncated and this document is not especially readable, but it gives a good sense of the type of information that is passing from the research node to the write node.</p><p id="189a" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">At the review phase, we get an eloquent criticism of the first version of the essay. Typically these reviews are structured similarly to the initial plan and make a lot of very general recommendations such as “consider using more descriptive titles” or “this section could be expanded to include more examples”. If we compare the actual reports before and after the reviews, we typically see only minor changes to the stucture and some additional details in each of the sections. The extent to which this actually improves the quality of the text is debatable, but from trying it out on a few examples I am convinced that it does help.</p></div></div><div class="fw"><div class="ab cb"><div class="mf qb mg qc mh qd cf qe cg qf ci bh"><div class="pm pn po pp pq ab ky"><figure class="ly fw qp qh qi qj qk paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><img src="../Images/a1dd4e1dc0e37f1c84a80d1535b14765.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*O_939mk3xCwV3afNczl-_Q.png"/></div></figure><figure class="ly fw qq qh qi qj qk paragraph-image"><img src="../Images/0184229a9da34e4de535a5b1c7c25d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*-4bYGBwP9WEeY3w3N-xrVg.png"/><figcaption class="gd ge gf fo fp gg gh bf b bg z dx qr ed qs qo">Screenshots of part of the review and editor response documents written by the code snippet above. Images generated by the author.</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="b163" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Finally, we get the editor’s judgement on the post-review draft. The prompt I am currently using makes the editor rather lenient, so it usually says something to the effect of whats shown here. With some prompt tweaks we could encourage it to send more reports back to review if desirable.</p><p id="7b11" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">That’s it for this article and this mini series. Thanks for reading and I hope you find some of this useful for your own projects. There are lots of potential extensions here in terms of making the research agent more robust, a proper evaluation of its outputs and better integrations with Docs (or other GSuite APIs). Please let me know if you have any other cool ideas!</p><p id="e833" class="pw-post-body-paragraph nj nk gk nl b hi nm nn no hl np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The author is unaffiliated with any of the tools discussed in this article.</p></div></div></div></div>    
</body>
</html>