<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Calculating the Uncertainty Coefficient (Theil’s U) in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Calculating the Uncertainty Coefficient (Theil’s U) in Python</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/calculating-the-uncertainty-coefficient-thiels-u-in-python-fce72a02431b?source=collection_archive---------6-----------------------#2024-10-18">https://towardsdatascience.com/calculating-the-uncertainty-coefficient-thiels-u-in-python-fce72a02431b?source=collection_archive---------6-----------------------#2024-10-18</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="fr fs ft fu fv fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp fq"><img src="../Images/04c7e4f655a5a8582663e539e22a9b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4w3t3QseB30f1JAwUt_a7w.jpeg"/></div></div></figure><div/><div><h2 id="88c6" class="pw-subtitle-paragraph hc ge gf bf b hd he hf hg hh hi hj hk hl hm hn ho hp hq hr cq dx"><strong class="al">A measure of correlation between discrete (categorical) variables</strong></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hs ht hu hv hw ab"><div><div class="ab hx"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@marclinder?source=post_page---byline--fce72a02431b--------------------------------" rel="noopener follow"><div class="l hy hz by ia ib"><div class="l ed"><img alt="Marc Linder" class="l ep by dd de cx" src="../Images/3da574ad381525d372edc33359314aeb.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*Mn3zuceHsjIxSqHXqTA7jg.jpeg"/><div class="ic by l dd de em n id eo"/></div></div></a></div></div><div class="ie ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--fce72a02431b--------------------------------" rel="noopener follow"><div class="l if ig by ia ih"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ii cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ic by l br ii em n id eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="ij ab q"><div class="ab q ik"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b il im bk"><a class="af ag ah ai aj ak al am an ao ap aq ar in" data-testid="authorName" href="https://medium.com/@marclinder?source=post_page---byline--fce72a02431b--------------------------------" rel="noopener follow">Marc Linder</a></p></div></div></div><span class="io ip" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b il im dx"><button class="iq ir ah ai aj ak al am an ao ap aq ar is it iu" disabled="">Follow</button></p></div></div></span></div></div><div class="l iv"><span class="bf b bg z dx"><div class="ab cn iw ix iy"><div class="iz ja ab"><div class="bf b bg z dx ab jb"><span class="jc l iv">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--fce72a02431b--------------------------------" rel="noopener follow"><p class="bf b bg z jd je jf jg jh ji jj jk bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="io ip" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">6 min read</span><div class="jl jm l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Oct 18, 2024</span></div></span></div></span></div></div></div><div class="ab cp jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="h k w ea eb q"><div class="ks l"><div class="ab q kt ku"><div class="pw-multi-vote-icon ed jc kv kw kx"><div class=""><div class="ky kz la lb lc ld le am lf lg lh kx"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l li lj lk ll lm ln lo"><p class="bf b dy z dx"><span class="kz">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao ky lr ls ab q ee lt lu" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lq"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lp lq">1</span></p></button></div></div></div><div class="ab q kd ke kf kg kh ki kj kk kl km kn ko kp kq kr"><div class="lv k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lw an ao ap is lx ly lz" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ma cn"><div class="l ae"><div class="ab cb"><div class="mb mc md me mf gb ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lw an ao ap is mg mh lu mi mj mk ml mm s mn mo mp mq mr ms mt u mu mv mw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lw an ao ap is mg mh lu mi mj mk ml mm s mn mo mp mq mr ms mt u mu mv mw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lw an ao ap is mg mh lu mi mj mk ml mm s mn mo mp mq mr ms mt u mu mv mw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><h2 id="2664" class="mx my gf bf mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu bk">Introduction</h2><p id="919b" class="pw-post-body-paragraph nv nw gf nx b hd ny nz oa hg ob oc od ni oe of og nm oh oi oj nq ok ol om on fj bk">Theil’s U, also known as the uncertainty coefficient or entropy coefficient, quantifies the strength of association between two nominal variables. It assesses how much knowing the value of one variable reduces uncertainty about the other, providing a measure of association that ranges from 0 to 1. A higher value indicates a stronger relationship, making Thiel’s U particularly useful in fields such as statistics and data science for exploring relationships within categorical data.</p><h2 id="42ff" class="mx my gf bf mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu bk">Theory</h2><p id="4d00" class="pw-post-body-paragraph nv nw gf nx b hd ny nz oa hg ob oc od ni oe of og nm oh oi oj nq ok ol om on fj bk">Theil’s U<strong class="nx gg"> </strong>is a measure of nominal association based on the concept of information entropy. Suppose we have samples from two discrete random variables, X and Y.</p><p id="de9c" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">Then the <strong class="nx gg">entropy</strong> of X is defined as:</p><figure class="ou ov ow ox oy fw fo fp paragraph-image"><div class="fo fp ot"><img src="../Images/a463881597607b27f2ea05ce643aa028.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*PzKvZ-Bz0x2-zzTm6aj1mw.png"/></div><figcaption class="oz pa pb fo fp pc pd bf b bg z dx">Entropy of a single distribution X</figcaption></figure><p id="92bf" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">And the <strong class="nx gg">conditional entropy</strong> of X given Y is defined as:</p><figure class="ou ov ow ox oy fw fo fp paragraph-image"><div class="fo fp pe"><img src="../Images/5c0abd5d3ac3a97c71028eaa8da49c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*wdz4V8UfXWoth__16vn2cg.png"/></div><figcaption class="oz pa pb fo fp pc pd bf b bg z dx">Conditional entropy of X given Y</figcaption></figure><p id="bff7" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">We can then use the joint distribution (numerator) in combination with the marginal probabilities of X or Y to calculate the conditional distributions of X given Y (denominator) or Y given X, respectively, as follows:</p><figure class="ou ov ow ox oy fw fo fp paragraph-image"><div class="fo fp pf"><img src="../Images/207fe2a6272788408489805ef17fe7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*1XAjOKh-JHmm2wGYk60X4g.png"/></div><figcaption class="oz pa pb fo fp pc pd bf b bg z dx">Conditional distribution of x given y</figcaption></figure><figure class="ou ov ow ox oy fw fo fp paragraph-image"><div class="fo fp pf"><img src="../Images/53579c2995913f0471bf8794fff6c6bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*zKHedyyRtuZqNevd0tg7oQ.png"/></div><figcaption class="oz pa pb fo fp pc pd bf b bg z dx">Conditional distribution of y given x</figcaption></figure><p id="0014" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">The result captures how the probability of one variable changes given the value of the other. We can calculate the probability of X given Y by using the joint probability of X and Y — that is, the probability of different combinations of X and Y — as well as the marginal probability of Y. We insert the result of their division into our formula for H(X) to obtain:</p><figure class="ou ov ow ox oy fw fo fp paragraph-image"><div class="fo fp pg"><img src="../Images/74029c0a61945811f742ead740ab1c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*OZje7cfLOzFy1KOA8r_1YA.png"/></div><figcaption class="oz pa pb fo fp pc pd bf b bg z dx">Conditional entropy of X given Y</figcaption></figure><p id="f203" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">So much for the theory; here’s how we can calculate the conditional entropy of X given Y in Python.</p><pre class="ou ov ow ox oy ph pi pj bp pk bb bk"><span id="1739" class="pl my gf pi b bg pm pn l po pp">from typing import List, Union<br/>from collections import Counter<br/>import math<br/><br/>def conditional_entropy(<br/>    x: List[Union[int, float]], <br/>    y: List[Union[int, float]]<br/>) -&gt; float:<br/>    """ Calculates conditional entropy """<br/>    <br/>    # Count unique values<br/>    y_counter = Counter(y)  # Counts of unique values in y<br/>    xy_counter = Counter(list(zip(x, y)))  # Counts of unique pairs from (x, y)<br/>    # Calculate sum of y values<br/>    total_occurrences = sum(y_counter.values())<br/>    # (Re-)set entropy to 0<br/>    entropy = 0<br/>    <br/>    # For every unique value pair of x and y<br/>    for xy in xy_counter.keys():<br/>        # Joint probability of x AND y<br/>        p_xy = xy_counter[xy] / total_occurrences<br/>        # Marginal probability of y<br/>        p_y = y_counter[xy[1]] / total_occurrences<br/>        # Conditional probability of x given y<br/>        p_x_given_y = p_xy / p_y<br/>        # Calculate the conditional entropy H(X|Y)<br/>        entropy += p_xy * math.log(p_x_given_y, 2)  # Use base 2 instead of natural (base e)<br/>        <br/>    return -entropy</span></pre><p id="045d" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">Once we have calculated the conditional entropy of X given Y, we can calculate Theil’s U. One last step is to calculate the entropy of X, which we defined at the beginning of this article. The uncertainty coefficient, or proficiency, is then calculated as follows:</p><figure class="ou ov ow ox oy fw fo fp paragraph-image"><div class="fo fp pq"><img src="../Images/e6aee30b9c16631e93a038b158183f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*g5zI8Law3uJh5gp4jJZ-eQ.png"/></div><figcaption class="oz pa pb fo fp pc pd bf b bg z dx">Theil’s U — Uncertainty coefficient or proficiency</figcaption></figure><p id="e7a3" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">Switching from theory to practice, this can be accomplished in Python using the following code:</p><pre class="ou ov ow ox oy ph pi pj bp pk bb bk"><span id="4284" class="pl my gf pi b bg pm pn l po pp">import scipy.stats as ss<br/><br/>def theil_u(<br/>    x: List[Union[int, float]], <br/>    y: List[Union[int, float]]<br/>) -&gt; float:<br/>    """ Calculate Theil U """<br/>    <br/>    # Calculate conditional entropy of x and y<br/>    H_xy = conditional_entropy(x,y)<br/>    <br/>    # Count unique values<br/>    x_counter = Counter(x)<br/>    <br/>    # Calculate sum of x values<br/>    total_occurrences = sum(x_counter.values())<br/>    <br/>    # Convert all absolute counts of x values in x_counter to probabilities<br/>    p_x = list(map(lambda count: count/total_occurrences, x_counter.values()))<br/>    <br/>    # Calculate entropy of single distribution x<br/>    H_x = ss.entropy(p_x)<br/>  <br/>    return (H_x - H_xy) / H_x if H_x != 0 else 0</span></pre><p id="2121" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">Lastly we can then define a function that calculates the Theil’s values for every feature combination within a given dataset. We can do this in Python with the following code:</p><pre class="ou ov ow ox oy ph pi pj bp pk bb bk"><span id="2242" class="pl my gf pi b bg pm pn l po pp">import itertools<br/>import pandas as pd<br/><br/>def get_theils_u_for_df(df: pd.DataFrame) -&gt; pd.DataFrame:<br/>    """ Compute Theil's U for every feature combination in the input df """<br/><br/>    # Create an empty dataframe to fill<br/>    theilu = pd.DataFrame(index=df.columns, columns=df.columns)<br/><br/>    # Insert Theil U values into empty dataframe<br/>    for var1, var2 in itertools.combinations(df, 2):<br/>        u = theil_u(df[var1],df[var2])<br/>        theilu[var1][var2] = round(u, 2) # fill lower diagonal<br/><br/>        u = theil_u(df[var2],df[var1])   <br/>        theilu[var2][var1] = round(u, 2) # fill upper diagonal<br/><br/>    # Set 1s to diagonal where row index + column index == n - 1<br/>    for i in range(0, len(theilu.columns)):<br/>        for j in range(0, len(theilu.columns)):<br/>            if i == j:<br/>                theilu.iloc[i, j] = 1<br/><br/>    # Convert all values in the DataFrame to float<br/>    return theilu.map(float)</span></pre><h2 id="4bc5" class="mx my gf bf mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu bk">Code Example</h2><p id="a715" class="pw-post-body-paragraph nv nw gf nx b hd ny nz oa hg ob oc od ni oe of og nm oh oi oj nq ok ol om on fj bk">We will demonstrate the functionality of the code using the well-known <strong class="nx gg">Iris dataset</strong>. In addition to its numeric variables, the dataset contains a categorical variable, “species.” Traditional correlation measures, such as Pearson’s correlation, are limited in capturing relationships between categorical and numerical features. However, Thiel’s U can effectively measure the association between “species” and the other numerical features.</p><pre class="ou ov ow ox oy ph pi pj bp pk bb bk"><span id="16ca" class="pl my gf pi b bg pm pn l po pp">import pandas as pd<br/>import seaborn as sns<br/>import itertools<br/>import matplotlib.pyplot as plt<br/><br/># Load the Iris dataset from seaborn<br/>df = sns.load_dataset('iris')<br/><br/># Compute Theil's U for every feature combination in the input df<br/>theilu = get_theils_u_for_df(df)<br/><br/># Create a heatmap of the Theil's V values<br/>plt.figure(figsize=(10, 4))<br/>sns.heatmap(theilu, annot=True, cmap='Reds', fmt='.2f')<br/>plt.title('Heatmap of Theil\'s U for all variable pairs') <br/>plt.show()</span></pre><p id="95d2" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">The result is a heatmap of Thiel’s U for all variable pairs. Note that this measure has the advantage of being asymmetric, meaning the relationship between two variables can differ depending on the direction of analysis. For example, Thiel’s U can quantify how much information X provides about Y, which may not be the same as how much information Y provides about X.</p><figure class="ou ov ow ox oy fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp pr"><img src="../Images/7b5e01021d8e96fa823b04594537fd82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BOrfrf2770Q7CyDTLDhhbA.png"/></div></div><figcaption class="oz pa pb fo fp pc pd bf b bg z dx">Heatmap of Theil’s U values for all variable pairs</figcaption></figure><p id="a653" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">The interpretation of the results is relatively straightforward: Petal Length and Petal Width have the strongest associations with the categorical variable “species,” both with a value of 0.91. This indicates that knowing the petal dimensions provides a high degree of information about the flower species. Sepal Length also has a moderate relationship with species at 0.55, meaning it offers some information about the species, though less than the petal measurements. Sepal Width has the weakest association with species at 0.33, indicating it provides relatively little information about the flower type. The relatively lower values between the sepal measurements and species highlight that petal dimensions are more informative for predicting species, which is consistent with the known characteristics of the Iris dataset.</p><h2 id="8893" class="mx my gf bf mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu bk">Conclusion</h2><p id="98a2" class="pw-post-body-paragraph nv nw gf nx b hd ny nz oa hg ob oc od ni oe of og nm oh oi oj nq ok ol om on fj bk">In this article, we demonstrated how to calculate Theil’s U to assess associations between categorical and numerical variables. By applying this measure to the Iris dataset, we showed that petal dimensions provide significant insights into predicting flower species, highlighting the effectiveness of Theil’s U compared to traditional correlation methods.</p><p id="a174" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk"><em class="ps">Sources</em></p><ul class=""><li id="3b6b" class="nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on pt pu pv bk">Theil, H. (1958): <em class="ps">Economic Forecasts and Policy</em>. Amsterdam: North Holland.</li><li id="24ad" class="nv nw gf nx b hd pw nz oa hg px oc od ni py of og nm pz oi oj nq qa ol om on pt pu pv bk">Theil, H. (1966): <em class="ps">Applied Economic Forecasting</em>. Chicago: Rand McNally.</li><li id="98c9" class="nv nw gf nx b hd pw nz oa hg px oc od ni py of og nm pz oi oj nq qa ol om on pt pu pv bk">Bliemel, F. (1973): Theil’s Forecast Accuracy Coefficient: A Clarification, <em class="ps">Journal of Marketing Research</em> 10(4), pp. 444–446</li></ul><p id="a0aa" class="pw-post-body-paragraph nv nw gf nx b hd oo nz oa hg op oc od ni oq of og nm or oi oj nq os ol om on fj bk">Note: Unless otherwise noted, all images are by the author.</p></div></div></div></div>    
</body>
</html>