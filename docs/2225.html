<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Market Basket Analysis Using High Utility Itemset Mining</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Market Basket Analysis Using High Utility Itemset Mining</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/market-basket-analysis-using-high-utility-itemset-mining-df233b297c0d?source=collection_archive---------5-----------------------#2024-09-11">https://towardsdatascience.com/market-basket-analysis-using-high-utility-itemset-mining-df233b297c0d?source=collection_archive---------5-----------------------#2024-09-11</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="834d" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Finding high-value patterns in transactions</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@brechterlaurin?source=post_page---byline--df233b297c0d--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Laurin Brechter" class="l ep by dd de cx" src="../Images/5a68b96bddf86846a2bef9d482ef9dd3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*QHmK9X-MGra2e-1yZwCa2Q.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--df233b297c0d--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@brechterlaurin?source=post_page---byline--df233b297c0d--------------------------------" rel="noopener follow">Laurin Brechter</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--df233b297c0d--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">9 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Sep 11, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="9a44" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><em class="ne">In this post, I will give an alternative to popular techniques in market basket analysis that can help practitioners find high-value patterns rather than just the most frequent ones. We will gain some intuition into different pattern mining problems and look at a real-world example. The full code can be found </em><a class="af nf" href="https://github.com/LaurinBrechter/PatternMining/blob/main/market_basket_analysis.ipynb" rel="noopener ugc nofollow" target="_blank"><em class="ne">here</em></a><em class="ne">. All images are created by the author.</em></p><h1 id="5e68" class="ng nh fq bf ni nj nk gq nl nm nn gt no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Introduction</h1><p id="639f" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">I have written a more <a class="af nf" href="https://medium.com/@brechterlaurin/customer-analytics-pattern-mining-on-clickstream-data-in-python-1bcd2de15a5d" rel="noopener">introductory article</a> about pattern mining already; if you’re not familiar with some of the concepts that come up here, feel free to check that one out first.</p><p id="58b9" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In short, pattern mining tries to find patterns in data (duuh). Most of the time, this data comes in the form of (multi-)sets or sequences. In my last article, for example, I looked at the sequence of actions that a user performs on a website. In this case, we <strong class="mk fr">would</strong> care about the ordering of the items.</p><p id="2248" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In other cases, such as the one we will discuss below, we do not care about the ordering of the items. We only list all the items that were in the transaction and how often they appeared.</p><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi oj"><img src="../Images/41cb825f15fa90e48e2542357f2cca25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*Fcrf3GfAgqbU07NgcNInkw.png"/></div><figcaption class="or os ot oh oi ou ov bf b bg z dx">Example Transacton Database</figcaption></figure><p id="736d" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">So for example, transaction 1 contained 🥪 3 times and 🍎 once. As we see, we lose information about the ordering of the items, but in many scenarios (as the one we will discuss below), there is no logical ordering of the items. This is similar to a bag of words in NLP.</p><h1 id="e009" class="ng nh fq bf ni nj nk gq nl nm nn gt no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Market Basket Analysis</h1><p id="d8fb" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk"><em class="ne">Market Basket Analysis</em> (MBA) is a data analysis technique commonly used in retail and marketing to uncover relationships between products that customers tend to purchase together. It aims to identify patterns in customers’ shopping baskets or transactions by analyzing their purchasing behavior. The central idea is to understand the co-occurrence of items in shopping transactions, which helps businesses optimize their strategies for product placement, cross-selling, and targeted marketing campaigns.</p><h1 id="f21b" class="ng nh fq bf ni nj nk gq nl nm nn gt no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Frequent Itemset Mining</h1><p id="a051" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk"><em class="ne">Frequent Itemset Mining </em>(FIM) is the process of finding frequent patterns in transaction databases. We can look at the frequency of a pattern (i.e. a set of items) by calculating its support. In other words, the support of a pattern X is the number of transactions T that contain X (and are in the database D). That is, we are simply looking at how often the pattern X appears in the database.</p><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi ow"><img src="../Images/8e4e64bb847ac52b766b74fa02f9f7b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:514/format:webp/1*DLuZvrhObGXqFE1N6uqITA.png"/></div><figcaption class="or os ot oh oi ou ov bf b bg z dx">Definition of the support.</figcaption></figure><p id="d56a" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In FIM, we then want to find all the sequences that have a support bigger than some threshold (often called <em class="ne">minsup</em>). If the support of a sequence is higher than minsup, it is considered frequent.</p><h2 id="b6cc" class="ox nh fq bf ni oy oz pa nl pb pc pd no mr pe pf pg mv ph pi pj mz pk pl pm pn bk">Limitations</h2><p id="fa58" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">In FIM, we only look at the existence of an item in a sequence. That is, whether an item appears two times or 200 times does not matter, we simply represent it as a one. But we often have cases (such as MBA), where not only the existence of an item in a transaction is relevant but also how many times it appeared in the transaction.</p><p id="8f21" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Another problem is that frequency does not always imply relevance. In that sense, FIM assumes that all items in the transaction are equally important. However, it is reasonable to assume that someone buying caviar might be more important for a business than someone buying bread, as caviar is potentially a high ROI/profit item.</p><h1 id="d029" class="ng nh fq bf ni nj nk gq nl nm nn gt no np nq nr ns nt nu nv nw nx ny nz oa ob bk">High Utility Itemset Mining</h1><p id="efa1" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">These limitations directly bring us to <em class="ne">High Utility Itemset Mining</em> (HUIM) and <a class="af nf" href="https://data-mining.philippe-fournier-viger.com/an-introduction-to-high-utility-quantitative-itemset-mining/" rel="noopener ugc nofollow" target="_blank"><em class="ne">High Utility Quantitative Itemset Mining</em></a> (HUQIM) which are generalizations of FIM that try to address some of the problems of normal FIM.</p><p id="7a6b" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Our first generalization is that items can appear more than once in a transaction (i.e. we have a multiset instead of a simple set). As said before, in normal itemset mining, we transform the transaction into a set and only look at whether the item exists in the transaction or not. So for example the two transactions below would have the same representation.</p><pre class="ok ol om on oo po pp pq bp pr bb bk"><span id="88c9" class="ps nh fq pp b bg pt pu l pv pw">t1 = [a,a,a,a,a,b] # repr. as {a,b} in FIM<br/>t2 = [a,b] # repr. as {a,b} in FIM</span></pre><p id="0112" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Above, both these two transactions would be represented as [a,b] in regular FIM. We quickly see that, in some cases, we could miss important details. For example, if a and b were some items in a customer’s shopping cart, it would matter a lot whether we have <em class="ne">a</em> (e.g. a loaf of bread) five times or only once. Therefore, we represent the transaction as a multiset in which we write down, how many times each item appeared.</p><pre class="ok ol om on oo po pp pq bp pr bb bk"><span id="8bf3" class="ps nh fq pp b bg pt pu l pv pw"># multiset representation<br/>t1_ms = {(a,5),(b,1)}<br/>t2_ms = {(a,1),(b,1)}</span></pre><p id="e25c" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">This is also efficient if the items can appear in a large number of items (e.g. 100 or 1000 times). In that case, we need not write down all the a’s or b’s but simply how often they appear.</p><p id="2656" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The generalization that both the quantitative and non-quantitative methods make, is to assign every item in the transaction a utility (e.g. profit or time). Below, we have a table that assigns every possible item a unit profit.</p><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi px"><img src="../Images/ab15ac9523c16807736ef0d97bc7f37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*l1vMt7VrLaWQlF9HGWX7Lw.png"/></div><figcaption class="or os ot oh oi ou ov bf b bg z dx">Utility of Items</figcaption></figure><p id="0607" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">We can then calculate the utility of a specific pattern such as {🥪, 🍎} by summing up the utility of those items in the transactions that contain them. In our example we would have:</p><p id="9135" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">(3🥪 * $1 + 1🍎 * $2) +</p><p id="1ec4" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">(1 🥪 * $1 + 2🍎 * $2) = $10</p><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi oj"><img src="../Images/41cb825f15fa90e48e2542357f2cca25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*Fcrf3GfAgqbU07NgcNInkw.png"/></div><figcaption class="or os ot oh oi ou ov bf b bg z dx">Transacton Database from Above</figcaption></figure><p id="91ff" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">So, we get that this pattern has a utility of $10. With FIM, we had the task of finding frequent patterns. Now, we have to find patterns with high utility. This is mainly because we assume that frequency does not imply importance. In regular FIM, we might have missed rare (infrequent) patterns that provide a high utility (e.g. the diamond), which is not true with HUIM.</p><p id="a865" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">We also need to define the notion of a <em class="ne">transaction utility</em>. This is simply the sum of the utility of all the items in the transaction. For our transaction 3 in the database, this would be</p><p id="0376" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">1🥪 * $1 + 2🦞*$10 + 2🍎*$2 = $25</p><p id="1119" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Note that solving this problem and finding all high-utility items is more difficult than regular FPM. This is because the utility does not follow the Apriori property.</p><h2 id="d08a" class="ox nh fq bf ni oy oz pa nl pb pc pd no mr pe pf pg mv ph pi pj mz pk pl pm pn bk">The Apriori Property</h2><p id="a352" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">Let X and Y be two patterns occurring in a transaction database D. The apriori property says that if X is a subset of Y, then the support of X must be at least as big as Y's.</p><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi ow"><img src="../Images/1c3c25ff7dd2c5206f3c08921935d9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:514/format:webp/1*62-wFmxk6Qz5PDjoyYQ6VA.png"/></div><figcaption class="or os ot oh oi ou ov bf b bg z dx">Apriori property.</figcaption></figure><p id="9a0e" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">This means that if a subset of Y is infrequent, Y itself must be infrequent since it must have a smaller support. Let’s say we have X = {a} and Y = {a,b}. If Y appears 4 times in our database, then X must appear at least 4 times, since X is a subset of Y. This makes sense since we are making the pattern less general / more specific by adding an item which means that it will fit less transactions. This property is used in most algorithms as it implies that if {a} is infrequent all supersets are also infrequent and we can eliminate them from the search space [3].</p><p id="2780" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">This property does not hold when we are talking about utility. A superset Y of transaction X could have more or less utility. If we take the example from above, {🥪} has a utility of $4. But this does not mean we cannot look at supersets of this pattern. For example, the superset we looked at {🥪, 🍎} has a higher utility of $10. At the same time, a superset of a pattern won’t always have more utility since it might be that this superset just doesn’t appear very often in the DB.</p><h2 id="0e54" class="ox nh fq bf ni oy oz pa nl pb pc pd no mr pe pf pg mv ph pi pj mz pk pl pm pn bk">Idea Behind HUIM</h2><p id="cefe" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">Since we can’t use the apriori property for HUIM directly, we have to come up with some other upper bound for narrowing down the search space. One such bound is called <em class="ne">Transaction-Weighted Utilization</em> (TWU). To calculate it, we sum up the transaction utility of the transactions that contain the pattern X of interest. Any superset Y of X can’t have a higher utility than the TWU. Let’s make this clearer with an example. The TWU of {🥪,🍎} is $30 ($5 from transaction 1 and $5 from transaction 3). When we look at a superset pattern Y such as {🥪 🦞 🍎} we can see that there is no way it would have more utility since all transactions that have Y in them also have X in them.</p><p id="7264" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">There are now various algorithms for solving HUIM. All of them receive a minimum utility and produce the patterns that have at least that utility as their output. In this case, I have used the <a class="af nf" href="https://www.philippe-fournier-viger.com/EFIM_JOURNAL_VERSION%20KAIS%202016.pdf" rel="noopener ugc nofollow" target="_blank">EFIM</a> algorithm since it is fast and memory efficient.</p><h1 id="503b" class="ng nh fq bf ni nj nk gq nl nm nn gt no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Implementation</h1><p id="f4c7" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">For this article, I will work with the <a class="af nf" href="https://www.kaggle.com/datasets/aslanahmedov/market-basket-analysis/data" rel="noopener ugc nofollow" target="_blank">Market Basket Analysis</a> dataset from Kaggle (used with permission from the original dataset author).</p><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi py"><img src="../Images/52a9c188eeffd3d5623867a20fcea425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*noJcAMZGJfEhj39rG8FhXw.png"/></div></figure><p id="94d1" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Above, we can see the distribution of transaction values found in the data. There is a total of around 19,500 transactions with an average transaction value of $526 and 26 distinct items per transaction. In total, there are around 4000 unique items. We can also make an <a class="af nf" href="https://en.wikipedia.org/wiki/ABC_analysis" rel="noopener ugc nofollow" target="_blank">ABC analysis</a> where we put items into different buckets depending on their share of total revenue. We can see that around 500 of the 4000 items make up around 70% of the revenue (A-items). We then have a long right-tail of items (around 2250) that make up around 5% of the revenue (C-items).</p><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi pz"><img src="../Images/00215688bf024d53c61c4bc6ec612e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*S30izXD7mc3XjzIOYDvIUA.png"/></div></figure><h2 id="e3d0" class="ox nh fq bf ni oy oz pa nl pb pc pd no mr pe pf pg mv ph pi pj mz pk pl pm pn bk">Preprocessing</h2><p id="d08b" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">The initial data is in a long format where each row is a line item within a bill. From the BillNo we can see to which transaction the item belongs.</p><figure class="ok ol om on oo op oh oi paragraph-image"><div role="button" tabindex="0" class="qb qc ed qd bh qe"><div class="oh oi qa"><img src="../Images/2dc515f0b73bc158e7e17eddb1a6b66e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iruCPTLBdbt2YfNQ5-qluA.png"/></div></div><figcaption class="or os ot oh oi ou ov bf b bg z dx">Initial Data Format</figcaption></figure><p id="a106" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">After some preprocessing, we get the data into the format required by <a class="af nf" href="https://github.com/UdayLab/PAMI" rel="noopener ugc nofollow" target="_blank">PAMI</a> which is the Python library we are going to use for applying the EFIM algorithm.</p><pre class="ok ol om on oo po pp pq bp pr bb bk"><span id="9e55" class="ps nh fq pp b bg pt pu l pv pw">data['item_id'] = pd.factorize(data.Itemname)[0].astype(str) # map item names to id<br/>data["Value_Int"] = data["Value"].astype(int).astype(str)<br/>data = data.loc[data.Value_Int != '0'] # exclude items w/o utility<br/><br/>transaction_db = data.groupby('BillNo').agg(<br/>    items=('item_id', lambda x: ' '.join(list(x))),<br/>    total_value=('Value', lambda x: int(x.sum())),<br/>    values=('Value_Int', lambda x: ' '.join(list(x))),<br/>)<br/><br/># filter out long transactions, only use subset of transactions<br/>transaction_db = transaction_db.loc[transaction_db.num_items &lt; 10].iloc[:1000]</span></pre><figure class="ok ol om on oo op oh oi paragraph-image"><div class="oh oi qf"><img src="../Images/f1b0a477c01d571854d796c79562909a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*1r_OqVgiZR7kGA-5rhE9yw.png"/></div><figcaption class="or os ot oh oi ou ov bf b bg z dx">Transaction Database</figcaption></figure><p id="7362" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">We can then apply the <a class="af nf" href="https://udaylab.github.io/PAMI/highUtilityPatternMining.html" rel="noopener ugc nofollow" target="_blank">EFIM</a> algorithm.</p><pre class="ok ol om on oo po pp pq bp pr bb bk"><span id="f209" class="ps nh fq pp b bg pt pu l pv pw">import PAMI.highUtilityPattern.basic.EFIM as efim <br/><br/>obj = efim.EFIM('tdb.csv', minUtil=1000, sep=' ') <br/>obj.startMine()                       #start the mining process <br/>obj.save('out.txt')               #store the patterns in file <br/>results = obj.getPatternsAsDataFrame()     #Get the patterns discovered into a dataframe <br/>obj.printResults()   </span></pre><p id="de93" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The algorithm then returns a list of patterns that meet this minimum utility criterion.</p></div></div><div class="op"><div class="ab cb"><div class="ll qg lm qh ln qi cf qj cg qk ci bh"><figure class="ok ol om on oo op qm qn paragraph-image"><div role="button" tabindex="0" class="qb qc ed qd bh qe"><div class="oh oi ql"><img src="../Images/c97eeb8c4bf93dc415d2d0efaf12a071.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*5LLd8Um408r2iQaoGLP_Uw.png"/></div></div></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="9cb2" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">This is the point at which a subject matter expert would have to look at these patterns to see if there is something worth taking a closer look at. We can for example see that the combination of VINTAGE BEAD PINK PURSE’ and ‘ANT COPPER RED BOUDICCA BRACELET’ seems to perform quite well. In that case, we might think about offering these items as a bundle or recommending them together.</p><h1 id="ab32" class="ng nh fq bf ni nj nk gq nl nm nn gt no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Conclusion</h1><p id="1df1" class="pw-post-body-paragraph mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd fj bk">In this blog post, we looked at classical FIM and its limitations. Especially when we care about the transaction value of a pattern and the potential revenue it can provide, it can be beneficial to use HUIM and mine patterns with high utility.</p><h1 id="9faf" class="ng nh fq bf ni nj nk gq nl nm nn gt no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Resources &amp; Further Reading</h1><ul class=""><li id="c567" class="mi mj fq mk b go oc mm mn gr od mp mq mr oe mt mu mv of mx my mz og nb nc nd qo qp qq bk">[1] <a class="af nf" href="https://www.youtube.com/watch?v=dty9ircNDqI&amp;list=PLQWbHaW8RsA1wND30_Re9V5-c8pr1H56H&amp;index=9&amp;ab_channel=PhilippeFournier-Viger" rel="noopener ugc nofollow" target="_blank">High Utility Itemset Mining</a></li><li id="9684" class="mi mj fq mk b go qr mm mn gr qs mp mq mr qt mt mu mv qu mx my mz qv nb nc nd qo qp qq bk">[2] <a class="af nf" href="https://www.youtube.com/playlist?list=PLQWbHaW8RsA1wND30_Re9V5-c8pr1H56H" rel="noopener ugc nofollow" target="_blank">The Pattern Mining Course</a></li><li id="f06a" class="mi mj fq mk b go qr mm mn gr qs mp mq mr qt mt mu mv qu mx my mz qv nb nc nd qo qp qq bk">[3] <a class="af nf" href="https://www.philippe-fournier-viger.com/EFIM_JOURNAL_VERSION%20KAIS%202016.pdf" rel="noopener ugc nofollow" target="_blank">EFIM: A Fast and Memory Efficient Algorithm for High-Utility Itemset Mining</a></li><li id="ae0d" class="mi mj fq mk b go qr mm mn gr qs mp mq mr qt mt mu mv qu mx my mz qv nb nc nd qo qp qq bk">[4] <a class="af nf" href="https://www.coursera.org/learn/data-patterns?specialization=data-mining" rel="noopener ugc nofollow" target="_blank">Coursera Course on Pattern Mining</a></li></ul></div></div></div></div>    
</body>
</html>