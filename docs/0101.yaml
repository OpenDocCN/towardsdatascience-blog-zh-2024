- en: Spotting Spatiotemporal Patterns in Earthquake Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/spotting-spatiotemporal-patterns-in-earthquake-data-b07068b84314?source=collection_archive---------14-----------------------#2024-01-10](https://towardsdatascience.com/spotting-spatiotemporal-patterns-in-earthquake-data-b07068b84314?source=collection_archive---------14-----------------------#2024-01-10)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Use density-based clustering and survival analysis to estimate when earthquakes
    occur
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@elz1582?source=post_page---byline--b07068b84314--------------------------------)[![Elliot
    Humphrey](../Images/62f398bd178bd4eae0fb5c4062972e23.png)](https://medium.com/@elz1582?source=post_page---byline--b07068b84314--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--b07068b84314--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--b07068b84314--------------------------------)
    [Elliot Humphrey](https://medium.com/@elz1582?source=post_page---byline--b07068b84314--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--b07068b84314--------------------------------)
    ·9 min read·Jan 10, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4519b73a2e644d58c57fd4078fe17b72.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Eliška Motisová](https://unsplash.com/@eli_from_prague?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Whilst we have a fairly good understanding of where and why earthquakes occur,
    understanding when an earthquake will happen is very challenging. In this article
    we will use historical earthquake data and a combination of clustering and survival
    analysis to answer the following questions:'
  prefs: []
  type: TYPE_NORMAL
- en: '*“How are earthquake events spatially distributed?”*'
  prefs: []
  type: TYPE_NORMAL
- en: '*“If an earthquake happens, what’s the probability of another earthquake happening
    within the next hour?”*'
  prefs: []
  type: TYPE_NORMAL
- en: '*“Are there regional differences in the time between earthquake events?”*'
  prefs: []
  type: TYPE_NORMAL
- en: Getting the data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We will be using data from the USGS[[1](https://usgs.gov)] that records earthquake
    events (earthquake data resides in the Public Domain and is provided courtesy
    of the U.S. Geological Survey). They have a nice [API](https://earthquake.usgs.gov/fdsnws/event/1/)
    that means we can get earthquake data in a straightforward way in Python:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'In our API request we have a few parameters:'
  prefs: []
  type: TYPE_NORMAL
- en: '**limit** — *The maximum number of earthquake events we want*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**starttime** — *When should the earliest earthquake event be*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**minmagnitude** — *The minimum magnitude of an earthquake event*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**maxlatitude** — *Maximum latitude*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**minlatitude** — *Minimum latitude*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**maxlongitude** — *Maximum longitude*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**minlongitude** — *Minimum longitude*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We will set the minimum magnitude to 3, as this is typically what can be felt
    at the surface, and provide latitude and longitude coordinates to make a bounding
    box around the US state of California. California is home to the famous **San
    Andreas Fault**, so will have plenty of earthquake events for us to analyse.
  prefs: []
  type: TYPE_NORMAL
- en: 'To handle the GeoJSON response we use the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: This will return a Pandas DataFrame where each row is an earthquake event, with
    columns describing event properties (i.e., latitude, longitude, magnitude, id
    etc.).
  prefs: []
  type: TYPE_NORMAL
- en: 'For the geospatially-minded out there, you’ll recognise that the API call coordinates
    represent a *bounding box* of earthquakes (i.e., finds earthquakes in a boxed
    area), however we only care about **earthquakes in California**. Therefore we
    will need to filter out all the earthquakes that did not occur in California (e.g.,
    earthquake events in Nevada & Oregon). To do this we will use the convenient OSMNX
    package to get a **MultiPolygon of the California border**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Next we’ll convert our earthquake coordinates into **Point geometries using
    Shapely**, and then perform a **spatial join** to filter our non-Californian earthquakes:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Now to see our first map of Californian earthquakes colour-coded by magnitude:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0b68b55b7593862f5be48a8f9e49fee1.png)'
  prefs: []
  type: TYPE_IMG
- en: Map of earthquakes in California. Data from the USGS. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: Excellent, we now have a map of California earthquakes!
  prefs: []
  type: TYPE_NORMAL
- en: Spatial Clustering of earthquakes
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Looking at the earthquakes plotted on the map earlier you can see that events
    are spatially arranged in a linear SE-NW orientation, where you can see around
    2–3 clear linear-shaped groupings of earthquakes. This makes sense because:'
  prefs: []
  type: TYPE_NORMAL
- en: Earthquakes occur due to movements along faults, which are linear features (i.e.,
    cracks in the Earth’s crust).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The orientation of earthquake events matches the orientation of the San Andreas
    Fault zone.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Our goal is now to cluster these earthquake events based on their location,
    so that we can produce spatial clusters associated with regional faults.
  prefs: []
  type: TYPE_NORMAL
- en: For clustering we will use **HDBSCAN** (Hierarchical Density-Based Spatial Clustering
    of Applications with Noise) which is a density-based clustering algorithm useful
    for certain types of datasets, such as those with irregularly shaped clusters
    and varying cluster densities. This is relevant to our dataset since earthquake
    events can occur in **irregular shaped clusters** (i.e., along faults of different
    orientations) and in **different densities** (i.e, some fault zones are more active
    than others). HDBSCAN is also **robust to outliers**, which is this case can be
    earthquakes that occur far away from fault zones.
  prefs: []
  type: TYPE_NORMAL
- en: 'Through some experimentation the following parameters produce okay results
    (*a bit of trial and error involved, but guided by our prior assumptions on how
    earthquakes should be clustered*):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/2b5f834fd69d8787d7a685ad67af85cf.png)'
  prefs: []
  type: TYPE_IMG
- en: Earthquake locations color-coded by HDBSCAN cluster. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: Super, we have now used HDBSCAN to cluster our earthquake events into three
    areas, which corresponds with our prior regional knowledge. *Note that some earthquakes
    are considered outliers and coloured grey.*
  prefs: []
  type: TYPE_NORMAL
- en: Examining the time between earthquakes
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Since we have the date and time of each earthquake we can calculate **the time
    between each event** (i.e., the time duration between two earthquakes), which
    is required for our Survival Analysis in the next section. We have already sorted
    our values by the *‘datetime’* column so they’re in chronological order, now we
    need to calculate the time difference:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Since there will be no time difference for the last earthquake (i.e., the most
    recent) we can calculate the difference from a time we’ll assume as the present
    day:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally we will add a new column indicating whether an earthquake was followed
    by another earthquake. Whilst this seems slightly redundant, given that only the
    last earthquake is affected by this, it highlights an interesting point about
    using survival analysis for these types of tasks (which we’ll cover later):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Here is a histogram of the elapsed time between earthquake events:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/b78b04686bcdb6a09057350df3f36897.png)'
  prefs: []
  type: TYPE_IMG
- en: Histogram of earthquake interval times. Image by Author.
  prefs: []
  type: TYPE_NORMAL
- en: We can see that the majority of earthquakes occur in short succession of each
    other (approximately 2.5 hours of each other), with far fewer earthquakes occurring
    at longer time intervals apart (i.e., the maximum time between earthquakes in
    this dataset is 350 hours).
  prefs: []
  type: TYPE_NORMAL
- en: Survival Analysis of Earthquake Time Intervals
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We have our earthquake clusters, as well as the time between earthquakes, so
    now we use Survival Analysis to tell us about the probability of earthquake occurrences.
    Our goals will therefore be to:'
  prefs: []
  type: TYPE_NORMAL
- en: Use survival analysis to create curves that show the probability of an earthquake
    occurring in time, given that an earthquake has just occurred.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Compare our probability curves across our already clustered earthquake regions,
    to see if there are any similarities/differences in regional earthquake activity.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*What is survival analysis?*'
  prefs: []
  type: TYPE_NORMAL
- en: There are plenty of well-written articles [[2](/the-complete-introduction-to-survival-analysis-in-python-7523e17737e6),[3](https://medium.com/the-researchers-guide/survival-analysis-in-python-km-estimate-cox-ph-and-aft-model-5533843c5d5d),[4](/introduction-to-survival-analysis-6f7e19c31d96)]
    covering this, but in short, survival analysis is a statistical technique used
    to analyse time-to-event data, typically in the context of biomedical or observational
    studies. It focuses on estimating and modelling the time until an event of interest
    occurs, such as death, failure, or another specific outcome, providing insights
    into the probability of events happening over time and the impact of covariates
    on the event occurrence.
  prefs: []
  type: TYPE_NORMAL
- en: '**In our case, an earthquake has happened and we want to know the probability
    of another earthquake occurring over time.** *Note: we make the assumption that
    earthquake events are independent, as well as only retrieving events with a minimum
    magnitude of 3, which is a limitation of this work since it oversimplifies earthquake
    dynamics.*'
  prefs: []
  type: TYPE_NORMAL
- en: 'The **Kaplan-Meier estimator** is a non-parametric method used in survival
    analysis to estimate the survival function, which will give us our probabilities.
    We will use the package [**‘lifelines’**](https://pypi.org/project/lifelines/)to
    fit the Kaplan-Meier estimator to the earthquakes in each cluster, to produce
    a probability curve:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Before seeing the results, notice the ‘event_observed’ parameter that uses the
    ‘event_happened’ column we created earlier. Our final earthquake is an example
    of a right-censored data point, since there was no following earthquake, and is
    therefore treated as a partial observation.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now to view the curves:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e8b53a4f807fd1e75b46f57be450ffcf.png)'
  prefs: []
  type: TYPE_IMG
- en: Survival analysis probability curves for clustered earthquake regions. Image
    by Author.
  prefs: []
  type: TYPE_NORMAL
- en: 'Each cluster of earthquakes has its own coloured curve, where the X axis represents
    the time elapsed after an earthquake, and the Y axis represents the probability
    of an earthquake occurring. Some interesting observations:'
  prefs: []
  type: TYPE_NORMAL
- en: The shape of the curves are similar.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The initial steepness of the curves varies by cluster location.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Lets focus on the initial time after an earthquake has occurred, since most
    of our data shows that earthquakes happen in relatively quick succession:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/2c43d41fa913ec967e2bfed744cd775f.png)'
  prefs: []
  type: TYPE_IMG
- en: Survival analysis probability curves for clustered earthquake regions. Image
    by Author.
  prefs: []
  type: TYPE_NORMAL
- en: This suggests that the **time between earthquakes is not the same regionally**.
    Looking at the graph we can say that once an earthquake event has happened, the
    probability of another earthquake happening within ten hours is approximately
    35% for cluster 0, 60% for cluster 1, and 48% for cluster 2\. This shows that
    earthquakes in the region that belong to cluster 1 happen in quick success relative
    to the other two areas.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can double check this by looking at a histogram of elapsed time between
    earthquakes for each cluster location:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/d579ab6fdf6ae30d39347cdf2a49c56e.png)'
  prefs: []
  type: TYPE_IMG
- en: Histograms of elapsed time between earthquakes in clustered regions. Image by
    Author.
  prefs: []
  type: TYPE_NORMAL
- en: As shown by the probability curves, cluster 1 has longer intervals between earthquake
    events relative to clusters 2 and 3.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This work utilised **spatial clustering** and **survival analysis** to unravel
    temporal and geographic patterns within earthquake data. By employing techniques
    such as **HDBSCAN** for spatial clustering and the **Kaplan-Meier** estimator
    for survival analysis, we gained valuable insights into the **regional variations
    in time between earthquakes**, which was translated into probability curves that
    can be useful for risk assessment and preparedness in earthquake-prone regions.
  prefs: []
  type: TYPE_NORMAL
- en: Thanks for reading!
  prefs: []
  type: TYPE_NORMAL
- en: '*Disclaimer: This article should only be used for learning purposes.*'
  prefs: []
  type: TYPE_NORMAL
