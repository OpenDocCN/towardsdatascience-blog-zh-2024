<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Visualizing Dynamical Behavior in Agent-Based Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Visualizing Dynamical Behavior in Agent-Based Models</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-dynamical-behavior-in-agent-based-models-70bb81dc0e93?source=collection_archive---------9-----------------------#2024-03-05">https://towardsdatascience.com/visualizing-dynamical-behavior-in-agent-based-models-70bb81dc0e93?source=collection_archive---------9-----------------------#2024-03-05</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="fr fs ft fu fv fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp fq"><img src="../Images/535063d1630e3ce67be8af53598f0beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdi4NKTcDhaetDq83-oPgA.png"/></div></div></figure><div/><div><h2 id="eaf6" class="pw-subtitle-paragraph hc ge gf bf b hd he hf hg hh hi hj hk hl hm hn ho hp hq hr cq dx">And encountering emergent complexity along the way</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hs ht hu hv hw ab"><div><div class="ab hx"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@Dani_Lisle?source=post_page---byline--70bb81dc0e93--------------------------------" rel="noopener follow"><div class="l hy hz by ia ib"><div class="l ed"><img alt="Dani Lisle" class="l ep by dd de cx" src="../Images/2933bbbca26cf198e7964547a91b2751.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*a4gKCYqEZAlyGqsVKTldOg.jpeg"/><div class="ic by l dd de em n id eo"/></div></div></a></div></div><div class="ie ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--70bb81dc0e93--------------------------------" rel="noopener follow"><div class="l if ig by ia ih"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ii cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ic by l br ii em n id eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="ij ab q"><div class="ab q ik"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b il im bk"><a class="af ag ah ai aj ak al am an ao ap aq ar in" data-testid="authorName" href="https://medium.com/@Dani_Lisle?source=post_page---byline--70bb81dc0e93--------------------------------" rel="noopener follow">Dani Lisle</a></p></div></div></div><span class="io ip" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b il im dx"><button class="iq ir ah ai aj ak al am an ao ap aq ar is it iu" disabled="">Follow</button></p></div></div></span></div></div><div class="l iv"><span class="bf b bg z dx"><div class="ab cn iw ix iy"><div class="iz ja ab"><div class="bf b bg z dx ab jb"><span class="jc l iv">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--70bb81dc0e93--------------------------------" rel="noopener follow"><p class="bf b bg z jd je jf jg jh ji jj jk bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="io ip" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">9 min read</span><div class="jl jm l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Mar 5, 2024</span></div></span></div></span></div></div></div><div class="ab cp jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="h k w ea eb q"><div class="ks l"><div class="ab q kt ku"><div class="pw-multi-vote-icon ed jc kv kw kx"><div class=""><div class="ky kz la lb lc ld le am lf lg lh kx"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l li lj lk ll lm ln lo"><p class="bf b dy z dx"><span class="kz">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao ky lp lq ab q ee lr ls" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lt"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q kd ke kf kg kh ki kj kk kl km kn ko kp kq kr"><div class="lu k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lv an ao ap is lw lx ly" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lz cn"><div class="l ae"><div class="ab cb"><div class="ma mb mc md me gb ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lv an ao ap is mf mg ls mh mi mj mk ml s mm mn mo mp mq mr ms u mt mu mv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lv an ao ap is mf mg ls mh mi mj mk ml s mm mn mo mp mq mr ms u mt mu mv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lv an ao ap is mf mg ls mh mi mj mk ml s mm mn mo mp mq mr ms u mt mu mv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="9521" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">In my research into streamlining strategic knowledge extraction in game theoretic problems, I recently realized that I needed a better way to simply and intuitively visualize the behavior of agents with defined dynamical behavior.</p><p id="78eb" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">This led me to build a simple library for visualizing agent behavior as an animation using PyPlot. But before jumping into the tutorial, here’s a quick catch-up on the core concepts at play here.</p><h1 id="e655" class="ns nt gf bf nu nv nw hf nx ny nz hi oa ob oc od oe of og oh oi oj ok ol om on bk">A Quick Primer on Dynamical Agent-Based Modeling</h1><p id="3e00" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">Agent based modeling (ABM) offers an excellent way to simulate players in many game theoretic environments. It lets us model and study the behavior and cognitive processes of each individual player, rather than just analyzing trends. When it isn’t practical to represent agents using simplistic binary state machines like cellular automata grids, ABM lets us capture scenarios by representing the agents’ positions in a dimensional space, where each dimension has its own unique rules.</p><h2 id="f359" class="ot nt gf bf nu ou ov ow nx ox oy oz oa nf pa pb pc nj pd pe pf nn pg ph pi pj bk">Agents in Position and State Space</h2><p id="e004" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">By utilizing both spatial and state dimensions we can accurately model proximity as well as incorporate attributes that allow for subtle interactions, such as similarity in characteristics. Furthermore, storing the “positions” of agents in state space allow us to keep track of and compare detailed and dynamic state information about agents (i.e. a player’s fatigue in a model of football).</p><p id="ee5b" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">Compared to network models, wherein the existence of connections between two objects indicate relationships, position-state-space information lets us to define and explore more complex and higher-dimensional relationships between agents. In this paradigm, Euclidean distance in state-space could represent a strong measure of the state similarity between two agents.</p><h2 id="c86a" class="ot nt gf bf nu ou ov ow nx ox oy oz oa nf pa pb pc nj pd pe pf nn pg ph pi pj bk">Dynamical Systems Theory for Behavior and Interaction</h2><p id="69ab" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">We can make such a model even more powerful by using dynamical systems theory to describe how the state of one agent influences those of others. It provides a robust way to define rules a system’s evolution over time.</p><p id="0355" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">In socioeconomic systems, differential equations can be used to model communication, mimicry, and more complex adaptive processes, as well as describe how individual actions can produce group dynamics.</p><h1 id="62c3" class="ns nt gf bf nu nv nw hf nx ny nz hi oa ob oc od oe of og oh oi oj ok ol om on bk">Visualization Needs in Time and Space</h1><p id="24a5" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">For my problem, I wanted to be able see the position of each agent and its movement over time at a glance, and some basic state information (i.e. one or two variables per agent).</p><p id="b0fb" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">There are currently several libraries that meet the need for visualizing ABMs, including NetLogo and Mesa (for Python). However, they are built primarily for visualizing discrete-space, rather than continuous-space models. For my purposes, I was interested in the latter, and so began the side quest. If you’d like to follow along or test out the code for yourself, it’s all stored at <a class="af pk" href="https://github.com/dreamchef/abm-dynamics-viz" rel="noopener ugc nofollow" target="_blank">github.com/dreamchef/abm-viz</a>.</p><h1 id="b9da" class="ns nt gf bf nu nv nw hf nx ny nz hi oa ob oc od oe of og oh oi oj ok ol om on bk">Building the Classes and Animation in Python</h1><p id="1701" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">For starters, I needed to represent and store the agents and the world, and their state and dynamics. I chose to do this using Python classes. I defined an Agent class with a set of variables that I thought might be relevant to many possible modeling tasks. I also defined a plottable circle object (with PyPlot) for each agent within the class structure.</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="a001" class="pu nt gf pr b bg pv pw l px py">class Agent:<br/><br/>    def __init__(self, index, position, velocity, empathy=1, ... dVision=0, age=0, plotSize=10):<br/>        <br/>        self.index = index<br/>        self.velocity = np.array(velocity)<br/>        self.empathy = empathy<br/>        ...<br/>        self.dVision = dVision<br/>        self.color = HSVToRGB([self.species,1,1])<br/>        self.plotSize=plotSize<br/><br/>        self.pltObj = plt.Circle(self.position, self.plotSize, color=self.color)</span></pre><p id="f80e" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">Then, after a bit of experimentation, I found that it in the spirit of good objected-oriented programming principles, it would be best to define a World (think game or system) class as well. In included both the state information for the world and the information for the plots and axes in the class structure:</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="894c" class="pu nt gf pr b bg pv pw l px py">class World:<br/><br/>    def __init__(self,population=1,spawnSize=400,worldSize=1200,worldInterval=300,arrows=False,agentSize=10):<br/>        <br/>        self.agents = []<br/>        self.figure, self.ax = plt.subplots(figsize=(12,8))<br/>        self.ax.set_xlim(-worldSize/2, worldSize/2)<br/>        self.ax.set_ylim(-worldSize/2, worldSize/2)<br/><br/>        self.worldInterval = worldInterval<br/>        self.worldSize = worldSize<br/>        self.arrows = arrows<br/>        self.agentSize = agentSize<br/><br/>        for i in range(population):<br/><br/>            print(i)<br/><br/>            newAgent = Agent(index=i, position=[rand()*spawnSize - spawnSize/2, rand()*spawnSize - spawnSize/2],<br/>                                     velocity=[rand()*spawnSize/10 - spawnSize/20, rand()*spawnSize/10 - spawnSize/20], plotSize = self.agentSize)<br/><br/>            self.agents.append(newAgent)<br/>            self.ax.add_patch(newAgent.pltObj)<br/><br/>            print('Created agent at',newAgent.position,'with index',newAgent.index)<br/><br/>        self.spawnSize = spawnSize</span></pre><p id="3967" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">I wrote this class so that the programmer can simply specify the desired number of agents (along with other parameters such as a world size and spawn area size) rather than manually creating and adding agents in the main section.</p><p id="25b2" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">With this basic structure defined and agents being generated with randomized positions and initial velocities in the world, I then used PyPlot library’s animation features to create a method which would begin the visualization:</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="f95d" class="pu nt gf pr b bg pv pw l px py">def start(self):<br/><br/>        ani = animation.FuncAnimation(self.figure, self.updateWorld, frames=100, interval=self.worldInterval, blit=True)<br/><br/>        plt.show()</span></pre><p id="5444" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">This function references the figure, stored in the World instance, some specifications for the speed and length of the animation, and an update function, which is also defined in the World class:</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="9f53" class="pu nt gf pr b bg pv pw l px py">def updateWorld(self,x=0):<br/><br/>        pltObjects = []<br/><br/>        for agent in self.agents:<br/><br/>            agent.updatePosition(self.agents, self.worldSize)<br/>            agent.pltObj.center = agent.position<br/>            pltObjects.append(agent.pltObj)<br/><br/>            if self.arrows is True:<br/>           <br/>                velocityArrow = plt.Arrow(agent.position[0], agent.position[1], agent.velocity[0], agent.velocity[1], width=2, color=agent.color)<br/><br/>                self.ax.add_patch(velocityArrow)<br/><br/>                pltObjects.append(velocityArrow)<br/><br/>        return pltObjects</span></pre><p id="d3ee" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">The World.updatePosition function simply added each agent’s static velocity to the current position. This preliminary work was able to generate simple animations like this:</p><figure class="pl pm pn po pp fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp pz"><img src="../Images/62630e7bd868ec7c0f0e00b752b71c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S5vN0xjdAHi9EZ0jMa7Jaw.gif"/></div></div><figcaption class="qa qb qc fo fp qd qe bf b bg z dx">Constant Velocities</figcaption></figure><p id="8a0c" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">With this basic functionality, we’d now like to be able to visualize more interesting dynamics.</p><h1 id="ebfd" class="ns nt gf bf nu nv nw hf nx ny nz hi oa ob oc od oe of og oh oi oj ok ol om on bk">Visualizing “Social” Dynamic Behavior</h1><p id="2669" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">I first chose to define a dynamic where each agent would change its direction of movement based on the average direction of movement of other agents around it. In equation form:</p><figure class="pl pm pn po pp fw fo fp paragraph-image"><div class="fo fp qf"><img src="../Images/3a277f060187732ccbdba91e6e82777d.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*hm1Mu2jiJZU-Gaz2TpSmOA.png"/></div></figure><p id="9195" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">I encoded the dynamic in Python via an Agent.updatePosition() and an Agent.updateVelocity() method, which are run on each animation frame:</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="b082" class="pu nt gf pr b bg pv pw l px py">def updatePosition(self, agents, worldSize):<br/><br/>        self.updateVelocity(agents)<br/><br/>        self.position += self.velocity<br/><br/>        ...<br/><br/>    def updateVelocity(self, agents):<br/><br/>        herd_velocity = self.herdVelocity(agents)<br/><br/>        herd_magnitude = np.linalg.norm(herd_velocity)<br/>        self_magnitude = np.linalg.norm(self.velocity)<br/><br/>        if herd_magnitude &gt; 0.1:<br/>            <br/>            herd_unit_velocity = herd_velocity/herd_magnitude<br/><br/>            self.velocity += herd_unit_velocity<br/></span></pre><p id="7671" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">In the PyPlot animation below, the agents begin with very different velocities, but quickly adjust and begin traveling in the same direction. In this case, the average direction was roughly upward in the Y-direction at first.</p><figure class="pl pm pn po pp fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp pz"><img src="../Images/c71a52a10d0d946ff5df87bb544bff4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uNQr29j8LYpoKgex2jw6Og.gif"/></div></div><figcaption class="qa qb qc fo fp qd qe bf b bg z dx">Converging Upward</figcaption></figure><p id="c50e" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">This time, the group had initialized with a roughly leftward velocity with one “straggling”, who quickly adjusts.</p><figure class="pl pm pn po pp fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp pz"><img src="../Images/fc77372a07139faeff1b8014388fb0f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9xbMA7_UoMJTEp-lQgzRw.gif"/></div></div><figcaption class="qa qb qc fo fp qd qe bf b bg z dx">Single Straggler to Leftward Convergence</figcaption></figure><h2 id="37bf" class="ot nt gf bf nu ou ov ow nx ox oy oz oa nf pa pb pc nj pd pe pf nn pg ph pi pj bk">Displaying Velocity Vectors</h2><p id="d238" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">Next I realized it would be helpful to see the velocity of the agents more clearly, so I implemented arrows to show each agent’s magnitude and direction:</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="2932" class="pu nt gf pr b bg pv pw l px py">velocityArrow = plt.Arrow(agent.position[0], agent.position[1], agent.velocity[0], agent.velocity[1], width=2, color=agent.color)<br/>self.ax.add_patch(velocityArrow)<br/>pltObjects.append(velocityArrow)</span></pre><p id="c863" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">That modification gave more helpful animations like this one. We can still notice the converging-velocities dynamic at a glance, but see the rates of acceleration more clearly now as well.</p><figure class="pl pm pn po pp fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp pz"><img src="../Images/8322d6407c8d74f5dbba398bd6d03b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VPqQThFYq9lmNSsf_DZP5A.gif"/></div></div><figcaption class="qa qb qc fo fp qd qe bf b bg z dx">Velocity Arrows</figcaption></figure><p id="65fe" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">For the animation above, I also adjusting the dynamic to be dependent on a sight range variable. In other words, agents only adjust their velocities to match agents that are nearby (within 300 units in this case).</p><p id="54c8" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">I also modified the code so that each agent would only modify its direction of movement, not its speed. Keep this in mind for the next section.</p><h1 id="fbcf" class="ns nt gf bf nu nv nw hf nx ny nz hi oa ob oc od oe of og oh oi oj ok ol om on bk">More Complex, State-Wise Dynamics</h1><p id="8d09" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">Up until this point, I had only implemented dynamics which considered the positions and velocities of each agent. But as I alluded to in the overview section, consider non-spatial, state information as well can make our modeling approach much more generalizable.</p><h2 id="94a3" class="ot nt gf bf nu ou ov ow nx ox oy oz oa nf pa pb pc nj pd pe pf nn pg ph pi pj bk">Using Agent Hue and Saturation To Represent State Variables</h2><p id="1ac6" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">I made use an auxiliary state tied to the RGB color of each agent. Foreshadowing the evolutionary game theoretic goals of my research, I call this the agent “species”, and implement it as follows.</p><p id="a1c4" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">In the Agent.__init__ method, I added random species generation and individual mapping to the color of the agent’s marker on the plot:</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="9e15" class="pu nt gf pr b bg pv pw l px py">self.species = rand()<br/>self.color = HSVToRGB([self.species,1,1])<br/>self.pltObj = plt.Circle(self.position, self.plotSize, color=self.color)</span></pre><p id="d5ca" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">Specifically, I assigned this to the hue of the object, to reserve the saturation (roughly grey-ness) for other variables of potential interest (i.e. remaining lifespan or health). This practice of dividing hue and saturation has precedent in the visualization of complex-valued functions, which I go into in <a class="af pk" href="https://medium.com/towards-data-science/today-i-was-pouring-through-my-complex-variables-and-analytic-functions-book-written-by-the-e9205f71485d" rel="noopener">this article</a>.</p><h2 id="4e25" class="ot nt gf bf nu ou ov ow nx ox oy oz oa nf pa pb pc nj pd pe pf nn pg ph pi pj bk">Dependence of Acceleration on Species State Variable</h2><p id="3738" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">With examples of herding behavior in nature that occurs between animals of the same species, but not between those of differing species, I decided to change our toy dynamics to consider species. This change meant that each agent will only modify its direction for agents that are sufficiently close in the world and sufficiently similar in species (i.e. similarly colored circles).</p><p id="1690" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">Now, this is where things, began to get <strong class="my gg">very, very interesting</strong>. Before you continue reading, ask yourself:</p><ul class=""><li id="251c" class="mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr qg qh qi bk"><em class="qj">What behavior do you expect to see in the next animation?</em></li></ul><p id="bc1e" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">A relatively naive experimenter (such as myself most of the time) would expect agents to organize themselves by species and travel in herds, with each herd tending to travel in different directions and mostly ignoring each other. To see if either of us is right, let’s continue.</p><p id="0448" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">To encode this behavior I modified the calculation of herd velocity with respect to an agent in the following way:</p><pre class="pl pm pn po pp pq pr ps bp pt bb bk"><span id="4ba7" class="pu nt gf pr b bg pv pw l px py">herd_velocity += neighbor.velocity * (0.5-np.sqrt(abs(self.species-neighbor.species)))</span></pre><p id="9e39" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">That change resulted in animations like this one. To see the interesting behavior here, I started recording this about 20 seconds into the animation.</p><figure class="pl pm pn po pp fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp pz"><img src="../Images/72c034b975c1a23e2db32ccf1cc87b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytJXXtAr5JAH_hnlOX9_gw.gif"/></div></div><figcaption class="qa qb qc fo fp qd qe bf b bg z dx">Emergent Behavior</figcaption></figure><p id="2bfd" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">It’s okay if the behavior isn’t immediately obvious. It’s subtle. And if you think you predicted it correctly, great job!</p><p id="fe25" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">As it turned out, the agents didn’t organize themselves into herds by species very well at all. Instead, the only agents who seem to stick together are the ones who have both similar species and similar travel speed. You can see this happening most often with the slower green agents, the pair of blue agents, and the fast blue and purple agents shooting across the bottom of the screen. Notably, the agents seem to prioritize speed over species similarity when “choosing” who to travel with. You can see this most often with the light, dark blue, and even purple agents.</p><p id="5584" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">This makes perfect sense in the dynamics we defined, since each agent’s speed is constant, and agents with different speeds will ultimately fall behind or run away from their comrades. And yet, its somewhat surprising.</p><p id="ba61" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">Fundamentally, this is because the behavior is emergent. In other words, we didn’t explicitly tell the agents to behave in this way as a group. Rather, they “derived” this behavior from the simple set of instructions, which we gave to each individual agent in an identical encoded format.</p><h1 id="3dbc" class="ns nt gf bf nu nv nw hf nx ny nz hi oa ob oc od oe of og oh oi oj ok ol om on bk">Visualization, Emergence, and Data Insights</h1><p id="00fa" class="pw-post-body-paragraph mw mx gf my b hd oo na nb hg op nd ne nf oq nh ni nj or nl nm nn os np nq nr fj bk">We began this journey with the simple goal of visualizing an ABM to make sure on a high level that the dynamics we would set up would work as intended. But in addition to accomplishing this, we stumbled upon an emergent behavior which we may not have even considered when creating the model.</p><p id="849d" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">This illustrates an important partnership with respect to visualization in data science, simulations, and modeling across the board. Discovering emergent behavior in complex systems can be accelerated by new perspectives on the model or dataset. This isn’t only true for agent-based modeling. It applies to obtaining insights across the rest of data science as well. And creating new and creative visualizations provides a sure-fire way to get such perspectives.</p><p id="f791" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk">If you’d like to play around with this model and visualization further, you can get the code at <a class="af pk" href="https://github.com/dreamchef/abm-dynamics-viz" rel="noopener ugc nofollow" target="_blank">github.com/dreamchef/abm-viz</a>. I’d love to hear what else you may find, or your thoughts on my work, in the comments! Feel free to reach out to me on <a class="af pk" href="https://twitter.com/dani_lisle" rel="noopener ugc nofollow" target="_blank">Twitter</a> and <a class="af pk" href="https://www.linkedin.com/in/danilisle/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> as well. Have a great day!</p><p id="aa13" class="pw-post-body-paragraph mw mx gf my b hd mz na nb hg nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr fj bk"><em class="qj">Unless otherwise noted, all images and animations were created by the author.</em></p></div></div></div></div>    
</body>
</html>