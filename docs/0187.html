<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Map-Matching for Speed Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Map-Matching for Speed Prediction</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/map-matching-for-speed-prediction-f1a534626368?source=collection_archive---------6-----------------------#2024-01-19">https://towardsdatascience.com/map-matching-for-speed-prediction-f1a534626368?source=collection_archive---------6-----------------------#2024-01-19</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="76f9" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">How fast will you drive?</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@joao.figueira?source=post_page---byline--f1a534626368--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="João Paulo Figueira" class="l ep by dd de cx" src="../Images/54e4176f66e4ab0324d86ec71d8b033d.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*KhSF0xxPYqlN4Y6vnClBQQ.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--f1a534626368--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@joao.figueira?source=post_page---byline--f1a534626368--------------------------------" rel="noopener follow">João Paulo Figueira</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--f1a534626368--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">14 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 19, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/b7afc8f369f6eb24fe5c635ffc56dc59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mf8f70oxa8efV2FJ"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@julianhochgesang?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Julian Hochgesang</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8d7a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">When planning future vehicle routes, you trust the digital map providers for accurate speed predictions. You do this when picking your phone up to prepare for a car trip or, in a professional setting, when planning routes for your vehicle fleet. The forecasted speeds are an essential component of the trip’s cost, especially as they are one of the fundamental drivers of energy consumption in electric and combustion vehicles.</p><p id="9ecc" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The digital mapping service providers collect information from live traffic and historical records to estimate how fast you can drive along a specific road at any given time. With this data and intelligent algorithms, they estimate how quickly an average vehicle will travel through the planned route. Some services will accept each vehicle’s features to tune the route path and the expected trip times.</p><p id="a050" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">But what about specific vehicles and drivers like yours? Do these predictions apply? Your cars and drivers might have particular requirements or habits that do not fit the standardized forecasts. Can we do better than the digital map service providers? We have a chance if you keep a good record of your historical telematics data.</p><h1 id="3c74" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Introduction</h1><p id="ea94" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">In this article, we will improve the quality of speed predictions from digital map providers by leveraging the historical speed profiles from a telematics database. This database contains records of past trips that we use to modulate the standard speed inferences from a digital map provider.</p><p id="75b1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Central to this is map-matching, the process by which we “snap” the observed GPS locations to the underlying digital map. This correcting step allows us to bring the GPS measurements in line with the map’s road network representation, thus making all location sources comparable.</p><h2 id="cfb8" class="pa oa fq bf ob pb pc pd oe pe pf pg oh nm ph pi pj nq pk pl pm nu pn po pp pq bk">The Road Network</h2><p id="e898" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">A road network is a mathematical concept that supports most digital mapping applications. Usually implemented as a <a class="af nc" href="https://en.wikipedia.org/wiki/Multigraph" rel="noopener ugc nofollow" target="_blank">directed multi-graph</a>, each node represents a known geospatial location, usually some noteworthy landmark such as an intersection or a defining point on a road bend, and the connecting directed edges represent straight-line paths along the road. <strong class="nf fr">Figure 1</strong> below illustrates the concept.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pr"><img src="../Images/a8da38c3b7d740969b46410ce73f6739.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*GtVhXSissN4i0q_gPXqB5w.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf ob">Figure 1</strong> — The diagram above shows the simplified representation of a road segment as represented by a digital map. Each node, represented by a red dot, corresponds to a known geospatial location defined by latitude, longitude, and altitude coordinates. Each connecting line is an edge, and digital maps use these to represent the roads (the travel direction is omitted here). When we ask a digital map provider for directions, we get a long sequence of these nodes and edges and an estimate of the time it will take to travel such roads. (Image source: Author)</figcaption></figure><p id="7844" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">When we request a route from a digital map provider, we get a sequence of road network nodes and their connecting edges. The service also provides the estimated travel times and corresponding speeds between all pairs of nodes (in some cases, the speed estimates cover a range of nodes). We get the total trip duration by adding all the partial times together.</p><p id="1add" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">If we get better estimates for these times, we will also have better speed estimates and a better route prediction overall. The source for these better estimates is your historical telematics data. But knowing the historic speeds is just a part of the process. Before we can use these speeds, we must make sure that we can project them onto the digital map, and for this, we use map-matching.</p><h2 id="8b77" class="pa oa fq bf ob pb pc pd oe pe pf pg oh nm ph pi pj nq pk pl pm nu pn po pp pq bk">Map-Matching</h2><p id="1031" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk"><a class="af nc" href="https://en.wikipedia.org/wiki/Map_matching" rel="noopener ugc nofollow" target="_blank">Map-matching</a> projects sequences of GPS coordinates sampled from a moving object’s path to an existing road graph. The matching process uses a <a class="af nc" href="https://medium.com/@joao.figueira/list/hmm-9940e39b81d9" rel="noopener">Hidden Markov Model</a> to map the sampled locations to the most likely graph edge sequence. As a result, this process produces both the edge projections and the implicit node sequence. You can read a more detailed explanation in my previous article on map matching:</p><div class="ps pt pu pv pw px"><a rel="noopener follow" target="_blank" href="/map-matching-for-trajectory-prediction-be307a1547f0?source=post_page-----f1a534626368--------------------------------"><div class="py ab ig"><div class="pz ab co cb qa qb"><h2 class="bf fr hw z io qc iq ir qd it iv fp bk">Map-Matching for Trajectory Prediction</h2><div class="qe l"><h3 class="bf b hw z io qc iq ir qd it iv dx">Where are you going? Should you be going that way?</h3></div><div class="qf l"><p class="bf b dy z io qc iq ir qd it iv dx">towardsdatascience.com</p></div></div><div class="qg l"><div class="qh l qi qj qk qg ql lr px"/></div></div></a></div><p id="0824" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">After reading the above article, you will understand that the <a class="af nc" href="https://valhalla.github.io/valhalla/" rel="noopener ugc nofollow" target="_blank">Valhalla</a> map-matching algorithm projects the sampled GPS locations into road network edges, not to the nodes. The service may also return the matched poly-line defined in terms of the road network nodes. So, we can get both edge projections and the implicit node sequence.</p><p id="b3e0" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">On the other hand, when retrieving a route plan from the same provider, we also get a sequence of road network nodes. By matching these nodes to the previously map-matched ones, we can overlay the known telematics information to the newly generated route and thus improve the time and speed estimates with actual data.</p><p id="4119" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Before using the map-matched locations to infer actual speeds, we must project them to the nodes and adjust the known travel times, as illustrated in <strong class="nf fr">Figure 2</strong> below.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qm"><img src="../Images/06535e699f86a2d8135667d9726725f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KVAemw-NsR_A4PlkoAwIfA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf ob">Figure 2</strong> — The diagram above illustrates the challenge of mapping the implicit speeds of sampled GPS locations, displayed as green dots, to the speeds between the map nodes, represented as red dots. The orange diamonds represent the map-matched sampled GPS locations. In this problem, we know the average speeds between the green dots and want to infer the average speeds between the red dots. (Image source: Author)</figcaption></figure><p id="215e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">As a prerequisite, we must correctly sequence both sets of locations, the nodes, and the map matches. This process is depicted in <strong class="nf fr">Figure 2</strong> above, where the map matches, represented by the orange diamonds, are sequenced along with the road network nodes, represented as red dots. The travel sequence is obviously from left to right.</p><p id="728b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We assume the time differences between the GPS locations are the same as the map-matched ones. This assumption, illustrated by <strong class="nf fr">Figure 3</strong> below, is essential because there is no way to infer what effect in time the map matching has. This assumption simplifies the calculation while keeping a good approximation.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qn"><img src="../Images/f75f570ad3f325ec79cdfb99a7119eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*c7CdJOdpKtS1vjE8tijY7g.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf ob">Figure 3</strong> — We assume that the time differences between consecutive samples are the same as the corresponding map-matched ones. (Image source: Author)</figcaption></figure><p id="9ac8" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Now that we know the time differences between consecutive orange diamonds, our challenge is to use this information to infer the time differences between consecutive red dots (nodes). <strong class="nf fr">Figure 4</strong> below shows the relationship between the two sequences of time differences.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qo"><img src="../Images/b2ffe8d3f5a9e098781f0d9bdb86ab20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*3tA_mIyrUC9aF7QWTU_9bw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf ob">Figure 4 </strong>— The diagram above helps us understand how we interpolate the time differences between road network nodes (red dots) using the time differences from the sequence of map-matched locations (orange diamonds). (Image source: Author)</figcaption></figure><p id="cb51" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We can safely assume that the <em class="qp">average speeds</em> between consecutive orange diamonds are constant. This assumption is essential for what comes next. But before we proceed, let’s define some terminology. We will use some simplifications due to Medium’s typesetting limitations.</p><p id="d478" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We need to deal with two fundamental quantities: distances and timespans. Using <strong class="nf fr">Figure 4</strong> above as a reference, we define the distance between the orange diamond one and red dot one as <em class="qp">d(n1, m1)</em>. Here, the letter “<em class="qp">m</em>” stands for “map-matched,” and the letter “<em class="qp">n</em>” stands for node. Similarly, the corresponding timespan is <em class="qp">t(n1, m1)</em>, and the average speed is <em class="qp">v(n1, m1)</em>.</p><p id="960f" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Let us focus on the first two nodes and see how we can derive the average speed (and the corresponding timespan) using the known timespans from orange diamonds one to four. The average speed of travel between the first two map-matched locations is thus:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qq"><img src="../Images/8f3327843f5029f436555f7519e2b5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*YzOpu0cKIMfmqlIz29whwA.png"/></div></figure><p id="515e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Because the average speed is constant, we can now compute the first timespan.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qr"><img src="../Images/b94d68d33cacaedd0d1ffd808be12b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*xGHKtBvxJL6HUFxHUml_Vg.png"/></div></figure><p id="d60d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The second timespan is just <em class="qp">t(m2, m3)</em>. For the final period, we can repeat the process above. The total time is thus:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qs"><img src="../Images/9afe8ec325448a286630b196446e8916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*PewGVW1v5PdGNtV5gaKXhg.png"/></div></figure><p id="1f0b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We must repeat this process, adapting it to the sequence of nodes and map matches to calculate the projected trip times between all nodes.</p><p id="3bd9" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Now that we have seen how to project measured speeds onto a digital map let’s see where to get the data.</p><h2 id="1ee2" class="pa oa fq bf ob pb pc pd oe pe pf pg oh nm ph pi pj nq pk pl pm nu pn po pp pq bk">Telematics Database</h2><p id="99ef" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">This article uses a telematics database to infer unknown road segment average speeds. All the geospatial data in the database is already map-matched to the underlying digital map. This characteristic helps us match future service-provided routes to the known or projected road segment speeds using the abovementioned process.</p><p id="d6d4" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Here, we will use a tried-and-true open-source telematics database I have been exploring lately and presented in a previously published article, the <a class="af nc" href="https://arxiv.org/pdf/2203.08630.pdf#:~:text=We%20present%20an%20eVED%20dataset,vehicle%20behavior%20and%20traffic%20dynamics." rel="noopener ugc nofollow" target="_blank">Extended Vehicle Energy Dataset</a> (EVED), licensed under Apache 2.0.</p><div class="ps pt pu pv pw px"><a rel="noopener follow" target="_blank" href="/travel-time-estimation-using-quadkeys-ecf6d54823b4?source=post_page-----f1a534626368--------------------------------"><div class="py ab ig"><div class="pz ab co cb qa qb"><h2 class="bf fr hw z io qc iq ir qd it iv fp bk">Travel Time Estimation Using Quadkeys</h2><div class="qe l"><h3 class="bf b hw z io qc iq ir qd it iv dx">This article explains how to estimate travel times using known speed vectors indexed by quadkeys.</h3></div><div class="qf l"><p class="bf b dy z io qc iq ir qd it iv dx">towardsdatascience.com</p></div></div><div class="qg l"><div class="qt l qi qj qk qg ql lr px"/></div></div></a></div><h1 id="701d" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Proposed Solution</h1><p id="2e35" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">We develop the solution in two steps: data preparation and prediction. In the data preparation step, we traverse all known trips in the telematics database and project the measured trip times to the corresponding road network edges. These computed edge traversal times are then stored in another database using maximum resolution <a class="af nc" href="https://h3geo.org/docs/" rel="noopener ugc nofollow" target="_blank">H3</a> indices for faster searches during exploration. At the end of the process, we have collected traversal time distributions for the known edges, information that will allow us to estimate travel speeds in the prediction phase.</p><p id="92fc" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The prediction phase requires a source route expressed as a sequence of road network nodes, such as what we get from the Valhalla route planner. We query each pair of consecutive nodes' corresponding traversal time distribution (if any) from the speed database and use its mean (or median) to estimate the local average speed. By adding all edge estimates, we get the intended result, the expected total trip time.</p><h2 id="6a5f" class="pa oa fq bf ob pb pc pd oe pe pf pg oh nm ph pi pj nq pk pl pm nu pn po pp pq bk">Data Preparation</h2><p id="3c3e" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">To prepare the data and generate the reference time distribution database, we must iterate through all the trips in the source data. Fortunately, the source database makes this easy by readily identifying all the trips (see the article above).</p><p id="55c5" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Let us look at the <a class="af nc" href="https://github.com/joaofig/eved-explore/blob/main/compute-seg-speed.py" rel="noopener ugc nofollow" target="_blank">code</a> that prepares the edge traversal times.</p><figure class="mm mn mo mp mq mr"><div class="qu io l ed"><div class="qv qw l"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="al">Figure 5</strong>— The code above shows the main loop for the data preparation script. (Image source: Author)</figcaption></figure><p id="4aea" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The code in <strong class="nf fr">Figure 5</strong> above shows the main loop of the data preparation code. We use the previously created EVED database and save the output data to a new speed database. Each record is a time traversal sample for a single road network edge. For the same edge, a set of these samples makes up for a statistical time distribution, for which we calculate the average, median, and other statistics.</p><p id="77ac" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The call on line 5 retrieves a list of all the known trips in the source database as triplets containing the trajectory identifier (the table sequential identifier), the vehicle identifier, and the trip identifier. We need these last two items to retrieve the trip’s signals, as shown in line 10.</p><p id="59f6" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Lines 10 to 16 contain the code that retrieves the trip’s trajectory as a sequence of latitude, longitude, and timestamps. These locations do not necessarily correspond to road network nodes; they will mostly be projections into the edges (the orange diamonds in <strong class="nf fr">Figure 2</strong>).</p><p id="f8f1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Now, we can ask the Valhalla map-matching engine to take these points and return a poly-line with the corresponding road network node sequence, as shown in lines 18 to 25. These are the nodes that we store in the database, along with the projected traversal times, which we derive in the final lines of the code.</p><p id="b63b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The traversal time projection from the map-matched locations to the node locations occurs in two steps. First, line 27 creates a “compound trajectory” object that merges the map-matched locations and the corresponding nodes in the trip sequence. The object stores each map-matched segment separately for later joining. <strong class="nf fr">Figure 6</strong> below shows the object constructor (<a class="af nc" href="https://github.com/joaofig/eved-explore/blob/main/common/models.py" rel="noopener ugc nofollow" target="_blank">source file</a>).</p><figure class="mm mn mo mp mq mr"><div class="qu io l ed"><div class="qv qw l"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="al">Figure 6 </strong>— The compound trajectory constructor receives the map-matched trajectory and the map nodes as separate arrays of latitudes and longitudes. The code merges both trajectories into a list of segments and later converts these to a trajectory list. (Image source: Author)</figcaption></figure><p id="7f01" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The compound trajectory constructor starts by merging the sequence of map-matched points to the corresponding road network nodes. Referring to the symbols in <strong class="nf fr">Figure 2</strong> above, the code combines the orange diamond sequence with the red dot sequence so they keep the trip order. In the first step, listed in <strong class="nf fr">Figure 7</strong> below, we create a list of sequences of orange diamond pairs with any red dots in between.</p><figure class="mm mn mo mp mq mr"><div class="qu io l ed"><div class="qv qw l"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="al">Figure 7</strong> — The above function merges the map-matched trajectory points with the corresponding road network node sequence. The function tries to assign sequential nodes, if any, between each pair of trajectory points. A list collects all merged sequences for a final consolidation step. (Image source: Author)</figcaption></figure><p id="4fc3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Once merged, we convert the trajectory segments to node-based trajectories, removing the map-matched endpoints and recomputing the traversal times. <strong class="nf fr">Figure 8</strong> below shows the function that computes the equivalent between-node traversal times.</p><figure class="mm mn mo mp mq mr"><div class="qu io l ed"><div class="qv qw l"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="al">Figure 8</strong> — The conversion from a segment to a trajectory requires calculating the equivalent times between road network nodes. (Image source: Author)</figcaption></figure><p id="d750" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Using the symbology of <strong class="nf fr">Figure 2</strong>, the code above uses the traversal times between two orange diamonds and calculates the times for all sub-segment traversals, namely between node-delimited ones. This way, we can later reconstruct all between-node traversal times through simple addition.</p><p id="6d42" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The final conversion step occurs on line 28 of <strong class="nf fr">Figure 5</strong> when we convert the compound trajectory to a simple trajectory using the functions listed in <strong class="nf fr">Figure 9</strong> below.</p><figure class="mm mn mo mp mq mr"><div class="qu io l ed"><div class="qv qw l"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="al">Figure 9</strong> — The final reconstruction step concatenates the projected trajectory segments. Note how arrays with more than two elements are clipped. The clipped elements correspond to the map-matched positions and are thus removed. Arrays with only two components have map-matched positions that coincide with road network nodes. (Image source: Author)</figcaption></figure><p id="f7b2" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The final step of the code in <strong class="nf fr">Figure 5</strong> (lines 30–32) is to save the computed edge traversal times to the database for posterior use.</p><h2 id="dfc2" class="pa oa fq bf ob pb pc pd oe pe pf pg oh nm ph pi pj nq pk pl pm nu pn po pp pq bk">Data Quality</h2><p id="91f4" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">How good is the data that we just prepared? Does the EVED allow for good speed predictions? Unfortunately, this database was not designed for this purpose so that we will see some issues.</p><p id="1a6a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The first issue is the number of single-edge records in the final database, in this case, a little over two million. The total number of rows is over 5.6 million, so the unusable single-edge records represent a sizable proportion of the database. Almost half the rows are from edges with ten or fewer records.</p><p id="be19" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The second issue is trips with very low frequencies. When querying an ad-hoc trip, we may fall into areas of very low density, where edge time records are scarce or nonexistent. In such conditions, the prediction code tries to compensate for the data loss using a simple heuristic: assume the same average speed as in the last edge. For larger road sections, and as we see below, we may even copy the data from the Valhalla route predictor.</p><p id="cb36" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The bottom line is that some of these predictions will be bad. A better use case for this algorithm would be to use a telematics database from fleets that frequently travel through the same routes. It would be even better to get more data for the same routes.</p><h2 id="1762" class="pa oa fq bf ob pb pc pd oe pe pf pg oh nm ph pi pj nq pk pl pm nu pn po pp pq bk">Prediction</h2><p id="5096" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">To explore this time-prediction enhancement algorithm, we will use two different scripts: one interactive <a class="af nc" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">Streamlit</a> application that allows you to freely use the map and an analytics script that tries to assess the quality of the predicted times by comparing them to known trip times in a <a class="af nc" rel="noopener" target="_blank" href="/what-is-cross-validation-622d5a962231">LOOCV</a> type of approach.</p><p id="031c" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Interactive Map</strong></p><p id="3905" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">You run the interactive application by executing the following command line at the project root:</p><pre class="mm mn mo mp mq qx qy qz bp ra bb bk"><span id="c17a" class="rb oa fq qy b bg rc rd l re rf">streamlit run speed-predict.py</span></pre><p id="a49f" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The <a class="af nc" href="https://github.com/joaofig/eved-explore/blob/main/speed-predict.py" rel="noopener ugc nofollow" target="_blank">interactive application</a> allows you to specify endpoints of a route for Valhalla to predict. <strong class="nf fr">Figure 10</strong> below shows what the user interface looks like.</p></div></div><div class="mr"><div class="ab cb"><div class="lm rg ln rh lo ri cf rj cg rk ci bh"><figure class="mm mn mo mp mq mr rm rn paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rl"><img src="../Images/151e29d40c95efecadca610c445af475.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*9WfGSb5EnpaI0dnEDFW0SQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf ob">Figure 10 </strong>— The picture above displays a screenshot of the interactive application. See the text below for instructions on how to use it. (Image source: Author using Folium and OpenStreetMap imagery)</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="e4a7" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To operate the application, use the drawing button below the zoom control to select the source, destination, and optional waypoints. The application draws the sequence as a blue line, as depicted. Next, press the “Predict” button on the top left, under the title. The application calls the Valhalla route predictor and draws its result as a red line. To the left, you see some of the output, namely the time estimates of the map provider and the two below from the algorithm described here. The first estimate uses the average of the matching edge time distributions, and the second uses the median. For missing data, the algorithm uses the map estimate.</p><p id="01be" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Note that the application draws a black rectangle around the area where data is available. Outside of that area, all predictions will be the same as the map’s.</p><p id="06e8" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Accuracy Estimator</strong></p><p id="9684" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To estimate the accuracy of this time predictor, we will test it against known trips taken from the database. We will match the edge projections to the corresponding map nodes for each sampled trip and then query their duration distributions, excluding the data from the trip we want to estimate. This is a process akin to the known Leave-One-Out Cross Validation process.</p><p id="1b44" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Use the following command line to invoke the accuracy estimator script:</p><pre class="mm mn mo mp mq qx qy qz bp ra bb bk"><span id="5f2b" class="rb oa fq qy b bg rc rd l re rf">python benchmark-trips.py</span></pre><p id="d75d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">When finished, the script outputs the estimates to a CSV file that you can use for accuracy analysis, as illustrated in <strong class="nf fr">Figure 11</strong> below.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ro"><img src="../Images/2cf66f979637bf3f5531fca38a348ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpyhRJ7bk3kMTBVb7tuL8Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx"><strong class="bf ob">Figure 11</strong> — The output CSV file contains four columns with estimates for the total trip time: minimum, average, median, and maximum. The sample shown above displays the validation for the first twenty trajectories. The four rightmost columns were computed directly in the spreadsheet, containing accuracy and data quality measures. (Image source: Author)</figcaption></figure><p id="a22d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The output CSV file contains columns with the computed estimates for the trip time, including the minimum, average, median, and maximum times. These statistics deserve an explanation. The algorithm computes the average time using the average of each edge time distribution. It uses the same process to calculate the median. The minimum and maximum values derive from the limits of a two-sigma range, ensuring that the minimum value never goes below zero. The maximum is 𝜇+2𝜎, and the minimum is 𝜇-2𝜎 provided that this value is positive. When negative, the algorithm replaces it with the minimum value of the time range.</p><p id="2ab7" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In the image above, the column with the prediction calculated using the average is green, while the column with the actual times is blue. To the right of it are three columns that help assess the quality of the underlying data. The first column counts the number of trip edges with no time data. You can compare it to the next column, which contains the number of queried edges for that trip. The ratio is in the "<strong class="nf fr"><em class="qp">quality</em></strong>" computed column to the right. Lower values of this metric, such as in rows 7 and 12, reflect the lack of edge traversal time data. The final column contains the absolute relative error (computed against the average). Values in this column tend to have extreme values that negatively correlate to the data quality values, but this is just a hint.</p><p id="957f" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">By the very nature of this algorithm, the more data, the better it should predict trip times.</p><h1 id="0edd" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Conclusion</h1><p id="30fa" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">In this article, I presented a data-based alternative to improve the trip duration predictions of digital map service providers using a telematics database and map matching. The principle behind this solution is using a telematics database with data from the vehicles we want to model and their existing time distributions to project a planned trip.</p><p id="e720" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">This data-intensive process requires the collection of several samples of travel times between the most essential elements of a digital map: the edges between each node. We alleviate the search process using H3 indices, enabling simple indexation techniques.</p><p id="4bb6" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The quality of the prediction will depend a lot on how adequate the data is for this process. We expect the best results with telematics databases from fleets with repeatable and stable routes.</p><h1 id="03b0" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Future Work</h1><p id="2d93" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">One of the areas for improvement of this prediction method is the data availability from past telematics. If you run a fleet that travels through repeated trajectories, data will be OK, but this might be an issue if your routes are more varied.</p><p id="b289" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">A possible line of research would be to find a way to extrapolate known time distributions to other road network edges with missing or insufficient data. Can we derive similarity measures between edges, or groups of edges, within the same road network? If so, and in case of missing data, we could use time distributions from other similar edges in the network to calculate the time prediction.</p><p id="2c61" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Another area that deserves some attention is the nature of the time distributions. This article assumes that no other factors impact the time distributions, which is likely untrue. We all know that traffic times vary throughout the day and week (to mention just two cycles). We should expect better results by studying and incorporating these behaviors into the predictions.</p><p id="416d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Finally, it would be very valuable for future development to include a provision for conditioning the edge time distributions along parameters such as the vehicle type, driver profile, or other relevant parameters. The algorithm would better predict trip times for the relevant conditions through conditioning and abundant data.</p><h1 id="69fb" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Licensing Information</h1><p id="d861" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">The Extended Vehicle Energy Dataset is licensed under Apache 2.0, like its originator, the <a class="af nc" href="https://github.com/gsoh/VED" rel="noopener ugc nofollow" target="_blank">Vehicle Energy Dataset</a>.</p><h1 id="544f" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Reference Material</h1><p id="1818" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk"><a class="af nc" href="https://github.com/joaofig/eved-explore" rel="noopener ugc nofollow" target="_blank">joaofig/eved-explore: An exploration of the Extended Vehicle Energy Dataset (github.com)</a></p><p id="9e91" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><a class="af nc" href="https://ieeexplore.ieee.org/document/9262035" rel="noopener ugc nofollow" target="_blank">Vehicle Energy Dataset</a></p><p id="4ba1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><a class="af nc" href="https://github.com/zhangsl2013/eVED" rel="noopener ugc nofollow" target="_blank">Extended vehicle energy dataset (eVED): an enhanced large-scale dataset for deep learning on vehicle trip energy consumption</a></p><p id="2aa1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><a class="af nc" href="https://h3geo.org/" rel="noopener ugc nofollow" target="_blank">H3 | H3 (h3geo.org)</a></p></div></div></div><div class="ab cb rp rq rr rs" role="separator"><span class="rt by bm ru rv rw"/><span class="rt by bm ru rv rw"/><span class="rt by bm ru rv"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="b38e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">João Paulo Figueira is a Data Scientist at <a class="af nc" href="https://tblx.io/" rel="noopener ugc nofollow" target="_blank">tb.lx by Daimler Truck</a> in Lisbon, Portugal.</p></div></div></div></div>    
</body>
</html>