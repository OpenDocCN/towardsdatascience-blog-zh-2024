<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Core AI For Any Rummy Variant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Core AI For Any Rummy Variant</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/core-ai-for-any-rummy-variant-4ff414da1703?source=collection_archive---------2-----------------------#2024-11-09">https://towardsdatascience.com/core-ai-for-any-rummy-variant-4ff414da1703?source=collection_archive---------2-----------------------#2024-11-09</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="d545" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Step by Step guide to a Rummy AI</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@iheb.rachdi?source=post_page---byline--4ff414da1703--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Iheb Rachdi" class="l ep by dd de cx" src="../Images/39cf41b34ea79226efa58484da1f90bb.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*_Yl3wgqE2a5As_ZXlI2OxQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--4ff414da1703--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@iheb.rachdi?source=post_page---byline--4ff414da1703--------------------------------" rel="noopener follow">Iheb Rachdi</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--4ff414da1703--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">10 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Nov 9, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/2122bd1ef90e34703cbb260791d126c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JY0f9HejnksGWnjhUvuZWw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image generated by the author using DALL-E</figcaption></figure><h1 id="819f" class="nb nc fq bf nd ne nf gq ng nh ni gt nj nk nl nm nn no np nq nr ns nt nu nv nw bk"><strong class="al">Motivation</strong></h1><p id="ddc8" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of og oh oi oj ok ol om on oo op oq or os fj bk">As I was in the process of developing a reinforcement learning (RL) model for a Rummy game, I reached the stage where I needed an AI opponent to carry out the environment setup and contribute to the model training. However, after searching online, I found that resources for creating an AI for Rummy game were limited, and the few solutions available were too slow for my needs. Since the AI would be used in training, (training time was already high without it) therefore, the AI needed to operate quickly and efficiently in both processing speed and memory use. Needless to say Brute-force solution simply wouldn’t cut it, so I had to experiment with various algorithms and optimization techniques to achieve the complexity and speed appropriate for training.</p><h1 id="49a7" class="nb nc fq bf nd ne nf gq ng nh ni gt nj nk nl nm nn no np nq nr ns nt nu nv nw bk"><strong class="al">So Why Read These Article ?</strong></h1><p id="9fa6" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of og oh oi oj ok ol om on oo op oq or os fj bk">What we’re going to build here is general, adaptable and suitable for almost any type of Rummy game you may be developing. You’ll only need to add your own strategy layer on top of it, then allow the AI to make decisions based on the output of this system. Additionally, you can directly integrate it into your Rummy game to be a tool to help players organize their cards by automatically Dividing them into possible meld combinations. Furthermore, the techniques we’ll implement here can be applied to other areas, so no matter what, I guarantee it will benefit you in one way or another.</p><h1 id="fed9" class="nb nc fq bf nd ne nf gq ng nh ni gt nj nk nl nm nn no np nq nr ns nt nu nv nw bk"><strong class="al">Putting Things in Perspective,</strong></h1><p id="66bd" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of og oh oi oj ok ol om on oo op oq or os fj bk">This article won’t cover the complete AI; rather, it presents the essential building blocks and core component of the AI, which we’ll refer to as “hand evaluator” system. This hand evaluator analyzes a given Rummy hand and extracts all possible “Combos” that can be formed. It serves as the initial step and forms the groundwork for the AI’s decision-making process, that will be explored in a separate Medium article in the future.</p><h1 id="3c61" class="nb nc fq bf nd ne nf gq ng nh ni gt nj nk nl nm nn no np nq nr ns nt nu nv nw bk"><strong class="al">Project Scope and Expectation</strong></h1><p id="4d4f" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of og oh oi oj ok ol om on oo op oq or os fj bk">Before starting, it’s essential to define the scope of the hand evaluator system we aim to develop. In short, what we are gone build will take a set of <em class="ot">n</em> Rummy cards (15 in our case) and output a list of valid combinations, or “combo” that can be extracted from the hand. To keep the system widely adaptable for Rummy variants, we’ll exclude two specific options: first, the use of Joker cards, and second, the option to place the Ace card after the King in a run meld. By setting these rules, the system becomes easier to understand. However, these design choices don’t restrict the system’s adaptability, as it can easily be expanded to include those rules if needed.</p><p id="eac8" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Since this hand evaluator will be called repeatedly throughout the gameplay, it must remain optimized and memory efficient.</p><p id="31ae" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Moreover, given the nature of Rummy, for the AI to process all potential actions, it needs to evaluate different scenarios by adding or removing cards. To address this, the hand evaluator system must support dynamic hand modifications. Ideally, we want to avoid reprocessing the hand from scratch; instead, we need to use the already processed hand from previous runs of the system to minimize the work required to re-extract combos whenever the hand is modified.</p><h1 id="4050" class="nb nc fq bf nd ne nf gq ng nh ni gt nj nk nl nm nn no np nq nr ns nt nu nv nw bk"><strong class="al">Key Terminology and Setup</strong></h1><p id="88bc" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of og oh oi oj ok ol om on oo op oq or os fj bk"><strong class="nz fr">Deck:</strong> the deck will contain 104 card with 52 Unique card and each card is duplicated once with a total of 13 * 4 * 2 = 104.</p><p id="b981" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Card Ranks:</strong> from 1 to 13  with ranks 11, 12, and 13 representing the Jack, Queen, and King, respectively.</p><p id="b1cc" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Card Suits:</strong> The four suits are Hearts, Spades, Clubs, and Diamonds, which can also be indicated by <strong class="nz fr">H</strong>, <strong class="nz fr">S</strong>, <strong class="nz fr">C</strong>, and <strong class="nz fr">D, or with icon </strong>respectively.</p><p id="ad65" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Run</strong>: A sequence of three or more consecutive cards of the same suit.<br/> <em class="ot">Example</em>: 3H | 4H | 5H</p><p id="09a4" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Set</strong>: A group of three or four cards with the same rank but different suits.<br/> <em class="ot">Example</em>: 6H | 6S | 6D</p><p id="3bc2" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Dump</strong>: A group of cards that couldn’t be used to create or be added to valid melds.</p><p id="3038" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Combo</strong>: One possible division of a hand into runs, sets, and dump.</p><p id="8c68" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Example:</p><p id="a46b" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Hand:</strong><br/> 3H | 4H | 5H | 6H | 7H | 7C | 7S | 6S | 10S | JD | 6D | KH | 2C | 3D | 4S</p><p id="7965" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">One Possible Combo:</strong></p><p id="3760" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">· <strong class="nz fr">Run:</strong> 3H | 4H | 5H | 6H</p><p id="739c" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">· <strong class="nz fr">Set:</strong> 7H | 7C | 7S</p><p id="07c6" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">· <strong class="nz fr">Dump:</strong> 6S | 10S | JD | 6D | KH | 2C | 3D | 4S</p></div></div></div><div class="ab cb oz pa pb pc" role="separator"><span class="pd by bm pe pf pg"/><span class="pd by bm pe pf pg"/><span class="pd by bm pe pf"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="5f19" class="nb nc fq bf nd ne ph gq ng nh pi gt nj nk pj nm nn no pk nq nr ns pl nu nv nw bk">System Breakdown</h1><blockquote class="pm pn po"><p id="9150" class="nx ny ot nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Identifying and Collecting key Data</strong></p></blockquote><p id="018f" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">I explored several algorithms to optimize and reduce the search space for all possible combos. However, the fact that each card can appear twice increased the number of potential combos, making it challenging to track and validate each one. While competing on Codeforces, I encountered a problem that reminded me of the ‘<a class="af pp" href="https://codeforces.com/problemset/problem/627/F" rel="noopener ugc nofollow" target="_blank">island problem</a>,’ which gave me new insight into approaching the hand evaluator system.</p><p id="068d" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">We can represent the hand as a 2D grid of size 4x13, where each column represents ranks from 1 to 13 and each row corresponds to the 4 suits. Each cell in this grid contains the count of cards in the hand in our case either 1, 2, or 0 . This allows us to divide the hand into ‘islands,’ which are defined as groups of connected land cells with counts of 1 or 2 based on the following connectivity rules:</p><p id="52b6" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">1.</strong> Two cells are considered connected if they share a side (left, right, above, or below) in the grid.</p><p id="fe86" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">2.</strong> All cells within the same column are also connected if they both contain at least 1s, even if they are not adjacent (above or below).</p><p id="4178" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">EXP of ‘ hand A’ : 11C 3H 4H 11D 3D 5H 9D 2H 6H 3C 4H 3D 4D 5H 12D 3C</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pq"><img src="../Images/9e30a157f6d14454f9560390869bf1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eKCftuAFxfiN4e3V4TtN9A.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Table representation of ‘hand A’</figcaption></figure><p id="a4d2" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Our first task is to identify and label all distinct islands. Since each island is independent of the others, we can make our life easier by mapping each island to a class type let’s name it _cardGraph. This class will be responsible for that island in terms of extracting, modifying, or deleting operations.</p><p id="91ba" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">For clarity, let’s isolate one island and work on it in the upcoming sections, so it’s easier for you to follow. If it helps, you can think of each island as a connected graph, as Shown in the figure below:</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pr"><img src="../Images/c040a20f4eccfb4b632fb89cc55efcf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nkg-dYRF_TJG6B98_moKQA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">in Left: Island Represented in the Table; in Right: Same Island in a Connected Graph Perspective</figcaption></figure><p id="d064" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Now If you take multiple island examples and try to extract the possible combos, you’ll notice that some cards have unique roles in branching out to a potential combinations. We’ll call these type of cards a <strong class="nz fr">control points</strong> or <strong class="nz fr">Cpts</strong> for short, as they play an essential role by reducing the search space significantly as you will see in the following steps.</p><p id="8298" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Cpts</strong>: For a card to be considered a Cpts, it must be in a position where we have to make a choice on which meld (run or set) to append it to. If a card can naturally fit into multiple melds without forcing a choice (for example, a duplicate card with two options for melds each card will append to a meld), it won’t be considered a Cpts.</p><p id="5e40" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">In the case of our island example the 3 of heart is identified as a cpts. Below are all the melds that the 3 of Hearts could attach to, one at a time.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj ps"><img src="../Images/990eb878a0ce456bec40091f08414ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySJZ7EcfRlBM5BPE2kXBkw.png"/></div></div></figure><p id="db4e" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Our next step is to mark each card that qualifies as a Cpts. To do this, we’ll create a 4x13 (in byte type) table lets call it _flagMap . Now for memory efficiency, you can make this a shared table each _cardGraph instance created from the hand can reference it and use it . In this table, each card in an island will be assigned a bitstream at the corresponding index in _flagMap, this byte will represents its potential placements in different runs or sets. If a card qualifies as a Cpts, it will be stored in a stack (we will need later), which we’ll call _cptsStack. Here’s a breakdown of the byte structure: the first bit indicates whether the card belongs to a run, the second bit indicates its placement in an additional run, the third bit represents whether it belongs to a set, and the fourth bit specifies if it belongs to multiple sets.</p><p id="633d" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Here’s an example of a bitstream: 00000111 In here we have:</p><p id="1dd2" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">•</strong> The first bit (1) means the card can belong to a run.</p><p id="8eb9" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">•</strong> The second bit (1) means the card can belong to a second run.</p><p id="d904" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">•</strong> The third bit (1) means the card belongs to a set.</p><p id="0775" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">•</strong> The fourth bit (0) means the card doesn’t belong to a second set.</p><p id="60a2" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">We might be in case where the configuration is 00000101 for one card (no copy), meaning the card belongs to a run or a set. Or another configuration could be 00000011, meaning the card belongs to two different runs.</p><p id="d646" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">To identify a cpts, simply count the ‘1’s in its bit representation. If this count exceeds the total number of that card in the hand, it’s considered a cpts. For instance, if a card appears twice (i.e., has two copies) and its bit representation is 00000101, it’s not a cpts. However, if the bit representation is 00000111 like the example , then it qualifies as a cpts.</p><p id="e4fc" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">In our island example, here’s how the _flagMap table would look :</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pt"><img src="../Images/42daff5e8143ad8ac312da7980769396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJcQNImGn1ix-o54mST29Q.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">_FlagMap Representation of the ‘hand A’ Example</figcaption></figure><p id="0f4a" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Once we’ve populated the _flagMap and identified the cpts, the next task is to decompose the island into horizontal and vertical lines. <strong class="nz fr">But why?</strong> Breaking down the card graph into these lines simplifies the process of identifying runs and sets, as it allows us to focus on contiguous sequences of cards that can be processed more efficiently. As you might guess, the vertical lines will represent the sets, while the horizontal lines will represent the runs.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pu"><img src="../Images/49485838531386555e5afa96ec5e4f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1bHLHiUSf5QnXIQsC1bmEg.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Island decomposed into Horizontal and Vertical Lines</figcaption></figure><p id="5f2b" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">We’ll store each horizontal line in a list of a tuple type, where the first item represents the starting index of the line and the last item represents the end index (inclusive). For the vertical lines, it’s sufficient to simply store the column index in a list.</p><p id="90e1" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr"><em class="ot">Tip:</em></strong> We can accomplish this task along with the bit representation step in a single loop, achieving O(n) complexity.</p><blockquote class="pm pn po"><p id="b90e" class="nx ny ot nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">Generate Combos</strong></p></blockquote><p id="6e2f" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Now, let’s take a break and recap: we have identified the control points (CPTs) and stored them in the _cptsStack. We also decomposed the island into vertical and horizontal lines, and populated the _flagMap with card bit representation.</p><p id="0f80" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">With our data in place, what remains is to use it to generate all possible valid combos of the island. But how do we do that? Here’s a simplified approach:</p><p id="d489" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">1. Assign Valid Placements for the Control Points (Cpts):</strong><br/> We take the bit representation of a cpts from _flagMap, which indicates all possible placements for that cpts. Then, we look at the number of copies of the cpts in the _cardGraph and adjust its bit representation to a current valid configuration. For example, if the cpts has a bit representation of 00001111 and 2 copies, we can generate all valid placements for it, which is C(4,2)=6C(4,2) = 6C(4,2)=6. Possible combinations would be 0011, 0101, 1100, 1010, 1001, and 0110.</p><p id="5523" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">2. Using DFS to Configure All Possible Combinations for Each Cpts:</strong><br/> We’ll use a depth-first search (DFS) to iterate over the valid placements for each cpts as shown in step 1. Each node in the DFS tree represents a possible placement for a given cpts, so each unique DFS path represents a valid combo configuration. For each “leaf” node (end of the DFS path), we proceed to the next step.</p><p id="6021" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">3. Generating Combos:</strong><br/> In this step, we iterate over the horizontal and vertical lines in the island to identify runs, sets, and a dump list. This is done in two passes for each line, as follows:</p><ul class=""><li id="86f5" class="nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os pv pw px bk"><strong class="nz fr">Pass 1:</strong> For a horizontal line, for example, we continuously append cards from [line start to line end] into a list to form a run. We stop adding if ( card_bit_representation | 00000001 == 0 ). If the length of the run is greater than or equal to 3, we add it to the run combo; otherwise, each card goes into the dump list, and we continue trying to form another run until we reach the line end.</li><li id="1ceb" class="nx ny fq nz b go py ob oc gr pz oe of og qa oi oj ok qb om on oo qc oq or os pv pw px bk"><strong class="nz fr">Pass 2:</strong> Repeat the process, this time looking for cards that match a different bit pattern with or operation ( 00000010). This allows us to identify possible second runs.</li></ul><p id="8953" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">The same approach applies to extracting sets, but we use bit operations with 00000100 and 00001000.</p><p id="c20f" class="pw-post-body-paragraph nx ny fq nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk"><strong class="nz fr">4. Register the Valid Combo and Move to the Next DFS Configuration:</strong><br/> After completing all runs, sets, and dumps for the current combo, we save the combo and then move on to the next DFS configuration to repeat the process. This way, we systematically explore all potential configurations for valid combos.</p><h1 id="435e" class="nb nc fq bf nd ne nf gq ng nh ni gt nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Demo Output</h1><p id="b3cd" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of og oh oi oj ok ol om on oo op oq or os fj bk">if you coded everything correctly and feed it our island example : ”2H3H4H5H4H5H6H3C3C3D3D4D”, it should be decomposed as shown bellow. Notice that I’ve added some calculation to each generated combo so that we can get a sense of how the AI will act.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qd"><img src="../Images/8c6c58c19398b8dc2b701a8d17d81fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*z8SDlmlGwRvH9Vd79MM6kQ.png"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Console Output Showing the Generated Combo For the Island Example</figcaption></figure><h1 id="8cad" class="nb nc fq bf nd ne nf gq ng nh ni gt nj nk nl nm nn no np nq nr ns nt nu nv nw bk">What’s Next?</h1><p id="7759" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of og oh oi oj ok ol om on oo op oq or os fj bk">In the next article, I’ll dive into the rest of the system, focusing on the dynamic modification of the hand and the AI strategy. If you’ve followed along so far, it won’t be hard to see how we can optimize adding and removing cards, as well as incorporate the two rules we set aside at the beginning. Stay tuned, and see you next time! “hopefully 😉”.</p><blockquote class="pm pn po"><p id="260e" class="nx ny ot nz b go ou ob oc gr ov oe of og ow oi oj ok ox om on oo oy oq or os fj bk">Unless otherwise noted, all images are created by the author using Lucidchart ,Gimp and Python</p></blockquote></div></div></div></div>    
</body>
</html>