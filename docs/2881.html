<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Effortless Data Handling: Find Variables Across Multiple Data Files with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Effortless Data Handling: Find Variables Across Multiple Data Files with R</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/effortless-data-handling-find-variables-across-multiple-data-files-with-r-e01c9715b4c7?source=collection_archive---------12-----------------------#2024-11-27">https://towardsdatascience.com/effortless-data-handling-find-variables-across-multiple-data-files-with-r-e01c9715b4c7?source=collection_archive---------12-----------------------#2024-11-27</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="eee8" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">A practical solution with code and workflow</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@rcarrillo90?source=post_page---byline--e01c9715b4c7--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Rodrigo M Carrillo Larco, MD, PhD" class="l ep by dd de cx" src="../Images/458ed24625ded66ef47c5af718db3659.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*l58jvPIgPVMnl21Eh5cT0Q.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--e01c9715b4c7--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@rcarrillo90?source=post_page---byline--e01c9715b4c7--------------------------------" rel="noopener follow">Rodrigo M Carrillo Larco, MD, PhD</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--e01c9715b4c7--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Nov 27, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="db1c" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Lost in a maze of datasets and endless data dictionaries? Say goodbye to tedious variable hunting! Discover how to quickly identify and extract the variables you need from multiple SAS files using two simple R functions. Streamline your workflow, save time, and make data preparation a breeze!</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf ng"><img src="../Images/dcdeb2464302a41b9c62b63c27bce77f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kKw8z8PrtNZT_q-M"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Photo by <a class="af nx" href="https://unsplash.com/@imgix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">imgix</a> on <a class="af nx" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="970a" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">As a researcher with over seven years of experience working with health data, I’ve often been handed folders full of datasets. For example, imagine opening a folder containing 56 SAS files, each with unique data (example below). If you’ve been in this situation, you know the frustration: trying to locate a specific variable in a sea of files feels like looking for a needle in a haystack.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div class="ne nf ny"><img src="../Images/0692103e729e960899984aad98fa2ab6.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*kSejreAKQPAmzoNnz8potQ.png"/></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Screenshot taken by the author of a local folder. File names have been blurred to maintain the confidentiality of the datasets.</figcaption></figure><p id="fd9e" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">At first glance, this may not seem like an issue if you already know where your variables of interest are. But often, you don’t. While a data dictionary is usually provided, it’s frequently a PDF document that lists variables across multiple pages. Finding what you need might involve searching (Ctrl+F) for a variable on page 100, only to realize the dataset’s name is listed on page 10. Scrolling back and forth wastes time.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf nz"><img src="../Images/45d4e29bf9abe6d1dcc69d3b93f706bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vr2E4_lEVGPQbVkWr1dtGg.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Screenshot taken by the author of a data dictionary. Variable names and labels have been blurred to maintain the confidentiality of the datasets.</figcaption></figure><p id="6952" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">To save myself from this tedious process, I created a reproducible R workflow to read all datasets in a folder, generate a consolidated dataframe of variable names and their labels (example below), and identify where each variable is located. This approach has made my work faster and more efficient. Here’s how you can do it, step by step.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf oa"><img src="../Images/4a5d8deb1d639e8e14b1b4f8b920bb56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XlD9m54zhFEr2XqeDNyXrg.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Screenshot taken by the author of of how the <code class="cx ob oc od oe b">names_labels</code> dataset looks like (see step 2). Variable names and labels have been blurred to maintain the confidentiality of the datasets.</figcaption></figure></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="27cf" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step-by-Step Guide</strong></p></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="3961" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step 1: Use the get_names_labels Function</strong></p><p id="cde1" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">First, use the custom function <code class="cx ob oc od oe b">get_names_labels</code> (code provided at the end of this post). This function requires the folder path where all your datasets are stored.</p><pre class="nh ni nj nk nl on oe oo bp op bb bk"><span id="8cd8" class="oq or fq oe b bg os ot l ou ov">path_file &lt;- "D:/folder1/folder2/folder3/folder_with_datasets/"<br/>get_names_labels(path_file)</span></pre></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="eb16" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step 2: Generate a Variable Dictionary</strong></p><p id="b737" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The <code class="cx ob oc od oe b">get_names_labels</code> function will create a dataframe named <code class="cx ob oc od oe b">names_labels</code> (like the example above), which includes:</p><p id="b7de" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">· Variable name (variable_name)</p><p id="8d35" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">· Variable label (variable_label)</p><p id="d409" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">· The name of the dataset(s) where the variable was found (file_name)</p><p id="df44" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Depending on the number and size of the datasets, this process may take a minute or two.</p></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="8817" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step 3: Search for Variables</strong></p><p id="5c5d" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Once the <code class="cx ob oc od oe b">names_labels</code> dataframe is generated, you can search for the variables you need. Filter the <code class="cx ob oc od oe b">variable_name</code> or <code class="cx ob oc od oe b">variable_label</code> columns to locate relevant terms. For example, if you’re looking for gender-related variables, they might be labeled as sex, gender, is_male, or is_female.</p><p id="1fa7" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Be mindful that similar variables might exist in multiple datasets. For instance, age could appear in the main questionnaire, a clinical dataset, and a laboratory dataset. These variables might look identical but differ based on how and where the data was collected. For example:</p><p id="cb68" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">· Age in the main questionnaire: Collected from all survey participants.</p><p id="b04d" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">· Age in clinical/lab datasets: Limited to a subset invited for further assessments or those who agreed to participate.</p><p id="a72e" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In such cases, the variable from the main questionnaire might be more representative of the full population.</p></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="a009" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step 4: Identify Relevant Datasets</strong></p><p id="e1dd" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Once you’ve determined which variables you need, filter the <code class="cx ob oc od oe b">names_labels</code> dataframe to identify the original datasets (<code class="cx ob oc od oe b">file_name</code>) containing them. If a variable appears in multiple datasets (e.g., <code class="cx ob oc od oe b">ID</code>), you’ll need to identify which dataset includes all the variables you’re interested in.</p><pre class="nh ni nj nk nl on oe oo bp op bb bk"><span id="f40f" class="oq or fq oe b bg os ot l ou ov"># Say you want these two variables<br/>variables_needed &lt;- c('ID', 'VAR1_A')<br/>names_labels &lt;- names_labels[which(names_labels$variable_name %in% variables_needed), ]</span></pre><p id="ff6e" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">If one of the variables can be found in multiple original datasets (e.g., <code class="cx ob oc od oe b">ID</code>), you will filter <code class="cx ob oc od oe b">names_labels</code> to keep only the original dataset with both variables (e.g., <code class="cx ob oc od oe b">ID</code> and <code class="cx ob oc od oe b">VAR1_A</code>). In our case, the <code class="cx ob oc od oe b">names_labels</code> dataframe will be reduced to only two rows, one for each of the two variables we were looking for, both of which will be found in the same original dataset.</p><pre class="nh ni nj nk nl on oe oo bp op bb bk"><span id="94b5" class="oq or fq oe b bg os ot l ou ov">names_labels &lt;- names_labels %&gt;%<br/>  group_by(file_name) %&gt;%<br/>  mutate(count = n()) %&gt;%<br/>  filter(count &gt;= 2)</span></pre></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="cbab" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step 5: Extract the Data</strong></p><p id="84d0" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Now, use the <code class="cx ob oc od oe b">read_and_select</code> function (provided at the end). Pass the name of the original dataset containing the variables of interest. This function creates a new dataframe in your R environment with only the selected variables. For example, if your variables are in <code class="cx ob oc od oe b">ABC.sas7bdat</code>, the function will create a new dataframe called <code class="cx ob oc od oe b">ABC</code> with just those variables.</p><pre class="nh ni nj nk nl on oe oo bp op bb bk"><span id="2dd6" class="oq or fq oe b bg os ot l ou ov">unique(names_labels$file_name) # Sanity check, that there is only one dataframe<br/>read_and_select(unique(names_labels$file_name)[1])</span></pre></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="e726" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step 6: Clean Your Environment</strong></p><p id="ecce" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">To keep your workspace tidy, remove unnecessary elements and retain only the new dataframe(s) you need. For example, if your variables of interest came from <code class="cx ob oc od oe b">ABC.sas7bdat</code>, you’ll keep the filtered dataframe <code class="cx ob oc od oe b">ABC</code> which was the output of the <code class="cx ob oc od oe b">read_and_select</code> function.</p><pre class="nh ni nj nk nl on oe oo bp op bb bk"><span id="6c41" class="oq or fq oe b bg os ot l ou ov">length(unique(names_labels$file_name))<br/>names_labels$file_name &lt;- str_extract(names_labels$file_name, "[^.]+")<br/>rm(list = setdiff(ls(), c(unique(names_labels$file_name))))</span></pre></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="965a" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Step 7: Merge Multiple Datasets (Optional)</strong></p><p id="0d8e" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">If your variables of interest are in more than one dataset (e.g., <code class="cx ob oc od oe b">ABC</code> and <code class="cx ob oc od oe b">DEF</code>), you can merge them. Use a unique identifier, such as <code class="cx ob oc od oe b">ID</code>, to combine the datasets into a single dataframe. The result will be a unified dataframe with all the variables you need. You will get a <code class="cx ob oc od oe b">df</code> dataframe with all the observations and only the variables you needed.</p><pre class="nh ni nj nk nl on oe oo bp op bb bk"><span id="659b" class="oq or fq oe b bg os ot l ou ov"># Get a list with the names of the dataframes in the environment (“ABC” and “DEF”)<br/>object_names &lt;- ls() <br/><br/><br/># Get a list with the actual dataframe<br/>object_list &lt;- mget(object_names)<br/><br/><br/># Reduce the dataframes in the list (“ABC” and “DEF”) by merging conditional on the unique identifier (“ID”)<br/>df &lt;- Reduce(function(x, y) merge(x, y, by = "ID", all = TRUE), object_list)<br/><br/># Clean your environment to keep only the dataframes (“ABC” and “DEF”) and a new dataframe “df” which will contain all the variables you needed.<br/>rm(object_list, object_names)</span></pre></div></div></div><div class="ab cb of og oh oi" role="separator"><span class="oj by bm ok ol om"/><span class="oj by bm ok ol om"/><span class="oj by bm ok ol"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="db43" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Why This Workflow Works?</strong></p><p id="392c" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">This approach saves time and organizes your work into a single, reproducible script. If you later decide to add more variables, simply revisit <code class="cx ob oc od oe b">steps 2 and 3</code>, update your list, and rerun the script. This flexibility is invaluable when dealing with large datasets. While you’ll still need to consult documentation to understand variable definitions and data collection methods, this workflow reduces the effort required to locate and prepare your data. Handling multiple datasets doesn’t have to be overwhelming. By leveraging my custom functions like <code class="cx ob oc od oe b">get_names_labels</code> and <code class="cx ob oc od oe b">read_and_select</code>, you can streamline your workflow for data preparation.</p><p id="2998" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr"><em class="ow">Have you faced similar challenges when working with multiple datasets? Share your thoughts or tips in the comments, or give this article a thumbs up if you found it helpful. Let’s keep the conversation going and learn from each other!</em></strong></p><p id="aab0" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">Below are the two custom functions. Save them in an <code class="cx ob oc od oe b">R</code> script file, and load the script into your working environment whenever needed. For example, you could save the file as <code class="cx ob oc od oe b">_Functions.R</code> for easy access.</p><pre class="nh ni nj nk nl on oe oo bp op bb bk"><span id="6a7e" class="oq or fq oe b bg os ot l ou ov"># You can load the functions as<br/>source('D:/Folder1/Folder2/Folder3/_Functions.R')</span></pre><pre class="ox on oe oo bp op bb bk"><span id="4e0a" class="oq or fq oe b bg os ot l ou ov">library(haven)<br/>library(tidyverse)<br/>library(stringr)<br/><br/><br/><br/><br/><br/>## STEPS TO USE THESE FUNCTIONS:<br/>## 1. DEFINE THE OBJECT 'PATH_FILE', WHICH IS A PATH TO THE DIRECTORY WHERE<br/>##    ALL THE DATASETS ARE STORED.<br/>## 2. APPLY THE FUNCTION 'get_names_labels' WITH THE PATH. THE FUNCTION WILL <br/>##    RETURN A DATAFRAME NAMES 'names_labels'. <br/>## 3. THE FUNCTION WILL RETURN A DATASET ('names_labels) SHOWING THE NAMES OF <br/>##    THE VARIABLES, THE LABELS, AND THE DATASET. VISUALLY/MANUALLY EXPLORE THE <br/>##    DATASET TO SELECT THE VARIABLES WE NEED. CREATE A VECTOR WITH THE NAMES <br/>##    OF THE VARIABLES WE NEED, AND NAME THIS VECTOR 'variables_needed'.<br/>## 4. FROM THE DATASET 'names_labels', KEEP ONLY THE ROWS WITH THE VARIABLES WE<br/>##    WILL USE (STORED IN THE VECTOR 'variables_needed').<br/>## 5. APPLY THE FUNCTION 'read_and_select' TO EACH OF THE DATASETS WITH RELEVANT <br/>##    VARIABLES. THIS FUNCTION WILL ONLY NEED THE NAME OF THE DATASET, WHICH IS<br/>##    STORED IN THE LAST COLUMN OF DATASET 'names_labels'.<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>### FUNCTION TO 1) READ ALL DATASETS IN A FOLDER; 2) EXTRACT NAMES AND LABELS;<br/>### 3) PUT NAMES AND LABELS IN A DATASET; AND 4) RETURN THE DATASET. THE ONLY<br/>### INPUT NEEDED IS A PATH TO A DIRECTORY WHERE ALL THE DATASETS ARE STORED.<br/><br/>get_names_labels &lt;- function(path_file){<br/>  results_df &lt;- list()<br/>  <br/>  sas_files &lt;- c(<br/>    list.files(path = path_file, pattern = "\\.sas7bdat$")<br/>  )<br/>  <br/>  for (i in 1:length(sas_files)) {<br/>    print(sas_files[i])<br/>    <br/>    # Read the SAS file<br/>    sas_data &lt;- read_sas(paste0(path_file, sas_files[i]))<br/>    sas_data &lt;- as.data.frame(sas_data)<br/>    <br/>    # Get the variable names and labels<br/>    var_names &lt;- names(sas_data)<br/>    labels &lt;- sas_data %&gt;% <br/>      map(~attributes(.)$label) %&gt;%<br/>      map_chr(~ifelse(is.null(.), NA, .))<br/>    <br/>    # Combine the variable names and labels into a data frame<br/>    var_df &lt;- data.frame(<br/>      variable_name = var_names,<br/>      variable_label = labels,<br/>      file_name = sas_files[i],<br/>      stringsAsFactors = FALSE<br/>    )<br/>    <br/>    # Append the results to the overall data frame<br/>    results_df[[i]] &lt;- var_df<br/>  }<br/>  <br/>  results_df &lt;- do.call(rbind, results_df)<br/>  <br/>  #return(results_df)<br/>  assign('names_labels', results_df, envir = .GlobalEnv)<br/>  <br/>}<br/><br/>################################################################################<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>### FUNCTION TO READ EACH DATASET AND KEEP ONLY THE VARIABLES WE SELECTED; THE<br/>### FUNCTION WILL SAVE EACH DATASET IN THE ENVIRONMENT. THE ONLY INPUNT IS THE<br/>### NAME OF THE DATASET.<br/><br/>read_and_select &lt;- function(df_file){<br/>  <br/>  df_tmp &lt;- read_sas(paste0(path_file, df_file))<br/>  <br/>  df_tmp &lt;- df_tmp %&gt;%<br/>    select(unique(names_labels[which(names_labels$file_name == df_file), ]$variable_name)) %&gt;%<br/>    as.data.frame()<br/>  <br/>  assign(str_extract(df_file, "[^.]+"), df_tmp,envir = .GlobalEnv)<br/>  <br/>}<br/><br/>################################################################################</span></pre><p id="fe25" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><em class="ow">You can find me on </em><a class="af nx" href="https://www.linkedin.com/in/rodrigo-m-carrillo-larco-md-phd-39016a27/" rel="noopener ugc nofollow" target="_blank"><em class="ow">LinkedIn</em></a><em class="ow"> and happy to connect and discuss.</em></p></div></div></div></div>    
</body>
</html>