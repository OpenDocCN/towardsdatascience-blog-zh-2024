<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Explaining Complex Models to Business Stakeholders</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Explaining Complex Models to Business Stakeholders</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/explaining-complex-models-to-business-stakeholders-5af0691bacd4?source=collection_archive---------11-----------------------#2024-04-30">https://towardsdatascience.com/explaining-complex-models-to-business-stakeholders-5af0691bacd4?source=collection_archive---------11-----------------------#2024-04-30</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="fo bh"><figure class="fp fo bh paragraph-image"><img src="../Images/10b1475735b39b40c9cbea27c8cbf262.png" data-original-src="https://miro.medium.com/v2/resize:fit:4800/format:webp/1*N9GPoK09ifFFjuT-1PKIFA.jpeg"/><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">Photo by <a class="af fz" href="https://unsplash.com/@niko_photos?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener ugc nofollow" target="_blank">niko photos</a> on <a class="af fz" href="https://unsplash.com/photos/green-leaf-tree-under-blue-sky-tGTVxeOr_Rs?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="3a38" class="pw-subtitle-paragraph gz gb gc bf b ha hb hc hd he hf hg hh hi hj hk hl hm hn ho cq dx">Explaining a LightGBM model</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hp hq hr hs ht ab"><div><div class="ab hu"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@fkarvoun?source=post_page---byline--5af0691bacd4--------------------------------" rel="noopener follow"><div class="l hv hw by hx hy"><div class="l ed"><img alt="Frida Karvouni" class="l ep by dd de cx" src="../Images/49aad19f6bdd7ffdc68c212722079c6f.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*ziXwt36YQgi3M1bO7pLFzQ.jpeg"/><div class="hz by l dd de em n ia eo"/></div></div></a></div></div><div class="ib ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--5af0691bacd4--------------------------------" rel="noopener follow"><div class="l ic id by hx ie"><div class="l ed"><img alt="Towards Data Science" class="l ep by br if cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hz by l br if em n ia eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="ig ab q"><div class="ab q ih"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ii ij bk"><a class="af ag ah ai aj ak al am an ao ap aq ar ik" data-testid="authorName" href="https://medium.com/@fkarvoun?source=post_page---byline--5af0691bacd4--------------------------------" rel="noopener follow">Frida Karvouni</a></p></div></div></div><span class="il im" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b ii ij dx"><button class="in io ah ai aj ak al am an ao ap aq ar ip iq ir" disabled="">Follow</button></p></div></div></span></div></div><div class="l is"><span class="bf b bg z dx"><div class="ab cn it iu iv"><div class="iw ix ab"><div class="bf b bg z dx ab iy"><span class="iz l is">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar ik ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--5af0691bacd4--------------------------------" rel="noopener follow"><p class="bf b bg z ja jb jc jd je jf jg jh bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="il im" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">5 min read</span><div class="ji jj l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Apr 30, 2024</span></div></span></div></span></div></div></div><div class="ab cp jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz"><div class="h k w ea eb q"><div class="kp l"><div class="ab q kq kr"><div class="pw-multi-vote-icon ed iz ks kt ku"><div class=""><div class="kv kw kx ky kz la lb am lc ld le ku"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l lf lg lh li lj lk ll"><p class="bf b dy z dx"><span class="kw">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kv ln lo ab q ee lp lq" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="fp"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lm fp">1</span></p></button></div></div></div><div class="ab q ka kb kc kd ke kf kg kh ki kj kk kl km kn ko"><div class="lr k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al ls an ao ap ip lt lu lv" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lw cn"><div class="l ae"><div class="ab cb"><div class="lx ly lz ma mb fq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al ls an ao ap ip mc md lq me mf mg mh mi s mj mk ml mm mn mo mp u mq mr ms"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al ls an ao ap ip mc md lq me mf mg mh mi s mj mk ml mm mn mo mp u mq mr ms"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al ls an ao ap ip mc md lq me mf mg mh mi s mj mk ml mm mn mo mp u mq mr ms"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="5e31" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">Business stakeholders are starting to recognise the value machine learning models bring to their operations, gaining a deeper understanding of their benefits and drawbacks. Simultaneously, there’s a rising demand for more accurate and swifter machine learning models.</p><p id="b36e" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">A challenge emerges as these models advance rapidly, attaining greater accuracy but becoming more complex and less explainable (referred to as “black-box” models). Consequently, it becomes increasingly difficult for data scientists to:</p><ul class=""><li id="2356" class="mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr bk">explain the methodologies and outcomes to stakeholders, thereby hindering model adoption rates,</li><li id="9ca1" class="mt mu gc mv b ha ns mx my hd nt na nb nc nu ne nf ng nv ni nj nk nw nm nn no np nq nr bk">evaluate how alterations in features impact model performance,</li><li id="ab30" class="mt mu gc mv b ha ns mx my hd nt na nb nc nu ne nf ng nv ni nj nk nw nm nn no np nq nr bk">gain insights into how adjustments in model hyper-parameters influence its structure,</li><li id="3099" class="mt mu gc mv b ha ns mx my hd nt na nb nc nu ne nf ng nv ni nj nk nw nm nn no np nq nr bk">ensure model fairness, particularly in compliance with regulations like GDPR (which prohibits the use of personal data in ways that may harm or mislead customers), <strong class="mv gd">[1]</strong></li><li id="26fb" class="mt mu gc mv b ha ns mx my hd nt na nb nc nu ne nf ng nv ni nj nk nw nm nn no np nq nr bk">identify vulnerabilities within the model.</li></ul><h1 id="a0bb" class="nx ny gc bf nz oa ob hc oc od oe hf of og oh oi oj ok ol om on oo op oq or os bk">Global and local explainability</h1><p id="a16e" class="pw-post-body-paragraph mt mu gc mv b ha ot mx my hd ou na nb nc ov ne nf ng ow ni nj nk ox nm nn no fj bk">LightGBM, a tree-based boosting model, delivers precise outcomes but poses challenges in comprehension due to its inherent complexity.</p><p id="aacb" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">We’ll construct a LightGBM model and delve into its internal mechanisms. Initially, we’ll preprocess the diabetes dataset sourced from scikit-learn.</p><pre class="oy oz pa pb pc pd pe pf bp pg bb bk"><span id="a911" class="ph ny gc pe b bg pi pj l pk pl">from sklearn.datasets import load_diabetes<br/>from pandas import DataFrame<br/>import pandas as pd<br/><br/>diabetes = load_diabetes()<br/>X_raw, y_raw = diabetes.data, diabetes.target<br/>X = DataFrame(X_raw, columns=diabetes.feature_names)<br/>y = pd.Series(y_raw)<br/>y.name = "progression"<br/><br/>pdf = pd.concat([X,y], axis=1)<br/><br/># Rename columns<br/>pdf = pdf.rename(columns= {"bp": "blood_pressure",<br/>                           "s1": "total_cholestorol", <br/>                           "s2": "LDL",<br/>                           "s3": "HDL",<br/>                           "s4": "total_cholestorol/HDL",<br/>                           "s5": "triglycerides",<br/>                           "s6": "blood_sugar"})</span></pre><p id="3c03" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">The dataset has already been scaled, and in this scenario, the target variable will represent the progression of diabetes as a regression value. The features encompass various patient characteristics along with blood level measurements.</p><figure class="oy oz pa pb pc fo fv fw paragraph-image"><div role="button" tabindex="0" class="pn po ed pp bh pq"><div class="fv fw pm"><img src="../Images/f256e220a4513ffeec1a8dd1edc4fe49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WD15lnFizGmYLDAgYmDmNQ.png"/></div></div><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">The diabetes dataset used was provided by scikit-learn Data: [3]</figcaption></figure><p id="d5e6" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">The assumption is that higher blood pressure would contribute to higher progression of diabetes:</p><pre class="oy oz pa pb pc pd pe pf bp pg bb bk"><span id="84dd" class="ph ny gc pe b bg pi pj l pk pl">#Plot blood_sugar vs progression with a regression line<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/><br/>sns.lmplot(x="blood_sugar", y="progression", data=pdf)<br/>plt.show()</span></pre><figure class="oy oz pa pb pc fo fv fw paragraph-image"><div class="fv fw pr"><img src="../Images/987f228828f8260c999cb4d87f046b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*f83YiK7MRJ5hTaOR77ck_A.png"/></div><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">Relationship between blood sugar and diabetes progression</figcaption></figure><p id="f7ac" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">The same assumption exists for a higher BMI index.</p><pre class="oy oz pa pb pc pd pe pf bp pg bb bk"><span id="7cd1" class="ph ny gc pe b bg pi pj l pk pl"># same for BMI<br/>sns.lmplot(x="bmi", y="progression", data=pdf)</span></pre><figure class="oy oz pa pb pc fo fv fw paragraph-image"><div class="fv fw pr"><img src="../Images/2d0b0e963b4041976cd774aadd958c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*H44AjlXXg6p-FnqkeUrVbQ.png"/></div><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">Relationship between BMI and diabetes progression</figcaption></figure><p id="999f" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">As we can see, the scaled features are already challenging to interpret and explain to stakeholders. A LightGBM model is fit as follows:</p><pre class="oy oz pa pb pc pd pe pf bp pg bb bk"><span id="0a90" class="ph ny gc pe b bg pi pj l pk pl">from sklearn.model_selection import train_test_split<br/>X = pdf.drop("progression", axis=1)<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3)<br/><br/>import lightgbm<br/>import shap<br/><br/>def fit_lightgbm(x_train, y_train, x_test, y_test):<br/>    params = {<br/>        "task": "train",<br/>        "boosting_type": "gbdt",<br/>        "objective": "rmse",<br/>        "metric": ["l2", "rmse"],<br/>        "learning_rate": 0.005,<br/>        "num_leaves": 128,<br/>        "max_bin": 512,<br/>    } # basic parameters as a starting point<br/><br/>    model = lightgbm.sklearn.LGBMRegressor(**params)<br/>    fitted_model = model.fit(x_train, y_train)<br/>    y_pred = pd.Series(fitted_model.predict(x_test))<br/><br/>    return y_train, y_test, y_pred, fitted_model<br/><br/>y_train, y_test, y_pred, fitted_model = fit_lightgbm(<br/>        X_train, y_train, X_test, y_test<br/>    )</span></pre><p id="fe91" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">At a high level, a data scientist must grasp the model’s inner workings, ascertain if it captures the most pertinent features aligned with business insights, and identify any crucial features omitted from the model. At this point, it is challenging to explain the fitted model.</p><h2 id="ccf8" class="ps ny gc bf nz pt pu pv oc pw px py of nc pz qa qb ng qc qd qe nk qf qg qh qi bk">Global explainability</h2><p id="0b02" class="pw-post-body-paragraph mt mu gc mv b ha ot mx my hd ou na nb nc ov ne nf ng ow ni nj nk ox nm nn no fj bk">Assessing the global explainability of a LightGBM model entails calculating the feature importance or the mean of the Shapley values.</p><h2 id="c285" class="ps ny gc bf nz pt pu pv oc pw px py of nc pz qa qb ng qc qd qe nk qf qg qh qi bk">Feature importance</h2><p id="5aa5" class="pw-post-body-paragraph mt mu gc mv b ha ot mx my hd ou na nb nc ov ne nf ng ow ni nj nk ox nm nn no fj bk">The feature importance of the model is calculated as such:</p><pre class="oy oz pa pb pc pd pe pf bp pg bb bk"><span id="b140" class="ph ny gc pe b bg pi pj l pk pl"># calculate feature importance of LightGBM fitted_model using plot_importance<br/>lightgbm.plot_importance(fitted_model, importance_type="gain", <br/>                         figsize=(20, 10), grid=False, color="grey", <br/>                         precision=2)</span></pre><figure class="oy oz pa pb pc fo fv fw paragraph-image"><div role="button" tabindex="0" class="pn po ed pp bh pq"><div class="fv fw qj"><img src="../Images/800e0761a663a8a8db8f37b332aff06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HM2LJlBL0ASiSThzRgK_w.png"/></div></div><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">Feature importance of the LightGBM model</figcaption></figure><p id="fb09" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">The BMI index is the feature that improves the model’s predictions by significantly creating better splits in the model. The level of triglycerides, blood sugar, and blood pressure are also crucial features of the model. These findings are all reasonable, as the BMI index of a person, as well as the levels of blood sugar and triglycerides are highly likely contributors to diabetes.</p><h2 id="cfd7" class="ps ny gc bf nz pt pu pv oc pw px py of nc pz qa qb ng qc qd qe nk qf qg qh qi bk">Shapley values</h2><p id="254d" class="pw-post-body-paragraph mt mu gc mv b ha ot mx my hd ou na nb nc ov ne nf ng ow ni nj nk ox nm nn no fj bk">The mean of the Shapley values should give a very similar picture as above:</p><pre class="oy oz pa pb pc pd pe pf bp pg bb bk"><span id="bba7" class="ph ny gc pe b bg pi pj l pk pl"># plot shap values, include intercept in the shap values<br/>shap_values = shap.TreeExplainer(fitted_model).shap_values(X_train)<br/>shap.summary_plot(shap_values, X_train, plot_type="bar", color="grey")</span></pre><figure class="oy oz pa pb pc fo fv fw paragraph-image"><div role="button" tabindex="0" class="pn po ed pp bh pq"><div class="fv fw qk"><img src="../Images/cbf7ccee357d6a385f53b1888582d83e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9W8rUq2l5jLlOUQUyTYWQ.png"/></div></div><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">Mean values of marginal contribution of each feature to the LightGBM model</figcaption></figure><p id="c61e" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">Indeed, the results are very similar when using either of these techniques.</p><h2 id="919d" class="ps ny gc bf nz pt pu pv oc pw px py of nc pz qa qb ng qc qd qe nk qf qg qh qi bk">Local explainability</h2><p id="7cf7" class="pw-post-body-paragraph mt mu gc mv b ha ot mx my hd ou na nb nc ov ne nf ng ow ni nj nk ox nm nn no fj bk">These tools are invaluable for assessing the overall performance of a model. With Shapley values, it’s also feasible to conduct an in-depth analysis of the marginal contribution of each feature to the prediction at the level of a data point.</p><figure class="oy oz pa pb pc fo fv fw paragraph-image"><div class="fv fw ql"><img src="../Images/a6cce9dfb1a834c513c76d8b459dd060.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*zD23r4Jl2l7BvjCa5cMa0Q.png"/></div><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">Marginal contribution within a non-linear model. Source: [2]</figcaption></figure><p id="182c" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">For instance, we can analyse the impact of each feature on the progression of diabetes for a particular patient:</p><pre class="oy oz pa pb pc pd pe pf bp pg bb bk"><span id="1b68" class="ph ny gc pe b bg pi pj l pk pl"># plot shap values for a specific data point / patient<br/>shap.initjs()<br/>shap.force_plot(<br/>    shap.TreeExplainer(fitted_model).expected_value,<br/>    shap_values[0],<br/>    X_train.iloc[0],<br/>    matplotlib=True,<br/>)</span></pre><figure class="oy oz pa pb pc fo fv fw paragraph-image"><div role="button" tabindex="0" class="pn po ed pp bh pq"><div class="fv fw qm"><img src="../Images/89b363a7abfaef3a25e56651630401a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uACi99qdgCcqoPS-Bffd_w.png"/></div></div><figcaption class="fs ft fu fv fw fx fy bf b bg z dx">The marginal contribution of each feature to the prediction of the LightGBM model for one patient</figcaption></figure><p id="d6af" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">This perspective would empower us to offer tailored advice to that patient, suggesting a focus on optimising their BMI index.</p><h1 id="5077" class="nx ny gc bf nz oa ob hc oc od oe hf of og oh oi oj ok ol om on oo op oq or os bk"><strong class="al">Summary</strong></h1><p id="a3a1" class="pw-post-body-paragraph mt mu gc mv b ha ot mx my hd ou na nb nc ov ne nf ng ow ni nj nk ox nm nn no fj bk">In summary, while machine learning models offer significant advantages, their increasing complexity poses challenges regarding explainability, interpretability, and compliance, impacting their adoption and effectiveness. Techniques, such as SHAP and feature importance empower data scientists to understand their models better, therefore accommodating the process of explaining the predictions to the business.</p><h1 id="6f65" class="nx ny gc bf nz oa ob hc oc od oe hf of og oh oi oj ok ol om on oo op oq or os bk">Resources</h1><p id="d6ee" class="pw-post-body-paragraph mt mu gc mv b ha ot mx my hd ou na nb nc ov ne nf ng ow ni nj nk ox nm nn no fj bk">*Unless otherwise noted, all images have been generated by the author</p><p id="9650" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk"><strong class="mv gd">[1]</strong><a class="af fz" href="https://ico.org.uk/for-organisations/guide-to-data-protection/guide-to-the-general-data-protection-regulation-gdpr/principles/lawfulness-fairness-and-transparency/#:~:text=In%20general%2C%20fairness%20means%20that,also%20about%20whether%20you%20should" rel="noopener ugc nofollow" target="_blank">https://ico.org.uk/for-organisations/guide-to-data-protection/guide-to-the-general-data-protection-regulation-gdpr/principles/lawfulness-fairness-and-transparency/#:~:text=In%20general%2C%20fairness%20means%20that,also%20about%20whether%20you%20should</a>.</p><p id="6bc0" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk"><strong class="mv gd">[2]</strong><a class="af fz" href="https://shap.readthedocs.io/en/latest/example_notebooks/overviews/An%20introduction%20to%20explainable%20AI%20with%20Shapley%20values.html" rel="noopener ugc nofollow" target="_blank">https://shap.readthedocs.io/en/latest/example_notebooks/overviews/An%20introduction%20to%20explainable%20AI%20with%20Shapley%20values.html</a> © Copyright 2018, Scott Lundberg. Revision dffc346f</p><p id="4108" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk"><strong class="mv gd">[3]</strong><a class="af fz" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html" rel="noopener ugc nofollow" target="_blank">https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html</a> © 2007–2024, scikit-learn developers (BSD License)</p><p id="bece" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">LightGBM documentation: <a class="af fz" href="https://lightgbm.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">https://lightgbm.readthedocs.io/en/stable/</a></p><p id="6ee9" class="pw-post-body-paragraph mt mu gc mv b ha mw mx my hd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no fj bk">SHAP documentation: <a class="af fz" href="https://shap.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">https://shap.readthedocs.io/en/latest/index.html</a></p></div></div></div></div>    
</body>
</html>