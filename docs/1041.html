<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>How to Build a RAG System with a Self-Querying Retriever in LangChain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>How to Build a RAG System with a Self-Querying Retriever in LangChain</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad?source=collection_archive---------0-----------------------#2024-04-25">https://towardsdatascience.com/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad?source=collection_archive---------0-----------------------#2024-04-25</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="f3b1" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">RAG + Filtering with Metadata = Great Movie Recommendations 🍿</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Ed Izaguirre" class="l ep by dd de cx" src="../Images/c9eded1f06c47571baa662107428483f.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*X9RggnIeuLK8p0PvTB4jNw.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------" rel="noopener follow">Ed Izaguirre</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">12 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Apr 25, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">8</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/f25989e1bd8f991ca2ce6d84a27ab9ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvFDvcE7P-Wgr0ZFRE3mnQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image of a person watching television. Image created in DALL·E 3.</figcaption></figure><h2 id="32f5" class="nc nd fq bf ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz bk">Table of Contents</h2><ul class=""><li id="0f19" class="oa ob fq oc b go od oe of gr og oh oi nn oj ok ol nr om on oo nv op oq or os ot ou ov bk"><a class="af ow" href="#86c4" rel="noopener ugc nofollow">Retrieving the data</a></li><li id="45bd" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><a class="af ow" href="#53e3" rel="noopener ugc nofollow">Upload documents to Pinecone</a></li><li id="9298" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><a class="af ow" href="#21a7" rel="noopener ugc nofollow">Creating the self-querying retriever</a></li><li id="03ce" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><a class="af ow" href="#409b" rel="noopener ugc nofollow">Creating the chat model</a></li><li id="f6d4" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><a class="af ow" href="#3817" rel="noopener ugc nofollow">Demonstration</a></li></ul><h2 id="6bf4" class="nc nd fq bf ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz bk">Links</h2><ul class=""><li id="3d7a" class="oa ob fq oc b go od oe of gr og oh oi nn oj ok ol nr om on oo nv op oq or os ot ou ov bk">Edit: I have updated Film Search and rebranded it as Rosebud. I have also made it free to use! <a class="af ow" href="https://filmsearch.azurewebsites.net/" rel="noopener ugc nofollow" target="_blank">Check out the website here.</a></li><li id="384f" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Also check out my new article improving this app! <a class="af ow" rel="noopener" target="_blank" href="/productionizing-a-rag-app-04c857e0966e">Link.</a></li><li id="2dd7" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><a class="af ow" href="https://github.com/EdIzaguirre/Rosebud" rel="noopener ugc nofollow" target="_blank">Link to GitHub with code</a></li></ul></div></div></div><div class="ab cb pc pd pe pf" role="separator"><span class="pg by bm ph pi pj"/><span class="pg by bm ph pi pj"/><span class="pg by bm ph pi"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="f302" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Recently, I was browsing Max trying to find a movie to watch. Typically this involves browsing through the various lists presented to me, reading a few descriptions, and then picking something that sounds vaguely interesting. Sometimes it is a hit, sometimes not so much. I usually only touch the search function if I know the title of a film I am trying to watch or know the name of an actor I want. Otherwise searching is just not very useful.</p><p id="c22d" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">I was suddenly hit with an idea: why can’t I use natural language to query a movie based more on the <em class="pp">vibe</em> or the <em class="pp">substance</em> of a movie, rather than just a title or actor? For example, why can’t I fire up Max, Netflix, or Hulu and type one of the following queries into the search bar:</p><ul class=""><li id="34a2" class="oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os ot ou ov bk"><em class="pp">Find me drama movies in English that are less than 2 hours long and feature pets.</em></li><li id="4853" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><em class="pp">Recommend zombie movies, but make sure they are funny.</em></li><li id="25e1" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><em class="pp">I liked ‘Everything Everywhere all at Once’. Give me a similar film, but darker.</em></li></ul><p id="acc1" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">The beauty of this approach goes beyond a more natural way to search for films. This approach also preserves a user’s privacy. Rather than mine a user’s actions, likes, and dislikes to feed to a recommender system, <strong class="oc fr">this system uses no user data at all.</strong> The only thing required is a query.</p><p id="2495" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">So I built Film Search. This is a RAG-based system that takes in a user’s query, embeds it, and does a similarity search to find similar films. But it goes beyond vanilla RAG. This system uses what is called a <strong class="oc fr">self-querying retriever.</strong> What this allows for is filtering movies by their metadata, before doing a similarity search. So if a user has a query like “<em class="pp">Recommend horror movies made after 1980 that features lots of explosions</em>”, the search will first filter out all films that are not “horror movies made after the year 1980” before doing a similarity search for films that “feature lots of explosions”.</p><p id="c6ac" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">In this article, I will provide a high-level overview of how I made this system. The full code is provided in the links above if you want to go deeper.</p><p id="fe00" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Let’s dive in.</p></div></div></div><div class="ab cb pc pd pe pf" role="separator"><span class="pg by bm ph pi pj"/><span class="pg by bm ph pi pj"/><span class="pg by bm ph pi"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="86c4" class="pq nd fq bf ne pr ps gq ni pt pu gt nm pv pw px py pz qa qb qc qd qe qf qg qh bk">Retrieving the data</h1><p id="5c0a" class="pw-post-body-paragraph oa ob fq oc b go od oe of gr og oh oi nn oj ok ol nr om on oo nv op oq or os fj bk">The data for this project came from <a class="af ow" href="https://developer.themoviedb.org/docs/getting-started" rel="noopener ugc nofollow" target="_blank">The Movie Database (TMDB)</a>, with permission from the owner. Their API was simple to use, well maintained, and not heavily rate limited. I pulled the following film attributes from their API:</p><ul class=""><li id="6624" class="oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os ot ou ov bk">Title</li><li id="a078" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Runtime (minutes)</li><li id="e4ec" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Language</li><li id="7f1b" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Overview</li><li id="0c95" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Release Year</li><li id="897e" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Genre</li><li id="1646" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Keywords describing the film</li><li id="9121" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Actors</li><li id="8804" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Directors</li><li id="1a36" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Places to stream</li><li id="c0ba" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Places to buy</li><li id="0d45" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Places to rent</li><li id="7918" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">List of Production Companies</li></ul><p id="496a" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Below is a snippet of how data was pulled using the TMDB API and the response library from Python:</p><pre class="mm mn mo mp mq qi qj qk bp ql bb bk"><span id="663d" class="qm nd fq qj b bg qn qo l qp qq">def get_data(API_key, Movie_ID, max_retries=5):<br/>    """<br/>    Function to pull details of your film of interest in JSON format.<br/><br/>    parameters:<br/>    API_key (str): Your API key for TMBD<br/>    Movie_ID (str): TMDB id for film of interest<br/><br/>    returns:<br/>    dict: JSON formatted dictionary containing all details of your film of<br/>    interest<br/>    """<br/><br/>    query = 'https://api.themoviedb.org/3/movie/' + Movie_ID + \<br/>        '?api_key='+API_key + '&amp;append_to_response=keywords,' + \<br/>            'watch/providers,credits'<br/>    for i in range(max_retries):<br/>        response = requests.get(query)<br/>        if response.status_code == 429:<br/>            # If the response was a 429, wait and then try again<br/>            print(<br/>                f"Request limit reached. Waiting and retrying ({i+1}/{<br/>                    max_retries})")<br/>            time.sleep(2 ** i)  # Exponential backoff<br/>        else:<br/>            dict = response.json()<br/>            return dict</span></pre><p id="a694" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Notice that the query requires movie IDs (which were also obtained using TMDB), as well as <code class="cx qr qs qt qj b">append_to_response</code>, which allows me to pull several types of data e.g. keywords, watch providers, credits (directors and actors) in additional to some basic information about the film. There is also some basic scaffolding code in case I hit a rate limit, although this was never observed.</p><p id="0c25" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">We then have to parse the JSON response. Here is a snippet showing how this was done for parsing the actors and directors who worked on a film:</p><pre class="mm mn mo mp mq qi qj qk bp ql bb bk"><span id="9a1b" class="qm nd fq qj b bg qn qo l qp qq">credits = dict[‘credits’]<br/>actor_list, director_list = [], []<br/><br/># Parsing cast<br/>cast = credits['cast']<br/>NUM_ACTORS = 5<br/>for member in cast[:NUM_ACTORS]:<br/>    actor_list.append(member["name"])<br/><br/># Parsing crew<br/>crew = credits['crew']<br/>for member in crew:<br/>    if member['job'] == 'Director':<br/>        director_list.append(member["name"])<br/><br/>actor_str = ', '.join(list(set(actor_list)))<br/>director_str = ', '.join(list(set(director_list)))</span></pre><p id="9259" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Note that I limited the number of actors to the top five in a film. I also had to specify that I was only interested in directors, as the response included other types of crew members such as editors, costume designers, etc.</p><p id="6ce0" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">All of this data was then compiled into CSV files. Each attribute listed above became a column, and each row now represents a particular film. Below is a short snippet of films from the <code class="cx qr qs qt qj b">2008_movie_collection_data.csv</code> file that was created programatically. For this project I got roughly the 100 top films from the years 1920–2023.</p><figure class="mm mn mo mp mq mr"><div class="qu io l ed"><div class="qv qw l"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Snippet of movie data for demonstration purposes. By author.</figcaption></figure><p id="7146" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Believe it or not, I still have not seen Kung Fu Panda. Perhaps I’ll have to after this project.</p><h1 id="53e3" class="pq nd fq bf ne pr qx gq ni pt qy gt nm pv qz px py pz ra qb qc qd rb qf qg qh bk">Upload documents to Pinecone</h1><p id="068a" class="pw-post-body-paragraph oa ob fq oc b go od oe of gr og oh oi nn oj ok ol nr om on oo nv op oq or os fj bk">Next I had to upload the csv data to Pinecone. Typically chunking is important in a RAG system, but here each “document” (row of a CSV file) is fairly short, so chunking was not a concern. I first had to convert each CSV file to a LangChain document, and then specify which fields should be the primary content and which fields should be the metadata.</p><p id="7009" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Here is a snippet of code used to construct these documents:</p><pre class="mm mn mo mp mq qi qj qk bp ql bb bk"><span id="ba28" class="qm nd fq qj b bg qn qo l qp qq"># Loading in data from all csv files<br/>loader = DirectoryLoader(<br/>    path="./data",<br/>    glob="*.csv",<br/>    loader_cls=CSVLoader,<br/>    show_progress=True)<br/><br/>docs = loader.load()<br/><br/>metadata_field_info = [<br/>    AttributeInfo(<br/>        name="Title", description="The title of the movie", type="string"),<br/>    AttributeInfo(name="Runtime (minutes)",<br/>                  description="The runtime of the movie in minutes", type="integer"),<br/>    AttributeInfo(name="Language",<br/>                  description="The language of the movie", type="string"),<br/>    ...<br/>]<br/><br/>for doc in docs:<br/>    # Parse the page_content string into a dictionary<br/>    page_content_dict = dict(line.split(": ", 1)<br/>                             for line in doc.page_content.split("\n") if ": " in line)<br/>    <br/>    doc.page_content = 'Overview: ' + page_content_dict.get(<br/>        'Overview') + '. Keywords: ' + page_content_dict.get('Keywords')<br/>    doc.metadata = {field.name: page_content_dict.get(<br/>        field.name) for field in metadata_field_info}<br/><br/>    # Convert fields from string to list of strings<br/>    for field in fields_to_convert_list:<br/>        convert_to_list(doc, field)      <br/><br/>    # Convert fields from string to integers<br/>    for field in fields_to_convert_int:<br/>        convert_to_int(doc, field)</span></pre><p id="718f" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk"><code class="cx qr qs qt qj b">DirectoryLoader</code> from LangChain takes care of loading all csv files into documents. Then I need to specify what should be <code class="cx qr qs qt qj b">page_content</code> and what should be <code class="cx qr qs qt qj b">metadata</code> . This is an important decision. <code class="cx qr qs qt qj b">page_content</code> will be embedded and used in similarity search during the retrieval phase. <code class="cx qr qs qt qj b">metadata</code> will be used solely for filtering purposes before similarity search is done. I decided to take the <code class="cx qr qs qt qj b">overview</code> and <code class="cx qr qs qt qj b">keywords</code> properties and embed those, and the rest of the properties would be metadata. Further tweaking should be done to see if perhaps <code class="cx qr qs qt qj b">title</code> should also be included in <code class="cx qr qs qt qj b">page_content</code>, but I found this configuration works well for most user queries.</p><p id="f583" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Then the documents have to be uploaded to Pinecone. This is a fairly straightforward process:</p><pre class="mm mn mo mp mq qi qj qk bp ql bb bk"><span id="94be" class="qm nd fq qj b bg qn qo l qp qq"># Create empty index<br/>PINECONE_KEY, PINECONE_INDEX_NAME = os.getenv(<br/>    'PINECONE_API_KEY'), os.getenv('PINECONE_INDEX_NAME')<br/><br/>pc = Pinecone(api_key=PINECONE_KEY)<br/><br/># Uncomment if index is not created already<br/>pc.create_index(<br/>    name=PINECONE_INDEX_NAME,<br/>    dimension=1536,<br/>    metric="cosine",<br/>    spec=PodSpec(<br/>        environment="gcp-starter"<br/>    )<br/>)<br/><br/># Target index and check status<br/>pc_index = pc.Index(PINECONE_INDEX_NAME)<br/>print(pc_index.describe_index_stats())<br/><br/>embeddings = OpenAIEmbeddings(model='text-embedding-ada-002')<br/><br/>vectorstore = PineconeVectorStore(<br/>    pc_index, embeddings<br/>)<br/><br/># Create record manager<br/>namespace = f"pinecone/{PINECONE_INDEX_NAME}"<br/>record_manager = SQLRecordManager(<br/>    namespace, db_url="sqlite:///record_manager_cache.sql"<br/>)<br/><br/>record_manager.create_schema()<br/><br/># Upload documents to pinecome<br/>index(docs, record_manager, vectorstore,<br/>      cleanup="full", source_id_key="Website")</span></pre><p id="9980" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">I’ll just highlight a few things here:</p><ul class=""><li id="808f" class="oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os ot ou ov bk">Using an <code class="cx qr qs qt qj b">SQLRecordManager</code> ensures that duplicate documents are not uploaded to Pinecone if this code is run multiple times. If a document is modified, only that document is modified in the vector store.</li><li id="4ea5" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">We are using the classic <code class="cx qr qs qt qj b">text-embedding-ada-002</code> from OpenAI as our embedding model.</li></ul><h1 id="21a7" class="pq nd fq bf ne pr qx gq ni pt qy gt nm pv qz px py pz ra qb qc qd rb qf qg qh bk">Creating the self-querying retriever</h1><p id="91bb" class="pw-post-body-paragraph oa ob fq oc b go od oe of gr og oh oi nn oj ok ol nr om on oo nv op oq or os fj bk">The self-querying retriever will allow us to filter the movies that are retrieved during RAG via the metadata we defined earlier. This will dramatically increase the usefulness of our film recommender.</p><p id="e9ed" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">One important consideration when choosing your vector store is to make sure that it supports filtering by metadata, because not all do. <a class="af ow" href="https://python.langchain.com/docs/integrations/retrievers/self_query" rel="noopener ugc nofollow" target="_blank">Here is a list of databases</a> by LangChain that support self-querying retrieval. Another important consideration is what types of comparators are allowed for each vector store. Comparators are the method by which we filter via metadata. For example, we can use the <code class="cx qr qs qt qj b">eq</code> comparator to make sure that our film falls under the science fiction genre: <code class="cx qr qs qt qj b">eq('Genre', 'Science Fiction')</code> . Not all vector stores allow for all comparators. As an example, check out the <a class="af ow" href="https://weaviate.io/developers/weaviate/api/graphql/filters#filter-structure" rel="noopener ugc nofollow" target="_blank">allowed comparators in Weaviate</a> and how they vary from the <a class="af ow" href="https://docs.pinecone.io/guides/data/filtering-with-metadata#metadata-query-language" rel="noopener ugc nofollow" target="_blank">comparators in Pinecone</a>. We need to tell the model about what comparators are allowed to prevent it from accidentally writing a forbidden query.</p><p id="f8b3" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">In addition to telling the model what comparators exist, we can also feed the model examples of user queries and corresponding filters. This is known as <strong class="oc fr">few-shot learning</strong>, and it is invaluable to help guide your model.</p><p id="72b4" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">To see where this helps, take a look at the following two user queries:</p><ul class=""><li id="261a" class="oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os ot ou ov bk"><em class="pp">“Recommend some films by Yorgos Lanthimos.”</em></li><li id="0119" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk"><em class="pp">“Films similar to Yorgos Lanthmios movies.”</em></li></ul><p id="1620" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">It is easy for my metadata filtering model to write the same filter query for each of these examples, even though I want them to be treated differently. The first should yield only films directed <strong class="oc fr">by</strong> Lanthimos, while the second should yield films that have a similar <strong class="oc fr">vibe</strong> to Lanthimos films. To ensure this behavior, I spoon-feed the model examples of my desired behavior. The beauty with language models is that they can use their “reasoning” abilities and world knowledge to generalize from these few-shot examples to other user queries.</p><pre class="mm mn mo mp mq qi qj qk bp ql bb bk"><span id="8d65" class="qm nd fq qj b bg qn qo l qp qq">document_content_description = "Brief overview of a movie, along with keywords"<br/><br/>        # Define allowed comparators list<br/>        allowed_comparators = [<br/>            "$eq",  # Equal to (number, string, boolean)<br/>            "$ne",  # Not equal to (number, string, boolean)<br/>            "$gt",  # Greater than (number)<br/>            "$gte",  # Greater than or equal to (number)<br/>            "$lt",  # Less than (number)<br/>            "$lte",  # Less than or equal to (number)<br/>            "$in",  # In array (string or number)<br/>            "$nin",  # Not in array (string or number)<br/>            "$exists", # Has the specified metadata field (boolean)<br/>        ]<br/><br/>        examples = [<br/>            (<br/>                "Recommend some films by Yorgos Lanthimos.",<br/>                {<br/>                    "query": "Yorgos Lanthimos",<br/>                    "filter": 'in("Directors", ["Yorgos Lanthimos]")',<br/>                },<br/>            ),<br/>            (<br/>                "Films similar to Yorgos Lanthmios movies.",<br/>                {<br/>                    "query": "Dark comedy, absurd, Greek Weird Wave",<br/>                    "filter": 'NO_FILTER',<br/>                },<br/>            ),<br/>            ...<br/>        ]<br/><br/>        metadata_field_info = [<br/>            AttributeInfo(<br/>                name="Title", description="The title of the movie", type="string"),<br/>            AttributeInfo(name="Runtime (minutes)",<br/>                          description="The runtime of the movie in minutes", type="integer"),<br/>            AttributeInfo(name="Language",<br/>                          description="The language of the movie", type="string"),<br/>            ...<br/>        ]<br/><br/>        constructor_prompt = get_query_constructor_prompt(<br/>            document_content_description,<br/>            metadata_field_info,<br/>            allowed_comparators=allowed_comparators,<br/>            examples=examples,<br/>        )<br/><br/>        output_parser = StructuredQueryOutputParser.from_components()<br/>        query_constructor = constructor_prompt | query_model | output_parser<br/><br/>        retriever = SelfQueryRetriever(<br/>            query_constructor=query_constructor,<br/>            vectorstore=vectorstore,<br/>            structured_query_translator=PineconeTranslator(),<br/>            search_kwargs={'k': 10}<br/>        )</span></pre><p id="3b69" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">In addition to examples, the model also has to know a description of each metadata field. This helps it understand what metadata filtering is possible.</p><p id="91b2" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Finally, we construct our chain. Here <code class="cx qr qs qt qj b">query_model</code> is an instance of GPT-4 Turbo using the OpenAI API. I recommend using GPT-4 instead of 3.5 for writing these metadata filter queries, since this is a critical step and one that 3.5 messes up on more frequently. <code class="cx qr qs qt qj b">search_kwargs={'k':10}</code> tells the retriever to pull up the ten most similar films based on the user query.</p><h1 id="409b" class="pq nd fq bf ne pr qx gq ni pt qy gt nm pv qz px py pz ra qb qc qd rb qf qg qh bk">Creating the chat model</h1><p id="d6b8" class="pw-post-body-paragraph oa ob fq oc b go od oe of gr og oh oi nn oj ok ol nr om on oo nv op oq or os fj bk">Finally, after building the self-querying retriever we can build the standard RAG model on top of it. We begin by defining our chat model. This is what I call a summary model because it takes in a context (retrieved films + system message) and responds with a summary of each recommendation. This model can be GPT-3.5 Turbo if you are trying to keep costs down, or GPT-4 Turbo if you want the absolute best results.</p><p id="fb07" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">In the system message I tell the bot what its goal is, and provide a series of recommendations and restrictions, the <strong class="oc fr">most important of which is to not recommend a film that is not provided to it by the self-querying retriever.</strong> In testing, I was having issues when a user query yielded no films from the database. For example, the query: <em class="pp">“Recommend some horror films starring Matt Damon directed by Wes Anderson made before 1980”</em> would cause the self-querying retriever to retrieve no films (because as awesome as it sounds that movie doesn’t exist). Presented with no film data in its context, the model would use its own (faulty) memory to try and recommend some films. This is not good behavior. I don’t want a Netflix recommender to discuss films that are not in the database. The system message below managed to stop this behavior. I did notice that GPT-4 is better at following instructions than GPT-3.5, which is expected.</p><pre class="mm mn mo mp mq qi qj qk bp ql bb bk"><span id="502d" class="qm nd fq qj b bg qn qo l qp qq">chat_model = ChatOpenAI(<br/>    model=SUMMARY_MODEL_NAME,<br/>    temperature=0,<br/>    streaming=True,<br/>)<br/><br/>prompt = ChatPromptTemplate.from_messages(<br/>    [<br/>        (<br/>            'system',<br/>            """<br/>            Your goal is to recommend films to users based on their <br/>            query and the retrieved context. If a retrieved film doesn't seem <br/>            relevant, omit it from your response. If your context is empty<br/>            or none of the retrieved films are relevant, do not recommend films<br/>            , but instead tell the user you couldn't find any films <br/>            that match their query. Aim for three to five film recommendations,<br/>            as long as the films are relevant. You cannot recommend more than <br/>            five films. Your recommendation should be relevant, original, and <br/>            at least two to three sentences long.<br/>            <br/>            YOU CANNOT RECOMMEND A FILM IF IT DOES NOT APPEAR IN YOUR <br/>            CONTEXT.<br/><br/>            # TEMPLATE FOR OUTPUT<br/>            - **Title of Film**:<br/>                - Runtime:<br/>                - Release Year:<br/>                - Streaming:<br/>                - (Your reasoning for recommending this film)<br/>            <br/>            Question: {question} <br/>            Context: {context} <br/>            """<br/>        ),<br/>    ]<br/>)<br/><br/>def format_docs(docs):<br/>    return "\n\n".join(f"{doc.page_content}\n\nMetadata: {doc.metadata}" for doc in docs)<br/><br/># Create a chatbot Question &amp; Answer chain from the retriever<br/>rag_chain_from_docs = (<br/>    RunnablePassthrough.assign(<br/>        context=(lambda x: format_docs(x["context"])))<br/>    | prompt<br/>    | chat_model<br/>    | StrOutputParser()<br/>)<br/><br/>rag_chain_with_source = RunnableParallel(<br/>    {"context": retriever, "question": RunnablePassthrough()}<br/>).assign(answer=rag_chain_from_docs)</span></pre><p id="5452" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk"><code class="cx qr qs qt qj b">format_docs</code> is used to format the information presented to the model so that it is easy to understand and parse. We present to the model both the <code class="cx qr qs qt qj b">page_content</code> (overview and keywords) as well as the <code class="cx qr qs qt qj b">metadata</code> (all other movie properties); anything it might need to better recommend a film to the user.</p><p id="8ee9" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk"><code class="cx qr qs qt qj b">rag_chain_from_docs</code> is a chain that takes the retrieved documents, formats them using <code class="cx qr qs qt qj b">format_docs</code> , feeds the formatted documents into the context that the model then uses to answer the question. Finally we create <code class="cx qr qs qt qj b">rag_chain_with_source</code> , which is a <code class="cx qr qs qt qj b">RunnableParallel</code> that, as its name suggests, runs two operations in parallel: the self-querying retriever goes off to retrieve similar documents while the the query is simply passed to the model via <code class="cx qr qs qt qj b">RunnablePassthrough()</code> . The results from the parallel components are then combined, and <code class="cx qr qs qt qj b">rag_chain_from_docs</code> is used to generate the answer. Here <code class="cx qr qs qt qj b">source</code> refers to the retriever, which access to all ‘source’ documents.</p><p id="5f05" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Because I want the answer to be streamed (e.g. presented to the user chunk by chunk like ChatGPT), we use the following code:</p><pre class="mm mn mo mp mq qi qj qk bp ql bb bk"><span id="8ba2" class="qm nd fq qj b bg qn qo l qp qq">for chunk in rag_chain_with_source.stream(query):<br/>    for key in chunk:<br/>        if key == 'answer':<br/>            yield chunk[key]</span></pre><h1 id="3817" class="pq nd fq bf ne pr qx gq ni pt qy gt nm pv qz px py pz ra qb qc qd rb qf qg qh bk">Demonstration</h1><p id="670b" class="pw-post-body-paragraph oa ob fq oc b go od oe of gr og oh oi nn oj ok ol nr om on oo nv op oq or os fj bk">Now to the fun part: playing with the model. As mentioned previously, Streamlit was used to create the frontend and for hosting the app. I won’t discuss the code for the UI here; please see the raw code for details on the implementation. It is fairly straightforward, and there are lots of other examples on the <a class="af ow" href="https://docs.streamlit.io/knowledge-base/tutorials/build-conversational-apps" rel="noopener ugc nofollow" target="_blank">Streamlit website</a>.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rc"><img src="../Images/02b3a62862751b327a753fd250ba3e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGcHzfot-amNlmUp_ru2dw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Film Search UI. By author.</figcaption></figure><p id="3262" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">There are several suggestions you can use, but let’s try our own query:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rd"><img src="../Images/7ad4d1b3125c7faf549f71d8c1afbacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPFRpFsboLCwWhX8toh61Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Example query and model response. By author.</figcaption></figure><p id="2e0c" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Behind the scenes, the self-querying retriever made sure to filter out any films that were not in the French language. Then, it performed a similarity search for “coming of age stories”, resulting in ten films in the context. Finally the summarizer bot selected five films for recommendation. Note the range of films suggested: some with release dates as early as 1959 to as late as 2012. For convenience I ensure the bot includes the film’s runtime, release year, streaming providers, and a brief recommendation handcrafted by the bot.</p><p id="b07e" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk"><em class="pp">(Side note: If you haven’t seen </em><a class="af ow" href="https://en.wikipedia.org/wiki/The_400_Blows" rel="noopener ugc nofollow" target="_blank"><em class="pp">The 400 Blows</em></a><em class="pp">, stop whatever you are doing, and go </em><a class="af ow" href="https://www.youtube.com/watch?v=PvjUhgtn_-U" rel="noopener ugc nofollow" target="_blank"><em class="pp">watch it immediately</em></a><em class="pp">.)</em></p><p id="6379" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Qualities that normally are seen as negatives in a large language model, such as the non-deterministic nature of its responses, are now positive. Ask the model the same question twice and you may get slightly different recommendations.</p><p id="512e" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">It is important to note some limitations of the current implementation:</p><ul class=""><li id="de7f" class="oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os ot ou ov bk">There is no saving of recommendations. Users likely would want to revisit old recommendations.</li><li id="2d41" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Manual updating of raw data from The Movie Database. Automating this and having it update weekly would be a good idea.</li><li id="e488" class="oa ob fq oc b go ox oe of gr oy oh oi nn oz ok ol nr pa on oo nv pb oq or os ot ou ov bk">Bad metadata filtering by the self-querying retrieval. For example the query “Ben Affleck films” could be problematic. This could mean films where Ben Affleck is the <strong class="oc fr">star</strong> or films that have been <strong class="oc fr">directed</strong> by Ben Affleck. This is an example where clarification of the query would be helpful.</li></ul><p id="7bde" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Possible improvements to this project could be to perform a <a class="af ow" href="https://python.langchain.com/docs/integrations/retrievers/cohere-reranker" rel="noopener ugc nofollow" target="_blank">re-ranking of documents</a> after retrieval. It could also be interesting to have a chat model that you can converse with in multi-turn conversations, rather then just a QA bot. One could also create an <a class="af ow" href="https://python.langchain.com/docs/integrations/tools/human_tools" rel="noopener ugc nofollow" target="_blank">agent recommender</a> that prompts the user with a clarifying question if the query is not clear.</p><p id="a131" class="pw-post-body-paragraph oa ob fq oc b go pk oe of gr pl oh oi nn pm ok ol nr pn on oo nv po oq or os fj bk">Have fun searching for films!</p></div></div></div></div>    
</body>
</html>