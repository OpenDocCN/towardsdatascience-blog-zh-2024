<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>How We Optimized The Problem Of Global Containers Distribution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>How We Optimized The Problem Of Global Containers Distribution</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-we-optimized-the-problem-of-global-containers-distribution-ea6201d4513e?source=collection_archive---------5-----------------------#2024-08-01">https://towardsdatascience.com/how-we-optimized-the-problem-of-global-containers-distribution-ea6201d4513e?source=collection_archive---------5-----------------------#2024-08-01</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="dd45" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Using Linear Programming to optimize a complete container-based supply chain operation across the globe</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://willian-fuks.medium.com/?source=post_page---byline--ea6201d4513e--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Will Fuks" class="l ep by dd de cx" src="../Images/8c7227ad8677f34792058dfd45083c0b.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*X0iP-cBgQCPX1I-ykp-e4g.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--ea6201d4513e--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://willian-fuks.medium.com/?source=post_page---byline--ea6201d4513e--------------------------------" rel="noopener follow">Will Fuks</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--ea6201d4513e--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">18 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Aug 1, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="2793" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Recently I was invited by a coworker to join a project for a big company in Brazil that sells goods and services on a global scale.</p><p id="e93c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The project involved transport optimization and was quite interesting — and challenging — so I’d like to write about it and how we solved the problem using the library <a class="af nf" href="https://www.cvxpy.org/" rel="noopener ugc nofollow" target="_blank">cvxpy</a> (also used to solve optimization problems at companies like <em class="ng">Tesla</em>, <em class="ng">Netflix</em> and <em class="ng">Two Sigma</em>).</p><p id="5a53" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Specifically, this post covers:</p><ol class=""><li id="90de" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nh ni nj bk">The challenge of transporting containers globally with a set of several constraints.</li><li id="88bf" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne nh ni nj bk">How we managed the company’s data and described it as a set of linear transformations.</li><li id="8548" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne nh ni nj bk">How we adapted the variables and constraints to fit the Linear Programming formulation.</li><li id="e96f" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne nh ni nj bk">Techniques used to guarantee the objective function and constraints were convex — cvxpy’s main restriction.</li></ol><p id="cd64" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With no further ado, let’s dive into it.</p><h1 id="b122" class="np nq fq bf nr ns nt gq nu nv nw gt nx ny nz oa ob oc od oe of og oh oi oj ok bk">1. The Challenge</h1><p id="0d15" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">When the project started, the company revealed us that they already had a solution implemented on top of <em class="ng">Microsoft Excel Solver </em>to optimize how to best manage the containers. The Solver aimed to reduce costs of transportation, freight, storage, and operation while following a set of constraints.</p><p id="60b1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The solution worked fine but as operations expanded the process began to halt and suffer with some bottlenecks, as the company explained. At times, they had so many containers to allocate that it would take the Solver a few days to process the whole dataset and come up with an answer.</p><p id="ff1e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">They requested us to develop something new that could handle the workload of the system while also being flexible enough so that the system would accept new constraints on demand.</p><p id="6224" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To begin with, the company has factories located across the country and containers are prepared by demand on each factory:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or os"><img src="../Images/001c29d34f438addc891bce6c9dbdac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*c81xrpdLzoHo-TbU_m5nSA.png"/></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Factories located across the country and its containers. Image by author.</figcaption></figure><p id="777d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Each factory produces containers weekly according to its own demands, which means some factories will produce more containers than others. Each container carries its own goods so the sales price changes as well (this variable will be important soon).</p><p id="d555" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The destiny of each container also varies; some will be transported to nearby countries whereas others have to cross the globe. Therefore, the company needs to send the containers to appropriate docks or it risks not succeeding with the delivery (due the lack of connection between the docks of each country).</p><p id="9cae" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Several new variables shows up when trying to connect factories to the appropriate docks. First, each factory may choose how to transport the containers: either by using trains — and, in doing so, there are various types of contracts to choose from — or by trucks (again, multiple types of contracts as well):</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="pg ph ed pi bh pj"><div class="oq or pf"><img src="../Images/fdbfee15861f3e4967091c415c6c6177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdJDLGohOWbyXv_1GLk0og.png"/></div></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Factories may choose how to transport containers to dock, according to availability of options. Image by author.</figcaption></figure><p id="a77e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now another challenge arises: each container has a specific destination and so does the ships available on each dock. Destinations must, therefore, match! If a container that should go to Hong Kong is transported to a dock where no ships will be going to Asia then we just sacrificed an entire container.</p><p id="db86" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The matching problem means that, at times, factories may need to transport a container to a more distant dock (and expend more money) simply because it’s the only remaining option for making the connection between Brazil and the rest of the world. Shippers will be another variable and they should be accounted for availability in terms of spaces on each ship and also the ship’s destination.</p><p id="eeb6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Shippers may also allow for what is known as “<em class="ng">overbooking spaces</em>”, that is, just like the concept applies to airline flights, it also applies to ships but here the concepts is a bit less restrictive: for a given week, shippers can inform an “overbooking factor” which gives us an idea of how many more containers can be added on each ship above the threshold capacity — with a higher freight, as expected. The optimizer can use this factor to allocate remaining containers and take advantage of cheaper transportation, for instance.</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="pg ph ed pi bh pj"><div class="oq or pk"><img src="../Images/d4b2327f58c1a5ca015aaba46d9191ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xpfYciBgbZPZwu0fuG-gw.png"/></div></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Adding shippers to the whole challenge. Image by author.</figcaption></figure><p id="e087" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The optimizer must consider as well a set of rules to follow. Here’s a brief list of requirements:</p><ul class=""><li id="23b7" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl ni nj bk"><strong class="ml fr">Ships have a maximum capacity</strong>: each ship attends specific regions through what is called “trades”. Each shipper have a maximum capacity of containers for each trade — this rule can be broken at times through <em class="ng">overbooking</em>.</li><li id="1949" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><strong class="ml fr">Connect factory and dock</strong>: factories can only send containers to docks with valid and available transportation — if a factory does not have a train station connection to a given dock then the optimizer must choose another transport.</li><li id="f9c8" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><strong class="ml fr">Transportation Limits</strong>: the company made clear that contracts and slots available for transportation can vary; they have agreements and licenses to use certain slots from trains monthly, which adds an upper cap on number of containers.</li><li id="b15b" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><strong class="ml fr">Connect departure dock and shipper</strong>: the optimizer must send containers from factories to docks that contains shippers with spaces on ships and attend the <em class="ng">trade</em> where the container is going.</li><li id="0026" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><strong class="ml fr">Overbooking</strong>: overbooking can happen — like an extra trick at our disposal. Each shipper have a factor of how many slots may be used above the max cap. Containers under overbooking are much more expensive and it should happen only if all prior available spaces have already been consumed.</li><li id="1cef" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><strong class="ml fr">Transport Or Not Transport</strong>: The optimizer may conclude that it’s better to store a given container in the factory than transporting it, which affects the total costs expectation.</li></ul><p id="e45b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Are we there yet? Well, not really. In practice, the challenge is a bit more evolved as it should contain the time that factories take to transport each container and connect it to when shippers will be available at the docks. If we end up choosing a transport that is too slow we may miss the ship and either have to wait and hope that there is another ship going to the same destination or we basically just lose the container. This post does not consider the time variables as it makes development much more complex.</p><p id="1219" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">We have the challenge, now, let’s see how we solved it 🥷!</p><h1 id="2aa9" class="np nq fq bf nr ns nt gq nu nv nw gt nx ny nz oa ob oc od oe of og oh oi oj ok bk">3. Linear Programming</h1><p id="2ced" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk"><a class="af nf" href="https://www.britannica.com/science/linear-programming-mathematics" rel="noopener ugc nofollow" target="_blank">Linear Programming</a> (LP) is an optimization technique that also accepts a set of constraints represented as linear transformations.</p><p id="3e51" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Mathematically, we have something like the following:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or pm"><img src="../Images/70d4a1a86c13c0f4e06e37a43132f0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*celbecwwFTmxaPufJyRXRA.png"/></div></figure><p id="a310" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk"><strong class="ml fr"><em class="ng">f</em></strong><em class="ng"> </em>is the <strong class="ml fr">objective function</strong> (or cost function) and for our challenge it represents the costs associated to each transportation, ship, whether containers were stored on overbooking status and the trade-offs between leaving the containers in the factories or not.</p><p id="0127" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The values <strong class="ml fr"><em class="ng">x</em></strong> represent the variables the optimizer must manipulate in order to minimize the objective. In our case, it’ll be which transport, ship, dock and overbooking status to choose.</p><p id="0c3c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To make the concept more tangible and connected with the main challenge in this post, let’s begin with a very simple implementation on top of cvxpy.</p><h2 id="7c48" class="pn nq fq bf nr po pp pq nu pr ps pt nx ms pu pv pw mw px py pz na qa qb qc qd bk">3.1 Simple Example</h2><p id="8500" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">Suppose the following setting:</p><ul class=""><li id="22e4" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl ni nj bk">The company produced 4 containers in a given week, all in the same factory. Their values is: [$200, $300, $400, $500].</li><li id="2c7e" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">The factory can use only one type of transportation.</li><li id="4666" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">The factory is connected to just one dock.</li><li id="87fc" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">In this supposed week, two shippers will have ships available at the dock. Shippers charges $100 and $130 per container respectively.</li><li id="97e7" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">First shipper has 2 remaining slots available; the second has just 1.</li></ul><p id="d128" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The main goal of the optimizer is to distribute the 4 containers on the available spaces on ships while minimizing total costs of transportation.</p><p id="185c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">How do we implement it in cvxpy? Well, it’s quite simple actually. First we need a variable <strong class="ml fr">x </strong>that represents the choices that the optimizer can make. Best way to represent <strong class="ml fr">x</strong> in this case is as a <strong class="ml fr">boolean</strong> array with shape (4, 2) — each row corresponds to a given container, and 2 columns as there are 2 shippers available:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or qe"><img src="../Images/4684be83ca2133aa3fc0f31123427229.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*B6hajikpelIA-ZOqqkBG6Q.png"/></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">An example of one possible value of <strong class="bf nr">x</strong> that represents choices the optimizer can make to minimize costs. Image by author.</figcaption></figure><p id="d710" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">A value of “1” on a row means the optimizer allocated the corresponding container to the respective shipper at that column. In this example, the first and second containers go to the first shipper and the third and fourth containers go to the second shipper. Notice that each row can contain only one value expressed as “1” and the other must be “0” as otherwise it would mean that a given container was allocated to both shippers at the same time, which is invalid.</p><p id="48e4" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The challenge of the optimizer will be, therefore, to keep changing this array until it finds a minimal value of total costs, while still respecting the requirements.</p><p id="8f95" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Costs will have two components: one associated to the shippers and another to the container itself. If a given container is not allocated to any ship then its value should be added to the final costs — it’s better, therefore, to prioritize allocation of the $500 container instead of the $200 one.</p><p id="4f2b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">As for the code implementation, this is one possibility:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="8113" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Key points to consider:</p><ul class=""><li id="911b" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl ni nj bk">cvxpy requires the set of <strong class="ml fr">variables</strong>, <strong class="ml fr">constraints</strong> and finally the <strong class="ml fr">cost expression</strong>.</li><li id="62f1" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">The line <code class="cx qi qj qk ql b">constraint0 = cx.sum(x_shippers, axis=1) &lt;= 1</code> is a constraint that <em class="ng">cvxpy</em> must obey when optimizing <strong class="ml fr">x</strong>. As a general rule, they must keep the optimization process convex (which guarantees convergence) and can either be an equality expression or an upper bound equality. In this case, the <code class="cx qi qj qk ql b">sum</code> operator happens on <em class="ng">axis=1</em> which means “sum through columns”. <br/>The rule imples that the summation of each row of <strong class="ml fr">x_shippers</strong> can be at maximum equal to 1, which guarantees that a given container won’t be assigned to multiple shippers at the same time.<br/>As the summation constraint follows the <code class="cx qi qj qk ql b">&lt;=</code> rule, then a given row can be of just 0’s, which means a given container may not be assigned to any ship at all (this may happen due lack of available spaces on ships, for instance).</li><li id="e58c" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><code class="cx qi qj qk ql b">constraint1 = cx.sum(x_shippers, axis=0) &lt;= shippers_spaces</code> works similarly to <em class="ng">constraint0</em>. It basically translates that all containers assigned for each ship cannot surpass their maximum capacity.</li><li id="f8fe" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">Then we arrive at the heart of the problem: the cost function, given by: <code class="cx qi qj qk ql b">cost = cx.sum(x_shippers @ shippers_cost.T) + container_costs @ (1 — cx.sum(x_shippers, axis=1))</code> . The first component <code class="cx qi qj qk ql b">cx.sum(x_shippers @ shippers_cost.T)</code> basically express all costs for allocating each container to each shipper. “<strong class="ml fr">@</strong>”<strong class="ml fr"> </strong>represents the dot product so the result of the operation is already the cost associated to each container, which has to be summed for the total cost.<br/>Second component <code class="cx qi qj qk ql b">container_costs @ (1 — cx.sum(x_shippers, axis=1))</code> is arguably more interesting as here we start to see the strategies we can use to express our problems in <em class="ng">cvxpy</em>. By using the <strong class="ml fr">1 </strong>matrix minus the row values expressed as <code class="cx qi qj qk ql b">cx.sum(x_shippers, axis=1)</code> , we essentially get a (4, 1) matrix where each row indicates whether the container was ever assigned to some shipper or not.<br/>The dot <code class="cx qi qj qk ql b">container_costs @ not chosen containers</code> tracks which containers were not routed and sum their cost value.</li></ul><p id="b0d8" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is an example of the result:</p><pre class="ot ou ov ow ox qm ql qn qo ay qp bk"><span id="d36f" class="pn nq fq ql b hw qq qr l im qs">print(x_shippers.value)<br/>array([[0., 0.], [0., 1.], [1., 0.], [1., 0.]])</span></pre><p id="55c1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Container 0 was not assigned to any ship (as it’s the cheapest so it was not prioritized).</p><p id="4ce0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Some tips before we move on:</p><ol class=""><li id="6f28" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nh ni nj bk">You can run experiments with cvxpy using <a class="af nf" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank">Colab</a>. Just run <code class="cx qi qj qk ql b">!pip install cvxpy</code> and you are pretty much ready to go.</li><li id="68be" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne nh ni nj bk">You can run some checks to confirm you are on the right track when implementing your models. One technique I like to use is to, for instance, set the variables with an initial value, such as <code class="cx qi qj qk ql b">x_shippers = cx.Variable((2, 2), value=[[1, 0], [0, 1]]</code>. Then, after running operations (such as <code class="cx qi qj qk ql b">r=A @ x_shippers</code> ), you can print the result <code class="cx qi qj qk ql b">r.value</code> attribute to check if everything is working as expected.</li><li id="36d2" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne nh ni nj bk">When working with cvxpy, at times you’ll get some errors when running the optimization. One common problem is the error message:</li></ol><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or qt"><img src="../Images/495c23a75b2347bb0018533dd00b4ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*do73qWbRtQKg3PXZDor4FA.png"/></div></figure><p id="8c66" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is the infamous Disciplined Convex Problem (<a class="af nf" href="http://cvxr.com/cvx/doc/dcp.html" rel="noopener ugc nofollow" target="_blank">DCP</a> for short) which consists of a set of rules that must be followed to guarantee that restrictions and objective will be convex. For instance, if instead of the <code class="cx qi qj qk ql b">sum</code> operator we used <code class="cx qi qj qk ql b">max</code> , we’d get the exact same result but when trying to run it we’d get<code class="cx qi qj qk ql b">DCPError</code> . DCP means then that all operations used to express the cost and constraints must follow the rules of convexity.</p><p id="cce0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The previous example works well for a gentle introduction to the <em class="ng">cvxpy</em> API. Let’s now consider a bit more evolved problem on the same theme.</p><h2 id="14ea" class="pn nq fq bf nr po pp pq nu pr ps pt nx ms pu pv pw mw px py pz na qa qb qc qd bk">3.2 Medium Example</h2><p id="27bb" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">Let’s consider again the same 4 containers with same costs and conditions. This time, the first and third container are going to destination “0” whereas second and fourth containers must go to destine “1” and available spaces are the same as before ([2, 1]). The input we’d get for this problem is something like this:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or qu"><img src="../Images/0f2cdb29fbc489646b636f49b2111817.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*wUFDsaoKNyGX6mCBicLa8g.png"/></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Containers in rows, cost and destination in columns. Image by author.</figcaption></figure><p id="2390" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">All containers are produced on the same factory but this time there are 2 options to choose from for transportation: train and trucks, with respective costs [$50, $70]. For this considered week, we’ll be able to allocate at maximum 2 containers on train.</p><p id="be1c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Before moving on, think about how you would solve this one. Remember the essential steps recommended for working with Linear Programming:</p><ol class=""><li id="a4e0" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nh ni nj bk">What are the variables required to describe the problem? <code class="cx qi qj qk ql b">x_shippers = ...</code></li><li id="53a8" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne nh ni nj bk">How to express the cost function? <code class="cx qi qj qk ql b">cost = ...</code></li><li id="7f0e" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne nh ni nj bk">How to use constraints expressed through matrices and mathematical operations (that follows DCP) to formulate the whole problem? <code class="cx qi qj qk ql b">destines &lt;= x_shippers...</code></li></ol><p id="a2dd" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">(you can also use Colab for trying it out)</p><p id="6dd9" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="3d24" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="f008" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="bd1a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="7a06" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="7017" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="53f0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="e997" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="79b1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="e876" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="3acd" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="58f2" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="b291" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Here’s one possible solution:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="e500" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Overall it follows the same structure as before. Some notes about the code:</p><ul class=""><li id="f6a2" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl ni nj bk">Now we are optimizing two variables, <code class="cx qi qj qk ql b">x_shippers</code> and <code class="cx qi qj qk ql b">x_transport</code>.</li><li id="e828" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">We use mappers for trains and for linking shippers to their destination. The name of the mappers variables start, by our convention, as the name of the variable in the rows space and then the columns one. For instance, <code class="cx qi qj qk ql b">destine_shippers</code> means that rows represents destines and columns the shippers.<br/>In specific, the result of the line <code class="cx qi qj qk ql b">dest_ships_arr = destine_shippers_map[containers[:, 1]]</code> is a matrix with 4 rows whose lines contains the ships that attend the destinations of the respective containers. To make it more clear:</li></ul><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="pg ph ed pi bh pj"><div class="oq or qv"><img src="../Images/21da9318f47e715e0fee80b97c4aff47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pqQ0bd1KJ8WjiF5_4Fxscg.png"/></div></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">destine_shippers_map matrix transforms the input containers into an array indicating for each container which shippers are appropriate for the transportation. Image by author.</figcaption></figure><p id="14a9" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Mappers allows input data to be used on constraints and the cost function. In the previous example, the optimizer is restricted to only assign shipper 0 to the first container and shipper 1 to the second, for instance. This is implemented as: <code class="cx qi qj qk ql b">constraint02 = x_shippers &lt;= dest_ships_arr</code> .</p><ul class=""><li id="4e08" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl ni nj bk">Similar technique is used in: <code class="cx qi qj qk ql b">constraint11 = cx.sum(x_transports @ train_map.T) &lt;= 2)</code>, the dot matrix operation tracks all transports associated to trains. Final summation is equivalent to all containers that were assigned to trains, which must be lower or equal to 2.</li><li id="71af" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">Constraints receive two numbers (“00” or “10”) for instance. This is to group all constraints for a particular theme. In this example, the first 0 relates to all constraints regarding ships and 1 relates to transport. We do so because if later on we need to increase the number of constraints then we can just add new numbers after “0” and extends the final array.</li></ul><p id="ec6e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Final solution is: <code class="cx qi qj qk ql b">x_shippers = [[1, 0], [0, 0], [1, 0], [0, 1]</code> and <code class="cx qi qj qk ql b">x_transport = [[1, 0], [0, 0], [1, 0], [0, 1]</code> (both equal by coincidence). The optimizer didn’t route the second container as there’s only 3 total spaces on ships. First container goes to shipper 0 by train so does the third and last container goes to shipper 1 by truck.</p><p id="4c19" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Let’s now step it up a notch a bit and increase the challenge now.</p><h2 id="dd31" class="pn nq fq bf nr po pp pq nu pr ps pt nx ms pu pv pw mw px py pz na qa qb qc qd bk">3.3 Complete Example</h2><p id="2c52" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">Let’s use the same example as before but now add another variable: the docks. Now, the factory can transport the containers to two possible available docks. Trains and trucks can reach <em class="ng">Dock 0</em> with costs [$50, $70] and <em class="ng">Dock 1</em> can be reached only by trucks with cost $60. Both shippers attend both docks with same costs.</p><p id="ac07" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">How would you solve this problem?</p><p id="cb03" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">You’ll probably realize that this simple addition of the docks variables make things more challenging. Many attempts to connect docks and transportation leas to <em class="ng">DCPErrors</em>. See if you can find strategies to guarantee their modeling as expected.</p><p id="9295" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="0de7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="f540" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="21e8" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="cd49" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">…</p><p id="fe6d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">….</p><p id="ae0f" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">….</p><p id="9bb9" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">….</p><p id="a35c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">….</p><p id="f792" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">….</p><p id="7de7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">….</p><p id="29be" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">….</p><p id="a9ab" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Did you succeed? Here’s one possible solution:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="db78" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">It’s equivalent to the previous example for the most part. But notice now that we have the AND variables which links the variables docks and transports.</p><p id="9f02" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Main point is: when the optimizer selects a value for <code class="cx qi qj qk ql b">x_transport</code> it ends up affecting the choices available for <code class="cx qi qj qk ql b">x_docks</code>. But when it chooses the dock <strong class="ml fr">it also affects the transport in return!</strong> In order to solve this problem, we implement AND variables such that the optimizer discerns the impact of its decisions at the same time.</p><p id="ccf2" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is implemented first with the y variable: <code class="cx qi qj qk ql b">y_docks_and_transp = cx.Variable((4, 4), boolean=True, name="docks AND transportations")</code>. This variable will be also updated by the optimizer but we’ll force it to be the <code class="cx qi qj qk ql b">AND</code> combination between two other data sources, as we’ll see soon. The technique we used creates a template on columns as a reference, i.e., it combines, in this case, docks and transports:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or qw"><img src="../Images/b69fc16b735bed79ebcd1dddbc187c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*gzVwlVngYPaMU55FsYfL2g.png"/></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">The AND variables used combine two variables, in this case, docks and transports. Image by author.</figcaption></figure><p id="a54a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The columns will be a tree like structure. As in the variable name <code class="cx qi qj qk ql b">"y_docks_and_transp”</code> the first name to appear is <code class="cx qi qj qk ql b">"docks”</code> then it means that docks will be the first reference and then transports will follow, as shown above. Taking the second row as an example, there’s a value “1” at the second column. This means that it selects Dock 0 and Transport 1 (truck).</p><p id="e93f" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With this template we can create other data and constraints that work on both dock and transport variables at the same time. For instance, here’s how we specify costs: <code class="cx qi qj qk ql b">transport_and_dock_costs = np.array([[50, 70, 0, 60]])</code> , which means Dock 0 and Transport 0 (train) costs $50 for instance.</p><p id="32de" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The optimizer can use the template to transpose each x variable to the docks and transportation setting. For doing so, we used the mappers as follows:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="pg ph ed pi bh pj"><div class="oq or qx"><img src="../Images/8874df58b7448fd7c66dc8a8cc12d71e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggwPMOIpkEtm3Ct5uhkgfw.png"/></div></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Left image is the mapping that takes x_transport variable to dock_AND_transp map. On the right, it maps x_docks to docks_AND_transp as well. Image by author.</figcaption></figure><p id="1094" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">If the optimizer chooses transport 0 then it’s mapped to the first row of the left image. Remember that trains do not attend Dock 1 so that’s why it’s a “0” at the third column. Also, notice that the name of the variables also follows a pattern: <code class="cx qi qj qk ql b">transp_dock_transp_map</code> means that rows represent the transports and it maps to the AND conjunction between docks and transports, where docks comes first.</p><p id="94ef" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This is where we use <code class="cx qi qj qk ql b">y_docks_and_transp</code> . When the optimizer changes the <code class="cx qi qj qk ql b">x</code> variables we map it to the domain of docks and transports. But then we need to combine both mappings to know exactly which point corresponds the dock AND the transport variables:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="pg ph ed pi bh pj"><div class="oq or qy"><img src="../Images/df1fd6f7697ef3aa218d18c7eb98f17d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4rrvTpV7Mxx5oZVbm4vPrw.png"/></div></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">The image may seen daunting but it’s quite simple. First we have the x variables and the dot operation (“@”) which maps x to docks and transports domain. We then force an AND operation to find y_docks_and_transps. Image by author.</figcaption></figure><p id="9690" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">As the image above shows, first we transpose the x variables to the dock and transport domain. We then take the results and apply an AND operation to find specifically, for each container, which docker AND transport were chosen:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or qz"><img src="../Images/daa3a7baecd3d0d7526eeac54c141b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*irTVHdCBPJBcA07snlWgcg.png"/></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Result of the AND operation. Image by author.</figcaption></figure><p id="5172" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">First row means the optimizer chose Dock 0 and Train. Second row means it chose Dock 1 and Truck. Notice that as Dock 1 is not connected with Train then third column will never be “1” so this solves the problem of valid connections as well.</p><p id="0aec" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Well, but this is not that simple actually as most attempts to implement this AND operation raises <em class="ng">DCPError</em>. To solve it, we used helper constraints:</p><pre class="ot ou ov ow ox qm ql qn qo ay qp bk"><span id="7cca" class="pn nq fq ql b hw qq qr l im qs">x1 = x_transports @ transp_dock_transp_map<br/>x2 = x_docks @ dock_dock_transp_map</span><span id="a86d" class="pn nq fq ql b hw ra qr l im qs">constraint12 = y_docks_and_transp &gt;= x1 + x2 – 1<br/>constraint13 = y_docks_and_transp &lt;= x1<br/>constraint14 = y_docks_and_transp &lt;= x2<br/>constraint15 = (<br/>    cx.sum(y_docks_and_transp, axis=1) == cx.sum(x_shippers, axis=1)<br/>)</span></pre><p id="6d14" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">By doing so, <code class="cx qi qj qk ql b">y_docks_and_transp</code> is forced to be “1” only at points where <code class="cx qi qj qk ql b">x1</code> AND <code class="cx qi qj qk ql b">x2</code> are “1” as well. This technique can be used when an AND operation is required.<br/><code class="cx qi qj qk ql b">constraint15</code> is a safety clause to guarantee that only routed containers will remain.</p><p id="8aff" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Here’s the final values of x and y:</p><pre class="ot ou ov ow ox qm ql qn qo ay qp bk"><span id="7652" class="pn nq fq ql b hw qq qr l im qs">x_ships = [[1, 0], [0, 0], [1, 0], [0, 1]]<br/>x_transports = [[1, 0], [0, 0], [1, 0], [0, 1]]<br/>x_docks = [[1, 0], [0, 0], [1, 0], [0, 1]]<br/>y_docks_and_transp = [[1, 0, 0, 0], [0, 0, 0, 0], [1, 0, 0, 0], [0, 0, 0, 1]]<!-- -->. </span></pre><p id="b849" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">First container goes to first shipper by train on Dock 0 and second container remained at the factory.</p><p id="1845" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With all the examples and the ideas discussed, we can finally solve the challenge the company offered us. Let’s tackle it down now!</p><h1 id="69f6" class="np nq fq bf nr ns nt gq nu nv nw gt nx ny nz oa ob oc od oe of og oh oi oj ok bk">4. Final Challenge</h1><h2 id="ca64" class="pn nq fq bf nr po pp pq nu pr ps pt nx ms pu pv pw mw px py pz na qa qb qc qd bk">4.1 Input Data</h2><p id="9892" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">We received information about shippers, transportation and their respective freights:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="967a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">From the first table, we obtain that transporting a container from F<em class="ng">actory 0</em> to the dock located at <em class="ng">Santos</em> by R<em class="ng">oad </em>(truck)<em class="ng"> </em>using T<em class="ng">hird Party</em> contract costs <em class="ng">$6000</em>. Also, <em class="ng">Shipper 0</em> can take the container to <em class="ng">Hong Kong</em> through the <em class="ng">Far East</em> trade charging <em class="ng">$8000</em> per container.</p><p id="641a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">As for spaces on shippers, we got something like this:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="332d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Each shipper can attend certain trades (and therefore a group of countries) and the spaces they have on the ship varies on a weekly basis, as depicted by the numbers from 1 to 52.</p><p id="47ab" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">And finally, the list of containers, the factory they were made, its destination and net worth:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="12c6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Notice that the last columns are basically the final result we are looking for. The goal of the algorithm is to find the set of shippers and their transportation minimizing freight costs while following some restrictions.</p><p id="2610" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">We also received another table related to the timings associated to each transportation and shipper but as discussed before it won’t be used in this post.</p><p id="9439" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">This data needs to turn into matrices that we can use later on. This is actually quite simple. Let’s take shippers as an example: when reading the file containing data about shippers, we associate each new shipper to a counter value that keeps increasing as more ships are added in:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or rb"><img src="../Images/90a883b77ed8cd7d84dab80e3c7e522e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*VJywyeYo2nWyI3cwamPWaw.png"/></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Example of how shippers files is read. As new shippers are processed, the counter keeps increasing such that index “0” means shipper 0 and so on. Image by author.</figcaption></figure><p id="1428" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Now we know that on any matrix associated to shipper, if the result is “0” index then it means it refers to “Shipper 0” and so on. Every component in our model (ports, transportation, factories) follows the same idea.</p><p id="3489" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Given the data, let’s see the final solution.</p><h2 id="1e3b" class="pn nq fq bf nr po pp pq nu pr ps pt nx ms pu pv pw mw px py pz na qa qb qc qd bk">4.2 Solution</h2><p id="f4e3" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">We already have the input data. The challenge now, specifically, is: how to route each container by choosing transportation, docks and shippers such that costs are minimized while following the constraints already discussed in this post?</p><p id="1de6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The ideas presented on previous examples were a prelude of what the final solution looks like. Here’s how we solved this problem:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="807c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The function <code class="cx qi qj qk ql b">optimize</code> receives as first parameter <code class="cx qi qj qk ql b">data_models</code> where all data input from the company is processed and transformed into matrices that can be used by <em class="ng">cvxpy</em>. Specifically, the data input <code class="cx qi qj qk ql b">containers</code> is a bit different from previous examples:</p><figure class="ot ou ov ow ox oy oq or paragraph-image"><div class="oq or rc"><img src="../Images/3f8b642078389e35f315f02a01d75a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*aS7EecRGCv9VOaWChlIk4g.png"/></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">Variable containers, first column represents factories, second represents destine and third the value of containers. Image by author.</figcaption></figure><p id="194a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The overall idea though is exactly the same. Points to consider:</p><ul class=""><li id="0825" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl ni nj bk">At line 72 the code <code class="cx qi qj qk ql b">shipper_shipper_trade_arr = x_shippers @ shipper_shipper_and_trade_map.matrix</code> transforms the shippers choices to the domain of shippers and trades. By doing we can sum up the total containers allocated for each trade and shipper.</li><li id="678d" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><code class="cx qi qj qk ql b">constr23</code> is designed to force overbooking if and only if the optimizer already consumed all spaces from shippers before. This is done by translating <code class="cx qi qj qk ql b">x_ob_shippers</code> (“ob” means overbooking) into the shippers and trades domain:</li></ul><figure class="ot ou ov ow ox oy oq or paragraph-image"><div role="button" tabindex="0" class="pg ph ed pi bh pj"><div class="oq or rd"><img src="../Images/198432af76932f202378d54f6ad9b9f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hs0vWjihLWUjM8L2Lr9tqg.png"/></div></div><figcaption class="pa pb pc oq or pd pe bf b bg z dx">The x variable is translated into shippers and trades domain through the “@” (dot) operation. Then the `max` operation is carried over the columns which results in a mapping of which points corresponds to overbooking. Image by author.</figcaption></figure><p id="07d6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk"><code class="cx qi qj qk ql b">shipper_ob_trade_indices</code> works as a mapping for which points are overbooked. We then use this information to install <code class="cx qi qj qk ql b">constr23</code> by saying that shippers at those points must be at maximum capacity. By doing so, we force the rule that overbooking should happen if and only if all regular spaces were already consumed.</p><ul class=""><li id="ad73" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pl ni nj bk">Constraints 3- use the AND technique as discussed on previous examples. This allows us to combine which shipper and dock the optimizer selected so far and use this information to install other constraints and costs.</li><li id="91af" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk"><code class="cx qi qj qk ql b">constr55</code> combines information about docks and transportation linked to factories. It forces the optimizer, through <code class="cx qi qj qk ql b">y_origin_and_transp</code> to choose a dock and transport that connects to the corresponding factory where the container is located.</li><li id="2542" class="mj mk fq ml b go nk mn mo gr nl mq mr ms nm mu mv mw nn my mz na no nc nd ne pl ni nj bk">Cost function is equivalent to what was discussed on previous examples.</li></ul><p id="4427" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">And there we have it. The whole system capable of optimizing distribution of containers throughout the globe. Before delivering the code to the company, we wanted to add a layer of security to have some guarantees it was working as intended.</p><h2 id="16ba" class="pn nq fq bf nr po pp pq nu pr ps pt nx ms pu pv pw mw px py pz na qa qb qc qd bk">4.3 Is It Working?!</h2><p id="b56e" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">To guarantee the code is working, we decided to implement some unit tests by simulating some scenarios. Here’s an example:</p><figure class="ot ou ov ow ox oy"><div class="qf io l ed"><div class="qg qh l"/></div></figure><p id="9dcc" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">It uses Django as the backend of the system was built on top of it. In the example above, the test creates an input data that forces the optimizer to overbook a ship. We then compare results to what is expected to confirm it’s working.</p><p id="2225" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Several tests were implemented to increase the chances that everything is working properly.</p><h1 id="bbd0" class="np nq fq bf nr ns nt gq nu nv nw gt nx ny nz oa ob oc od oe of og oh oi oj ok bk">5. Conclusion</h1><p id="136e" class="pw-post-body-paragraph mj mk fq ml b go ol mn mo gr om mq mr ms on mu mv mw oo my mz na op nc nd ne fj bk">This challenge was quite exciting. At first it wasn’t that straightforward to implement this solution on top of <em class="ng">cvxpy. </em>We probably saw hundreds of times the error <em class="ng">DCPError </em>and it took a while until figuring out the workarounds to the issue.</p><p id="5ad0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">As for results, I guess probably we could say that there’s not even how to compare the previous Solver as implemented in <em class="ng">Excel</em> to the new one built. Even testing the algorithm with thousands of containers the whole processing took a few seconds on a <em class="ng">i5 CPU @ 2.20GHz</em>. On top of that, the solution implemented is already more in-depth than the current solution as cost function and constraints have more items.</p><p id="3687" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Possible downsides is that implementation is also more complex (much more) and to add new constraints the whole code may need changing, which means it’s not that flexible as probably the company would like it to be. Given the advantages still, that was a good trade-off to make.</p><p id="3498" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Well, that was a great experience. Hopefully you learned and enjoyed it as much as we did. It was tough but worth it.</p><p id="adc0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">And, as always, see you <a class="af nf" href="https://open.spotify.com/playlist/6DDVtTmNRo32PUGy3vsRCC" rel="noopener ugc nofollow" target="_blank">next mission</a> ;)!</p></div></div></div></div>    
</body>
</html>