<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>How to use Causal Inference when A/B testing is not available</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>How to use Causal Inference when A/B testing is not available</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-causal-inference-when-a-b-testing-is-not-possible-c87c1252724a?source=collection_archive---------2-----------------------#2024-01-08">https://towardsdatascience.com/how-to-use-causal-inference-when-a-b-testing-is-not-possible-c87c1252724a?source=collection_archive---------2-----------------------#2024-01-08</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="efb1" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Evaluating ad targeting product using causal inference: propensity score matching!</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@chinheng.h.lu?source=post_page---byline--c87c1252724a--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Harry Lu" class="l ep by dd de cx" src="../Images/6a72e9749a83dc335b57efca69ef83d0.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*1ld9qOSHK_PnzSulTtpZ7A.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--c87c1252724a--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@chinheng.h.lu?source=post_page---byline--c87c1252724a--------------------------------" rel="noopener follow">Harry Lu</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--c87c1252724a--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 8, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/4a3674d8fa09b3ec1503ecce3699b120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DRYPGuUHflPZ0a1R"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@techdailyca?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tech Daily</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="386e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Ever caught those pumped-up Nike Ads while tuning in to a podcast recapping last night’s epic NBA showdown? Or how about stumbling upon New Balance ads mid-sneaker review extravaganza on YouTube? That’s the magic of contextual targeting — the matchmaking maestro connecting content and ads based on the vibe of the moment! Say goodbye to ad awkwardness and hello to tailored ad experiences that’ll make you do a happy dance. Picture this: “Would you rather groove to Nike ads in a basketball podcast or spice things up in a politics podcast?”</p><p id="a433" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">As tech giants ramp up their investment in protecting user privacy, the old-school behavior targeting (you know, the one that relies on IP addresses and user devices) might find itself in a sticky situation. With fewer cookies and mysterious IP addresses lurking around, it’s like the wild west out there for traditional targeting!</p><h1 id="1bff" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Measure Contextual Ad Targeting Product</h1><p id="7cc9" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">Let’s spice up the measurement game for contextual products — usually, it’s all about the advertisers. We’re talking about the typical success metrics: advertiser adoption, retention, referrals, and that sweet, sweet ad revenue. But here’s where the plot thickens — my hypothesis is that providing in more relevant ads turns the ad experience into a joyride. Picture this: fewer context switches during ads mean users can enjoy similar context content without missing a beat.</p><p id="bd35" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">However, it’s not easy to run an A/B testing to see how users react to contextual targeting products. Why? When advertisers buy contextual targeting in their ads, it’s not just about contextual targeting — they will use all other targetings in the same campaign, causing that we cannot randomly assign contextual targeting as a treatment. Therefore, randomizing users into two groups is not possible.</p><p id="a0d3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Enter the superhero of alternatives: Causal Inference! When A/B testing is not possible because you can’t shuffle users like a deck of cards, we turn to historical data with causal inference!</p><p id="d235" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In this blog post, I will go over how to evaluate ad targeting products using causal inference. So, buckle up if you:</p><ol class=""><li id="0d8d" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny pa pb pc bk">Navigate a domain where A/B testing is not ready yet — whether its unethical, costly, or downright impossible.</li><li id="750c" class="nd ne fq nf b go pd nh ni gr pe nk nl nm pf no np nq pg ns nt nu ph nw nx ny pa pb pc bk">Tread the thrilling waters of the Ad/Social domain, where the spotlight is on how an ad gets cozy with a specific user and their content.</li></ol><h1 id="48c0" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Hypothesis and Metrics</h1><p id="15cb" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">Its important to design a causal inference research by setting up hypothesis and metrics!</p><p id="21e5" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Hypothesis: </strong>We believe users are more engaged when hearing an ad that was through contextual targeting, and plan to measure it via ad completion rate (the higher the better) and off focus skip (the lower the better)</p><p id="7dde" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Metrics: </strong>We started with Ad Completion Rate, a standard metric that is common in the ad space. However this metric is noisy, and we finally choose Off Focus Skip as our metrics.</p><p id="d360" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Our Experiment Unit: </strong>90 days of users that was either (Filtered-out users that received both treatment ad and control ad). Worth mentioning that we also tried on impressions level. We did both.</p><p id="a676" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Population: </strong>We collected 90 windows of users/impressions.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pi"><img src="../Images/42e5ccf4d70dbfc1e4d2b8a291ad9c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3yz1lHYmDxmQSmSc"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@eddiepipocas?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Eddie Pipocas</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="138f" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Use Propensity Score Match (PSM)</h1><p id="7643" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">We will use Propensity Score Match in this research as we have two groups of samples that we just need to synthesize some randomization. You can read more about PSM in <a class="af nc" href="https://en.wikipedia.org/wiki/Propensity_score_matching" rel="noopener ugc nofollow" target="_blank">here</a>, and my summary on PSM is: let’s tell our samples to find pairs between control and treatments, and then we measure the average delta between each pair to attribute any difference we find to the treatment. So let’s start to prepare the ingredients for our PSM model!</p><h1 id="e2be" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Step 1: Determine Causal Relationship</h1><p id="a0db" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">There are many things that could impact users’ ad experience, and here are the three categories:</p><ol class=""><li id="d214" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny pa pb pc bk">User Attribute (ie., Age / Gender / LHR)</li><li id="245f" class="nd ne fq nf b go pd nh ni gr pe nk nl nm pf no np nq pg ns nt nu ph nw nx ny pa pb pc bk">Advertiser Attribute (ie., Company Past Ad Spending)</li><li id="cd2a" class="nd ne fq nf b go pd nh ni gr pe nk nl nm pf no np nq pg ns nt nu ph nw nx ny pa pb pc bk">Publisher Attribute (ie., Company Past Ad Revenue / Content Metadata)</li></ol><p id="4312" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We believe controlling these above isolates the treatment effect to contextual targeted ads vs non-contextual-targeted ads. Below is a sample data frame to help understand what the data could look like!</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pj"><img src="../Images/b9f45ededaf7ca814e2b9a85e689f121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLXI6Lv-ETAcv_5qJsRLTw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by the author: user attribute, treatment, and user engagement (y)</figcaption></figure><h1 id="e0bb" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Step 2: Assign users a matching score</h1><p id="28fb" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">Using logistic regression for example, when the treatment (exposure) status is regressed on observed characteristics (covariates), we will get a predictive value for how possible if a user is in treatment. This number is how we then match each pair between treatment and control. Note that you could also use other classifiers of your choice! In the end, what you need to do is to use your classifier to label your users, so we can match them accordingly in the next steps.</p><blockquote class="pk pl pm"><p id="b3c9" class="nd ne pn nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Y = Treatment [0, 1]<br/>X = User Attributes + Advertiser Attributes + Publisher Attributes</p></blockquote><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk po"><img src="../Images/83a886f2e1820c326aafa775821595af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IP_RD73QFJk6SrzhRX8z1g.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by the author: the dataframe now has a new field ps_score from our classifier model.</figcaption></figure><p id="4a03" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">If we pull the distributions of PS Score for two groups, we will see two overlapping distributions as my drawing show below. The PS score distribution will likely look different in the two groups and that is expected! What we want to compare Apple-to-Apple is the “matched” area.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pp"><img src="../Images/c2aa9a5e253e0a6e2d6acbc38e05891d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXI7ET3jGeAADl0ON08EjQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by the author: distributions of ps score between treatment and control groups.</figcaption></figure><h1 id="d773" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Step 3: Match the treatment and control groups</h1><p id="19ba" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">As we assign the users their propensity score, we will then match the pairs between the treatment and control groups. In the example here, we start to see pairs being formed. Our sample size will also start to change as some samples may not find a match. (PS. use the <a class="af nc" href="https://pypi.org/project/psmpy/" rel="noopener ugc nofollow" target="_blank">psmpy</a> package if you are in a python environment.)</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pq"><img src="../Images/94f6532f5650f89a0689b9379a619125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fkm3Hq_Y6d7YBFvJd9P-xw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by the author: the data fame has a new column suggesting the pairing between treatment and control groups.</figcaption></figure><p id="92e3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">When we matched the two groups, the two groups’ user-attributes will start to look similar than before! That is because the users that could not be matched are removed from my two groups.</p><h1 id="2ed5" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Steps 4: Measure the treatment effect from matched groups</h1><p id="07bb" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">Now we have matched them based on the PS, we can start our measurement work! The main calculation is essentially below:</p><blockquote class="pk pl pm"><p id="07c0" class="nd ne pn nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">MEAN(Treatment Group Y var) — MEAN(Control Group Y var) = Treatment Effect</p></blockquote><p id="12ed" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We will have a treatment effect data that we could test on statistical significance and practical significance. By pairing up the ducks to calculating the average delta of each pair, we measure the treatment effect.</p><h1 id="430a" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Step 5: Sanity Check the result via an AA Test</h1><p id="3f9e" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">So if everything is set correctly so far, we have measured the treatment effects from the two groups. But it is critical to know that causal inference takes more risk on missing confounding variables or any other potential cause that we did not realize. So to further validate our research, let’s run an AA test!</p><p id="3cb7" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">An AA Test is a test where instead of using the true treatment, we randomly assign “fake” treatment to our data, and conduct the causal inference again. Because it is a fake treatment, we should not detect any treatment effect! Running an AA Test provide good code-review and also ensure our process minimize the bias (when true treatment effect is 0, we detect 0)</p><p id="0aa2" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Once we complete our AA Test without detecting a treatment effect, we are ready to communicate the insight with engineering / product management! For my project, I ended up publishing my work and shared on a company-wide insight forum about the first causal inference work to measure Spotify podcast ad targeting.</p><h1 id="3061" class="nz oa fq bf ob oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Conclusion / Summary</h1><p id="2c7d" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk">This blog post explains every step of causal inference to evaluate an Ad Targeting product that is hard to experiment due to limitations in randomization. From how to determine the causal relationship, assign users propensity match score, match the users and calculate the treatment effect, to sanity check the result. I hope you find this article helpful and let me know if you have any questions!</p><p id="e554" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">PS. While due to confidentiality, I am not allowed to share the test result for specifically Spotify’s Contextual Targeting Product, you could still use this blog to build up your causal inference!</p></div></div></div><div class="ab cb pr ps pt pu" role="separator"><span class="pv by bm pw px py"/><span class="pv by bm pw px py"/><span class="pv by bm pw px"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="e65e" class="nz oa fq bf ob oc pz gq oe of qa gt oh oi qb ok ol om qc oo op oq qd os ot ou bk">About me:</h1><p id="4978" class="pw-post-body-paragraph nd ne fq nf b go ov nh ni gr ow nk nl nm ox no np nq oy ns nt nu oz nw nx ny fj bk"><strong class="nf fr">Harry Lu (</strong><a class="af nc" href="https://www.linkedin.com/in/chinhengharrylu/" rel="noopener ugc nofollow" target="_blank"><strong class="nf fr">Linkedin</strong></a><strong class="nf fr"> / </strong><a class="af nc" href="https://www.instagram.com/chinhenglu/" rel="noopener ugc nofollow" target="_blank"><strong class="nf fr">Instagram</strong></a><strong class="nf fr"> / &gt;&gt; </strong><a class="af nc" href="https://www.instagram.com/quittinginnewyork/" rel="noopener ugc nofollow" target="_blank"><strong class="nf fr">Podcast Page</strong></a><strong class="nf fr"> &lt;&lt;/ </strong><a class="af nc" href="https://www.youtube.com/@quittinginnewyork7660" rel="noopener ugc nofollow" target="_blank"><strong class="nf fr">Youtube</strong></a><strong class="nf fr">)<br/></strong>Experienced Data Scientist in ML, statistical modeling, and product aecision-making. Specialized in ad tech, monetization, and contextual targeting products. Known for comprehensive data landscape understanding, leadership, and strategic thinking. Active contributor to the data science community, delivering talks, workshops, and consulting on master’s theses. Featured on The Data Standard podcast.</p></div></div></div></div>    
</body>
</html>