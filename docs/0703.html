<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Visualize a Business Process Through Data Serialization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Visualize a Business Process Through Data Serialization</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualize-a-business-process-through-data-serialization-772cd9510c31?source=collection_archive---------4-----------------------#2024-03-15">https://towardsdatascience.com/visualize-a-business-process-through-data-serialization-772cd9510c31?source=collection_archive---------4-----------------------#2024-03-15</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="5b94" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx"><em class="hd">Sometimes, we want to visualize a business process in Power BI. This is challenging, depending on the visualization needed and when we model our data in the usual way. Let’s see how we can make it happen by changing the modeling.</em></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@salvatorecagliari?source=post_page---byline--772cd9510c31--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Salvatore Cagliari" class="l ep by dd de cx" src="../Images/a24b0cefab6e707cfee06cde9e857559.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/da:true/resize:fill:88:88/0*pOkUYGxmbbFyWocH"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--772cd9510c31--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://medium.com/@salvatorecagliari?source=post_page---byline--772cd9510c31--------------------------------" rel="noopener follow">Salvatore Cagliari</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--772cd9510c31--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">11 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Mar 15, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk lb lc ab q ee ld le" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap ie li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/22db2a16d53f8700de706c762587112a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-x7QAT3aEgVTwxLL"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@goumbik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lukas Blazek</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="6216" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Introduction</h1><p id="5f07" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Our Business is made up of processes. Some are obvious, like a production process, and others are more virtual.</p><p id="470d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">For example, when I want to calculate the Margin, there is a “process” to do it.</p><p id="968d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In a very simplistic way, when I take my income and subtract my expenses, what’s remaining is my margin.</p><p id="ea71" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">My current target is to visualize this process in a chart.</p><p id="975a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The chart should display the composition of the Margin as a Process. For this, I like to show the values from the Sales Amount to the Margin as a Waterfall.</p><p id="5e6b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Something like this Mockup, which I created in Excel:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pa"><img src="../Images/5aa82746a44574f63a1beb6b8595cb1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*mkcfohFrMK9PKbFAxqvo6A.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 1 — Target Visualization of the composition of my Margin (Figure by the Author)</figcaption></figure><p id="d443" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I start with the Sales Amount, and all expenses will be deducted until I get the Margin.</p><p id="bf6a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">There are some challenges to realizing this in Power BI.</p><p id="0aff" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">First, I must change my data model. Then, I can write a few Measures. Finally, I can create the visualization.</p><p id="7066" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Ultimately, I will collect information about the data model and its performance to assess the quality of my approach.</p><p id="c2ec" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Let’s go through these steps.</p><h1 id="a916" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Data Challenge</h1><p id="327d" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Firstly, the Standard Waterfall chart doesn’t allow for the addition of multiple measures to build this chart.</p><p id="b4a4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">At least one custom visual can do this, but it’s a paid visual, and I want to go with the standard waterfall visual. The majority of my clients are reluctant to buy custom visuals.</p><p id="5aa4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">So, I need to change how the data is stored to complete the job.</p><p id="fe40" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Usually, we store our data with one Value per column.</p><p id="0077" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Something like this:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pb"><img src="../Images/57fd4a92340a2c92cabb0101c1ebcf3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*_CK6fPKVbBNs3h2duu3AxA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 2 — Standard way of modeling facts (Transactions) (Figure by the Author)</figcaption></figure><p id="3ca3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I create different DAX measures to aggregate the columns to get the result.</p><p id="f5a5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Ultimately, I can calculate the Margin by deducing the expenditures from the Sales Amount to calculate the Margin.</p><p id="f06d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">However, this approach doesn’t solve my problem. Therefore I need to use a different data modeling approach for the waterfall chart.</p><p id="7058" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I can add only one Measure to the visual. For the segments in the Waterfall chart, I must add a column for the categorization/segmentation of the data.</p><p id="96a1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To achieve this, I must Unpivot the data to store the single Measure values vertically in one Value column. The Measure Name is stored in a separate column to contain the categorization information.</p><p id="2211" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Something like this:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pc"><img src="../Images/373edf1d6fe7a7c7e39cb45c9ccd8cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*-9SNH6_NuYqCeaMnkRCDxA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 3 — Unpivoted (Serialized) data (Figure by the Author)</figcaption></figure><p id="7e49" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This modeling technique is called “Serialization”, as the data is serialized vertically instead of horizontally.</p><p id="852e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">There is still one catch: All the values are positive. However, I must turn some of them into negative values when displaying them in the waterfall chart to deduce them from the sales amount.</p><p id="a483" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Moreover, the order of the Measures must be in the correct order to make sure they are not displayed in alphabetical order.</p><p id="38ad" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To achieve this, I create a table with my Measures like this:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pd"><img src="../Images/60b983f71c8eac1f07c1b29b00ad4ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*Wbwv17Xd36y-1SqGNFfAfA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 4 — Measure-List table (Figure by the Author)</figcaption></figure><p id="03ca" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">If your source is a relational database, I recommend creating this table and transforming your data there.</p><p id="9242" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As the exact way of doing it in a database can vary from one platform to another and from the type of data modeling to another, I will not show this here. Contact your database developer for this.</p><p id="1235" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I will show you how to do it in Power Query and DAX in this piece.</p><h1 id="08e1" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Data re-modeling in Power Query</h1><p id="6d64" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">The first steps are straightforward in Power Query:</p><p id="8257" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I use the Unpivot transformation to switch from column- to row-oriented and get the result, as shown in my example above.</p><p id="3335" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I select all columns with values (Measure-columns) and click the Unpivot button. There, I choose “Unpivot only selected columns”:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pe"><img src="../Images/20e5bbb179fb569f21ee5fd3ca82ab76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Dq6QXLyfSBjOJKKtgvURA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 5 — Unpivot all Measure-columns (Figure by the Author)</figcaption></figure><p id="9e81" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">After some time (Depending on the amount of data and the source), the Measure columns are replaced by two new columns: Attribute and Value.</p><p id="bec8" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I change the M-Code to rename the “Attribute” column to “Measure”:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pf"><img src="../Images/d2fbbab919a66ac0134f55c4f3fb99d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pLc-3gdms5N2xRTcvgIdA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 6 — Change the name of the Attribute columns (Figure by the Author)</figcaption></figure><p id="bb0d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To see the formula bar in Power Query, you must enable the following option:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pg"><img src="../Images/db9f265141cd40547006cbd8e10ad46b.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*LotFz-KC6R3EB6Xi6VWO-g.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 7 — Enable the formula bar in Power Query (Figure by the Author)</figcaption></figure><p id="5c7d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As my model with the Contoso demo data contains two fact tables (Online and Retail Sales), I repeat these steps with the other table.</p><p id="4aa3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Next, I create the table with the list of all Measures.</p><p id="e940" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I right-click on the Online Sales table and click on “Reference”. I create a reference, as it reuses the data already read from the source. “Duplicate” would re-read the complete table from the source, which is unnecessary.</p><p id="1550" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">A new table is added to Power Query.</p><p id="6c65" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I rename this table to “MeasureList”.</p><p id="9e7e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I need only the Measure column. Therefore, I right-click on the Measure column and click on “Remove other columns”:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk ph"><img src="../Images/d6eca80e4a3fd6a073c36880a0ba7a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*c08kq8viwXFvI0hjtHAjAQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 8 — Remove all columns from the referenced table (Figure by the Author)</figcaption></figure><p id="8726" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I repeat the same steps for the Retail Sales table. But this time, I rename the table to “Retail Measures”.</p><p id="3097" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This table will be appended to the MeasureList table. So, I turn off the Load of this table:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pi"><img src="../Images/ca5651a25d3e8260e630d2efae94feab.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*WW-yTLmtchub1KViEpI-YQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 9 — Disable the load into Power BI for the second referenced table (Figure by the Author)</figcaption></figure><p id="d555" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now I append the second referenced table to the table “MeasureList”:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pj"><img src="../Images/9960dd5ec93cb9cfe140382f6bd1fb06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcPAb3Hwfjs5dJCm1uousQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 10 — Append the second table to the “MeasureList” table (Figure by the Author)</figcaption></figure><p id="87c2" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I select the second table, “Retail Measures”, in the following dialog box.</p><p id="5d5b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The last step here is to remove the Duplicates from the resulting table:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pk"><img src="../Images/d22cedb4e0653cf63e2e57f66e629585.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*QTY-zLDB1GDa_qz2MX9Y6w.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 11 — Remove the duplicates from the “MeasureList” table (Figure by the Author)</figcaption></figure><p id="51cb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The result is the combined list of all Measures from both tables:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pl"><img src="../Images/ad7f0ddba2cec1724bb02f395b1480b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*6w1zUAJZz94YbQaC1YIlYg.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 12 — Resulting “MeasureList” table (Figure by the Author)</figcaption></figure><p id="9c72" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now, I must add a conditional column to add the MeasureSort column:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pm"><img src="../Images/6462d5afd47cd09cd9c387bee35cfe4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wK192mM40KwJvtWrv9R8Iw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 13 — Add a Conditional column to create the MeasureOrder (Figure by the Author)</figcaption></figure><p id="70df" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The order for all Measures is the following:</p><ul class=""><li id="9a73" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pn po pp bk">“SalesAmount”: 1</li><li id="2385" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“SalesQuantity”: 2</li><li id="5b92" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“ReturnAmount”: 3</li><li id="4e7e" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“ReturnQuantity”: 4</li><li id="613d" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“UnitPrice”: 5</li><li id="cfec" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“TotalCost”: 6</li><li id="1e70" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“UnitCost”: 7</li><li id="e119" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“DiscountAmount”: 8</li><li id="4c44" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">“DiscountQuantity”: 9</li></ul><p id="5f45" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In my case, Power Query needs a lot of time to get all the data.</p><p id="0beb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The reason is that I get two huge tables from the operations done.</p><p id="d2e7" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Let’s do some math:</p><p id="e55b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Online Sales table has 12 million rows multiplied by nine Measure columns, and I get over 108 million rows.</p><p id="b49a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Retail Sales table has almost 3.5 million rows. Multiplied by nine, I get 31.5 million rows.</p><p id="a642" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I will return to these numbers later when we look at this model’s statistics and performance.</p><p id="8d78" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Therefore, I calculate the column Factor in DAX to save time.</p><p id="a7db" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I would have added a further Conditional column with the logic to set the correct values in Power Query, but I did not do it to save time.</p><h1 id="7d6f" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Add the calculated column in DAX</h1><p id="4d78" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I add the Factor column to the new MeasaureList table as a calculated column in Power BI.</p><p id="ee66" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As I have only two possible values, I use <a class="af nc" href="https://dax.guide/if/" rel="noopener ugc nofollow" target="_blank">IF()</a> to calculate the result:</p><pre class="mm mn mo mp mq pv pw px bp py bb bk"><span id="02e2" class="pz ne fq pw b bg qa qb l qc qd">Factor = IF('MeasureList'[Measure] IN {"SalesAmount", "SalesQuantity", "UnitPrice"}, 1, -1)</span></pre><p id="94e1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">After hiding the MeasureOrder column, the MeasureList table looks like this now:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qe"><img src="../Images/c570ea3275ca1f52ab18ce0d9404bf59.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*7LvxiiX-DoLo_XljxvPXww.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 14 — Completed “MeasureList” table (Figure by the Author)</figcaption></figure><p id="958b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now, I must set the “Sort by Column” for the Measure column to the MeasureOrder column:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qf"><img src="../Images/0708876c223a9f73bd51f0eab31bbe42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*ZNXNC9oYi9VT8k1-Bxunhw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 15 — Set the Order by the MeasureOrder column (Figure by the Author)</figcaption></figure><p id="b980" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Next, I add Relationships from the “MeasureList” table to the table Online Sales and Retail Sales.<br/>I Hide the Measure columns from both Fact tables.</p><p id="ed18" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I add two Base Measures to summarize the Value columns from both Fact tables:</p><pre class="mm mn mo mp mq pv pw px bp py bb bk"><span id="2200" class="pz ne fq pw b bg qa qb l qc qd">Sum Online Value = SUM('Online Sales'[Value])</span></pre><p id="d247" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I must change all Measures, which accessed the separate Measure columns, to a Measure, which filters the Measure.</p><p id="09fb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Something like this:</p><pre class="mm mn mo mp mq pv pw px bp py bb bk"><span id="a956" class="pz ne fq pw b bg qa qb l qc qd">Online Sales = CALCULATE([Sum Online Value])<br/>                        ,'MeasureList'[Measure] = "SalesAmount"<br/>                        )</span></pre><p id="79c1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But, to calculate the correct value for the Waterfall chart, I need to include the Factor by Measure in my final Measure:</p><pre class="mm mn mo mp mq pv pw px bp py bb bk"><span id="a528" class="pz ne fq pw b bg qa qb l qc qd">Value with Factor =<br/>  VAR Factor = SELECTEDVALUE('MeasureList'[Factor])<br/>RETURN<br/>  [Sum Online Value] * Factor</span></pre><p id="c8e7" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now we can create the Waterfall Visualization.</p><h1 id="eb2e" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Visualization</h1><p id="7bc3" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I add the Waterfall Visual to a new Report page.</p><p id="2429" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I set the Measure [Value with Factor] for the Y-Axis and the Measure column from the MeasureList table as Category:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qg"><img src="../Images/96a1b28d8d49179195c425babb3bd8e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*gPDUu2WaOEmTBSn4p7QaPw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 16 — Set up the Waterfall chart (Figure by the Author)</figcaption></figure><p id="7443" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But now, we see all the Measures in the “MeasureList” table.</p><p id="9f18" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As I want to see only a subset of them, I use the Filter pane to narrow down to the needed Measures:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qh"><img src="../Images/59aa555be8abea65a2d014360f5193f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:328/format:webp/1*oju5-UiI4h8MepN_3pWnMw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 17 — Set the Filters for the Waterfall Visual (Figure by the Author)</figcaption></figure><p id="0218" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">After adding a Slicer for the Calendar year to filter for the year 2008 and sorting the chart by the Measure name, I got the result I wanted (After enabling the Data labels and removing the axis legends, etc.):</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qi"><img src="../Images/d651ca9f774e5d283a2882f7ae6ce579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1tYvtIR5sHIjBI_wKxLCAQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 18 — Completed Waterfall chart (Figure by the Author)</figcaption></figure><p id="b198" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This is almost what I expected.</p><p id="fba3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Unfortunately, renaming the Total column to, for example, “Margin” is impossible.</p><p id="2e8a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I tried adding a Text box with the word “Margin” on top of the word “Total”. But first, it is a tedious task (I must match the font, the font size, and the color, and I have to put it in the correct position). Second, when a User clicks on the waterfall visual, it automatically switches to the front, hiding the Text box.</p><p id="549e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Alternatively, I write a good title to ensure the users understand what they see.</p><h1 id="a409" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Let’s talk about statistics</h1><p id="7684" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Before we shout, “Yes, this solves all my problems. I will do it only in this way from now on!” Let’s look at some statistics and performance numbers.</p><p id="4400" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I use Vertipaq Analyzer to analyze the statistics on the original and modified data models.</p><p id="77d4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">First, the difference in the size of the saved pbix files is not that much:</p><ul class=""><li id="07c4" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pn po pp bk">290 MB for the Original</li><li id="8c1b" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">340 MB for the modified model</li></ul><p id="7371" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But, when I look at the In-memory size from Vertipaq Analyzes, I get different numbers:</p><ul class=""><li id="aa99" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pn po pp bk">350 MB for the Original</li><li id="20db" class="nz oa fq ob b go pq od oe gr pr og oh oi ps ok ol om pt oo op oq pu os ot ou pn po pp bk">950 MB for the modified model</li></ul><p id="37ab" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Memory usage has almost tripled.</p><p id="b171" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This indicates that the data cannot be compressed as well as before.</p><p id="c477" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">And, when we look at the table statistics, we see what happens:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qj"><img src="../Images/6aa6e7295fdf8b967a0861ccb31956de.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*T_UsruPfgUM7St1-fZ0B4g.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 19 — Table statistics from both models (Figure by the Author)</figcaption></figure><p id="f359" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">On top of the picture, you see the statistics of the original model, and below, you see the modified model.</p><p id="b23f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As shown before, the row number is multiplied by the number of Measure columns.</p><p id="c473" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But the size of the tables is almost four times larger.</p><p id="87f8" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">When I dig deeper into the data, I can see that the Value columns use a lot more memory, but the Sales Order Number, Sales Order Number, and the ProductKey columns of the Online Sales table use 42.5 % of the entire database. This percentage was much lower before changing the data modeling.</p><p id="f854" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I can try to change the table’s order. However, Power BI usually makes a good decision after analyzing the data and deciding which column to sort the data by to achieve the best compression.</p><p id="695c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">It takes almost an hour to reload these two tables, so I will not do it now.</p><p id="60a9" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I will possibly do it in the future and publish the results here.</p><p id="072a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But first, let’s do some performance measurements.</p><p id="dd70" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I use <a class="af nc" href="https://www.sqlbi.com/tools/dax-studio/" rel="noopener ugc nofollow" target="_blank">DAX Studio</a> and the method described here to get performance data:</p><div class="qk ql qm qn qo qp"><a rel="noopener follow" target="_blank" href="/how-to-get-performance-data-from-power-bi-with-dax-studio-b7f11b9dd9f9?source=post_page-----772cd9510c31--------------------------------"><div class="qq ab ih"><div class="qr ab co cb qs qt"><h2 class="bf fr hx z ip qu ir is qv iu iw fp bk">How to get performance data from Power BI with DAX Studio</h2><div class="qw l"><h3 class="bf b hx z ip qu ir is qv iu iw dx">Sometimes we have a slow Report, and we need to figure out why. We will see how to collect performance data and the…</h3></div><div class="qx l"><p class="bf b dy z ip qu ir is qv iu iw dx">towardsdatascience.com</p></div></div><div class="qy l"><div class="qz l ra rb rc qy rd lr qp"/></div></div></a></div><p id="89a9" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The first test is to compare the Online Sales amount:</p><p id="3363" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I get the query from a Visual showing the Sales Amount by Year and month.</p><p id="2ce3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The execution statistics for the original data model are:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk re"><img src="../Images/b7ae03ef74a0b612c3e79102fe38124f.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*iPL8HV6ilzyHNNL-rCpgEw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 20 — Simple Sales Amount calculation (Original) (Figure by the Author)</figcaption></figure><p id="5087" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Here are the execution statistics for the modified data model:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rf"><img src="../Images/1822523eb2f7a46275c3ced4e36b7f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:272/format:webp/1*7Jjo4snPYi9iK1-ig4NDug.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 21 — Simple Sales Amount calculation (Modified data model) (Figure by the Author)</figcaption></figure><p id="b621" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you can see, the Total time is considerably higher. When we look at the SE numbers, we see that the parallelism is much lower than before, which indicates that the model is less efficient.</p><p id="c111" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now, I add more Measures. For example, the Margin, PY, YoY change, and some more:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rg"><img src="../Images/79b07fd95c24f15f12898965f2585e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:274/format:webp/1*nsysRL_Rgrg9PKdIGmDnsQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 22 — Multiple Measure calculation (Original) (Figure by the Author)</figcaption></figure><p id="7c41" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Here for the modified data model:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rf"><img src="../Images/12fd3a68cd5c425f209abe5986e53337.png" data-original-src="https://miro.medium.com/v2/resize:fit:272/format:webp/1*NULwQ-zl4zlCoFRrq6-uAQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 23 — Multiple Measure calculation (Modified data model) (Figure by the Author)</figcaption></figure><p id="b43f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you can see, the performance difference between the two data models is again huge.</p><p id="5777" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">And these are very simple calculations.</p><p id="a87e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The difference is much higher when I look at more complex calculations. I observed 3–4 times worse performance.</p><h1 id="ea4f" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Conclusion</h1><p id="aeed" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">While this approach opens several possibilities, I would only recommend using it for some specific scenarios.</p><p id="bbaa" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I suggest using it only when fulfilling a requirement is impossible with a standard model.</p><p id="47ce" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The risk for performance degradation is tangible and cannot be ignored.</p><p id="2092" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Don’t be fooled by the thinking: “I have only a few thousand rows of data.”</p><p id="11e5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In my experience, the amount of data is irrelevant in Power BI.<br/> More important is the number of distinct values in the data. Otherwise called “Cardinality”.</p><p id="c405" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Let’s look at the column Order number.<br/>Each order has a different Order number. So, the cardinality is very high, and this column cannot be compressed efficiently.</p><p id="5ff9" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Then, a complex calculation can lead to poor performance even with a few thousand rows.</p><p id="e690" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Consequently, each situation is different and must be tested accordingly.</p><p id="3222" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Anyway, this route is sometimes necessary to allow charts like the one requested in my case.</p><p id="8183" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">One of my clients has data over which he wants to create two Waterfall charts like the one shown above.</p><p id="ff5e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">However, the two tables involved in his business case have 25 Measure columns, which would mean a 25fold increase in data rows.</p><p id="60e3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In that case, he needs two waterfall charts for eight Measures. I will leave the original table and duplicate only the required data to create the requested charts.</p><p id="7211" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Therefore, all “normal” calculations will perform as usual while being able to fulfill his requirements.</p><p id="877f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Another positive reason to do it this way is that I can combine (Append in Power Query) the fact tables into one table. In such a case, I would add a column with the source, for example, “Online Sales” and “Retail Sales”, before combining them into one table. This can lead to a simpler data model.</p><p id="6afd" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But as we know now, we need to test, repeat, and test again with other scenarios, etc., until we know the consequences of this modeling approach.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rh"><img src="../Images/9de8d0e476c140781b8400f034dfb6f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iOYtXygWjDVKMdEB"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@jxk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jan Kopřiva</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="8cc7" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">References</h1><p id="c009" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I use the Contoso sample dataset, as I did in my previous articles. You can download the ContosoRetailDW Dataset for free from Microsoft <a class="af nc" href="https://www.microsoft.com/en-us/download/details.aspx?id=18279" rel="noopener ugc nofollow" target="_blank">here</a>.</p><p id="1bee" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Contoso Data can be freely used under the MIT License, as described <a class="af nc" href="https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo" rel="noopener ugc nofollow" target="_blank">here</a>.</p><div class="qk ql qm qn qo qp"><a href="https://medium.com/subscribe/@salvatorecagliari?source=post_page-----772cd9510c31--------------------------------" rel="noopener follow" target="_blank"><div class="qq ab ih"><div class="qr ab co cb qs qt"><h2 class="bf fr hx z ip qu ir is qv iu iw fp bk">Get an email whenever Salvatore Cagliari publishes.</h2><div class="qw l"><h3 class="bf b hx z ip qu ir is qv iu iw dx">Get an email whenever Salvatore Cagliari publishes. By signing up, you will create a Medium account if you don't…</h3></div><div class="qx l"><p class="bf b dy z ip qu ir is qv iu iw dx">medium.com</p></div></div><div class="qy l"><div class="ri l ra rb rc qy rd lr qp"/></div></div></a></div><p id="b396" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I make my articles accessible to everyone, even though Medium has a paywall. This allows me to earn a little for each reader, but I turn it off so you can read my pieces without cost.</p><p id="f840" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You can support my work, which I do during my free time, through</p><p id="0600" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><a class="af nc" href="https://buymeacoffee.com/salvatorecagliari" rel="noopener ugc nofollow" target="_blank">https://buymeacoffee.com/salvatorecagliari</a></p><p id="b4ff" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Or scan this QR Code:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rj"><img src="../Images/e7ac062070dcd7a00dcf995ad7e95434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btH95UXO7gboS30eZMk6ug.png"/></div></figure><p id="83c4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Any support is greatly appreciated and helps me find more time to create more content for you.</p><p id="0e1f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Thank you a lot.</p></div></div></div></div>    
</body>
</html>