<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Supercharged Pandas: Tracing Dependencies with a Novel Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Supercharged Pandas: Tracing Dependencies with a Novel Approach</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/supercharged-pandas-tracing-dependencies-with-a-novel-approach-120b9567f098?source=collection_archive---------5-----------------------#2024-03-11">https://towardsdatascience.com/supercharged-pandas-tracing-dependencies-with-a-novel-approach-120b9567f098?source=collection_archive---------5-----------------------#2024-03-11</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="7ea6" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">An object-oriented approach to manage multiple files and dataframes, and tracing dependencies.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://jiweiliew.medium.com/?source=post_page---byline--120b9567f098--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Ji Wei Liew" class="l ep by dd de cx" src="../Images/f1b7267530b9a97106e6464b7b45ed85.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*k1rSCeBFZ01jYBSeKuaGzA.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--120b9567f098--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://jiweiliew.medium.com/?source=post_page---byline--120b9567f098--------------------------------" rel="noopener follow">Ji Wei Liew</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--120b9567f098--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Mar 11, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk ml"><img src="../Images/ffb40d7bb751829cffac88c7ba2def2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*4267DNF-qTSiOAirBpevOg.jpeg"/></div><figcaption class="mt mu mv mj mk mw mx bf b bg z dx">Photo by <a class="af my" href="https://unsplash.com/@sibelle?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener ugc nofollow" target="_blank">Sibel Yıldırım</a> on <a class="af my" href="https://unsplash.com/photos/red-maple-leaf-and-eyeglasses-with-black-frames-on-white-bookpage-J6YInqMXD6c?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="6f6d" class="mz na fq bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">How will this benefit you:</h2><p id="1c99" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">This article describes an object-oriented approach for data analysis. It outlines 2 novel approaches: (a) reduce repetitive file reads by assigning dataframes to the attributes of the <code class="cx oq or os ot b">Reports</code> object, and (b) trace dependent methods recursively to construct attributes. These approaches have allowed me to be highly productive in what I do and I hope that you will reap similar benefits.</p><h2 id="73f5" class="mz na fq bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk"><em class="ou">Who should read this:</em></h2><ul class=""><li id="598b" class="nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op ov ow ox bk">You have to analyze the same data set over a long period of time.</li><li id="f0eb" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">You need to build reports by combining data from different sources and prepare statistics.</li><li id="2408" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">You have co-workers who tend to ask you, “How did you arrive at this data?” and you cannot recall the N steps in Excel that you took to prepare the report.</li><li id="55cc" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">You have been using pandas for a while and you suspect that there is a more efficient way of doing things.</li></ul><h2 id="676e" class="mz na fq bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">What’s in this article?</h2><ul class=""><li id="be25" class="nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op ov ow ox bk">Monolithic script: how it begins</li><li id="4656" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">Reusable functions: how it progresses</li><li id="a425" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">Objects, methods and attributes: how it evolves</li><li id="2f93" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">Tracing upstream dependencies: a novel approach</li></ul><h2 id="8b81" class="mz na fq bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Preamble</h2><p id="e4c3" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">It is rather difficult to explain what I am trying to do, so please bear with me if the first half of this article doesn’t make sense. I promise that towards the end, it will be all worth it.</p><h1 id="3dee" class="pd na fq bf nb pe pf gq nf pg ph gt nj pi pj pk pl pm pn po pp pq pr ps pt pu bk">Monolithic script: how it begins</h1><p id="3bf6" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">Suppose you have 3 csv files: <code class="cx oq or os ot b">file1.csv</code>, <code class="cx oq or os ot b">file2.csv</code>, <code class="cx oq or os ot b">file3.csv</code>. You write some code to read each one of them, and then merge them in a particular order.</p><pre class="mm mn mo mp mq pv ot pw bp px bb bk"><span id="532a" class="py na fq ot b bg pz qa l qb qc">df1 = pd.read_csv('file1.csv')<br/>df2 = pd.read_csv('file2.csv')<br/>df3 = pd.read_csv('file3.csv')<br/><br/>df1_2 = pd.merge(df1, df2, on='a', how='left')<br/>df1_2_3 = pd.merge(df1_2, df3, on='b', how='inner')</span></pre><p id="956a" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">This works perfect, and you get on with life. Next, your boss gives you <code class="cx oq or os ot b">file4.csv</code> which is supposed to be merged with <code class="cx oq or os ot b">file1.csv</code> to build a separate report. No issues, you know the drill, you update the code:</p><pre class="mm mn mo mp mq pv ot pw bp px bb bk"><span id="e7b0" class="py na fq ot b bg pz qa l qb qc">df1 = pd.read_csv('file1.csv')<br/>df2 = pd.read_csv('file2.csv')<br/>df3 = pd.read_csv('file3.csv')<br/>df4 = pd.read_csv('file4.csv')<br/><br/>df1_2 = pd.merge(df1, df2, on='a', how='left')<br/>df1_2_3 = pd.merge(df1_2, df3, on='b', how='inner')<br/>df1_4 = pd.merge(df1, df4, on='a', how='left')</span></pre><p id="f4cb" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">The code runs smoothly and you get the desired output. Boss pats you on the back and jokingly says, “That’s quick, can you be even faster?”</p><p id="fe7a" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">You look up at your boss, but all you can see is a train of expletives flashing across your eyes. You fight the visceral urge to pick one to be processed by your biological audio output device. You triumphed in doing so and summoned all the hypocritical chakra to fake a smile and respond cheerfully, “Sure, let me give it a shot.”</p><p id="c989" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">As the train of expletives fades into the horizon and as you exhaust all your chakra, you noticed a glimmer of hope: there is no need to read <code class="cx oq or os ot b">file2.csv</code> and <code class="cx oq or os ot b">file3.csv</code> if you are only interested in <code class="cx oq or os ot b">df1_4</code>. It dawn upon you that this flagrant expenditure of precious time and computing power, contradicts with your commitment towards sustainability and you begin to contemplate how to make the code more efficient by reading only what is necessary.</p><h1 id="ae2e" class="pd na fq bf nb pe pf gq nf pg ph gt nj pi pj pk pl pm pn po pp pq pr ps pt pu bk">Reusable functions: how it progresses</h1><p id="2246" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">You recall the programming classes that you took N years ago and proceeded to write some functions:</p><pre class="mm mn mo mp mq pv ot pw bp px bb bk"><span id="4e22" class="py na fq ot b bg pz qa l qb qc">files = {1: 'file1.csv', 2: 'file2.csv', 3:'file3.csv', 4:'file4.csv'}<br/><br/>def get_df(x):<br/>    return pd.read_csv(files[x])<br/><br/>def get_df1_2():<br/>    df1 = get_df(1)<br/>    df2 = get_df(2)<br/>    return pd.merge(df1, df2, on='a', how='left')  <br/><br/>def get_df1_2_3():<br/>    df1_2 = get_df1_2()<br/>    df3 = get_df(3)<br/>    return pd.merge(df1_2, df3, on='b', how='inner')<br/><br/>def get_df1_4():<br/>    df1 = get_df(1)<br/>    df4 = get_df(4)<br/>    return pd.merge(df1, df4, on='a', how='left')</span></pre><p id="7ebf" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">You are pleased with yourself. Although the number of lines of code has more than doubled, you take comfort in the fact that it will be more manageable in the long run. Also, you justify this approach because you can get specific output dataframes and each one of them will only read the required tables and nothing else. You feel a chill down your spine, as an inner voice challenges your conscious thoughts. “Are you sure?” he barked in a commanding tone, reminiscent of a drill sergeant. Silence hung densely in the air, and all you can hear is the spinning of the imaginary cogs in your mind… Suddenly, your eyes lit up and noticed that if you need <code class="cx oq or os ot b">df1_2</code> and <code class="cx oq or os ot b">df1_4</code>, then <code class="cx oq or os ot b">file1.csv</code> will be read twice! Roar!</p><h1 id="ddf8" class="pd na fq bf nb pe pf gq nf pg ph gt nj pi pj pk pl pm pn po pp pq pr ps pt pu bk">Objects, methods and attributes: how it evolves</h1><p id="bd1c" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">Once again, you recall the programming lessons in college and remembered that you can resolve this by creating a <code class="cx oq or os ot b">Reports</code> object. After a dataframe has been read, it can be set as an attribute of the <code class="cx oq or os ot b">Reports</code> object so that it can be accessed later.</p><pre class="mm mn mo mp mq pv ot pw bp px bb bk"><span id="e888" class="py na fq ot b bg pz qa l qb qc">files = {1: 'file1.csv', 2: 'file2.csv', 3:'file3.csv', 4:'file4.csv'}<br/><br/>class Reports:<br/>    <br/>    def __init__(self):<br/>        self.df1 = pd.read_csv(files[1])<br/><br/>    def get_df1_2(self):<br/>        self.df2 = pd.read_csv(files[2])<br/>        self.df1_2 = pd.merge(self.df1, self.df2, on='a', how='left')<br/>        return self.df1_2<br/><br/>    def get_df1_4(self):<br/>        self.df4 = pd.read_csv(files[4])<br/>        self.df1_4 = pd.merge(self.df1, self.df4, on='a', how='left')<br/><br/>    def get_df1_2_3(self):<br/>        self.get_df1_2()  <br/>        self.df3 = pd.read_csv(files[3])<br/>        self.df1_2_3 = pd.merge(self.df1_2, self.df3, on='b', how='inner')</span></pre><p id="a722" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">Voila! You have solved the problem of reading the same file several times. But there is yet another problem: <code class="cx oq or os ot b">get_df1_2_3</code> can get very complicated if it has to go through many steps, e.g. filtering, selecting, boolean-masking, removal of duplicates, etc.</p><h1 id="0b3b" class="pd na fq bf nb pe pf gq nf pg ph gt nj pi pj pk pl pm pn po pp pq pr ps pt pu bk">Tracing upstream dependencies: a novel approach</h1><p id="df72" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">You take a deep breath and wonder… is there a way for the code to figure out that if <code class="cx oq or os ot b">self.df1_2</code> has not been set, then it should call <code class="cx oq or os ot b">self.get_df1_2()</code>? More generally, when an attribute being accessed is not present, can we identify which method is responsible for setting it, and then call the method? If this can be achieved, then one can use <code class="cx oq or os ot b">x=Reports(); x.df1_2_3</code> to get to the required dataframe in one command.</p><blockquote class="qi qj qk"><p id="c518" class="nx ny ql nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">I<!-- -->sn’t that worth fighting for? Isn’t that worth dying? — Morpheus, The Matrix Reloaded, 2003</p></blockquote><p id="a273" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">Like a mad scientist at work, you begin hammering away at your keyboard, occasionally looking up to make imaginary drawings of programming abstractions and connecting them with your fingers. From your peripheral, you notice the look of bewilderment — or perhaps disgust, but you couldn’t tell — from a co-worker you never knew. You channel all your focus to enter flow state, oblivious to what is happening around you. The building could have caught fire, but you wouldn’t know as long as your trusty Notepad++ continues to display every key you enter.</p><pre class="mm mn mo mp mq pv ot pw bp px bb bk"><span id="a134" class="py na fq ot b bg pz qa l qb qc">files = {'df1': 'file1.csv', 'df2': 'file2.csv',<br/>         'df3': 'file3.csv', 'df4': 'file4.csv'}<br/><br/>class Reports:<br/>    <br/>    def __init__(self):<br/>        self._build_shortcuts()<br/>    <br/>    def _read(self, k):<br/>        setattr(self, k, pd.read_csv(files[k]))  <br/><br/>    def _build_shortcuts(self):<br/>        # Dict: Method -&gt; list of attributes<br/>        dict0 = {'get_df1_2': ['df1_2'],<br/>                 'get_df1_4': ['df1_4'],<br/>                 'get_df1_2_3': ['df1_2_3']}<br/><br/>        # Dict: Attribute -&gt; method which creates the attribute<br/>        dict1 = {v:k for k, values in dict0.items() for v in values}<br/>        self._shortcuts = dict1<br/><br/>    def __getattr__(self, attr):<br/>        if not attr in self.__dict__: # if the attr has not been created...<br/>            if attr in self._shortcuts: <br/>                func = self._shortcuts[attr] <br/>                # `func` is the method responsible for creating attr<br/>                self.__getattribute__(func)()<br/>                return self.__getattribute__(attr)<br/>            elif attr in files:<br/>                self._read(attr)<br/>                return self.__getattribute__(attr)<br/>            else:<br/>                raise AttributeError<br/>        else:<br/>            return self.__getattribute__(attr)<br/>  <br/>    def get_df1_2(self):<br/>        self.df1_2 = pd.merge(self.df1, self.df2, on='a', how='left')<br/>        return self.df1_2<br/><br/>    def get_df1_4(self):<br/>        self.df1_4 = pd.merge(self.df1, self.df4, on='a', how='left')<br/>        return self.df1_4<br/>    <br/>    def get_df1_2_3(self):<br/>        self.df1_2_3 = pd.merge(self.df1_2, self.df3, on='b', how='inner')<br/>        return self.df1_2_3</span></pre><p id="abd7" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">You take a moment to admire your creation, its elegance and simplicity. For a split second, you dream about how this will benefit coders and data analysts. As you ride the hot-air balloon of euphoria, the inner voice descends upon you like shackles on a prisoner. “Stay grounded,” he said, “as you may not be the first to come up with such an idea.” You buckle down and begin documenting your work, consciously aware that you may not understand what you have written a few days later.</p><p id="cf0b" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk"><code class="cx oq or os ot b">__init__()</code> does not read files. It merely calls <code class="cx oq or os ot b">build_shortcuts()</code>.</p><ul class=""><li id="9075" class="nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op ov ow ox bk"><code class="cx oq or os ot b">_build_shortcuts()</code> &amp; <code class="cx oq or os ot b">__getattr__</code> work hand-in-hand to simplify the code in subsequent methods.</li><li id="c7be" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk"><code class="cx oq or os ot b">_build_shortcuts()</code> takes a dictionary with methods as keys and list of attributes as values, then inverts it to form a dictionary with attributes as keys and methods which sets the attributes as values.</li><li id="102f" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk"><code class="cx oq or os ot b">__getattr__</code> does quite a bit of magic. When one calls <code class="cx oq or os ot b">self.&lt;attr&gt;</code>, if <code class="cx oq or os ot b">attr</code> is not present in <code class="cx oq or os ot b">self.__dict__</code> but is in <code class="cx oq or os ot b">self._shortcuts</code>, then it identifies the method that is responsible for creating <code class="cx oq or os ot b">self.&lt;attr&gt;</code> and calls the method. Whenever you create a new method, if it sets a new attribute, then all you have to do is to update <code class="cx oq or os ot b">dict0</code> in <code class="cx oq or os ot b">self._build_shortcuts()</code>. If it is in the keys of the <code class="cx oq or os ot b">files</code> dictionary, then it reads the corresponding file and sets the key as the attribute of the <code class="cx oq or os ot b">Reports</code> object.</li><li id="63cc" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">Without explicitly writing a loop or recursion, <code class="cx oq or os ot b">__getattr__</code> and <code class="cx oq or os ot b">self._shortcuts</code> work together to trace the upstream dependencies!</li></ul><p id="88c1" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">For now, this is a superior approach for the following reasons:</p><ul class=""><li id="1c96" class="nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op ov ow ox bk">Files are read only when absolutely required, minimal time wasted.</li><li id="b155" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">When files are read, they are read only once, and data written to the attribute.</li><li id="e93e" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">When calling an attribute, if it is not created, it will find the method responsible for setting the attribute, and then set it.</li></ul><h1 id="e558" class="pd na fq bf nb pe pf gq nf pg ph gt nj pi pj pk pl pm pn po pp pq pr ps pt pu bk">Additional benefit</h1><p id="106d" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">Besides being able to access the desired dataframes in one command, you can also add other attributes[1] to the values of <code class="cx oq or os ot b">dict0</code> in <code class="cx oq or os ot b">_build_shortcuts()</code>.</p><p id="ed4f" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">For example, you may be interested in the list of unique values of column <code class="cx oq or os ot b">a</code> in <code class="cx oq or os ot b">df1_2</code>. Simply add it to the list, and you can use <code class="cx oq or os ot b">x = Reports(); x.unique_values_in_a</code>.</p><pre class="mm mn mo mp mq pv ot pw bp px bb bk"><span id="ffe3" class="py na fq ot b bg pz qa l qb qc">    ...<br/>    <br/>    def _build_shortcuts(self):<br/><br/>        # Added 'unique_items_in_a' to the first list.<br/>        dict0 = {'get_df1_2': ['df1_2', 'unique_values_in_a'],<br/>                 'get_df1_4': ['df1_4'],<br/>                 'get_df1_2_3': ['df1_2_3']}<br/><br/><br/>        dict1 = {v:k for k, values in dict0.items() for v in values}<br/>        self._shortcuts = dict1<br/>    ...<br/><br/>    def get_df1_2(self):<br/>        self.df1_2 = pd.merge(self.df1, self.df2, on='a', how='left')<br/>        # Added the list of unique values of column 'a'<br/>        self.unique_values_in_a = self.df1_2['a'].unique().tolist()<br/>        return self.df1_2</span></pre><h1 id="9666" class="pd na fq bf nb pe pf gq nf pg ph gt nj pi pj pk pl pm pn po pp pq pr ps pt pu bk">Conclusion</h1><h2 id="fd91" class="mz na fq bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">What does it mean for you?</h2><p id="1ed3" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">I highly encourage you to try this approach the next time you are required to analyze data which involving multiple dataframes.</p><ul class=""><li id="ad41" class="nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op ov ow ox bk">For python novices, you can just copy-and-paste the <code class="cx oq or os ot b">Reports</code> class, <code class="cx oq or os ot b">__init__</code>, <code class="cx oq or os ot b">__getattr__</code> and <code class="cx oq or os ot b">_build_shortcuts</code> method. Obviously, you will need to write your own methods and update<code class="cx oq or os ot b">dict0</code> in <code class="cx oq or os ot b">_build_shortcuts</code>.</li><li id="3f54" class="nx ny fq nz b go oy ob oc gr oz oe of nk pa oh oi no pb ok ol ns pc on oo op ov ow ox bk">For python experts, I would love to hear your view on my approach and if you are doing something similar, or better.</li></ul><h2 id="db47" class="mz na fq bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Disclaimer</h2><p id="d45e" class="pw-post-body-paragraph nx ny fq nz b go oa ob oc gr od oe of nk og oh oi no oj ok ol ns om on oo op fj bk">This narrative is merely for illustrative purposes and does not in any way shape or form represent my or my firm’s views or reflect in any way experiences in my firm or with my clients.</p><p id="2a2d" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">This is the first time that I’ve used such a writing style, if you like it, do show your appreciation by clapping, following and subscribing. Thank you!</p><p id="cd54" class="pw-post-body-paragraph nx ny fq nz b go qd ob oc gr qe oe of nk qf oh oi no qg ok ol ns qh on oo op fj bk">[1] Many thanks to Tongwei for proofreading and suggesting this.</p></div></div></div></div>    
</body>
</html>