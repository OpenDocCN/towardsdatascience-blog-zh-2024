<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Using Causal Graphs to answer causal questions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Using Causal Graphs to answer causal questions</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-causal-graphs-to-answer-causal-questions-5fd1dd82fa90?source=collection_archive---------1-----------------------#2024-01-31">https://towardsdatascience.com/using-causal-graphs-to-answer-causal-questions-5fd1dd82fa90?source=collection_archive---------1-----------------------#2024-01-31</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="15be" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Causal AI, exploring the integration of causal reasoning into machine learning</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@raz1470?source=post_page---byline--5fd1dd82fa90--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Ryan O'Sullivan" class="l ep by dd de cx" src="../Images/7cd161d38d67d2c0b7da2d8f3e7d33fe.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*tAw1S072P0f0sUswKPN6VQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--5fd1dd82fa90--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@raz1470?source=post_page---byline--5fd1dd82fa90--------------------------------" rel="noopener follow">Ryan O'Sullivan</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--5fd1dd82fa90--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">9 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 31, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">7</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/de2d3dc8860ce785769383e679f20d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MM5su71P6GaN-13p"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@guerrillabuzz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">GuerrillaBuzz</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="5de8" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">What is this series of articles about?</h1><p id="9653" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Welcome to my series on Causal AI, where we will explore the integration of causal reasoning into machine learning models. Expect to explore a number of practical applications across different business contexts.</p><h1 id="1efd" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Introduction</strong></h1><p id="fd6b" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">This article gives a practical introduction to the potential of causal graphs.</p><p id="62f8" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">It is aimed at anyone who wants to understand more about:</p><ul class=""><li id="ceae" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">What causal graphs are and how they work</li><li id="1001" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">A worked case study in Python illustrating how to build causal graphs</li><li id="7fc0" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">How they compare to ML</li><li id="9d95" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">The key challenges and future considerations</li></ul><p id="5682" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The full notebook can be found here:</p><div class="pi pj pk pl pm pn"><a href="https://github.com/raz1470/causal_ai/blob/main/notebooks/using%20causal%20graphs%20to%20answer%20causal%20questions.ipynb?source=post_page-----5fd1dd82fa90--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="po ab ig"><div class="pp ab co cb pq pr"><h2 class="bf fr hw z io ps iq ir pt it iv fp bk">causal_ai/notebooks/using causal graphs to answer causal questions.ipynb at main ·…</h2><div class="pu l"><h3 class="bf b hw z io ps iq ir pt it iv dx">This project introduces Causal AI and how it can drive business value. - causal_ai/notebooks/using causal graphs to…</h3></div><div class="pv l"><p class="bf b dy z io ps iq ir pt it iv dx">github.com</p></div></div><div class="pw l"><div class="px l py pz qa pw qb lr pn"/></div></div></a></div><h1 id="0f5a" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">What are Causal Graphs?</strong></h1><p id="56b2" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Causal graphs help us disentangle causes from correlations. They are a key part of the causal inference/causal ML/causal AI toolbox and can be used to answer causal questions.</p><p id="04f7" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Often referred to as a DAG (directed acyclic graph), a causal graph contains nodes and edges — Edges link nodes that are causally related.</p><p id="fbdc" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">There are two ways to determine a causal graph:</p><ul class=""><li id="ac89" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">Expert domain knowledge</li><li id="ba56" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Causal discovery algorithms</li></ul><p id="2c6e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">For now, we will assume we have expert domain knowledge to determine the causal graph (we will cover causal discovery algorithms further down the line).</p><h1 id="7843" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Why can’t we just use ML?</strong></h1><p id="cf30" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">The objective of ML is to classify or predict as accurately as possible given some training data. There is no incentive for an ML algorithm to ensure the features it uses are causally linked to the target. There is no guarantee that the direction (positive/negative effect) and strength of each feature will align with the true data generating process. ML won’t take into account the following situations:</p><ul class=""><li id="2255" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">Spurious correlations — Two variables having a spurious correlation when they have a common cause e.g. High temperatures increasing the number of ice cream sales and shark attacks.</li><li id="018e" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Confounders — A variable is affecting your treatment and outcome e.g. Demand affecting how much we spend on marketing and how many new customers sign up.</li><li id="ee3f" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Colliders — A variable that is affected by two independent variables e.g. Quality of customer care -&gt; User satisfaction &lt;- Size of company</li><li id="ea62" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Mediators — Two variables being (indirectly) linked through a mediator e.g. Regular exercise -&gt; Cardiovascular fitness (the mediator) -&gt; Overall health</li></ul><p id="7f6c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Because of these complexities and the black-box nature of ML, we can’t be confident in its ability to answer causal questions.</p><h1 id="0782" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Structural Causal Models</strong></h1><p id="548f" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Given a known causal graph and observed data, we can train a structural causal model (SCM). An SCM can be thought of as a series of causal models, one per node. Each model uses one node as a target, and its direct parents as features. If the relationships in our observed data are linear, an SCM will be a series of linear equations. This could be modelled by a series of linear regression models. If the relationships in our observed data are non-linear, this could be modelled with a series of boosted trees.</p><p id="40fb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The key difference to traditional ML is that an SCM models causal relationships and accounts for spurious correlations, confounders, colliders and mediators.</p><p id="1fa6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">It is common to use an additive noise model (ANM) for each non-root node (meaning it has at least one parent). This allows us to use a range of machine learning algorithms (plus a noise term) to estimate each non-root node.</p><p id="824b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Y := f(X) + N</p><p id="a45f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Root nodes can modelled using a stochastic model to describe the distribution.</p><p id="a849" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">An SCM can be seen as a generative model as can to generate new samples of data — This enables it to answer a range of causal questions. It generates new data by sampling from the root nodes and then propagating data through the graph.</p><h1 id="f14c" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Answering causal questions</strong></h1><p id="69c7" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">The value of an SCM is that it allows us to answer causal questions by calculating counterfactuals and simulating interventions:</p><ul class=""><li id="1313" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">Counterfactuals: Using historically observed data to calculate what would have happened to y if we had changed x. e.g. What would have happened to the number of customers churning if we had reduced call waiting time by 20% last month?</li><li id="1c72" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Interventions: Very similar to counterfactuals (and often used interchangeably) but interventions simulate what what would happen in the future e.g. What will happen to the number of customers churning if we reduce call waiting time by 20% next year?</li></ul><h1 id="a115" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Call Centre case study</strong></h1><p id="3cc2" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">There are several KPIs that the customer service team monitors. One of these is call waiting times. Increasing the number of call centre staff will decrease call waiting times.</p><p id="2c88" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But how will decreasing call waiting time impact customer churn levels? And will this offset the cost of additional call centre staff?</p><p id="32c6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Data Science team is asked to build and evaluate the business case.</p><h1 id="961e" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Determining the causal graph</strong></h1><p id="0240" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">The population of interest is customers who make an inbound call. The following time-series data is collected daily:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qc"><img src="../Images/ea95f2a517a5ea6c23b1cc89cb028263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*1HwssDlnhL1LZJZRzx899g.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><p id="f7bc" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In this example, we use time-series data but causal graphs can also work with customer-level data.</p><p id="fa43" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In this example, we use expert domain knowledge to determine the causal graph.</p><pre class="mm mn mo mp mq qd qe qf bp qg bb bk"><span id="8fd5" class="qh ne fq qe b bg qi qj l qk ql"># Create node lookup for channels<br/>node_lookup = {0: 'Demand',<br/>               1: 'Call waiting time',<br/>               2: 'Call abandoned', <br/>               3: 'Reported problems',                   <br/>               4: 'Discount sent',<br/>               5: 'Churn'                                                                             <br/> }<br/><br/>total_nodes = len(node_lookup)<br/><br/># Create adjacency matrix - this is the base for our graph<br/>graph_actual = np.zeros((total_nodes, total_nodes))<br/><br/># Create graph using expert domain knowledge<br/>graph_actual[0, 1] = 1.0 # Demand -&gt; Call waiting time<br/>graph_actual[0, 2] = 1.0 # Demand -&gt; Call abandoned<br/>graph_actual[0, 3] = 1.0 # Demand -&gt; Reported problems<br/>graph_actual[1, 2] = 1.0 # Call waiting time -&gt; Call abandoned<br/>graph_actual[1, 5] = 1.0 # Call waiting time -&gt; Churn<br/>graph_actual[2, 3] = 1.0 # Call abandoned -&gt; Reported problems<br/>graph_actual[2, 5] = 1.0 # Call abandoned -&gt; Churn<br/>graph_actual[3, 4] = 1.0 # Reported problems -&gt; Discount sent<br/>graph_actual[3, 5] = 1.0 # Reported problems -&gt; Churn<br/>graph_actual[4, 5] = 1.0 # Discount sent -&gt; Churn</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qm"><img src="../Images/7f87d73da2c5be5e5e94137445c52f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ByZGiTHpX5bx0fkcuItMpg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><h1 id="d12d" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Data generating process</strong></h1><p id="90ee" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Next, we need to generate data for our case study.</p><p id="32ce" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">We want to generate some data which will allow us to compare calculating counterfactuals using causal graphs vs ML (to keep things simple, ridge regression).</p><p id="72b2" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As we identified the causal graph in the last section, we can use this knowledge to create a data-generating process.</p><pre class="mm mn mo mp mq qd qe qf bp qg bb bk"><span id="abac" class="qh ne fq qe b bg qi qj l qk ql">def data_generator(max_call_waiting, inbound_calls, call_reduction):<br/>    '''<br/>     A data generating function that has the flexibility to reduce the value of node 0 (Call waiting time) - this enables us to calculate ground truth counterfactuals<br/><br/>    Args:<br/>        max_call_waiting (int): Maximum call waiting time in seconds<br/>        inbound_calls (int): Total number of inbound calls (observations in data)<br/>        call_reduction (float): Reduction to apply to call waiting time<br/><br/>    Returns:<br/>        DataFrame: Generated data<br/>    '''<br/>    <br/>    df = pd.DataFrame(columns=node_lookup.values())<br/><br/>    df[node_lookup[0]] = np.random.randint(low=10, high=max_call_waiting, size=(inbound_calls)) # Demand<br/>    df[node_lookup[1]] = (df[node_lookup[0]] * 0.5) * (call_reduction) + np.random.normal(loc=0, scale=40, size=inbound_calls) # Call waiting time<br/>    df[node_lookup[2]] = (df[node_lookup[1]] * 0.5) + (df[node_lookup[0]] * 0.2) + np.random.normal(loc=0, scale=30, size=inbound_calls) # Call abandoned<br/>    df[node_lookup[3]] = (df[node_lookup[2]] * 0.6) + (df[node_lookup[0]] * 0.3) + np.random.normal(loc=0, scale=20, size=inbound_calls) # Reported problems<br/>    df[node_lookup[4]] = (df[node_lookup[3]] * 0.7) + np.random.normal(loc=0, scale=10, size=inbound_calls) # Discount sent<br/>    df[node_lookup[5]] = (0.10 * df[node_lookup[1]] ) + (0.30 * df[node_lookup[2]]) + (0.15 * df[node_lookup[3]]) + (-0.20 * df[node_lookup[4]]) # Churn<br/><br/>    return df</span></pre><pre class="qn qd qe qf bp qg bb bk"><span id="be4d" class="qh ne fq qe b bg qi qj l qk ql"># Generate data<br/>np.random.seed(999)<br/>df = data_generator(max_call_waiting=600, inbound_calls=10000, call_reduction=1.00)<br/><br/>sns.pairplot(df)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qo"><img src="../Images/9922931040e9b9c7d7029dbe255b01bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bf6lNWjWP17NrUJTeUDDEA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><h1 id="a780" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Training an SCM</strong></h1><p id="087d" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">We now have an adjacency matrix which represents our causal graph and some data. We use the gcm module from the dowhy Python package to train an SCM.</p><p id="6e8b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">It’s important to think about what causal mechanism to use for the root and non-root nodes. If you look at our data generator function, you will see all of the relationships are linear. Therefore choosing ridge regression should be sufficient.</p><pre class="mm mn mo mp mq qd qe qf bp qg bb bk"><span id="0ec0" class="qh ne fq qe b bg qi qj l qk ql"># Setup graph<br/>graph = nx.from_numpy_array(graph_actual, create_using=nx.DiGraph)<br/>graph = nx.relabel_nodes(graph, node_lookup)<br/><br/># Create SCM<br/>causal_model = gcm.InvertibleStructuralCausalModel(graph)<br/>causal_model.set_causal_mechanism('Demand', gcm.EmpiricalDistribution()) # Root node<br/>causal_model.set_causal_mechanism('Call waiting time', gcm.AdditiveNoiseModel(gcm.ml.create_ridge_regressor())) # Non-root node<br/>causal_model.set_causal_mechanism('Call abandoned', gcm.AdditiveNoiseModel(gcm.ml.create_ridge_regressor())) # Non-root node<br/>causal_model.set_causal_mechanism('Reported problems', gcm.AdditiveNoiseModel(gcm.ml.create_ridge_regressor())) # Non-root node<br/>causal_model.set_causal_mechanism('Discount sent', gcm.AdditiveNoiseModel(gcm.ml.create_ridge_regressor())) # Non-root <br/>causal_model.set_causal_mechanism('Churn', gcm.AdditiveNoiseModel(gcm.ml.create_ridge_regressor())) # Non-root <br/>gcm.fit(causal_model, df)</span></pre><p id="0f18" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You could also use the auto assignment function to automatically assign the causal mechanisms instead of manually assigning them.</p><p id="2216" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">For more info on the gcm package see the docs:</p><div class="pi pj pk pl pm pn"><a href="https://www.pywhy.org/dowhy/v0.11.1/?source=post_page-----5fd1dd82fa90--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="po ab ig"><div class="pp ab co cb pq pr"><h2 class="bf fr hw z io ps iq ir pt it iv fp bk">DoWhy documentation - DoWhy documentation</h2><div class="pu l"><h3 class="bf b hw z io ps iq ir pt it iv dx">Date: Dec 25, 2023 Version: v0.11.1 Related resources: Source Repository | Issues &amp; Ideas | PyWhy Organization | DoWhy…</h3></div><div class="pv l"><p class="bf b dy z io ps iq ir pt it iv dx">www.pywhy.org</p></div></div></div></a></div><h1 id="40d0" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Ridge regression comparison</strong></h1><p id="c2e7" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">We also use ridge regression to help create a baseline comparison. We can look back at the data generator and see that it correctly estimates the coefficients for each variable. However, in addition to directly influencing churn, call waiting time indirectly influences churn through abandoned calls, reported problems and discounts sent.</p><p id="3fec" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">When it comes to estimating counterfactuals it is going to be interesting to see how the SCM compares to ridge regression.</p><pre class="mm mn mo mp mq qd qe qf bp qg bb bk"><span id="6524" class="qh ne fq qe b bg qi qj l qk ql"># Ridge regression<br/>y = df['Churn'].copy()<br/>X = df.iloc[:, 1:-1].copy()<br/>model = RidgeCV()<br/>model = model.fit(X, y)<br/>y_pred = model.predict(X)<br/><br/>print(f'Intercept: {model.intercept_}')<br/>print(f'Coefficient: {model.coef_}')<br/># Ground truth[0.10 0.30 0.15 -0.20]</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qp"><img src="../Images/8bdef4723a46a3c0aaec5a3a2a4d6f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*zd5cdxKergrTASxrkS4DOA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><h1 id="93ed" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Estimating ground truth</strong></h1><p id="6e65" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Before we move on to calculating counterfactuals using causal graphs and ridge regression, we need a ground truth benchmark. We can use our data generator to create counterfactual samples after we have reduced call waiting time by 20%.</p><p id="60de" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">We couldn’t do this with real-world problems but this method allows us to assess how effective the causal graph and ridge regression is.</p><pre class="mm mn mo mp mq qd qe qf bp qg bb bk"><span id="db44" class="qh ne fq qe b bg qi qj l qk ql"># Set call reduction to 20%<br/>reduce = 0.20<br/>call_reduction = 1 - reduce<br/><br/># Generate counterfactual data<br/>np.random.seed(999)<br/>df_cf = data_generator(max_call_waiting=600, inbound_calls=10000, call_reduction=call_reduction)</span></pre><h1 id="181b" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Estimating counterfactuals</strong></h1><p id="7a8f" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">We can now estimate what would have happened if we had of decreased the call waiting time by 20% using our 3 methods:</p><ul class=""><li id="d944" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">Ground truth (from the data generator)</li><li id="36d6" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Ridge regression</li><li id="ef64" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Causal graph</li></ul><p id="dc9b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">We see that ridge regression underestimates the impact on churn significantly whilst the causal graph is very close to the ground truth.</p><pre class="mm mn mo mp mq qd qe qf bp qg bb bk"><span id="8c62" class="qh ne fq qe b bg qi qj l qk ql"># Ground truth counterfactual<br/>ground_truth = round((df['Churn'].sum() - df_cf['Churn'].sum()) / df['Churn'].sum(), 2)<br/><br/># Causal graph counterfactual<br/>df_counterfactual = gcm.counterfactual_samples(causal_model, {'Call waiting time': lambda x: x*call_reduction}, observed_data=df)<br/>causal_graph = round((df['Churn'].sum() - df_counterfactual['Churn'].sum()) / (df['Churn'].sum()), 3)<br/><br/># Ridge regression counterfactual<br/>ridge_regression = round((df['Call waiting time'].sum() * 1.0 * model.coef_[0] - (df['Call waiting time'].sum() * call_reduction * model.coef_[0])) / (df['Churn'].sum()), 3)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qq"><img src="../Images/0da8f6eb1bd4a932cc8e7626cb4e0046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*jwD1JAU5-Pqtj4Pcad-8GQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by author</figcaption></figure><h1 id="6d71" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Future considerations</strong></h1><p id="8447" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">This was a simple example to start you thinking about the power of causal graphs.</p><p id="c437" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">For more complex situations, several challenges that would need some consideration:</p><ul class=""><li id="0c2c" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">What assumptions are made and what is the impact of these being violated?</li><li id="62c6" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">What about if we don’t have the expert domain knowledge to identify the causal graph?</li><li id="0320" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">What if there are non-linear relationships?</li><li id="c3f6" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">How damaging is multi-collinearity?</li><li id="f2de" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">What if some variables have lagged effects?</li><li id="f0d4" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">How can we deal with high-dimensional datasets (lots of variables)?</li></ul><p id="9956" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">All of these points will be covered in future blogs.</p><h1 id="9c8a" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk"><strong class="al">Resources</strong></h1><p id="64b5" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">If your interested in learning more about causal AI, I highly recommend the following resources:</p><div class="pi pj pk pl pm pn"><a href="https://www.packtpub.com/product/causal-inference-and-discovery-in-python/9781804612989?source=post_page-----5fd1dd82fa90--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="po ab ig"><div class="pp ab co cb pq pr"><h2 class="bf fr hw z io ps iq ir pt it iv fp bk">Causal Inference and Discovery in Python | Packt</h2><div class="pu l"><h3 class="bf b hw z io ps iq ir pt it iv dx">Demystify causal inference and casual discovery by uncovering causal principles and merging them with powerful machine…</h3></div><div class="pv l"><p class="bf b dy z io ps iq ir pt it iv dx">www.packtpub.com</p></div></div><div class="pw l"><div class="qr l py pz qa pw qb lr pn"/></div></div></a></div><div class="pi pj pk pl pm pn"><a href="https://www.oreilly.com/library/view/causal-inference-in/9781098140243/?source=post_page-----5fd1dd82fa90--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="po ab ig"><div class="pp ab co cb pq pr"><h2 class="bf fr hw z io ps iq ir pt it iv fp bk">Causal Inference in Python</h2><div class="pu l"><h3 class="bf b hw z io ps iq ir pt it iv dx">How many buyers will an additional dollar of online marketing bring in? Which customers will only buy when given a…</h3></div><div class="pv l"><p class="bf b dy z io ps iq ir pt it iv dx">www.oreilly.com</p></div></div><div class="pw l"><div class="qs l py pz qa pw qb lr pn"/></div></div></a></div><h1 id="f686" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">What does ChatGPT have to say about the author? 😊</h1><p id="9ed4" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">“Meet Ryan, a seasoned Lead Data Scientist with a specialized focus on employing causal techniques within business contexts, spanning Marketing, Operations, and Customer Service. His proficiency lies in unraveling the intricacies of cause-and-effect relationships to drive informed decision-making and strategic enhancements across diverse organizational functions.”</p></div></div></div><div class="ab cb qt qu qv qw" role="separator"><span class="qx by bm qy qz ra"/><span class="qx by bm qy qz ra"/><span class="qx by bm qy qz"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="0af3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Follow me if you want to continue this journey into Causal AI — In the next article we will take a step back and delve into using Causal Discovery to estimate the Causal Graph when we don’t have expert domain knowledge.</p></div></div></div></div>    
</body>
</html>