<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Get Underlined Text from Any PDF with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Get Underlined Text from Any PDF with Python</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/get-underlined-text-from-any-pdf-b7b068ca3d64?source=collection_archive---------8-----------------------#2024-05-03">https://towardsdatascience.com/get-underlined-text-from-any-pdf-b7b068ca3d64?source=collection_archive---------8-----------------------#2024-05-03</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="186b" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">A step-by-step guide to get underlined text as an array from PDF files.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@sasha.korovkina2003?source=post_page---byline--b7b068ca3d64--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Sasha Korovkina" class="l ep by dd de cx" src="../Images/14eac2bafa3c5b417b8aecdef61e6ac3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*KHjtG4QQbAqXlc9btm09Hw.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--b7b068ca3d64--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@sasha.korovkina2003?source=post_page---byline--b7b068ca3d64--------------------------------" rel="noopener follow">Sasha Korovkina</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--b7b068ca3d64--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">5 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">May 3, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><blockquote class="mj mk ml"><p id="cd7f" class="mm mn mo mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk"><em class="fq">💡 If you want to see the code for this project, check out my repository: </em><a class="af nj" href="https://github.com/sasha-korovkina/pdfUnderlinedExtractor" rel="noopener ugc nofollow" target="_blank"><strong class="mp fr"><em class="fq">https://github.com/sasha-korovkina/pdfUnderlinedExtractor</em></strong></a></p></blockquote><p id="5d1f" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">PDF data extraction can be a real headache, and it gets even trickier when you’re trying to snag underlined text — believe it or not, there aren’t any go-to solutions or libraries that handle this out of the box. But don’t worry, I’m here to show you how to tackle this.</p><figure class="nn no np nq nr ns nk nl paragraph-image"><div role="button" tabindex="0" class="nt nu ed nv bh nw"><div class="nk nl nm"><img src="../Images/285d98ef8529f8e087521cbade385672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*noNGMVqtffJeQlo1"/></div></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">Photo by <a class="af nj" href="https://unsplash.com/@dlxmedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">dlxmedia.hu</a> on <a class="af nj" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="f3a8" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">The Theory</h2><p id="f244" class="pw-post-body-paragraph mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni fj bk">Extracting underlined text from PDFs can take a few different paths. You might consider using OCR to detect text components with bottom lines or delve into PyMuPDF’s markup capabilities. However, I’ve found that OCR tends to falter, suffering from inconsistency and low accuracy. PyMuPDF isn’t my favorite either — it demands finicky parameter tuning, which is time-consuming. Plus, one wrong setting and you could lose a bunch of data.</p><p id="3fd3" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">It is important to remember that PDFs are:</p><ul class=""><li id="a787" class="mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni pd pe pf bk"><strong class="mp fr">Non-Structured Data: </strong>PDF elements often lack grouping or categorization, which complicates efforts to search through the content systematically.</li><li id="ad8e" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pd pe pf bk"><strong class="mp fr">Text Formatting Recognition: </strong>Detecting specific text formats such as bold or underlined is notoriously difficult in PDFs, as most Python libraries do not support this capability effectively.</li></ul><p id="91a3" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">But fear not, as we have a strategy to resolve this.</p><h2 id="a567" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">The Strategy</h2><ul class=""><li id="1096" class="mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni pd pe pf bk">Convert the PDF to Structured XML: Start by transforming the PDF document into a structured XML format to facilitate easier data manipulation.</li><li id="99c1" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pd pe pf bk">Extract Desired Components: Identify and isolate the specific components from the XML that are relevant to our needs.</li><li id="b9bd" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pd pe pf bk">Use OCR (Optical Character Recognition) on the extracted coordinates to get the underlined text data as an array.</li><li id="ceb1" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pd pe pf bk">Extract and Output Underlined Text: Finally, extract the underlined text from the document and display or print the results.</li></ul><h2 id="eb00" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">The Code</h2><ol class=""><li id="f98c" class="mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni pl pe pf bk"><strong class="mp fr">PDF to XML</strong></li></ol><p id="c111" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">We will use the <strong class="mp fr">pdfquery</strong> library, the most comprehensive PDF to XML converter which I have come across.</p><figure class="nn no np nq nr ns"><div class="pm io l ed"><div class="pn po l"/></div></figure><p id="abd3" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">2. <strong class="mp fr">Studying the XML</strong></p><p id="4527" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">The XML has a few key components which we are interested in:</p><ul class=""><li id="c0d5" class="mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni pd pe pf bk"><em class="mo">LTRect — </em>sometimes, the library would parse the underlined text as a rectangle of minimal width under the text</li><li id="8bcf" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pd pe pf bk"><em class="mo">LTLine — </em>other times, it would recognise the outline as a separate line component.</li></ul><figure class="nn no np nq nr ns nk nl paragraph-image"><div role="button" tabindex="0" class="nt nu ed nv bh nw"><div class="nk nl pp"><img src="../Images/8608bd7c5289acf9d2f7d11e47b21416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3mp8b9M9D-BmUm8LuEMa5g.png"/></div></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">This is what your output XML will look like. Image created by author.</figcaption></figure><p id="6b98" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">LTRect component example:</p><pre class="nn no np nq nr pq pr ps bp pt bb bk"><span id="8bd7" class="pu oe fq pr b bg pv pw l px py">&lt;LTRect y0="563.787" y1="629.964" x0="367.942" x1="473.826" width="105.884" height="66.178" bbox="[367.942, 563.787, 473.826, 629.964]" linewidth="0" pts="[[367.942, 629.964], [473.826, 629.964], [473.826, 563.787], [367.942, 563.787]]"&gt;</span></pre><p id="08e2" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">Therefore, by converting the whole document into XML format, we can replicate it’s structure as XML components, let’s do just that!</p><h2 id="682c" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">Structure Replication</h2><p id="1a53" class="pw-post-body-paragraph mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni fj bk">Now, we will re-create the structure of our document as bounding box coordinates. To do this, we will parse the XML to define the page, component boxes, lines and rectangles, and then draw them all on our canvas in 3 different colors.</p><figure class="nn no np nq nr ns"><div class="pm io l ed"><div class="pn po l"/></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">PDF object visualization.</figcaption></figure><p id="04ac" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">Here is our inital PDF, it has been generated in Microsoft Word, by exporting a document with some underlines to the PDF file format:</p><figure class="nn no np nq nr ns nk nl paragraph-image"><div role="button" tabindex="0" class="nt nu ed nv bh nw"><div class="nk nl pz"><img src="../Images/a80e9d4b25647cc24bf887bd82a7167b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wp1CPBaNTk4xZtoHK47mSA.png"/></div></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">Initial document with sample text. Image created by author.</figcaption></figure><p id="c399" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">After applying the algorithm above, here is the visual representation we get:</p><figure class="nn no np nq nr ns nk nl paragraph-image"><div role="button" tabindex="0" class="nt nu ed nv bh nw"><div class="nk nl qa"><img src="../Images/457a9ed2f8f94ae00805ad5a5400450f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llAAurT_zoDcSPf3xHQi6Q.png"/></div></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">The box outline of the document Black — all document components, blue — underlined text. Image created by author.</figcaption></figure><p id="b362" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">This image represents the structure of our document, where the black box is used to describe all components on the page, and the blue is used to describe the LTRect elements, hence the underlined text.</p><h2 id="2013" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">Text Overlay</h2><p id="befc" class="pw-post-body-paragraph mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni fj bk">Now, let’s visualize all of the text within the PDF in it’s respective positions, with the following line of code:</p><pre class="nn no np nq nr pq pr ps bp pt bb bk"><span id="f6c9" class="pu oe fq pr b bg pv pw l px py">can.drawString(text_x, text_y, text)</span></pre><p id="da2d" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">Here is the output:</p><figure class="nn no np nq nr ns nk nl paragraph-image"><div role="button" tabindex="0" class="nt nu ed nv bh nw"><div class="nk nl qb"><img src="../Images/5a5d3f146599aa71accb262a8f815427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgp2Vz1O-cB8_bNqIKOFvw.png"/></div></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">PDF re-creation based on text location and underlines. Image created by author.</figcaption></figure><blockquote class="mj mk ml"><p id="819e" class="mm mn mo mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">Note that the text is not exactly where it was in the original document, due to the difference in size and font of the mark-up language in the pdfquery library.</p></blockquote><h2 id="2b7c" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">Co-Ordinate Extraction</h2><p id="e908" class="pw-post-body-paragraph mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni fj bk">As the result of our XML, we will have an array of coordinates of underlined regions, in my case I have called it underline_text.</p><figure class="nn no np nq nr ns"><div class="pm io l ed"><div class="pn po l"/></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">A piece of code which forms an array of coordinates of underlined text within the PDF file.</figcaption></figure><h2 id="3da1" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">Text Extraction</h2><p id="1267" class="pw-post-body-paragraph mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni fj bk">Here’s the process:</p><ol class=""><li id="42be" class="mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni pl pe pf bk">We identify the coordinate rectangles as previously determined.</li><li id="c2bc" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pl pe pf bk">We extract these sections from the PDF.</li><li id="3734" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pl pe pf bk">We apply Tesseract OCR to extract text from each extracted section.</li></ol><p id="8fa9" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">This method of extracting text from PDFs using coordinate rectangles and Tesseract OCR is effective for several reasons:</p><ol class=""><li id="e502" class="mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni pl pe pf bk"><strong class="mp fr">Precision in Text Extraction</strong>: By identifying specific coordinate rectangles, the process targets only relevant areas of the PDF. This focused approach avoids unnecessary processing of the entire document and reduces errors related to extracting unwanted text.</li><li id="a6d8" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pl pe pf bk"><strong class="mp fr">Efficiency</strong>: Extracting predefined sections directly from the PDF is much faster than processing the entire document. This method saves computational resources and time, particularly useful when dealing with large documents.</li><li id="6d94" class="mm mn fq mp b go pg mr ms gr ph mu mv mw pi my mz na pj nc nd ne pk ng nh ni pl pe pf bk"><strong class="mp fr">Accuracy with OCR</strong>: Tesseract OCR is a robust optical character recognition tool that can convert images of text into machine-readable text. By feeding it precise sections of text, it can perform more accurately as it deals with less background noise and formatting issues that might confuse the OCR process in larger, unsegmented documents.</li></ol><p id="7f02" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">And this is the code:</p><figure class="nn no np nq nr ns"><div class="pm io l ed"><div class="pn po l"/></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">Code to extract underlined text from the PDF sections.</figcaption></figure><p id="4a1e" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">Make sure that you have tesseract installed on your system before running this function. For in-depth instructions, check out their official installation guide here: <a class="af nj" href="https://github.com/tesseract-ocr/tessdoc/blob/main/Installation.md" rel="noopener ugc nofollow" target="_blank">https://github.com/tesseract-ocr/tessdoc/blob/main/Installation.md</a> or in my GitHub repository here: <a class="af nj" href="https://github.com/sasha-korovkina/pdfUnderlinedExtractor" rel="noopener ugc nofollow" target="_blank">https://github.com/sasha-korovkina/pdfUnderlinedExtractor</a>.</p><h2 id="f67a" class="od oe fq bf of og oh oi oj ok ol om on mw oo op oq na or os ot ne ou ov ow ox bk">Putting It All Together…</h2><p id="f08e" class="pw-post-body-paragraph mm mn fq mp b go oy mr ms gr oz mu mv mw pa my mz na pb nc nd ne pc ng nh ni fj bk">Now, If we take any PDF file, like this example file:</p><figure class="nn no np nq nr ns nk nl paragraph-image"><div class="nk nl qc"><img src="../Images/b9c573eeffa8a19dd77c3dd3138bafec.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*feaBa1c-zF67Q1fjo8GrLg.png"/></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">The whole text of the test file. Image created by author.</figcaption></figure><p id="22f9" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">We have some underlined words in this file:</p><figure class="nn no np nq nr ns nk nl paragraph-image"><div class="nk nl qd"><img src="../Images/60fb741f57fc777ffca8bcb4160942ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*BHNIFImYaEzEFtOGBojWsg.png"/></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">ipsum and laboris are underlined here. Image created by author.</figcaption></figure><p id="a0c9" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">After running the code described above, here is what we get:</p><figure class="nn no np nq nr ns nk nl paragraph-image"><div role="button" tabindex="0" class="nt nu ed nv bh nw"><div class="nk nl qe"><img src="../Images/7ad6d67e67f7828203225fedc39034eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0KvBgedXabsoLtxPhxyJw.png"/></div></div><figcaption class="ny nz oa nk nl ob oc bf b bg z dx">An array of all underlined words in the document. Image created by author.</figcaption></figure><p id="78e5" class="pw-post-body-paragraph mm mn fq mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">After getting this array, you can use these words for further processing!</p><blockquote class="mj mk ml"><p id="636e" class="mm mn mo mp b go mq mr ms gr mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni fj bk">Enjoy using this script! I’d love to hear about any creative applications you come up with or if you’d like to contribute. Let me know! ❤️</p></blockquote></div></div></div></div>    
</body>
</html>