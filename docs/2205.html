<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Practical Introduction to Polars</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Practical Introduction to Polars</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/practical-introduction-to-polars-8d9cdca350f1?source=collection_archive---------2-----------------------#2024-09-10">https://towardsdatascience.com/practical-introduction-to-polars-8d9cdca350f1?source=collection_archive---------2-----------------------#2024-09-10</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="27c3" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Hands-on guide with side-by-side examples in Pandas</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@npotapov?source=post_page---byline--8d9cdca350f1--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Nikolai Potapov" class="l ep by dd de cx" src="../Images/d2ac4b8c12c0cf70df05b8908b875a19.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*PsaRu1yGvqnvkofyj6pyNQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--8d9cdca350f1--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@npotapov?source=post_page---byline--8d9cdca350f1--------------------------------" rel="noopener follow">Nikolai Potapov</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--8d9cdca350f1--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">14 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Sep 10, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/07f4634c04141034295192ff239a64fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5RBh2Mz6PxRJ0VZqLOSG2w.jpeg"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image created with AI by Dall-E</figcaption></figure><p id="a2e7" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk ny"><span class="l nz oa ob bo oc od oe of og ed">T</span>his article is not about comparing Polars with Pandas or highlighting their differences. It’s a story about how adding a new tool can be beneficial not only for data science professionals but also for others who work with data. I like Polars because it is multithreaded, providing strong performance out-of-the-box, and it supports Lazy evaluation with query optimization capabilities. This tool will undoubtedly enhance your data skills and open up new opportunities.</p><p id="b4c7" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Although Polars and Pandas are different libraries, they share similarities in their APIs. Drawing parallels between them can make it easier for those familiar with the Pandas API to start using Polars. Even if you’re not familiar with Pandas and want to start learning Polars, it will still be incredibly useful and rewarding.</p></div></div></div><div class="ab cb oh oi oj ok" role="separator"><span class="ol by bm om on oo"/><span class="ol by bm om on oo"/><span class="ol by bm om on"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="4b4e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We will look at the most common actions that, in my experience, are most often used for data analysis. To illustrate the process of using Polars, I will consider an abstract task with reproducible data, so you can follow all the steps on your computer.</p><p id="4275" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Imagine that we have data from three online stores, where we register user actions, such as viewing and purchasing. Let’s assume that at any given time, only one action of each type can occur for each online store, and in case of a transaction error, our data might be missing the product identifier or its quantity. Additionally, for our task, we’ll need a product catalog with prices for each item.</p><p id="15f7" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Let’s formulate the main task: to calculate a summary table with the total purchase for each online store.</p><p id="0909" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I will break down this task into the following steps:</p><ol class=""><li id="bc73" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx op oq or bk">Data preparation and DataFrame creation.</li><li id="115c" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Summary statistics of the DataFrame.</li><li id="1e53" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Retrieving the first five records.</li><li id="f4e0" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Renaming columns.</li><li id="a3c5" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Changing column types.</li><li id="a445" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Filling missing values.</li><li id="46d0" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Removing missing values.</li><li id="fe67" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Removing duplicate records.</li><li id="9b94" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Filtering data.</li><li id="4762" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Selecting the required columns.</li><li id="cb69" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Grouping data.</li><li id="eded" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Merging data with another DataFrame.</li><li id="00eb" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Calculating a new column.</li><li id="5adb" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx op oq or bk">Creating a Pivot table.</li></ol><p id="a154" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Let’s get started!</p><h2 id="a4c2" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Data Preparation and DataFrame Creation</strong></h2><p id="45de" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">We have the following data:</p><ul class=""><li id="ec6f" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx px oq or bk"><code class="cx py pz qa qb b">OnlineStore</code> — indicates the store.</li><li id="238f" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx px oq or bk"><code class="cx py pz qa qb b">product</code> — stores the product ID.</li><li id="2b5a" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx px oq or bk"><code class="cx py pz qa qb b">Action type</code> — the type of action (either a view or a purchase).</li><li id="8867" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx px oq or bk"><code class="cx py pz qa qb b">quantity</code> — the amount of the purchased or viewed product.</li><li id="ff30" class="nc nd fq ne b go os ng nh gr ot nj nk nl ou nn no np ov nr ns nt ow nv nw nx px oq or bk"><code class="cx py pz qa qb b">Action_time</code> — the timestamp for the action.</li></ul><p id="00e9" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">Requirements:</strong></p><blockquote class="qc qd qe"><p id="8406" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><em class="fq">polars==1.6.0<br/>pandas==2.0.0</em></p></blockquote><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="bd9f" class="qj oy fq qb b bg qk ql l qm qn">from dataclasses import dataclass<br/>from datetime import datetime, timedelta<br/>from random import choice, gauss, randrange, seed<br/>from typing import Any, Dict<br/><br/>import polars as pl<br/>import pandas as pd<br/><br/>seed(42)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="18ad" class="qj oy fq qb b bg qk ql l qm qn">base_time= datetime(2024, 8, 31, 0, 0, 0, 0)<br/><br/>user_actions_data = [<br/>    {<br/>        "OnlineStore": choice(["Shop1", "Shop2", "Shop3"]),<br/>        "product": choice(["0001", "0002", "0003"]),<br/>        "quantity": choice([1.0, 2.0, 3.0]),<br/>        "Action type": ("purchase" if gauss() &gt; 0.6 else "view"),<br/>        "Action_time": base_time - timedelta(minutes=randrange(1_000_000)),<br/>    }<br/>    for x in range(1_000_000)<br/>]<br/><br/>corrupted_data = [<br/>    {<br/>        "OnlineStore": choice(["Shop1", "Shop2", "Shop3"]),<br/>        "product": choice(["0001", None]),<br/>        "quantity": choice([1.0, None]),<br/>        "Action type": ("purchase" if gauss() &gt; 0.6 else "view"),<br/>        "Action_time": base_time - timedelta(minutes=randrange(1_000)),<br/>    }<br/>    for x in range(1_000)<br/>]</span></pre><p id="2984" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">For product catalog, which in our case include only <code class="cx py pz qa qb b">product_id</code> and its price (<code class="cx py pz qa qb b">price</code>).</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="e4b4" class="qj oy fq qb b bg qk ql l qm qn">product_catalog_data = {"product_id": ["0001", "0002", "0003"], "price": [100, 25, 80]}</span></pre><p id="7852" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The data is ready. Now let’s create DataFrames using these data with Pandas and Polars:</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="60b4" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = pd.DataFrame(user_actions_data)<br/>corrupted_pd_df = pd.DataFrame(corrupted_data)<br/>product_catalog_pd_df = pd.DataFrame(product_catalog_data)<br/><br/># Polars<br/>user_actions_pl_df = pl.DataFrame(user_actions_data)<br/>corrupted_pl_df = pl.DataFrame(corrupted_data)<br/>product_catalog_pl_df = pl.DataFrame(product_catalog_data)</span></pre><p id="803f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Since we have <code class="cx py pz qa qb b">user_actions_df</code> and <code class="cx py pz qa qb b">corrupted_df</code>, let’s concatenate them into a single DataFrame.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="a503" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = pd.concat([user_actions_pd_df, corrupted_pd_df])<br/><br/># Polars<br/>user_actions_pl_df = pl.concat([user_actions_pl_df, corrupted_pl_df])</span></pre><p id="c516" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In this way, we have easily created DataFrames for further work.</p><blockquote class="qc qd qe"><p id="e2bd" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Of course, each method has its own parameters, so it’s best to have the documentation handy to avoid confusion and use them appropriately.</p></blockquote><h2 id="33a8" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk">Summary Statistics of the DataFrame</h2><p id="dc4a" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">After loading or preparing data, it’s useful to quickly explore the resulting dataset. For summary statistics, the method name remains the same, but the results may differ:</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="0708" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df.describe(include='all')</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="6c87" class="qj oy fq qb b bg qk ql l qm qn">       OnlineStore  product      quantity Action type          Action_time<br/>count      1001000  1000492  1.000510e+06     1001000              1001000<br/>unique           3        3           NaN           2               632335<br/>top          Shop3     0001           NaN        view  2024-08-30 22:02:00<br/>freq        333931   333963           NaN      726623                    9<br/>first          NaN      NaN           NaN         NaN  2022-10-06 13:23:00<br/>last           NaN      NaN           NaN         NaN  2024-08-30 23:58:00<br/>mean           NaN      NaN  1.998925e+00         NaN                  NaN<br/>std            NaN      NaN  8.164457e-01         NaN                  NaN<br/>min            NaN      NaN  1.000000e+00         NaN                  NaN<br/>25%            NaN      NaN  1.000000e+00         NaN                  NaN<br/>50%            NaN      NaN  2.000000e+00         NaN                  NaN<br/>75%            NaN      NaN  3.000000e+00         NaN                  NaN<br/>max            NaN      NaN  3.000000e+00         NaN                  NaN</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="4d42" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df.describe()</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="52c1" class="qj oy fq qb b bg qk ql l qm qn">┌────────────┬─────────────┬─────────┬───────────┬─────────────┬────────────────────────────┐<br/>│ statistic  ┆ OnlineStore ┆ product ┆ quantity  ┆ Action type ┆ Action_time                │<br/>│ ---        ┆ ---         ┆ ---     ┆ ---       ┆ ---         ┆ ---                        │<br/>│ str        ┆ str         ┆ str     ┆ f64       ┆ str         ┆ str                        │<br/>╞════════════╪═════════════╪═════════╪═══════════╪═════════════╪════════════════════════════╡<br/>│ count      ┆ 1001000     ┆ 1000492 ┆ 1.00051e6 ┆ 1001000     ┆ 1001000                    │<br/>│ null_count ┆ 0           ┆ 508     ┆ 490.0     ┆ 0           ┆ 0                          │<br/>│ mean       ┆ null        ┆ null    ┆ 1.998925  ┆ null        ┆ 2023-09-19 03:24:30.981698 │<br/>│ std        ┆ null        ┆ null    ┆ 0.816446  ┆ null        ┆ null                       │<br/>│ min        ┆ Shop1       ┆ 1       ┆ 1.0       ┆ purchase    ┆ 2022-10-06 13:23:00        │<br/>│ 25%        ┆ null        ┆ null    ┆ 1.0       ┆ null        ┆ 2023-03-29 03:09:00        │<br/>│ 50%        ┆ null        ┆ null    ┆ 2.0       ┆ null        ┆ 2023-09-19 06:49:00        │<br/>│ 75%        ┆ null        ┆ null    ┆ 3.0       ┆ null        ┆ 2024-03-11 03:01:00        │<br/>│ max        ┆ Shop3       ┆ 3       ┆ 3.0       ┆ view        ┆ 2024-08-30 23:58:00        │<br/>└────────────┴─────────────┴─────────┴───────────┴─────────────┴────────────────────────────┘</span></pre><p id="ec44" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">As you can notice, Pandas calculates statistics differently for various data types and provides <code class="cx py pz qa qb b">unique</code> values for all columns. Polars, on the other hand, calculates the <code class="cx py pz qa qb b">null_count</code> value.</p><p id="da30" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Additionally, in the <a class="af qp" href="https://docs.pola.rs/api/python/dev/reference/dataframe/api/polars.DataFrame.describe.html#polars.DataFrame.describe" rel="noopener ugc nofollow" target="_blank">Polars documentation</a>, it is stated:</p><blockquote class="qc qd qe"><p id="74bf" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We do not guarantee the output of <code class="cx py pz qa qb b">describe</code> to be stable. It will show statistics that we deem informative, and may be updated in the future. Using <code class="cx py pz qa qb b">describe</code> programmatically (versus interactive exploration) is not recommended for this reason.</p></blockquote><h2 id="2424" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Retrieving the First Five Records</strong></h2><p id="2abf" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">When encountering data for the first time, we always want to explore it. Beyond obtaining summary statistics, it’s also important to see the actual records it contains. To do this, we often look at the first five records as a sample.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="9681" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df.head()</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="a195" class="qj oy fq qb b bg qk ql l qm qn">  OnlineStore product  quantity Action type         Action_time<br/>0       Shop3    0001       1.0        view 2024-05-21 09:24:00<br/>1       Shop3    0001       3.0        view 2023-03-10 15:54:00<br/>2       Shop3    0001       3.0        view 2024-03-24 19:02:00<br/>3       Shop1    0003       3.0        view 2024-08-11 16:16:00<br/>4       Shop3    0001       3.0        view 2024-03-23 11:32:00</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="507c" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df.head()</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="d1d5" class="qj oy fq qb b bg qk ql l qm qn">┌─────────────┬─────────┬──────────┬─────────────┬─────────────────────┐<br/>│ OnlineStore ┆ product ┆ quantity ┆ Action type ┆ Action_time         │<br/>│ ---         ┆ ---     ┆ ---      ┆ ---         ┆ ---                 │<br/>│ str         ┆ str     ┆ f64      ┆ str         ┆ datetime[μs]        │<br/>╞═════════════╪═════════╪══════════╪═════════════╪═════════════════════╡<br/>│ Shop3       ┆ 0001    ┆ 1.0      ┆ view        ┆ 2024-05-21 09:24:00 │<br/>│ Shop3       ┆ 0001    ┆ 3.0      ┆ view        ┆ 2023-03-10 15:54:00 │<br/>│ Shop3       ┆ 0001    ┆ 3.0      ┆ view        ┆ 2024-03-24 19:02:00 │<br/>│ Shop1       ┆ 0003    ┆ 3.0      ┆ view        ┆ 2024-08-11 16:16:00 │<br/>│ Shop3       ┆ 0001    ┆ 3.0      ┆ view        ┆ 2024-03-23 11:32:00 │<br/>└─────────────┴─────────┴──────────┴─────────────┴─────────────────────┘</span></pre><p id="83db" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Polars has a useful <code class="cx py pz qa qb b">glimpse()</code> function that provides a dense preview of the DataFrame. It not only returns the first 10 records (or any number you specify using the <code class="cx py pz qa qb b">max_items_per_column</code> parameter) but also shows data types and record counts.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="761e" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df.glimpse()</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="9472" class="qj oy fq qb b bg qk ql l qm qn">Rows: 1001000<br/>Columns: 5<br/>$ OnlineStore          &lt;str&gt; 'Shop3', 'Shop3', 'Shop3', 'Shop1', 'Shop3', 'Shop2', 'Shop1', 'Shop2', 'Shop1', 'Shop2'<br/>$ product              &lt;str&gt; '0001', '0001', '0001', '0003', '0001', '0003', '0001', '0001', '0002', '0003'<br/>$ quantity             &lt;f64&gt; 1.0, 3.0, 3.0, 3.0, 3.0, 2.0, 3.0, 1.0, 2.0, 1.0<br/>$ Action type          &lt;str&gt; 'view', 'view', 'view', 'view', 'view', 'view', 'view', 'view', 'view', 'view'<br/>$ Action_time &lt;datetime[μs]&gt; 2024-05-21 09:24:00, 2023-03-10 15:54:00, 2024-03-24 19:02:00, 2024-08-11 16:16:00, 2024-03-23 11:32:00, 2023-01-19 14:11:00, 2024-03-27 05:08:00, 2023-11-28 08:18:00, 2023-03-18 15:01:00, 2022-10-29 09:44:00</span></pre><h2 id="73bf" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Renaming Columns</strong></h2><p id="4340" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">After exploring the data, it is often necessary to edit it for further use. If the column names are not satisfactory or if your company has its own naming conventions, you can easily rename them.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="806d" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = user_actions_pd_df.rename(<br/>    columns={<br/>        "OnlineStore": "online_store",<br/>        "product": "product_id",<br/>        "Action type": "action_type",<br/>        "Action_time": "action_dt",<br/>    }<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="0bba" class="qj oy fq qb b bg qk ql l qm qn"># user_actions_pd_df.columns<br/>Index(['online_store', 'product_id', 'quantity', 'action_type', 'action_dt'], dtype='object')</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="3f49" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.rename(<br/>    {<br/>        "OnlineStore": "online_store",<br/>        "product": "product_id",<br/>        "Action type": "action_type",<br/>        "Action_time": "action_dt",<br/>    }<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="58b3" class="qj oy fq qb b bg qk ql l qm qn"># user_actions_pl_df.columns<br/>['online_store', 'product_id', 'quantity', 'action_type', 'action_dt']</span></pre><h2 id="253c" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Changing Column Types</strong></h2><p id="85ac" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">When working with data, optimizing their processing is often a priority, and data types are no exception. Choosing the right type not only unlocks available functions but also saves memory. In our example, I will change the column type of <code class="cx py pz qa qb b">quantity</code> from <code class="cx py pz qa qb b">float</code> to <code class="cx py pz qa qb b">int</code>. In Pandas, you would use the <code class="cx py pz qa qb b">astype()</code> method, while in Polars, you use the <code class="cx py pz qa qb b">cast()</code> method.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="e430" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = user_actions_pd_df.astype({"quantity": "Int64"})</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="523d" class="qj oy fq qb b bg qk ql l qm qn">Int64Index: 1001000 entries, 0 to 999<br/>Data columns (total 5 columns):<br/> #   Column        Non-Null Count    Dtype         <br/>---  ------        --------------    -----         <br/> 0   online_store  1001000 non-null  object        <br/> 1   product_id    1000492 non-null  object        <br/> 2   quantity      1000510 non-null  Int64         <br/> 3   action_type   1001000 non-null  object        <br/> 4   action_dt     1001000 non-null  datetime64[ns]<br/>dtypes: Int64(1), datetime64[ns](1), object(3)<br/>memory usage: 46.8+ MB</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="88e4" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.cast({"quantity": pl.Int32})</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="c8f4" class="qj oy fq qb b bg qk ql l qm qn">Rows: 1001000<br/>Columns: 5<br/>$ online_store          &lt;str&gt; <br/>$ product_id            &lt;str&gt; <br/>$ quantity              &lt;i32&gt; <br/>$ action_type           &lt;str&gt; <br/>$ action_dt    &lt;datetime[μs]&gt; </span></pre><blockquote class="qc qd qe"><p id="4016" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Polars has a special method <code class="cx py pz qa qb b">estimated_size()</code> that returns an estimate of the total (heap) allocated size of the DataFrame. For example:</p></blockquote><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="f67e" class="qj oy fq qb b bg qk ql l qm qn">user_actions_pl_df.estimated_size("mb")<br/># Result: 24.91054630279541</span></pre><p id="2c99" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Although the method names for changing types differ, SQL enthusiasts will appreciate the ease of transition.</p><h2 id="9edd" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk">Filling<strong class="al"> Missing Values</strong></h2><p id="4676" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">In real projects, data is rarely perfect, and we often discuss with managers, analysts, and other systems how to interpret data behavior. During data preparation, I specifically generated <code class="cx py pz qa qb b">corrupted_data</code> to introduce some chaos into the data. Handling missing values could easily be the subject of an entire book.</p><p id="44f2" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">There are several strategies for filling in missing values, and the choice of method depends on the task: sometimes filling missing values with zeros is sufficient, while other times the mean value may be used. In Polars, the <code class="cx py pz qa qb b">fill_null()</code> method can be applied both to the DataFrame and to specific columns. To add a new column or replace values in an existing one, the <code class="cx py pz qa qb b">with_columns()</code> method is also used.</p><p id="8199" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In our example, I will fill missing values in the <code class="cx py pz qa qb b">quantity</code> column with 0:</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="f877" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df["quantity"].fillna(0, inplace=True)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="ea0a" class="qj oy fq qb b bg qk ql l qm qn">Data columns (total 5 columns):<br/> #   Column        Non-Null Count    Dtype         <br/>---  ------        --------------    -----         <br/> 0   online_store  1001000 non-null  object        <br/> 1   product_id    1000492 non-null  object        <br/> 2   quantity      1001000 non-null  Int64         <br/> 3   action_type   1001000 non-null  object        <br/> 4   action_dt     1001000 non-null  datetime64[ns]<br/>dtypes: Int64(1), datetime64[ns](1), object(3)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="856f" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.with_columns(pl.col("quantity").fill_null(0))</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="83ed" class="qj oy fq qb b bg qk ql l qm qn">┌────────────┬──────────────┬────────────┬──────────┬─────────────┬────────────────────────────┐<br/>│ statistic  ┆ online_store ┆ product_id ┆ quantity ┆ action_type ┆ action_dt                  │<br/>│ ---        ┆ ---          ┆ ---        ┆ ---      ┆ ---         ┆ ---                        │<br/>│ str        ┆ str          ┆ str        ┆ f64      ┆ str         ┆ str                        │<br/>╞════════════╪══════════════╪════════════╪══════════╪═════════════╪════════════════════════════╡<br/>│ count      ┆ 1001000      ┆ 1000492    ┆ 1.001e6  ┆ 1001000     ┆ 1001000                    │<br/>│ null_count ┆ 0            ┆ 508        ┆ 0.0      ┆ 0           ┆ 0                          │<br/>└────────────┴──────────────┴────────────┴──────────┴─────────────┴────────────────────────────┘</span></pre><blockquote class="qc qd qe"><p id="fa7d" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In Polars, you can use various strategies for filling missing values in the data, such as: <code class="cx py pz qa qb b">{None, 'forward', 'backward', 'min', 'max', 'mean', 'zero', 'one'}</code>. The names of these strategies are self-explanatory, so we won’t delve into their details.</p></blockquote><p id="2f06" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">It’s also worth noting that for filling <code class="cx py pz qa qb b">NaN</code> values in floating-point columns, you should use the <code class="cx py pz qa qb b">fill_nan()</code> method, which does not involve strategies.</p><h2 id="da7b" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Removing Missing Values</strong></h2><p id="489e" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">Not all missing values can be filled, so those that cannot be correctly filled and used in further calculations are best removed. In our case, this applies to the <code class="cx py pz qa qb b">product_id</code> column, as we cannot compute the final result without this identifier.</p><p id="6a93" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">To remove rows with missing values in Pandas and Polars, use the following methods:</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="c6ac" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df.dropna(subset=["product_id"], inplace=True)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="3dcb" class="qj oy fq qb b bg qk ql l qm qn">Int64Index: 1000492 entries, 0 to 999<br/>Data columns (total 5 columns):<br/> #   Column        Non-Null Count    Dtype         <br/>---  ------        --------------    -----         <br/> 0   online_store  1000492 non-null  object        <br/> 1   product_id    1000492 non-null  object        <br/> 2   quantity      1000492 non-null  Int64         <br/> 3   action_type   1000492 non-null  object        <br/> 4   action_dt     1000492 non-null  datetime64[ns]<br/>dtypes: Int64(1), datetime64[ns](1), object(3)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="2554" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.drop_nulls(subset=["product_id"])</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="02e1" class="qj oy fq qb b bg qk ql l qm qn">┌────────────┬──────────────┬────────────┬────────────┬─────────────┬────────────────────────────┐<br/>│ statistic  ┆ online_store ┆ product_id ┆ quantity   ┆ action_type ┆ action_dt                  │<br/>│ ---        ┆ ---          ┆ ---        ┆ ---        ┆ ---         ┆ ---                        │<br/>│ str        ┆ str          ┆ str        ┆ f64        ┆ str         ┆ str                        │<br/>╞════════════╪══════════════╪════════════╪════════════╪═════════════╪════════════════════════════╡<br/>│ count      ┆ 1000492      ┆ 1000492    ┆ 1.000492e6 ┆ 1000492     ┆ 1000492                    │<br/>│ null_count ┆ 0            ┆ 0          ┆ 0.0        ┆ 0           ┆ 0                          │<br/>└────────────┴──────────────┴────────────┴────────────┴─────────────┴────────────────────────────┘</span></pre><p id="d17d" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">It’s also worth noting that to remove <code class="cx py pz qa qb b">NaN</code> values in floating-point columns, you should use the <code class="cx py pz qa qb b">drop_nans()</code> method.</p><h2 id="947b" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Removing Duplicate Records</strong></h2><p id="23dc" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">The simplest case of duplicate records occurs when all values of one record are identical to another. In our case, duplicates might arise if the same action is recorded multiple times for the same action type in the same online store at a single point in time. I will keep only the most recent value in case duplicates are found.</p><p id="1737" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">To remove duplicate records in Pandas, use the <code class="cx py pz qa qb b">drop_duplicates()</code> method, and in Polars, the <code class="cx py pz qa qb b">unique()</code> method.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="dc31" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df.drop_duplicates(<br/>    subset=["online_store", "action_type", "action_dt"],<br/>    keep="last",<br/>    inplace=True,<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="dca2" class="qj oy fq qb b bg qk ql l qm qn">Data columns (total 5 columns):<br/> #   Column        Non-Null Count   Dtype         <br/>---  ------        --------------   -----         <br/> 0   online_store  907246 non-null  object        <br/> 1   product_id    907246 non-null  object        <br/> 2   quantity      907246 non-null  Int64         <br/> 3   action_type   907246 non-null  object        <br/> 4   action_dt     907246 non-null  datetime64[ns]<br/>dtypes: Int64(1), datetime64[ns](1), object(3)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="97c4" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.unique(<br/>    subset=["online_store", "action_type", "action_dt"],<br/>    keep="last",<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="f697" class="qj oy fq qb b bg qk ql l qm qn">┌────────────┬──────────────┬────────────┬──────────┬─────────────┬────────────────────────────┐<br/>│ statistic  ┆ online_store ┆ product_id ┆ quantity ┆ action_type ┆ action_dt                  │<br/>│ ---        ┆ ---          ┆ ---        ┆ ---      ┆ ---         ┆ ---                        │<br/>│ str        ┆ str          ┆ str        ┆ f64      ┆ str         ┆ str                        │<br/>╞════════════╪══════════════╪════════════╪══════════╪═════════════╪════════════════════════════╡<br/>│ count      ┆ 907246       ┆ 907246     ┆ 907246.0 ┆ 907246      ┆ 907246                     │<br/>│ null_count ┆ 0            ┆ 0          ┆ 0.0      ┆ 0           ┆ 0                          │<br/>└────────────┴──────────────┴────────────┴──────────┴─────────────┴────────────────────────────┘</span></pre><h2 id="2a7b" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Filtering Data</strong></h2><p id="5a6f" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">After the data cleaning phase, we need to filter the relevant data for future calculations. In Polars, this is done using the method with a quite descriptive name, <code class="cx py pz qa qb b">filter()</code>.</p><blockquote class="qc qd qe"><p id="1e57" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Rows where the filter does not evaluate to True are discarded, including nulls.</p></blockquote><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="f3eb" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = user_actions_pd_df.loc[<br/>    user_actions_pd_df["action_type"] == "purchase"<br/>]</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="a365" class="qj oy fq qb b bg qk ql l qm qn">Int64Index: 262237 entries, 11 to 995<br/>Data columns (total 5 columns):<br/> #   Column        Non-Null Count   Dtype         <br/>---  ------        --------------   -----         <br/> 0   online_store  262237 non-null  object        <br/> 1   product_id    262237 non-null  object        <br/> 2   quantity      262237 non-null  Int64         <br/> 3   action_type   262237 non-null  object        <br/> 4   action_dt     262237 non-null  datetime64[ns]<br/>dtypes: Int64(1), datetime64[ns](1), object(3)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="182c" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.filter(<br/>    pl.col("action_type") == "purchase"<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="5f7d" class="qj oy fq qb b bg qk ql l qm qn">┌────────────┬──────────────┬────────────┬──────────┬─────────────┬────────────────────────────┐<br/>│ statistic  ┆ online_store ┆ product_id ┆ quantity ┆ action_type ┆ action_dt                  │<br/>│ ---        ┆ ---          ┆ ---        ┆ ---      ┆ ---         ┆ ---                        │<br/>│ str        ┆ str          ┆ str        ┆ f64      ┆ str         ┆ str                        │<br/>╞════════════╪══════════════╪════════════╪══════════╪═════════════╪════════════════════════════╡<br/>│ count      ┆ 262237       ┆ 262237     ┆ 262237.0 ┆ 262237      ┆ 262237                     │<br/>│ null_count ┆ 0            ┆ 0          ┆ 0.0      ┆ 0           ┆ 0                          │<br/>└────────────┴──────────────┴────────────┴──────────┴─────────────┴────────────────────────────┘</span></pre><h2 id="76ae" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Selecting Required Columns</strong></h2><p id="3d49" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">After filtering the data, you may need to retain only the columns relevant for further analysis. In Polars, this is achieved using the <code class="cx py pz qa qb b">select()</code> method.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="268c" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = user_actions_pd_df[<br/>    ["online_store", "action_type", "product_id", "quantity"]<br/>]</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="35eb" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.select(<br/>    "online_store", "action_type", "product_id", "quantity"<br/>)</span></pre><h2 id="84b0" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Grouping Data</strong></h2><p id="8429" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">After preparing the data, we can aggregate it to get the sum of <code class="cx py pz qa qb b">quantity</code> for each online store and product. I will also retain <code class="cx py pz qa qb b">action_type</code> for further steps. We use the <code class="cx py pz qa qb b">group_by()</code> method in Polars, which is similar to the <code class="cx py pz qa qb b">groupby()</code> method in Pandas.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="c0a6" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = (<br/>    user_actions_pd_df.groupby(["online_store", "product_id", "action_type"])<br/>    .agg({"quantity": "sum"})<br/>    .reset_index()<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="7923" class="qj oy fq qb b bg qk ql l qm qn">  online_store product_id action_type  quantity<br/>0        Shop1       0001    purchase     57772<br/>1        Shop1       0002    purchase     58015<br/>2        Shop1       0003    purchase     58242<br/>3        Shop2       0001    purchase     58256<br/>4        Shop2       0002    purchase     58648<br/>5        Shop2       0003    purchase     58458<br/>6        Shop3       0001    purchase     57891<br/>7        Shop3       0002    purchase     58326<br/>8        Shop3       0003    purchase     59107</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="78c5" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = (<br/>    user_actions_pl_df.group_by(["online_store", "product_id", "action_type"])<br/>    .agg(pl.col("quantity").sum())<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="48d5" class="qj oy fq qb b bg qk ql l qm qn">┌──────────────┬────────────┬─────────────┬──────────┐<br/>│ online_store ┆ product_id ┆ action_type ┆ quantity │<br/>│ ---          ┆ ---        ┆ ---         ┆ ---      │<br/>│ str          ┆ str        ┆ str         ┆ i32      │<br/>╞══════════════╪════════════╪═════════════╪══════════╡<br/>│ Shop1        ┆ 0001       ┆ purchase    ┆ 57772    │<br/>│ Shop1        ┆ 0002       ┆ purchase    ┆ 58015    │<br/>│ Shop1        ┆ 0003       ┆ purchase    ┆ 58242    │<br/>│ Shop2        ┆ 0001       ┆ purchase    ┆ 58256    │<br/>│ Shop2        ┆ 0002       ┆ purchase    ┆ 58648    │<br/>│ Shop2        ┆ 0003       ┆ purchase    ┆ 58458    │<br/>│ Shop3        ┆ 0001       ┆ purchase    ┆ 57891    │<br/>│ Shop3        ┆ 0002       ┆ purchase    ┆ 58326    │<br/>│ Shop3        ┆ 0003       ┆ purchase    ┆ 59107    │<br/>└──────────────┴────────────┴─────────────┴──────────┘</span></pre><h2 id="646c" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Joining Data with Another DataFrame</strong></h2><p id="e61f" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">To calculate the total purchases, we need to join our data with the price catalog. In Pandas, we have two methods for this, <code class="cx py pz qa qb b">join()</code> and <code class="cx py pz qa qb b">merge()</code>, which differ in their specifics and functionality. In Polars, we use only the <code class="cx py pz qa qb b">join()</code> method.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="5185" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df = user_actions_pd_df.merge(product_catalog_pd_df, on='product_id')</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="0aaa" class="qj oy fq qb b bg qk ql l qm qn">  online_store product_id action_type  quantity  price<br/>0        Shop1       0001    purchase     57772    100<br/>3        Shop1       0002    purchase     58015     25<br/>6        Shop1       0003    purchase     58242     80<br/>1        Shop2       0001    purchase     58256    100<br/>4        Shop2       0002    purchase     58648     25<br/>7        Shop2       0003    purchase     58458     80<br/>2        Shop3       0001    purchase     57891    100<br/>5        Shop3       0002    purchase     58326     25<br/>8        Shop3       0003    purchase     59107     80</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="9bb8" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.join(product_catalog_pl_df, on='product_id')</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="8f7c" class="qj oy fq qb b bg qk ql l qm qn">┌──────────────┬────────────┬─────────────┬──────────┬───────┐<br/>│ online_store ┆ product_id ┆ action_type ┆ quantity ┆ price │<br/>│ ---          ┆ ---        ┆ ---         ┆ ---      ┆ ---   │<br/>│ str          ┆ str        ┆ str         ┆ i32      ┆ i64   │<br/>╞══════════════╪════════════╪═════════════╪══════════╪═══════╡<br/>│ Shop1        ┆ 0001       ┆ purchase    ┆ 57772    ┆ 100   │<br/>│ Shop1        ┆ 0002       ┆ purchase    ┆ 58015    ┆ 25    │<br/>│ Shop1        ┆ 0003       ┆ purchase    ┆ 58242    ┆ 80    │<br/>│ Shop2        ┆ 0001       ┆ purchase    ┆ 58256    ┆ 100   │<br/>│ Shop2        ┆ 0002       ┆ purchase    ┆ 58648    ┆ 25    │<br/>│ Shop2        ┆ 0003       ┆ purchase    ┆ 58458    ┆ 80    │<br/>│ Shop3        ┆ 0001       ┆ purchase    ┆ 57891    ┆ 100   │<br/>│ Shop3        ┆ 0002       ┆ purchase    ┆ 58326    ┆ 25    │<br/>│ Shop3        ┆ 0003       ┆ purchase    ┆ 59107    ┆ 80    │<br/>└──────────────┴────────────┴─────────────┴──────────┴───────┘</span></pre><blockquote class="qc qd qe"><p id="26e0" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In Polars, the <code class="cx py pz qa qb b">how</code> parameter supports the following values: <code class="cx py pz qa qb b">{'inner', 'left', 'right', 'full', 'semi', 'anti', 'cross'}</code> .</p></blockquote><h2 id="bd90" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Calculating a New Column</strong></h2><p id="5273" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">To calculate a new column or modify an existing column, Polars uses the <code class="cx py pz qa qb b">with_columns()</code> method. To set an alias for a column, you can use <code class="cx py pz qa qb b">alias()</code>.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="d8a0" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>user_actions_pd_df["total"] = (<br/>    user_actions_pd_df["price"] * user_actions_pd_df["quantity"]<br/>)<br/>user_actions_pd_df = user_actions_pd_df[<br/>    ["online_store", "action_type", "total"]<br/>]</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="54da" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.with_columns(<br/>    (pl.col("price") * pl.col("quantity")).alias("total")<br/>)<br/>user_actions_pl_df = user_actions_pl_df.select(<br/>    "online_store", "action_type", "total"<br/>)</span></pre><p id="d96c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Alternatively, you can calculate a new column directly within the <code class="cx py pz qa qb b">select()</code> method:</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="f214" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>user_actions_pl_df = user_actions_pl_df.select(<br/>    "online_store",<br/>    "action_type",<br/>    (pl.col("price") * pl.col("quantity")).alias("total"),<br/>)</span></pre><h2 id="ff0a" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk"><strong class="al">Creating a Pivot Table</strong></h2><p id="00d6" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">Our final step is to create a pivot table. We have already calculated the total sales for each product, and now we will easily calculate the total sales for each online store. In Pandas, we use the <code class="cx py pz qa qb b">pivot_table()</code> method, which allows for the application of aggregate functions. In Polars, we use the <code class="cx py pz qa qb b">pivot()</code> method to create the pivot table.</p><pre class="mm mn mo mp mq qg qb qh bp qi bb bk"><span id="a0c6" class="qj oy fq qb b bg qk ql l qm qn"># Pandas<br/>result_pd = user_actions_pd_df.pivot_table(<br/>    columns="online_store",<br/>    index="action_type",<br/>    values="total",<br/>    aggfunc="sum",<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="71b0" class="qj oy fq qb b bg qk ql l qm qn">online_store     Shop1     Shop2     Shop3<br/>action_type                               <br/>purchase      11886935  11968440  11975810</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="47c3" class="qj oy fq qb b bg qk ql l qm qn"># Polars<br/>result_pl = user_actions_pl_df.pivot(<br/>    columns="online_store",<br/>    index="action_type",<br/>    values="total",<br/>    aggregate_function="sum",<br/>)</span></pre><pre class="qo qg qb qh bp qi bb bk"><span id="0f31" class="qj oy fq qb b bg qk ql l qm qn">┌─────────────┬──────────┬──────────┬──────────┐<br/>│ action_type ┆ Shop1    ┆ Shop2    ┆ Shop3    │<br/>│ ---         ┆ ---      ┆ ---      ┆ ---      │<br/>│ str         ┆ i64      ┆ i64      ┆ i64      │<br/>╞═════════════╪══════════╪══════════╪══════════╡<br/>│ purchase    ┆ 11886935 ┆ 11968440 ┆ 11975810 │<br/>└─────────────┴──────────┴──────────┴──────────┘</span></pre><blockquote class="qc qd qe"><p id="0af1" class="nc nd qf ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">DeprecationWarning: The argument <code class="cx py pz qa qb b">columns</code> for pl.DataFrame.pivot` is deprecated. It has been renamed to <code class="cx py pz qa qb b">on</code>.</p></blockquote><p id="9836" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Here we are, concluding our little journey. As we can see, the results for both Pandas and Polars match. Everyone who made it to this point is great and incredibly hardworking — you will succeed!</p><h2 id="1fc2" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk">Summary</h2><p id="7793" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">In this article, we explored Polars using practical examples and comparisons with Pandas. I demonstrated how to handle data preparation, descriptive statistics, missing values, duplicates, filtering, column selection, grouping, merging, and pivot tables. By showcasing these tasks with both Pandas and Polars, I highlighted the ease of using Polars and transitioning to it from Pandas. This guide serves as a practical introduction to leveraging Polars for efficient data analysis.</p><h2 id="b466" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk">Recommended read:</h2><ul class=""><li id="f81c" class="nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx px oq or bk"><a class="af qp" href="https://medium.com/towards-data-science/improving-code-quality-during-data-transformation-with-polars-92997e67c8a9" rel="noopener">Improving Code Quality During Data Transformation with Polars</a></li></ul><h2 id="ed0e" class="ox oy fq bf oz pa pb pc pd pe pf pg ph nl pi pj pk np pl pm pn nt po pp pq pr bk">Thanks for Reading!</h2><p id="b882" class="pw-post-body-paragraph nc nd fq ne b go ps ng nh gr pt nj nk nl pu nn no np pv nr ns nt pw nv nw nx fj bk">If you enjoyed this article and want to support my work, the best way is to follow me on <a class="af qp" href="https://medium.com/@npotapov" rel="noopener">Medium</a>. Let’s connect on <a class="af qp" href="https://www.linkedin.com/in/nikolai-potapov-67269524b/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> if you’re also interested in working with data like I am. Your claps are greatly appreciated — they help me know how useful this post was for you.</p></div></div></div></div>    
</body>
</html>