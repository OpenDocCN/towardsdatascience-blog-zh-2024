<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>About Calculating Sales depending on Another Value in DAX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>About Calculating Sales depending on Another Value in DAX</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/about-calculating-sales-depending-on-another-value-in-dax-914deb450d23?source=collection_archive---------9-----------------------#2024-01-18">https://towardsdatascience.com/about-calculating-sales-depending-on-another-value-in-dax-914deb450d23?source=collection_archive---------9-----------------------#2024-01-18</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="ea6e" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx"><em class="hd">Our usual Measures aggregate the Values from columns in one Fact table. But what is needed to calculate a result that depends on Data in another Fact table? Let’s look at a possible solution.</em></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@salvatorecagliari?source=post_page---byline--914deb450d23--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Salvatore Cagliari" class="l ep by dd de cx" src="../Images/a24b0cefab6e707cfee06cde9e857559.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/da:true/resize:fill:88:88/0*pOkUYGxmbbFyWocH"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--914deb450d23--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://medium.com/@salvatorecagliari?source=post_page---byline--914deb450d23--------------------------------" rel="noopener follow">Salvatore Cagliari</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--914deb450d23--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">8 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 18, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk lb lc ab q ee ld le" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap ie li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/45ea30c39f5de4fab1569c22c2102c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QLzL-GTDO-AuFk5n"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@isaacmsmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Isaac Smith</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="4ba3" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Introduction</h1><p id="e9df" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">What is needed to calculate a result based on a specific value in DAX?</p><p id="289a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Simple: A filter.</p><p id="16db" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But what if the filter has to be a table?</p><p id="ba22" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Fortunately, I already know how to work with tables in DAX Measures:</p><div class="pa pb pc pd pe pf"><a rel="noopener follow" target="_blank" href="/on-using-intermediary-results-in-dax-measures-9971efa72ae?source=post_page-----914deb450d23--------------------------------"><div class="pg ab ih"><div class="ph ab co cb pi pj"><h2 class="bf fr hx z ip pk ir is pl iu iw fp bk">On using intermediary results in DAX Measures</h2><div class="pm l"><h3 class="bf b hx z ip pk ir is pl iu iw dx">We use table variables in DAX all the time. What if we must calculate intermediary results and reuse them in a DAX…</h3></div><div class="pn l"><p class="bf b dy z ip pk ir is pl iu iw dx">towardsdatascience.com</p></div></div><div class="po l"><div class="pp l pq pr ps po pt lr pf"/></div></div></a></div><p id="6e33" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">And now, my client gave me a challenge to put my knowledge to the test:</p><p id="035d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Look at the following Report:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pu"><img src="../Images/16bf481118051d54e12d94515a99c9d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gor4nTgIrHIqkCWuWZPrxw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 1 — Online vs Retail Sales and sold products (Figure by the Author)</figcaption></figure><p id="89e5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you can see, the number of products sold differs between Online and Retail Sales.</p><p id="4cf4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">My client asked the following questions:</p><ul class=""><li id="b76b" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pv pw px bk">What is the Online Sales Amount for the Products sold in Retail Stores as well?</li><li id="0850" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">And which Products are sold only Online?</li></ul><h1 id="ed7d" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Trying to solve it in Power BI with Filters</h1><p id="4aa9" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Can I answer the first question in Power BI by applying a Filter on the left table like this?</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qd"><img src="../Images/2049a3eec6ee685b06bdaa88035954df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*9UruLY62bRohSWxR38BPPA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 2 — Applying a Filter in Power BI filtering by the Retail Sales Measure (Figure by the Author)</figcaption></figure><p id="2603" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Unfortunately, this doesn’t work.</p><p id="b22d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The reason is that no Relationship connects these two tables, and the Filter direction to Dimension tables works only in one direction.</p><p id="7eaa" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Yes, I could change it to bidirectional filtering. But this can introduce issues as it will not work in any situation.</p><p id="a821" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Another way is to add multiple Measures and add a Filter to the Visual:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qe"><img src="../Images/acf08f12a75a2596a631b7e0a7324d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AsSB_eUGPTmx1dHsQZbsw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 3 — Applying a filter to Power BI with multiple Measures (Figure by the Author)</figcaption></figure><p id="f1b6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This delivers the needed result.</p><p id="232c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I can even change the filter to “Sum Retail Sales <em class="qf">is blank</em>” to get the count of products sold only online together with the Sales.</p><p id="b756" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But the resulting visual contains the Sum Retail Sales Measure, which I don’t want to see. And, when I want to get the number of products sold only online, I will get empty columns for this measure, which is not what I want to see either.</p><p id="1f15" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">So, I must create an explicit DAX Measure to solve the questions above.</p><h1 id="37c5" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Get the result from the source database</h1><p id="9f23" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">But first, I must get a reference result.</p><p id="d760" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I can use this reference result to validate the results when I build the solution.</p><p id="4b24" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I write the following SQL query to get this reference result:</p><pre class="mm mn mo mp mq qg qh qi bp qj bb bk"><span id="0a14" class="qk ne fq qh b bg ql qm l qn qo">WITH [RetailProductsByMonth]<br/>AS<br/>  (SELECT DISTINCT [ProductKey]<br/>            ,[D].[MonthKey]<br/>    FROM [dbo].[FactSales] AS [F]<br/>      INNER JOIN [Date] AS [D]<br/>        ON [D].[Date] = [F].[DateKey]<br/>  )<br/>SELECT [D].[EnglishYearMonthShortName]<br/>      ,[D].[MonthKey]<br/>      ,COUNT(DISTINCT [F].[ProductKey]) AS [ProductCount]<br/>  FROM [dbo].[FactOnlineSales] AS [F]<br/>    INNER JOIN [Date] AS [D]<br/>      ON [D].[Date] = [F].[DateKey]<br/>  INNER JOIN [RetailProductsByMonth] AS [PbM]<br/>      ON [PbM].[ProductKey] = [F].[ProductKey]<br/>      AND [D].[MonthKey] = [PbM].[MonthKey]<br/>  GROUP BY [D].[EnglishYearMonthShortName], [D].[MonthKey]<br/>  ORDER BY [D].[MonthKey] DESC;</span></pre><p id="3fcc" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This is the result:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qp"><img src="../Images/d016e912a8539eba2492eb3391832c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*3BcV4ZwF6UHBJHfqLoji_A.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 4 — Result of the SQL Query to get only the products sold Online and in Stores (Figure by the Author)</figcaption></figure><p id="b868" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To get the count of products sold only Online, I use this SQL Query:</p><pre class="mm mn mo mp mq qg qh qi bp qj bb bk"><span id="7bbc" class="qk ne fq qh b bg ql qm l qn qo">WITH [RetailProductsByMonth]<br/>AS<br/>  (SELECT DISTINCT [ProductKey]<br/>            ,[D].[MonthKey]<br/>      FROM [dbo].[FactSales] AS [F]<br/>        INNER JOIN [Date] AS [D]<br/>          ON [D].[Date] = [F].[DateKey]<br/>  )<br/>SELECT [D].[EnglishYearMonthShortName]<br/>      ,[D].[MonthKey]<br/>      ,COUNT(DISTINCT [F].[ProductKey]) AS [ProductCount]<br/>  FROM [dbo].[FactOnlineSales] AS [F]<br/>    INNER JOIN [Date] AS [D]<br/>      ON [D].[Date] = [F].[DateKey]<br/>    LEFT OUTER JOIN [RetailProductsByMonth] AS [PbM]<br/>      ON [PbM].[ProductKey] = [F].[ProductKey]<br/>      AND [D].[MonthKey] = [PbM].[MonthKey]<br/>  WHERE [PbM].[ProductKey] IS NULL<br/>  GROUP BY [D].[EnglishYearMonthShortName], [D].[MonthKey]<br/>  ORDER BY [D].[MonthKey] DESC;</span></pre><p id="04a1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The result for this query is the following:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qq"><img src="../Images/208abc208c96c901f1458d80815b0b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*Rm-S5e8RnHbDAk3XCgZaHQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 5 — Result of the SQL Query to get only the products sold Online (Figure by the Author)</figcaption></figure><p id="ded1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In both cases, first, I get the list of all sold products for each month for the Retail Sales.<br/>Then, I join the result to the Online Sales table and count the monthly products sold.</p><p id="97ae" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I exclude all products in the Retail Sales Data in the second query.</p><p id="c813" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In both cases, I get the needed reference result, and I can go ahead and write the DAX code in Power BI.</p><h1 id="ee01" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Querying the Data model</h1><p id="e907" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Instead of trying to build Measures in Power BI, I use <a class="af nc" href="https://www.sqlbi.com/tools/dax-studio/" rel="noopener ugc nofollow" target="_blank">DAX Studio</a> to write DAX Queries to construct the solution step by step.</p><p id="afbc" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">First, I want to get all products sold in Retail stores.</p><p id="d110" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As my SQL query group the result per month, I restrict the first query to one month only. This simplifies the needed code as well:</p><pre class="mm mn mo mp mq qg qh qi bp qj bb bk"><span id="de11" class="qk ne fq qh b bg ql qm l qn qo">DEFINE<br/>  VAR MonthSelection = 202311<br/><br/>EVALUATE<br/>  CALCULATETABLE(<br/>          SUMMARIZECOLUMNS('Retail Sales'[ProductKey] )<br/>          ,'Date'[MonthKey] = MonthSelection<br/>          )</span></pre><p id="5b8d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This is the result:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qr"><img src="../Images/3fa909d205cd46aa1e52821480a29fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*CIDi3cc92lxd4CKiHI6Mog.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 6 — Result of DAX Query with the list of Products sold in Retail Stores (Figure by the Author)</figcaption></figure><p id="11aa" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">So, I got 2504 products sold during November 2023.</p><p id="35c0" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The next step is to inject this result as a filter into a query to count the products sold Online:</p><pre class="mm mn mo mp mq qg qh qi bp qj bb bk"><span id="6706" class="qk ne fq qh b bg ql qm l qn qo">DEFINE<br/>  VAR MonthSelection = 202311<br/><br/>  VAR RetailProductList =<br/>        CALCULATETABLE(<br/>                SUMMARIZECOLUMNS('Retail Sales'[ProductKey] )<br/>                ,'Date'[MonthKey] = MonthSelection<br/>                )<br/><br/>EVALUATE<br/>{<br/>  COUNTROWS(<br/>        CALCULATETABLE(<br/>                SUMMARIZECOLUMNS('Online Sales'[ProductKey] )<br/>                ,'Online Sales'[ProductKey] IN RetailProductList ,'Date'[MonthKey] = MonthSelection<br/>                )<br/>        )<br/> }</span></pre><p id="54bf" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now I have 2498 products:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qs"><img src="../Images/2bdfafdc20ad8973b801114873ec65a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*fMI6rEWK-5Yo37JAY3Q0jQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 7 — Result of DAX Query counting Products sold Online and in Retail Stores (Figure by the Author)</figcaption></figure><p id="9120" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you can see, I store the list of products sold in Retail stores in the Variable RetailProductList.</p><p id="9ab1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Then, I use <a class="af nc" href="https://dax.guide/calculatetable/" rel="noopener ugc nofollow" target="_blank">CALCULATETABLE()</a> to filter the ProductKey in the Online Sales table with this variable.</p><p id="19bf" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To restrict the result to one month only, I must add line 17.</p><p id="22a6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To get only the count of the products, I use <a class="af nc" href="https://dax.guide/countrows/" rel="noopener ugc nofollow" target="_blank">COUNTROWS()</a> enclosed in curly brackets to generate the output table.<br/>I must add the curly brackets, as COUNTROWS() returns a number, and <a class="af nc" href="https://dax.guide/st/evaluate/" rel="noopener ugc nofollow" target="_blank">EVALUATE</a> expects a table expression. The curly brackets take the result of COUNTROWS() and create a table with one column and one row.</p><p id="dd3a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">When I compare the count of 2498 to the result of the first SQL query above, for November 2023, I have the same result.<br/>Therefore, the logic works as expected.</p><h1 id="ac7a" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Creating the Measure(s)</h1><p id="37ad" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Now, I can take the query and put it into a Measure.</p><p id="1e54" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As the Measure must work even when I want to get a list of months and calculate the result for each month, I must remove the hardcoded month and evaluate the month for each row in the result:</p><pre class="mm mn mo mp mq qg qh qi bp qj bb bk"><span id="fe26" class="qk ne fq qh b bg ql qm l qn qo">DEFINE<br/> MEASURE 'All Measures'[Online Sold Product Count with Retail Sales] =<br/>    VAR MonthSelection = MAX('Date'[MonthKey])<br/> <br/>    VAR RetailProductList =<br/>        CALCULATETABLE(<br/>              SUMMARIZECOLUMNS('Retail Sales'[ProductKey] )<br/>                                ,'Date'[MonthKey] = MonthSelection<br/>                         )<br/> <br/>RETURN<br/>  COUNTROWS(<br/>      CALCULATETABLE(<br/>              SUMMARIZECOLUMNS('Online Sales'[ProductKey] )<br/>                  ,KEEPFILTERS('Online Sales'[ProductKey] IN RetailProductList)<br/>                  ,'Date'[MonthKey] = MonthSelection<br/>                  )<br/>              )<br/>EVALUATE<br/>  SUMMARIZECOLUMNS('Date'[Year Month Short Name]<br/>            ,'Date'[MonthKey]<br/>            ,"Online Sold Product Count with Retail Sales", [Online Sold Product Count with Retail Sales]<br/>            )<br/> ORDER BY 'Date'[MonthKey] DESC</span></pre><p id="b8cd" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Measure is everything between the DEFINE MEASURE and EVALUATE.</p><p id="e2d7" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This is the result, which is the same as from the SQL query above:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qt"><img src="../Images/2b15846d21995f24f8d9352f27ec6894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*92oAPUTI_3AsomOsTGS5KA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 8 — Result of DAX Query using the Measure derived from Query (Figure by the Author)</figcaption></figure><p id="369b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To get the products sold only Online, I must change one line in the Measure to exclude the products sold in Retail stores from the result:</p><pre class="mm mn mo mp mq qg qh qi bp qj bb bk"><span id="0532" class="qk ne fq qh b bg ql qm l qn qo">,KEEPFILTERS(NOT ('Online Sales'[ProductKey] IN RetailProductList) )</span></pre><p id="76e3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The result is the same as from the second SQL Query above:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qr"><img src="../Images/d16e149debb8aeb4005423d4bab8b77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*glKTZ1WvELfA5lIi88yVlg.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 9 — Result of DAX Query using the Measure for Products sold only Online (Figure by the Author)</figcaption></figure><h1 id="3f66" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Conclusion</h1><p id="7558" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">This task is similar to the logic described in my article about using intermediary results in DAX (You can find the link to that article in the Reference section below).</p><p id="4101" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But this time, I didn’t need the extra <a class="af nc" href="https://dax.guide/filter/" rel="noopener ugc nofollow" target="_blank">FILTER()</a> when using the table variable.</p><p id="c78d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I’m unsure why I needed it when I wrote that piece, but I will examine it.</p><p id="b951" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you have seen, I used DAX queries this time to develop the solution step-by-step.</p><p id="e572" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I found it useful to do it this way, as I worked with an intermediary table, which I can examine during development.</p><p id="6d47" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">For such scenarios, it is easier working with Queries than trying to build such a solution straight in Power BI Desktop.</p><p id="c535" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Moreover, it’s interesting for those who come from working with relational databases and who started working with DAX: I needed to explicitly add the month to the SQL query to be able to group the results by month. I don’t need this in DAX, as the grouping is done automatically when adding the month to the query.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qu"><img src="../Images/ade78146acb63e47f1347db6543c4dc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eI8oMrnT5Ym4cerX"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@firmbee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Firmbee.com</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ea7e" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">References</h1><p id="192e" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I wrote an article about working with intermediary tables in DAX Measures a few months ago. You can find it here:</p><div class="pa pb pc pd pe pf"><a rel="noopener follow" target="_blank" href="/on-using-intermediary-results-in-dax-measures-9971efa72ae?source=post_page-----914deb450d23--------------------------------"><div class="pg ab ih"><div class="ph ab co cb pi pj"><h2 class="bf fr hx z ip pk ir is pl iu iw fp bk">On using intermediary results in DAX Measures</h2><div class="pm l"><h3 class="bf b hx z ip pk ir is pl iu iw dx">We use table variables in DAX all the time. What if we must calculate intermediary results and reuse them in a DAX…</h3></div><div class="pn l"><p class="bf b dy z ip pk ir is pl iu iw dx">towardsdatascience.com</p></div></div><div class="po l"><div class="pp l pq pr ps po pt lr pf"/></div></div></a></div><p id="5ad8" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I use the Contoso sample dataset, like in my previous articles. You can download the ContosoRetailDW Dataset for free from Microsoft <a class="af nc" href="https://www.microsoft.com/en-us/download/details.aspx?id=18279" rel="noopener ugc nofollow" target="_blank">here</a>.</p><p id="1f51" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I translated my client’s request to the data in the ContosoRetailDW dataset.</p><p id="24a6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Contoso Data can be freely used under the MIT License, as described <a class="af nc" href="https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo" rel="noopener ugc nofollow" target="_blank">here</a>.</p><p id="91c6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I enlarged the dataset to make the DAX engine work harder.<br/> The Online Sales table contains 71 million rows (instead of 12.6 million rows), and the Retail Sales table contains 18.5 million rows (instead of 3.4 million rows).</p><div class="pa pb pc pd pe pf"><a href="https://medium.com/@salvatorecagliari/subscribe?source=post_page-----914deb450d23--------------------------------" rel="noopener follow" target="_blank"><div class="pg ab ih"><div class="ph ab co cb pi pj"><h2 class="bf fr hx z ip pk ir is pl iu iw fp bk">Get an email whenever Salvatore Cagliari publishes.</h2><div class="pm l"><h3 class="bf b hx z ip pk ir is pl iu iw dx">Get an email whenever Salvatore Cagliari publishes. By signing up, you will create a Medium account if you don't…</h3></div><div class="pn l"><p class="bf b dy z ip pk ir is pl iu iw dx">medium.com</p></div></div><div class="po l"><div class="qv l pq pr ps po pt lr pf"/></div></div></a></div><p id="4fa1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I make my articles accessible to everyone, even though Medium has a paywall. This allows me to earn a little for each reader, but I turn it off so you can read my pieces without cost.</p><p id="b7fe" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You can support my work, which I do during my free time, through</p><p id="2e3d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><a class="af nc" href="https://buymeacoffee.com/salvatorecagliari" rel="noopener ugc nofollow" target="_blank">https://buymeacoffee.com/salvatorecagliari</a></p><p id="0b58" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Or scan this QR Code:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qw"><img src="../Images/e7ac062070dcd7a00dcf995ad7e95434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btH95UXO7gboS30eZMk6ug.png"/></div></figure><p id="fb63" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Any support is greatly appreciated and helps me find more time to create more content for you.</p><p id="5c45" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Thank you a lot.</p></div></div></div></div>    
</body>
</html>