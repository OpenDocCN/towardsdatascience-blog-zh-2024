# 我的机器学习之旅中的经验教训：数据划分与数据泄漏

> 原文：[https://towardsdatascience.com/two-rookie-mistakes-i-made-in-machine-learning-improper-data-splitting-and-data-leakage-3e33a99560ea?source=collection_archive---------1-----------------------#2024-02-25](https://towardsdatascience.com/two-rookie-mistakes-i-made-in-machine-learning-improper-data-splitting-and-data-leakage-3e33a99560ea?source=collection_archive---------1-----------------------#2024-02-25)

## 从统计建模转向机器学习时需要避免的常见错误

[](https://medium.com/@khinydnlin_310?source=post_page---byline--3e33a99560ea--------------------------------)[![Khin Yadanar Lin](../Images/1018a44583239dfd33901b6d392d257f.png)](https://medium.com/@khinydnlin_310?source=post_page---byline--3e33a99560ea--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--3e33a99560ea--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--3e33a99560ea--------------------------------) [Khin Yadanar Lin](https://medium.com/@khinydnlin_310?source=post_page---byline--3e33a99560ea--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--3e33a99560ea--------------------------------) ·7 分钟阅读·2024年2月25日

--

![](../Images/61b1e12ac5adb638a6f48a7ce5d93b04.png)

图片由 [Susan Q Yin](https://unsplash.com/@syinq?utm_source=medium&utm_medium=referral) 提供，来自 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

## 我的故事

**数据科学、机器学习和人工智能**无疑是当今的流行词汇。我的LinkedIn充满了分享学习路线图的数据专家，供那些渴望进入数据领域的人参考。

然而，从我的个人经验来看，我发现走向数据科学的道路并不像单纯按照固定路线图前进那样线性，尤其是对于那些从不同职业背景转型的人来说。数据科学需要多种技能的结合，如编程、统计学、数学、分析、软技能和领域知识。这意味着每个人根据自己的先前经验和技能集，从不同的起点开始学习。

作为一位在研究和分析领域工作多年并获得分析学硕士学位的人，我积累了一定的统计学知识及其应用。然而，数据科学是一个如此广泛且充满活力的行业，我的知识仍然是零散的。我也曾努力寻找能够有效填补我在统计学和机器学习之间知识空白的资源。这给我的学习体验带来了重大挑战。

在这篇文章中，我想分享我在从研究与分析转向数据科学过程中遇到的技术性忽视问题。希望我的分享能为你节省时间，并帮助你避免这些陷阱。

## 统计建模与机器学习

所以，你可能会想，为什么我从回顾我的旅程开始，而不是直接进入主题。原因很简单——我发现很多人声称自己在构建机器学习模型，但实际上他们只是构建统计模型。我承认我曾是其中之一！并不是说一种比另一种更好，但我认为在讨论技术细节之前，理解统计建模与机器学习之间的差异是非常重要的。

> **统计模型**的目的是**做出推断**，而**机器学习**的主要目标是**进行预测**。简单来说，机器学习模型利用统计学和数学生成适用于现实世界场景的预测。这也是数据划分和数据泄漏问题出现的地方，特别是在有监督机器学习的背景下。

我最初的信念是，理解统计分析就足够进行预测任务了。然而，我很快意识到，如果没有掌握诸如适当的数据划分和意识到潜在的陷阱（如数据泄漏）等数据准备技巧，即使是最复杂的统计模型在预测性能上也会有所欠缺。

那么，让我们开始吧！

# **错误 1: 数据划分不当**

## **什么是数据划分？**

数据划分，本质上是将数据集分割成多个部分，以便模型获得最佳的预测性能。

考虑一个我们许多人都熟悉的简单最小二乘回归（OLS）概念。我们在商学、统计学、金融学、经济学或工程学课程中都听说过它。它是一个基本的机器学习技术。

假设我们有一个房价数据集，以及可能影响房价的各类因素。

在**传统统计分析**中，我们使用**整个数据集**来构建回归模型，因为我们的目标只是理解哪些因素会影响房价。换句话说，回归模型可以解释价格变化的程度与预测变量之间的关系。

然而，在机器学习中，统计部分保持不变，但数据划分变得至关重要。让我解释一下原因——假设我们在整个数据集上训练模型，那么我们如何知道模型在未见数据上的预测表现呢？

正因为如此，我们通常将数据集分为两部分：训练集和测试集。其理念是，在一部分数据上训练模型，在另一部分数据上评估模型的性能。本质上，测试集应该充当真实世界的数据，这意味着在训练阶段，模型绝不能接触到测试数据。

这里出现了我之前没有意识到的陷阱。将数据拆分成两个数据集本身并不错误，但存在创建不可靠模型的风险。想象一下，你在训练集上训练模型，在测试集上验证其准确性，然后重复这个过程来微调模型。这会在模型选择中产生偏差，且会违背“未见数据”的初衷，因为测试数据在模型开发过程中已经多次出现。它削弱了模型真实预测未见数据的能力，导致过拟合问题。

## **如何防止：**

理想情况下，数据集应分为两个块（三个不同的拆分）：

+   **（训练集 + 验证集）→ 第一个块**

+   **测试集 → 第二个块**

模型可以在第一个块上进行训练和验证。第二个块（测试集）不应参与任何模型训练过程。将测试集视为禁区！

数据拆分的方式取决于数据集的大小。行业标准是训练集（第一个块）占60% — 80%，测试集占20% — 40%。验证集通常从第一个块中划分出来，因此实际的训练集将占第一个块的70% — 90%，其余部分为验证集。

理解这个概念的最好方式是通过一个图示：

![](../Images/6105336a31da32444fe35c89d8af593c.png)

留一法（LOOV）方法（图像来自作者）

除了LOOV（图中所示），还有其他多种数据拆分技术：

+   K折交叉验证，将数据分成‘K’个折叠，并相应地迭代训练过程

+   滚动窗口交叉验证（适用于时间序列数据）

+   阻塞交叉验证（适用于时间序列数据）

+   不平衡类别的分层抽样拆分

注意：时间序列数据在拆分时需要特别小心，因为其时间顺序。随机拆分数据集可能会破坏其时间顺序。（我是通过亲身经历学到的）

> 最重要的一点是，无论使用何种技术，“测试集”都应保持独立且未被触及，直到模型选择阶段。

# **错误 2：数据泄漏**

> “在机器学习中，**数据泄漏**是指机器学习模型的创建者犯下的一个错误，他们不小心将测试数据集和训练数据集之间的信息共享。” — Analytics Vidhya

这与我提到的第一个观点有关，即测试数据被训练数据污染。这是数据泄漏的一个例子。然而，仅仅拥有验证集并不能避免数据泄漏。

为了防止数据泄漏，我们需要小心处理数据的过程——从探索性数据分析（EDA）到特征工程。任何允许训练数据与测试数据交互的过程，都可能导致泄漏。

数据泄漏主要有两种类型：

1.  **训练-测试污染**

我曾犯的一个常见错误是，在数据拆分之前对整个数据集应用标准化/预处理程序。例如，在整个数据集上使用均值填充来处理缺失值/异常值。这使得训练数据包含了测试数据中的信息。因此，模型的准确率被虚高，相较于它在实际应用中的表现。

**2\. 目标泄漏**

如果特征（预测变量）与我们想要预测的变量（目标变量）之间存在某种依赖关系，或者如果预测时特征数据不可用，这可能会导致目标泄漏。

让我们以我所处理的数据为例。在这里，我试图根据广告活动预测销售表现。我尝试加入转化率。我忽略了转化率仅在活动结束后才会得知。换句话说，我在预测时无法获得这些信息。此外，因为转化率与销售数据相关联，这就引入了典型的目标泄漏案例。包括转化率会导致模型学习到通常无法访问的数据，从而产生过于乐观的预测。

![](../Images/770a023e6724fb3763738400109bd951.png)

示例（虚构）数据集（图片由作者提供）

## 如何防止数据泄漏：

总结来说，记住以下几点来解决数据泄漏问题：

1.  适当的数据预处理

1.  小心交叉验证

1.  小心特征选择

## **结束语**

就这些了！感谢你一直看到最后！希望这篇文章能够澄清关于数据拆分的常见误解，并为构建高效的机器学习模型提供最佳实践。

这不仅是记录我的学习过程，也是为了共同学习。所以，如果你发现我技术知识中的空白或有任何见解要分享，随时可以给我留言！

## 参考文献：

[Daniel Lee Datainterview.com LinkedIn帖子](https://www.linkedin.com/posts/danleedata_choosing-your-model-on-%3F%3F%3F%3F%3F-%3F%3F-activity-7158131388976693248-FXUT?utm_source=share&utm_medium=member_desktop)

[Kaggle — 数据泄漏解释](https://www.kaggle.com/code/alexisbcook/data-leakage)

[Analytics Vidhya — 数据泄漏及其对机器学习模型性能的影响](https://www.analyticsvidhya.com/blog/2021/07/data-leakage-and-its-effect-on-the-performance-of-an-ml-model/)

[预测：原理与实践](https://otexts.com/fpp3/tscv.html)
