<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The Poisson Bootstrap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>The Poisson Bootstrap</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-poisson-bootstrap-d0fd045e28c3?source=collection_archive---------4-----------------------#2024-08-12">https://towardsdatascience.com/the-poisson-bootstrap-d0fd045e28c3?source=collection_archive---------4-----------------------#2024-08-12</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="4bfe" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Bootstrapping over large datasets</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@davidclarance?source=post_page---byline--d0fd045e28c3--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="David Clarance" class="l ep by dd de cx" src="../Images/02cf7cdde9576cdf3af30a79da4db747.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*tYE-QVQgfH_K8DbyvfGw1w.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--d0fd045e28c3--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@davidclarance?source=post_page---byline--d0fd045e28c3--------------------------------" rel="noopener follow">David Clarance</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--d0fd045e28c3--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">10 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Aug 12, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/362b9f899eae79f29c0c2de80db3e201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5RipQzD0byY0adBRK3byg.png"/></div></div></figure><p id="4e44" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Bootstrapping is a useful technique to infer statistical features (think mean, decile, confidence intervals) of a population based on a sample collected. Implementing it at scale can be hard and in use cases with streaming data, very complicated. When trying to learn how to bootstrap at scale, I <a class="af nt" href="https://www.unofficialgoogledatascience.com/2015/08/an-introduction-to-poisson-bootstrap26.html" rel="noopener ugc nofollow" target="_blank">came across a Google blog </a>(almost a decade old) that introduces Poisson bootstrapping. Since then I’ve discovered an even older paper, <a class="af nt" href="http://www.med.mcgill.ca/epidemiology/Hanley/Reprints/bootstrap-hanley-macgibbon2006.pdf" rel="noopener ugc nofollow" target="_blank">Hanley and MacGibbon (2006),</a> that outlines a version of this technique. This post is an attempt to make sure I’ve understood the logic well enough to explain it to someone else. We’ll start with a description of classical bootstrapping first to motivate why Poisson bootstrapping is neat.</p><h2 id="3552" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk">Classical bootstrapping</h2><p id="d6d6" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">Suppose we wanted to calculate the mean age of students in a school. We could repeatedly draw samples of 100 students, calculate the means and store them. Then we could take a final mean of those sample means. This final mean is an estimate of the population mean.</p><p id="249f" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In practice, it’s often not possible to draw repeated samples from a population. This is where bootstrapping comes in. Bootstrapping sort of mimics this process. Instead of drawing samples from the population we draw samples (with replacement) from the one sample we collected. The psuedo-samples are referred to as resamples.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ou"><img src="../Images/b44df36fb0cc158f61146e63ccec36a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbDf_thrvP9DQARZsxka2A.png"/></div></div></figure><p id="2b36" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Turns out this is extremely effective. It’s more computationally expensive than a closed form solution but does not make strong assumptions about the distribution of the population. Additionally, it’s cheaper than repeating sample collections. In practice, it’s used a lot in industry because in many cases either closed form solutions don’t exist or are hard to get right—for instance, when inferring deciles of a population.</p><h2 id="73e2" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk"><strong class="al">Why does bootstrapping work?</strong></h2><p id="77d8" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">Bootstrapping feels wrong. Or at least the first time I learned about it, it didn’t feel right. Why should one sample contain so much information?</p><p id="4e16" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Sampling with replacement from the original sample you drew is just a way for you to mimic drawing from the population. The original sample you drew, on average, looks like your population. So when you resample from it, you’re essentially drawing samples from the same probability distribution.</p><p id="6642" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">What if you just happen to draw a weird sample? That’s possible and that’s why we resample. Resampling helps us learn about the distribution of the sample itself. What if you original sample is too small? As the number of observations in the sample grow, bootstrapping estimates converge to population values. However, there are no guarantees over finite samples.</p><p id="eee5" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">There are problems but given the constraints we operate in, it is the best possible information we have on the population. We don’t have to assume the population has a specific shape. Given that computation is fairly cheap, bootstrapping becomes a very powerful tool to use.</p><h2 id="d80d" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk">Demonstrating classical bootstrapping</h2><p id="256e" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">We’ll explain bootstrapping with two examples. The first is a tiny dataset where the idea is that you can do the math in your head. The second is a larger dataset for which I’ll write down code.</p><h2 id="0638" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk">Example 1: Determining the mean age of students in a school</h2><p id="7eb2" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">We’re tasked to determine the mean age of students in a school. We sample 5 students randomly. The idea is to use those 5 students to infer the average age of all the students in the school. This is silly (and statistically improper) but bear with me.</p><pre class="mm mn mo mp mq ov ow ox bp oy bb bk"><span id="6069" class="oz nv fq ow b bg pa pb l pc pd">ages = [12, 8, 10, 15, 9]</span></pre><p id="dd4c" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">We now sample from this list with replacement.</p><pre class="mm mn mo mp mq ov ow ox bp oy bb bk"><span id="06ba" class="oz nv fq ow b bg pa pb l pc pd">sample_1 = [ 8, 10,  8, 15, 12]<br/>sample_2 = [10, 10, 12,  8, 15]<br/>sample_3 = [10, 12,  9,  9,  9]<br/>....<br/>do this a 1000 times<br/>....<br/>sample_1000 = [ 9, 12, 12, 15,  8]</span></pre><p id="e2cf" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">For each resample, calculate the mean.</p><pre class="mm mn mo mp mq ov ow ox bp oy bb bk"><span id="027f" class="oz nv fq ow b bg pa pb l pc pd">mean_sample_1 = 10.6<br/>mean_sample_2 = 11<br/>mean_sample_3 = 9.8<br/>...<br/>mean_sample_1000 = 11.2</span></pre><p id="8201" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Take a mean of those means.</p><pre class="mm mn mo mp mq ov ow ox bp oy bb bk"><span id="2926" class="oz nv fq ow b bg pa pb l pc pd">mean_over_samples=mean(mean_sample_1, mean_sample_2, .. , mean_sample_1000)</span></pre><p id="e483" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">This mean then becomes your estimate of the population mean. You can do the same thing over any statistical property: Confidence intervals, deviations etc.</p><h2 id="467a" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk">Example 2: Determining the 95th percentile for ‘time to process payment’</h2><p id="8a83" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">Customers on a food delivery app make payments on the app. After a payment is successful, an order is placed with the restaurant. The <strong class="mz fr">time to process payment</strong> calculated as the time between when a customer presses the ‘Make Payment’ button and when feedback is delivered (payment successful, payment failed) is a critical metric that reflects platform reliability. Millions of customers make payments on the app every day.</p><p id="e547" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">We’re tasked to estimate the 95% percentile of the distribution to be able to rapidly detect issues.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pe"><img src="../Images/697e2ed7307420edafbc50ae8501324a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*mMStbNeA5SCnRg2lUSc4OA.png"/></div></figure><p id="c84c" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">We illustrate classical bootstrapping in the following way:</p><ul class=""><li id="e7ca" class="mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns pf pg ph bk">We assume that there’s some population that has a million observations. In the real world, we never observe this data.</li><li id="3854" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">We randomly sample 1/10th of this population. So we take 10,000 observations. In reality this is the only data we observe.</li><li id="c5f2" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">We then apply the same procedure we discussed above. We resample observations from our observed data with replacement. We do this many, many times.</li><li id="2c58" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Each time when we resample, we calculate the 95th percentile of that distribution.</li><li id="b19b" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Finally we take the mean of the 95th percentile values and find confidence intervals around it.</li></ul><p id="34b6" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">We get the graph below. Magically, we find that the confidence intervals we just generated contain the true 95th percentile (from our population).</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pn"><img src="../Images/02a0e7d6d65ce0ea23924ba32c7af027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aijGWQtsckakddX9Vyp5dw.png"/></div></div></figure><p id="4db8" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">We can see the same data at the level of the bootstrapped statistic.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk po"><img src="../Images/98883bf48ba626d1ad7b8883b440e252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*RQD0JqyzDwW1tZ1jUaB-3w.png"/></div></figure><p id="e80e" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The code to generate the above is below, give it a try yourself!</p><figure class="mm mn mo mp mq mr"><div class="pp io l ed"><div class="pq pr l"/></div></figure></div></div></div><div class="ab cb ps pt pu pv" role="separator"><span class="pw by bm px py pz"/><span class="pw by bm px py pz"/><span class="pw by bm px py"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="1f8b" class="qa nv fq bf nw qb qc gq oa qd qe gt oe qf qg qh qi qj qk ql qm qn qo qp qq qr bk">This all works great, what’s next?</h1><p id="ca1e" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">Now that we’ve established that classical bootstrapping actually works we’ll try and establish what’s happening from a mathematical perspective. Usually texts will just tell you to skip this part if you’re not interested. I’ll encourage you to stick around though because this is where the real fun is.</p><h2 id="6d01" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk">Take a break</h2><p id="58be" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">Let’s think through a game now. Imagine you had a bag filled with 5 balls: A red, blue, yellow, green and purple ball. You need to draw 5 balls from the bag, one at a time. After you draw a ball, you put it back into the bag and then draw again. So each time you choose a ball, you have 5 differently coloured balls to choose from. After each round you record the ball that was chosen in a empty slot (as shown below).</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qs"><img src="../Images/d478a2b8c87df6bed4de1028d26ed8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QzQgGsrPg7uy-nLI9jw-lg.png"/></div></div></figure><p id="8b0f" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Now, if I were to ask you, what’s the probability of each ball being chosen for a each slot that we have to fill?</p><p id="bdb8" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">For slot 1,</p><ul class=""><li id="b4b2" class="mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns pf pg ph bk">The red ball can be chosen with probability 1/5</li><li id="7004" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">The purple ball can be chosen with probability 1/5</li><li id="56d9" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">The green ball can be chosen with probability 1/5</li><li id="c611" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">The blue ball can be chosen with probability 1/5</li><li id="fb26" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">The yellow ball can be chosen with probability 1/5</li></ul><p id="2adf" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The same case extends to slot 2, 3, 4 and 5</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qt"><img src="../Images/2569fd8533d3132b4165839df65e2463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*2T7OePb8_5I6-hCTff4uiw.png"/></div></div></figure><p id="8d53" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Lets focus on the red ball for a bit. It can be chosen a minimum of zero times (it isn’t chosen at all) and a maximum of 5 times. The probability distribution of the occurrence of the red ball is the following:</p><ul class=""><li id="8101" class="mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns pf pg ph bk">Red ball chosen 0 times: This can only happen in 1 way.</li><li id="39c3" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Red ball chosen 1 time: This can happen in 5 ways. Red ball is chosen for slot 1, Red ball is chosen for slot 2 … (you get the drift).</li><li id="011d" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Red ball chosen 2 times: This can happen in 10 ways. Fix the red ball on slot 1, there are 4 options. Fix the red ball on slot 2, there are 3 new options, …</li><li id="00e3" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Red ball chosen 3 times: This can happen in 10 ways. This is exactly similar to the logic above.</li><li id="5c81" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Red ball chosen 4 times: The can happen in 5 ways. Similar to being chosen once.</li><li id="de47" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Red ball is chosen 5 times. This can happen in 1 way.</li></ul><p id="0597" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">This is just <em class="qu">5 choose k, </em>where <em class="qu">k = {0, 1, 2, 3, 4, 5}</em></p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qv"><img src="../Images/3f44799433b3904d01972724bb36abbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*laO9IPU95cyx2QbJUp4ZBw.png"/></div></div></figure><p id="5032" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Let’s put these two facts together just for the red balls</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qw"><img src="../Images/0cf7c18b2bf40366a2c329c5a7dc5fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*_MHpvVUG8Do0Sj1vcNWErw.png"/></div></figure><p id="6458" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">What we just described is the binomial distribution where <em class="qu">n = 5 </em>and <em class="qu">p = 1/5</em></p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qx"><img src="../Images/7a58cafe59eb24671a885b95498ec906.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*_iJwHN6exQUuUnvuocMQgg.png"/></div></figure><p id="9553" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Or more generally,</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qy"><img src="../Images/bd4e71c21265967e5c1ce12381eac823.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*j22ti_Z95pGNJ47qWbMjrw.png"/></div></figure><p id="77d2" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Now just substitute balls for observations.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qz"><img src="../Images/d7ff38abd29b853d514634a901f828f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9dZnxOEIeofdaZgueOLGtA.png"/></div></div></figure><p id="ec21" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">So when we bootstrap, we essentially are drawing each observation from a binomial distribution.</p><blockquote class="ra rb rc"><p id="ae50" class="mx my qu mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In classical bootstrapping, when we resample, <strong class="mz fr">each observation follows the binomial distribution with n = n, k = {0, …, n} and p = 1/n.</strong> This is also expressed as Binomial(n , 1/n).</p></blockquote><p id="864a" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Now, a very interesting property of the binomial distribution is that as n turns larger and larger, and p turns smaller and smaller, the binomial distribution converges to a Poisson distribution with <em class="qu">Poisson(n/p). </em>Some day I’ll write an intuitive explanation of why this happens but for now if you’re interested, you can read <a class="af nt" href="https://medium.com/@andrew.chamberlain/deriving-the-poisson-distribution-from-the-binomial-distribution-840cc1668239" rel="noopener">this very well written piece</a>.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rd"><img src="../Images/28c914ca657495fc27919637fb2ead76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*Ts5pzxR2UjszcOUFo6EIvA.png"/></div></figure><p id="dfb6" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">This works for any n and p such that n/p is constant. In the gif below we show this for lambda (n/p) = 5.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk re"><img src="../Images/66d28ee9af5fe78fc9a31d4be7b77a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-dThBZkKX2gsp1R_ACW96w.gif"/></div></figure><p id="c6d7" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In our special case, we’ll just converge to <em class="qu">Poisson(1) </em>as p is just 1/n.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rf"><img src="../Images/63f7b13b66d69f61400258f46ffa639c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*MvxDYU2SuxAZRwowpKpVWQ.png"/></div></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk re"><img src="../Images/a74eae72db90e67f5e234adff9898efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9mlZ5L33G0SqivYZHs-bIw.gif"/></div></figure><p id="bdb6" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Then it follow that another way to resample would be to draw each observation from a Poisson(1) distribution.</p><blockquote class="rg"><p id="b5e8" class="rh ri fq bf rj rk rl rm rn ro rp ns dx">Poisson bootstrapping means that we use a Poisson(1) process to generate resamples for bootstrapping a statistic.</p></blockquote><figure class="rr rs rt ru rv mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rq"><img src="../Images/54d8d6426197e99a039058d8cd9b486f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7zVKnAswUSA7I4VbjUqbw.png"/></div></div></figure></div></div></div><div class="ab cb ps pt pu pv" role="separator"><span class="pw by bm px py pz"/><span class="pw by bm px py pz"/><span class="pw by bm px py"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="e0c0" class="qa nv fq bf nw qb qc gq oa qd qe gt oe qf qg qh qi qj qk ql qm qn qo qp qq qr bk">Big deal, why is this useful?</h1><p id="611b" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">There are two stages of bootstrapping a statistic of interest. The first stage is to create resamples, the second stage is to calculate the statistic on each resample. Classical and Poisson bootstrapping are identical on the second stage but different on the first stage.</p><p id="713b" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">There are two ways in which this is useful:</p><ul class=""><li id="6297" class="mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns pf pg ph bk">Poisson bootstrapping reduces the number of passes we need to make over data.</li><li id="9b88" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">Poisson bootstrapping works in cases where we don’t have a fixed n. For instance, when we’re streaming data in.</li></ul><h2 id="f4e8" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk">Reducing the number of passes while resampling</h2><p id="437a" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">The Poisson bootstrap allows for significant computation gains while creating resamples. The best way to look at this is in code.</p><figure class="mm mn mo mp mq mr"><div class="pp io l ed"><div class="pq pr l"/></div></figure><p id="44ee" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Compare line (8) above, with the equivalent line in the classical bootstrap:</p><pre class="mm mn mo mp mq ov ow ox bp oy bb bk"><span id="bd92" class="oz nv fq ow b bg pa pb l pc pd"># classical, needs to know (data)<br/>bootstrap_samples = np.random.choice(data, (n_iter, n), replace=True) <br/><br/># poisson, does not need to know (data)<br/>weights = np.random.poisson(1, (n_iter, n))</span></pre><p id="f68e" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In the classical bootstrap, you need to know <em class="qu">data</em>, while in the Poisson bootstrap you don’t.</p><p id="eb1f" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The implications for this are very significant for cases where data is very large (think 100s of millions of observations). This is because mathematically, generating resamples reduces to generating counts for each observation.</p><ul class=""><li id="e119" class="mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns pf pg ph bk">In classical bootstrapping, the counts for each observation follow a <em class="qu">Binomial(n, 1/n)</em>. Together they <a class="af nt" href="https://en.wikipedia.org/wiki/Multinomial_distribution" rel="noopener ugc nofollow" target="_blank">follow a <em class="qu">Multinomial(n, 1/n, 1/n, …, 1/n)</em></a>. This means when you generate a count for an observation, this impacts the count for the other observations. For instance, in our ball example, once you’ve generated the count for a red ball, this has a direct impact on the counts for the other balls. For instance, if the count for the red ball is 2, then we know that we only have 3 more balls we can choose.</li><li id="4833" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns pf pg ph bk">In Poisson bootstrapping, the counts for each observation are independent on each other. So if you need 1000 resamples, you just generate 1000 Poisson(1) draws for the red ball. Then you’re done and you can move on to the next observation.</li></ul><h2 id="4464" class="nu nv fq bf nw nx ny nz oa ob oc od oe ng of og oh nk oi oj ok no ol om on oo bk">Resampling when n is unknown</h2><p id="2448" class="pw-post-body-paragraph mx my fq mz b go op nb nc gr oq ne nf ng or ni nj nk os nm nn no ot nq nr ns fj bk">There are cases where n is effectively unknown. For instance, in cases where you’re streaming in payment data or where data is so large that is lives across multiple storage instances.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rw"><img src="../Images/a3d05c7d86d1e5c06ab5be4649278069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noZ4NUem2Vj0vNeOLkRMiw.png"/></div></div></figure><p id="461b" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In classical bootstrapping every time we observe an increased n, we have to redo the resampling process again (as we sample with replacement). This renders this method quite computationally expensive and wasteful. In the Poisson bootstrap we can just save our <em class="qu">Poisson(1) </em>draws for each instance. Every time a new instance is added all we need to do is to generate the <em class="qu">Poisson(1) </em>draws for this new instance.</p><h1 id="26b3" class="qa nv fq bf nw qb rx gq oa qd ry gt oe qf rz qh qi qj sa ql qm qn sb qp qq qr bk">Conclusion</h1><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/362b9f899eae79f29c0c2de80db3e201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5RipQzD0byY0adBRK3byg.png"/></div></div></figure><p id="33a3" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Classical bootstrapping is a very effective technique for learning the distribution of a statistic from a sample collected. In practice, it can be prohibitively expensive for very large datasets. Poisson bootstrapping is a version of bootstrapping that enables efficient parallel computation of resamples. This is because of two reasons:</p><ol class=""><li id="f778" class="mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns sc pg ph bk">Resampling under Poisson bootstraps means we only make one pass over each observation.</li><li id="cfe5" class="mx my fq mz b go pi nb nc gr pj ne nf ng pk ni nj nk pl nm nn no pm nq nr ns sc pg ph bk">In streaming data cases, Poisson bootstraps allow us to process new resamples incrementally rather than having to resample over the entire dataset in one go.</li></ol><p id="5ed5" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk"><em class="qu">I hope you’ve found this useful. I’m always open to feedback and corrections. The images in this post are mine. Feel free to use them!</em></p></div></div></div></div>    
</body>
</html>