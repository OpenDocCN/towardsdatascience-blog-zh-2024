<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Data Quality Doesn’t Need to Be Complicated</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Data Quality Doesn’t Need to Be Complicated</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stop-overcomplicating-data-quality-4569fc6d35a4?source=collection_archive---------1-----------------------#2024-12-10">https://towardsdatascience.com/stop-overcomplicating-data-quality-4569fc6d35a4?source=collection_archive---------1-----------------------#2024-12-10</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="e2db" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Three Zero-Cost Solutions That Take Hours, Not Months</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@caiparryjones96?source=post_page---byline--4569fc6d35a4--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Cai Parry-Jones" class="l ep by dd de cx" src="../Images/60b83f5167651f9621a3e73b8d72ccae.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/da:true/resize:fill:88:88/0*GWV4mbIw3Ex5l9PC"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--4569fc6d35a4--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@caiparryjones96?source=post_page---byline--4569fc6d35a4--------------------------------" rel="noopener follow">Cai Parry-Jones</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--4569fc6d35a4--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">8 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Dec 10, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">11</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div></div></div><div class="mj"><div class="ab cb"><div class="lm mk ln ml lo mm cf mn cg mo ci bh"><figure class="ms mt mu mv mw mj mx my paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq mr"><img src="../Images/4b570b710780faeea2899cb85facde86.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*iYfw31uoFZqKZkVd0pwHdw.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">A ‘data quality’ certified pipeline. Source: <a class="af nj" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">unsplash.com</a></figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="7a90" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In my career, data quality initiatives have usually meant big changes. From governance processes to costly tools to dbt implementation — data quality projects never seem to want to be small.</p><p id="051b" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">What’s more, fixing the data quality issues this way often leads to new problems. More complexity, higher costs, slower data project releases…</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq og"><img src="../Images/3713bea14e131ad68e6fde839cda4e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JZaTuNBrcgI6rmc9.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">created by the author using <a class="af nj" href="https://workspace.google.com/intl/en_uk/products/sheets/" rel="noopener ugc nofollow" target="_blank">Google Sheets</a></figcaption></figure><p id="f376" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">But it doesn’t have to be this way.</p><p id="c428" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">While companies like Google and Meta require extensive data quality frameworks due to their massive scale and complexity, most organizations can achieve excellent data quality with much simpler approaches.</p><p id="3f80" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">In this article, we’ll delve into three methods small to medium sized data projects can use to quickly improve their data quality, all while keeping <br/>complexity to a minimum and new costs at zero. Let’s get to it!</p><h1 id="d9d0" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">TL;DR</h1><ul class=""><li id="a164" class="nk nl fq nm b go pd no np gr pe nr ns nt pf nv nw nx pg nz oa ob ph od oe of pi pj pk bk">Take advantage of old school database tricks, like ENUM data types, and column constraints.</li><li id="5e4f" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Create a custom dashboard for your specific data quality problem.</li><li id="9a91" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Generate data lineage with one small Python script.</li></ul><h1 id="ab85" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Take advantage of old school database tricks</h1><p id="0db1" class="pw-post-body-paragraph nk nl fq nm b go pd no np gr pe nr ns nt pf nv nw nx pg nz oa ob ph od oe of fj bk">In the last 10–15 years we’ve seen massive changes to the data industry, notably big data, parallel processing, cloud computing, data warehouses, and new tools (lots and lots of new tools).</p><p id="449c" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Consequently, we’ve had to say goodbye to some things to make room for all this new stuff. Some positives (Microsoft Access comes to mind), but some are questionable at best, such as traditional data design principles and data quality and validation at ingestion. The latter will be the subject of this section.</p><p id="191c" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Firstly, what do I mean by “data quality and validation at ingestion”? Simply, it means checking data before it enters a table. Think of a bouncer outside a nightclub.</p><p id="c5cd" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">What it has been replaced with is build-then-test, which means putting new data in tables first, and then checking it later. Build-then-test is the chosen method for many modern data quality tools, including the most popular, <a class="af nj" href="https://www.getdbt.com/product/what-is-dbt" rel="noopener ugc nofollow" target="_blank">dbt</a>.</p><p id="cb87" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Dbt runs the whole data transformation pipeline first, and only once all the new data is in place, it checks to see if the data is good. Of course, this can be the optimal solution in many cases. For example, if the business is happy to sacrifice quality for speed, or if there is a QA table before a production table (coined by Netflix as <a class="af nj" href="https://lakefs.io/blog/data-engineering-patterns-write-audit-publish/" rel="noopener ugc nofollow" target="_blank">Write-Audit-Publish</a>). However, engineers who only use this method of data quality are potentially missing out on some big wins for their organization.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq pq"><img src="../Images/46fe0562178bfdf861d61c21943b513c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RuBiwxbjaiVCSHOS_AkDmA.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Testing before vs after generating tables. Created by the author using <a class="af nj" href="https://app.diagrams.net/" rel="noopener ugc nofollow" target="_blank">draw.io</a></figcaption></figure><p id="beb4" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Test-then-build has two main benefits over build-then-test.</p><p id="f175" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The first is that it ensures the data in downstream tables meets the data quality standards expected <strong class="nm fr">at all times</strong>. This gives the data a level of trustworthiness, so often lacking, for downstream users. It can also reduce anxiety for the data engineer/s responsible for the pipeline.</p><p id="8b50" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">I remember when I owned a key financial pipeline for a company I used to work for. Unfortunately, this pipeline was very prone to data quality issues, and the solution in place was a build-then-test system, which ran each night. This meant I needed to rush to my station early in the morning each day to check the results of the run before any downstream users started looking at their data. If there were any issues I then needed to either quickly fix the issue or send a Slack message of shame announcing to the business the data sucks and to please be patient while I fix it.</p><p id="7d35" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Of course, test-then-build doesn’t totally fix this anxiety issue. The story would change from needing to rush to fix the issue to avoid bad data for downstream users to rushing to fix the issue to avoid stale data for downstream users. However, engineering is all about weighing the pros and cons of different solutions. And in this scenario I know old data would have been the best of two evils for both the business and my sanity.</p><p id="79d7" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The second benefit test-then-build has is that it can be much simpler to implement, especially compared to setting up a whole QA area, which is a bazooka-to-a-bunny solution for solving most data quality issues. All you need to do is include your data quality criteria when you create the table. Have a look at the below PostgreSQL query:</p><pre class="ms mt mu mv mw pr ps pt bp pu bb bk"><span id="0795" class="pv oi fq ps b bg pw px l py pz">CREATE TYPE currency_code_type AS ENUM (<br/>    'USD', -- United States Dollar<br/>    'EUR', -- Euro<br/>    'GBP', -- British Pound Sterling<br/>    'JPY', -- Japanese Yen<br/>    'CAD', -- Canadian Dollar<br/>    'AUD', -- Australian Dollar<br/>    'CNY', -- Chinese Yuan<br/>    'INR', -- Indian Rupee<br/>    'BRL', -- Brazilian Real<br/>    'MXN'  -- Mexican Peso<br/>);<br/><br/>CREATE TYPE payment_status AS ENUM (<br/>    'pending',<br/>    'completed',<br/>    'failed',<br/>    'refunded',<br/>    'partially_refunded',<br/>    'disputed',<br/>    'canceled'<br/>);<br/><br/>CREATE TABLE daily_revenue (<br/>    id INTEGER PRIMARY KEY,<br/>    date DATE NOT NULL,<br/>    revenue_source revenue_source_type NOT NULL,<br/>    gross_amount NUMERIC(15,2) NOT NULL CHECK (gross_amount &gt;= 0),<br/>    net_amount NUMERIC(15,2) NOT NULL CHECK (net_amount &gt;= 0),<br/>    currency currency_code_type,<br/>    transaction_count INTEGER NOT NULL CHECK (transaction_count &gt;= 0),<br/>    notes TEXT,<br/><br/>    CHECK (net_amount &lt;= gross_amount),<br/>    CHECK (gross_amount &gt;= processing_fees + tax_amount),<br/>    CHECK (date &lt;= CURRENT_DATE),<br/>    CONSTRAINT unique_daily_source UNIQUE (date, revenue_source)<br/>); </span></pre><p id="a29c" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">These 14 lines of code will ensure the daily_revenue table enforces the following standards:</p><p id="dc9b" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx qa qb qc ps b">id</code></p><ul class=""><li id="1dd7" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Primary key constraint ensures uniqueness.</li></ul><p id="d9e2" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx qa qb qc ps b">date</code></p><ul class=""><li id="8686" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Cannot be a future date (via CHECK constraint).</li><li id="8207" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Forms part of a unique constraint with revenue_source.</li></ul><p id="6a86" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx qa qb qc ps b">revenue_source</code></p><ul class=""><li id="71c8" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Cannot be NULL.</li><li id="6512" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Forms part of a unique constraint with date.</li><li id="e781" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Must be a valid value from revenue_source_type enum.</li></ul><p id="998b" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx qa qb qc ps b">gross_amount</code></p><ul class=""><li id="5551" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Cannot be NULL.</li><li id="0ade" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Must be &gt;= 0.</li><li id="b0d9" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Must be &gt;= processing_fees + tax_amount.</li><li id="6854" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Must be &gt;= net_amount.</li><li id="0a21" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Precise decimal handling.</li></ul><p id="3032" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx qa qb qc ps b">net_amount</code></p><ul class=""><li id="8226" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Cannot be NULL.</li><li id="8c80" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Must be &gt;= 0.</li><li id="44ea" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Must be &lt;= gross_amount.</li><li id="8214" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Precise decimal handling.</li></ul><p id="55b5" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx qa qb qc ps b">currency</code></p><ul class=""><li id="0adc" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Must be a valid value from currency_code_type enum.</li></ul><p id="f3b2" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk"><code class="cx qa qb qc ps b">transaction_count</code></p><ul class=""><li id="08ff" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Cannot be NULL.</li><li id="a614" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Must be &gt;= 0.</li></ul><p id="112a" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">It’s simple. Reliable. And would you believe all of this was available to us since the release of PostgreSQL 6.5… which came out in 1999!</p><p id="61ef" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Of course there’s no such thing as a free lunch. Enforcing constraints this way does have its drawbacks. For example, it makes the table a lot less flexible, and it will reduce the performance when updating the table. As always, you need to think like an engineer before diving into any tool/technology/method.</p><h1 id="4a0f" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Create a custom dashboard</h1><p id="d5e2" class="pw-post-body-paragraph nk nl fq nm b go pd no np gr pe nr ns nt pf nv nw nx pg nz oa ob ph od oe of fj bk">I have a confession to make. I used to think good data engineers didn’t use dashboard tools to solve their problems. I thought a real engineer looks at logs, hard-to-read code, and whatever else made them look smart if someone ever glanced at their computer screen.</p><p id="0650" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">I was dumb.</p><p id="71c6" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">It turns out they can be really valuable if executed effectively for a clear purpose. Furthermore, most BI tools make creating dashboards super easy and quick, without (too) much time spent learning the tool.</p><p id="0f64" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Back to my personal pipeline experiences. I used to manage a daily aggregated table of all the business’ revenue sources. Each source came from a different revenue provider, and as such a different system. Some would be via API calls, others via email, and others via a shared S3 bucket. As any engineer would expect, some of these sources fell over from time-to-time, and because they came from third parties, I couldn’t fix the issue at source (only ask, which had very limited success).</p><p id="407c" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Originally, I had only used failure logs to determine where things needed fixing. The problem was priority. Some failures needed quickly fixing, while others were not important enough to drop everything for (we had some revenue sources that literally reported pennies each day). As a result, there was a build up of small data quality issues, which became difficult to keep track of.</p><p id="1184" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Enter Tableau.</p><p id="9e54" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">I created a very basic dashboard that highlighted metadata by revenue source and date for the last 14 days. Three metrics were all I needed:</p><ol class=""><li id="a4f0" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of qd pj pk bk">A green or red mark indicating whether data was present or missing.</li><li id="af68" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of qd pj pk bk">The row count of the data.</li><li id="8ecb" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of qd pj pk bk">The sum of revenue of the data.</li></ol><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq qe"><img src="../Images/c52b8496ecc6364ad902401ced5c886e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdpRB5CzKQ-P4ZKeRIsQAA.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">A simple yet effective dashboard. Created by the author using <a class="af nj" href="https://www.tableau.com/en-gb" rel="noopener ugc nofollow" target="_blank">Tableau</a></figcaption></figure><p id="aefd" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">This made the pipeline’s data quality a whole lot easier to manage. Not only was it much quicker for me to glance at where the issues were, but it was user-friendly enough for other people to read from too, allowing for shared responsibility.</p><p id="0753" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">After implementing the dashboard, bug tickets reported by the business related to the pipeline dropped to virtually zero, as did my risk of a stroke.</p><h1 id="ba02" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Map your data with a lineage chart</h1><p id="3f04" class="pw-post-body-paragraph nk nl fq nm b go pd no np gr pe nr ns nt pf nv nw nx pg nz oa ob ph od oe of fj bk">Simple data observability solutions don’t just stop at dashboards.</p><p id="52b7" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Data lineage can be a dream for quickly spotting what tables have been affected by bad data upstream.</p><p id="1653" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">However, it can also be a mammoth task to implement.</p><p id="ccc2" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The number one culprit for this, in my opinion, is dbt. A key selling point of the open-source tool is its data lineage capabilities. But to achieve this you have to bow down to dbt’s framework. Including, but not limited to:</p><ul class=""><li id="2d27" class="nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of pi pj pk bk">Implementing <a class="af nj" href="https://jinja.palletsprojects.com/en/stable/" rel="noopener ugc nofollow" target="_blank">Jinja3</a> in all you SQL files.</li><li id="974c" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Creating a YAML file for each data model.</li><li id="d908" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Add Source data configuration via YAML files.</li><li id="bc61" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Set up a development and testing process e.g. development environment, version control, CI/CD.</li><li id="bc43" class="nk nl fq nm b go pl no np gr pm nr ns nt pn nv nw nx po nz oa ob pp od oe of pi pj pk bk">Infrastructure set-up e.g. hosting your own server or purchasing a managed version (<a class="af nj" href="https://www.getdbt.com/pricing" rel="noopener ugc nofollow" target="_blank">dbtCloud</a>).</li></ul><p id="3fd2" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Yeah, it’s a lot.</p><p id="5ff1" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">But it doesn’t have to be. Ultimately, all you need for dynamic data lineage is a machine that scans your SQL files, and something to output a user-friendly lineage map. Thanks to Python, this can be achieved using a script with as few as 100 lines of code.</p><p id="d0d0" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">If you know a bit of Python and LLM prompting you should be able to hack the code in an hour. Alternatively, there’s a lightweight open-source Python tool called <a class="af nj" href="https://github.com/caitpj/SQL-WatchPup" rel="noopener ugc nofollow" target="_blank">SQL-WatchPup</a> that already has the code.</p><p id="4c46" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Provided you have all your SQL files available, in 15 minutes of set up you should be able to generate dynamic data lineage maps like so:</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq qf"><img src="../Images/2ce584894fa4dbecf310e22749ba9487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UOrS2-AYnnmHbeyz"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Example data lineage map output. Created by the author using <a class="af nj" href="https://github.com/caitpj/SQL-WatchPup" rel="noopener ugc nofollow" target="_blank">SQL-WatchPup</a></figcaption></figure><p id="38c6" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">That’s it. No server hosting costs. No extra computer languages to learn. No restructuring of your files. Just running one simple Python script locally.</p><h1 id="efae" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Conclusion</h1><p id="918d" class="pw-post-body-paragraph nk nl fq nm b go pd no np gr pe nr ns nt pf nv nw nx pg nz oa ob ph od oe of fj bk">Let’s face it — we all love shiny new in-vogue tools, but sometimes the best solutions are old, uncool, and/or unpopular.</p><p id="9604" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">The next time you’re faced with data quality headaches, take a step back before diving into that massive infrastructure overhaul. Ask yourself: Could a simple database constraint, a basic dashboard, or a lightweight Python script do the trick?</p><p id="76e2" class="pw-post-body-paragraph nk nl fq nm b go nn no np gr nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of fj bk">Your sanity will thank you for it. Your company’s budget will too.</p></div></div></div></div>    
</body>
</html>