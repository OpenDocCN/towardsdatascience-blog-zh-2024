["```py\nfrom dataclasses import dataclass\nfrom datetime import datetime, timedelta\nfrom random import choice, gauss, randrange, seed\nfrom typing import Any, Dict\n\nimport polars as pl\nimport pandas as pd\n\nseed(42)\n```", "```py\nbase_time= datetime(2024, 8, 31, 0, 0, 0, 0)\n\nuser_actions_data = [\n    {\n        \"OnlineStore\": choice([\"Shop1\", \"Shop2\", \"Shop3\"]),\n        \"product\": choice([\"0001\", \"0002\", \"0003\"]),\n        \"quantity\": choice([1.0, 2.0, 3.0]),\n        \"Action type\": (\"purchase\" if gauss() > 0.6 else \"view\"),\n        \"Action_time\": base_time - timedelta(minutes=randrange(1_000_000)),\n    }\n    for x in range(1_000_000)\n]\n\ncorrupted_data = [\n    {\n        \"OnlineStore\": choice([\"Shop1\", \"Shop2\", \"Shop3\"]),\n        \"product\": choice([\"0001\", None]),\n        \"quantity\": choice([1.0, None]),\n        \"Action type\": (\"purchase\" if gauss() > 0.6 else \"view\"),\n        \"Action_time\": base_time - timedelta(minutes=randrange(1_000)),\n    }\n    for x in range(1_000)\n]\n```", "```py\nproduct_catalog_data = {\"product_id\": [\"0001\", \"0002\", \"0003\"], \"price\": [100, 25, 80]}\n```", "```py\n# Pandas\nuser_actions_pd_df = pd.DataFrame(user_actions_data)\ncorrupted_pd_df = pd.DataFrame(corrupted_data)\nproduct_catalog_pd_df = pd.DataFrame(product_catalog_data)\n\n# Polars\nuser_actions_pl_df = pl.DataFrame(user_actions_data)\ncorrupted_pl_df = pl.DataFrame(corrupted_data)\nproduct_catalog_pl_df = pl.DataFrame(product_catalog_data)\n```", "```py\n# Pandas\nuser_actions_pd_df = pd.concat([user_actions_pd_df, corrupted_pd_df])\n\n# Polars\nuser_actions_pl_df = pl.concat([user_actions_pl_df, corrupted_pl_df])\n```", "```py\n# Pandas\nuser_actions_pd_df.describe(include='all')\n```", "```py\n OnlineStore  product      quantity Action type          Action_time\ncount      1001000  1000492  1.000510e+06     1001000              1001000\nunique           3        3           NaN           2               632335\ntop          Shop3     0001           NaN        view  2024-08-30 22:02:00\nfreq        333931   333963           NaN      726623                    9\nfirst          NaN      NaN           NaN         NaN  2022-10-06 13:23:00\nlast           NaN      NaN           NaN         NaN  2024-08-30 23:58:00\nmean           NaN      NaN  1.998925e+00         NaN                  NaN\nstd            NaN      NaN  8.164457e-01         NaN                  NaN\nmin            NaN      NaN  1.000000e+00         NaN                  NaN\n25%            NaN      NaN  1.000000e+00         NaN                  NaN\n50%            NaN      NaN  2.000000e+00         NaN                  NaN\n75%            NaN      NaN  3.000000e+00         NaN                  NaN\nmax            NaN      NaN  3.000000e+00         NaN                  NaN\n```", "```py\n# Polars\nuser_actions_pl_df.describe()\n```", "```py\n┌────────────┬─────────────┬─────────┬───────────┬─────────────┬────────────────────────────┐\n│ statistic  ┆ OnlineStore ┆ product ┆ quantity  ┆ Action type ┆ Action_time                │\n│ ---        ┆ ---         ┆ ---     ┆ ---       ┆ ---         ┆ ---                        │\n│ str        ┆ str         ┆ str     ┆ f64       ┆ str         ┆ str                        │\n╞════════════╪═════════════╪═════════╪═══════════╪═════════════╪════════════════════════════╡\n│ count      ┆ 1001000     ┆ 1000492 ┆ 1.00051e6 ┆ 1001000     ┆ 1001000                    │\n│ null_count ┆ 0           ┆ 508     ┆ 490.0     ┆ 0           ┆ 0                          │\n│ mean       ┆ null        ┆ null    ┆ 1.998925  ┆ null        ┆ 2023-09-19 03:24:30.981698 │\n│ std        ┆ null        ┆ null    ┆ 0.816446  ┆ null        ┆ null                       │\n│ min        ┆ Shop1       ┆ 1       ┆ 1.0       ┆ purchase    ┆ 2022-10-06 13:23:00        │\n│ 25%        ┆ null        ┆ null    ┆ 1.0       ┆ null        ┆ 2023-03-29 03:09:00        │\n│ 50%        ┆ null        ┆ null    ┆ 2.0       ┆ null        ┆ 2023-09-19 06:49:00        │\n│ 75%        ┆ null        ┆ null    ┆ 3.0       ┆ null        ┆ 2024-03-11 03:01:00        │\n│ max        ┆ Shop3       ┆ 3       ┆ 3.0       ┆ view        ┆ 2024-08-30 23:58:00        │\n└────────────┴─────────────┴─────────┴───────────┴─────────────┴────────────────────────────┘\n```", "```py\n# Pandas\nuser_actions_pd_df.head()\n```", "```py\n OnlineStore product  quantity Action type         Action_time\n0       Shop3    0001       1.0        view 2024-05-21 09:24:00\n1       Shop3    0001       3.0        view 2023-03-10 15:54:00\n2       Shop3    0001       3.0        view 2024-03-24 19:02:00\n3       Shop1    0003       3.0        view 2024-08-11 16:16:00\n4       Shop3    0001       3.0        view 2024-03-23 11:32:00\n```", "```py\n# Polars\nuser_actions_pl_df.head()\n```", "```py\n┌─────────────┬─────────┬──────────┬─────────────┬─────────────────────┐\n│ OnlineStore ┆ product ┆ quantity ┆ Action type ┆ Action_time         │\n│ ---         ┆ ---     ┆ ---      ┆ ---         ┆ ---                 │\n│ str         ┆ str     ┆ f64      ┆ str         ┆ datetime[μs]        │\n╞═════════════╪═════════╪══════════╪═════════════╪═════════════════════╡\n│ Shop3       ┆ 0001    ┆ 1.0      ┆ view        ┆ 2024-05-21 09:24:00 │\n│ Shop3       ┆ 0001    ┆ 3.0      ┆ view        ┆ 2023-03-10 15:54:00 │\n│ Shop3       ┆ 0001    ┆ 3.0      ┆ view        ┆ 2024-03-24 19:02:00 │\n│ Shop1       ┆ 0003    ┆ 3.0      ┆ view        ┆ 2024-08-11 16:16:00 │\n│ Shop3       ┆ 0001    ┆ 3.0      ┆ view        ┆ 2024-03-23 11:32:00 │\n└─────────────┴─────────┴──────────┴─────────────┴─────────────────────┘\n```", "```py\n# Polars\nuser_actions_pl_df.glimpse()\n```", "```py\nRows: 1001000\nColumns: 5\n$ OnlineStore          <str> 'Shop3', 'Shop3', 'Shop3', 'Shop1', 'Shop3', 'Shop2', 'Shop1', 'Shop2', 'Shop1', 'Shop2'\n$ product              <str> '0001', '0001', '0001', '0003', '0001', '0003', '0001', '0001', '0002', '0003'\n$ quantity             <f64> 1.0, 3.0, 3.0, 3.0, 3.0, 2.0, 3.0, 1.0, 2.0, 1.0\n$ Action type          <str> 'view', 'view', 'view', 'view', 'view', 'view', 'view', 'view', 'view', 'view'\n$ Action_time <datetime[μs]> 2024-05-21 09:24:00, 2023-03-10 15:54:00, 2024-03-24 19:02:00, 2024-08-11 16:16:00, 2024-03-23 11:32:00, 2023-01-19 14:11:00, 2024-03-27 05:08:00, 2023-11-28 08:18:00, 2023-03-18 15:01:00, 2022-10-29 09:44:00\n```", "```py\n# Pandas\nuser_actions_pd_df = user_actions_pd_df.rename(\n    columns={\n        \"OnlineStore\": \"online_store\",\n        \"product\": \"product_id\",\n        \"Action type\": \"action_type\",\n        \"Action_time\": \"action_dt\",\n    }\n)\n```", "```py\n# user_actions_pd_df.columns\nIndex(['online_store', 'product_id', 'quantity', 'action_type', 'action_dt'], dtype='object')\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.rename(\n    {\n        \"OnlineStore\": \"online_store\",\n        \"product\": \"product_id\",\n        \"Action type\": \"action_type\",\n        \"Action_time\": \"action_dt\",\n    }\n)\n```", "```py\n# user_actions_pl_df.columns\n['online_store', 'product_id', 'quantity', 'action_type', 'action_dt']\n```", "```py\n# Pandas\nuser_actions_pd_df = user_actions_pd_df.astype({\"quantity\": \"Int64\"})\n```", "```py\nInt64Index: 1001000 entries, 0 to 999\nData columns (total 5 columns):\n #   Column        Non-Null Count    Dtype         \n---  ------        --------------    -----         \n 0   online_store  1001000 non-null  object        \n 1   product_id    1000492 non-null  object        \n 2   quantity      1000510 non-null  Int64         \n 3   action_type   1001000 non-null  object        \n 4   action_dt     1001000 non-null  datetime64[ns]\ndtypes: Int64(1), datetime64[ns](1), object(3)\nmemory usage: 46.8+ MB\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.cast({\"quantity\": pl.Int32})\n```", "```py\nRows: 1001000\nColumns: 5\n$ online_store          <str> \n$ product_id            <str> \n$ quantity              <i32> \n$ action_type           <str> \n$ action_dt    <datetime[μs]> \n```", "```py\nuser_actions_pl_df.estimated_size(\"mb\")\n# Result: 24.91054630279541\n```", "```py\n# Pandas\nuser_actions_pd_df[\"quantity\"].fillna(0, inplace=True)\n```", "```py\nData columns (total 5 columns):\n #   Column        Non-Null Count    Dtype         \n---  ------        --------------    -----         \n 0   online_store  1001000 non-null  object        \n 1   product_id    1000492 non-null  object        \n 2   quantity      1001000 non-null  Int64         \n 3   action_type   1001000 non-null  object        \n 4   action_dt     1001000 non-null  datetime64[ns]\ndtypes: Int64(1), datetime64[ns](1), object(3)\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.with_columns(pl.col(\"quantity\").fill_null(0))\n```", "```py\n┌────────────┬──────────────┬────────────┬──────────┬─────────────┬────────────────────────────┐\n│ statistic  ┆ online_store ┆ product_id ┆ quantity ┆ action_type ┆ action_dt                  │\n│ ---        ┆ ---          ┆ ---        ┆ ---      ┆ ---         ┆ ---                        │\n│ str        ┆ str          ┆ str        ┆ f64      ┆ str         ┆ str                        │\n╞════════════╪══════════════╪════════════╪══════════╪═════════════╪════════════════════════════╡\n│ count      ┆ 1001000      ┆ 1000492    ┆ 1.001e6  ┆ 1001000     ┆ 1001000                    │\n│ null_count ┆ 0            ┆ 508        ┆ 0.0      ┆ 0           ┆ 0                          │\n└────────────┴──────────────┴────────────┴──────────┴─────────────┴────────────────────────────┘\n```", "```py\n# Pandas\nuser_actions_pd_df.dropna(subset=[\"product_id\"], inplace=True)\n```", "```py\nInt64Index: 1000492 entries, 0 to 999\nData columns (total 5 columns):\n #   Column        Non-Null Count    Dtype         \n---  ------        --------------    -----         \n 0   online_store  1000492 non-null  object        \n 1   product_id    1000492 non-null  object        \n 2   quantity      1000492 non-null  Int64         \n 3   action_type   1000492 non-null  object        \n 4   action_dt     1000492 non-null  datetime64[ns]\ndtypes: Int64(1), datetime64[ns](1), object(3)\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.drop_nulls(subset=[\"product_id\"])\n```", "```py\n┌────────────┬──────────────┬────────────┬────────────┬─────────────┬────────────────────────────┐\n│ statistic  ┆ online_store ┆ product_id ┆ quantity   ┆ action_type ┆ action_dt                  │\n│ ---        ┆ ---          ┆ ---        ┆ ---        ┆ ---         ┆ ---                        │\n│ str        ┆ str          ┆ str        ┆ f64        ┆ str         ┆ str                        │\n╞════════════╪══════════════╪════════════╪════════════╪═════════════╪════════════════════════════╡\n│ count      ┆ 1000492      ┆ 1000492    ┆ 1.000492e6 ┆ 1000492     ┆ 1000492                    │\n│ null_count ┆ 0            ┆ 0          ┆ 0.0        ┆ 0           ┆ 0                          │\n└────────────┴──────────────┴────────────┴────────────┴─────────────┴────────────────────────────┘\n```", "```py\n# Pandas\nuser_actions_pd_df.drop_duplicates(\n    subset=[\"online_store\", \"action_type\", \"action_dt\"],\n    keep=\"last\",\n    inplace=True,\n)\n```", "```py\nData columns (total 5 columns):\n #   Column        Non-Null Count   Dtype         \n---  ------        --------------   -----         \n 0   online_store  907246 non-null  object        \n 1   product_id    907246 non-null  object        \n 2   quantity      907246 non-null  Int64         \n 3   action_type   907246 non-null  object        \n 4   action_dt     907246 non-null  datetime64[ns]\ndtypes: Int64(1), datetime64[ns](1), object(3)\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.unique(\n    subset=[\"online_store\", \"action_type\", \"action_dt\"],\n    keep=\"last\",\n)\n```", "```py\n┌────────────┬──────────────┬────────────┬──────────┬─────────────┬────────────────────────────┐\n│ statistic  ┆ online_store ┆ product_id ┆ quantity ┆ action_type ┆ action_dt                  │\n│ ---        ┆ ---          ┆ ---        ┆ ---      ┆ ---         ┆ ---                        │\n│ str        ┆ str          ┆ str        ┆ f64      ┆ str         ┆ str                        │\n╞════════════╪══════════════╪════════════╪══════════╪═════════════╪════════════════════════════╡\n│ count      ┆ 907246       ┆ 907246     ┆ 907246.0 ┆ 907246      ┆ 907246                     │\n│ null_count ┆ 0            ┆ 0          ┆ 0.0      ┆ 0           ┆ 0                          │\n└────────────┴──────────────┴────────────┴──────────┴─────────────┴────────────────────────────┘\n```", "```py\n# Pandas\nuser_actions_pd_df = user_actions_pd_df.loc[\n    user_actions_pd_df[\"action_type\"] == \"purchase\"\n]\n```", "```py\nInt64Index: 262237 entries, 11 to 995\nData columns (total 5 columns):\n #   Column        Non-Null Count   Dtype         \n---  ------        --------------   -----         \n 0   online_store  262237 non-null  object        \n 1   product_id    262237 non-null  object        \n 2   quantity      262237 non-null  Int64         \n 3   action_type   262237 non-null  object        \n 4   action_dt     262237 non-null  datetime64[ns]\ndtypes: Int64(1), datetime64[ns](1), object(3)\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.filter(\n    pl.col(\"action_type\") == \"purchase\"\n)\n```", "```py\n┌────────────┬──────────────┬────────────┬──────────┬─────────────┬────────────────────────────┐\n│ statistic  ┆ online_store ┆ product_id ┆ quantity ┆ action_type ┆ action_dt                  │\n│ ---        ┆ ---          ┆ ---        ┆ ---      ┆ ---         ┆ ---                        │\n│ str        ┆ str          ┆ str        ┆ f64      ┆ str         ┆ str                        │\n╞════════════╪══════════════╪════════════╪══════════╪═════════════╪════════════════════════════╡\n│ count      ┆ 262237       ┆ 262237     ┆ 262237.0 ┆ 262237      ┆ 262237                     │\n│ null_count ┆ 0            ┆ 0          ┆ 0.0      ┆ 0           ┆ 0                          │\n└────────────┴──────────────┴────────────┴──────────┴─────────────┴────────────────────────────┘\n```", "```py\n# Pandas\nuser_actions_pd_df = user_actions_pd_df[\n    [\"online_store\", \"action_type\", \"product_id\", \"quantity\"]\n]\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.select(\n    \"online_store\", \"action_type\", \"product_id\", \"quantity\"\n)\n```", "```py\n# Pandas\nuser_actions_pd_df = (\n    user_actions_pd_df.groupby([\"online_store\", \"product_id\", \"action_type\"])\n    .agg({\"quantity\": \"sum\"})\n    .reset_index()\n)\n```", "```py\n online_store product_id action_type  quantity\n0        Shop1       0001    purchase     57772\n1        Shop1       0002    purchase     58015\n2        Shop1       0003    purchase     58242\n3        Shop2       0001    purchase     58256\n4        Shop2       0002    purchase     58648\n5        Shop2       0003    purchase     58458\n6        Shop3       0001    purchase     57891\n7        Shop3       0002    purchase     58326\n8        Shop3       0003    purchase     59107\n```", "```py\n# Polars\nuser_actions_pl_df = (\n    user_actions_pl_df.group_by([\"online_store\", \"product_id\", \"action_type\"])\n    .agg(pl.col(\"quantity\").sum())\n)\n```", "```py\n┌──────────────┬────────────┬─────────────┬──────────┐\n│ online_store ┆ product_id ┆ action_type ┆ quantity │\n│ ---          ┆ ---        ┆ ---         ┆ ---      │\n│ str          ┆ str        ┆ str         ┆ i32      │\n╞══════════════╪════════════╪═════════════╪══════════╡\n│ Shop1        ┆ 0001       ┆ purchase    ┆ 57772    │\n│ Shop1        ┆ 0002       ┆ purchase    ┆ 58015    │\n│ Shop1        ┆ 0003       ┆ purchase    ┆ 58242    │\n│ Shop2        ┆ 0001       ┆ purchase    ┆ 58256    │\n│ Shop2        ┆ 0002       ┆ purchase    ┆ 58648    │\n│ Shop2        ┆ 0003       ┆ purchase    ┆ 58458    │\n│ Shop3        ┆ 0001       ┆ purchase    ┆ 57891    │\n│ Shop3        ┆ 0002       ┆ purchase    ┆ 58326    │\n│ Shop3        ┆ 0003       ┆ purchase    ┆ 59107    │\n└──────────────┴────────────┴─────────────┴──────────┘\n```", "```py\n# Pandas\nuser_actions_pd_df = user_actions_pd_df.merge(product_catalog_pd_df, on='product_id')\n```", "```py\n online_store product_id action_type  quantity  price\n0        Shop1       0001    purchase     57772    100\n3        Shop1       0002    purchase     58015     25\n6        Shop1       0003    purchase     58242     80\n1        Shop2       0001    purchase     58256    100\n4        Shop2       0002    purchase     58648     25\n7        Shop2       0003    purchase     58458     80\n2        Shop3       0001    purchase     57891    100\n5        Shop3       0002    purchase     58326     25\n8        Shop3       0003    purchase     59107     80\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.join(product_catalog_pl_df, on='product_id')\n```", "```py\n┌──────────────┬────────────┬─────────────┬──────────┬───────┐\n│ online_store ┆ product_id ┆ action_type ┆ quantity ┆ price │\n│ ---          ┆ ---        ┆ ---         ┆ ---      ┆ ---   │\n│ str          ┆ str        ┆ str         ┆ i32      ┆ i64   │\n╞══════════════╪════════════╪═════════════╪══════════╪═══════╡\n│ Shop1        ┆ 0001       ┆ purchase    ┆ 57772    ┆ 100   │\n│ Shop1        ┆ 0002       ┆ purchase    ┆ 58015    ┆ 25    │\n│ Shop1        ┆ 0003       ┆ purchase    ┆ 58242    ┆ 80    │\n│ Shop2        ┆ 0001       ┆ purchase    ┆ 58256    ┆ 100   │\n│ Shop2        ┆ 0002       ┆ purchase    ┆ 58648    ┆ 25    │\n│ Shop2        ┆ 0003       ┆ purchase    ┆ 58458    ┆ 80    │\n│ Shop3        ┆ 0001       ┆ purchase    ┆ 57891    ┆ 100   │\n│ Shop3        ┆ 0002       ┆ purchase    ┆ 58326    ┆ 25    │\n│ Shop3        ┆ 0003       ┆ purchase    ┆ 59107    ┆ 80    │\n└──────────────┴────────────┴─────────────┴──────────┴───────┘\n```", "```py\n# Pandas\nuser_actions_pd_df[\"total\"] = (\n    user_actions_pd_df[\"price\"] * user_actions_pd_df[\"quantity\"]\n)\nuser_actions_pd_df = user_actions_pd_df[\n    [\"online_store\", \"action_type\", \"total\"]\n]\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.with_columns(\n    (pl.col(\"price\") * pl.col(\"quantity\")).alias(\"total\")\n)\nuser_actions_pl_df = user_actions_pl_df.select(\n    \"online_store\", \"action_type\", \"total\"\n)\n```", "```py\n# Polars\nuser_actions_pl_df = user_actions_pl_df.select(\n    \"online_store\",\n    \"action_type\",\n    (pl.col(\"price\") * pl.col(\"quantity\")).alias(\"total\"),\n)\n```", "```py\n# Pandas\nresult_pd = user_actions_pd_df.pivot_table(\n    columns=\"online_store\",\n    index=\"action_type\",\n    values=\"total\",\n    aggfunc=\"sum\",\n)\n```", "```py\nonline_store     Shop1     Shop2     Shop3\naction_type                               \npurchase      11886935  11968440  11975810\n```", "```py\n# Polars\nresult_pl = user_actions_pl_df.pivot(\n    columns=\"online_store\",\n    index=\"action_type\",\n    values=\"total\",\n    aggregate_function=\"sum\",\n)\n```", "```py\n┌─────────────┬──────────┬──────────┬──────────┐\n│ action_type ┆ Shop1    ┆ Shop2    ┆ Shop3    │\n│ ---         ┆ ---      ┆ ---      ┆ ---      │\n│ str         ┆ i64      ┆ i64      ┆ i64      │\n╞═════════════╪══════════╪══════════╪══════════╡\n│ purchase    ┆ 11886935 ┆ 11968440 ┆ 11975810 │\n└─────────────┴──────────┴──────────┴──────────┘\n```"]