<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Linear Optimisations in Product Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Linear Optimisations in Product Analytics</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/linear-optimisations-in-product-analytics-ace19e925677?source=collection_archive---------2-----------------------#2024-12-18">https://towardsdatascience.com/linear-optimisations-in-product-analytics-ace19e925677?source=collection_archive---------2-----------------------#2024-12-18</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="4294" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Solving the knapsack problem</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://miptgirl.medium.com/?source=post_page---byline--ace19e925677--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Mariya Mansurova" class="l ep by dd de cx" src="../Images/b1dd377b0a1887db900cc5108bca8ea8.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*7fFHr8XBAuR_SgJknIyODA.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--ace19e925677--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://miptgirl.medium.com/?source=post_page---byline--ace19e925677--------------------------------" rel="noopener follow">Mariya Mansurova</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--ace19e925677--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">11 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Dec 18, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div></div></div><div class="mj"><div class="ab cb"><div class="lm mk ln ml lo mm cf mn cg mo ci bh"><figure class="ms mt mu mv mw mj mx my paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq mr"><img src="../Images/c6f2f51099b2b5f7cfd3ee32ce1429e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*xaKr6L5hmC8pQN9TW5qILQ.png"/></div></div><figcaption class="ne nf ng mp mq nh ni bf b bg z dx">Image generated by DALL-E 3</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="219c" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">It might be surprising, but in this article, I would like to talk about the knapsack problem, the classic optimisation problem that has been studied for over a century. According to <a class="af of" href="https://en.wikipedia.org/wiki/Knapsack_problem" rel="noopener ugc nofollow" target="_blank">Wikipedia</a>, the problem is defined as follows:</p><blockquote class="og oh oi"><p id="8466" class="nj nk oj nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Given a set of items, each with a weight and a value, determine which items to include in the collection so that the total weight is less than or equal to a given limit and the total value is as large as possible.</p></blockquote><p id="46f8" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">While product analysts may not physically pack knapsacks, the underlying mathematical model is highly relevant to many of our tasks. There are numerous real-world applications of the knapsack problem in product analytics. Here are a few examples:</p><ul class=""><li id="0d26" class="nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe ok ol om bk"><strong class="nl fr">Marketing Campaigns:</strong> The marketing team has a limited budget and capacity to run campaigns across different channels and regions. Their goal is to maximize a KPI, such as the number of new users or revenue, all while adhering to existing constraints.</li><li id="70ea" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><strong class="nl fr">Retail Space Optimization:</strong> A retailer with limited physical space in their stores seeks to optimize product placement to maximize revenue.</li><li id="b52c" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><strong class="nl fr">Product Launch Prioritization:</strong> When launching a new product, the operations team’s capacity might be limited, requiring prioritization of specific markets.</li></ul><p id="6424" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Such and similar tasks are quite common, and many analysts encounter them regularly. So, in this article, I’ll explore different approaches to solving it, ranging from naive, simple techniques to more advanced methods such as linear programming.</p><p id="1175" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Another reason I chose this topic is that linear programming is one of the most powerful and popular tools in prescriptive analytics — a type of analysis that focuses on providing stakeholders with actionable options to make informed decisions. As such, I believe it is an essential skill for any analyst to have in their toolkit.</p><h1 id="c29d" class="os ot fq bf ou ov ow gq ox oy oz gt pa pb pc pd pe pf pg ph pi pj pk pl pm pn bk">Case</h1><p id="ad4d" class="pw-post-body-paragraph nj nk fq nl b go po nn no gr pp nq nr ns pq nu nv nw pr ny nz oa ps oc od oe fj bk">Let’s dive straight into the case we’ll be exploring. Imagine we’re part of a marketing team planning activities for the upcoming month. Our objective is to maximize key performance indicators (KPIs), such as the number of acquired users and revenue while operating within a limited marketing budget.</p><p id="0bfd" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">We’ve estimated the expected outcomes of various marketing activities across different countries and channels. Here is the data we have:</p><ul class=""><li id="557e" class="nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe ok ol om bk"><code class="cx pt pu pv pw b">country</code> — the market where we can do some promotional activities;</li><li id="0fc5" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><code class="cx pt pu pv pw b">channel</code> — the acquisition method, such as social networks or influencer campaigns;</li><li id="205b" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><code class="cx pt pu pv pw b">users</code> — the expected number of users acquired within a month of the promo campaign;</li><li id="28ad" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><code class="cx pt pu pv pw b">cs_contacts</code> — the incremental Customer Support contacts generated by the new users;</li><li id="68ea" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><code class="cx pt pu pv pw b">marketing_spending</code> — the investment required for the activity;</li><li id="be8a" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><code class="cx pt pu pv pw b">revenue</code> — the first-year LTV generated from acquired customers.</li></ul><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq px"><img src="../Images/b047bf0905f1fde49ac919e1fbc9ce87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VReZBrWtos3jroT6S3msw.png"/></div></div></figure><blockquote class="og oh oi"><p id="a2bf" class="nj nk oj nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Note that the dataset is synthetic and randomly generated, so don’t try to infer any market-related insights from it.</p></blockquote><p id="eba6" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">First, I’ve calculated the high-level statistics to get a view of the numbers.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq py"><img src="../Images/eb3aa6704cff645dd793a2c778ce7d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ghhvFvMDUGqNDT_sV8DDjw.png"/></div></div></figure><p id="d33c" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Let’s determine the optimal set of marketing activities that maximizes revenue while staying within the $30M marketing budget.</p><h1 id="a965" class="os ot fq bf ou ov ow gq ox oy oz gt pa pb pc pd pe pf pg ph pi pj pk pl pm pn bk">Brute force approach</h1><p id="9961" class="pw-post-body-paragraph nj nk fq nl b go po nn no gr pp nq nr ns pq nu nv nw pr ny nz oa ps oc od oe fj bk">At first glance, the problem may seem straightforward: we could calculate all possible combinations of marketing activities and select the optimal one. However, it might be a challenging task.</p><p id="3af0" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">With 62 segments, there are 2⁶² possible combinations, as each segment can either be included or excluded. This results in approximately 4.6*10¹⁸ combinations — an astronomical number.</p><p id="d08f" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">To better understand the computational feasibility, let’s consider a smaller subset of 15 segments and estimate the time required for one iteration.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="55ed" class="qc ot fq pw b bg qd qe l qf qg">import itertools<br/>import pandas as pd<br/>import tqdm<br/><br/># reading data<br/>df = pd.read_csv('marketing_campaign_estimations.csv', sep = '\t')<br/>df['segment'] = df.country + ' - ' + df.channel<br/><br/># calculating combinations<br/>combinations = []<br/>segments = list(df.segment.values)[:15]<br/>print('number of segments: ', len(segments))<br/><br/>for num_items in range(len(segments) + 1):<br/>  combinations.extend(<br/>      itertools.combinations(segments, num_items)<br/>  )<br/>print('number of combinations: ', len(combinations))<br/><br/>tmp = []<br/>for selected in tqdm.tqdm(combinations):<br/>    tmp_df = df[df.segment.isin(selected)]<br/>    tmp.append(<br/>        {<br/>        'selected_segments': ', '.join(selected),<br/>        'users': tmp_df.users.sum(),<br/>        'cs_contacts': tmp_df.cs_contacts.sum(),<br/>        'marketing_spending': tmp_df.marketing_spending.sum(),<br/>        'revenue': tmp_df.revenue.sum()<br/>        }<br/>    )<br/><br/># number of segments:  15<br/># number of combinations:  32768</span></pre><p id="3053" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">It took approximately 4 seconds to process 15 segments, allowing us to handle around 7,000 iterations per second. Using this estimate, let’s calculate the execution time for the full set of 62 segments.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="d220" class="qc ot fq pw b bg qd qe l qf qg">2**62 / 7000 / 3600 / 24 / 365<br/># 20 890 800.6</span></pre><p id="d8d4" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Using brute force, it would take around 20.9 million years to get the answer to our question — clearly not a feasible option.</p><p id="0e8f" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Execution time is entirely determined by the number of segments. Removing just one segment can reduce time twice. With this in mind, let’s explore possible ways to merge segments.</p><p id="f13a" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">As usual, there are more small-sized segments than bigger ones, so merging them is a logical step. However, it’s important to note that this approach may reduce accuracy since multiple segments are aggregated into one. Despite this, it could still yield a solution that is “good enough.”</p><p id="5451" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">To simplify, let’s merge all segments that contribute less than 0.1% of revenue.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="e25d" class="qc ot fq pw b bg qd qe l qf qg">df['share_of_revenue'] = df.revenue/df.revenue.sum() * 100<br/>df['segment_group'] = list(map(<br/>    lambda x, y: x if y &gt;= 0.1 else 'other',<br/>    df.segment,<br/>    df.share_of_revenue<br/>))<br/><br/>print(df[df.segment_group == 'other'].share_of_revenue.sum())<br/># 0.53<br/>print(df.segment_group.nunique())<br/># 52</span></pre><p id="92fe" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">With this approach, we will merge ten segments into one, representing 0.53% of the total revenue (the potential margin of error). With 52 segments remaining, we can obtain the solution in just 20.4K years. While this is a significant improvement, it’s still not sufficient.</p><p id="ee2e" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">You may consider other heuristics tailored to your specific task. For instance, if your constraint is a ratio (e.g., contact rate = CS contacts / users ≤ 5%), you could group all segments where the constraint holds true, as the optimal solution will include all of them. In our case, however, I don’t see any additional strategies to reduce the number of segments, so brute force seems impractical.</p><p id="b857" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">That said, if the number of combinations is relatively small and brute force can be executed within a reasonable time, it can be an ideal approach. It’s simple to develop and provides accurate results.</p><h1 id="a7b4" class="os ot fq bf ou ov ow gq ox oy oz gt pa pb pc pd pe pf pg ph pi pj pk pl pm pn bk">Naive approach: looking at top-performing segments</h1><p id="8bbe" class="pw-post-body-paragraph nj nk fq nl b go po nn no gr pp nq nr ns pq nu nv nw pr ny nz oa ps oc od oe fj bk">Since brute force is not feasible for calculating all combinations, let’s consider a simpler algorithm to address this problem.</p><p id="d853" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">One possible approach is to focus on the top-performing segments. We can evaluate segment performance by calculating revenue per dollar spent, then sort all activities based on this ratio and select the top performers that fit within the marketing budget. Let’s implement it.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="c9b1" class="qc ot fq pw b bg qd qe l qf qg">df['revenue_per_spend'] = df.revenue / df.marketing_spending <br/>df = df.sort_values('revenue_per_spend', ascending = False)<br/>df['spend_cumulative'] = df.marketing_spending.cumsum()<br/>selected_df = df[df.spend_cumulative &lt;= 30000000]<br/>print(selected_df.shape[0])<br/># 48 <br/>print(selected_df.revenue.sum()/1000000)<br/># 107.92</span></pre><p id="e17b" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">With this approach, we selected 48 activities and got $107.92M in revenue.</p><p id="372f" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Unfortunately, although the logic seems reasonable, it is not the optimal solution for maximizing revenue. Let’s look at a simple example with just three marketing activities.</p><figure class="ms mt mu mv mw mj mp mq paragraph-image"><div role="button" tabindex="0" class="mz na ed nb bh nc"><div class="mp mq qh"><img src="../Images/5a45bbcb23204b349ee62ca17f855fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9fI7Djz7iFyJwkdQ4Lr2g.png"/></div></div></figure><p id="7091" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Using the top markets approach, we would select France and achieve $68M in revenue. However, by choosing two other markets, we could achieve significantly better results — $97.5M. The key point is that our algorithm optimizes not only for maximum revenue but also for minimizing the number of selected segments. Therefore, this approach will not yield the best results, especially considering its inability to account for multiple constraints.</p><h1 id="25b5" class="os ot fq bf ou ov ow gq ox oy oz gt pa pb pc pd pe pf pg ph pi pj pk pl pm pn bk">Linear Programming</h1><p id="8526" class="pw-post-body-paragraph nj nk fq nl b go po nn no gr pp nq nr ns pq nu nv nw pr ny nz oa ps oc od oe fj bk">Since all simple approaches have failed, we must return to the fundamentals and explore the theory behind this problem. Fortunately, the knapsack problem has been studied for many years, and we can apply optimization techniques to solve it in seconds rather than years.</p><p id="8b03" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The problem we’re trying to solve is an example of Integer Programming, which is actually a subdomain of Linear Programming.</p><p id="69f6" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">We’ll discuss this shortly, but first, let’s align on the key concepts of the optimization process. Each optimisation problem consists of:</p><ul class=""><li id="21fb" class="nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe ok ol om bk"><strong class="nl fr">Decision variables</strong>: Parameters that can be adjusted in the model, typically representing the levers or decisions we want to make.</li><li id="b9e8" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><strong class="nl fr">Objective function</strong>: The target variable we aim to maximize or minimize. It goes without saying that it must depend on the decision variables.</li><li id="e687" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><strong class="nl fr">Constraints</strong>: Conditions placed on the decision variables that define their possible values. For example, ensuring the team cannot work a negative number of hours.</li></ul><p id="2810" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">With these basic concepts in mind, we can define Linear Programming as a scenario where the following conditions hold:</p><ul class=""><li id="24cd" class="nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe ok ol om bk">The objective function is linear.</li><li id="80cd" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk">All constraints are linear.</li><li id="d007" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk">Decision variables are real-valued.</li></ul><p id="b9fd" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Integer Programming is very similar to Linear Programming, with one key difference: some or all decision variables must be integers. While this may seem like a minor change, it significantly impacts the solution approach, requiring more complex methods than those used in Linear Programming. One common technique is <a class="af of" href="https://en.wikipedia.org/wiki/Branch_and_bound" rel="noopener ugc nofollow" target="_blank">branch-and-bound</a>. We won’t dive deeper into the theory here, but you can always find more detailed explanations online.</p><p id="c106" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">For linear optimization, I prefer the widely used Python package <a class="af of" href="https://coin-or.github.io/pulp/" rel="noopener ugc nofollow" target="_blank">PuLP</a>. However, there are other options available, such as <a class="af of" href="https://pypi.org/project/mip/" rel="noopener ugc nofollow" target="_blank">Python MIP</a> or <a class="af of" href="https://github.com/Pyomo/pyomo" rel="noopener ugc nofollow" target="_blank">Pyomo</a>. Let’s install PuLP via pip.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="8ae9" class="qc ot fq pw b bg qd qe l qf qg">! pip install pulp</span></pre><p id="0dfc" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Now, it’s time to define our task as a mathematical optimisation problem. There are the following steps for it:</p><ul class=""><li id="7f09" class="nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe ok ol om bk"><strong class="nl fr">Define the set of decision variables</strong> (levers we can adjust).</li><li id="9e7d" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><strong class="nl fr">Align on the objective function (</strong>a variable that we will be optimising for).</li><li id="0361" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk"><strong class="nl fr">Formulate constraints</strong> (the conditions that must hold true during optimisations).</li></ul><p id="7fc8" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Let’s go through the steps one by one. But first, we need to create the problem object and set the objective — maximization in our case.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="48d8" class="qc ot fq pw b bg qd qe l qf qg">from pulp import *<br/>problem = LpProblem("Marketing_campaign", LpMaximize)</span></pre><p id="a35c" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The next step is defining the decision variables — parameters that we can change during optimisation. Our main decision is either to run a marketing campaign or not. So, we can model it as a set of binary variables (0 or 1) for each segment. Let’s do it with the PuLP library.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="ae26" class="qc ot fq pw b bg qd qe l qf qg">segments = range(df.shape[0])  <br/>selected = LpVariable.dicts("Selected", segments, cat="Binary")</span></pre><p id="3732" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">After that, it’s time to align on the objective function. As discussed, we want to maximise the revenue. The total revenue will be a sum of revenue from all the selected segments (where <code class="cx pt pu pv pw b">decision_variable = 1</code> ). Therefore, we can define this formula as the sum of the expected revenue for each segment multiplied by the decision binary variable.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="fe00" class="qc ot fq pw b bg qd qe l qf qg">problem += lpSum(<br/>  selected[i] * list(df['revenue'].values)[i] <br/>  for i in segments<br/>)</span></pre><p id="e55d" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The final step is to add constraints. Let’s start with a simple constraint: our marketing spending must be below $30M.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="1ded" class="qc ot fq pw b bg qd qe l qf qg">problem += lpSum(<br/>    selected[i] * df['marketing_spending'].values[i]<br/>    for i in segments<br/>) &lt;= 30 * 10**6</span></pre><blockquote class="og oh oi"><p id="9a6e" class="nj nk oj nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk"><strong class="nl fr">Hint</strong>: you can print <code class="cx pt pu pv pw b">problem</code> to double check the objective function and constraints.</p></blockquote><p id="5065" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Now that we’ve defined everything, we can run the optimization and analyze the results.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="1c4a" class="qc ot fq pw b bg qd qe l qf qg">problem.solve()</span></pre><p id="3d2a" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">It takes less than a second to run the optimization, a significant improvement compared to the thousands of years that brute force would require.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="f2da" class="qc ot fq pw b bg qd qe l qf qg">Result - Optimal solution found<br/><br/>Objective value:                110162662.21000001<br/>Enumerated nodes:               4<br/>Total iterations:               76<br/>Time (CPU seconds):             0.02<br/>Time (Wallclock seconds):       0.02</span></pre><p id="3908" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Let’s save the results of the model execution — the decision variables indicating whether each segment was selected or not — into our dataframe.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="8f90" class="qc ot fq pw b bg qd qe l qf qg">df['selected'] = list(map(lambda x: x.value(), selected.values()))<br/>print(df[df.selected == 1].revenue.sum()/10**6)<br/># 110.16</span></pre><p id="5437" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">It works like magic, allowing you to obtain the solution quickly. Additionally, note that we achieved higher revenue compared to our naive approach: $110.16M versus $107.92M.</p><p id="c0c6" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">We’ve tested integer programming with a simple example featuring just one constraint, but we can extend it further. For instance, we can add additional constraints for our CS contacts to ensure that our Operations team can handle the demand in a healthy way:</p><ul class=""><li id="0f95" class="nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe ok ol om bk">The number of additional CS contacts ≤ 5K</li><li id="00ab" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk">Contact rate (CS contacts/users) ≤ 0.042</li></ul><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="5bea" class="qc ot fq pw b bg qd qe l qf qg"># define the problem<br/>problem_v2 = LpProblem("Marketing_campaign_v2", LpMaximize)<br/><br/># decision variables<br/>segments = range(df.shape[0]) <br/>selected = LpVariable.dicts("Selected", segments, cat="Binary")<br/><br/># objective function<br/>problem_v2 += lpSum(<br/>  selected[i] * list(df['revenue'].values)[i] <br/>  for i in segments<br/>)<br/><br/># Constraints<br/>problem_v2 += lpSum(<br/>    selected[i] * df['marketing_spending'].values[i]<br/>    for i in segments<br/>) &lt;= 30 * 10**6<br/><br/>problem_v2 += lpSum(<br/>    selected[i] * df['cs_contacts'].values[i]<br/>    for i in segments<br/>) &lt;= 5000<br/><br/>problem_v2 += lpSum(<br/>    selected[i] * df['cs_contacts'].values[i]<br/>    for i in segments<br/>) &lt;= 0.042 * lpSum(<br/>    selected[i] * df['users'].values[i]<br/>    for i in segments<br/>)<br/><br/># run the optimisation<br/>problem_v2.solve()</span></pre><p id="ea0d" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">The code is straightforward, with the only tricky part being the transformation of the ratio constraint into a simpler linear form.</p><p id="2164" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Another potential constraint you might consider is limiting the number of selected options, for example, to 10. This constraint could be pretty helpful in prescriptive analytics, for example, when you need to select the top-N most impactful focus areas.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="91c1" class="qc ot fq pw b bg qd qe l qf qg"># define the problem<br/>problem_v3 = LpProblem("Marketing_campaign_v2", LpMaximize)<br/><br/># decision variables<br/>segments = range(df.shape[0]) <br/>selected = LpVariable.dicts("Selected", segments, cat="Binary")<br/><br/># objective function<br/>problem_v3 += lpSum(<br/>  selected[i] * list(df['revenue'].values)[i] <br/>  for i in segments<br/>)<br/><br/># constraints<br/>problem_v3 += lpSum(<br/>    selected[i] * df['marketing_spending'].values[i]<br/>    for i in segments<br/>) &lt;= 30 * 10**6<br/><br/>problem_v3 += lpSum(<br/>    selected[i] for i in segments<br/>) &lt;= 10<br/><br/># run the optimisation<br/>problem_v3.solve()<br/>df['selected'] = list(map(lambda x: x.value(), selected.values()))<br/>print(df.selected.sum())<br/># 10</span></pre><p id="e774" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Another possible option to tweak our problem is to change the objective function. We’ve been optimising for the revenue, but imagine we want to maximise both revenue and new users at the same time. For that, we can slightly change our objective function.</p><p id="4cb3" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Let’s consider the best approach. We could calculate the sum of revenue and new users and aim to maximize it. However, since revenue is, on average, 1000 times higher, the results might be skewed toward maximizing revenue. To make the metrics more comparable, we can normalize both revenue and users based on their total sums. Then, we can define the objective function as a weighted sum of these ratios. I would use equal weights (0.5) for both metrics, but you can adjust the weights to give more value to one of them.</p><pre class="ms mt mu mv mw pz pw qa bp qb bb bk"><span id="9bda" class="qc ot fq pw b bg qd qe l qf qg"># define the problem<br/>problem_v4 = LpProblem("Marketing_campaign_v2", LpMaximize)<br/><br/># decision variables<br/>segments = range(df.shape[0]) <br/>selected = LpVariable.dicts("Selected", segments, cat="Binary")<br/><br/># objective Function<br/>problem_v4 += (<br/>    0.5 * lpSum(<br/>        selected[i] * df['revenue'].values[i] / df['revenue'].sum()<br/>        for i in segments<br/>    )<br/>    + 0.5 * lpSum(<br/>        selected[i] * df['users'].values[i] / df['users'].sum()<br/>        for i in segments<br/>    )<br/>)<br/><br/># constraints<br/>problem_v4 += lpSum(<br/>    selected[i] * df['marketing_spending'].values[i]<br/>    for i in segments<br/>) &lt;= 30 * 10**6<br/><br/># run the optimisation<br/>problem_v4.solve()<br/>df['selected'] = list(map(lambda x: x.value(), selected.values()))</span></pre><p id="1de1" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">We obtained the optimal objective function value of 0.6131, with revenue at $104.36M and 136.37K new users.</p><p id="2c3d" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">That’s it! We’ve learned how to use integer programming to solve various optimisation problems.</p><blockquote class="og oh oi"><p id="e9e5" class="nj nk oj nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">You can find the full code on <a class="af of" href="https://github.com/miptgirl/miptgirl_medium/blob/main/discrete_optimisations/discrete_optimisation.ipynb" rel="noopener ugc nofollow" target="_blank">GitHub</a>.</p></blockquote><h1 id="b5a6" class="os ot fq bf ou ov ow gq ox oy oz gt pa pb pc pd pe pf pg ph pi pj pk pl pm pn bk">Summary</h1><p id="f77d" class="pw-post-body-paragraph nj nk fq nl b go po nn no gr pp nq nr ns pq nu nv nw pr ny nz oa ps oc od oe fj bk">In this article, we explored different methods for solving the knapsack problem and its analogues in product analytics.</p><ul class=""><li id="cc57" class="nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe ok ol om bk">We began with a brute-force approach but quickly realized it would take an unreasonable amount of time.</li><li id="5f11" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk">Next, we tried using common sense by naively selecting the top-performing segments, but this approach yielded incorrect results.</li><li id="0975" class="nj nk fq nl b go on nn no gr oo nq nr ns op nu nv nw oq ny nz oa or oc od oe ok ol om bk">Finally, we turned to Integer Programming, learning how to translate our product tasks into optimization models and solve them effectively.</li></ul><p id="1169" class="pw-post-body-paragraph nj nk fq nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">With this, I hope you’ve gained another valuable analytical tool for your toolkit.</p><blockquote class="og oh oi"><p id="774e" class="nj nk oj nl b go nm nn no gr np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe fj bk">Thank you a lot for reading this article. I hope this article was insightful for you. If you have any follow-up questions or comments, please leave them in the comments section.</p></blockquote><h1 id="c101" class="os ot fq bf ou ov ow gq ox oy oz gt pa pb pc pd pe pf pg ph pi pj pk pl pm pn bk">Reference</h1><p id="4d03" class="pw-post-body-paragraph nj nk fq nl b go po nn no gr pp nq nr ns pq nu nv nw pr ny nz oa ps oc od oe fj bk"><em class="oj">All the images are produced by the author unless otherwise stated.</em></p></div></div></div></div>    
</body>
</html>