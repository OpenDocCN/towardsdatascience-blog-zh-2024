# 使用六边形网格探索位置数据

> 原文：[https://towardsdatascience.com/exploring-location-data-using-a-hexagon-grid-3509b68b04a2?source=collection_archive---------4-----------------------#2024-03-14](https://towardsdatascience.com/exploring-location-data-using-a-hexagon-grid-3509b68b04a2?source=collection_archive---------4-----------------------#2024-03-14)

## 一份关于如何在数据分析中使用Uber的H3六边形网格的全面指南

[](https://medium.com/@sktahtin?source=post_page---byline--3509b68b04a2--------------------------------)[![Sara Tähtinen](../Images/008c3202246e04d225a60d3b6fbcaea4.png)](https://medium.com/@sktahtin?source=post_page---byline--3509b68b04a2--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--3509b68b04a2--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--3509b68b04a2--------------------------------) [Sara Tähtinen](https://medium.com/@sktahtin?source=post_page---byline--3509b68b04a2--------------------------------)

·发表于[Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--3509b68b04a2--------------------------------) ·阅读时长16分钟·2024年3月14日

--

Uber的全球H3六边形网格系统可用于两个目的：首先，它是一个用户友好且实用的空间数据分析工具。其次，它可以通过将地理信息聚合到六边形区域来实现位置数据的匿名化，从而不泄露任何精确位置。在本文中，我们使用赫尔辛基城市自行车数据来展示六边形网格如何帮助数据科学家工作。

![](../Images/16e707eb316e1c945918d989ea8981b2.png)

图片由作者提供。

现在许多服务都生成包含在特定位置发生的事件的数据。例如，有许多不同的快递服务可能想要了解他们的服务何时、何地被使用，或者电信运营商想要知道他们的网络在不同区域的不同时间必须承载多大的负载。此外，位置数据可能高度敏感，可能会泄露用户的确切位置信息。例如，公开的纽约出租车数据包含了纽约所有出租车的接送日期、时间和地点的精确信息。小报杂志通过利用狗仔队提供的名人何时何地进出出租车的资讯，利用这些出租车数据追踪名人前往酒吧和脱衣舞俱乐部的情况([source](https://www.fastcompany.com/3036573/nyc-taxi-data-blunder-reveals-which-celebs-dont-tip-and-who-frequents-strip-clubs))。

出于这些原因，将位置数据点归类为更大的组是很方便的。然而，定义这些位置簇并不是完全简单的。有时可以使用国家、县、城市或区来将数据点归类，但通常需要更细的区域。为此，Uber 开发了一种开源的地理空间网格系统，名为 H3，使用重复的瓷砖覆盖整个地球。该网格系统的构建模块是六边形，用户可以选择 16 种不同的六边形大小，大小范围从一个大国的区域到一个小方桌的区域。

在本文中，我们将使用赫尔辛基市的共享单车数据来演示如何利用 H3 六边形分析空间数据。首先，我们将介绍 H3 六边形网格及其分辨率。接下来，我们将深入探讨 H3 库的主要功能。然后，我们将展示六边形网格如何增强数据分析。最后，我们将讨论与六边形网格相关的一些问题。所有用于此分析的笔记本可以在[此 GitHub 仓库](https://github.com/sktahtin4/Helsinki-city-bikes)中找到。除非另有说明，本文中的所有图片均由作者提供。

![](../Images/24eb02d7dcb52b56e5a81a48aa7ebd31.png)

数据分析笔记本中的截图。紫色点表示城市单车站点的位置，而不同大小的六边形对应于分辨率 6（最大六边形）、7 和 8。

# Uber 的 H3 六边形系统——非常适合可视化、探索和优化空间数据

每天每分钟，Uber 在其市场上接收到多个请求。每个事件发生在特定的位置，例如一个骑行者请求在某个位置接驾，而司机在附近的位置接受了该请求。从数据中获取信息和见解，例如基于需求设置动态定价，通常需要分析整个城市的数据。但由于城市的地理差异非常大，这种分析必须在精细的粒度下进行。通过 H3 六边形网格系统，每个数据点可以被归类到一个六边形区域或单元格中，然后 Uber 可以计算出每个六边形区域的供需情况，以便为其在所有有服务的城市中实施高峰定价。六边形有不同的大小，因此需要选择最适合分析目的的分辨率。

![](../Images/51f5425d05c9bfb57a5744e880353d11.png)

图示展示了六边形网格如何通过重复的镶嵌覆盖整个地球和城市区域。用户可以将区域细分成越来越小的六边形，每个更细分的六边形的面积大约是粗糙六边形的七分之一。需要注意的是，为了用六边形镶嵌覆盖整个地球，还需要一些五边形（5个边）。本文稍后会详细讨论这一点。如果仔细查看图像，可以看到图中有几个五边形，比如位于瑞典和挪威上方。图片来源：[https://github.com/seanhandley/h3_ruby](https://github.com/seanhandley/h3_ruby)。

从技术上讲，可以使用任何一种有助于在整个三维地球上进行完整镶嵌的构建块来构建一个全球网格系统。例如，可以使用三角形（3个边）或正方形（4个边），而不是六边形（6个边），来覆盖整个地球。然而，使用六边形有许多优点。例如，三角形的中心点到邻居中心点有三个不同的距离，而正方形有两个不同的距离，而六边形的中心点到所有邻居中心点的距离相等，这使得它成为一个方便的系统来近似半径（见下图）。

![](../Images/394a42575c7eceaa378e148dbf2a00f7.png)

中心点到其邻居的距离。在这些形状中，六边形是最适合近似半径的。图片由作者提供。

然而，世界无法完全被六边形划分，因此也需要一些五边形（五个边），总共有12个（每个分辨率下）。五边形引入了网格的不连续性，但它们通常位于远离陆地的地方，因此主要会影响海洋数据分析。尽管存在一些五边形，六边形网格仍然具有在三维球面上提供相对均匀大小构建块的优点。如果有人想了解更多关于六边形网格的几何信息，[这里有一个很好的资料来源](http://webpages.sou.edu/~sahrk/sqspc/pubs/gdggs03.pdf)。请注意，定义六边形区域是高度任意的，它们不遵循任何自然特征，如湖泊、河流、山脉或国界。

![](../Images/8045e278a6085e7259d282d1971368ea.png)

六边形的边长（L）可以用来估算构建块的半径。一个六边形包含六个等边三角形（每个三角形的边长相等），六边形内两个点之间的最大距离是六边形边长的两倍。H3 支持十六种不同的六边形分辨率。每个细分分辨率的六边形大约是粗分辨率六边形的七分之一。请注意，六边形不能完美地被划分为七个更小的六边形，因此较小的单元只大致包含其父单元。由于面积并不完全重叠，父单元中的事件数量可能与其子单元中的事件数量不相等。图像由作者提供。

H3 库是开源的，托管在 GitHub 上，并使用 C 语言编写。它提供了多种语言的绑定，例如 Python、C、Java 和 Javascript。H3 配备了一个层次化的索引系统，使其非常高效。你可以使用在线的 [H3 六边形数据查看器](https://wolf-h3-viewer.glitch.me/)进一步查看六边形。下表总结了 H3 提供的 16 个不同分辨率的特性。

![](../Images/3aa47437c6604bfe4c0dbe283e6982cf.png)

表格：来自 https://h3geo.org/docs/core-library/restable/ 的平均六边形面积和平均边长。作者使用 Chat-GPT 获取了不同大小区域的示例。

接下来，我们将介绍 H3 库的一些最重要的功能。

# H3 库及其主要功能

在本文中，我们将使用 H3 六边形系统将位置数据聚类到六边形中。H3 库的文档可以在 [这里](https://www.uber.com/en-FI/blog/h3/) 找到。该库有两个主要版本，版本 3 和版本 4，在我们的笔记本中我们将使用版本 3.7.6。请注意，版本 3.x 和 4.x 之间的函数名称有显著的差异，详细信息请参见 [这里](https://h3geo.org/docs/library/migration-3.x/functions)。

H3 Python 包可以通过 pip 轻松安装：

```py
pip install h3
```

如果你想指定要使用的版本，请在其中添加版本号，例如 h3==3.7.6。然后通过以下命令在 Python 笔记本中导入 H3：

```py
import h3
```

接下来，我们将介绍 H3 库的一些最重要的函数。

## 六边形索引

H3 使用层次化的索引系统，将经纬度对转换为 64 位 H3 索引，标识每个网格单元。给定坐标（纬度和经度）和选定的分辨率后，我们可以得到六边形索引：

```py
# Version 3.X:
hexagon_index = h3.geo_to_h3(lat, lng, resolution)

# Version 4.X:
hexagon_index = h3.latlng_to_cell(lat, lng, resolution)
```

例如

```py
h3.geo_to_h3(60.169833, 24.938163, 6)
```

返回索引 *‘861126d37ffffff’*。如果你愿意，你可以使用在线的 [H3 六边形数据查看器](https://wolf-h3-viewer.glitch.me/) 来查看该六边形的位置。

所以，当我们知道数据点的精确坐标时，我们可以在不同分辨率下确定其六边形索引，并将其与不同大小的六边形关联。

## 六边形边界

要在我们的图中使用六边形，我们必须从六边形索引中确定六边形的边界。请注意，在某些坐标系统中，坐标是以(lng, lat)的形式呈现的，而在其他系统中，则是以(lat, lng)的格式呈现。geo_json=True/False选项允许你交换这些坐标。

```py
# Version 3.X:
boundary = h3.h3_to_geo_boundary(hexagon_index, geo_json = False)

# Version 4.X:
boundary = h3.cell_to_boundary(hexagon_index, geo_json = False)
```

例如

```py
h3.h3_to_geo_boundary('861126d37ffffff', geo_json = False)

# Returns:
((60.15652369744344, 24.856525761155346),
 (60.13498207546084, 24.895664284494664),
 (60.14431977678549, 24.948769321085937),
 (60.175221029708474, 24.962796993345798),
 (60.19677983831024, 24.92362795620145),
 (60.187420192445906, 24.870461733016352))
```

这六对坐标对应于六边形边缘的起始点和结束点。

## 邻近的六边形

有时我们需要识别一个特定六边形的邻居，或者说是围绕该六边形的“kring”。当k=0时，函数返回原点索引；当k=1时，返回原点索引及其所有邻居索引；当k=2时，返回原点索引、其邻居和下一级邻居的索引，以此类推。

```py
# Version 3.X:
kring = h3.k_ring(hexagon_index, k)

# Version 4.X:
kring = h3.grid_disk(hexagon_index, k)
```

另外，还有一个可以用来计算两个单元格之间网格距离的函数：

```py
# Version 3.X:
kring = h3.h3_distance(hexagon_index_a, hexagon_index_a)

# Version 4.X:
kring = h3.grid_distance(hexagon_index_a, hexagon_index_a)
```

我们可以以以下方式使用这些函数：

```py
# Nearest neighbours of the hexagon:
h3.k_ring('861126d37ffffff', 1)

# Returns:
{'86089969fffffff',
 '86089ba4fffffff',
 '86089ba6fffffff',
 '861126d07ffffff',
 '861126d17ffffff',
 '861126d27ffffff',
 '861126d37ffffff'}

# Distance between two hexagons:
h3.h3_distance('861126d37ffffff', '86089ba4fffffff')

# Returns
1
```

## 绘制六边形

绘制六边形的方法有很多种，但其中一些方法比较死板、耗时且文档不完善。为了简化起见，我们主要使用matplotlib进行可视化，但我们也会进行实验，并用folium地图截图展示可视化效果。更多关于这些绘图方法的详细信息可以在GitHub仓库中找到。

![](../Images/ecfb63cc2e24ea1ca9ad66123e0a0d00.png)

两种不同绘图选项的示例：左侧我们使用matplotlib进行绘图，右侧我们使用folium地图。

在上图的左侧，我们使用matplotlib绘制六边形。我们利用GADM库获取代表赫尔辛基区域的多边形，并用绿色填充该区域。背景使用蓝色表示水域。此外，我们还在地图上放置了一个标记，标示赫尔辛基市中心的位置。六边形使用shapely库中的plot_polygon函数轻松绘制，数据点可以通过scatterplot函数添加到图中。这使得绘图变得非常简单和快速。

我们还尝试了其他绘图方法，例如使用folium地图，它允许我们创建一个交互式HTML地图，可以在地图上进行缩放。在上图的右侧，我们展示了这样一张地图的截图。尽管结果在视觉上很漂亮，但将新功能（如色条或热力图）添加到地图中非常耗时，因此它不是进行探索性数据分析的最佳工具。用于绘制交互式folium地图的笔记本[可以在这里找到](https://github.com/sktahtin4/Helsinki-city-bikes/blob/main/City-bikes-data-analysis-with-folium-maps.ipynb)。

# 赫尔辛基城市自行车数据

![](../Images/fbef34643ec07c9a8434c03c7333be3b.png)

图片来自作者：赫尔辛基火车站附近的赫尔辛基城市自行车（2023）。

在本文中，我们使用H3六边形来分析赫尔辛基城市自行车的使用情况。数据包含了2016年至2021年间的所有行程，以及城市自行车网络中可用的车站信息。城市自行车几乎覆盖整个赫尔辛基以及埃斯波的一部分，车站网络密集，尤其是在赫尔辛基市中心。

城市自行车系统的运作方式是，用户可以从任何一个车站拿取城市自行车，并将其归还到任何一个城市自行车站，即使该站点已满。通常，城市自行车的行程较短，例如从地铁站到特定目的地的通勤，城市自行车的目的是通过提供快速的两地间转移方式，使公共交通更加具有吸引力。城市自行车大约从三月到十月期间提供服务，整个季节的费用为35欧元（不到40美元）。在这一固定费用下，用户可以随意使用城市自行车，只要单次行程不超过30分钟。如果行程超过30分钟，用户需要为每增加的30分钟支付1欧元的额外费用。总的来说，这种方式既简洁又方便，非常适合短途出行！

数据包含两个文件：车站数据（©HSL 2021）和行程数据（©City bike Finland 2021）。这两个数据集均来源于[HSL开放数据](https://www.hsl.fi/en/hsl/open-data)，并且都具有[创意共享BY 4.0国际许可证](https://creativecommons.org/licenses/by/4.0/deed.en)。在接下来的部分中，我们将简要介绍这些数据集。分析和清理的笔记本可以在[GitHub仓库](https://github.com/sktahtin4/Helsinki-city-bikes)中找到。

## 车站数据

首先，让我们仔细查看数据。正如数据科学项目中的常见情况一样，在使用数据之前，数据集需要进行一些清理。例如，列名是芬兰语、瑞典语和英语的混合形式，为了清晰起见，我们希望重新命名这些列。有关我们数据清理过程的详细笔记本可以在[此链接](https://github.com/sktahtin4/Helsinki-city-bikes/blob/main/City-bikes-data-cleaning.ipynb)中找到。在清理后的数据集中，我们有457个车站，前几行数据如下所示：

![](../Images/e81fd0b3cb38d348401a65a0b47f79b5.png)

车站的数据框包括车站ID、车站名称、地址、城市、车站容量以及地理坐标；经度和纬度。我们的目标是根据这些车站的空间位置使用H3六边形系统进行聚类。最初，分析所需的最佳六边形大小尚不清楚，这使得我们需要尝试四种不同的分辨率：6、7、8和9。这些分辨率分别对应边长为3.7公里、1.4公里、500米和200米的六边形。一旦给定了纬度、经度和分辨率，我们就可以利用H3库来确定相应的H3六边形索引，正如本文中所展示的那样。

一旦我们获取了所有车站在不同分辨率下的四个六边形ID，我们将得到以下数据表：

![](../Images/fc8027bd9577e6127a961d90f54b2c65.png)

通过车站ID，我们可以将这个数据表与旅行数据进行合并，从而将旅行分类到不同的六边形中并分析结果。

## 旅行数据

旅行数据包含了2016年到2021年期间所有的城市自行车出行记录。它包括出发和归还车站的名称和ID、出发和归还时间、旅行时长和行驶距离等信息。请注意，每次旅行必须从一个城市自行车车站出发并结束于另一个车站。最初，数据集包含1500万条旅行记录，但数据清理过程中删除了3.5%的数据行，因此最终留下了1450万条旅行记录。有关数据清理过程的详细信息，可以在同一个GitHub仓库中的笔记本里找到。我们来看看旅行数据中的前几行：

![](../Images/eebe0a80e507e6d7287370a09467fcab.png)

通过车站ID，我们可以将车站数据与旅行数据合并，并将出发和归还车站的六边形ID附加到数据集中。接下来，我们可以开始使用H3六边形进行的数据分析。

# 使用六边形的数据洞察

成为数据科学家的一个基本方面是从现有数据中提取有意义的洞察。这通常需要数据转换，即从现有特征中创建新特征以聚合数据。例如，我们可能想从日期中提取星期几，将连续变量分段为固定大小的区间，或将数据点分组到不同的簇或类别中。在这一部分，我们将展示从位置数据中可以获得的各种数据洞察，无论是否使用六边形。数据分析的详细过程可以在GitHub仓库中的数据清理和数据分析笔记本中找到。

## A. 无六边形的数据分析

让我们从探索在不依赖六边形的情况下能进行哪些分析开始。由于我们的数据从2016年到2021年，因此一个关键方面是理解数据随时间的变化。我们可能会问的一些问题包括：

+   城市自行车车站在哪里？

+   单次自行车旅行的典型时长和距离是多少？

+   城市自行车车站网络是如何随着时间扩展的？

+   近年来出行次数如何变化？

为了回答这些问题，我们首先通过使用提供的纬度和经度坐标将车站位置绘制在地图上。

![](../Images/af110102ca8dfdbe3deacc34c4b90d94.png)

在左图中，我们看到2021年的车站主要位于赫尔辛基，但也部分位于埃斯波。一些车站名称在地图上显示，以帮助识别不同位置。右侧图表将旅行时长和距离分为四个类别，并计算各类别的频率。几乎一半的旅行时间不到10分钟，只有少数超过30分钟（请注意，用户在此时段之外需要支付额外费用）。城市自行车通常用于短途出行，因此大多数旅行不到3公里也就不足为奇了。

接下来，我们可以分析数据随年份变化的情况。

![](../Images/e799ecb7bec4b614f7d43b91f35db8a4.png)

左图展示了所有城市自行车站及其加入网络的年份。第一个城市自行车站于2016年推出，位于赫尔辛基市中心。随着每年网络的扩展，城市自行车网络逐渐涵盖了远离赫尔辛基市中心的区域。右上角的图表展示了每年的车站数量。最后，右下角的图表显示了每年使用城市自行车的次数。2019年是使用高峰年，约有370万次旅行，随后在下一年下降了17%，尽管车站数量在增加。2020年和2021年的下降可能受到COVID-19大流行的影响，但也部分由于2019年赫尔辛基推出的商业电动滑板车，这些滑板车迅速流行起来，尤其是在短途旅行中。

为了更深入地分析来自城市自行车数据的统计信息，我们将把六边形纳入分析中。

## B. 使用六边形网格分析城市自行车数据

六边形为我们提供了一个工具，可以详细分析城市自行车的使用情况。我们通过六边形希望回答的问题包括：

+   我们在哪些地方有很多城市自行车站？

+   我们在哪些区域观察到最多的出发或返回？

+   不同区域的赫尔辛基平均旅行距离是多少？

然而，在解决这些问题之前，我们需要决定在分析中使用的六边形的大小。

![](../Images/10f0a400e137264c0ca2a4bcd93e5ea2.png)

我们首先研究分辨率为6、7和8的六边形，分别对应约3.7公里、1.4公里和500米的半径。从这些图表中，很难直观评估车站密度，尤其是对于最小的六边形。

让我们计算每个六边形内的车站数量，并绘制出反映各六边形内车站数量的六边形颜色：

![](../Images/c901e44980503082ab4fec091cb5058b.png)

在分辨率为6时，六边形的大小相对较大，并且每个六边形内的站点数量差异很大，因此这个分辨率可能对于我们的需求来说过大。分辨率7和8的站点数量变化较少，这可能使它们更适合我们的分析。然而，确定理想分辨率并没有固定的规则，因为这取决于我们所寻求的具体洞察。

六边形有助于可视化与位置相关的洞察，比如识别城市中最繁忙的服务区域。如果我们不使用六边形，另一种方法可能是计算每个站点的每日平均出发次数，并使用不同大小的圆圈绘制结果，如下图所示。然而，特别是在赫尔辛基市中心，站点之间距离非常近，因此很难准确理解每日出发的数量。

![](../Images/0bdb15ab29b9c13e7f76afdc082fd9c3.png)

六边形网格帮助我们更快速地理解特定位置的数据。在左侧的图像中，我们计算了每个站点的每日平均出发次数，并使用每个圆圈的大小表示计算出的平均值。在赫尔辛基市中心，站点之间的距离非常近，导致很难辨别该区域的出发量。而在右侧，我们使用分辨率为8的六边形绘制了城市不同区域的每日平均出发次数。采用这种方法，更容易看到赫尔辛基不同区域的出发量。例如，从图中我们可以看到，许多区域的每日出发次数平均不到100次，而在赫尔辛基市中心，平均出发次数超过900次。

使用六边形网格，我们还可以可视化来自数据的各种其他洞察，比如以下图表：

![](../Images/67696120556bd3110ce7f08a565b55f6.png)

在左侧，我们绘制了每个六边形区域的每日平均归还数量。结果与每日出发的平均值非常相似。在右侧，我们可视化了到达归还站的平均距离。城市中平均的骑行距离波动较大，最长的骑行发生在公共交通较少的地区。

## C. 选择一个六边形并获取特定位置的洞察

有时候我们希望从特定区域提取更详细的洞察。通过选择一个六边形，我们可以深入探讨该区域的数据，并寻找诸如以下问题的答案：

+   在该区域内，城市自行车的高峰使用时间是什么时候？

+   在该区域，工作日与周末的自行车使用情况有何不同？

+   从该位置出发的用户要去哪里？

为了展示如何回答这些问题，我们选择了赫尔辛基市中心的以下六边形：

![](../Images/7264c5960da389a3022b450136e7ce93.png)

为了进行更深入的分析，我们选择了赫尔辛基市中心的高亮六边形。

让我们开始分析该特定区域的数据。

![](../Images/0cdd5df5e6dccbfe615414dfbdff53a9.png)

在左侧，我们绘制了每个工作日和每小时的平均出发次数，以帮助我们了解最繁忙的时段。在芬兰，典型的工作时间是8点到16点或9点到17点，我们可以清晰地看到在工作日的早上7点左右有一个明显的高峰期，人们开始通勤；以及在下午4点到5点之间，大家下班离开工作地点。有趣的是，下班后使用城市自行车的情况比早上更多。特别地，在周五和周六晚上，使用量明显增加，大家从酒吧和派对回家。此外，我们还可以绘制每个工作日的骑行长度和时长，以识别工作日与周末之间的潜在差异，但右侧的图表显示不同的日子之间差异不大。

我们还可以可视化从选定六边形出发的骑行目的地，以确定用户从该区域出发的方向。

![](../Images/7c4af244157d8531c2741c5d2ef6f5bf.png)

在左侧，我们展示了一个六边形地图，显示了从选定六边形出发的骑行目的地。在右侧，我们计算了选定六边形与目的地六边形之间的网格距离，其中0表示返回和出发的六边形是相同的。该分析显示，约40%的骑行从选定的六边形出发，并在同一六边形结束。此外，近50%的骑行以邻近六边形为目的地，这表明来自赫尔辛基市中心的大多数骑行都指向市中心的其他区域。

## D. 选择一个位置并分析其周围区域的数据

有时，我们希望获得有关特定位置的洞察。例如，我们可能想了解我们经常使用的地铁站附近的城市自行车使用情况，例如本文中的卡姆皮地铁站。如果我们希望在大约1公里的半径范围内获得洞察，我们可能会倾向于选择包含该车站的分辨率为7的六边形，因为该六边形的半径大约是1.4公里。然而，正如下面左侧图像所示，选定的车站并不在六边形的中心，因此并不能有效地覆盖该数据点周围约1公里的区域。

![](../Images/5b8c1f7404296b6bba60bfb2ee794a8c.png)

当我们希望获得大约1公里半径范围内的洞察时，比如卡姆皮地铁站，我们不应该简单地选择一个大致等于所需半径的六边形，因为数据点可能不在六边形的中心（如左侧图像所示）。为了更好地将数据点居中，建议选择一个包含选定车站的小六边形，并考虑其邻近单元格。邻近六边形可以通过H3的k_ring函数非常容易地找到。我们选择的小六边形和考虑的邻近六边形越多，选定数据点居中的效果就越好。

通过使用选定的六边形，我们可以分析目标数据点周围的数据。

## E. 数据位置的匿名化

在通过地理坐标获取六边形索引后，我们可以省略精确的位置数据，仅使用H3索引。这有助于数据的匿名化，因为不需要透露精确的用户位置。

![](../Images/f5477492c039cc84bc003290b7932fb4.png)

数据匿名化示意图：左侧展示的是一趟自行车旅行的精确起点和终点位置，这可能会暴露敏感的用户信息。右侧通过使用六边形索引，我们避免了透露精确位置，而是用半径约为1.4公里的六边形区域来表示自行车旅行的起点和终点。

# 六边形的问题

H3库提供的六边形网格证明是进行空间数据分析的有用工具。然而，使用该六边形网格时会出现一些挑战，下面我们将对此进行详细说明。

从数学角度来看，六边形区域的定义完全是任意的。因此，H3六边形与任何“自然元素”缺乏对齐，如街道、河流、湖泊、岛屿、高速公路或铁路。当使用六边形网格时，数据点是基于其直线距离的接近程度进行聚合的。然而，这些点不一定总是由道路连接，因此可能导致将不相关的位置聚集成一个单一的簇。我们将在下面展示一个示例。

![](../Images/7283db26ebced6959496807b9b016701.png)

例如，如果我们选择分辨率为6的六边形（表示大约3.7公里的半径），尽管两点未直接连接，且这两个红色标记的点之间的骑行距离大约为11公里，它们依然属于同一个六边形。由于这些区域的多样性，对该六边形进行统计分析可能没有多大价值。

另一个挑战是，如果我们希望使用六边形来匿名化用户的精确位置。例如，代替记录用户的精确位置，我们可以使用分辨率为7的六边形来表示数据点位于一个半径大约为1.4公里的区域内。然而，由于分析所需的理想六边形分辨率通常未知，可能会希望将不同分辨率的数据进行链接。但由于较粗的六边形只大致包含其七个子六边形，我们可能最终会比指定的1.4公里半径更精确地泄露位于六边形边界附近的数据点的位置。我们在下面的图像中演示了这一点。

![](../Images/841c8323992989a20b3a0ba300013ddb.png)

在使用六边形进行数据匿名化时，必须认识到我们可能会无意中泄露比预期更精确的位置。例如，在查看分辨率为7和8的红色数据点的六边形索引时，我们观察到较小的六边形并不是较大六边形的直接子单元。因此，数据点必须位于黑色高亮部分的重叠区域内。我们实际上提供了更详细的信息，而不是将数据点匿名化为大约500米半径的区域。当匿名化高度敏感的位置信息时，这会带来一定风险。

# 总结

+   Uber的全球H3六边形网格系统是一个用户友好且实用的空间数据分析工具。它还可以帮助我们匿名化敏感的位置信息。

+   H3桶将位置数据点分配到覆盖全球的六边形区域，并通过重复的平铺方式进行填充。H3库支持16种不同的六边形分辨率，最大的六边形约为1300公里，最小的仅约50米。根据六边形的不同大小，必须选择最适合分析目的的分辨率。

+   在更细的分辨率下，每个六边形大约是较粗分辨率下六边形的七分之一。然而，六边形不能完美地被划分成七个更小的六边形，因此更小的单元仅大致包含其父单元。这意味着父单元中的事件计数可能不等于其子单元中的事件计数。

+   请注意，六边形网格与任何“自然元素”没有对齐，例如街道、河流、湖泊、岛屿、高速公路或火车轨道，因此不同的位置可能会被归为同一个聚类。

# 参考文献：

+   赫尔辛基城市自行车数据分析的GitHub仓库：[https://github.com/sktahtin4/Helsinki-city-bikes](https://github.com/sktahtin4/Helsinki-city-bikes)

+   Uber关于H3的博客：[https://www.uber.com/en-FI/blog/h3/](https://www.uber.com/en-FI/blog/h3/)

+   H3文档：[https://h3geo.org/](https://h3geo.org/)

+   不同六边形分辨率的统计表：[https://h3geo.org/docs/core-library/restable/](https://h3geo.org/docs/core-library/restable/)

+   更多关于全球网格系统的信息：[http://webpages.sou.edu/~sahrk/sqspc/pubs/gdggs03.pdf](http://webpages.sou.edu/~sahrk/sqspc/pubs/gdggs03.pdf)

+   六边形的数据查看器：[https://wolf-h3-viewer.glitch.me](https://wolf-h3-viewer.glitch.me/)

+   HSL开放数据：[https://www.hsl.fi/en/hsl/open-data](https://www.hsl.fi/en/hsl/open-data)
