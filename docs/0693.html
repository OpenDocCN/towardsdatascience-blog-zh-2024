<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Differentiable and Accelerated Spherical Harmonic Transforms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Differentiable and Accelerated Spherical Harmonic Transforms</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/differentiable-and-accelerated-spherical-harmonic-transforms-c269393d08f1?source=collection_archive---------12-----------------------#2024-03-14">https://towardsdatascience.com/differentiable-and-accelerated-spherical-harmonic-transforms-c269393d08f1?source=collection_archive---------12-----------------------#2024-03-14</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="971e" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">In JAX and PyTorch</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://jasonmcewen.medium.com/?source=post_page---byline--c269393d08f1--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Jason McEwen" class="l ep by dd de cx" src="../Images/794e7e6546ed049860dab5e294535880.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*Rh2TQQ2zH5V9A6or8RQx8Q.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--c269393d08f1--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://jasonmcewen.medium.com/?source=post_page---byline--c269393d08f1--------------------------------" rel="noopener follow">Jason McEwen</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--c269393d08f1--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Mar 14, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="6a7b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk"><em class="nf">Many areas of science and engineering encounter data defined on the sphere. Modelling and analysis of such data often requires the spherical counterpart to the Fourier transform — the spherical harmonic transform. We provide a brief overview of the spherical harmonic transform and present a new differentiable algorithm tailored towards acceleration on GPUs [1]. This algorithm is implemented in the recently released </em><a class="af ng" href="https://pypi.org/project/s2fft/" rel="noopener ugc nofollow" target="_blank"><em class="nf">S2FFT</em></a><em class="nf"> python package, which supports both JAX and PyTorch.</em></p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni nj"><img src="../Images/7e7c243f31089774071add693cce6378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_ZStD7Gc4LhT238MYPy2g.jpeg"/></div></div><figcaption class="nv nw nx nh ni ny nz bf b bg z dx">Photo by <a class="af ng" href="https://unsplash.com/@szilviabasso?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Szilvia Basso</a> on <a class="af ng" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0d0d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk oa"><span class="l ob oc od bo oe of og oh oi ed">I</span>ncreasingly often we are interested in analysing data that lives on the sphere. The diversity in applications is remarkable, ranging from quantum chemistry, biomedical imaging, climate physics and geophysics, to the wider cosmos.</p><p id="70d0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The most well-known areas in which one encounters data on the sphere are within the physical sciences, particularly within atmospheric science, geophysical modelling, and astrophysics.</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni oj"><img src="../Images/ddf5911d3de49554421ad6bc18a1cecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BzzlnC51s-iRl77MrbZeA.png"/></div></div><figcaption class="nv nw nx nh ni ny nz bf b bg z dx"><em class="ok">Examples of the most widely known cases of spherical data, such as the Earth (left) and artist impression of astronomical observations (right). [Earth image sourced from </em><a class="af ng" href="https://en.wikipedia.org/wiki/Earth#/media/File:The_Blue_Marble_(remastered).jpg" rel="noopener ugc nofollow" target="_blank"><em class="ok">Wikipedia</em></a><em class="ok">; astrophysics image sourced from </em><a class="af ng" href="https://commons.wikimedia.org/wiki/File:Observable_sphere_for_3d.png" rel="noopener ugc nofollow" target="_blank"><em class="ok">Wikipedia</em></a><em class="ok">.]</em></figcaption></figure><p id="f538" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">These problems are naturally spherical as observations are made at each point on the surface of a sphere: the surface of the Earth for geophysics and the sky for astrophysics. Other examples come from applications like computer graphics and vision, where 360° panoramic cameras capture the world around you in every direction.</p><p id="7044" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">In many cases the spherical nature of the problem at hand is fairly easy to see; however, this is not always the case. Perhaps surprisingly, spherical data is quite frequently encountered within the biological disciplines, though the spherical aspect is often much less obvious! Since we are often concerned about local directions in biological studies, such as the direction water diffuses within the brain, we encounter spherical data.</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni ol"><img src="../Images/e0dac82e7963d830f7a0aee8ffcf6c7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TBECbAUcE7WIuq45ukDTFQ.gif"/></div></div><figcaption class="nv nw nx nh ni ny nz bf b bg z dx">Diffusion tensor imaging of neuronal connections in the human brain. Within each voxel neurons are free to travel in any direction, so the problem is naturally spherical. [Animation by <a class="af ng" href="https://www.youtube.com/watch?v=jrC8iY6_aZQ" rel="noopener ugc nofollow" target="_blank">Alfred Anwander</a>, CC-BY licence.]</figcaption></figure><p id="0132" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Given the prevalence of such data, it isn’t surprising that many spherical analysis techniques have been developed. A frequency analysis of the data can be insightful, often to afford a statistical summary or an effective representation for further analysis or modelling. Recently geometric deep learning techniques have proven highly effective for the analysis of data on complex domains [2–6], particularly for highly complex problems such as molecular modelling and protein interactions (see our prior post on <a class="af ng" rel="noopener" target="_blank" href="/a-brief-introduction-to-geometric-deep-learning-dae114923ddb">A Brief Introduction to Geometric Deep Learning</a>).</p><h1 id="8b25" class="om on fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">Fourier meets Legendre</h1><p id="90bf" class="pw-post-body-paragraph mj mk fq ml b go pi mn mo gr pj mq mr ms pk mu mv mw pl my mz na pm nc nd ne fj bk">So we have data on the sphere and a variety of techniques by which spherical data may be analysed, but we need mathematical tools to do so. Specifically, we need to know how to decompose spherical data into frequencies efficiently.</p><p id="5065" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The Fourier transforms provides a frequency decomposition that is often used to calculate statistical correlations within data. Many physical systems may also be described more straightforwardly in frequency space, as each frequency may evolve independently.</p><p id="1558" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To extend the standard Fourier transform to the sphere, we need the meeting of minds of two 17th century French mathematicians: Joseph Fourier and Adrien-Marie Legendre.</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni pn"><img src="../Images/e6febed8df967a8920340d59a729ddb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_PX5NoCry5Ncm2XwIIkOg.png"/></div></div><figcaption class="nv nw nx nh ni ny nz bf b bg z dx"><em class="ok">Joseph Fourier (left) and Adrien-Marie Legendre (right). Tragically, the caricature of Legendre is the only known image of him. [Fourier image sourced from </em><a class="af ng" href="https://en.wikipedia.org/wiki/Joseph_Fourier#/media/File:Fourier2_-_restoration1.jpg" rel="noopener ugc nofollow" target="_blank"><em class="ok">Wikipedia</em></a><em class="ok">. Legendre image sourced from </em><a class="af ng" href="https://en.wikipedia.org/wiki/Adrien-Marie_Legendre#/media/File:Legendre.jpg" rel="noopener ugc nofollow" target="_blank"><em class="ok">Wikipedia</em></a><em class="ok">.]</em></figcaption></figure><p id="f14d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">First, let’s consider how to decompose Euclidean data into its various frequencies. Such a transformation of the data was first derived by Joseph Fourier and is given by</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni po"><img src="../Images/8f4bec303a92c421588d95ccd18b3c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvk5Pi95NN4ljzUzo1dARQ.png"/></div></div></figure><p id="61d0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">which is found almost everywhere and is a staple of undergraduate physics for a reason! This works by projecting our data <em class="nf">f(x)</em> onto a set of trigonometric functions, called a <em class="nf">basis</em>. One can do effectively the same thing on the sphere, but the basis functions are now given by the spherical harmonics <em class="nf">Y</em>ₗₘ:</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni po"><img src="../Images/141c7fe048f6d114981acce3a02afecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ZiM4L2Cnv2HNJiBEFwgfw.png"/></div></div></figure><p id="4bd5" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">where <em class="nf">(θ, ϕ)</em> are the usual spherical polar co-ordinates.</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div class="nh ni pp"><img src="../Images/3f74cf4e9478035b41c9cd47006913c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*O8rUdRA4Onxysl7I4UjFWA.gif"/></div><figcaption class="nv nw nx nh ni ny nz bf b bg z dx"><em class="ok">Spherical harmonic basis functions (real component). [Sourced from </em><a class="af ng" href="https://en.wikipedia.org/wiki/Spherical_harmonics#/media/File:Rotating_spherical_harmonics.gif" rel="noopener ugc nofollow" target="_blank"><em class="ok">Wikipedia</em></a><em class="ok">.]</em></figcaption></figure><p id="617d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The spherical harmonics (shown above) can be broken down further into the product of an exponential and Legendre polynomials — à la Adrien-Marie Legendre — as</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni po"><img src="../Images/8c018bd30e66612955ad031cd008a6b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQPkSaRNUmylYGGCvCbxdw.png"/></div></div></figure><p id="0722" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">And so the spherical harmonic transform can be written as a Fourier transform followed by an associated Legendre transform. The real difficulty comes in evaluating the Legendre part of the transform: it is either computationally expensive or memory hungry, depending on the method one chooses.</p><h1 id="8e3a" class="om on fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">The importance of being differentiable</h1><p id="6c99" class="pw-post-body-paragraph mj mk fq ml b go pi mn mo gr pj mq mr ms pk mu mv mw pl my mz na pm nc nd ne fj bk">The growth of <a class="af ng" href="https://en.wikipedia.org/wiki/Differentiable_programming" rel="noopener ugc nofollow" target="_blank">differentiable programming</a> is opening up many new types of analysis. In particular, many applications require spherical transforms that are differentiable.</p><p id="635d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Machine learning models on the sphere require differentiable transforms so that models may be trained by gradient-based optimisation algorithms, <em class="nf">i.e.</em> through back-propagation.</p><p id="e199" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Emerging physics-enhanced machine learning approaches [7] for hybrid data-driven and model-based approaches [8] also require differentiable physics models, which in many cases themselves require differentiable spherical transforms.</p><p id="5e93" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With this in mind it is clear that for modern applications an efficient algorithm for the spherical harmonic transform is necessary but not enough. Differentiability is key.</p><h1 id="0394" class="om on fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">A software package named S2FFT</h1><p id="ad44" class="pw-post-body-paragraph mj mk fq ml b go pi mn mo gr pj mq mr ms pk mu mv mw pl my mz na pm nc nd ne fj bk">This is all well and good, but how does one efficiently evaluate the spherical harmonic transform? A variety of algorithms have been developed, with some great software packages. However for modern applications we need one that is differentiable, can run on hardware accelerators like GPUs, and is computationally scalable.</p><p id="f183" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">By redesigning the core algorithms from the ground up (as described in depth in our corresponding paper [<a class="af ng" href="https://arxiv.org/abs/2311.14670" rel="noopener ugc nofollow" target="_blank">1</a>]), we recently developed a python package called <a class="af ng" href="https://astro-informatics.github.io/s2fft/" rel="noopener ugc nofollow" target="_blank">S2FFT</a> that should fit the bill.</p><p id="ce4d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">S2FFT is implemented in <a class="af ng" href="https://jax.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">JAX</a>, a differentiable programming language developed by Google, and also includes a <a class="af ng" href="https://pytorch.org" rel="noopener ugc nofollow" target="_blank">PyTorch</a> frontend.</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni pq"><img src="../Images/1d5e836033551ce7e77b706564bc752c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kopmSt9XEd2iAJNLCYQ0Bw.png"/></div></div><figcaption class="nv nw nx nh ni ny nz bf b bg z dx"><a class="af ng" href="https://github.com/astro-informatics/s2fft" rel="noopener ugc nofollow" target="_blank"><em class="ok">S2FFT</em></a><em class="ok"> is a Python package implementing differentiable and accelerated spherical harmonic transforms, with interfaces in JAX and PyTorch. [Image created by authors.]</em></figcaption></figure><p id="8a3e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">S2FFT provides two operating modes: precompute the associated Legendre functions, which are then accessed at run time; or compute them on-the-fly during the transform. The pre-compute approach is just about as fast as you can get, but the memory required to store all Legendre function values scales cubicly with resolution, which can be a problem! The second approach we provide instead recursively computes Legendre terms on-the-fly, and so can be scaled to very high resolutions.</p><p id="1018" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">In addition, S2FFT also supports a hybrid automatic and manual differentiation approach so that gradients can be computed efficiently.</p><p id="27a8" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The package is designed to support multiple different sampling schemes on the sphere. At launch, equiangular (<a class="af ng" href="https://arxiv.org/abs/1110.6298" rel="noopener ugc nofollow" target="_blank">McEwen &amp; Wiaux</a> [9], <a class="af ng" href="https://www.sciencedirect.com/science/article/pii/S0196885884710086" rel="noopener ugc nofollow" target="_blank">Driscoll &amp; Healy</a> [10]), Gauss-Legendre, and <a class="af ng" href="https://healpix.jpl.nasa.gov/" rel="noopener ugc nofollow" target="_blank">HEALPix</a> [11] sampling schemes are supported, although others may easily be added in future.</p><figure class="nk nl nm nn no np nh ni paragraph-image"><div role="button" tabindex="0" class="nq nr ed ns bh nt"><div class="nh ni pr"><img src="../Images/5ff8eb88b0cdba3b35cfad460f1af674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huKAckTFDrksyCW9R0tv1w.png"/></div></div><figcaption class="nv nw nx nh ni ny nz bf b bg z dx"><em class="ok">Different sampling schemes on the sphere supported by </em><a class="af ng" href="https://github.com/astro-informatics/s2fft" rel="noopener ugc nofollow" target="_blank"><em class="ok">S2FFT</em></a><em class="ok">. [Original figure created by authors.]</em></figcaption></figure><p id="d2a9" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The S2FFT package is available on <a class="af ng" href="https://pypi.org/project/s2fft/" rel="noopener ugc nofollow" target="_blank">PyPi</a> so anyone can install it straightforwardly by running:</p><pre class="nk nl nm nn no ps pt pu bp pv bb bk"><span id="082c" class="pw on fq pt b bg px py l pz qa">pip install s2fft</span></pre><p id="53ff" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Or to pick up PyTorch support by running:</p><pre class="nk nl nm nn no ps pt pu bp pv bb bk"><span id="164c" class="pw on fq pt b bg px py l pz qa">pip install "s2fft[torch]"</span></pre><p id="83fa" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">From here the top-level transforms can be called simply by</p><pre class="nk nl nm nn no ps pt pu bp pv bb bk"><span id="e42f" class="pw on fq pt b bg px py l pz qa">import s2fft<br/><br/># Compute forward spherical harmonic transform<br/>flm = s2fft.forward_jax(f, L) <br/><br/># Compute inverse spherical harmonic transform<br/>f = s2fft.inverse_jax(flm, L)  </span></pre><p id="2a79" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">These functions can be picked up out of the box and integrated as layers within existing models, both in JAX and PyTorch, with full support for both forward and reverse mode differentiation.</p><h1 id="b04d" class="om on fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">Future perspectives</h1><p id="1c46" class="pw-post-body-paragraph mj mk fq ml b go pi mn mo gr pj mq mr ms pk mu mv mw pl my mz na pm nc nd ne fj bk">With researchers becoming increasingly interested in differentiable programming for scientific applications, there is a critical need for modern software packages that implement the foundational mathematical methods on which science is often based, like the spherical harmonic transform.</p><p id="14d6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">We hope <a class="af ng" href="https://github.com/astro-informatics/s2fft" rel="noopener ugc nofollow" target="_blank">S2FFT</a> will be of great use in coming years and are excited to see what people will use it for!</p><h1 id="11f4" class="om on fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">References</h1><p id="5f5b" class="pw-post-body-paragraph mj mk fq ml b go pi mn mo gr pj mq mr ms pk mu mv mw pl my mz na pm nc nd ne fj bk">[1] Price &amp; McEwen, <em class="nf">Differentiable and accelerated spherical harmonic and Wigner transforms</em>, <a class="af ng" href="https://arxiv.org/abs/2311.14670" rel="noopener ugc nofollow" target="_blank">arxiv:2311.14670</a> (2023).</p><p id="9140" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[2] Bronstein, Bruna, Cohen, Velickovic, <em class="nf">Geometric Deep Learning: Grids, Groups, Graphs, Geodesics, and Gauges</em>, <a class="af ng" href="https://arxiv.org/abs/2104.13478" rel="noopener ugc nofollow" target="_blank">arXix:2104.13478</a> (2021).</p><p id="4433" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[3] Ocampo, Price &amp; McEwen, <em class="nf">Scalable and equivariant spherical CNNs by discrete-continuous (DISCO) convolutions</em>, <a class="af ng" href="https://arxiv.org/abs/2209.13603" rel="noopener ugc nofollow" target="_blank">ICLR</a> (2023).</p><p id="2ba0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[4] Cobb, Wallis, Mavor-Parker, Marignier, Price, d’Avezac, McEwen, <em class="nf">Efficient Generalised Spherical CNNs</em>, <a class="af ng" href="https://arxiv.org/abs/2010.11661" rel="noopener ugc nofollow" target="_blank">ICLR</a> (2021).</p><p id="3033" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[5] Cohen, Geiger, Koehler, Welling, <em class="nf">Spherical CNNs</em>, <a class="af ng" href="https://arxiv.org/abs/1801.10130" rel="noopener ugc nofollow" target="_blank">ICLR</a> (2018).</p><p id="feb6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[6] Jumper et al., <em class="nf">Highly accurate protein structure prediction with AlphaFold</em>, <a class="af ng" href="https://www.nature.com/articles/s41586-021-03819-2" rel="noopener ugc nofollow" target="_blank">Nature</a> (2021).</p><p id="99dc" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[7] Karniadakis et al, <em class="nf">Physics-informed machine learning</em>, <a class="af ng" href="https://www.nature.com/articles/s42254-021-00314-5" rel="noopener ugc nofollow" target="_blank">Nature Reviews Physics</a> (2021).</p><p id="109a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[8] Campagne et al., <em class="nf">Jax-cosmo: An end-to-end differentiable and GPU accelerated cosmology library</em>, <a class="af ng" href="https://arxiv.org/abs/2302.05163" rel="noopener ugc nofollow" target="_blank">arXiv:2302.05163</a> (2023).</p><p id="6e34" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[9] McEwen &amp; Wiaux, <em class="nf">A novel sampling theorem on the sphere</em>, <a class="af ng" href="https://arxiv.org/abs/1110.6298" rel="noopener ugc nofollow" target="_blank">IEEE TSP</a> (2012).</p><p id="444b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[10] Driscoll &amp; Healy, <em class="nf">Computing Fourier Transforms and Convolutions on the 2-Sphere</em>, <a class="af ng" href="https://www.sciencedirect.com/science/article/pii/S0196885884710086" rel="noopener ugc nofollow" target="_blank">AAM</a> (1994).</p><p id="3203" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">[11] Gorski et al., <em class="nf">HEALPix: a Framework for High Resolution Discretization, and Fast Analysis of Data Distributed on the Sphere</em>, <a class="af ng" href="https://arxiv.org/abs/astro-ph/0409513" rel="noopener ugc nofollow" target="_blank">ApJ</a> (2005).</p></div></div></div></div>    
</body>
</html>