<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Exploring Location Data Using a Hexagon Grid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Exploring Location Data Using a Hexagon Grid</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-location-data-using-a-hexagon-grid-3509b68b04a2?source=collection_archive---------4-----------------------#2024-03-14">https://towardsdatascience.com/exploring-location-data-using-a-hexagon-grid-3509b68b04a2?source=collection_archive---------4-----------------------#2024-03-14</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="3e78" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">A comprehensive guide on how to use Uber’s H3 hexagon grid in data analysis</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@sktahtin?source=post_page---byline--3509b68b04a2--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Sara Tähtinen" class="l ep by dd de cx" src="../Images/008c3202246e04d225a60d3b6fbcaea4.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*nuWI778M2q-Z6O72Hcrq6g.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--3509b68b04a2--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@sktahtin?source=post_page---byline--3509b68b04a2--------------------------------" rel="noopener follow">Sara Tähtinen</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--3509b68b04a2--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">16 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Mar 14, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="effe" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Uber’s global H3 hexagonal grid system can be used for two purposes: first, it is a user-friendly and practical tool for spatial data analysis. Second, it can be used to anonymize location data by aggregating geographic information to hexagonal regions such that no precise locations are disclosed. In this article, we use Helsinki city bike data to showcase how hexagons can help data scientists in their work.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng nh"><img src="../Images/16e707eb316e1c945918d989ea8981b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g7RWHM_yF5N2p0KnbH96DA.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Image by author.</figcaption></figure></div></div></div><div class="ab cb ny nz oa ob" role="separator"><span class="oc by bm od oe of"/><span class="oc by bm od oe of"/><span class="oc by bm od oe"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="ed09" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Many services nowadays produce data that contains events that have occurred in a certain location. For example there’s a lot of different courier services that might want to understand where and when their services have been used, or teleoperator companies that want to know how big load their network must tolerate at certain times at different parts of their cover area. Also location data can be highly sensitive and reveal unnecessary exact information on users whereabouts. For example, openly available New York taxi data contains exact information on the pick-up and drop-off dates, times and locations of all taxi rides in New York. By using information from paparazzis on where and when celebrities have been seen getting in and out of the cabs, the tabloid magazines have used the taxi data to track celebs’ visits to bars and strip clubs (<a class="af og" href="https://www.fastcompany.com/3036573/nyc-taxi-data-blunder-reveals-which-celebs-dont-tip-and-who-frequents-strip-clubs" rel="noopener ugc nofollow" target="_blank">source</a>).</p><p id="4169" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">For these reasons it is convenient to bucket location data points into larger groups. However, defining these location clusters is not entirely straightforward. Sometimes one can use countries, counties, cities or districts to group data points together but often there’s a need for finer regions. For this purpose Uber developed an open-sourced geospatial grid system called H3 that covers the entire Earth with repetitive tiling. The building block in the grid system is a hexagon and one can choose from 16 different hexagon sizes that vary from an area of a large country to an area of a small side table.</p><p id="f1dd" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">In this article, we will use Helsinki city bike data to demonstrate how one can utilise H3 hexagons to analyse spatial data. First, we provide an introduction to the H3 hexagon grid and its resolutions. Next, we delve into the main functionalities of the H3 library. Following that, we illustrate how a hexagon grid can enhance data analysis. Finally, we address some issues associated with hexagonal grids. All the notebooks used in this analysis can be found <a class="af og" href="https://github.com/sktahtin4/Helsinki-city-bikes" rel="noopener ugc nofollow" target="_blank">on this GitHub repository</a>. All images in this article, unless otherwise noted, are by the author.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng oh"><img src="../Images/24eb02d7dcb52b56e5a81a48aa7ebd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6pRX9NSWL14qCOWpM_eLQ.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Screenshot from the data analysis notebook. The purple dots indicate the positions of city bike stations, while the hexagons of varying sizes correspond to resolutions 6 (the largest hexagon), 7, and 8.</figcaption></figure></div></div></div><div class="ab cb ny nz oa ob" role="separator"><span class="oc by bm od oe of"/><span class="oc by bm od oe of"/><span class="oc by bm od oe"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="34f0" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Uber’s H3 hexagon system — great for visualising, exploring and optimising spatial data</h1><p id="3d2a" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">Every day and every minute, Uber receives multiple requests in their marketplace. Each event happens at a specific location, for example a rider asks for a ride in one location and a driver accepts the drive in a nearby location. Deriving information and insights from the data, for example setting dynamical pricing that is based on the demand, requires analyzing data across an entire city. But as cities are geographically very diverse, this analysis must happen in fine granularity. With the H3 hexagon grid system, each data point can be bucketed to one hexagon area or cell, and then one Uber can calculate supply and demand for surge pricing on each hexagon in all the cities where they have services. The hexagons come in different sizes so one must choose the resolution that best fits the purpose of the analysis.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng pj"><img src="../Images/51f5425d05c9bfb57a5744e880353d11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZS3bP7bAc8gSS0etGWtJw.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Figures show how the hexagon grid covers the whole Earth and city areas with repetitive tiling. The user can subdivide the areas into smaller and smaller hexagons, and the area of each finer resolution hexagon is roughly one seventh of the coarser hexagon. Note that in order to cover the whole Earth with the hexagon tiling, a few pentagons (shapes with 5 sides) are also needed (more of this later in this article). If one looks carefully at the image, they can see a couple of pentagons in the image as well, for example on top of Sweden and Norway. Image from <a class="af og" href="https://github.com/seanhandley/h3_ruby" rel="noopener ugc nofollow" target="_blank">https://github.com/seanhandley/h3_ruby</a>.</figcaption></figure><p id="1190" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Technically one could build a global grid system using any kind of building block that facilitates a complete tiling throughout the 3D globe. For example one could use triangles (3 sides) or squares (4 sides) instead of hexagons (6 sides) to cover the whole Earth. However, using hexagons has many advantages. For example, the centerpoint of a triangle has three and a square has two different distances to its neighbors’ centerpoints whereas the centerpoint of a hexagon has equal distance to all of its neighbors’ which makes it a convenient system to approximate radiuses (see image below).</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng pk"><img src="../Images/394a42575c7eceaa378e148dbf2a00f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ps4SsRWRYxS1_94wC8LMg.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">The distance of the center points to their neighbors. Out of these, hexagons are the best for approximating radiuses. Image by author.</figcaption></figure><p id="dabe" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">However, the world cannot be divided completely into hexagons so few pentagons (five sides) are needed as well (12 to be exact, on each resolution). The pentagons introduce discontinuities to the grid but often they are located far away from the land so it causes problems for mainly marine data analysis. Despite the presence of a few pentagons, the hexagon grid offers the advantage of providing building blocks that are relatively uniform in size on the 3D spherical surface. In case one wants to read more about the geometrics of a hexagon grid, <a class="af og" href="http://webpages.sou.edu/~sahrk/sqspc/pubs/gdggs03.pdf" rel="noopener ugc nofollow" target="_blank">here’s a good source for it</a>. Note that defining the hexagon regions is highly arbitrary, and they do not follow any natural features such as lakes, rivers, mountains or country borders.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng pl"><img src="../Images/8045e278a6085e7259d282d1971368ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lAbVFRya6OgnPHZwwho2QA.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">The edge length of a hexagon (L) can be used to estimate the radius of the building block. One hexagon contains six equilateral triangles (all sides in the triangle have the same length) and the maximum distance of two points inside of a hexagon is two times the edge length of the hexagon. H3 supports sixteen different hexagon resolutions. Each hexagon at finer resolution is roughly one seventh of the hexagon in coarser resolution. Note that hexagons cannot be perfectly subdivided into seven smaller hexagons so the finer cells only approximately contain their parent cell. As the areas do not overlap perfectly, the count of events in the parent cell might not be equal to the count of events in its children cells. Images by author.</figcaption></figure><p id="943e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The H3 library is open source, available on GitHub and written in C. It has bindings available on multiple languages, for example on Python, C, Java and Javascript. H3 comes with a hierarchical indexing system which makes it very efficient. One can examine the hexagons further using an online <a class="af og" href="https://wolf-h3-viewer.glitch.me/" rel="noopener ugc nofollow" target="_blank">H3 hexagon data viewer</a>. The table below summarizes the properties of the 16 different resolutions that H3 provides.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng pm"><img src="../Images/3aa47437c6604bfe4c0dbe283e6982cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqkwesdD9cXupUQHHRgOiQ.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Table: Average hexagon area and average edge length from https://h3geo.org/docs/core-library/restable/. Author used Chat-GPT to get examples of different sized areas.</figcaption></figure><p id="e661" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Next, we will introduce some of the most important functionalities of the H3 library.</p><h1 id="4730" class="oi oj fq bf ok ol pn gq on oo po gt oq or pp ot ou ov pq ox oy oz pr pb pc pd bk">H3 library and its main functions</h1><p id="9edc" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">In this article we will use the H3 hexagon system to cluster location data into hexagons. The documentation of H3 library can be found <a class="af og" href="https://www.uber.com/en-FI/blog/h3/" rel="noopener ugc nofollow" target="_blank">here.</a> There are two main versions of this library, versions 3 and 4, and in our notebooks we will use version 3.7.6. Note that there are significant differences in function names between version 3.x and 4.x as listed in <a class="af og" href="https://h3geo.org/docs/library/migration-3.x/functions" rel="noopener ugc nofollow" target="_blank">here</a>.</p><p id="fa74" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">H3 Python package is easy to install for example with pip:</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="2531" class="pw oj fq pt b bg px py l pz qa">pip install h3</span></pre><p id="f13c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">If you want to specify which version you want to use, add there the version number, for example h3==3.7.6. Then import H3 to your Python notebook with</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="3bfe" class="pw oj fq pt b bg px py l pz qa">import h3</span></pre><p id="347b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Next, we will introduce some of the most important functions of the H3 library.</p><h2 id="2074" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">Hexagon index</h2><p id="b6d0" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">H3 uses a hierarchical indexing system, which transforms latitude and longitude pairs to a 64-bit H3 index that identifies each grid cell. With given coordinates (latitude and longitude) and with selected resolution, we get the hexagon index:</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="8b39" class="pw oj fq pt b bg px py l pz qa"># Version 3.X:<br/>hexagon_index = h3.geo_to_h3(lat, lng, resolution)<br/><br/># Version 4.X:<br/>hexagon_index = h3.latlng_to_cell(lat, lng, resolution)</span></pre><p id="e76c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">For example</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="cf5c" class="pw oj fq pt b bg px py l pz qa">h3.geo_to_h3(60.169833, 24.938163, 6)</span></pre><p id="58f8" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">returns index <em class="qs">‘861126d37ffffff’</em>. If you want, you can use a<a class="af og" href="https://wolf-h3-viewer.glitch.me/" rel="noopener ugc nofollow" target="_blank">n online H3 hexagon data viewer</a> to check where this hexagon is located.</p><p id="3ea6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">So when we know the precise coordinates for a data point, we can determine its hexagon index at various resolutions and associate it with hexagons of different sizes.</p><h2 id="2e39" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">Hexagon boundaries</h2><p id="7857" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">To use hexagons in our plots, we must determine the hexagon boundaries from the hexagon index. Note that coordinates in some systems are presented as (lng, lat), while in others, they follow the format (lat, lng). The geo_json=True/False option allows you to swap these coordinates.</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="9799" class="pw oj fq pt b bg px py l pz qa"># Version 3.X:<br/>boundary = h3.h3_to_geo_boundary(hexagon_index, geo_json = False)<br/><br/># Version 4.X:<br/>boundary = h3.cell_to_boundary(hexagon_index, geo_json = False)</span></pre><p id="009e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">For example</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="33c4" class="pw oj fq pt b bg px py l pz qa">h3.h3_to_geo_boundary('861126d37ffffff', geo_json = False)<br/><br/># Returns:<br/>((60.15652369744344, 24.856525761155346),<br/> (60.13498207546084, 24.895664284494664),<br/> (60.14431977678549, 24.948769321085937),<br/> (60.175221029708474, 24.962796993345798),<br/> (60.19677983831024, 24.92362795620145),<br/> (60.187420192445906, 24.870461733016352))</span></pre><p id="68aa" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">These six coordinate pairs correspond to the starting and ending points of the hexagon edges.</p><h2 id="df04" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">Neighboring hexagons</h2><p id="31cf" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">Sometimes we need to identify the neighbors of a specific hexagon, or “kring” around the hexagon. With k=0 the function returns the origin index, with k=1 it returns the origin index and its all neighboring indices, and with k=2 it returns the origin index, its neighboring and next-to-neighboring indices, and so forth.</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="e4c3" class="pw oj fq pt b bg px py l pz qa"># Version 3.X:<br/>kring = h3.k_ring(hexagon_index, k)<br/><br/># Version 4.X:<br/>kring = h3.grid_disk(hexagon_index, k)</span></pre><p id="5ca3" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Also there’s a function that can be used to calculate the grid distance between two cells:</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="88d0" class="pw oj fq pt b bg px py l pz qa"># Version 3.X:<br/>kring = h3.h3_distance(hexagon_index_a, hexagon_index_a)<br/><br/># Version 4.X:<br/>kring = h3.grid_distance(hexagon_index_a, hexagon_index_a)</span></pre><p id="51d1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">We can use these functions in the following way:</p><pre class="ni nj nk nl nm ps pt pu bp pv bb bk"><span id="763d" class="pw oj fq pt b bg px py l pz qa"># Nearest neighbours of the hexagon:<br/>h3.k_ring('861126d37ffffff', 1)<br/><br/># Returns:<br/>{'86089969fffffff',<br/> '86089ba4fffffff',<br/> '86089ba6fffffff',<br/> '861126d07ffffff',<br/> '861126d17ffffff',<br/> '861126d27ffffff',<br/> '861126d37ffffff'}<br/><br/># Distance between two hexagons:<br/>h3.h3_distance('861126d37ffffff', '86089ba4fffffff')<br/><br/># Returns<br/>1</span></pre><h2 id="a866" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">Plotting the hexagons</h2><p id="af38" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">There are multiple ways on how to plot hexagons on a map but some of them are quite stiff, time consuming to use and not well-documented. For simplicity, we are mainly using matplotlib for visualizations but we also experiment and take screenshots of visualizations with folium maps. More details on these plotting methods can be found from the GitHub repository.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng qt"><img src="../Images/ecfb63cc2e24ea1ca9ad66123e0a0d00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymmzMd32RWSXw5ATM0ywYA.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Examples of two different plotting options: on the left we use matplotlib for plotting and on the right we use folium maps.</figcaption></figure><p id="6d98" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">On the left in the above figure we use matplotlib for plotting the hexagons. We utilize the GADM library to fetch the multipolygon representing the Helsinki region and plot it with green color. We use blue in the background to represent bodies of water. Additionally, we include a marker denoting the Helsinki city center on the map. The hexagons are easily rendered using the plot_polygon function from the shapely library and data points can be added to the plot by using scatterplot. This makes the plotting very easy and quick.</p><p id="4996" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">We also experimented with other plotting methods, such as using folium maps that allows us to create an interactive HTML map that allows us to zoom in and out in the map. On the right in the above figure we show a screenshot of such a map. Even though the result is aesthetically nice, it is very time consuming to add new features (such as colorbars or heatmaps) to the map so it’s not the best tool for exploratory data analysis. The notebook for plotting the interactive folium maps <a class="af og" href="https://github.com/sktahtin4/Helsinki-city-bikes/blob/main/City-bikes-data-analysis-with-folium-maps.ipynb" rel="noopener ugc nofollow" target="_blank">can be found in here</a>.</p></div></div></div><div class="ab cb ny nz oa ob" role="separator"><span class="oc by bm od oe of"/><span class="oc by bm od oe of"/><span class="oc by bm od oe"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="c591" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Helsinki city bike data</h1><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng qu"><img src="../Images/fbef34643ec07c9a8434c03c7333be3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zVC9N71CILRKzyJy"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Image by author: Helsinki city bikes near Helsinki railway station (2023).</figcaption></figure><p id="0add" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">In this article, we use H3 hexagons to analyze Helsinki city bike usage. The data contains all the journeys undertaken between 2016 and 2021, as well as information on the stations available in the city bike network. City bikes are available nearly throughout Helsinki and in parts of Espoo, and the station network is dense, particularly in central Helsinki.</p><p id="e6fa" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The city bike system works such that a user can grab a city bike from any station and return it to any city bike station, even if they are at full capacity. Typically, city bike trips are brief, such as commuting from a metro station to a specific destination, and the purpose of the city bikes is to make public transport more appealing by offering a quick way to transit between two locations. City bikes are available approximately from March to October, and a full season costs 35 euros (less than 40 US dollars). With this fixed fee, users can use city bikes as much as they want as long as the trip lasts less than 30 minutes. If a trip exceeds 30 minutes, the user must pay an additional charge of 1 euro for every subsequent 30 minutes. All in all, clean and simple, and very convenient for short trips!</p><p id="e427" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The data contains two files: station (©HSL 2021) and journey data (©City bike Finland 2021). Both datasets are downloaded from <a class="af og" href="https://www.hsl.fi/en/hsl/open-data" rel="noopener ugc nofollow" target="_blank">HSL open data</a> and they have <a class="af og" href="https://creativecommons.org/licenses/by/4.0/deed.en" rel="noopener ugc nofollow" target="_blank">Creative Commons BY 4.0 International licence</a>. In the following section, we will provide a brief introduction to these datasets. The analysis and cleaning notebooks can be found from <a class="af og" href="https://github.com/sktahtin4/Helsinki-city-bikes" rel="noopener ugc nofollow" target="_blank">a GitHub repository</a>.</p><h2 id="8d00" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">Stations data</h2><p id="ad59" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">To begin, let’s take a closer look at the data. As always in data science projects, the dataset needs some cleaning before we can use it. For example, the column names are a mixture of Finnish, Swedish and English and for clarity, we want to rename them. The notebook detailing our data cleaning process can be found <a class="af og" href="https://github.com/sktahtin4/Helsinki-city-bikes/blob/main/City-bikes-data-cleaning.ipynb" rel="noopener ugc nofollow" target="_blank">at this link</a>. In the cleaned dataset, we have 457 stations, and the first rows looks like this:</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng qv"><img src="../Images/e81fd0b3cb38d348401a65a0b47f79b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gISKT2XNg2JYSOJ0"/></div></div></figure><p id="df3c" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">The station’s dataframe includes station ID, station name, address, city, capacity of the station, and geographical coordinates; longitude and latitude. Our objective is to cluster these stations based on their spatial location using the H3 hexagon system. Initially, the optimal hexagon size for analysis is unknown, prompting us to experiment with four different resolutions: 6, 7, 8, and 9. These resolutions correspond to edge lengths of 3.7 km, 1.4 km, 500 m, and 200 m, respectively. Once latitude, longitude, and resolution is given, we can employ the H3 library to determine the corresponding H3 hexagon index as shown above in this article.</p><p id="20b7" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Once we have retrieved the four hexagon IDs at different resolutions for all the stations, we obtain the following data table:</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng qw"><img src="../Images/fc8027bd9577e6127a961d90f54b2c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X0MwjEbnHmCczlrG"/></div></div></figure><p id="4d30" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With the station ID, we can merge this data table with the journey data, which enables us to categorize trips into distinct hexagons and analyze the outcomes.</p><h2 id="329a" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">Journey data</h2><p id="b679" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">The journey data contains all city bike trips taken between 2016 and 2021. It includes information such as the names and IDs of the departure and return stations, departure and return times, trip duration, and distance traveled. Note that each journey must start and end at one of the city bike stations. Initially, the dataset contains 15 million trips, but data cleaning drops 3.5% of the rows so we are left with 14.5 million trips. The notebook detailing the data cleaning process is available in the same GitHub repository. Let’s examine the first few rows from the trip data:</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng qw"><img src="../Images/eebe0a80e507e6d7287370a09467fcab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sLB-6-SLncVdAGSs"/></div></div></figure><p id="cb1f" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With the station IDs we can merge station data with the journey data and append the hexagon IDs of both departure and return stations to the dataset. So next we can start the data analysis that utilizes the H3 hexagons.</p></div></div></div><div class="ab cb ny nz oa ob" role="separator"><span class="oc by bm od oe of"/><span class="oc by bm od oe of"/><span class="oc by bm od oe"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="250f" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Data insights with the hexagons</h1><p id="4c9e" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">A fundamental aspect of being a data scientist involves extracting meaningful insights from the available data. This typically requires data transformations, so creating new features from the existing ones in order to aggregate the data. For example we might want to extract the day of the week from dates, segment continuous variables into fixed-sized bins, or group data points into clusters or categories. In this section, we will showcase the types of data insights that can be obtained from location data, whether utilizing hexagons or not. Details of the data analysis can be found from the data cleaning and data analysis notebooks within the GitHub repository.</p><h2 id="6914" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">A. Data analysis without hexagons</h2><p id="9e3d" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">Let’s begin by exploring what kind of analysis we can conduct without relying on hexagons. Since our data spans from 2016 to 2021, a key aspect is understanding how the data has evolved over time. Some questions we might ask include:</p><ul class=""><li id="2a51" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne qx qy qz bk">Where are the city bike stations located?</li><li id="0a28" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">What is the typical length of a bike trip in terms of both duration and distance?</li><li id="302f" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">How has the city bike station network expanded over the years?</li><li id="5e94" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">How has the number of trips changed over the years?</li></ul><p id="b90b" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To address these questions, we start by plotting the station locations on a map by using the provided latitude and longitude coordinates.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rf"><img src="../Images/af110102ca8dfdbe3deacc34c4b90d94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4XbXSFK3Z8s7fv52"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">In the left figure, we see that the stations from 2021 are primarily located in Helsinki but partly in Espoo too. Some station names are displayed on the map to help identify different locations. On the right we categorize trip durations and distances into four bins and calculate their respective frequencies. Nearly half of the trips last less than 10 minutes and only a small percentage exceed 30 minutes (note that the user needs to pay extra charges beyond this duration). The city bikes are typically employed for short-distance travels so it’s not surprising that the majority of the trips are less than 3 kilometers.</figcaption></figure><p id="dc17" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Next, we can analyze how the data have changed over the years.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rg"><img src="../Images/e799ecb7bec4b614f7d43b91f35db8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nP6nREGruIrmCYuu"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">The left figure displays all city bike stations and the years they were incorporated into the network. The first city bike stations were introduced in 2016 and they were located in central Helsinki. With each passing year, the city bike network expanded, enabling bike usage in areas further away from central Helsinki. The top-right figure shows the number of stations in each year. Lastly, the bottom-right figure reveals the annual number of trips made with city bikes. Peak usage occurred in 2019 with approximately 3.7 million trips, followed by a decline of 17% in the next year, despite the increasing number of stations. The drop in 2020 and 2021 is likely influenced by the COVID-19 pandemic, but also partly due to commercial scooters that became available in Helsinki in 2019 and that quickly gained popularity especially in short-distance travel.</figcaption></figure><p id="e91a" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To delve deeper into statistics derived from the city bike data, we will now incorporate hexagons in our analysis.</p><h2 id="8093" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">B. Using hexagon grid to analyze city bike data</h2><p id="a2f0" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">Hexagons offer us a tool for detailed analysis of the city bike usage. The questions we aim to address using hexagons include:</p><ul class=""><li id="0e3c" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne qx qy qz bk">Where do we have a lot of city bike stations?</li><li id="f155" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">In which areas of the city do we observe the highest number of departures or returns?</li><li id="59d4" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">What is the average trip length in different parts of Helsinki?</li></ul><p id="92e6" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">However, before tackling these questions, we need to decide the size of the hexagon we use in our analysis.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rh"><img src="../Images/10f0a400e137264c0ca2a4bcd93e5ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*moLxXp3JS1DFHn9Y"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">We start by examining hexagons at resolutions 6, 7, and 8, corresponding to radii of approximately 3.7 km, 1.4 km, and 500m, respectively. From these plots it is difficult to visually assess the station density, especially with the smallest hexagons.</figcaption></figure><p id="f6b1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Let’s compute the station count within each hexagon and plot the hexagons with colors that reflect the number of stations within each respective hexagon:</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rh"><img src="../Images/c901e44980503082ab4fec091cb5058b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7Hnao3czDlpSCx_y"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">The hexagons are rather large at resolution 6 and the station count per hexagon varies a lot so this resolution is probably too large for our needs. Resolutions 7 and 8 exhibit fewer variations in station numbers, and that can potentially make them more suitable for our analysis. However, there’s no rule of thumb for determining the ideal resolution as it depends on the specific insights we’re seeking.</figcaption></figure><p id="a72d" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Hexagons help to visualize location-related insights, such as identifying the busiest parts of the town for the service. If we wouldn’t use hexagons, an alternative approach could involve calculating the average daily number of departures per station and plotting the result using circles of varying size, as shown in the figure below. However, the stations are so close to each other especially at the central Helsinki that it becomes challenging to accurately comprehend the daily number of departures.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng ri"><img src="../Images/0bdb15ab29b9c13e7f76afdc082fd9c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*93_0zO5LYQAjs3gl"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Hexagon grid helps us perceive location specific data quicker. In the left image, we calculate the average number of daily departures per each station and use the size of each circle to represent the calculated average. In central Helsinki the stations are so closely spaced that it becomes challenging to discern the volume of departures in that area. Whereas on the right, we utilize hexagons of resolution 8 to plot the average number of daily departures in different parts of the city. With this approach it is a way easier to see the volume of departures in different parts of Helsinki. For example, we can see from the image that there are numerous areas with fewer than 100 daily departures on average, whereas in central Helsinki the average exceeds 900 daily departures.</figcaption></figure><p id="5d92" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">With the hexagon grid we can also visualize various other insights from the data, such as the following graphs:</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng ri"><img src="../Images/67696120556bd3110ce7f08a565b55f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-DhkT4Vgt8nqhjX6"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">On the left, we plot the average number of daily returns in each hexagon area. The result closely resembles the average of daily departures. On the right, we visualize the average distance traveled to the return station. The average trip length fluctuates across the city, with the longest trips occurring in areas with less frequent public transportation.</figcaption></figure><h2 id="7f03" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">C. Selecting one hexagon and getting location specific insights</h2><p id="41c1" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">Sometimes we are interested in extracting more detailed insights from a specific region. By selecting one hexagon we can dive deeper into the data within that specific area and seek answers to questions such as:</p><ul class=""><li id="7280" class="mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne qx qy qz bk">What are the peak usage times for city bikes in that area?</li><li id="865c" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">How does bike usage vary between weekdays and weekends in that region?</li><li id="6207" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">Where are users heading from that location?</li></ul><p id="a488" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">To showcase how we could answer these questions, we opt for the following hexagon in the Helsinki city center:</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rj"><img src="../Images/7264c5960da389a3022b450136e7ce93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jf1-KxNkbrzD6W9PRKGDlw.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">For a more in-depth analysis, we choose the highlighted hexagon situated in the Helsinki city center.</figcaption></figure><p id="3ac9" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Let’s begin examining the data from that specific area.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rh"><img src="../Images/0cdd5df5e6dccbfe615414dfbdff53a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Vj5v9_DHsp6etJEa"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">On the left we plot the average number of departures for each weekday and hour to provide us with insights on the busiest times. In Finland, typical work hours are from 8–16 or 9–17, and we can see a clear peak on weekdays around 7 a.m. as people commute to work and at 4–5 p.m. when they leave work. Interestingly, it’s more common to grab a city bike after work than in the mornings. Notably, there’s a significant peak in usage on Friday and Saturday nights as people return home from bars and parties. Additionally, we can plot the trip length and duration for each weekday to identify potential variations between weekdays and weekends but the graphs on the right reveal only minor differences between different days.</figcaption></figure><p id="2d3e" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">We can also visualize the destinations of trips originating from the selected hexagon to determine where users are heading from that area.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rk"><img src="../Images/7c4af244157d8531c2741c5d2ef6f5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lwmZnwR-GlV6MUF5"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">On the left, we display a hexagon map showing the destination of the trips originating from the selected hexagon. On the right, we compute the grid distance between the selected hexagon and the destination hexagon where a distance of 0 signifies that the return and departure hexagons are the same. This analysis reveals that approximately 40% of the bike trips from the selected hexagon start and end within the same hexagon. Additionally, nearly 50% of the trips end in neighboring hexagons, indicating that the majority of bike trips from the Helsinki city center are directed to other areas within the city center.</figcaption></figure><h2 id="bec8" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">D. Selecting one location and analyzing data in the area around it</h2><p id="71b1" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">At times, we aim to gain insights around a specific location. For instance, we might want to understand city bike usage around a metro station that we frequently use, such as Kamppi metro station in this example. If we seek insights within a radius of approximately ~1 km, we might be tempted to choose the hexagon of resolution 7 containing the station, as the radius of that hexagon is roughly 1.4 km. However, as shown in the left image below, the selected station is not at the center of the hexagon, thus not effectively covering the ~1 km area around the data point.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rk"><img src="../Images/5b8c1f7404296b6bba60bfb2ee794a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R4lO5EfD9Cb1rArj"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">When we seek insights within a ~1 km radius around a specific data point, such as Kamppi metro station, we should not simple choose a hexagon that is roughly the size of the wanted radius because the data point might not be in the middle of the hexagon (as illustrated in the left image). In order to better center the data point, it is advisable to opt for a smaller hexagon containing the chosen station and then consider its neighboring cells as well. The neighboring hexagons are very easy to find with H3’s k_ring function. The smaller hexagon we choose and the more neighbors we take into account, the more effectively the selected data point is centered.</figcaption></figure><p id="78f1" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Using the selected hexagons, we could analyze data around the desired data point.</p><h2 id="0e4a" class="qb oj fq bf ok qc qd qe on qf qg qh oq ms qi qj qk mw ql qm qn na qo qp qq qr bk">E. Anonymising the location data</h2><p id="b096" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">After obtaining hexagon indexes through geographic coordinates, we can omit the exact location data and exclusively utilise the H3 indexes. This aids in anonymizing the data, as there is no need to reveal the precise user location.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng rl"><img src="../Images/f5477492c039cc84bc003290b7932fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vv2sr-kvPgLRTCzMVdPSnw.png"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">Illustration of data anonymization: on the left, we display the precise start and end locations of a bike trip, which may expose sensitive user information. On the right, by using hexagon indexes, we avoid disclosing the exact location and instead represent the hexagon area with a radius of approximately 1.4km where the bike trip starts and ends.</figcaption></figure><h1 id="685a" class="oi oj fq bf ok ol pn gq on oo po gt oq or pp ot ou ov pq ox oy oz pr pb pc pd bk">Issues with hexagons</h1><p id="373e" class="pw-post-body-paragraph mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne fj bk">The hexagon grid provided by the H3 library proves to be a useful tool for spatial data analysis. However, there are some challenges that arise when utilizing this hexagon grid, which we will elaborate on below.</p><p id="07d0" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">From a mathematical perspective, the definition of hexagonal zones is entirely arbitrary. For this reason H3 hexagons lack alignment with any “natural elements,” such as streets, rivers, lakes, islands, highways, or train tracks. When employing the hexagon grid, data points are aggregated based on their proximity in straight-line distance. However, these points may not always be connected by roads, potentially resulting in the grouping of disparate locations into a single cluster. We show an example of this below.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng qw"><img src="../Images/7283db26ebced6959496807b9b016701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D8_SmrgX8Nn8FGgr"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">For instance, if we select hexagons of resolution 6 (indicating a radius of approximately ~3.7 km), the two red-marked dots belong to the same hexagon even though they are not directly connected and the biking distance between these data points is roughly ~11km. Analyzing statistics for this hexagon may not yield much value due to the diverse nature of the different areas.</figcaption></figure><p id="f19f" class="pw-post-body-paragraph mj mk fq ml b go mm mn mo gr mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fj bk">Another challenge arises if we aim to use the hexagons for anonymizing a user’s precise location. For example, instead of recording the user’s exact location, we could use hexagons of resolution 7 to indicate that the data point lies within an area with a radius of roughly 1.4 km. However, since the ideal hexagon resolution for analysis is often unknown, there may be a desire to link the data across various resolutions. But as the coarser hexagon only approximately contains its seven child hexagons, we might end up disclosing the location of a data point positioned close to the hexagon’s border more accurately than the specified 1.4 km radius. We demonstrate this in the image below.</p><figure class="ni nj nk nl nm nn nf ng paragraph-image"><div role="button" tabindex="0" class="no np ed nq bh nr"><div class="nf ng qw"><img src="../Images/841c8323992989a20b3a0ba300013ddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4lGmwWdkNjc9UchY"/></div></div><figcaption class="nt nu nv nf ng nw nx bf b bg z dx">When employing hexagons for data anonymization, it’s crucial to recognize that we may unintentionally disclose the position more accurately than intended. For instance, when examining the hexagon indexes of the red data point at resolutions 7 and 8, we observe that the smaller hexagon is not a direct child of the larger hexagons. Consequently, the data point must be situated within the overlapping region highlighted in black. Instead of anonymizing the data point to a region with a radius of roughly 500m, we, in fact, provided more detailed information. This poses a risk when anonymizing location data that is highly sensitive.</figcaption></figure><h1 id="bfeb" class="oi oj fq bf ok ol pn gq on oo po gt oq or pp ot ou ov pq ox oy oz pr pb pc pd bk">Summary</h1><ul class=""><li id="dfea" class="mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne qx qy qz bk">Uber’s global H3 hexagonal grid system is a user-friendly and practical tool for spatial data analysis. It can also help us to anonymise sensitive location data.</li><li id="70eb" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">H3 buckets location data points into hexagonal areas that cover the whole Earth with repetitive tiling. H3 library supports sixteen different hexagon resolutions, with the largest hexagons being ~1300km and the smallest only ~50m. From the different sizes of hexagons one must choose the resolution that best fits the purpose of the analysis.</li><li id="59b9" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">Each hexagon at finer resolution is roughly one seventh of the hexagon in coarser resolution. However, hexagons cannot be perfectly subdivided into seven smaller hexagons so the finer cells only approximately contain their parent cell. This means that the count of events in the parent cell might not be equal to the count of events in its children cells.</li><li id="be41" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">Note that, hexagon grid lacks alignment with any “natural elements,” such as streets, rivers, lakes, islands, highways, or train tracks, so disparate locations might be grouped into a single cluster.</li></ul><h1 id="395c" class="oi oj fq bf ok ol pn gq on oo po gt oq or pp ot ou ov pq ox oy oz pr pb pc pd bk">References:</h1><ul class=""><li id="6290" class="mj mk fq ml b go pe mn mo gr pf mq mr ms pg mu mv mw ph my mz na pi nc nd ne qx qy qz bk">GitHub repository for the Helsinki city bike data analysis: <a class="af og" href="https://github.com/sktahtin4/Helsinki-city-bikes" rel="noopener ugc nofollow" target="_blank">https://github.com/sktahtin4/Helsinki-city-bikes</a></li><li id="9927" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">Uber blog on H3: <a class="af og" href="https://www.uber.com/en-FI/blog/h3/" rel="noopener ugc nofollow" target="_blank">https://www.uber.com/en-FI/blog/h3/</a></li><li id="8f7d" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">H3 documentation: <a class="af og" href="https://h3geo.org/" rel="noopener ugc nofollow" target="_blank">https://h3geo.org/</a></li><li id="0e66" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">Table of statistics of the different hexagon resolutions: <a class="af og" href="https://h3geo.org/docs/core-library/restable/" rel="noopener ugc nofollow" target="_blank">https://h3geo.org/docs/core-library/restable/</a></li><li id="8b59" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">More info on the global grid systems: <a class="af og" href="http://webpages.sou.edu/~sahrk/sqspc/pubs/gdggs03.pdf" rel="noopener ugc nofollow" target="_blank">http://webpages.sou.edu/~sahrk/sqspc/pubs/gdggs03.pdf</a></li><li id="ad3b" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">Data viewer for the hexagons: <a class="af og" href="https://wolf-h3-viewer.glitch.me/" rel="noopener ugc nofollow" target="_blank">https://wolf-h3-viewer.glitch.me</a></li><li id="62d3" class="mj mk fq ml b go ra mn mo gr rb mq mr ms rc mu mv mw rd my mz na re nc nd ne qx qy qz bk">HSL open data: <a class="af og" href="https://www.hsl.fi/en/hsl/open-data" rel="noopener ugc nofollow" target="_blank">https://www.hsl.fi/en/hsl/open-data</a></li></ul></div></div></div></div>    
</body>
</html>