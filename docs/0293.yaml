- en: Using Causal Graphs to answer causal questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/using-causal-graphs-to-answer-causal-questions-5fd1dd82fa90?source=collection_archive---------1-----------------------#2024-01-31](https://towardsdatascience.com/using-causal-graphs-to-answer-causal-questions-5fd1dd82fa90?source=collection_archive---------1-----------------------#2024-01-31)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Causal AI, exploring the integration of causal reasoning into machine learning
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@raz1470?source=post_page---byline--5fd1dd82fa90--------------------------------)[![Ryan
    O''Sullivan](../Images/7cd161d38d67d2c0b7da2d8f3e7d33fe.png)](https://medium.com/@raz1470?source=post_page---byline--5fd1dd82fa90--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--5fd1dd82fa90--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--5fd1dd82fa90--------------------------------)
    [Ryan O''Sullivan](https://medium.com/@raz1470?source=post_page---byline--5fd1dd82fa90--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--5fd1dd82fa90--------------------------------)
    ·9 min read·Jan 31, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/de2d3dc8860ce785769383e679f20d22.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [GuerrillaBuzz](https://unsplash.com/@guerrillabuzz?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: What is this series of articles about?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Welcome to my series on Causal AI, where we will explore the integration of
    causal reasoning into machine learning models. Expect to explore a number of practical
    applications across different business contexts.
  prefs: []
  type: TYPE_NORMAL
- en: '**Introduction**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This article gives a practical introduction to the potential of causal graphs.
  prefs: []
  type: TYPE_NORMAL
- en: 'It is aimed at anyone who wants to understand more about:'
  prefs: []
  type: TYPE_NORMAL
- en: What causal graphs are and how they work
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A worked case study in Python illustrating how to build causal graphs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How they compare to ML
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The key challenges and future considerations
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The full notebook can be found here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://github.com/raz1470/causal_ai/blob/main/notebooks/using%20causal%20graphs%20to%20answer%20causal%20questions.ipynb?source=post_page-----5fd1dd82fa90--------------------------------)
    [## causal_ai/notebooks/using causal graphs to answer causal questions.ipynb at
    main ·…'
  prefs: []
  type: TYPE_NORMAL
- en: This project introduces Causal AI and how it can drive business value. - causal_ai/notebooks/using
    causal graphs to…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: github.com](https://github.com/raz1470/causal_ai/blob/main/notebooks/using%20causal%20graphs%20to%20answer%20causal%20questions.ipynb?source=post_page-----5fd1dd82fa90--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: '**What are Causal Graphs?**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Causal graphs help us disentangle causes from correlations. They are a key part
    of the causal inference/causal ML/causal AI toolbox and can be used to answer
    causal questions.
  prefs: []
  type: TYPE_NORMAL
- en: Often referred to as a DAG (directed acyclic graph), a causal graph contains
    nodes and edges — Edges link nodes that are causally related.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are two ways to determine a causal graph:'
  prefs: []
  type: TYPE_NORMAL
- en: Expert domain knowledge
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Causal discovery algorithms
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For now, we will assume we have expert domain knowledge to determine the causal
    graph (we will cover causal discovery algorithms further down the line).
  prefs: []
  type: TYPE_NORMAL
- en: '**Why can’t we just use ML?**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The objective of ML is to classify or predict as accurately as possible given
    some training data. There is no incentive for an ML algorithm to ensure the features
    it uses are causally linked to the target. There is no guarantee that the direction
    (positive/negative effect) and strength of each feature will align with the true
    data generating process. ML won’t take into account the following situations:'
  prefs: []
  type: TYPE_NORMAL
- en: Spurious correlations — Two variables having a spurious correlation when they
    have a common cause e.g. High temperatures increasing the number of ice cream
    sales and shark attacks.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Confounders — A variable is affecting your treatment and outcome e.g. Demand
    affecting how much we spend on marketing and how many new customers sign up.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Colliders — A variable that is affected by two independent variables e.g. Quality
    of customer care -> User satisfaction <- Size of company
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Mediators — Two variables being (indirectly) linked through a mediator e.g.
    Regular exercise -> Cardiovascular fitness (the mediator) -> Overall health
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Because of these complexities and the black-box nature of ML, we can’t be confident
    in its ability to answer causal questions.
  prefs: []
  type: TYPE_NORMAL
- en: '**Structural Causal Models**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Given a known causal graph and observed data, we can train a structural causal
    model (SCM). An SCM can be thought of as a series of causal models, one per node.
    Each model uses one node as a target, and its direct parents as features. If the
    relationships in our observed data are linear, an SCM will be a series of linear
    equations. This could be modelled by a series of linear regression models. If
    the relationships in our observed data are non-linear, this could be modelled
    with a series of boosted trees.
  prefs: []
  type: TYPE_NORMAL
- en: The key difference to traditional ML is that an SCM models causal relationships
    and accounts for spurious correlations, confounders, colliders and mediators.
  prefs: []
  type: TYPE_NORMAL
- en: It is common to use an additive noise model (ANM) for each non-root node (meaning
    it has at least one parent). This allows us to use a range of machine learning
    algorithms (plus a noise term) to estimate each non-root node.
  prefs: []
  type: TYPE_NORMAL
- en: Y := f(X) + N
  prefs: []
  type: TYPE_NORMAL
- en: Root nodes can modelled using a stochastic model to describe the distribution.
  prefs: []
  type: TYPE_NORMAL
- en: An SCM can be seen as a generative model as can to generate new samples of data
    — This enables it to answer a range of causal questions. It generates new data
    by sampling from the root nodes and then propagating data through the graph.
  prefs: []
  type: TYPE_NORMAL
- en: '**Answering causal questions**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The value of an SCM is that it allows us to answer causal questions by calculating
    counterfactuals and simulating interventions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Counterfactuals: Using historically observed data to calculate what would have
    happened to y if we had changed x. e.g. What would have happened to the number
    of customers churning if we had reduced call waiting time by 20% last month?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Interventions: Very similar to counterfactuals (and often used interchangeably)
    but interventions simulate what what would happen in the future e.g. What will
    happen to the number of customers churning if we reduce call waiting time by 20%
    next year?'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Call Centre case study**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are several KPIs that the customer service team monitors. One of these
    is call waiting times. Increasing the number of call centre staff will decrease
    call waiting times.
  prefs: []
  type: TYPE_NORMAL
- en: But how will decreasing call waiting time impact customer churn levels? And
    will this offset the cost of additional call centre staff?
  prefs: []
  type: TYPE_NORMAL
- en: The Data Science team is asked to build and evaluate the business case.
  prefs: []
  type: TYPE_NORMAL
- en: '**Determining the causal graph**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The population of interest is customers who make an inbound call. The following
    time-series data is collected daily:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ea95f2a517a5ea6c23b1cc89cb028263.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: In this example, we use time-series data but causal graphs can also work with
    customer-level data.
  prefs: []
  type: TYPE_NORMAL
- en: In this example, we use expert domain knowledge to determine the causal graph.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7f87d73da2c5be5e5e94137445c52f12.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '**Data generating process**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Next, we need to generate data for our case study.
  prefs: []
  type: TYPE_NORMAL
- en: We want to generate some data which will allow us to compare calculating counterfactuals
    using causal graphs vs ML (to keep things simple, ridge regression).
  prefs: []
  type: TYPE_NORMAL
- en: As we identified the causal graph in the last section, we can use this knowledge
    to create a data-generating process.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/9922931040e9b9c7d7029dbe255b01bf.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '**Training an SCM**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We now have an adjacency matrix which represents our causal graph and some data.
    We use the gcm module from the dowhy Python package to train an SCM.
  prefs: []
  type: TYPE_NORMAL
- en: It’s important to think about what causal mechanism to use for the root and
    non-root nodes. If you look at our data generator function, you will see all of
    the relationships are linear. Therefore choosing ridge regression should be sufficient.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: You could also use the auto assignment function to automatically assign the
    causal mechanisms instead of manually assigning them.
  prefs: []
  type: TYPE_NORMAL
- en: 'For more info on the gcm package see the docs:'
  prefs: []
  type: TYPE_NORMAL
- en: '[## DoWhy documentation - DoWhy documentation'
  prefs: []
  type: TYPE_NORMAL
- en: 'Date: Dec 25, 2023 Version: v0.11.1 Related resources: Source Repository |
    Issues & Ideas | PyWhy Organization | DoWhy…'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: www.pywhy.org](https://www.pywhy.org/dowhy/v0.11.1/?source=post_page-----5fd1dd82fa90--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: '**Ridge regression comparison**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We also use ridge regression to help create a baseline comparison. We can look
    back at the data generator and see that it correctly estimates the coefficients
    for each variable. However, in addition to directly influencing churn, call waiting
    time indirectly influences churn through abandoned calls, reported problems and
    discounts sent.
  prefs: []
  type: TYPE_NORMAL
- en: When it comes to estimating counterfactuals it is going to be interesting to
    see how the SCM compares to ridge regression.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/8bdef4723a46a3c0aaec5a3a2a4d6f89.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '**Estimating ground truth**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Before we move on to calculating counterfactuals using causal graphs and ridge
    regression, we need a ground truth benchmark. We can use our data generator to
    create counterfactual samples after we have reduced call waiting time by 20%.
  prefs: []
  type: TYPE_NORMAL
- en: We couldn’t do this with real-world problems but this method allows us to assess
    how effective the causal graph and ridge regression is.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '**Estimating counterfactuals**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We can now estimate what would have happened if we had of decreased the call
    waiting time by 20% using our 3 methods:'
  prefs: []
  type: TYPE_NORMAL
- en: Ground truth (from the data generator)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ridge regression
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Causal graph
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We see that ridge regression underestimates the impact on churn significantly
    whilst the causal graph is very close to the ground truth.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/0da8f6eb1bd4a932cc8e7626cb4e0046.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: '**Future considerations**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This was a simple example to start you thinking about the power of causal graphs.
  prefs: []
  type: TYPE_NORMAL
- en: 'For more complex situations, several challenges that would need some consideration:'
  prefs: []
  type: TYPE_NORMAL
- en: What assumptions are made and what is the impact of these being violated?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What about if we don’t have the expert domain knowledge to identify the causal
    graph?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What if there are non-linear relationships?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How damaging is multi-collinearity?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: What if some variables have lagged effects?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How can we deal with high-dimensional datasets (lots of variables)?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All of these points will be covered in future blogs.
  prefs: []
  type: TYPE_NORMAL
- en: '**Resources**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'If your interested in learning more about causal AI, I highly recommend the
    following resources:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://www.packtpub.com/product/causal-inference-and-discovery-in-python/9781804612989?source=post_page-----5fd1dd82fa90--------------------------------)
    [## Causal Inference and Discovery in Python | Packt'
  prefs: []
  type: TYPE_NORMAL
- en: Demystify causal inference and casual discovery by uncovering causal principles
    and merging them with powerful machine…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: www.packtpub.com](https://www.packtpub.com/product/causal-inference-and-discovery-in-python/9781804612989?source=post_page-----5fd1dd82fa90--------------------------------)
    [](https://www.oreilly.com/library/view/causal-inference-in/9781098140243/?source=post_page-----5fd1dd82fa90--------------------------------)
    [## Causal Inference in Python
  prefs: []
  type: TYPE_NORMAL
- en: How many buyers will an additional dollar of online marketing bring in? Which
    customers will only buy when given a…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: www.oreilly.com](https://www.oreilly.com/library/view/causal-inference-in/9781098140243/?source=post_page-----5fd1dd82fa90--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: What does ChatGPT have to say about the author? 😊
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: “Meet Ryan, a seasoned Lead Data Scientist with a specialized focus on employing
    causal techniques within business contexts, spanning Marketing, Operations, and
    Customer Service. His proficiency lies in unraveling the intricacies of cause-and-effect
    relationships to drive informed decision-making and strategic enhancements across
    diverse organizational functions.”
  prefs: []
  type: TYPE_NORMAL
- en: Follow me if you want to continue this journey into Causal AI — In the next
    article we will take a step back and delve into using Causal Discovery to estimate
    the Causal Graph when we don’t have expert domain knowledge.
  prefs: []
  type: TYPE_NORMAL
