<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Multi-Agentic RAG with Hugging Face Code Agents</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Multi-Agentic RAG with Hugging Face Code Agents</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multi-agentic-rag-with-hugging-face-code-agents-005822122930?source=collection_archive---------0-----------------------#2024-12-31">https://towardsdatascience.com/multi-agentic-rag-with-hugging-face-code-agents-005822122930?source=collection_archive---------0-----------------------#2024-12-31</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="1300" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Using <em class="hd">Qwen2.5–7B-Instruct</em> powered code agents to create a local, open source, multi-agentic RAG system</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@gabrielesgroi94?source=post_page---byline--005822122930--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Gabriele Sgroi, PhD" class="l ep by dd de cx" src="../Images/b81978d35e6238d160457de2affc2b0e.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*AcU2TE5e6GUmSp2zdGIe9A.jpeg"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--005822122930--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://medium.com/@gabrielesgroi94?source=post_page---byline--005822122930--------------------------------" rel="noopener follow">Gabriele Sgroi, PhD</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--005822122930--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">61 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div>4 days ago</div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk ld le ab q ee lf lg" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lc"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lb lc">7</span></p></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lh k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al li an ao ap ie lj lk ll" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lm cn"><div class="l ae"><div class="ab cb"><div class="ln lo lp lq lr ls ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml mm"><img src="../Images/1ff9aca5ba93aaf9ae77e0a74be9e734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sSWqObO_mSEhQii3"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Photo by <a class="af nd" href="https://unsplash.com/@jaredd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jaredd Craig</a> on <a class="af nd" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bdcd" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Large Language Models have shown impressive capabilities and they are still undergoing steady improvements with each new generation of models released. Applications such as chatbots and summarisation can directly exploit the language proficiency of LLMs as they are only required to produce textual outputs, which is their natural setting. Large Language Models have also shown impressive abilities to understand and solve complex tasks, but as long as their solution stays “on paper”, i.e. in pure textual form, they need an external user to act on their behalf and report back the results of the proposed actions. Agent systems solve this problem by letting the models act on their environment, usually via a set of tools that can perform specific operations. In this way, an LLM can find solutions iteratively by trial and error while interacting with the environment.</p><p id="8968" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">An interesting situation is when the tools that an LLM agent has access to are agents themselves: this is the core concept of multi-agentic systems. A multi-agentic system solves tasks by distributing and delegating duties to specialized models and putting their output together like puzzle pieces. A common way to implement such systems is by using a manager agent to orchestrate and coordinate other agents' workflow.</p><p id="8470" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Agentic systems, and in particular multi-agentic systems, require a powerful LLM as a backbone to perform properly, as the underlying model needs to be able to understand the purpose and applicability of the various tools as well as break up the original problem into sub-problems that can be tackled by each tool. For this reason, proprietary models like ChatGpt or Anthropic’s Claude are generally the default go-to solution for agentic systems. Fortunately, open-source LLMs have continued to see huge improvements in performance so much so that some of them now rival proprietary models in some instances. Even more interestingly, modestly-sized open LLMs can now perform complex tasks that were unthinkable a couple of years ago.</p><p id="863f" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">In this blog post, I will show how a “small” LLM that can run on consumer hardware is capable enough to power a multi-agentic system with good results. In particular, I will give a tutorial on how you can use <em class="oa">Qwen2.5–7B-Instruct</em> to create a multi-agentic RAG system. You can find the code implementation in the following <a class="af nd" href="https://github.com/GabrieleSgroi/multiagentic_rag" rel="noopener ugc nofollow" target="_blank">GitHub repo</a> and an illustrative <a class="af nd" href="https://colab.research.google.com/drive/1ZxF-Fkv4QV31uo79FagZWFm8tvXgCtBN" rel="noopener ugc nofollow" target="_blank">Colab notebook</a>.</p><p id="f17b" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Before diving into the details of the system architecture, I will recall some basic notions regarding LLM agents that will be useful to better understand the framework.</p><h1 id="489c" class="ob oc fq bf od oe of gq og oh oi gt oj ok ol om on oo op oq or os ot ou ov ow bk">ReAct</h1><p id="6ca8" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">ReAct, proposed in <a class="af nd" href="https://arxiv.org/abs/2210.03629" rel="noopener ugc nofollow" target="_blank">ReAct: Synergizing Reasoning and Acting in Language Models</a>, is a popular framework for building LLM agents. The main idea of the method is to incorporate the effectiveness of Chain of Thought prompting into an agent framework. ReACT consists of interleaved reasoning and action steps: the Large Language Model is prompted to provide a thought sequence before emitting an action. In this way the model can create dynamic reasoning traces to steer actions and update the high-level plan while incorporating information coming from the interaction with the environment. This allows for an iterative and incremental approach to solving the given task. In practice, the workflow of a ReAct agent is made up of Thought, Action, and Observation sequences: the model produces reasoning for a general plan and specific tool usage in the Thought step, then invokes the relevant tool in the Action step, and finally receives feedback from the environment in the Observation.</p><p id="e1bb" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Below is an example of what the ReACT framework looks like.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml pc"><img src="../Images/bb48e73b9eeef9ce664171f66c3b531d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NFsK71vUuWRDHk8pVzoO7w.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Comparison between the ReACT, Chain-of-Thought, and Act-Only frameworks for a Question Answering task. Image from <a class="af nd" href="https://arxiv.org/abs/2210.03629" rel="noopener ugc nofollow" target="_blank">ReAct: Synergizing Reasoning and Acting in Language Models</a>.</figcaption></figure><h1 id="27b0" class="ob oc fq bf od oe of gq og oh oi gt oj ok ol om on oo op oq or os ot ou ov ow bk">Code Agents</h1><p id="1f70" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">Code agents are a particular type of LLM agents that use executable Python code to interact with the environment. They are based on the CodeAct framework proposed in the paper <a class="af nd" href="https://arxiv.org/abs/2402.01030" rel="noopener ugc nofollow" target="_blank">Executable Code Actions Elicit Better LLM Agents</a>. CodeAct is very similar to the ReAct framework, with the difference that each action consists of arbitrary executable code that can perform multiple operations. Hand-crafted tools are provided to the agent as regular Python functions that it can call in the code.</p><p id="1f0d" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Code agents come with a unique set of advantages over more traditional agents using JSON or other text formats to perform actions:</p><ul class=""><li id="0d7a" class="ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz pd pe pf bk">They can leverage existing software packages in combination with hand-crafted task-specific tools.</li><li id="af0b" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">They can self-debug the generated code by using the error messages returned after an error is raised.</li><li id="ceee" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">LLMs are familiar with writing code as it is generally widely present in their pre-training data, making it a more natural format to write their actions.</li><li id="57b0" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">Code naturally allows for the storage of intermediate results and the composition of multiple operations in a single action, while JSON or other text formats may need multiple actions to accomplish the same.</li></ul><p id="adf9" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">For these reasons, Code Agents can offer improved performance and faster execution speed than agents using JSON or other text formats to execute actions.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml pl"><img src="../Images/a67f4047cd5299419a6fe7f81077f750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZzWirW98Q2ombiqR_6v_g.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Comparison between code agents and agents using JSON or text as actions. Image from <a class="af nd" href="https://arxiv.org/abs/2402.01030" rel="noopener ugc nofollow" target="_blank">Executable Code Actions Elicit Better LLM Agents</a>.</figcaption></figure><p id="0751" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Below is a concrete example from the original paper that showcases how code agents can require fewer actions to solve certain tasks.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml pm"><img src="../Images/0a96c18b5be55a21b4f23952aefcad2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gbQ6buh6LoNmWXLtpxn5g.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Code agents vs agents using JSON/text action format. Code agents can execute multiple operations in one action. Image from <a class="af nd" href="https://arxiv.org/abs/2402.01030" rel="noopener ugc nofollow" target="_blank">Executable Code Actions Elicit Better LLM Agents</a>. [RIVEDERE]</figcaption></figure><p id="5192" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The Hugging Face transformers library provides useful modules to build agents and, in particular, code agents. The Hugging Face transformer agents framework focuses on clarity and modularity as core design principles. These are particularly important when building an agent system: the complexity of the workflow makes it essential to have control over all the interconnected parts of the architecture. These design choices make Hugging Face agents a great tool for building custom and flexible agent systems. When using open-source models to power the agent engine, the Hugging Face agents framework has the further advantage of allowing easy access to the models and utilities present in the Hugging Face ecosystem.</p><p id="a609" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Hugging Face code agents also tackle the issue of insecure code execution. In fact, letting an LLM generate code unrestrained can pose serious risks as it could perform undesired actions. For example, a hallucination could cause the agent to erase important files. In order to mitigate this risk, Hugging Face code agents implementation uses a ground-up approach to secure code execution: the code interpreter can only execute explicitly authorized operations. This is in contrast to the usual top-down paradigm that starts with a fully functional Python interpreter and then forbids actions that may be dangerous. The Hugging Face implementation includes a list of safe, authorized functions that can be executed and provides a list of safe modules that can be imported. Anything else is not executable unless it has been preemptively authorized by the user. You can read more about Hugging Face (code) agents in their blog posts:</p><ul class=""><li id="cdf1" class="ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz pd pe pf bk"><a class="af nd" href="https://huggingface.co/blog/agents" rel="noopener ugc nofollow" target="_blank">License to Call: Introducing Transformers Agents 2.0</a></li><li id="5d44" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk"><a class="af nd" href="https://huggingface.co/blog/beating-gaia" rel="noopener ugc nofollow" target="_blank">Our Transformers Code Agent beats the GAIA benchmark!</a></li></ul><h1 id="6fc2" class="ob oc fq bf od oe of gq og oh oi gt oj ok ol om on oo op oq or os ot ou ov ow bk">Agentic RAG</h1><p id="13d7" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">Retrieval Augmented Generation has become the de facto standard for information retrieval tasks involving Large Language Models. It can help keep the LLM information up to date, give access to specific information, and reduce hallucinations. It can also enhance human interpretability and supervision by returning the sources the model used to generate its answer. The usual RAG workflow, consisting of a retrieval process based on semantic similarity to a user’s query and a model’s context enhancement with the retrieved information, is not adequate to solve some specific tasks. Some situations that are not suited for traditional RAG include tasks that need interactions with the information sources, queries needing multiple pieces of information to be answered, and complex queries requiring non-trivial manipulation to be connected with the actual information contained in the sources.</p><p id="9ea4" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">A concrete challenging example for traditional RAG systems is multi-hop question answering (MHQA). It involves extracting and combining multiple pieces of information, possibly requiring several iterative reasoning processes over the extracted information and what is still missing. For instance, if the model has been asked the question “Does birch plywood float in ethanol?”, even if the sources used for RAG contained information about the density of both materials, the standard RAG framework could fail if these two pieces of information are not directly linked.</p><p id="5a0c" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">A popular way to enhance RAG to avoid the abovementioned shortcomings is to use agentic systems. An LLM agent can break down the original query into a series of sub-queries and then use semantic search as a tool to retrieve passages for these generated sub-queries, changing and adjusting its plan as more information is collected. It can autonomously decide whether it has collected enough information to answer each query or if it should continue the search. The agentic RAG framework can be further enhanced by extending it to a multi-agentic system in which each agent has its own defined tasks and duties. This allows, for example, the separation between the high-level task planning and the interaction with the document sources. In the next section, I will describe a practical implementation of such a system.</p><h1 id="96d6" class="ob oc fq bf od oe of gq og oh oi gt oj ok ol om on oo op oq or os ot ou ov ow bk">Multi-Agentic RAG with Code Agents</h1><p id="05cf" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">In this section, I will discuss the general architectural choices I used to implement a Multi-Agentic RAG system based on code agents following the ReAct framework. You can find the remaining details in the full code implementation in the following <a class="af nd" href="https://github.com/GabrieleSgroi/multiagentic_rag" rel="noopener ugc nofollow" target="_blank">GitHub repo</a>.</p><p id="cea1" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The goal of the multi-agentic system is to answer a question by searching the necessary information on Wikipedia. It is made up of 3 agents:</p><ul class=""><li id="b837" class="ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz pd pe pf bk">A manager agent whose job is to break down the task into sub-tasks and use their output to provide a final answer.</li><li id="df30" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">A Wikipedia search agent that finds relevant pages on Wikipedia and combines the information extracted from them.</li><li id="0b3c" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">A page search agent to retrieve and summarize information relevant to a given query from the provided Wikipedia page.</li></ul><p id="e9a3" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">These three agents are organized in a hierarchical fashion: each agent can use the agent immediately below in the hierarchy as a tool. In particular, the manager agent can call the Wikipedia search agent to find information about a query which, in turn, can use the page search agent to extract particular information from Wikipedia pages.</p><p id="44b9" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Below is the diagram of the architecture, specifying which hand-crafted tools (including tools wrapping other agents) each agent can call. Notice that since code agents act using code execution, these are not actually the only tools they can use as any native Python operation and function (as long as it is authorized) can be used as well.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div class="mk ml pn"><img src="../Images/54e5a02732eb01048ba8b64cc5648fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*WGgj_jqs8hYrxwmELL05dQ.png"/></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Architecture diagram showing agents and hand-crafted tools. Image by the author.</figcaption></figure><p id="7f1c" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Let’s dive into the details of the workings of the agents involved in the architecture.</p><h2 id="7824" class="po oc fq bf od pp pq pr og ps pt pu oj nn pv pw px nr py pz qa nv qb qc qd qe bk">Manager agent</h2><p id="a883" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">This is the top-level agent, it receives the user’s question and it is tasked to return an answer. It can use the Wikipedia search agent as a tool by prompting it with a query and receiving the final results of the search. Its purpose is to collect the necessary pieces of information from Wikipedia by dividing the user question into a series of sub-queries and putting together the result of the search.</p><p id="5916" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Below is the system prompt used for this agent. It is built upon the default Hugging Face default prompt template. Notice that the examples provided in the prompt follow the chat template of the model powering the agent, in this case, <em class="oa">Qwen2.5–7B-Instruct.</em></p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="2f96" class="qj oc fq qg b bg qk ql l qm qn">You are an expert assistant who can find answer on the internet using code blobs and tools. To do so, you have been given access to a list of tools: these tools are basically Python functions which you can call with code.<br/>You will be given the task of answering a user question and you should answer it by retrieving the necessary information from Wikipedia. Use and trust only the information you retrieved, don't make up false facts.<br/>To help you, you have been given access to a search agent you can use as a tool. You can use the search agent to find information on Wikipedia. Break down the task into smaller sub-tasks and use the search agent to find the necessary information for each sub-task.<br/>To solve the task, you must plan forward to proceed in a series of steps, in a cycle of 'Thought:', 'Code:', and 'Observation:' sequences.<br/>At each step, in the 'Thought:' sequence, you should first explain your reasoning towards solving the task and the tools that you want to use.<br/>Then in the 'Code:' sequence, you should write the code in simple Python. The code sequence must end with '&lt;end_action&gt;' sequence.<br/>During each intermediate step, you can use 'print()' to save whatever important information you will then need. These print outputs will be provided back to you by the user in the 'Observation:' field, which will be available as input for the next steps. Always print the output of tools, don't process it or try to extract information before inspecting it.<br/>If an error rise while executing the code, it will be shown in the 'Observation:' field. In that case, fix the code and try again.<br/><br/>In the end you have to return a final answer using the `final_answer` tool.<br/><br/>Here are a few notional examples:<br/>---<br/>&lt;|im_start|&gt;user<br/>Task: When was the capital of Italy founded?&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: Let's break up the task: I first need to find the capital of Italy and then look at its foundation date. I will use the tool `wikipedia_search_agent` to get the capital of Italy. Code:<br/>```py<br/>result = wikipedia_search_agent("Italy capital")<br/>print("Capital of Italy:", result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 0] -&gt; Observation:<br/>Capital of Italy:According to the information extracted from the Wikipedia page 'Rome', the capital of Italy is Rome.&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: Now that I know that the capital of Italy is Rome, I can use the `wikipedia_search_agent` tool to look for its foundation date.<br/>Code:<br/>```py<br/>result = wikipedia_search_agent("Rome foundation date")<br/>print("Rome foundation:", result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 1] -&gt; Observation:<br/>Rome foundation: According to the information from the Wikipedia page 'Natale di Roma', the traditional foundation date of Rome is April 21, 753 BC.&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: Now that I have retrieved the relevant information, I can use the `final_answer` tool to return the answer.<br/>Code:<br/>```py<br/>final_answer("According to the legend Rome was founded on 21 April 753 BCE, but archaeological evidence dates back its development during the Bronze Age.")<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>---<br/>&lt;|im_start|&gt;user<br/>Task: "What's the difference in population between Shanghai and New York?"&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: I need to get the populations for both cities and compare them: I will use the tool `search_agent` to get the population of both cities.<br/>Code:<br/>```py<br/>population_guangzhou_info = wikipedia_search_agent("New York City population")<br/>population_shanghai_info = wikipedia_search_agent("Shanghai population")<br/>print("Population Guangzhou:", population_guangzhou)<br/>print("Population Shanghai:", population_shanghai)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 0] -&gt; Observation:<br/>Population Guangzhou: The population of New York City is approximately 8,258,035 as of 2023.<br/>Population Shanghai: According to the information extracted from the Wikipedia page 'Shanghai', the population of the city proper is around 24.87 million inhabitants in 2023.&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: Now I know both the population of Shanghai (24.87 million) and of New York City (8.25 million), I will calculate the difference and return the result.<br/>Code:<br/>```py<br/>population_difference = 24.87*1e6 - 8.25*1e6<br/>answer=f"The difference in population between Shanghai and New York is {population_difference} inhabitants."<br/>final_answer(answer)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>---<br/><br/>On top of performing computations in the Python code snippets that you create, you have access to those tools (and no other tool):<br/><br/>&lt;&lt;tool_descriptions&gt;&gt;<br/><br/>&lt;&lt;managed_agents_descriptions&gt;&gt;<br/><br/>You can use imports in your code, but exclusively from the following list of modules: &lt;&lt;authorized_imports&gt;&gt;.  Do not try to import other modules or else you will get an error.<br/>Now start and solve the task!</span></pre><h2 id="d163" class="po oc fq bf od pp pq pr og ps pt pu oj nn pv pw px nr py pz qa nv qb qc qd qe bk">Wikipedia search agent</h2><p id="ac2c" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">This agent reports to the manager agent, it receives a query from it and it is tasked to return the information it has retrieved from Wikipedia. It can access two tools:</p><ul class=""><li id="0c6c" class="ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz pd pe pf bk">A Wikipedia search tool, using the built-in search function from the <a class="af nd" href="https://pypi.org/project/wikipedia/" rel="noopener ugc nofollow" target="_blank">wikipedia package</a>. It receives a query as input and returns a list of Wikipedia pages and their summaries.</li><li id="6f5a" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">A page search agent that retrieves information about a query from a specific Wikipedia page.</li></ul><p id="c9cf" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">This agent collects the information to answer the query, dividing it into further sub-queries, and combining information from multiple pages if needed. This is accomplished by using the search tool of the wikipedia package to identify potential pages that can contain the necessary information to answer the query: the agent can either use the reported page summaries or call the page search agent to extract more information from a specific page. After enough data has been collected, it returns an answer to the manager agent.</p><p id="b988" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The system prompt is again a slight modification of the Hugging Face default prompt with some specific examples following the model’s chat template.</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="7aa5" class="qj oc fq qg b bg qk ql l qm qn">You are an expert assistant that retrieves information from Wikipedia using code blobs and tools. To do so, you have been given access to a list of tools: these tools are basically Python functions which you can call with code.<br/>You will be given a general query, your task will be of retrieving and summarising information that is relevant to the query from multiple passages retrieved from the given Wikipedia page. Use and trust only the information you retrieved, don't make up false facts. Try to summarize the information in a few sentences.<br/>To solve the task, you must plan forward to proceed in a series of steps, in a cycle of 'Thought:', 'Code:', and 'Observation:' sequences.<br/>At each step, in the 'Thought:' sequence, you should first explain your reasoning towards solving the task and the tools that you want to use.<br/>Then in the 'Code:' sequence, you should write the code in simple Python. The code sequence must end with '&lt;end_action&gt;' sequence.<br/>During each intermediate step, you can use 'print()' to save whatever important information you will then need. These print outputs will be provided back to you by the user in the 'Observation:' field, which will be available as input for the next steps. Always print the output of tools, don't process it or try to extract information before inspecting it.<br/>If an error rise while executing the code, it will be shown in the 'Observation:' field. In that case, fix the code and try again.<br/><br/>In the end you have to return a final answer using the `final_answer` tool.<br/><br/>Here are a few notional examples:<br/>---<br/>&lt;|im_start|&gt;user<br/>Task: Retrieve information about the query:"What's the capital of France?" from the Wikipedia page "France".&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: I need to find the capital of France. I will use the tool `retrieve_passages` to get the capital of France from the Wikipedia page.<br/>Code:<br/>```py<br/>result = retrieve_passages("France capital")<br/>print("Capital of France:", result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 0] -&gt; Observation:<br/>Retrieved passages for query "France capital":<br/>Passage 0: ... population of nearly 68.4 million as of January 2024. France is a semi-presidential republic with its capital in Paris, the ...<br/>Passage 1: ... France, officially the French Republic, is a country located primarily in Western Europe. Its overseas regions and territories ...<br/>Passage 2: ... The vast majority of France's territory and population is situated in Western Europe and is called Metropolitan France. It is ...<br/>Passage 3: ... France is a highly urbanised country, with its largest cities (in terms of metropolitan area population in 2021) being Paris ...<br/>Passage 4: ... === Government ===\nFrance.fr – official French tourism site (in English)...&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: Now that I know that the capital of France is Paris, I can use the `final_answer` tool to return the answer.<br/>Code:<br/>```py<br/>final_answer("The capital of France is Paris.")<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>---<br/>&lt;|im_start|&gt;user<br/>Task: Retrieve information about the query:"Tallest mountain in the World" from the Wikipedia page "List of highest mountains on Earth"&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: I need to find the tallest mountain in the world. I will use the tool `retrieve_passages` to look for data on the Wikipedia page.<br/>Code:<br/>```py<br/>result = retrieve_passages("highest mountain")<br/>print(result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 1] -&gt; Observation:<br/>Retrieved passages for query "highest mountain":<br/>Passage 0: ... above sea level) is the world's tallest mountain and volcano, rising about 10,203 m (33,474 ft) from the Pacific Ocean floor. ...<br/>Passage 1: ... As of December 2018, the highest peaks on four of the mountains—Gangkhar Puensum, Labuche Kang III, Karjiang, and Tongshanjiabu, all located in Bhutan or China—have not been ascended. ...<br/>Passage 2: ... The highest mountains above sea level are generally not the highest above the surrounding terrain. ...<br/>Passage 3: ... The highest mountain outside of Asia is Aconcagua (6,961 m or 22,838 ft), the 189th highest in the world. ...<br/>Passage 4: ... the southern summit of Peru's tallest mountain, Huascarán, is another contender. Both have elevations above sea level more than 2 km (1.2 mi) less than that of Everest....<br/>&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: The results don't clearly specify a clear result for the world's tallest mountain, I will use the tool `web_results` with a different query.<br/>Code:<br/>```py<br/>result = retrieve_passages("world's tallest mountain")<br/>print(result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>Passages retrieved from page List of highest mountains on Earth:<br/>Passage 0: ... The highest mountain outside of Asia is Aconcagua (6,961 m or 22,838 ft), the 189th highest in the world....<br/>Passage 1: ... above sea level) is the world's tallest mountain and volcano, rising about 10,203 m (33,474 ft) from the Pacific Ocean floor. ...<br/>Passage 2: ... The bases of mountain islands are below sea level, and given this consideration Mauna Kea (4,207 m (13,802 ft) above sea level) is the world's tallest mountain and volcano, rising about 10,203 m (33,474 ft) from the Pacific Ocean floor. ...<br/>Passage 3: ... the southern summit of Peru's tallest mountain, Huascarán, is another contender. Both have elevations above sea level more than 2 km (1.2 mi) less than that of Everest. ...<br/>Passage 4: ... The highest mountains are also not generally the most voluminous. Mauna Loa (4,169 m or 13,678 ft) is the largest mountain on Earth in terms of base area (about 5,200 km2 or 2,000 sq mi) and volume (about 42,000 km3 or 10,000 cu mi)...&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: I have found that Mauna Kea is the world's tallest mountain rising about 10,203 m (33,474 ft) from the Pacific Ocean floor. I can use the `final_answer` tool to return the relevant information.<br/>Code:<br/>```py<br/>final_answer("Mauna Kea is the world's tallest mountain, rising about 10,203 m (33,474 ft) from the Pacific Ocean floor.")<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>___<br/>On top of performing computations in the Python code snippets that you create, you have access to those tools (and no other tool):<br/><br/>&lt;&lt;tool_descriptions&gt;&gt;<br/><br/>&lt;&lt;managed_agents_descriptions&gt;&gt;<br/><br/>You can use imports in your code, but only from the following list of modules: &lt;&lt;authorized_imports&gt;&gt;. Do not try to import other modules or else you will get an error.<br/>Now start and solve the task!</span></pre><h2 id="ebdd" class="po oc fq bf od pp pq pr og ps pt pu oj nn pv pw px nr py pz qa nv qb qc qd qe bk">Page search agent</h2><p id="62c5" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">This agent reports to the Wikipedia search agent, which provides it with a query and the title of a Wikipedia page, and it is tasked to retrieve the relevant information to answer the query from that page. This is, in essence, a single-agent RAG system. To perform the task, this agent generates custom queries and uses the semantic search tool to retrieve the passages that are more similar to them. The semantic search tool follows a simple implementation that splits the page contents into chunks and embeds them using the FAISS vector database provided by LangChain.</p><p id="f942" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Below is the system prompt, still built upon the one provided by default by Hugging Face</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="ec2f" class="qj oc fq qg b bg qk ql l qm qn">You are an expert assistant that finds answers to questions by consulting Wikipedia, using code blobs and tools. To do so, you have been given access to a list of tools: these tools are basically Python functions which you can call with code.<br/>You will be given a general query, your task will be of finding an answer to the query using the information you retrieve from Wikipedia. Use and trust only the information you retrieved, don't make up false facts. Cite the page where you found the information.<br/>You can search for pages and their summaries from Wikipedia using the `search_wikipedia` tool and look for specific passages from a page using the `search_info` tool. You should decide how to use these tools to find an appropriate answer:some queries can be answered by looking at one page summary, others can require looking at specific passages from multiple pages.<br/>To solve the task, you must plan forward to proceed in a series of steps, in a cycle of 'Thought:', 'Code:', and 'Observation:' sequences.<br/>At each step, in the 'Thought:' sequence, you should first explain your reasoning towards solving the task and the tools that you want to use.<br/>Then in the 'Code:' sequence, you should write the code in simple Python. The code sequence must end with '&lt;end_action&gt;' sequence.<br/>During each intermediate step, you can use 'print()' to save whatever important information you will then need. These print outputs will be provided back to you by the user in the 'Observation:' field, which will be available as input for the next steps. Always print the output of tools, don't process it or try to extract information before inspecting it.<br/>If an error rise while executing the code, it will be shown in the 'Observation:' field. In that case, fix the code and try again.<br/><br/>In the end you have to return a final answer using the `final_answer` tool.<br/><br/>Here are a few notional examples:<br/>---<br/>&lt;|im_start|&gt;user<br/>Task: When was the ancient philosopher Seneca born?&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: I will use the tool `search_wikipedia` to search for Seneca's birth on Wikipedia. I will specify I am looking for the philosopher for disambiguation.<br/>Code:<br/>```py<br/>result = search_wikipedia("Seneca philosopher birth")<br/>print("result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 0] -&gt; Observation:<br/>Pages found for query 'Seneca philosopher birth':<br/>Page: Seneca the Younger<br/>Summary: Lucius Annaeus Seneca the Younger ( SEN-ik-ə; c.4 BC – AD 65), usually known mononymously as Seneca, was a Stoic philosopher of Ancient Rome, a statesman, dramatist, and in one work, satirist, from the post-Augustan age of Latin literature.<br/>Seneca was born in Colonia Patricia Corduba in Hispania, a<br/>Page: Phaedra (Seneca)<br/>Summary: Phaedra is a Roman tragedy written by philosopher and dramatist Lucius Annaeus Seneca before 54 A.D. Its 1,280 lines of verse tell the story of Phaedra, wife of King Theseus of Athens and her consuming lust for her stepson Hippolytus. Based on Greek mythology and the tragedy Hippolytus by Euripides,<br/>Page: Seneca the Elder<br/>Summary: Lucius Annaeus Seneca the Elder ( SEN-ik-ə; c.54 BC – c. AD 39), also known as Seneca the Rhetorician, was a Roman writer, born of a wealthy equestrian family of Corduba, Hispania. He wrote a collection of reminiscences about the Roman schools of rhetoric, six books of which are extant in a more or<br/>Page: AD 1<br/>Summary: AD 1 (I) or 1 CE was a common year starting on Saturday or Sunday, a common year starting on Saturday by the proleptic Julian calendar, and a common year starting on Monday by the proleptic Gregorian calendar. It is the epoch year for the Anno Domini (AD) Christian calendar era, and the 1st year of<br/>Page: Seneca Falls Convention<br/>Summary: The Seneca Falls Convention was the first women's rights convention. It advertised itself as "a convention to discuss the social, civil, and religious condition and rights of woman". Held in the Wesleyan Chapel of the town of Seneca Falls, New York, it spanned two days over July 19–20, 1848.  Attrac<br/>&lt;|im_start|&gt;assistant<br/>Thought: From the summary of the page "", I can see that Seneca was born in . I can use the `final_answer` tool to return the answer.<br/>Code:<br/>```py<br/>final_answer("According to the Wikipedia page 'Seneca the Younger', Seneca was born in 4 BC.")<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>---<br/>&lt;|im_start|&gt;user<br/>Task: Who was Charlemagne predecessor?&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: I will use the tool `search_wikipedia` to search for Charlemagne reign duration.<br/>Code:<br/>```py<br/>result = search_wikipedia("Charlemagne predecessor")<br/>print(result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 0] -&gt; Observation:<br/>Pages found for query 'Charlemagne predecessor':<br/>Page: Charlemagne<br/>Summary: Charlemagne ( SHAR-lə-mayn; 2 April 748 – 28 January 814) was King of the Franks from 768, King of the Lombards from 774, and Emperor of what is now known as the Carolingian Empire from 800, holding these titles until his death in 814. He united most of Western and Central Europe, and was the first<br/>Page: Pope Leo III<br/>Summary: Pope Leo III (Latin: Leo III; died 12 June 816) was bishop of Rome and ruler of the Papal States from 26 December 795 to his death. Protected by Charlemagne from the supporters of his predecessor, Adrian I, Leo subsequently strengthened Charlemagne's position by crowning him emperor. The coronation<br/>Page: Throne of Charlemagne<br/>Summary: The Throne of Charlemagne (German: Karlsthron or Aachener Königsthron, "Royal Throne of Aachen") is a throne erected in the 790s by Charlemagne, as one of the fittings of his palatine chapel in Aachen (today's Aachen Cathedral) and placed in the Octagon of the church. Until 1531, it served as the co<br/>Page: Louis the Pious<br/>Summary: Louis the Pious (Latin: Hludowicus Pius; French: Louis le Pieux; German: Ludwig der Fromme; 16 April 778 – 20 June 840), also called the Fair and the Debonaire, was King of the Franks and co-emperor with his father, Charlemagne, from 813. He was also King of Aquitaine from 781. As the only surviving<br/>Page: Holy Roman Emperor<br/>Summary: The Holy Roman Emperor, originally and officially the Emperor of the Romans (Latin: Imperator Romanorum; German: Kaiser der Römer) during the Middle Ages, and also known as the Romano-German Emperor since the early modern period (Latin: Imperator Germanorum; German: Römisch-deutscher Kaiser, lit. 'R<br/>&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: The results don't contain explicit information about Charlemagne predecessor, I will search for more information on the page 'Charlemagne' using the 'search_info' tool.<br/>Code:<br/>```py<br/>result = search_info("Charlemagne predecessor", "Charlemagne")<br/>print(result)<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;user<br/>[OUTPUT OF STEP 1] -&gt; Observation:<br/>Information retrieved from the page 'Charlemagne' for the query 'Charlemagne predecessor':<br/>Charlemagne's predecessor was Pepin the Short.<br/>&lt;|im_end|&gt;<br/>&lt;|im_start|&gt;assistant<br/>Thought: I have found that, according to the Wikipedia page 'Charlemagne', Pepin the Short was Charlemagne predecessor. I will return the results using the `final_answer` tool.<br/>Code:<br/>```py<br/>final_answer("According to the information extracted from the Wikipedia page 'Charlemagne', his predecessor was Pepin the Short.")<br/>```&lt;end_action&gt;&lt;|im_end|&gt;<br/>___<br/>On top of performing computations in the Python code snippets that you create, you have access to those tools (and no other tool):<br/><br/>&lt;&lt;tool_descriptions&gt;&gt;<br/><br/>&lt;&lt;managed_agents_descriptions&gt;&gt;<br/><br/>You can use imports in your code, but only from the following list of modules: &lt;&lt;authorized_imports&gt;&gt;. Do not try to import other modules or else you will get an error.<br/>Now start and solve the task!</span></pre><h2 id="9a64" class="po oc fq bf od pp pq pr og ps pt pu oj nn pv pw px nr py pz qa nv qb qc qd qe bk">Implementation choices</h2><p id="d47d" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">In this subsection, I will outline the main points that differ from what could be a straightforward implementation of the architecture using Hugging Face agents. These are the results of limited trial and error before obtaining a solution that works reasonably well. I haven’t performed extensive testing and ablations so they may not be the optimal choices.</p><ul class=""><li id="9a10" class="ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz pd pe pf bk"><strong class="ng fr">Prompting: </strong>as explained in the previous sections, each agent has its own specialized system prompt that differs from the default one provided by Hugging Face Code Agents. I observed that, perhaps due to the limited size of the model used, the general standard system prompt was not giving good results. The model seems to work best with a system prompt that reflects closely the tasks it is asked to perform, including tailored examples of significant use cases. Since I used a chat model with the aim of improving instruction following behavior, the provided examples follow the model’s chat template to be as close as possible to the format encountered during a run.</li><li id="e94a" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk"><strong class="ng fr">Summarizing history:</strong> long execution histories have detrimental effects on both execution speed and task performance. The latter could be due to the limited ability of the model to retrieve the necessary information from a long context. Moreover, extremely long execution histories could exceed the maximum context length for the engine model. To mitigate these problems and speed up execution, I chose not to show all the details of the previous thought-action-observation steps, but instead collected only the previous observations. More specifically, at each step the model only receives the following chat history: the system message, the first message containing the task, its last action, and all the history of the previous observations. Furthermore, execution errors are present in the observation history only if they happen in the last step, previous errors that have been already solved are discarded.</li><li id="57e2" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk"><strong class="ng fr">Tools vs managed agents: </strong>Hugging Face agents implementation<strong class="ng fr"> </strong>has native support for managed agents but wrapping them as tools allows for better control of the prompts and a more streamlined implementation. In particular, Hugging Face implementation adds particular prompts to both the managed agents and their managers. While I haven’t seen substantial differences in the ability to solve the given task, I preferred the second approach as it is more flexible and streamlined for the presented architecture, and it allows for easier control over the agents' behavior. This also helps with reducing the prompt length, which is useful for speeding up computations.</li><li id="396e" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk"><strong class="ng fr">Limit the maximum number of trials for the page search agent: </strong>sometimes the page search agent keeps looking for information on a given page that doesn’t contain it. Reducing the maximum number of trials mitigated this issue: after reaching that number the agent execution is stopped and the tool returns the last observation from code execution.</li><li id="17d2" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk"><strong class="ng fr">Changing tool response to user message: </strong>this is more of a technical, implementation-specific point. Since the only supported roles for the chat template of <em class="oa">Qwen2.5–7B-Instruct</em> are system, user, and assistant, observations are returned as user messages.</li></ul><h1 id="19fe" class="ob oc fq bf od oe of gq og oh oi gt oj ok ol om on oo op oq or os ot ou ov ow bk">Examples</h1><p id="9e42" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">In this section, I will collect some examples produced with the described architecture. I will also provide the detailed execution of all the agents involved in the task to showcase how they interact in some real cases. You can explore more examples using the illustrative <a class="af nd" href="https://colab.research.google.com/drive/1ZxF-Fkv4QV31uo79FagZWFm8tvXgCtBN" rel="noopener ugc nofollow" target="_blank">Colab notebook</a>. All the extracted passages are taken from the Wikipedia page specified in the execution.</p><p id="0d8f" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Let’s start exploring a simple example that requires combining information from multiple sources and some basic arithmetic understanding.</p><p id="69d4" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk"><em class="oa">Task: How many years passed between the construction of the Eiffel Tower and the construction of the Empire State Building?</em></p><p id="b434" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Below are the logs of the execution of the manager agent. It can correctly break up the task into finding the construction periods for both buildings and compute the year difference.</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="47d2" class="qj oc fq qg b bg qk ql l qm qn">Agent:  Thought: First, I need to find out when the Eiffel Tower and the Empire State Building were constructed. I will use the `wikipedia_search_agent` tool to find this information.<br/>Code:<br/>```py<br/>wikipedia_search_agent(query="Eiffel Tower construction year")<br/>```&lt;end_action&gt;<br/>Observation:  Print outputs:<br/>Last output from code snippet:<br/>According to the information extracted from the Wikipedia page 'Eiffel Tower', the construction of the Eiffel Tower took place from 1887 to 1889.<br/>Agent:  Thought: Now I have the construction period of the Eiffel Tower. Next, I need to find the construction period of the Empire State Building. I will use the `wikipedia_search_agent` tool again.<br/>Code:<br/>```py<br/>wikipedia_search_agent(query="Empire State Building construction year")<br/>```&lt;end_action&gt;<br/>Observation:  Print outputs:<br/>Last output from code snippet:<br/>According to the information extracted from the Wikipedia page 'Empire State Building', the construction of the Empire State Building started in 1930 and ended in 1931.<br/>Agent:  Thought: Now I have the construction periods for both the Eiffel Tower and the Empire State Building. I can now calculate the number of years between their constructions. <br/>Code:<br/>```py<br/>construction_eiffel_tower_start = 1887<br/>construction_eiffel_tower_end = 1889<br/>construction_empire_state_building_start = 1930<br/>construction_empire_state_building_end = 1931<br/><br/>years_passed = construction_empire_state_building_start - construction_eiffel_tower_end<br/>answer = f"The number of years passed between the construction of the Eiffel Tower and the Empire State Building is {years_passed} years."<br/>final_answer(answer)<br/>```&lt;end_action&gt;<br/>Observation:  Print outputs:<br/>Last output from code snippet:<br/>The number of years passed between the construction of the Eiffel Tower and the Empire State Building is 41 years.</span></pre><p id="7c19" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Let’s now visualize the execution of the Wikipedia search agent. It correctly searches and reports the construction periods found in the summary of the pages, without needing to inspect the individual pages. It is interesting to note that despite being asked generically about the “construction year”, it reports the entire construction period as it is not clear if the year refers to the start or the end of the construction works.</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="6025" class="qj oc fq qg b bg qk ql l qm qn">TASK:  Eiffel Tower construction year<br/>AGENT:  Thought: I will use the `search_wikipedia` tool to find information about the Eiffel Tower construction year.<br/>Code:<br/>```py<br/>search_wikipedia('Eiffel Tower construction year')<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Pages found for query 'Eiffel Tower construction year':<br/>Page: Eiffel Tower<br/>Summary: The Eiffel Tower (  EYE-fəl; French: Tour Eiffel [tuʁ ɛfɛl] ) is a wrought-iron lattice tower on the Champ de Mars in Paris, France. It is named after the engineer Gustave Eiffel, whose company designed and built the tower from 1887 to 1889.<br/>Locally nicknamed "La dame de fer" (French for "Iron Lady"), it was constructed as the centerpiece of the 1889 World's Fair, and to crown the centennial anniversary of the French Revolution. Although initially criticised by some of France's leading artists and intellectuals for its design, it has since become a global cultural icon of France and one of the most recognisable structures in the world. The tower received 5,889,000 visitors in 2022. The Eiffel Tower is the most visited monument with an entrance fee in the world: 6.91 million people ascended it in 2015. It was designated a monument historique in 1964, and was named part of a UNESCO World Heritage Site ("Paris, Banks of the Seine") in 1991.<br/>The tower is 330 metres (1,083 ft) tall, about t<br/>Page: Eiffel Tower (Paris, Texas)<br/>Summary: Texas's Eiffel Tower is a landmark in the city of Paris, Texas. The tower was constructed in 1993. It is a scale model of the Eiffel Tower in Paris, France; at 65 feet in height, it is roughly one-sixteenth of the height of the original. <br/><br/><br/>Page: Gustave Eiffel<br/>Summary: Alexandre Gustave Eiffel (  EYE-fəl, French: [alɛksɑ̃dʁ ɡystav ɛfɛl]; né Bonickhausen dit Eiffel; 15 December 1832 – 27 December 1923) was a French civil engineer. A graduate of École Centrale des Arts et Manufactures, he made his name with various bridges for the French railway network, most famously the Garabit Viaduct. He is best known for the world-famous Eiffel Tower, designed by his company and built for the 1889 Universal Exposition in Paris, and his contribution to building the Statue of Liberty in New York. After his retirement from engineering, Eiffel focused on research into meteorology and aerodynamics, making significant contributions in both fields.<br/>Page: Watkin's Tower<br/>Summary: Watkin's Tower was a partially completed iron lattice tower in Wembley Park, London, England. Its construction was an ambitious project to create a 358-metre (1,175 ft)-high visitor attraction in Wembley Park to the north of the city, led by the railway entrepreneur Sir Edward Watkin. Marketed as the "Great Tower of London", it was designed to surpass the height of the Eiffel Tower in Paris, and it was part of Wembley Park's emergence as a recreational place. The tower was never completed and it was demolished in 1907. The site of the tower is now occupied by the English national football ground, Wembley Stadium.<br/>Page: Eiffel Tower (Paris, Tennessee)<br/>Summary: The Eiffel Tower is a landmark in the city of Paris, Tennessee. It is a 1:20 scale replica of the original located in Paris, France.<br/><br/>AGENT:  Thought: From the summary of the page 'Eiffel Tower', I can see that the construction of the Eiffel Tower took place from 1887 to 1889. I will use the `final_answer` tool to return the answer.<br/>Code:<br/>```py<br/>final_answer("According to the information extracted from the Wikipedia page 'Eiffel Tower', the construction of the Eiffel Tower took place from 1887 to 1889.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>According to the information extracted from the Wikipedia page 'Eiffel Tower', the construction of the Eiffel Tower took place from 1887 to 1889.<br/>------------------------------<br/>TASK:  Empire State Building construction year<br/>AGENT:  Thought: I will use the `search_wikipedia` tool to find information about the construction year of the Empire State Building.<br/>Code:<br/>```py<br/>search_wikipedia('Empire State Building construction year')<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Pages found for query 'Empire State Building construction year':<br/>Page: Empire State Building<br/>Summary: The Empire State Building is a 102-story Art Deco skyscraper in the Midtown South neighborhood of Manhattan in New York City. The building was designed by Shreve, Lamb &amp; Harmon and built from 1930 to 1931. Its name is derived from "Empire State", the nickname of the state of New York. The building has a roof height of 1,250 feet (380 m) and stands a total of 1,454 feet (443.2 m) tall, including its antenna. The Empire State Building was the world's tallest building until the first tower of the World Trade Center was topped out in 1970; following the September 11 attacks in 2001, the Empire State Building was New York City's tallest building until it was surpassed in 2012 by One World Trade Center. As of 2024, the building is the seventh-tallest building in New York City, the ninth-tallest completed skyscraper in the United States, and the 57th-tallest completed skyscraper in the world.<br/>The site of the Empire State Building, on the west side of Fifth Avenue between West 33rd and 34th St<br/>Page: British Empire Building<br/>Summary: The British Empire Building, also known by its address 620 Fifth Avenue, is a commercial building at Rockefeller Center in the Midtown Manhattan neighborhood of New York City. Completed in 1933, the six-story structure was designed in the Art Deco style by Raymond Hood, Rockefeller Center's lead architect. The British Empire Building, along with the nearly identical La Maison Francaise to the south and the high-rise International Building to the north, comprise a group of retail-and-office structures known as the International Complex. La Maison Francaise and the British Empire Building are separated by Channel Gardens, a planted pedestrian esplanade running west to the complex's Lower Plaza.<br/>The facade is made of limestone, with a main entrance along Fifth Avenue and secondary entrances on 50th Street and Channel Gardens. The top of the British Empire Building contains setbacks, a rooftop garden, and a partial seventh-story penthouse. The building's entrances contain ornate decoration<br/>Page: 2012 Empire State Building shooting<br/>Summary: On August 24, 2012, a gunman shot and killed a former co-worker outside the Empire State Building in New York City. Following the initial shooting, the gunman, 58-year-old Jeffrey T. Johnson, was fatally shot by police officers after raising his weapon at them. Nine bystanders were wounded by stray bullets fired by the officers and ricocheting debris, but none suffered life-threatening injuries.<br/>Page: Empire State Building in popular culture<br/>Summary: The Empire State Building is a 102-story skyscraper on Fifth Avenue between West 33rd and 34th Streets in Midtown, Manhattan, New York City. It has a roof height of 1,250 feet (381 m), and with its antenna included, it stands a total of 1,454 feet (443.2 m) tall. The Empire State Building stood as the world's tallest building for nearly 40 years, from its completion in early 1931 until the topping out of the original World Trade Center's North Tower in late 1970. It has been featured in numerous films, TV shows, songs, video games, books, photographs, and artwork.<br/>Page: Empire State Plaza<br/>Summary: The Governor Nelson A. Rockefeller Empire State Plaza (known commonly as the Empire State Plaza, and also as the South Mall) is a complex of several state government buildings in downtown Albany, New York.<br/>The complex was built between 1965 and 1976 at an estimated total cost of $2 billion. It houses several departments of the New York State administration and is integrated with the New York State Capitol, completed in 1899, which houses the state legislature. Among the offices at the plaza are the Department of Health and the Biggs Laboratory of the Wadsworth Center. The Empire State Art Collection, a major public collection of 1960s and 1970s monumental abstract artworks, is on permanent display throughout the site. The New York State Office of General Services maintains the plaza. The Nelson A. Rockefeller Empire State Plaza Performing Arts Center Corporation is a New York state public-benefit corporation that was created in 1979 to manage the performing arts facility in the plaza.<br/><br/>AGENT:  Thought: From the summary of the page "Empire State Building", I can see that the building was designed and built from 1930 to 1931. I will use the `final_answer` tool to return the answer.<br/>Code:<br/>```py<br/>final_answer("According to the information extracted from the Wikipedia page 'Empire State Building', the construction of the Empire State Building started in 1930 and ended in 1931.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>According to the information extracted from the Wikipedia page 'Empire State Building', the construction of the Empire State Building started in 1930 and ended in 1931.</span></pre><p id="1371" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The passage retrieval agent was not used as all the information was already found in the summaries of the pages.</p><p id="ccfe" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Let’s now try a more complicated example asking if birch plywood floats in alcohol. This question requires basic physics understanding and arithmetic abilities, combined with non-trivial retrieval tasks.</p><p id="ad4f" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk"><em class="oa">Task: Does birch plywood float in ethanol?</em></p><p id="5e70" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Let’s first visualize the logs of the various agents.</p><p id="4f82" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Manager agent logs</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="6515" class="qj oc fq qg b bg qk ql l qm qn">AGENT:  Thought: To determine if birch plywood floats in ethanol, we need to know the density of both birch plywood and ethanol. If the density of birch plywood is less than the density of ethanol, it will float. I will use the `wikipedia_search_agent` tool to find the densities of birch plywood and ethanol.<br/>Code:<br/>```py<br/>birch_plywood_density_info = wikipedia_search_agent("density of birch plywood")<br/>ethanol_density_info = wikipedia_search_agent("density of ethanol")<br/>print(birch_plywood_density_info)<br/>print(ethanol_density_info)<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>The density of birch plywood is approximately 680 kg/m³.<br/>The density of ethanol at 20°C is approximately 0.7894 g/cm³.<br/><br/>AGENT:  Thought: Now that I have the densities, I can compare them. Birch plywood has a density of 680 kg/m³ and ethanol has a density of 0.7894 g/cm³. Since 1 g/cm³ is equal to 1000 kg/m³, the density of ethanol is 789.4 kg/m³. Since the density of birch plywood (680 kg/m³) is less than the density of ethanol (789.4 kg/m³), birch plywood will float in ethanol. I will now provide this conclusion using the `final_answer` function.<br/>Code:<br/>```py<br/>final_answer("Birch plywood will float in ethanol because its density (680 kg/m³) is less than the density of ethanol (789.4 kg/m³).")<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>Birch plywood will float in ethanol because its density (680 kg/m³) is less than the density of ethanol (789.4 kg/m³).</span></pre><p id="0040" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Wikipedia search agent logs</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="a916" class="qj oc fq qg b bg qk ql l qm qn">TASK:  density of birch plywood<br/>AGENT:  Thought: I will use the `search_wikipedia` tool to find information about the density of birch plywood. <br/>Code:<br/>```py<br/>search_wikipedia('birch plywood')<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>Pages found for query 'birch plywood':<br/>Page: Plywood<br/>Summary: Plywood is a composite material manufactured from thin layers, or "plies", of wood veneer that have been stacked and glued together. It is an engineered wood from the family of manufactured boards, which include plywood, medium-density fibreboard (MDF), oriented strand board (OSB), and particle board (or chipboard).<br/>All plywoods bind resin and wood fibre sheets (cellulose cells are long, strong and thin) to form a composite material. The sheets of wood are stacked such that each layer has its grain set typically (see below) perpendicular to its adjacent layers. This alternation of the grain is called cross-graining and has several important benefits: it reduces the tendency of wood to split when nailed at the edges; it reduces thickness swelling and shrinkage, providing improved dimensional stability; and it makes the strength of the panel consistent across all directions.  There is usually an odd number of plies, so that the sheet is balanced, that is, the surface layers have their gr<br/>Page: Birch<br/>Summary: A birch is a thin-leaved deciduous hardwood tree of the genus Betula (), in the family Betulaceae, which also includes alders, hazels, and hornbeams. It is closely related to the beech-oak family Fagaceae. The genus Betula contains 30 to 60 known taxa of which 11 are on the IUCN 2011 Red List of Threatened Species. They are typically short-lived pioneer species and are widespread in the Northern Hemisphere, particularly in northern areas of temperate climates and in boreal climates. Birch wood is used for a wide range of purposes.<br/>Page: Birch wood<br/>Summary: Birch wood is a type of wood of the birch. Birch wood is pale yellow-brown wood having a close, straight grain and uniform texture that finishes to a smooth surface. Sometimes it is dyed to imitate mahogany. This type of wood is used for among others firewood, turnery, furniture, cabinetry, tools handles, hoops, plywood, flooring and shoe heels.<br/>Page: Falco F8L<br/>Summary: The Falco F8L is an Italian-designed lightweight 2-seater aerobatic aircraft.<br/>Page: Crusader (speedboat)<br/>Summary: Crusader was a jet-powered speed boat piloted by John Cobb.<br/>The combination of an aerodynamically stable hull form and turbojet propulsion was proposed by Reid Railton, Cobb's adviser. A rocket-powered scale model was tested at Haslar. The full size design was by Peter du Cane and built by Vospers of Portsmouth. Technical assistance came from Saunders-Roe and Vickers-Supermarine. It cost £15,000 in 1949.<br/>It was silver and scarlet in colour and 10 m long.  <br/>The engine was a de Havilland Ghost Mk 48 centrifugal turbojet provided as a loan by the Ministry of Supply at the request of Major Frank Halford, the engine designer. The engine was rated at 5,000 lb thrust fed by two scoop inlets forward of the cockpit.<br/>The hull was of trimaran form, a main hull with a planing step, and two smaller rear-mounted outriggers. Construction was of birch plywood frames and stringers. The hull was skinned in birch ply covered in doped fabric with metal skin reinforcement for planing surfaces. Aircraft-sty<br/><br/>AGENT:  Thought: The pages returned from the search did not directly mention the density of birch plywood. However, the page on Birch Wood mentions that birch wood is used for plywood. I will use the `search_info` tool to find more specific information about the density of birch plywood from the page 'Plywood'.<br/>Code:<br/>```py<br/>search_info('density of birch plywood', 'Plywood')<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>Information retrieved from the page 'Plywood' for the query 'density of birch plywood':<br/>The density of birch plywood is approximately 680 kg/m³.<br/>AGENT:  Thought: I have found the density of birch plywood from the Wikipedia page 'Plywood'. The density is approximately 680 kg/m³.<br/>Code:<br/>```py<br/>final_answer("The density of birch plywood is approximately 680 kg/m³.")<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>The density of birch plywood is approximately 680 kg/m³.<br/>------------------------------<br/>TASK:  density of ethanol<br/>AGENT:  Thought: I will use the `search_wikipedia` tool to find the density of ethanol from Wikipedia. <br/>Code:<br/>```py<br/>search_wikipedia('density of ethanol')<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>Pages found for query 'density of ethanol':<br/>Page: Ethanol (data page)<br/>Summary: This page provides supplementary chemical data on ethanol.<br/><br/><br/>Page: Ethanol<br/>Summary: Ethanol (also called ethyl alcohol, grain alcohol, drinking alcohol, or simply alcohol) is an organic compound with the chemical formula CH3CH2OH. It is an alcohol, with its formula also written as C2H5OH, C2H6O or EtOH, where Et stands for ethyl. Ethanol is a volatile, flammable, colorless liquid with a characteristic wine-like odor and pungent taste. In nature, grape-sugar breaks up by the action of fermentation into alcohol or carbonic acid, without anything being added. As a psychoactive depressant, it is the active ingredient in alcoholic beverages, and the second most consumed drug globally behind caffeine.<br/>Ethanol is naturally produced by the fermentation process of sugars by yeasts or via petrochemical processes such as ethylene hydration. Historically it was used as a general anesthetic, and has modern medical applications as an antiseptic, disinfectant, solvent for some medications, and antidote for methanol poisoning and ethylene glycol poisoning. It is used as a chemical so<br/>Page: Alcohol by volume<br/>Summary: Alcohol by volume (abbreviated as alc/vol or ABV) is a standard measure of the volume of alcohol contained in a given volume of an alcoholic beverage, expressed as a volume percent. It is defined as the number of millilitres (mL) of pure ethanol present in 100 mL (3.5 imp fl oz; 3.4 US fl oz) of solution at 20 °C (68 °F). The number of millilitres of pure ethanol is the mass of the ethanol divided by its density at 20 °C (68 °F), which is 0.78945 g/mL (0.82353 oz/US fl oz; 0.79122 oz/imp fl oz; 0.45633 oz/cu in). The alc/vol standard is used worldwide. The International Organization of Legal Metrology has tables of density of water–ethanol mixtures at different concentrations and temperatures.<br/>In some countries, e.g. France, alcohol by volume is often referred to as degrees Gay-Lussac (after the French chemist Joseph Louis Gay-Lussac), although there is a slight difference since the Gay-Lussac convention uses the International Standard Atmosphere value for temperature, 15 °C (59 °F).<br/><br/><br/>Page: Alcohol fuel<br/>Summary: Various alcohols are used as fuel for internal combustion engines.  The first four aliphatic alcohols (methanol, ethanol, propanol, and butanol)<br/>are of interest as fuels because they can be synthesized chemically or biologically, and they have characteristics which allow them to be used in internal combustion engines. The general chemical formula for alcohol fuel is CnH2n+1OH.<br/>Most methanol is produced from natural gas, although it can be produced from biomass using very similar chemical processes. Ethanol is commonly produced from biological material through fermentation processes. Biobutanol has the advantage in combustion engines in that its energy density is closer to gasoline than the simpler alcohols (while still retaining over 25% higher octane rating); however, biobutanol is currently more difficult to produce than ethanol or methanol. When obtained from biological materials and/or biological processes, they are known as bioalcohols (e.g. "bioethanol"). There is no chemical dif<br/>Page: Cellulosic ethanol<br/>Summary: Cellulosic ethanol is ethanol (ethyl alcohol) produced from cellulose (the stringy fiber of a plant) rather than from the plant's seeds or fruit. It can be produced from grasses, wood, algae, or other plants. It is generally discussed for use as a biofuel. The carbon dioxide that plants absorb as they grow offsets some of the carbon dioxide emitted when ethanol made from them is burned, so cellulosic ethanol fuel has the potential to have a lower carbon footprint than fossil fuels.<br/>Interest in cellulosic ethanol is driven by its potential to replace ethanol made from corn or sugarcane. Since these plants are also used for food products, diverting them for ethanol production can cause food prices to rise; cellulose-based sources, on the other hand, generally do not compete with food, since the fibrous parts of plants are mostly inedible to humans. Another potential advantage is the high diversity and abundance of cellulose sources; grasses, trees and algae are found in almost every envi<br/><br/>AGENT:  Thought: The summary of the page 'Ethanol' mentions that ethanol is an alcohol with a characteristic wine-like odor and pungent taste. However, it does not provide the density of ethanol. I will use the `search_info` tool to find the density of ethanol from the 'Ethanol (data page)'.<br/>Code:<br/>```py<br/>search_info('density of ethanol', 'Ethanol (data page)')<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>Information retrieved from the page 'Ethanol (data page)' for the query 'density of ethanol':<br/>The density of ethanol at 20°C is approximately 0.7894 g/cm³.<br/>AGENT:  Thought: I have found the density of ethanol from the Wikipedia page 'Ethanol (data page)'. I will return the result using the `final_answer` tool.<br/>Code:<br/>```py<br/>final_answer("The density of ethanol at 20°C is approximately 0.7894 g/cm³.")<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>The density of ethanol at 20°C is approximately 0.7894 g/cm³.</span></pre><p id="8233" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Page search agent logs</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="ecc6" class="qj oc fq qg b bg qk ql l qm qn">TASK:  Retrieve information about the query:"density of birch plywood" from the Wikipedia page "Plywood".<br/>AGENT:  Thought: I need to find the density of birch plywood. I will use the tool `retrieve_passages` to look for data on the Wikipedia page.<br/>Code:<br/>```py<br/>result = retrieve_passages("density of birch plywood")<br/>print(result)<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Retrieved passages for query "density of birch plywood":<br/>Passage 0: ... . Shear stress, by contrast, is higher in the center of the panel, and at the outer fibres. Within Europe basic plywood can be divided into three main categories: birch plywood (density approx. 680 kg/m3), mixed plywood (density approx. 620 kg/m3) and conifer plywoods (density 460–520 kg/m3). ...<br/>Passage 1: ... . Aircraft grade plywood is made from three or more plies of birch, as thin as 0.40 millimetres (1⁄64 in) thick in total, and is extremely strong and light. ...<br/>Passage 2: ... Baltic Birch plywood is a product of an area around the Baltic Sea. Originally manufactured for European cabinet makers but now popular in the United States as well. It is very stable composed of an inner void-free core of cross-banded birch plys with an exterior grade adhesive. The face veneers are thicker than traditional cabinet grade ...<br/>Passage 3: ... . As a result, thicker panels can span greater distances under the same loads. In bending, the maximum stress occurs in the outermost layers, one in tension, the other in compression. Bending stress decreases from the maximum at the face layers to nearly zero at the central layer. Shear stress, by contrast, is higher in the center of the panel, and at the outer fibres. Within Europe basic plywood can be divided into three main categories: birch plywood (density approx ...<br/>Passage 4: ... Wind turbine blades<br/>Insulation boxes for liquefied natural gas (LNG) carriers<br/>Smooth surface and accurate thickness combined with the durability of the material makes birch plywood a favorable material for many special end uses e.g.:<br/><br/>High-end loud speakers<br/>Die-cutting boards<br/>Supporting structure for parquet<br/>Playground equipment<br/>Furniture<br/>Signs and fences for demanding outdoor advertising<br/>Musical instruments<br/>Sports equipment...<br/><br/>AGENT:  Thought: From the passages, I can see that the density of birch plywood is approximately 680 kg/m³. I can use the `final_answer` tool to provide the answer.<br/>Code:<br/>```py<br/>final_answer("The density of birch plywood is approximately 680 kg/m³.")<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>The density of birch plywood is approximately 680 kg/m³.<br/>------------------------------<br/>TASK:  Retrieve information about the query:"density of ethanol" from the Wikipedia page "Ethanol (data page)".<br/>AGENT:  Thought: I need to find the density of ethanol. I will use the tool `retrieve_passages` to get the information from the Wikipedia page.<br/>Code:<br/>```py<br/>result = retrieve_passages("density of ethanol")<br/>print(result)<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Retrieved passages for query "density of ethanol":<br/>Passage 0: ... == Density of ethanol at various temperatures ==<br/>Data obtained from Lange 1967<br/><br/>These data correlate as ρ [g/cm3] = −8.461834×10−4 T [°C] + 0.8063372 with an R2 = 0.99999.<br/><br/><br/>== Properties of aqueous ethanol solutions ==<br/>Data obtained from Lange 1967<br/><br/><br/>== Boiling points of aqueous solutions ==<br/>Data obtained from CRC Handbook of Chemistry (Page 2117): 2391 <br/><br/>‡Azeotropic mixture<br/><br/><br/>== Charts ==<br/><br/><br/>== References == ...<br/>Passage 1: ... This page provides supplementary chemical data on ethanol.<br/><br/><br/>== Material Safety Data Sheet ==<br/>External MSDS<br/><br/><br/>== Structure and properties ==<br/><br/><br/>== Thermodynamic properties ==<br/><br/><br/>== Spectral data ==<br/><br/><br/>== Vapor pressure of liquid ==<br/><br/><br/>== Density of ethanol at various temperatures ==<br/>Data obtained from Lange 1967<br/><br/>These data correlate as ρ [g/cm3] = −8.461834×10−4 T [°C] + 0.8063372 with an R2 = 0.99999.<br/><br/><br/>== Properties of aqueous ethanol solutions ==<br/>Data obtained from Lange 1967...<br/><br/>AGENT:  Thought: From the passages, I can see that the density of ethanol varies with temperature. I can use the provided linear equation to calculate the density at a specific temperature. I will use the `math` module to perform the calculation.<br/>Code:<br/>```py<br/># Extract the coefficients from the equation<br/>a = -8.461834e-4<br/>b = 0.8063372<br/><br/># Calculate the density at a specific temperature, let's take 20°C as an example<br/>temperature = 20<br/>density = a * temperature + b<br/>print(density)<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>0.789413532<br/><br/>AGENT:  Thought: The passage provides a linear equation to calculate the density of ethanol at different temperatures. I can now use this equation to provide the density of ethanol at a specific temperature. I will use the `final_answer` tool to return the relevant information.<br/>Code:<br/>```py<br/>final_answer(f"The density of ethanol at 20°C is approximately {round(0.789413532, 4)} g/cm³.")<br/>```&lt;end_action&gt;<br/>OBSERVATION:  Print outputs:<br/>Last output from code snippet:<br/>The density of ethanol at 20°C is approximately 0.7894 g/cm³.</span></pre><p id="ee3f" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The model correctly identifies density difference as the cause of floating/sinking, breaks up the task into finding the density of both substances, and is able to draw the correct conclusion from the retrieved data despite them being in different units of measurement.</p><h1 id="df9a" class="ob oc fq bf od oe of gq og oh oi gt oj ok ol om on oo op oq or os ot ou ov ow bk">Limitations</h1><p id="b7fb" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">The discussed system has impressive capabilities, especially considering the limited size of the engine model used, but of course, it has its own limitations. The bigger one seems to be related to the power of the engine model itself: while it seems able to understand and follow complex and long instructions as well as to use the provided tools correctly, sometimes it fails to comply with simple guidelines and it tends to repeat unfruitful actions without changes. This is particularly prominent when the information the agent is looking for is not present (or not easily extractible using the semantic search tool) from the provided pages.</p><p id="884b" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Another drawback, intrinsic to agentic and even more prominent in multi-agentic systems, is the computation time needed for the various agents' execution. In some simple cases where the standard RAG workflow would have been enough to answer the question, this could produce an unnecessary computational overhead.</p><p id="437b" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Finally, having multiple agents interacting with each other can amplify the risk of hallucinations, as a hallucination made by one agent could propagate over the execution chain, making it also very difficult to track.</p><p id="ee3d" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Let’s visualize an example in which the system, while still providing the correct answer, made excessive use of tool calls (with some repeated actions) unnecessarily extending the execution time.</p><p id="a163" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk"><em class="oa">Task: Which dynasty was ruling China at the time of the fall of Constantinople?</em></p><p id="04fd" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The task requires a good level of abstraction since the two events are not related and the exact year of the fall of Constantinople may not be reported on the page of the corresponding dynasty.</p><p id="c2e3" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The manager agent execution is still lean and on point, solving the task correctly by first retrieving the date of the fall of Constantinople and then looking for Chinese dynasties in that year. However, we can already see that the search results, while still containing the required information, seem a bit strange.</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="36de" class="qj oc fq qg b bg qk ql l qm qn">Agent:  Thought: To answer this question, I need to find out when Constantinople fell and which Chinese dynasty was ruling at that time. I'll start by finding the fall date of Constantinople.<br/>Code:<br/>```py<br/>wikipedia_search_agent(query="Fall of Constantinople")<br/>```&lt;end_action&gt;<br/>Observation:  Print outputs:<br/>Last output from code snippet:<br/>The leader of the Ottoman Empire in 1453, during the fall of Constantinople, was Mehmed II, also known as Mehmed the Conqueror.<br/>Agent:  Thought: From the previous search, we know that Constantinople fell in 1453, and it was conquered by Mehmed II. Now I need to find out which Chinese dynasty was ruling in 1453. I will search for the Chinese dynasties around that time.<br/>Code:<br/>```py<br/>wikipedia_search_agent(query="Chinese dynasties 1453")<br/>```&lt;end_action&gt;<br/>Observation:  Print outputs:<br/>Last output from code snippet:<br/>In 1453, the Ming dynasty was in full control of China. No specific events related to 1453 are mentioned in the information provided.<br/>Agent:  Thought: Based on the information provided, the Ming dynasty was in full control of China in 1453. Therefore, the dynasty ruling China when Constantinople fell would be the Ming dynasty.<br/>Code:<br/>```py<br/>final_answer("The dynasty ruling China when Constantinople fell in 1453 was the Ming dynasty.")<br/>```&lt;end_action&gt;<br/>Observation:  Print outputs:<br/>Last output from code snippet:<br/>The dynasty ruling China when Constantinople fell in 1453 was the Ming dynasty.</span></pre><p id="c3cc" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Let’s thus inspect the corresponding Wikipedia search agent tasks and their execution. We can see that, possibly due to the broad task “Fall of Constantinople”, the agent looks at other specific information after having found the correct date. The same happens when retrieving information about the Chinese dynasties, with the further problem that some tool calls were repeated identically.</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="a46a" class="qj oc fq qg b bg qk ql l qm qn">TASK:  Fall of Constantinople<br/>AGENT:  Thought: I will use the `search_wikipedia` tool to find information about the fall of Constantinople. This will likely provide me with a summary of the event and possibly links to related pages.<br/>Code:<br/>```py<br/>search_wikipedia("Fall of Constantinople")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Pages found for query 'Fall of Constantinople':<br/>Page: Fall of Constantinople<br/>Summary: The fall of Constantinople, also known as the conquest of Constantinople, was the capture of the capital of the Byzantine Empire by the Ottoman Empire. The city was captured on 29 May 1453 as part of the culmination of a 55-day siege which had begun on 6 April.<br/>The attacking Ottoman Army, which significantly outnumbered Constantinople's defenders, was commanded by the 21-year-old Sultan Mehmed II (later nicknamed "the Conqueror"), while the Byzantine army was led by Emperor Constantine XI Palaiologos. After conquering the city, Mehmed II made Constantinople the new Ottoman capital, replacing Adrianople.<br/>The fall of Constantinople and of the Byzantine Empire was a watershed of the Late Middle Ages, marking the effective end of the Roman Empire, a state which began in roughly 27 BC and had lasted nearly 1500 years. For many modern historians, the fall of Constantinople marks the end of the medieval period and the beginning of the early modern period. The city's fall also stood as a turni<br/>Page: Sack of Constantinople<br/>Summary: The sack of Constantinople occurred in April 1204 and marked the culmination of the Fourth Crusade. Crusaders sacked and destroyed most of Constantinople, the capital of the Byzantine Empire. After the capture of the city, the Latin Empire (known to the Byzantines as the Frankokratia, or the Latin occupation) was established and Baldwin of Flanders crowned as Emperor Baldwin I of Constantinople in Hagia Sophia.<br/>After the city's sacking, most of the Byzantine Empire's territories were divided up among the Crusaders. Byzantine aristocrats also established a number of small independent splinter states—one of them being the Empire of Nicaea, which would eventually recapture Constantinople in 1261 and proclaim the reinstatement of the Empire. However, the restored Empire never managed to reclaim all its former territory or attain its earlier economic strength, and it gradually succumbed to the rising Ottoman Empire over the following two centuries.<br/>The Byzantine Empire was left poorer, smal<br/>Page: Constantinople<br/>Summary: Constantinople (see other names) became the capital of the Roman Empire during the reign of Constantine the Great in 330. Following the collapse of the Western Roman Empire in the late 5th century, Constantinople remained the capital of the Eastern Roman Empire (also known as the Byzantine Empire; 330–1204 and 1261–1453), the Latin Empire (1204–1261), and the Ottoman Empire (1453–1922). Following the Turkish War of Independence, the Turkish capital then moved to Ankara. Officially renamed Istanbul in 1930, the city is today the largest city in Europe, straddling the Bosporus strait and lying in both Europe and Asia, and the financial center of Turkey.<br/>In 324, following the reunification of the Eastern and Western Roman Empires, the ancient city of Byzantium was selected to serve as the new capital of the Roman Empire, and the city was renamed Nova Roma, or 'New Rome', by Emperor Constantine the Great. On 11 May 330, it was renamed Constantinople and dedicated to Constantine. Constantin<br/>Page: Moscow, third Rome<br/>Summary: Moscow, third Rome (Russian: Москва — третий Рим; Moskva, tretiĭ Rim) is a theological and political concept asserting Moscow as the successor to ancient Rome, with the Russian world carrying forward the legacy of the Roman Empire. The term "third Rome" refers to a historical topic of debate in European culture: the question of the successor city to the "first Rome" (Rome, within the Western Roman Empire) and the "second Rome" (Constantinople, within the Eastern Roman Empire).<br/>Page: Byzantine Empire<br/>Summary: The Byzantine Empire, also referred to as the Eastern Roman Empire, was the continuation of the Roman Empire centred in Constantinople during late antiquity and the Middle Ages. The eastern half of the Empire survived the conditions that caused the fall of the West in the 5th century AD, and continued to exist until the fall of Constantinople to the Ottoman Empire in 1453. During most of its existence, the empire remained the most powerful economic, cultural, and military force in the Mediterranean world. The term "Byzantine Empire" was only coined following the empire's demise; its citizens referred to the polity as the "Roman Empire" and to themselves as "Romans". Due to the imperial seat's move from Rome to Byzantium, the adoption of state Christianity, and the predominance of Greek instead of Latin, modern historians continue to make a distinction between the earlier Roman Empire and the later Byzantine Empire.<br/>During the earlier Pax Romana period, the western parts of the empire b<br/><br/>AGENT:  Thought: From the summary of the page "Fall of Constantinople", I can see that the event took place in 1453. I will use the `search_info` tool to find more details about the event, specifically who was the leader of the Ottoman Empire at that time.<br/>Code:<br/>```py<br/>search_info("leader of the Ottoman Empire in 1453", "Fall of Constantinople")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Information retrieved from the page 'Fall of Constantinople' for the query 'leader of the Ottoman Empire in 1453':<br/>The leader of the Ottoman Empire in 1453 was Mehmed II, also known as Mehmed the Conqueror.<br/>AGENT:  Thought: I have found that the leader of the Ottoman Empire in 1453 was Mehmed II, also known as Mehmed the Conqueror. I will use the `final_answer` tool to provide the answer.<br/>Code:<br/>```py<br/>final_answer("The leader of the Ottoman Empire in 1453, during the fall of Constantinople, was Mehmed II, also known as Mehmed the Conqueror.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>The leader of the Ottoman Empire in 1453, during the fall of Constantinople, was Mehmed II, also known as Mehmed the Conqueror.<br/>------------------------------<br/>TASK:  Chinese dynasties 1453<br/>AGENT:  Thought: I will use the `search_wikipedia` tool to find information about Chinese dynasties around the year 1453. I will provide a general query related to Chinese dynasties in that time period.<br/>Code:<br/>```py<br/>search_wikipedia('Chinese dynasties 1453')<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Pages found for query 'Chinese dynasties 1453':<br/>Page: Chinese Empire<br/>Summary: Chinese Empire (or Empire of China) is a term referring to the realm ruled by the Emperor of China during the era known as Imperial China. It was coined by western scholars and used to describe the Ming and Qing dynasties (or imperial Chinese dynasties in general). Another term was "Celestial Empire", in reference to the status of the emperor as the Son of Heaven. In 221 BC, China was unified under an emperor for the first time, and various dynasties or empires founded by hereditary monarchs ruled China for a total of two millennia since then, including the Qin, Han, Jin, Sui, Tang, Song, Yuan, Ming, and Qing.<br/><br/><br/>Page: Ming dynasty<br/>Summary: The Ming dynasty, officially the Great Ming, was an imperial dynasty of China, ruling from 1368 to 1644 following the collapse of the Mongol-led Yuan dynasty. The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China. Although the primary capital of Beijing fell in 1644 to a rebellion led by Li Zicheng (who established the short-lived Shun dynasty), numerous rump regimes ruled by remnants of the Ming imperial family—collectively called the Southern Ming—survived until 1662.<br/>The Ming dynasty's founder, the Hongwu Emperor (r. 1368–1398), attempted to create a society of self-sufficient rural communities ordered in a rigid, immobile system that would guarantee and support a permanent class of soldiers for his dynasty: the empire's standing army exceeded one million troops and the navy's dockyards in Nanjing were the largest in the world. He also took great care breaking the power of the court eunuchs and unrelated magnates, enfeoff<br/>Page: List of time periods<br/>Summary: The categorisation of the past into discrete, quantified named blocks of time is called periodization. This is a list of such named time periods as defined in various fields of study.<br/>These can be divided broadly into prehistorical periods and historical periods<br/>(when written records began to be kept). <br/>In archaeology and anthropology, prehistory is subdivided into the three-age system, this list includes the use of the three-age system as well as a number of various designation used in reference to sub-ages within the traditional three.<br/>The dates for each age can vary by region. On the geologic time scale, the Holocene epoch starts at the end of the last glacial period of the current ice age (c. 10,000 BC) and continues to the present. The beginning of the Mesolithic is usually considered to correspond to the beginning of the Holocene epoch.<br/><br/><br/>Page: Celestial Empire<br/>Summary: Celestial Empire (Chinese: 天朝; pinyin: Tiāncháo; lit. 'heavenly dynasty') is an old name used to refer to China or the Chinese Empire, from a literary and poetic translation of the Chinese term, one of many names for China. The name was used in reference to the status of the Emperor of China as the Son of Heaven in the Sinosphere.<br/>Accordingly, in the 19th century, the name "Celestial" was used to refer to Chinese people. Both terms were widely used in the English-language popular mass media of the day, but fell into disuse later on. Its usage has become popular again in the present day (2015), particularly among Chinese Internet users. It is used to refer to the current Communist regime, to imply either disapproval for its political suppression and arrogance or national pride in the country's emergence as a superpower in the 21st century, depending on the context.<br/>In modern times it has mostly fallen into disuse, but the name "Celestial Empire" still appears in various media such as ar<br/>Page: List of dynasties<br/>Summary: This is a list of monarchical dynasties and dynastic regimes organized by geographic region. Extant dynasties are rendered in bold and highlighted.<br/><br/>AGENT:  Thought: From the summaries, I can see that the Ming dynasty ruled from 1368 to 1644, which covers the year 1453. I will use the `search_info` tool to find more detailed information about the Ming dynasty during the year 1453.<br/>Code:<br/>```py<br/>search_info('1453', 'Ming dynasty')<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Information retrieved from the page 'Ming dynasty' for the query '1453':<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.<br/>AGENT:  Thought: Now that I know the Ming dynasty ruled during 1453, I can provide a more specific answer about the events that happened in China during that year. However, the information provided does not give us specific details about the events in 1453. I will use the `search_info` tool to find more detailed information about the Ming dynasty during the year 1453.<br/>Code:<br/>```py<br/>search_info('1453', 'Ming dynasty')<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Information retrieved from the page 'Ming dynasty' for the query '1453':<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.<br/>AGENT:  Thought: The information provided does not specifically mention the events of 1453. However, we can infer that during the Ming dynasty, significant developments occurred. I will use the `search_info` tool to find more specific information about the events of 1453 in the Ming dynasty.<br/>Code:<br/>```py<br/>search_info('1453', 'Ming dynasty')<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Information retrieved from the page 'Ming dynasty' for the query '1453':<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.<br/>AGENT:  Thought: The information provided indicates that the Ming dynasty was in full control of China during the year 1453. However, there is no specific mention of events that happened in 1453. I will use the `search_info` tool to find more specific information about the events of 1453 in the Ming dynasty.<br/>Code:<br/>```py<br/>search_info('1453', 'Ming dynasty')<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>Information retrieved from the page 'Ming dynasty' for the query '1453':<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.<br/>AGENT:  Thought: The information provided does not specifically mention any events that occurred in 1453. However, we know that the Ming dynasty was in full control of China during this time. I will use the `final_answer` tool to provide the answer based on the information we have.<br/>Code:<br/>```py<br/>final_answer("In 1453, the Ming dynasty was in full control of China. No specific events related to 1453 are mentioned in the information provided.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>In 1453, the Ming dynasty was in full control of China. No specific events related to 1453 are mentioned in the information provided.</span></pre><p id="e2b6" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Diving deeper into the page search agent execution, we see that this also repeated multiple tool calls with the same parameters.</p><pre class="mn mo mp mq mr qf qg qh bp qi bb bk"><span id="03de" class="qj oc fq qg b bg qk ql l qm qn">TASK:  Retrieve information about the query:"leader of the Ottoman Empire in 1453" from the Wikipedia page "Fall of Constantinople".<br/>AGENT:  Thought: I need to find out who was the leader of the Ottoman Empire in 1453. I will use the `retrieve_passages` tool to search for this information on the Wikipedia page "Fall of Constantinople".<br/>Code:<br/>```py<br/>result = retrieve_passages("leader of the Ottoman Empire in 1453")<br/>print(result)<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Retrieved passages for query "leader of the Ottoman Empire in 1453":<br/>Passage 0: ... When Mehmed II succeeded his father in 1451, he was 19 years old. Many European courts assumed that the young Ottoman ruler would not seriously challenge Christian hegemony in the Balkans and the Aegean. In fact, Europe celebrated Mehmed coming to the throne and hoped his inexperience would lead the Ottomans astray. This calculation was boosted by Mehmed's friendly overtures to the European envoys at his new court. But Mehmed's mild words were not matched by his actions ...<br/>Passage 1: ... The attacking Ottoman Army, which significantly outnumbered Constantinople's defenders, was commanded by the 21-year-old Sultan Mehmed II (later nicknamed "the Conqueror"), while the Byzantine army was led by Emperor Constantine XI Palaiologos. After conquering the city, Mehmed II made Constantinople the new Ottoman capital, replacing Adrianople. ...<br/>Passage 2: ... . The oldest boy, renamed Murad, became a personal favourite of Mehmed and served as Beylerbey (Governor-General) of Rumeli (the Balkans). The younger son, renamed Mesih Pasha, became Admiral of the Ottoman fleet and Sancak Beg (Governor) of the province of Gallipoli. He eventually served twice as Grand Vizier under Mehmed's son, Bayezid II. ...<br/>Passage 3: ... == External links ==<br/><br/> Media related to Fall of Constantinople (1453) at Wikimedia Commons<br/>The Siege of Constantinople As The Islamic World Sees it Archived 22 April 2021 at the Wayback Machine<br/>World History Encyclopedia – 1453: The Fall of Constantinople<br/>Constantinople Siege &amp; Fall, BBC Radio 4 discussion with Roger Crowley, Judith Herrin &amp; Colin Imber (In Our Time, 28 December 2006). ...<br/>Passage 4: ... In the summer of 1452, when Rumeli Hisarı was completed and the threat of the Ottomans had become imminent, Constantine wrote to the Pope, promising to implement the union, which was declared valid by a half-hearted imperial court on 12 December 1452. Although he was eager for an advantage, Pope Nicholas V did not have the influence the Byzantines thought he had over the Western kings and princes, some of whom were wary of increasing papal control...<br/><br/>AGENT:  Thought: From the passages, it seems that the leader of the Ottoman Empire in 1453 was Mehmed II, also known as Mehmed the Conqueror. I will use the `final_answer` tool to provide the answer.<br/>Code:<br/>```py<br/>final_answer("The leader of the Ottoman Empire in 1453 was Mehmed II, also known as Mehmed the Conqueror.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>The leader of the Ottoman Empire in 1453 was Mehmed II, also known as Mehmed the Conqueror.<br/>------------------------------<br/>TASK:  Retrieve information about the query:"1453" from the Wikipedia page "Ming dynasty".<br/>AGENT:  Thought: I need to find information related to the year 1453 from the Wikipedia page "Ming dynasty". I will use the `retrieve_passages` tool to get relevant passages.<br/>Code:<br/>```py<br/>result = retrieve_passages("1453 Ming dynasty")<br/>print(result)<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Retrieved passages for query "1453 Ming dynasty":<br/>Passage 0: ... The Ming dynasty, officially the Great Ming, was an imperial dynasty of China, ruling from 1368 to 1644 following the collapse of the Mongol-led Yuan dynasty. The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China ...<br/>Passage 1: ... === Reference works and primary sources ===<br/>Farmer, Edward L. ed. Ming History: An Introductory Guide to Research (1994).<br/>Goodrich, Luther Carrington (1976). Dictionary of Ming Biography, 1368–1644. New York: Columbia University Press. ISBN 978-0-231-03833-1.<br/>The Ming History English Translation Project, A collaborative project that makes available translations (from Chinese to English) of portions of the 明史 Mingshi (Official History of the Ming Dynasty). ...<br/>Passage 2: ... ==== Reign of the Hongwu Emperor ==== ...<br/>Passage 3: ... . The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China. Although the primary capital of Beijing fell in 1644 to a rebellion led by Li Zicheng (who established the short-lived Shun dynasty), numerous rump regimes ruled by remnants of the Ming imperial family—collectively called the Southern Ming—survived until 1662. ...<br/>Passage 4: ... . Zhu Di assumed the throne as the Yongle Emperor (r. 1402–24); his reign is universally viewed by scholars as a "second founding" of the Ming dynasty since he reversed many of his father's policies....<br/><br/>AGENT:  Thought: The passages do not directly mention the year 1453. However, I can infer that the Ming dynasty lasted from 1368 to 1644, and 1453 falls within this period. I will use the `final_answer` tool to provide a summary based on the information available.<br/>Code:<br/>```py<br/>final_answer("The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.<br/>------------------------------<br/>TASK:  Retrieve information about the query:"1453" from the Wikipedia page "Ming dynasty".<br/>AGENT:  Thought: I need to find information related to the year 1453 from the Wikipedia page "Ming dynasty". I will use the `retrieve_passages` tool to get relevant passages.<br/>Code:<br/>```py<br/>result = retrieve_passages("1453 Ming dynasty")<br/>print(result)<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Retrieved passages for query "1453 Ming dynasty":<br/>Passage 0: ... The Ming dynasty, officially the Great Ming, was an imperial dynasty of China, ruling from 1368 to 1644 following the collapse of the Mongol-led Yuan dynasty. The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China ...<br/>Passage 1: ... === Reference works and primary sources ===<br/>Farmer, Edward L. ed. Ming History: An Introductory Guide to Research (1994).<br/>Goodrich, Luther Carrington (1976). Dictionary of Ming Biography, 1368–1644. New York: Columbia University Press. ISBN 978-0-231-03833-1.<br/>The Ming History English Translation Project, A collaborative project that makes available translations (from Chinese to English) of portions of the 明史 Mingshi (Official History of the Ming Dynasty). ...<br/>Passage 2: ... ==== Reign of the Hongwu Emperor ==== ...<br/>Passage 3: ... . The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China. Although the primary capital of Beijing fell in 1644 to a rebellion led by Li Zicheng (who established the short-lived Shun dynasty), numerous rump regimes ruled by remnants of the Ming imperial family—collectively called the Southern Ming—survived until 1662. ...<br/>Passage 4: ... . Zhu Di assumed the throne as the Yongle Emperor (r. 1402–24); his reign is universally viewed by scholars as a "second founding" of the Ming dynasty since he reversed many of his father's policies....<br/><br/>AGENT:  Thought: The passages do not directly mention the year 1453. However, I can infer that the Ming dynasty lasted from 1368 to 1644, and 1453 falls within this period. I will use the `final_answer` tool to provide a summary based on the information available.<br/>Code:<br/>```py<br/>final_answer("The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.<br/>------------------------------<br/>TASK:  Retrieve information about the query:"1453" from the Wikipedia page "Ming dynasty".<br/>AGENT:  Thought: I need to find information related to the year 1453 from the Wikipedia page "Ming dynasty". I will use the `retrieve_passages` tool to get relevant passages.<br/>Code:<br/>```py<br/>result = retrieve_passages("1453 Ming dynasty")<br/>print(result)<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Retrieved passages for query "1453 Ming dynasty":<br/>Passage 0: ... The Ming dynasty, officially the Great Ming, was an imperial dynasty of China, ruling from 1368 to 1644 following the collapse of the Mongol-led Yuan dynasty. The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China ...<br/>Passage 1: ... === Reference works and primary sources ===<br/>Farmer, Edward L. ed. Ming History: An Introductory Guide to Research (1994).<br/>Goodrich, Luther Carrington (1976). Dictionary of Ming Biography, 1368–1644. New York: Columbia University Press. ISBN 978-0-231-03833-1.<br/>The Ming History English Translation Project, A collaborative project that makes available translations (from Chinese to English) of portions of the 明史 Mingshi (Official History of the Ming Dynasty). ...<br/>Passage 2: ... ==== Reign of the Hongwu Emperor ==== ...<br/>Passage 3: ... . The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China. Although the primary capital of Beijing fell in 1644 to a rebellion led by Li Zicheng (who established the short-lived Shun dynasty), numerous rump regimes ruled by remnants of the Ming imperial family—collectively called the Southern Ming—survived until 1662. ...<br/>Passage 4: ... . Zhu Di assumed the throne as the Yongle Emperor (r. 1402–24); his reign is universally viewed by scholars as a "second founding" of the Ming dynasty since he reversed many of his father's policies....<br/><br/>AGENT:  Thought: The passages do not directly mention the year 1453. However, I can infer that the Ming dynasty lasted from 1368 to 1644, and 1453 falls within this period. I will use the `final_answer` tool to provide a summary based on the information available.<br/>Code:<br/>```py<br/>final_answer("The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.<br/>------------------------------<br/>TASK:  Retrieve information about the query:"1453" from the Wikipedia page "Ming dynasty".<br/>AGENT:  Thought: I need to find information related to the year 1453 from the Wikipedia page "Ming dynasty". I will use the `retrieve_passages` tool to get relevant passages.<br/>Code:<br/>```py<br/>result = retrieve_passages("1453 Ming dynasty")<br/>print(result)<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Retrieved passages for query "1453 Ming dynasty":<br/>Passage 0: ... The Ming dynasty, officially the Great Ming, was an imperial dynasty of China, ruling from 1368 to 1644 following the collapse of the Mongol-led Yuan dynasty. The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China ...<br/>Passage 1: ... === Reference works and primary sources ===<br/>Farmer, Edward L. ed. Ming History: An Introductory Guide to Research (1994).<br/>Goodrich, Luther Carrington (1976). Dictionary of Ming Biography, 1368–1644. New York: Columbia University Press. ISBN 978-0-231-03833-1.<br/>The Ming History English Translation Project, A collaborative project that makes available translations (from Chinese to English) of portions of the 明史 Mingshi (Official History of the Ming Dynasty). ...<br/>Passage 2: ... ==== Reign of the Hongwu Emperor ==== ...<br/>Passage 3: ... . The Ming dynasty was the last imperial dynasty of China ruled by the Han people, the majority ethnic group in China. Although the primary capital of Beijing fell in 1644 to a rebellion led by Li Zicheng (who established the short-lived Shun dynasty), numerous rump regimes ruled by remnants of the Ming imperial family—collectively called the Southern Ming—survived until 1662. ...<br/>Passage 4: ... . Zhu Di assumed the throne as the Yongle Emperor (r. 1402–24); his reign is universally viewed by scholars as a "second founding" of the Ming dynasty since he reversed many of his father's policies....<br/><br/>AGENT:  Thought: The passages do not directly mention the year 1453. However, I can infer that the Ming dynasty lasted from 1368 to 1644, and 1453 falls within this period. I will use the `final_answer` tool to provide a summary based on the information available.<br/>Code:<br/>```py<br/>final_answer("The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.")<br/>```&lt;end_action&gt;<br/>OBSERVATIONS:  Print outputs:<br/>Last output from code snippet:<br/>The year 1453 falls within the period of the Ming dynasty, which ruled from 1368 to 1644. During this time, the Ming dynasty was in full control of China and experienced significant developments such as the construction of the Forbidden City and the expansion of the Great Wall of China.</span></pre><h1 id="034e" class="ob oc fq bf od oe of gq og oh oi gt oj ok ol om on oo op oq or os ot ou ov ow bk">Conclusion</h1><p id="014b" class="pw-post-body-paragraph ne nf fq ng b go ox ni nj gr oy nl nm nn oz np nq nr pa nt nu nv pb nx ny nz fj bk">In this blog post, I explained how to create a multi-agentic RAG system using code agents and a “small” open-source LLM like <em class="oa">Qwen2.5–7B-Instruct</em>. I have discussed the main architectural features and some specific choices relative to the Hugging Face code agent implementation that I made to improve the result. The full code details are available in the following <a class="af nd" href="https://github.com/GabrieleSgroi/multiagentic_rag" rel="noopener ugc nofollow" target="_blank">GitHub repo</a>.</p><p id="6498" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">The multi-agentic system described, despite being powered by a small model running on consumer-grade hardware, can solve multi-hop question-answering tasks related to complex queries. In particular:</p><ul class=""><li id="1274" class="ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz pd pe pf bk">It can break down the query into manageable sub-tasks;</li><li id="4178" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">It can identify the Wikipedia pages containing the necessary information;</li><li id="736a" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">It can combine information coming from multiple pages;</li><li id="f320" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">It can search for detailed information on a Wikipedia page;</li><li id="9f4b" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">It can determine whether it needs more information and tries to find it;</li><li id="a1aa" class="ne nf fq ng b go pg ni nj gr ph nl nm nn pi np nq nr pj nt nu nv pk nx ny nz pd pe pf bk">It can successfully fix small bugs in the code it produces and handle tool errors (like Wikipedia disambiguation errors).</li></ul><p id="7f9a" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">I have also outlined some limitations of the system, such as increased computation time, repetitive actions, and the potential propagation of hallucinations. The latter could be mitigated by including in the system a “proofreader” agent that checks that the reported information is in agreement with the retrieved sources.</p><p id="92cf" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">It is also worth noting that, since the agentic system has a standard RAG approach at its core, all the usual techniques used to improve the efficiency and accuracy of the latter can be implemented in the framework.</p><p id="2d0e" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Another possible improvement is to use techniques to increase test time computation to give the model more “time to think” similar to OpenAI o1/o3 models. It is however important to note that this modification will further increase execution time.</p><p id="3c9b" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">Finally, since the multi-agentic system is made up of agents specialized in a single task, using a different model engine for each of them could improve the performance. In particular, it is possible to fine-tune a different model for each task in the system for further performance gains. This could be particularly beneficial for small models. It is worth mentioning that fine-tuning data can be collected by running the system on a set of predetermined tasks and saving the agents' output when the system produces the correct answer, thus eliminating the need for expensive manual data annotation.</p><p id="abaf" class="pw-post-body-paragraph ne nf fq ng b go nh ni nj gr nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fj bk">I hope you found this tutorial useful, you can find the full code implementation in the <a class="af nd" href="https://github.com/GabrieleSgroi/multiagentic_rag" rel="noopener ugc nofollow" target="_blank">GitHub repo</a> and try it yourself in the <a class="af nd" href="https://colab.research.google.com/drive/1ZxF-Fkv4QV31uo79FagZWFm8tvXgCtBN" rel="noopener ugc nofollow" target="_blank">Colab notebook</a>.</p></div></div></div></div>    
</body>
</html>