<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Structured Outputs and How to Use Them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Structured Outputs and How to Use Them</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/structured-outputs-and-how-to-use-them-40bd86881d39?source=collection_archive---------3-----------------------#2024-08-09">https://towardsdatascience.com/structured-outputs-and-how-to-use-them-40bd86881d39?source=collection_archive---------3-----------------------#2024-08-09</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="0578" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Building robustness and determinism in LLM applications</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@armin.catovic?source=post_page---byline--40bd86881d39--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Armin Catovic" class="l ep by dd de cx" src="../Images/046042098f3fec885e756f7f8ee94e6a.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*mbpGpAHB8ZUfLAYgsZpR_Q.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--40bd86881d39--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@armin.catovic?source=post_page---byline--40bd86881d39--------------------------------" rel="noopener follow">Armin Catovic</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--40bd86881d39--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">5 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Aug 9, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/3c27ad73265f5ca5be36e8041289d13e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fwITvfJTV6sNSES-Qk7XrA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by the author</figcaption></figure><p id="124f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">OpenAI <a class="af ny" href="https://openai.com/index/introducing-structured-outputs-in-the-api/" rel="noopener ugc nofollow" target="_blank">recently announced</a> support for <strong class="ne fr">Structured Outputs</strong> in its latest <em class="nz">gpt-4o-2024–08–06</em> models. Structured outputs in relation to large language models (LLMs) are nothing new — developers have either used various prompt engineering techniques, or 3rd party tools.</p><p id="e10a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In this article we will explain what structured outputs are, how they work, and how you can apply them in your own LLM based applications. Although OpenAI’s announcement makes it quite easy to implement using their APIs (as we will demonstrate here), you may want to instead opt for the open source <a class="af ny" href="https://github.com/outlines-dev/outlines" rel="noopener ugc nofollow" target="_blank">Outlines</a> package (maintained by the lovely folks over at <a class="af ny" href="https://dottxt.co/" rel="noopener ugc nofollow" target="_blank">dottxt</a>), since it can be applied to both the self-hosted open-weight models (e.g. Mistral and LLaMA), as well as the proprietary APIs (<strong class="ne fr">Disclaimer</strong>: due to <a class="af ny" href="https://github.com/outlines-dev/outlines/issues/637" rel="noopener ugc nofollow" target="_blank">this issue</a> Outlines does not as of this writing support structured JSON generation via OpenAI APIs; but that will change soon!).</p><h1 id="59ac" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">What are Structured Outputs?</h1><p id="8b85" class="pw-post-body-paragraph nc nd fq ne b go ow ng nh gr ox nj nk nl oy nn no np oz nr ns nt pa nv nw nx fj bk">If <a class="af ny" href="https://www.together.ai/blog/redpajama-data-v2" rel="noopener ugc nofollow" target="_blank">RedPajama dataset</a> is any indication, the overwhelming majority of pre-training data is human text. Therefore “natural language” is the native domain of LLMs — both in the input, as well as the output. When we build applications however, we would like to use machine-readable formal structures or schemas to encapsulate our data input/output. This way we build robustness and determinism into our applications.</p><p id="3122" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">Structured Outputs</strong> is a mechanism by which we enforce a pre-defined schema on the LLM output. This typically means that we enforce a JSON schema, however it is not limited to JSON only — we could in principle enforce XML, Markdown, or a completely custom-made schema. The benefits of Structured Outputs are two-fold:</p><ol class=""><li id="e83c" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pb pc pd bk"><strong class="ne fr">Simpler prompt design</strong> — we need <strong class="ne fr">not</strong> be overly verbose when specifying how the output should look like</li><li id="9f8b" class="nc nd fq ne b go pe ng nh gr pf nj nk nl pg nn no np ph nr ns nt pi nv nw nx pb pc pd bk"><strong class="ne fr">Deterministic names and types</strong> — we can <strong class="ne fr">guarantee</strong> to obtain for example, an attribute <code class="cx pj pk pl pm b">age</code> with a <code class="cx pj pk pl pm b">Number</code> <a class="af ny" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank">JSON type</a> in the LLM response</li></ol><h1 id="3c0e" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Implementing a JSON schema</h1><p id="63e4" class="pw-post-body-paragraph nc nd fq ne b go ow ng nh gr ox nj nk nl oy nn no np oz nr ns nt pa nv nw nx fj bk">For this example, we will use the first sentence from <a class="af ny" href="https://en.wikipedia.org/wiki/Sam_Altman" rel="noopener ugc nofollow" target="_blank">Sam Altman’s Wikipedia entry</a>…</p><blockquote class="pn po pp"><p id="dbcc" class="nc nd nz ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Samuel Harris Altman (born April 22, 1985) is an American entrepreneur and investor best known as the CEO of OpenAI since 2019 (he was briefly fired and reinstated in November 2023).</p></blockquote><p id="aa57" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">…and we are going to use the latest GPT-4o checkpoint as a named-entity recognition (NER) system. We will enforce the following JSON schema:</p><pre class="mm mn mo mp mq pq pm pr bp ps bb bk"><span id="d70f" class="pt ob fq pm b bg pu pv l pw px">json_schema = {<br/>    "name": "NamedEntities",<br/>    "schema": {<br/>        "type": "object",<br/>        "properties": {<br/>            "entities": {<br/>                "type": "array",<br/>                "description": "List of entity names and their corresponding types",<br/>                "items": {<br/>                    "type": "object",<br/>                    "properties": {<br/>                        "name": {<br/>                            "type": "string",<br/>                            "description": "The actual name as specified in the text, e.g. a person's name, or the name of the country"<br/>                        },<br/>                        "type": {<br/>                            "type": "string",<br/>                            "description": "The entity type, such as 'Person' or 'Organization'",<br/>                            "enum": ["Person", "Organization", "Location", "DateTime"]<br/>                        }<br/>                    },<br/>                    "required": ["name", "type"],<br/>                    "additionalProperties": False<br/>                }<br/>            }<br/>        },<br/>        "required": ["entities"],<br/>        "additionalProperties": False<br/>    },<br/>    "strict": True<br/>}</span></pre><p id="728c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In essence, our LLM response should contain a <code class="cx pj pk pl pm b">NamedEntities</code> object, which consists of an array of <code class="cx pj pk pl pm b">entities</code>, each one containing a <code class="cx pj pk pl pm b">name</code> and <code class="cx pj pk pl pm b">type</code>. There are a few things to note here. We can for example enforce <em class="nz">Enum</em> type, which is very useful in NER since we can constrain the output to a fixed set of entity types. We must specify all the fields in the <code class="cx pj pk pl pm b">required</code> array: however, we can also emulate “optional” fields by setting the type to e.g. <code class="cx pj pk pl pm b">["string", null]</code> .</p><p id="f4f6" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We can now pass our schema, together with the data and the instructions to the API. We need to populate the <code class="cx pj pk pl pm b">response_format</code> argument with a <em class="nz">dict</em> where we set <code class="cx pj pk pl pm b">type</code> to <code class="cx pj pk pl pm b">"json_schema”</code> and then supply the corresponding schema.</p><pre class="mm mn mo mp mq pq pm pr bp ps bb bk"><span id="3048" class="pt ob fq pm b bg pu pv l pw px">completion = client.beta.chat.completions.parse(<br/>    model="gpt-4o-2024-08-06",<br/>    messages=[<br/>        {<br/>            "role": "system",<br/>            "content": """You are a Named Entity Recognition (NER) assistant.<br/>                Your job is to identify and return all entity names and their <br/>                types for a given piece of text. You are to strictly conform<br/>                only to the following entity types: Person, Location, Organization<br/>                and DateTime. If uncertain about entity type, please ignore it.<br/>                Be careful of certain acronyms, such as role titles "CEO", "CTO",<br/>                "VP", etc - these are to be ignore.""",<br/>        },<br/>        {<br/>            "role": "user",<br/>            "content": s<br/>        }<br/>    ],<br/>    response_format={<br/>        "type": "json_schema",<br/>        "json_schema": json_schema,<br/>    }<br/>)</span></pre><p id="d502" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The output should look something like this:</p><pre class="mm mn mo mp mq pq pm pr bp ps bb bk"><span id="d4d9" class="pt ob fq pm b bg pu pv l pw px">{   'entities': [   {'name': 'Samuel Harris Altman', 'type': 'Person'},<br/>                    {'name': 'April 22, 1985', 'type': 'DateTime'},<br/>                    {'name': 'American', 'type': 'Location'},<br/>                    {'name': 'OpenAI', 'type': 'Organization'},<br/>                    {'name': '2019', 'type': 'DateTime'},<br/>                    {'name': 'November 2023', 'type': 'DateTime'}]}</span></pre><p id="9294" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The full source code used in this article is available <a class="af ny" href="https://github.com/acatovic/structured-outputs-demo" rel="noopener ugc nofollow" target="_blank">here</a>.</p><h1 id="cbd1" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">How it works</h1><p id="f1c9" class="pw-post-body-paragraph nc nd fq ne b go ow ng nh gr ox nj nk nl oy nn no np oz nr ns nt pa nv nw nx fj bk">The magic is in the combination of <strong class="ne fr">constrained sampling</strong>, and <strong class="ne fr">context free grammar (CFG)</strong>. We mentioned previously that the overwhelming majority of pre-training data is “natural language”. Statistically this means that for every decoding/sampling step, there is a non-negligible probability of sampling some arbitrary token from the learned vocabulary (and in modern LLMs, vocabularies typically stretch across 40 000+ tokens). However, when dealing with formal schemas, we would really like to rapidly eliminate all improbable tokens.</p><p id="1311" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In the previous example, if we have already generated…</p><pre class="mm mn mo mp mq pq pm pr bp ps bb bk"><span id="9c06" class="pt ob fq pm b bg pu pv l pw px">{   'entities': [   {'name': 'Samuel Harris Altman',</span></pre><p id="1712" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">…then ideally we would like to place a very high logit bias on the <code class="cx pj pk pl pm b">'typ</code> token in the next decoding step, and very low probability on all the other tokens in the vocabulary.</p><p id="784e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This is in essence what happens. When we supply the schema, it gets converted into a formal grammar, or CFG, which serves to guide the logit bias values during the decoding step. CFG is one of those old-school computer science and natural language processing (NLP) mechanisms that is making a comeback. A very nice introduction to CFG was actually presented in <a class="af ny" href="https://stackoverflow.com/questions/6713240/what-is-a-context-free-grammar/6713333#6713333" rel="noopener ugc nofollow" target="_blank">this StackOverflow answer</a>, but essentially it is a way of describing transformation rules for a collection of symbols.</p><h1 id="6254" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Conclusion</h1><p id="62d7" class="pw-post-body-paragraph nc nd fq ne b go ow ng nh gr ox nj nk nl oy nn no np oz nr ns nt pa nv nw nx fj bk">Structured Outputs are nothing new, but are certainly becoming top-of-mind with proprietary APIs and LLM services. They provide a bridge between the erratic and unpredictable “natural language” domain of LLMs, and the deterministic and structured domain of software engineering. Structured Outputs are essentially a <strong class="ne fr">must</strong> for anyone designing complex LLM applications where LLM outputs must be shared or “presented” in various components. While API-native support has finally arrived, builders should also consider using libraries such as Outlines, as they provide a LLM/API-agnostic way of dealing with structured output.</p></div></div></div></div>    
</body>
</html>