["```py\nOPENAI_API_KEY = os.getenv(\"OPENAI_API_KEY\")\nOPENAI_DEPLOYMENT_NAME = \"gpt-35-turbo-16k\"\nOPENAI_DEPLOYMENT_ENDPOINT = \"https://<???>.openai.azure.com/\"\nOPENAI_DEPLOYMENT_VERSION = \"2023-12-01-preview\"\nOPENAI_MODEL_NAME = \"gpt-35-turbo-16k\"\n\nOPENAI_ADA_EMBEDDING_DEPLOYMENT_NAME = \"text-embedding-ada\"\nOPENAI_ADA_EMBEDDING_MODEL_NAME = \"text-embedding-ada-002\"\n\nllm = AzureChatOpenAI(\n    deployment_name=OPENAI_DEPLOYMENT_NAME,\n    model_name=OPENAI_MODEL_NAME,\n    openai_api_base=OPENAI_DEPLOYMENT_ENDPOINT,\n    openai_api_version=OPENAI_DEPLOYMENT_VERSION,\n    openai_api_key=OPENAI_API_KEY,\n    openai_api_type=\"azure\",\n    temperature=0.1,\n)\n\nembeddings = OpenAIEmbeddings(\n    deployment=OPENAI_ADA_EMBEDDING_DEPLOYMENT_NAME,\n    model=OPENAI_ADA_EMBEDDING_MODEL_NAME,\n    openai_api_base=OPENAI_DEPLOYMENT_ENDPOINT,\n    openai_api_type=\"azure\",\n    chunk_size=1,\n    openai_api_key=OPENAI_API_KEY,\n    openai_api_version=OPENAI_DEPLOYMENT_VERSION,\n)\n```", "```py\n# Loading the document\nfrom langchain.document_loaders import TextLoader\n\nloader = TextLoader(\"../data/globalcorp_hr_policy.txt\")\ndocuments = loader.load()\n```", "```py\npersist_directory = \"local_vectorstore\"\ncollection_name = \"hrpolicy\"\nPROJECT_ROOT = \"....\" #insert your project root directory name here\n\nvectorstore = Chroma(\n    persist_directory=os.path.join(PROJECT_ROOT, \"data\", persist_directory),\n    collection_name=collection_name,\n    embedding_function=embeddings,\n)\n```", "```py\nfrom langchain.storage._lc_store import create_kv_docstore\n\n# The storage layer for the parent documents\nlocal_store = \"local_docstore\"\nlocal_store = LocalFileStore(os.path.join(PROJECT_ROOT, \"data\", local_store))\ndocstore = create_kv_docstore(local_store)\n```", "```py\n# This text splitter is used to create the child documents\nparent_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=20)\nchild_splitter = RecursiveCharacterTextSplitter(chunk_size=200, chunk_overlap=20)\n\nretriever = ParentDocumentRetriever(\n    vectorstore=vectorstore,\n    docstore=docstore,\n    child_splitter=child_splitter,\n    parent_splitter=parent_splitter,\n)\n```", "```py\n# run only once\n# vectorstore.persist()\n# retriever.add_documents(documents, ids=None)\n```", "```py\nretriever.get_relevant_documents(\"communication initiatives?\")\n\n## OUTPUT ##\n[Document(page_content='**Health and Safety:**\\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\\n\\n**Communication:**\\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\\n\\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\\n\\n1.\\tRecruitment and Selection\\n1.\\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n Document(page_content='•\\ttwo satisfactory references;\\n•\\tconfirmation of the right to work in this country (if appropriate)\\n•\\tCriminal Records Disclosure (if appropriate).\\n6.\\tProbationary Period\\n\\t\\n6.1\\tAll appointments into the Company will be made subject to a probationary period of six calendar months. After three months a review meeting will take place between the post holder and their line manager to discuss progress. At the end of the probationary period, and subject to a satisfactory report by the appropriate head of section or line manager, employees will be notified in writing that they have successfully completed their probationary period. The probationary period can be extended by a further 3 months should the individuals line manager consider this appropriate.\\n7.\\tRecruitment Monitoring', metadata={'source': '../data/globalcorp_hr_policy.txt'})]\n```", "```py\nfrom langchain.chains import RetrievalQA\n\nqa = RetrievalQA.from_chain_type(\n    llm=llm,\n    chain_type=\"stuff\",\n    retriever=retriever,\n    return_source_documents=True,\n)\n```", "```py\nqa({\"query\": \"What is the allocated budget for communication initiatives?\"})\n\n## OUTPUT ##\n{'query': 'What is the allocated budget for communication initiatives?',\n 'result': 'The allocated budget for communication initiatives is $500,000 in the United States, €250,000 in Germany, and ¥25 million in Japan.',\n 'source_documents': [Document(page_content='**Health and Safety:**\\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\\n\\n**Communication:**\\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\\n\\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\\n\\n1.\\tRecruitment and Selection\\n1.\\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}\n```", "```py\nqa({\"query\": \"What is the probationary period?\"})\n\n## OUTPUT ##\n{'query': 'What is the probationary period?',\n 'result': \"The probationary period is a period of six calendar months during which an employee's performance and suitability for the job are assessed. At the end of the probationary period, if the employee's performance is satisfactory, they will be notified in writing that they have successfully completed their probationary period. The probationary period can be extended by a further 3 months if the employee's line manager deems it necessary.\",\n 'source_documents': [Document(page_content='•\\ttwo satisfactory references;\\n•\\tconfirmation of the right to work in this country (if appropriate)\\n•\\tCriminal Records Disclosure (if appropriate).\\n6.\\tProbationary Period\\n\\t\\n6.1\\tAll appointments into the Company will be made subject to a probationary period of six calendar months. After three months a review meeting will take place between the post holder and their line manager to discuss progress. At the end of the probationary period, and subject to a satisfactory report by the appropriate head of section or line manager, employees will be notified in writing that they have successfully completed their probationary period. The probationary period can be extended by a further 3 months should the individuals line manager consider this appropriate.\\n7.\\tRecruitment Monitoring', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}\n```", "```py\nqa({\"query\": \"What is the difference in the number of work hours in Germany vs. United States?\"})\n\n## OUTPUT ##\n{'query': 'What is the difference in the number of work hours in Germany vs. United States?',\n 'result': 'In Germany, the standard workweek is 38 hours (Monday to Friday, 8 AM to 5 PM), while in the United States, employees adhere to a standard 40-hour workweek (Monday to Friday, 9 AM to 5 PM). So, the difference in the number of work hours between Germany and the United States is 2 hours per week.',\n 'source_documents': [Document(page_content='**GlobalCorp Human Resources Policy**\\n\\nWelcome to GlobalCorp, where our Human Resources Policy is designed to provide a comprehensive framework for employees across our offices in the United States, Germany, and Japan. We operate under an at-will employment relationship, and any contractual agreements should be documented in writing.\\n\\nAt the core of our culture is a commitment to professionalism and ethical conduct. Clear and respectful communication is highly valued, and a business casual dress code is encouraged.\\n\\n**Work Hours:**\\nEmployees in the United States adhere to a standard 40-hour workweek (Monday to Friday, 9 AM to 5 PM). In Germany, the standard workweek is 38 hours (Monday to Friday, 8 AM to 5 PM), and in Japan, employees work 40 hours per week (Monday to Friday, 9 AM to 6 PM). Punctuality is paramount, and employees are expected to arrive on time. Time-off requests follow country-specific guidelines.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}\n```", "```py\n# incorrect as the currency conversion used is wrong. We need to fix this!\nqa({\"query\": \"What is the percentage difference in the annual budget for Japan and US?\"})\n\n## OUTPUT ##\n{'query': 'What is the percentage difference in the annual budget for Japan and US?',\n 'result': 'The annual budget for Japan is ¥50 million, and the annual budget for the United States is $500,000\\. To calculate the percentage difference, we need to convert the budgets to the same currency. Assuming an exchange rate of 1 USD = 100 JPY, the converted budget for Japan is ¥50 million = $500,000\\. \\n\\nThe percentage difference can be calculated as follows:\\n\\nPercentage Difference = ((Budget for Japan - Budget for US) / Budget for US) * 100\\n\\n= (($500,000 - $500,000) / $500,000) * 100\\n\\n= (0 / $500,000) * 100\\n\\n= 0%\\n\\nTherefore, the percentage difference in the annual budget for Japan and the United States is 0%.',\n 'source_documents': [Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}\n```", "```py\n# Results are still slightly off!\nqa({\"query\": \"What is the percentage difference in the annual budget for Japan and US if 1 USD = 147.72 JPY?\"})\n\n## OUTPUT ##\n{'query': 'What is the percentage difference in the annual budget for Japan and US if 1 USD = 147.72 JPY?',\n 'result': 'To calculate the percentage difference in the annual budget for Japan and the United States, we need to convert the budgets from their respective currencies to a common currency, such as USD. \\n\\nGiven that 1 USD = 147.72 JPY, we can convert the annual budget for Japan from JPY to USD by dividing it by the exchange rate:\\n\\nAnnual budget for Japan in USD = ¥50,000,000 / 147.72 = $338,164.25\\n\\nNow we can calculate the percentage difference between the annual budgets for Japan and the United States:\\n\\nPercentage difference = ((Annual budget for Japan - Annual budget for the United States) / Annual budget for the United States) * 100\\n\\nPercentage difference = (($338,164.25 - $1,000,000) / $1,000,000) * 100\\n\\nPercentage difference = (-$661,835.75 / $1,000,000) * 100\\n\\nPercentage difference = -66.18%\\n\\nTherefore, the percentage difference in the annual budget for Japan and the United States is approximately -66.18%.',\n 'source_documents': [Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}\n```", "```py\n# incorrect as technically US has higher budget after conversion\nqa({\"query\": \"Which country has the highest budget?\"})\n\n## OUTPUT ##\n{'query': 'Which country has the highest budget?',\n 'result': 'Japan has the highest budget for employee benefits, with an annual allocation of ¥50 million.',\n 'source_documents': [Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}),\n  Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]}\n```", "```py\nfrom langchain.tools.retriever import create_retriever_tool\n\ntool_search = create_retriever_tool(\n    retriever=retriever,\n    name=\"search_hr_policy\",\n    description=\"Searches and returns excerpts from the HR policy.\",\n)\n```", "```py\ntool_search.func\n\n## Output ##\n<bound method BaseRetriever.get_relevant_documents of ParentDocumentRetriever(vectorstore=<langchain_community.vectorstores.chroma.Chroma object at 0x11f0c5f10>, docstore=<langchain.storage.encoder_backed.EncoderBackedStore object at 0x11f0c5f40>, child_splitter=<langchain.text_splitter.RecursiveCharacterTextSplitter object at 0x11f0c5430>)>\n```", "```py\ntool.args_schema.schema()\n\n## Output ##\n{'title': 'RetrieverInput',\n 'description': 'Input to the retriever.',\n 'type': 'object',\n 'properties': {'query': {'title': 'Query',\n   'description': 'query to look up in retriever',\n   'type': 'string'}},\n 'required': ['query']}\n```", "```py\nfrom langchain import hub\nprompt = hub.pull(\"hwchase17/react\")\nprint(prompt.template)\n\n## OUTPUT ##\nAnswer the following questions as best you can. You have access to the following tools:\n\n{tools}\n\nUse the following format:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: the action to take, should be one of [{tool_names}]\nAction Input: the input to the action\nObservation: the result of the action\n... (this Thought/Action/Action Input/Observation can repeat N times)\nThought: I now know the final answer\nFinal Answer: the final answer to the original input question\n\nBegin!\n\nQuestion: {input}\nThought:{agent_scratchpad}\n```", "```py\nUse the context given to you to answer the question.\nWhen you come across time based questions like Has there been increase in sales from April last year and August last year,\nuse today's date as {today_date} for fetching exact start and end dates. Then your first action should be to fetch the sales data with metadata time between April 1st to April 30th.\nThat will be your answer 1\\. Your next action will be to fetch the sales data with metadata time between August 1st to\nAugust 31st, this will be your answer 2\\. Now analyse and understand each of answer 1 and answer 2, calculate the\npercentange change, compare them and answer the question.\n\nYou have access to the following tools:\n\n{tools}\nUse the following format:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: the action to take, should be one of [{tool_names}]\nAction Input: the input to the action\nObservation: the result of the action\n... (this Thought/Action/Action Input/Observation can repeat N times)\nThought: I now know the final answer\nFinal Answer: the final answer to the original input question\n\nBegin!\n\nQuestion: {input}\nThought:{agent_scratchpad}\n```", "```py\n# only creates the logical steps for us\nreact_agent = create_react_agent(llm, [tool_search], prompt)\n```", "```py\n# executes the logical steps we created\nagent_executor = AgentExecutor(\nagent=react_agent, \ntools=[tool],\nverbose=True,\nhandle_parsing_errors=True,\nmax_iterations = 5 # useful when agent is stuck in a loop\n)\n```", "```py\nquery = \"Which country has the highest budget?\"\nagent_executor.invoke({\"input\": query}) \n\n# if you are using the updated prompt with today's date passed to it\n# agent_executor.invoke({\"input\": query, \"today_date\": date.today()})\n\n## OUTPUT ##\n> Entering new AgentExecutor chain...\nI don't have access to information about country budgets. I should try searching for this information.\nAction: search_hr_policy\nAction Input: \"highest country budget\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\\n\\n**Communication:**\\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\\n\\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\\n\\n1.\\tRecruitment and Selection\\n1.\\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I found information about budgets in the HR policy, but it seems to be related to cybersecurity training, safety drills, and communication initiatives. It doesn't provide information about country budgets. I need to search for information about country budgets elsewhere.\nAction: search_hr_policy\nAction Input: \"country budgets\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**GlobalCorp Human Resources Policy**\\n\\nWelcome to GlobalCorp, where our Human Resources Policy is designed to provide a comprehensive framework for employees across our offices in the United States, Germany, and Japan. We operate under an at-will employment relationship, and any contractual agreements should be documented in writing.\\n\\nAt the core of our culture is a commitment to professionalism and ethical conduct. Clear and respectful communication is highly valued, and a business casual dress code is encouraged.\\n\\n**Work Hours:**\\nEmployees in the United States adhere to a standard 40-hour workweek (Monday to Friday, 9 AM to 5 PM). In Germany, the standard workweek is 38 hours (Monday to Friday, 8 AM to 5 PM), and in Japan, employees work 40 hours per week (Monday to Friday, 9 AM to 6 PM). Punctuality is paramount, and employees are expected to arrive on time. Time-off requests follow country-specific guidelines.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I still couldn't find information about country budgets in the HR policy. I should try searching for this information using a different tool or source.\nAction: search_external_source\nAction Input: \"highest country budget\"search_external_source is not a valid tool, try one of [search_hr_policy].I couldn't find information about country budgets in the HR policy or using the available tools. I need to consult a different source or resource to find the answer to this question.\nFinal Answer: I don't have access to information about which country has the highest budget.\n```", "```py\nquery = \"Is the budget for Japan different than United States?\"\nagent_executor.invoke({\"input\": query})\n\n## OUTPUT ## \n> Entering new AgentExecutor chain...\nI should check the HR policy to see if there is any information about budget differences between Japan and the United States.\nAction: search_hr_policy\nAction Input: \"budget differences between Japan and United States\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.\nAction: search_hr_policy\nAction Input: \"budget differences between Japan and United States\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.\nAction: search_hr_policy\nAction Input: \"budget differences between Japan and United States\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.\nAction: search_hr_policy\nAction Input: \"budget differences between Japan and United States\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found information about budget differences between Japan and the United States in the HR policy.\nFinal Answer: According to the HR policy, the annual budget for employee benefits in the United States is $1 million, while the budget for Japan is ¥50 million.\n\n> Finished chain.\n```", "```py\n# Testing Runnable in isolation\n\nfrom langchain_core.agents import AgentAction\nfrom langchain_core.runnables import Runnable, RunnablePassthrough\n\nagent_1 = RunnablePassthrough.assign(\n    agent_scratchpad=lambda x: format_log_to_str(x[\"intermediate_steps\"])\n)\ninput = {\n    \"input\": \"I love programming\",\n    \"intermediate_steps\": [\n        (AgentAction(tool=\"DummyTool\", tool_input=\"Foo\", log=\"Some log here\"), \"Result of the tool\")\n    ],\n}\noutput_1 = agent_1.invoke(input)\n\n## OUTPUT ## \n{'input': 'I love programming',\n 'intermediate_steps': [(AgentAction(tool='DummyTool', tool_input='Foo', log='Some log here'),\n   'Result of the tool')],\n 'agent_scratchpad': 'Some log here\\nObservation: Result of the tool\\nThought: '}\n```", "```py\n# Testing PromptTemplate in isolation\n\nagent_2 = prompt\noutput_2 = agent_2.invoke(output_1)\n\n## OUTPUT ##\nStringPromptValue(text='Answer the following questions as best you can. You have access to the following tools:\\n\\nsearch_hr_policy: Searches and returns excerpts from the HR policy.\\n\\nUse the following format:\\n\\nQuestion: the input question you must answer\\nThought: you should always think about what to do\\nAction: the action to take, should be one of [search_hr_policy]\\nAction Input: the input to the action\\nObservation: the result of the action\\n... (this Thought/Action/Action Input/Observation can repeat N times)\\nThought: I now know the final answer\\nFinal Answer: the final answer to the original input question\\n\\nBegin!\\n\\nQuestion: I love programming\\nThought:Some log here\\nObservation: Result of the tool\\nThought: ')\n```", "```py\n# Testing llm in isolation\n\nfrom langchain_core.prompt_values import StringPromptValue\ninp = StringPromptValue(text='Repeat everything I say - \"Parrot is a bird')\n\nllm_with_stop = llm.bind(stop=[\"bird\"])\nagent_3 = llm_with_stop\n\nagent_3.invoke(inp)\n\n## OUTPUT ##\nAIMessage(content='Parrot is a ')\n```", "```py\nfrom langchain_core.messages.ai import AIMessage\ncontent = AIMessage(content=\"I found information about the budget differences between US and Japan in the HR policy. I need to use the currency conversion tool to compare the budgets in USD.\\nAction: Currency conversion\\nAction Input: ¥50 million\")\n\nagent = ReActSingleInputOutputParser()\nagent.invoke(content)\n\n## OUTPUT ##\nAgentAction(tool='Currency conversion', tool_input='¥50 million', log='I found information about the budget differences between US and Japan in the HR policy. I need to use the currency conversion tool to compare the budgets in USD.\\nAction: Currency conversion\\nAction Input: ¥50 million')\n```", "```py\ncurrency_conversion = Tool(\n    name=\"Currency conversion\",\n    func=convert_currency_to_usd,\n    description=\"useful for converting currency into USD. Input should be an amount.\",\n)\n```", "```py\ndef value_to_float(x):\n    if type(x) == float or type(x) == int:\n        return x\n    x = x.upper()\n    if \"MILLION\" in x:\n        if len(x) > 1:\n            return float(x.replace(\"MILLION\", \"\")) * 1000000\n        return 1000000.0\n    if \"BILLION\" in x:\n        return float(x.replace(\"BILLION\", \"\")) * 1000000000\n    return 0.0\n\ndef convert_currency_to_usd(amount: str) -> int:\n    \"Converts currency into USD\"\n\n    if \"¥\" in amount:\n        exclude_symbol = amount.replace(\"¥\", \"\")\n        amount_in_numbers = value_to_float(exclude_symbol)\n        return amount_in_numbers / 147.72 #harcoded the exchange rate here for simplicity\n    if \"$\" in amount:\n        exclude_symbol = amount.replace(\"$\", \"\")\n        return value_to_float(exclude_symbol)\n```", "```py\ntools = [tool_search, currency_conversion] \n\nreact_agent = create_react_agent(llm, tools, prompt)\nagent_executor = AgentExecutor(\n    agent=react_agent, tools=tools, verbose=True, handle_parsing_errors=True\n)\n\nquery = \"Is the budget for Japan different than United States?\"\nagent_executor.invoke({\"input\": query})\n\n## OUTPUT ##\n> Entering new AgentExecutor chain...\nI should check the HR policy to see if there is any information about budget differences between Japan and the United States.\nAction: search_hr_policy\nAction Input: \"budget differences Japan United States\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\\n\\n**Communication:**\\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\\n\\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\\n\\n1.\\tRecruitment and Selection\\n1.\\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I found information about budget differences between Japan and the United States in the HR policy.\nAction: Currency conversion\nAction Input: ¥50 million338478.20200379094The budget for Japan is equivalent to $338,478.20 USD.\nFinal Answer: The budget for Japan is different than the United States.\n\n> Finished chain.\n\n{'input': 'Is the budget for Japan different than United States?',\n 'output': 'The budget for Japan is different than the United States.'}\n```", "```py\nquery = \"Calculate the difference in company budget for Japan and United States?\"\nagent_executor.invoke({\"input\": query})\n\n## OUTPUT ## \n> Entering new AgentExecutor chain...\nI need to find the company budget for Japan and the United States and then calculate the difference.\nAction: search_hr_policy\nAction Input: \"company budget Japan\"[Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Leave Policies - Germany:**\\nIn Germany, generous leave policies offer 30 days of paid vacation and 20 days of paid sick leave annually. An annual budget of €1 million is allocated for leave-related expenses.\\n\\n**Leave Policies - Japan:**\\nIn Japan, employees enjoy 20 days of paid vacation and 15 days of paid sick leave per year. An annual budget of ¥100 million is allocated for leave-related expenses.\\n\\n**Performance Management:**\\nPerformance reviews are conducted annually, with regular feedback provided to support professional development. GlobalCorp encourages continuous learning and allocates an annual budget of $5,000 per employee for training and development opportunities.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\\n\\n**Communication:**\\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\\n\\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\\n\\n1.\\tRecruitment and Selection\\n1.\\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I need to find the company budget for Japan and the United States and then calculate the difference.\nAction: search_hr_policy\nAction Input: \"company budget United States\"[Document(page_content='**Grievance and Disciplinary Procedures:**\\nOur grievance and disciplinary procedures are outlined on the company intranet. Termination conditions may include gross misconduct or repeated policy violations. In such cases, a disciplinary process will be followed, including a three-strike system, before termination. Employees leaving GlobalCorp should follow the exit process detailed in the employee handbook.\\n\\n**Confidentiality and Data Security:**\\nEmployees are expected to maintain confidentiality, and strict data security measures are in place. An annual budget of $1 million is allocated for cybersecurity training and awareness programs in the U.S., while budgets for Germany and Japan are €500,000 and ¥50 million, respectively.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States, employees enjoy health insurance, dental coverage, and a 401(k) retirement plan. An annual budget of $1 million is allocated for employee benefits.\\n\\n**Compensation and Benefits - Germany:**\\nIn Germany, benefits include health insurance, a pension plan, and an additional 5 days of vacation annually. An annual budget of €500,000 is allocated for employee benefits.\\n\\n**Compensation and Benefits - Japan:**\\nIn Japan, employees receive health insurance, a commuting allowance, and wellness benefits. An annual budget of ¥50 million is allocated for employee benefits.\\n\\n**Leave Policies - United States:**\\nIn the United States, employees have 15 days of paid vacation and 10 days of paid sick leave annually. An annual budget of $500,000 is allocated for leave-related expenses.', metadata={'source': '../data/globalcorp_hr_policy.txt'}), Document(page_content='**Health and Safety:**\\nWorkplace safety is a shared responsibility. Emergency procedures are clearly posted throughout our office buildings, and an annual budget of $10,000, €5,000, and ¥1 million is allocated for safety drills and equipment maintenance in the U.S., Germany, and Japan, respectively.\\n\\n**Communication:**\\nImportant updates are conveyed through company-wide emails and team meetings. An annual budget of $500,000, €250,000, and ¥25 million is allocated for communication initiatives, including employee engagement events in the U.S., Germany, and Japan, respectively.\\n\\nThis policy undergoes an annual review to ensure relevance and compliance. Welcome to GlobalCorp, where our commitment to a diverse, inclusive, and respectful workplace is the foundation of our success.\\n\\n1.\\tRecruitment and Selection\\n1.\\tIntroduction', metadata={'source': '../data/globalcorp_hr_policy.txt'})]I have found the company budget for Japan and the United States. Now I can calculate the difference.\nAction: Currency conversion\nAction Input: ¥50 million338478.20200379094I have converted the budget for Japan into USD.\nAction: Currency conversion\nAction Input: $1 million1000000.0I have converted the budget for the United States into USD.\nThought: I have the budgets for Japan and the United States in USD. Now I can calculate the difference.\nFinal Answer: The difference in company budget for Japan and the United States is $661,521.80.\n\n> Finished chain.\n\n{'input': 'Calculate the difference in company budget for Japan and United States?',\n 'output': 'The difference in company budget for Japan and the United States is $661,521.80.'}\n```", "```py\nclass Metrics(BaseModel):\n    num1: float = Field(description=\"Value 1\")\n    num2: float = Field(description=\"Value 2\")\n\n@tool(args_schema=Metrics)\ndef perc_diff(num1: float, num2: float) -> float:\n    \"\"\"Calculates the percentage difference between two numbers\"\"\"\n    return (np.abs(num1 - num2) / ((num1+num2)/2)) * 100\n```", "```py\nfrom langchain.tools import BaseTool, StructuredTool\n\nclass Metrics(BaseModel):\n    num1: float = Field(description=\"Value 1\")\n    num2: float = Field(description=\"Value 2\")\n\ndef perc_diff(num1: float, num2: float) -> float:\n    \"\"\"Calculates the percentage difference between two numbers\"\"\"\n    return (np.abs(num1 - num2) / ((num1+num2)/2)) * 100\n\npercentage_difference = StructuredTool.from_function(\n    func=perc_diff,\n    name=\"PercentageDifference\", # make sure there are no spaces as OAI Tools agent will throw an error\n    description=\"calculates percentage difference between 2 numbers\",\n    args_schema=Metrics,\n    return_direct=False,\n)\n```", "```py\ntools = [tool_search, currency_conversion, perc_diff]\nprompt_oai_tools = hub.pull(\"hwchase17/openai-tools-agent\")\noaitools_agent = create_openai_tools_agent(llm, tools, prompt_oai_tools)\noaitools_agent_executor = AgentExecutor(\n    agent=oaitools_agent, tools=tools, verbose=True, handle_parsing_errors=True\n)\n\nquery = \"As per the HR policy, compare the budgets for Japan and US.\"\noaitools_agent_executor.invoke({\"input\": query})\n\n## OUTPUT ##\n> Entering new AgentExecutor chain...\n\nInvoking: `search_hr_policy` with `{'query': 'employee benefits budget Japan'}`\n[Document(page_content='**Compensation and Benefits - Japan:**\\nIn Japan,....]\n\nInvoking: `search_hr_policy` with `{'query': 'employee benefits budget US'}`\n[Document(page_content='**Compensation and Benefits - United States:**\\nIn the United States,....]\n\nInvoking: `Currency_conversion` with `JPY 50000000`\n338478.20200379094\n\nInvoking: `Currency_conversion` with `USD 1000000`\nUSD 1000000\n\nInvoking: `percentage_difference` with `{'metric1': 338478.20200379094, 'metric2': 1000000}`\n98.85The percentage difference in budgets for employee benefits between Japan and the US is approximately 98.85%, with the US budget being higher.\n\n> Finished chain.\n\n{'input': 'As per the HR policy, what is the percentage difference in budgets for employee benefits in Japan vs US.',\n 'output': 'The percentage difference in budgets for employee benefits between Japan and the US is approximately 98.85%, with the US budget being higher.'}\n```", "```py\n# Before\n# Model name: gpt-35-turbo\n# Model version: 0301\nresponse = llm(messages=[message], tools=tools)\n\n## OUTPUT ## \nopenai.error.InvalidRequestError: Unrecognized request argument supplied: tools\n```", "```py\n# After\n# Model name: gpt-35-turbo\n# Model version: 0613\nresponse = llm(messages=[message], tools=tools)\n\n## OUTPUT ##\ncontent='' additional_kwargs={'tool_calls': [<OpenAIObject id=call_8lvikb3ZqflGrr2xGgPGWXoJ at 0x10aa67270> JSON: {\n  \"id\": \"call_8lvikb3ZqflGrr2xGgPGWXoJ\",\n  \"type\": \"function\",\n  \"function\": {\n    \"name\": \"get_current_weather\",\n    \"arguments\": \"{\\n  \\\"location\\\": \\\"San Francisco\\\"\\n}\"\n  }\n}]}\n```"]