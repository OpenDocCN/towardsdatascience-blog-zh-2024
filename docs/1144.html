<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>PCA & K-Means for Traffic Data in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>PCA & K-Means for Traffic Data in Python</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pca-k-means-for-traffic-data-in-python-a0ec66ab4789?source=collection_archive---------2-----------------------#2024-05-07">https://towardsdatascience.com/pca-k-means-for-traffic-data-in-python-a0ec66ab4789?source=collection_archive---------2-----------------------#2024-05-07</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="383a" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Reduce dimensionality and cluster Taipei MRT stations based on hourly traffic</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@beth-ouyang?source=post_page---byline--a0ec66ab4789--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Beth Ou Yang" class="l ep by dd de cx" src="../Images/d182a3e58759953dcf90039c064390ac.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*aOt41Whx4IM7FYWcZJfgGA.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--a0ec66ab4789--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@beth-ouyang?source=post_page---byline--a0ec66ab4789--------------------------------" rel="noopener follow">Beth Ou Yang</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--a0ec66ab4789--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">8 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">May 7, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">5</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/9e36326467465bce72fda2a126249d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ce105yEoDMTm1zZSqcH0bg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Taipei Rail Map ( Actually Introduced Romanization Standards based ) Including THSR, TRA, Taipei MRT &amp; Other Lines. Image by <a class="af nc" href="https://commons.wikimedia.org/wiki/User:Taiwan_Junior" rel="noopener ugc nofollow" target="_blank">Taiwan J</a>.</figcaption></figure><p id="3b66" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Principal Component Analysis (PCA) has been used in traffic data to detect anomalies, but it can also be used to capture the patterns of a transit station’s traffic history, just like what it does on the purchase data of a customer.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="0064" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk"><strong class="al">In this article, we will go through:</strong></h2><ol class=""><li id="80da" class="nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny ph pi pj bk">What tricks does PCA do</li><li id="6185" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">What can we do after applying PCA</li><li id="5bd7" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk"><strong class="nf fr">Playtime</strong>! <br/>Take a look into our dataset: <br/><a class="af nc" href="https://www.kaggle.com/datasets/bethouyang/taipei-mrt-hourly-traffic-data" rel="noopener ugc nofollow" target="_blank">Taipei Metro Rapid Transit System, Hourly Traffic Data</a><br/><a class="af nc" href="https://www.kaggle.com/code/bethouyang/pca-k-means-for-traffic-data-in-python" rel="noopener ugc nofollow" target="_blank">Full code</a> is also included in the above kaggle dataset.</li><li id="3f2a" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">Using PCA on hourly traffic data</li><li id="189b" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">Clustering on the PCA result</li><li id="5723" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">Insights on the Taipei MRT traffic</li><li id="1060" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">Key takeaways</li></ol></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="1f50" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">1. What tricks does PCA do</h2><p id="a507" class="pw-post-body-paragraph nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny fj bk">In brief, PCA summarizes the data by finding linear combinations of features, which can be thought of as taking several pictures of an 3D object, and it will naturally sort the pictures by the most representative to the least before handing to you.</p><p id="9efa" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">With the input being our original data, there would be 2 useful outputs of PCA: <strong class="nf fr">Z </strong>and<strong class="nf fr"> W</strong>. By multiply them, we can get the reconstruction data, which is the original data but with some tolerable information loss (since we have reduced the dimensionality.)</p><p id="7cb2" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We will explain these 2 output matrices with our data in the practice below.</p><h2 id="0d0c" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">2. What can we do after applying PCA</h2><p id="1274" class="pw-post-body-paragraph nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny fj bk">After applying PCA to our data to reduce the dimensionality, we can use it for other machine learning tasks, such as clustering, classification, and regression.</p><p id="5483" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In the case of Taipei MRT later in this artical, we will perform clustering on the lower dimensional data, where a few dimensions can be interpreted as passenger proportions in different parts of a day, such as morning, noon, and evening. Those stations share similar proportions of passengers in the daytime would be consider to be in the same cluster (their patterns are alike!).</p><h2 id="611c" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">3. Take a look in <strong class="al">our traffic dataset!</strong></h2><p id="9fe2" class="pw-post-body-paragraph nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny fj bk">The datast we use here is <a class="af nc" href="https://www.kaggle.com/datasets/bethouyang/taipei-mrt-hourly-traffic-data" rel="noopener ugc nofollow" target="_blank">Taipei Metro Rapid Transit System, Hourly Traffic Data</a>, with columns: <code class="cx pp pq pr ps b">date, hour, origin, destination, passenger_count</code>.</p><p id="2cd9" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In our case, I will keep weekday data only, since there are more interesting patterns between different stations during weekdays, such as stations in residential areas may have more commuters entering in the daytime, while in the evening, those in business areas may have more people getting in.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pt"><img src="../Images/533227a1535cfdcb7b77e75a8a2557e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4q48iZj9ld6xf0ZArZkN4w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Stations in residential areas may have more commuters entering in the daytime.</figcaption></figure><p id="2ca1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The plot above is 4 different staitons’ hourly traffic trend (the amount the passengers entering into the station). The 2 lines in red are Xinpu and Yongan Market, which are actually located in the super crowded areas in New Taipei City. On the otherhands, the 2 lines in blue are Taipei City Hall and Zhongxiao Fuxing, where most of the companies locate and business activities happen.</p><p id="1eec" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The trends reflect both the nature of these areas and stations, and we can notice that the difference is most obvious when comparing their trends during commute hours (7 to 9 a.m., and 17 to 19 p.m.).</p><h2 id="4b6a" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">4. Using PCA on hourly traffic data</h2><p id="fa22" class="pw-post-body-paragraph nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny fj bk">Why reducing dimensionality before conducting further machine learning tasks?</p><p id="8a30" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">There are 2 main reasons:</p><ol class=""><li id="9cca" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny ph pi pj bk"><strong class="nf fr">As the number of dimensions increases</strong>, all data points appear to be sparse and dissimilar in many ways, which would be refered to as “the curse of dimensionality”.</li><li id="db01" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">Due to the <strong class="nf fr">high-dimensional </strong>nature of the traffic data, it is <strong class="nf fr">difficult to visualize</strong> <strong class="nf fr">and interpret</strong>.</li></ol><p id="8903" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">By applying PCA, we can identify the hours when the traffic trends of different stations are most obvious and representative. Intuitively, by the plot shown previously, we can assume that hours around 8 a.m. and 18 p.m. may be representative enough to cluster the stations.</p><p id="863d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Remember we mentioned the useful output matrices, Z and W, of PCA in the <a class="af nc" href="#1f50" rel="noopener ugc nofollow">previous section</a>? Here, we are going to interpret them with our MRT case.</p><p id="4cf9" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr"><em class="pu">Original data, X</em></strong></p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pv"><img src="../Images/8f069365eec76c988e00eee62ec8d0bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJca6K6e3r3Fn0Eo2NE3Fg.png"/></div></div></figure><ul class=""><li id="15cd" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny pw pi pj bk">Index : stations</li><li id="f71a" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny pw pi pj bk">Column : hours</li><li id="8c18" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny pw pi pj bk">Values : the proportion of passenger entering in the specific hour (For each station: #passenger / #total passengers)</li></ul><p id="b7d8" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">With such X, we can apply PCA by the following code:</p><pre class="mm mn mo mp mq px ps py bp pz bb bk"><span id="d5e6" class="qa oi fq ps b bg qb qc l qd qe">from sklearn.decomposition import PCA<br/><br/>n_components = 3<br/>pca = PCA(n_components=n_components)<br/><br/>X_tran = StandardScaler().fit_transform(X)<br/><br/>pca.fit(X_tran)</span></pre><p id="4b29" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Here, we specify the parameter <strong class="nf fr">n_components</strong><em class="pu"> </em>to be 3, which implies that PCA will extract the 3 most significant components for us.</p><p id="92a0" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Note that, it is like “<em class="pu">taking several pictures of an 3D object, and it will sort the pictures by the most representative to the least,</em>” and we choose the top 3 pictures. So, if we set <strong class="nf fr">n_components</strong><em class="pu"> </em>to be 5, we will get 2 more pictures, but our top 3 will remain the same!</p><p id="521d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr"><em class="pu">PCA output, W matrix</em></strong></p><p id="bf5f" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">W </strong>can be thought of as the weights on each features (i.e. hours) with regard to our “pictures”, or more specificly, <strong class="nf fr">principal components</strong>.</p><pre class="mm mn mo mp mq px ps py bp pz bb bk"><span id="574f" class="qa oi fq ps b bg qb qc l qd qe">pd.set_option('precision', 2)<br/><br/>W = pca.components_<br/>W_df = pd.DataFrame(W, columns=hour_mapper.keys(), index=[f'PC_{i}' for i in range(1, n_components+1)])<br/>W_df.round(2).style.background_gradient(cmap='Blues')</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qf"><img src="../Images/b6650ff1b3d09c6532026a9c8c47e445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DogEBrxdoZiwLG-4zDL0yg.png"/></div></div></figure><p id="30fa" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">For our 3 principal components, we can see that PC_1 weights more on night hours, while PC_2 weights more on noon, and PC_3 is about morning time.</p><p id="b931" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr"><em class="pu">PCA output, Z matrix</em></strong></p><p id="f24e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We can interpret <strong class="nf fr">Z </strong>matrix as the representations of stations.</p><pre class="mm mn mo mp mq px ps py bp pz bb bk"><span id="b1e6" class="qa oi fq ps b bg qb qc l qd qe">Z = pca.fit_transform(X)<br/><br/># Name the PCs according to the insights on W matrix<br/>Z_df = pd.DataFrame(Z, index=origin_mapper.keys(), columns=['Night', 'Noon', 'Morning'])<br/><br/># Look at the stations we demonstrated earlier<br/>Z_df = Z_df.loc[['Zhongxiao_Fuxing', 'Taipei_City_Hall', 'Xinpu', 'Yongan_Market'], :]<br/>Z_df.style.background_gradient(cmap='Blues', axis=1)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qg"><img src="../Images/7149bc2c7b25cf5e4b0ed63493a3cdc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*HYqeUR0YrbrGEsZZpR5AqA.png"/></div></figure><p id="5b0b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In our case, as we have interpreted the W matrix and understood the latent meaning of each components, we can assign the PCs with names.</p><p id="122c" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The Z matrix for these 4 stations indicates that the first 2 stations have larger proportion of night hours, while the other 2 have more in the mornings. This distribution also seconds the findings in our EDA (recall the line chart of these 4 stations in the earlier part).</p><h2 id="b8b2" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">5. Clustering on the PCA result with K-Means</h2><p id="7a66" class="pw-post-body-paragraph nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny fj bk">After getting the PCA result, let’s further cluster the transit stations according to their traffic patterns, which is represented by 3principal components.</p><p id="2ba0" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In the last section, Z matrix has representations of stations with regard to night, noon, and morning.</p><p id="6827" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We will cluster the stations based on these representations, such that the stations in the same group would have similar passenger distributions among these 3 periods.</p><p id="da5d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">There are bunch of clustering methods, such as K-Means, DBSCAN, hierarchical clustering, e.t.c. Since the main topic here is to see the convenience of PCA, we will skip the process of experimenting which method is more suitable, and go with <strong class="nf fr">K-Means</strong>.</p><pre class="mm mn mo mp mq px ps py bp pz bb bk"><span id="8b35" class="qa oi fq ps b bg qb qc l qd qe">from sklearn.cluster import KMeans<br/><br/># Fit Z matrix to K-Means model <br/>kmeans = KMeans(n_clusters=3)<br/>kmeans.fit(Z)</span></pre><p id="cc06" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">After fitting the K-Means model, let’s visualize the clusters with 3D scatter plot by <a class="af nc" href="https://plotly.com/python/3d-scatter-plots/" rel="noopener ugc nofollow" target="_blank">plotly</a>.</p><pre class="mm mn mo mp mq px ps py bp pz bb bk"><span id="4c9a" class="qa oi fq ps b bg qb qc l qd qe">import plotly.express as px<br/><br/>cluster_df = pd.DataFrame(Z, columns=['PC1', 'PC2', 'PC3']).reset_index()<br/><br/># Turn the labels from integers to strings, <br/># such that it can be treated as discrete numbers in the plot.<br/>cluster_df['label'] = kmeans.labels_<br/>cluster_df['label'] = cluster_df['label'].astype(str)<br/><br/>fig = px.scatter_3d(cluster_df, x='PC1', y='PC2', z='PC3', <br/>                       color='label', <br/>                       hover_data={"origin": (pca_df['index'])},<br/>                       labels={<br/>                          "PC1": "Night",<br/>                          "PC2": "Noon",<br/>                          "PC3": "Morning",<br/>                          },<br/>                      opacity=0.7,<br/>                      size_max=1,<br/>                      width = 800, height = 500<br/>                    ).update_layout(margin=dict(l=0, r=0, b=0, t=0)<br/>                    ).update_traces(marker_size = 5)<br/></span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qh"><img src="../Images/7d09ac0d02ba0ba94479078c60e23685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmzT7xKvuIbUeEjFPzyGCA.gif"/></div></div></figure><h2 id="c86f" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">6. Insights on the Taipei MRT traffic — Clustering results</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qi"><img src="../Images/061d07d462968e4e9f17f73d5838ab51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8kXDxPZg_Z-teSnlanhLQ.png"/></div></div></figure><ul class=""><li id="89df" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny pw pi pj bk"><strong class="nf fr">Cluster 0 </strong>: More passengers in daytime, and therefore it may be the “living area” group.</li><li id="931b" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny pw pi pj bk"><strong class="nf fr">Cluster 2</strong> : More passengers in evening, and therefore it may be the “business area” group.</li><li id="f024" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny pw pi pj bk"><strong class="nf fr">Cluster 1</strong> : Both day and night hours are full of people entering the stations, and it is more complicated to explain the nature of these stations, for there could be variant reasons for different stations. Below, we will take a look into 2 extreme cases in this cluster.</li></ul><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qj"><img src="../Images/7609ef3f6ef55d89c339bd98e2def7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*af69v7sMophH9cjPV6UvAg.png"/></div></div></figure><p id="1a73" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">For example, in <strong class="nf fr">Cluster 1</strong>, the station with the largest amount of passengers, Taipei Main Station, is a huge transit hub in Taipei, where commuters are allowed to transfer from buses and railway systems to MRT here. Therefore, the high-traffic pattern during morning and evening is clear.</p><p id="f693" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">On the contrary, Taipei Zoo station is in Cluster 1 as well, but it is not the case of “both day and night hours are full of people”. Instead, there is not much people in either of the periods because few residents live around that area, and most citizens seldom visit Taipei Zoo on weekdays.</p><p id="a66a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The patterns of these 2 stations are not much alike, while they are in the same cluster. That is, Cluster 1 might contain too many stations that are actually not similar. Thus, in the future, we would have to fine-tune hyper-parameters of K-Means, such as the number of clusters, and methods like <strong class="nf fr">silhouette score</strong> and <strong class="nf fr">elbow method</strong> would be helpful.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="4e37" class="qk oi fq bf oj ql qm gq on qn qo gt or qp qq qr qs qt qu qv qw qx qy qz ra rb bk">Conclusion</h1><p id="ec79" class="pw-post-body-paragraph nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny fj bk">In summary,</p><ol class=""><li id="02e2" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny ph pi pj bk">Applying PCA on traffic data to reduce dimensionality can be implemented as extracting 3 important periods (morning, noon, evening)<strong class="nf fr"> </strong>from totally 21 working hours<strong class="nf fr">.</strong></li><li id="548f" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">PCA outputs are W and Z matrices, where Z can be viewed as the representations of stations with regard to principal components (time periods), and W can be thought of as the representations of principal components (time periods) with regard to original features (hours).</li><li id="7c70" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">Considering W matrix can help us understand the latent meaning of each principal component.</li><li id="36ba" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny ph pi pj bk">Clustering methods can be used on the PCA output, Z matrix.</li></ol><blockquote class="rc rd re"><p id="99b1" class="nd ne pu nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Note that we skipped EDA and hyper-parameters tuning here in order to focus on the topic of this article, but they are actually important.</p></blockquote><p id="9875" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Thank you for reading so far! <br/>Hope you have a wonderful online journey in Taipei 🫶</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="fc33" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">Further Readings</h2><ul class=""><li id="19b6" class="nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny pw pi pj bk"><a class="af nc" rel="noopener" target="_blank" href="/kmeans-hyper-parameters-explained-with-examples-c93505820cd3">KMeans Hyper-parameters Explained with Examples</a>, Sujeewa Kumaratunga PhD</li><li id="2b02" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny pw pi pj bk"><a class="af nc" href="https://365datascience.com/tutorials/python-tutorials/pca-k-means/" rel="noopener ugc nofollow" target="_blank">How to Combine PCA and K-means Clustering in Python?</a>, Elitsa Kaloyanova</li></ul><h2 id="3a7b" class="oh oi fq bf oj ok ol om on oo op oq or nm os ot ou nq ov ow ox nu oy oz pa pb bk">Reference</h2><ul class=""><li id="6bdb" class="nd ne fq nf b go pc nh ni gr pd nk nl nm pe no np nq pf ns nt nu pg nw nx ny pw pi pj bk">DSCI 563 Lecture Notes, UBC Master of Data Science, Varada Kolhatkar</li><li id="411d" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny pw pi pj bk"><a class="af nc" href="https://medium.com/swlh/k-means-clustering-on-high-dimensional-data-d2151e1a4240" rel="noopener">K Means Clustering on High Dimensional Data.</a>, shivangi singh</li><li id="3243" class="nd ne fq nf b go pk nh ni gr pl nk nl nm pm no np nq pn ns nt nu po nw nx ny pw pi pj bk"><a class="af nc" rel="noopener" target="_blank" href="/curse-of-dimensionality-a-curse-to-machine-learning-c122ee33bfeb">Curse of Dimensionality — A “Curse” to Machine Learning</a>, Shashmi Karanam</li></ul><p id="748e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><em class="pu">Unless otherwise noted, all images are by the author.</em></p></div></div></div></div>    
</body>
</html>