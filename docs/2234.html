<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Can You See the War from Space?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Can You See the War from Space?</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/can-you-see-the-war-from-space-6d847d755edf?source=collection_archive---------6-----------------------#2024-09-12">https://towardsdatascience.com/can-you-see-the-war-from-space-6d847d755edf?source=collection_archive---------6-----------------------#2024-09-12</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="0756" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Case study of the Russian-Ukrainian war</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@alexroz?source=post_page---byline--6d847d755edf--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Aleksei Rozanov" class="l ep by dd de cx" src="../Images/748b69bfaccf39c9aa568a9e6f41eec3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*JISS93SvFnwE3NMNTl8HAQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--6d847d755edf--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@alexroz?source=post_page---byline--6d847d755edf--------------------------------" rel="noopener follow">Aleksei Rozanov</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--6d847d755edf--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Sep 12, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">7</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/37f76406467e64438710bfbca28feafd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iKSmHs82oQftvjG4"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@dtolokonov?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dmytro Tolokonov</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="66d7" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk nz"><span class="l oa ob oc bo od oe of og oh ed">A</span>lmost three years have passed since Russia invaded Ukraine’s territory on February 24th, 2024. This bloody war has destroyed or somehow affected dozens of thousands of families on both sides of the conflict. There is plenty of evidence across the internet shedding light on human suffering and pain brought by this war, one of the main sources of data being aerial and space imagery.</p><p id="71a5" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Many private and military high-resolution space sensors are monitoring this region to obtain crucial information about troop movement, infrastructure, and environment near-real time. Unfortunately, this kind of data is often not available to a regular user, like we are, but a great amount of other satellites pass over Ukraine daily, so we could try to extract some meaningful information from free-access datasets and have a look at what’s going on there.</p><p id="d569" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In this article, let’s try to find out if there is a change in <strong class="nf fr"><em class="oi">night time lights radiance</em></strong> after the beginning of the war and see if there is a decline of this value in contrast, before/after the beginning of the war. This short investigation will be focused on three major cities in Ukraine: <strong class="nf fr">Kiev</strong>, <strong class="nf fr">Kharkov,</strong> and <strong class="nf fr">Odessa</strong>.</p><blockquote class="oj ok ol"><p id="88b6" class="nd ne oi nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">NASA Visible Infrared Imaging Radiometer Suite (VIIRS) has Day/Night Band (DNB) onboard, which is perfect for our purposes. This data is distributed with daily temporal resolution and ~500 m spatial one. But since we don’t want to deal with at least 365*3 files to produce the analysis, instead we’ll investigate <em class="fq">monthly average composites</em> with atmospheric corrections. <a class="af nc" href="https://developers.google.com/earth-engine/datasets/catalog/NOAA_VIIRS_DNB_MONTHLY_V1_VCMSLCFG#description" rel="noopener ugc nofollow" target="_blank">This data product</a> is distributed by Google Earth Engine (GEE) with free access, so no data downloading is required.</p></blockquote><p id="b6e1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The content of the article is split on the following sections:</p><ul class=""><li id="71c0" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny om on oo bk"><strong class="nf fr">Data acquisition and preprocessing</strong></li><li id="b2cc" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny om on oo bk"><strong class="nf fr">Anomaly calculation</strong></li><li id="f8f7" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny om on oo bk"><strong class="nf fr">Mapping and creating a GIF</strong></li><li id="dcdd" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny om on oo bk"><strong class="nf fr">Correlation with attacks</strong></li></ul><blockquote class="oj ok ol"><p id="57e6" class="nd ne oi nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">As always the code of this article you can find on my <a class="af nc" href="https://github.com/alexxxroz/Medium/blob/main/WarFromSpace.ipynb" rel="noopener ugc nofollow" target="_blank">GitHub</a>.</p></blockquote></div></div></div><div class="ab cb ou ov ow ox" role="separator"><span class="oy by bm oz pa pb"/><span class="oy by bm oz pa pb"/><span class="oy by bm oz pa"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="d8de" class="pc pd fq bf pe pf pg gq ph pi pj gt pk pl pm pn po pp pq pr ps pt pu pv pw px bk"><strong class="al">Data acquisition and preprocessing</strong></h1><p id="ac8b" class="pw-post-body-paragraph nd ne fq nf b go py nh ni gr pz nk nl nm qa no np nq qb ns nt nu qc nw nx ny fj bk">First thing first, to begin the analysis we need to have on hand the actual territory of these cities. To get them you can either use Google Earth Engine dataset called <a class="af nc" href="https://developers.google.com/earth-engine/datasets/catalog/FAO_GAUL_2015_level2" rel="noopener ugc nofollow" target="_blank">FAO GAUL: Global Administrative Unit Layers 2015</a> or the <a class="af nc" href="https://gadm.org/data.html" rel="noopener ugc nofollow" target="_blank">GADM website</a>. As a result we should end up with a bunch of polygons each resembling a Ukrainian region.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qd"><img src="../Images/a59bddb3908c1e9369082c1e238ebe1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*6Ia6BFAZM0rFocpP3gfnNA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="881e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To create such a visualization you’ll need to download the aforementioned boundaries and read them using <em class="oi">geopandas </em>library:</p><pre class="mm mn mo mp mq qe qf qg bp qh bb bk"><span id="1be4" class="qi pd fq qf b bg qj qk l ql qm">shape = gpd.read_file('YOUR_FILE.shp')<br/>shape = shape[(shape['NAME_1']=='Kiev') | (shape['NAME_1']=='Kiev City') | (shape['NAME_1']=='?') | (shape['NAME_1']=='Kharkiv')|\<br/>              (shape['NAME_1']=='Odessa')]<br/>shape.plot(color='grey', edgecolor='black')<br/><br/>plt.axis('off')<br/>plt.text(35,48, 'Kharkov', fontsize=20)<br/>plt.text(31,46, 'Odessa', fontsize=20)<br/>plt.text(31,49, 'Kiev', fontsize=20)<br/>plt.savefig('UKR_shape.png')<br/>plt.show()</span></pre><p id="f315" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The second step for us is going to be acquisition of VIIRS data through GEE. If you download the shape of Ukrainian regions from the internet, you’ll need to wrap it into a GEE geometry object. Otherwise you’ve already got it ready to use.</p><pre class="mm mn mo mp mq qe qf qg bp qh bb bk"><span id="6fe0" class="qi pd fq qf b bg qj qk l ql qm">import json<br/>import ee<br/><br/>js = json.loads(shape.to_json())<br/>roi = ee.Geometry(ee.FeatureCollection(js).geometry())</span></pre><p id="ce3a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Now let’s define the timeline of our research. Conceptually, to understand if the night time light radiance after the beginning of the war was anomalous, we need to know the values before. So we will be working with the whole time frame available: from <strong class="nf fr">2012–01–01</strong> to <strong class="nf fr">2024–04–01</strong>. Data before 2022–02–01 will be considered as <strong class="nf fr">«a norm»</strong> and everything after will be subtracted from this norm, hence, representing a <strong class="nf fr">deviation (anomaly)</strong>.</p><pre class="mm mn mo mp mq qe qf qg bp qh bb bk"><span id="34b9" class="qi pd fq qf b bg qj qk l ql qm">startDate = pd.to_datetime('2012-01-01')<br/>endDate = pd.to_datetime('2024-04-01')<br/>data = ee.ImageCollection("NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG")\<br/>                  .filterBounds(roi)\<br/>                  .filterDate(start = startDate, end=endDate)</span></pre><p id="ee52" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Our final result will include a map and anomaly plot. To perform this visualization we need to collect <strong class="nf fr">monthly night time lights radiance<em class="oi"> </em>maps</strong> between 2022–02–01 and 2024–04–01 and <strong class="nf fr">average monthly night time lights radiance</strong><em class="oi"> (in the form of time series) </em>for each region. The best way to do that is to iterate through a list of GEE images and saving a <em class="oi">.csv</em> and <em class="oi">.npy</em> files as the result.</p><blockquote class="oj ok ol"><p id="0f45" class="nd ne oi nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Important! </strong>The VIIRS dataset comprises a really valuable variable <strong class="nf fr">cf_cvg</strong>, which describes the total number of observations that went into each pixel (cloud-free pixels). In essence, it’s a quality flag. The bigger this number, the higher quality we have. In this analysis, when calculating the norm, we will filter out all the pixels with <strong class="nf fr"><em class="fq">cf_cvg≤1</em></strong><em class="fq">.</em></p></blockquote><pre class="mm mn mo mp mq qe qf qg bp qh bb bk"><span id="bbe4" class="qi pd fq qf b bg qj qk l ql qm">arrays, dates, rads = [], [], []<br/>  if data.size().getInfo()!=0:<br/>      data_list = data.toList(data.size())<br/>      for i in range(data_list.size().getInfo()):<br/>          array, date = to_array(data_list,i, roi)<br/><br/>          rads.append(array['avg_rad'][np.where(array['cf_cvg']&gt;1)].mean())<br/>          dates.append(date)<br/>          if date&gt;=pd.to_datetime('2022-01-01'):<br/>            arrays.append(array['avg_rad'])<br/>          print(f'Index: {i+1}/{data_list.size().getInfo()+1}')<br/>  df = pd.DataFrame({'date': dates, 'avg_rad':rads})<br/>  np.save(f'{city}.npy', arrays, allow_pickle=True)<br/>  df.to_csv(f'{city}.csv', index=None)</span></pre><h1 id="1b0e" class="pc pd fq bf pe pf qn gq ph pi qo gt pk pl qp pn po pp qq pr ps pt qr pv pw px bk"><strong class="al">Anomaly Calculation</strong></h1><p id="621c" class="pw-post-body-paragraph nd ne fq nf b go py nh ni gr pz nk nl nm qa no np nq qb ns nt nu qc nw nx ny fj bk">The generated files of the format <em class="oi">city.csv</em> with the <strong class="nf fr"><em class="oi">avg_rad</em></strong> time series inside are perfect for anomaly calculation. The process is extremely simple:</p><ol class=""><li id="c843" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qs on oo bk">Filter out observations before 2022–02–01;</li><li id="17c5" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny qs on oo bk">Group by all the observations by month (in total — 12 groups);</li><li id="0c86" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny qs on oo bk">Take a mean;</li><li id="ba8b" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny qs on oo bk">Subtract the mean from the observations after 2022–02–01 for <strong class="nf fr">each month respectively</strong>.</li></ol><pre class="mm mn mo mp mq qe qf qg bp qh bb bk"><span id="2fd3" class="qi pd fq qf b bg qj qk l ql qm">df = pd.read_csv(f'{city}.csv')<br/>df.date = pd.to_datetime(df.date)<br/>ts_lon = df[df.date&lt;pd.to_datetime('2022-01-01')].set_index('date')<br/>means = ts_lon.groupby(ts_lon.index.month).mean()<br/><br/>ts_short = df[df.date&gt;=pd.to_datetime('2022-01-01')].set_index('date')<br/>ts_short['month'] = ts_short.index.month<br/>anomaly = ts_short['avg_rad']-ts_short['month'].map(means['avg_rad'])</span></pre><h1 id="c5e9" class="pc pd fq bf pe pf qn gq ph pi qo gt pk pl qp pn po pp qq pr ps pt qr pv pw px bk"><strong class="al">Mapping and creating a GIF</strong></h1><p id="1381" class="pw-post-body-paragraph nd ne fq nf b go py nh ni gr pz nk nl nm qa no np nq qb ns nt nu qc nw nx ny fj bk">Our last step to actually see the first result is building two subplots: a map + anomalies time series. We are not going to do any static maps today. To implement a GIF, let’s build a nested function drawing our subplots:</p><pre class="mm mn mo mp mq qe qf qg bp qh bb bk"><span id="501d" class="qi pd fq qf b bg qj qk l ql qm">def plot(city, arrays, dates, rads):<br/>  def update(frame):<br/>    im1.set_data(arrays[frame])<br/><br/>    info_text = (<br/>        f"Date: {pd.to_datetime(dates[frame]).strftime(format='%Y-%m-%d')}\n"<br/>    )<br/>    text.set_text(info_text)<br/>    ax[0].axis('off')<br/><br/>    im2.set_data(dates[0:frame+1], rads[0:frame+1])<br/><br/>    ax[1].relim()<br/>    return [im1, im2]<br/><br/>  colors = [(0, 0, 0), (1, 1, 0)]<br/>  cmap_name = 'black_yellow'<br/>  black_yellow_cmap = LinearSegmentedColormap.from_list(cmap_name, colors)<br/><br/>  llim = -1 <br/><br/>  fig, ax = plt.subplots(1,2,figsize=(12,8), frameon=False)<br/>  im1 = ax[0].imshow(arrays[0], vmax=10, cmap=black_yellow_cmap)<br/>  text = ax[0].text(20, 520, "", ha='left', fontsize=14, fontname='monospace', color='white')<br/><br/>  im2, = ax[1].plot(dates[0], rads[0], marker='o',color='black', lw=2)<br/>  plt.xticks(rotation=45)<br/>  ax[1].axhline(0, lw=3, color='black')<br/>  ax[1].axhline(0, lw=1.5, ls='--', color='yellow')<br/>  ax[1].grid(False)<br/>  ax[1].spines[['right', 'top']].set_visible(False)<br/>  ax[1].set_xlabel('Date', fontsize=14, fontname='monospace')<br/>  ax[1].set_ylabel('Average DNB radiance', fontsize=14, fontname='monospace')<br/>  ax[1].set_ylim(llim, max(rads)+0.1)<br/>  ax[1].set_xlim(min(dates), max(dates))<br/><br/>  ani = animation.FuncAnimation(fig, update, frames=27, interval=40)<br/>  ani.save(f'{city}.gif', fps=0.5, savefig_kwargs={'pad_inches':0, 'bbox_inches': 'tight'})<br/>  plt.show()</span></pre><p id="3a07" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The code above might be challenging to understand at first glance. But it’s actually quite simple:</p><ol class=""><li id="1a13" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qs on oo bk"><strong class="nf fr">Defining the update function.</strong> This function is used by matplotlib function <em class="oi">FuncAnimation</em>. The idea is that it passes (adds) new data to the existing plot and returns a new figure (frame). A list of frames is then transformed to a GIF file.</li><li id="6cc9" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny qs on oo bk"><strong class="nf fr">Creating a custom color map.</strong> This one is the easiest. I simply don’t like the colors of the built-in matplotlib cmaps for this project. Since we are working with light in the current analysis, let’s use black and yellow.</li><li id="9512" class="nd ne fq nf b go op nh ni gr oq nk nl nm or no np nq os ns nt nu ot nw nx ny qs on oo bk"><strong class="nf fr">Building and formating the plots.</strong> Everything else is just a regular map + line plot with labels, limits and ticks formatting. Nothing special.</li></ol><p id="aa57" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Let’s see what we’ve got here:</p><h2 id="fa0f" class="qt pd fq bf pe qu qv qw ph qx qy qz pk nm ra rb rc nq rd re rf nu rg rh ri rj bk">1. Kiev</h2></div></div><div class="mr"><div class="ab cb"><div class="lm rk ln rl lo rm cf rn cg ro ci bh"><figure class="mm mn mo mp mq mr rq rr paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rp"><img src="../Images/31587dd2d798117f0b9de6cd169cea58.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*7DYP2W5fbwmAd8QBShjwjA.gif"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="bee8" class="qt pd fq bf pe qu qv qw ph qx qy qz pk nm ra rb rc nq rd re rf nu rg rh ri rj bk">2. Kharkov</h2></div></div><div class="mr"><div class="ab cb"><div class="lm rk ln rl lo rm cf rn cg ro ci bh"><figure class="mm mn mo mp mq mr rq rr paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rp"><img src="../Images/2f416f937e3cfcee1c5f7c036b5fdd73.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*nb5dS0H73AYHljazDjyLdw.gif"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="9fb4" class="qt pd fq bf pe qu qv qw ph qx qy qz pk nm ra rb rc nq rd re rf nu rg rh ri rj bk">3. Odessa</h2></div></div><div class="mr"><div class="ab cb"><div class="lm rk ln rl lo rm cf rn cg ro ci bh"><figure class="mm mn mo mp mq mr rq rr paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rp"><img src="../Images/f35fda514db278333ad580b0c965d26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*zeo1NSoeK_PUFDqGTSgPiw.gif"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="9bd0" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">I don’t know about you, but these images really terrify me. Large developed cities, like Kiev and Kharkov, are clearly being “turned off” right after February 2024.</p><p id="003a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Let’s compare the lineplots separately.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/0af2274a0b185e86b83e31912e16098f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XBXSCUQHgbXqLVOHndBu2w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="58df" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Without any statistical analysis, there is an evident correlation between these three time series. By analysing anomalies (not the actual time series) we tried to exclude seasonal component (change in night time lights radiance cause by snow). So arguably, all the negative anomalies we see should be related to the drone/missile attacks.</p><p id="7517" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The plots clearly indicate that Kiev and Kharkov experienced very similar blackouts in January of 2023 and 2024, whereas Odessa almost avoided any negative anomalies over this time.</p><p id="6038" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Summing up, this article is<strong class="nf fr"> not a scientific research</strong>. To become one, it definitely needs more high-resolution data, statistical analysis, and uncertainty estimation.</p><p id="75d1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">However, being a brief geospatial investigation, it gives a good perspective on how this bloodshed affected the three largest Ukrainian cities and the people living there. Hopefully it’ll inspire you to dig deeper into the topic and produce your own comprehensive analysis.</p><blockquote class="rt"><p id="6d96" class="ru rv fq bf rw rx ry rz sa sb sc ny dx">Make love and data science, not war</p><p id="5868" class="ru rv fq bf rw rx ry rz sa sb sc ny dx">Peace🕊️</p></blockquote><p id="b9aa" class="pw-post-body-paragraph nd ne fq nf b go sd nh ni gr se nk nl nm sf no np nq sg ns nt nu sh nw nx ny fj bk">===========================================</p><p id="e0d2" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><em class="oi">All my publications on Medium are free and open-access, that’s why I’d really appreciate if you followed me here!</em></p><p id="bfad" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">P.s. I’m extremely passionate about (Geo)Data Science, ML/AI and Climate Change. So if you want to work together on some project pls contact me in <a class="af nc" href="https://www.linkedin.com/in/alexxxroz/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</p><p id="bab1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">🛰️Follow for more🛰️</p></div></div></div></div>    
</body>
</html>