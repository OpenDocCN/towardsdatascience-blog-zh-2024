- en: Using Power BI for Planning (Warehouse) with Stock Values
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/using-power-bi-for-planning-warehouse-with-stock-values-0c7219845d48?source=collection_archive---------3-----------------------#2024-06-18](https://towardsdatascience.com/using-power-bi-for-planning-warehouse-with-stock-values-0c7219845d48?source=collection_archive---------3-----------------------#2024-06-18)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*Stock Measures is nothing new in Power BI. But how can we use Power BI to
    plan for the future using these Measures? Here, I will design a scenario and explain
    how I solved it.*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@salvatorecagliari?source=post_page---byline--0c7219845d48--------------------------------)[![Salvatore
    Cagliari](../Images/a24b0cefab6e707cfee06cde9e857559.png)](https://medium.com/@salvatorecagliari?source=post_page---byline--0c7219845d48--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--0c7219845d48--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--0c7219845d48--------------------------------)
    [Salvatore Cagliari](https://medium.com/@salvatorecagliari?source=post_page---byline--0c7219845d48--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--0c7219845d48--------------------------------)
    ·9 min read·Jun 18, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e2ab15931b90b9c4fb0207015caa9372.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Annie Williams](https://unsplash.com/@annietheby?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: Scenario
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let’s start with the scenario:'
  prefs: []
  type: TYPE_NORMAL
- en: My company, Contoso Ltd, aims to consolidate the warehouses with product stock
    into regional warehouses, limiting the warehouse space in the local stores and
    thus increasing the sales area.
  prefs: []
  type: TYPE_NORMAL
- en: 'For planning, I need the volume for each product and to categorize it into
    five categories:'
  prefs: []
  type: TYPE_NORMAL
- en: Very Small
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Small
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Medium
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Large
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unknown (For products without size information)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I could add more categories, for example, by using the area and adding the height.
    However, I decided to use this approach to simplify things.
  prefs: []
  type: TYPE_NORMAL
- en: My company stores the Stock Data in a database weekly, which is my source for
    Power BI.
  prefs: []
  type: TYPE_NORMAL
- en: My approach to creating the planning data is to calculate the Stock volume for
    each month using the maximum amount of Stock in all Stores in a specific area.
  prefs: []
  type: TYPE_NORMAL
- en: With this figure, I can plan the size of the new Warehouses and allocate space
    for each size category.
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, I need the stock numbers per month and overall.
  prefs: []
  type: TYPE_NORMAL
- en: Again, I decided to go with the existing data for the States for simplicity
    because I have not created geographic areas for the central warehouses.
  prefs: []
  type: TYPE_NORMAL
- en: In reality, I would ask the business department to create custom geographic
    areas based on the planned stores’ locations. There would be many more details
    or other groupings of the products that would be of interest. But bear with me
    if I simplify the story for this article.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here are the values of interest for Bavaria (Germany) grouped by Volume Group
    for two months:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8e5c747e99628bbc8130a45ba95641a7.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1 — Values of interest for Bavaria by Volume category for two months
    (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, the highest Stock volumes are distributed without any rule and
    can change monthly.
  prefs: []
  type: TYPE_NORMAL
- en: I need to know the maximum number of units per Size category for each month
    and each State.
  prefs: []
  type: TYPE_NORMAL
- en: The details of each store are not interesting to my analysis.
  prefs: []
  type: TYPE_NORMAL
- en: Neither is the number of units per week.
  prefs: []
  type: TYPE_NORMAL
- en: 'When I take the example from the screenshot above, and I look at March for
    Bavaria, the result for March should be:'
  prefs: []
  type: TYPE_NORMAL
- en: 332 Very Small-sized Units
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 168 Small sized Units
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 72 Medium-sized units
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 84 Large-sized Units
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 204 Units without information about the Size
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: These numbers will be a starting point for the planning and should be in the
    result for Bavaria.
  prefs: []
  type: TYPE_NORMAL
- en: Designing the solution
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you are new to calculating Stock Measures in Power BI, or how we call them
    “Semi-Additive Measures”, look at the References section below to find two more
    articles on this topic.
  prefs: []
  type: TYPE_NORMAL
- en: To design the solution, I must first understand my data.
  prefs: []
  type: TYPE_NORMAL
- en: 'The data model is the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8ef90786c3fe189e7dd185458d27d518.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 2 — Base Data model (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: As mentioned above, the Inventory data is collected weekly for each Store for
    each product in the Inventory Data Fact table.
  prefs: []
  type: TYPE_NORMAL
- en: 'Which information do I need for my analysis:'
  prefs: []
  type: TYPE_NORMAL
- en: The Calendar
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Products volume category (Column Volume Range)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The State of each Store. Perhaps together with the Country
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Inventory
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I need a table with these columns to calculate the results.
  prefs: []
  type: TYPE_NORMAL
- en: 'I have two possible approaches to solving the challenge with such a table:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a DAX Measure, which constructs an intermediary table and performs the
    calculations on the fly.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create a calculated DAX table with the necessary columns.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The first approach could be practical; I don’t need to store additional data
    in the data model or memory.
  prefs: []
  type: TYPE_NORMAL
- en: However, it can cause issues with performance and memory consumption.
  prefs: []
  type: TYPE_NORMAL
- en: As I must reuse the table’s results, I can copy the logic for the intermediary
    table multiple times or be forced to calculate the table on the fly numerous times,
    even when I create a Base Measure and reuse it.
  prefs: []
  type: TYPE_NORMAL
- en: Based on these requirements and possible side effects, I will use a DAX table
    for my calculations.
  prefs: []
  type: TYPE_NORMAL
- en: 'After adding this table, my Data model will look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/17ccc9334bc3a510ad13776ea7bc5371.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 3 — Expanded Data model with the calculated table (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, the calculated table will only be related to the Date table.
    It will be self-contained, as the Granularity differs from the original Inventory
    table.
  prefs: []
  type: TYPE_NORMAL
- en: Creating the solution
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To create the table, I use the following DAX query:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The Measure [Max Stock Volume] gets the maximum value from the Inventory table,
    in this case, for each Month and all Stores in each State.
  prefs: []
  type: TYPE_NORMAL
- en: 'The result of the query is the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/c5cd0e8dd7420c410688e56e103f7b4c.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 4 — Result of DAX Query for the calculated table (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: 'As mentioned before, the Measure [Max Stock Volume] contains a simple Expression:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The existing Measure to Calculate the Stock Volume in my report contains a logic
    to get the latest stock volume. This is a standard Measure using the [LASTNONBLANKVALUE()](https://dax.guide/lastnonblankvalue/)
    function.
  prefs: []
  type: TYPE_NORMAL
- en: I don’t need this logic, as I don’t summarize the Stock volume over time in
    the calculated table.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, I use the New table function to create the calculated table using the
    [SUMMARIZECOLUMN()](https://dax.guide/summarizecolumns/) function from the query
    above:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/25af21807aef4cc6ba2900d4d4e34ff5.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 5 — Create the calculated table with the Query above (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: Another approach would be to create this table in Power Query. This would lead
    to a more efficient compression of the data.
  prefs: []
  type: TYPE_NORMAL
- en: In my case, the resulting table has only 57’005 rows. Therefore, I refrain from
    doing this, as it would involve multiple Merge operations without that much of
    a benefit. But if the table would contain hundreds of thousands or even millions
    of rows, I would do it in that way,
  prefs: []
  type: TYPE_NORMAL
- en: 'I use the column DateLastDayOfMonth to create the relationship to the Date
    table:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/53638b837f3053296afcbe9512469c85.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6 — Add the new Relationship to the Date table (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: Next, I calculate the highest stock volume for each State, each Volume Range,
    and the current month.
  prefs: []
  type: TYPE_NORMAL
- en: To achieve this, I add a calculated column to the calculated table.
  prefs: []
  type: TYPE_NORMAL
- en: This calculated column gets the current month (DateLastDayOfMonth), the State,
    and the Volume Range.
  prefs: []
  type: TYPE_NORMAL
- en: Then, I get the maximum Stock volume.
  prefs: []
  type: TYPE_NORMAL
- en: 'The DAX code for this column is this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'The result for a Bavaria looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e45fd4b50b9a93bdd1da8bd50efb04f8.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7 — Result of calculated column with multiple rows (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: Although this result is correct and corresponds with the data shown at the beginning,
    it is less useful than it can be.
  prefs: []
  type: TYPE_NORMAL
- en: I can use it with a Measure that considers only the latest value, but the fact
    that I need the result in a monthly report complicates this approach.
  prefs: []
  type: TYPE_NORMAL
- en: 'Therefore, I apply an additional logic to the calculation for this column to
    return only the value for the latest date:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'This is the result of this calculation:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1fa6aa9cd5ce35b8e051d6485ca0946f.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 8 — Corrected result for the Highmark column (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: 'Now I can add a Measure with a simple SUM over this column to get the needed
    result:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'When displaying the results by month, I get the needed results:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/999493a80ea5ebd37b59f610c1d21760.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 9 — Result for Q1 2008 per State and Volume Range (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, the result is the same as the screenshot shown at the beginning.
  prefs: []
  type: TYPE_NORMAL
- en: 'In case I need to add the Country and the Continent, I can either:'
  prefs: []
  type: TYPE_NORMAL
- en: Add a Relationship to the Geography table to the State column.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add the Country and Continent columns to the calculated table.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Both variants lead to the same result.
  prefs: []
  type: TYPE_NORMAL
- en: However, in my current configuration, I cannot add a Relationship because of
    a circular dependency, which can be caused by either the existing State column
    or the implemented calculated columns and Measure.
  prefs: []
  type: TYPE_NORMAL
- en: 'As a consequence, it is easier to add the two columns to the calculated table:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/7b23ce059cd769bb1359cbdadb779f93.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 10 — Calculated table with the newly added Country and Continent columns
    (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: I can still use the results with the new hierarchy, as I will not summarize
    the results over time.
  prefs: []
  type: TYPE_NORMAL
- en: Aggregation over multiple months would be wrong, and that’s why such Measures
    are called “Semi-Additive Measures.”
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, I should remove the Row Totals from the Matrix visual to avoid displaying
    the wrong information.
  prefs: []
  type: TYPE_NORMAL
- en: What’s next?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now, I can expand the table to enable other analyses, such as by Product Category,
    to add more analysis possibilities.
  prefs: []
  type: TYPE_NORMAL
- en: But take care.
  prefs: []
  type: TYPE_NORMAL
- en: 'When you add a new column, the column [HighMark Stock Volume] will produce
    duplicated values, as it will not account for the new column:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6bdc352b48081aac19e27538c86d2172.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 11 — Calculated table with added Product Category and duplicated values
    (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: 'To correct this, I must add checks for the Category to ensure that the value
    remains unique:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/3d469f1344e319a2e3530d7fce1a2f0e.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 12 — Check for the added Category column (Figure by the Author)
  prefs: []
  type: TYPE_NORMAL
- en: 'At some point, it would make sense to either:'
  prefs: []
  type: TYPE_NORMAL
- en: Change the logic in the Measure to ignore the duplicates or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add a new calculated table for the specific analysis needs.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The first approach could be complicated, and the second approach will expand
    the Data model for each analysis.
  prefs: []
  type: TYPE_NORMAL
- en: So, both have pros and cons.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This approach delivers the needed result, but it has some drawbacks:'
  prefs: []
  type: TYPE_NORMAL
- en: The calculated table is self-contained and has no relationship to other tables
    except for the date.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: a. This means that I cannot use the columns from the Geography table to filter
    visuals based on this table and the Inventory table.
  prefs: []
  type: TYPE_NORMAL
- en: 2\. This means that the data is duplicated in the data model.
  prefs: []
  type: TYPE_NORMAL
- en: 3\. Adding further aspects to analyze can cause complicated effects in the calculations.
  prefs: []
  type: TYPE_NORMAL
- en: 4\. I must always add the Month to any analysis, as the result can be misleading
    without it.
  prefs: []
  type: TYPE_NORMAL
- en: But it’s a relatively simple solution to the problem.
  prefs: []
  type: TYPE_NORMAL
- en: Such planning analysis is usually not done regularly and could be discarded
    after the planning process is completed.
  prefs: []
  type: TYPE_NORMAL
- en: This alleviates many of the drawbacks mentioned above.
  prefs: []
  type: TYPE_NORMAL
- en: One of my clients needs such an analysis for ongoing planning, and he is happy
    to cope with these drawbacks and to work around them.
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, I did not need to build a more sophisticated solution.
  prefs: []
  type: TYPE_NORMAL
- en: 'This is one key lesson of this article: Search for a good enough solution instead
    of spending days or weeks searching for the perfect solution.'
  prefs: []
  type: TYPE_NORMAL
- en: The perfect solution can be too complex without any added benefits.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/af9a5b7f477a9ff4efe02f66bd76512a.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [CHUTTERSNAP](https://unsplash.com/@chuttersnap?utm_source=medium&utm_medium=referral)
    on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Here are some past articles on how to work with Stock Measures:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/going-the-next-step-with-stock-measures-in-dax-cb49d4e21c13?source=post_page-----0c7219845d48--------------------------------)
    [## Going the Next Step with Stock Measures in DAX'
  prefs: []
  type: TYPE_NORMAL
- en: We can have some weird effects when using Stock Measures in Power BI. Let’s
    look at how such a situation can emerge and…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/going-the-next-step-with-stock-measures-in-dax-cb49d4e21c13?source=post_page-----0c7219845d48--------------------------------)
    [](/refinement-of-semi-additive-measures-in-dax-4e148fa83f56?source=post_page-----0c7219845d48--------------------------------)
    [## Refinement of Semi-Additive Measures in DAX
  prefs: []
  type: TYPE_NORMAL
- en: In a previous story, I explained some details about Semi-Additive Measures.
    Here are some more hints on this topic
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/refinement-of-semi-additive-measures-in-dax-4e148fa83f56?source=post_page-----0c7219845d48--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: I wrote an article some time ago about changing the granularity of the data,
    which is a similar problem.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the link to it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[](/changing-granularity-of-data-in-power-bi-3a2b81356990?source=post_page-----0c7219845d48--------------------------------)
    [## Changing granularity of data in Power BI'
  prefs: []
  type: TYPE_NORMAL
- en: Sometimes you need to create reports at a different granularity as you have
    in your data. Let’s explore how you can…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: towardsdatascience.com](/changing-granularity-of-data-in-power-bi-3a2b81356990?source=post_page-----0c7219845d48--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: I use the Contoso sample dataset, as I did in my previous articles. You can
    download the ContosoRetailDW Dataset for free from Microsoft [here](https://www.microsoft.com/en-us/download/details.aspx?id=18279).
  prefs: []
  type: TYPE_NORMAL
- en: The Contoso Data can be freely used under the MIT License, as described [here](https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo).
  prefs: []
  type: TYPE_NORMAL
- en: '[](https://medium.com/@salvatorecagliari/subscribe?source=post_page-----0c7219845d48--------------------------------)
    [## Get an email whenever Salvatore Cagliari publishes.'
  prefs: []
  type: TYPE_NORMAL
- en: Get an email whenever Salvatore Cagliari publishes. By signing up, you will
    create a Medium account if you don't…
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: medium.com](https://medium.com/@salvatorecagliari/subscribe?source=post_page-----0c7219845d48--------------------------------)
  prefs: []
  type: TYPE_NORMAL
- en: I make my articles accessible to everyone, even though Medium has a paywall.
    This allows me to earn a little for each reader, but I turn it off so you can
    read my pieces without cost.
  prefs: []
  type: TYPE_NORMAL
- en: You can support my work, which I do during my free time, through
  prefs: []
  type: TYPE_NORMAL
- en: '[https://buymeacoffee.com/salvatorecagliari](https://buymeacoffee.com/salvatorecagliari)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Or scan this QR Code:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/e7ac062070dcd7a00dcf995ad7e95434.png)'
  prefs: []
  type: TYPE_IMG
- en: Any support is greatly appreciated and helps me find more time to create more
    content for you.
  prefs: []
  type: TYPE_NORMAL
- en: Thank you a lot.
  prefs: []
  type: TYPE_NORMAL
