<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>You’ve Got a Time Series. Now What?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>You’ve Got a Time Series. Now What?</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/youve-got-a-time-series-now-what-38803e079175?source=collection_archive---------1-----------------------#2024-04-20">https://towardsdatascience.com/youve-got-a-time-series-now-what-38803e079175?source=collection_archive---------1-----------------------#2024-04-20</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="6f12" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">How to do exploratory data analysis of a time series</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@alexroz?source=post_page---byline--38803e079175--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Aleksei Rozanov" class="l ep by dd de cx" src="../Images/748b69bfaccf39c9aa568a9e6f41eec3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*JISS93SvFnwE3NMNTl8HAQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--38803e079175--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@alexroz?source=post_page---byline--38803e079175--------------------------------" rel="noopener follow">Aleksei Rozanov</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--38803e079175--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">8 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Apr 20, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">5</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/92a060eae44518a5f0d674f9be8d1280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edaM6np06ZLosWt3kbc-rA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="2ebc" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">One of the most popular types of data is a time series. Videos, images, pixels, signals, literally anything having a time component could be turned into it. Formally, <strong class="nf fr">a time series</strong> is a sequence of <em class="nz">historical</em> measurements of an observable variable at <strong class="nf fr">equal time intervals</strong>.</p><p id="eba9" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">In this article I want to suggest a small pipeline which anyone can use when analyzing a time series. It could help you to derive meaningful insights about the data itself, prepare it for modeling and draw some preliminary conclusions.</p><p id="397f" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Since my favorite word is geospatial 🌏, today we will analyze a meteorological time series. In particular, we will explore 2 m air temperature, total precipitation, surface net solar radiation and surface pressure at the point in South-Eastern Siberia over 2023 derived from hourly <a class="af nc" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land?tab=overview" rel="noopener ugc nofollow" target="_blank">ERA5 Land</a> [1] climate reanalysis.</p><blockquote class="oa ob oc"><p id="e8cd" class="nd ne nz nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">As always, to follow up the tutorial, you can download and run the notebook <a class="af nc" href="https://github.com/alexxxroz/Medium/blob/main/Time_Series_EDA.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="nf fr">here</strong></a><strong class="nf fr">.</strong></p></blockquote><p id="932e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To accomplish the analysis we need to import several libraries:</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="e906" class="oh oi fq oe b bg oj ok l ol om">import pandas as pd<br/>import seaborn as sns<br/>import numpy as np<br/><br/>import matplotlib.pyplot as plt<br/>import xarray as xr<br/><br/>import statsmodels.api as sm<br/>from statsmodels.graphics.tsaplots import plot_acf, plot_pacf<br/>from scipy import stats</span></pre><p id="cb02" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">I also decided to try a new matplotlib style from two libraries, <a class="af nc" href="https://github.com/saforem2/opinionated" rel="noopener ugc nofollow" target="_blank">opinionated</a> and <a class="af nc" href="https://github.com/saforem2/ambivalent?tab=readme-ov-file#user-content-fn-1-97838fc778b9f9f773da6819bae071bb" rel="noopener ugc nofollow" target="_blank">ambivalent</a>:</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="015a" class="oh oi fq oe b bg oj ok l ol om">from ambivalent import STYLES<br/>import opinionated<br/>plt.style.use(STYLES['ambivalent'])<br/>plt.style.use("dark_background")</span></pre><h1 id="8efb" class="on oi fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">1. Line plots</h1><p id="d0a0" class="pw-post-body-paragraph nd ne fq nf b go pi nh ni gr pj nk nl nm pk no np nq pl ns nt nu pm nw nx ny fj bk">First of all, let’s upload and visualize the data we have. To handle geospatial multidimensional arrays we will use <a class="af nc" href="https://docs.xarray.dev/en/stable/" rel="noopener ugc nofollow" target="_blank">xarray</a> library.</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="9833" class="oh oi fq oe b bg oj ok l ol om">data = xr.open_dataset('Medium_data.nc')<br/>data</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pn"><img src="../Images/1185e28466ddf068044199a5b20f8d4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMgqHIZxiAW69r-yY97vyA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="2cd5" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Now we need to slice the data specifically for the chosen location and convert to a pandas dataframe and create a line plot:</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="c6a3" class="oh oi fq oe b bg oj ok l ol om">df = data.sel(latitude=52.53, longitude=101.63, method='pad').to_pandas().drop(['latitude', 'longitude'], axis=1)</span></pre><pre class="po od oe of bp og bb bk"><span id="9f0e" class="oh oi fq oe b bg oj ok l ol om">fig, ax = plt.subplots(ncols = 2, nrows = 2, figsize=(16,9))<br/>df['t2m'].plot(ax=ax[0,0])<br/>ax[0,0].set_title('Air Temperature')<br/>df['ssr'].plot(ax=ax[0,1])<br/>ax[0,1].set_title('Surface Net Solar Radiation')<br/>df['sp'].plot(ax=ax[1,0])<br/>ax[1,0].set_title('Surface Pressure')<br/>df['tp'].plot(ax=ax[1,1])<br/>ax[1,1].set_title('Total Precipitation')<br/>plt.tight_layout()<br/>plt.show()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pp"><img src="../Images/9e4ef447f5b5d88c1e3351cf263e5168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6oUkjbSRi_PE0YBWS2XmA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="583a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">It’s already clear from the line plots that all the four time series have different features, so let’s investigate them using mathematical tools.</p><h1 id="17ee" class="on oi fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">2. Decomposition and Stationarity</h1><p id="7311" class="pw-post-body-paragraph nd ne fq nf b go pi nh ni gr pj nk nl nm pk no np nq pl ns nt nu pm nw nx ny fj bk">Any time series has three important attributes to consider:</p><ul class=""><li id="d825" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny pq pr ps bk"><strong class="nf fr">Trend</strong>, which is a smooth long-term change in a time series;</li><li id="29d8" class="nd ne fq nf b go pt nh ni gr pu nk nl nm pv no np nq pw ns nt nu px nw nx ny pq pr ps bk"><strong class="nf fr">Seasonality</strong>, which is referred to a time series with a regular periodic change in the mean of the series;</li><li id="7cbc" class="nd ne fq nf b go pt nh ni gr pu nk nl nm pv no np nq pw ns nt nu px nw nx ny pq pr ps bk"><strong class="nf fr">Noise (residuals),</strong> which is<strong class="nf fr"> </strong>a random component of a signal with a mean equal to zero.</li></ul><p id="09c3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To get each of these components separately, it’s possible to produce <strong class="nf fr">classical decomposition</strong> (additive or multiplicative). This operation is produced by applying a convolutional filter, so then each time series component is defined as either</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk py"><img src="../Images/1fab0b93d051c464fe77f0949360141e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*TbfF6h6oGcJIDHhmibNopA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Additive decomposition. Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="2ea6" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">or</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk py"><img src="../Images/b7e7f1653141537fd4ffe0403de86f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*xu9lWAQv9neFIorUO5zoBA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Multiplicative decomposition. Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="8742" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">where <strong class="nf fr">y</strong> — is a value from a time series, <strong class="nf fr">S</strong> — seasonal components, <strong class="nf fr">T</strong> — trend component and<strong class="nf fr"> n</strong> — noise.</p><p id="f1c6" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To produce decomposition, besides selecting the decomposition type, you need to set a seasonal period (e.g. p=1 for annual, p=4 for quarterly, p=12 for monthly data etc.).</p><p id="6c89" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">It’s important to mention that the aforementioned classical decomposition is a really naive and simple methods. It has significant limitations such as its linearity, inability to capture dynamic seasonality and difficulty in handling non-stationarity in a time series. However, for the purpose of this article this method is more than enough.</p><p id="943e" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To do the classical decomposition we will use <em class="nz">seasonal_decompose</em> function from statsmodels library with a period equal 24, since we are dealing with hourly data:</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="be2a" class="oh oi fq oe b bg oj ok l ol om">vars = {'t2m': 'Air Temperature', 'tp': 'Total Precipitation', 'sp': 'Surface Pressure', 'ssr': 'Surface Net Solar Radiation'}<br/>for var in df.columns:<br/>  result = sm.tsa.seasonal_decompose(df[var], model='additive', period = 24)<br/>  results_df = pd.DataFrame({'trend': result.trend, 'seasonal': result.seasonal, 'resid': result.resid, 'observed': result.observed})<br/>  fig, ax = plt.subplots(ncols = 2, nrows = 2,figsize=(16,9))<br/>  ax[0,0].plot(df.index, results_df.trend)<br/>  ax[0,0].set_title('Trend')<br/>  ax[0,0].set_ylabel('Value')<br/><br/>  ax[0,1].plot(df.index, results_df.seasonal)<br/>  ax[0,1].set_title('Seasonal')<br/><br/>  ax[1,0].plot(df.index, results_df.resid)<br/>  ax[1,0].set_title('Residual')<br/>  ax[1,0].set_ylabel('Value')<br/>  ax[1,0].set_xlabel('time')<br/><br/>  ax[1,1].plot(df.index, results_df.observed)<br/>  ax[1,1].set_title('Observed')<br/>  ax[1,1].set_xlabel('time')<br/><br/>  opinionated.set_title_and_suptitle(vars[var], f"Dickey-Fuller test: {round(sm.tsa.stattools.adfuller(df[var])[1],5)}", position_title=[0.45,1],<br/>                                     position_sub_title=[0.95, 1])<br/>  plt.tight_layout()<br/>  plt.savefig(f'Seasonal_{var}.png')<br/>  plt.show()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pz"><img src="../Images/9c2814e11f60837ef7f83577d16bf39e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NAFSTLnLu2-SQ_ekTYMXwg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qa"><img src="../Images/3d544b1c9cd662ef6ebec53a0dd01671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pwLH0wzMVHsfApKv9bepA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qa"><img src="../Images/2eaee716dd06aa5037556f2a052b8d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTUwdbbU86mqR8lbcCTptA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qa"><img src="../Images/b550fe4f8fec269dbbba972d9b9e81f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qzwM6557ym8XEYFwpW5GVg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="898b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">You can see that for all the variables seasonal component looks like a mess. Since we analyze hourly data, these seasonal variations are observed within one day, and not really informative. In this case, it’s worth trying to resample the data to daily resolution and do the decomposition for the period of one day.</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="4f9f" class="oh oi fq oe b bg oj ok l ol om">df_d = df.resample('1d').mean()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pz"><img src="../Images/8cd6a2e794670aeaab6898ec9ad8da9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZRKEbXr-IsJuHQen1-2kw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="717c" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">By now some of you have probably noticed the Dickey-Fuller test label in the upper-right corner of the plot. This is a <strong class="nf fr">stationarity</strong> test, which was done using the <em class="nz">adfuller</em> function of the same library. In case of a time series, stationarity means that the properties of a time series do not change over time. Saying properties, I mean variance, seasonality, trend and autocorrelation.</p><p id="d455" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">When applying the Augmented Dickey-Fuller (ADF) test to a time series we pose a null-hypothesis that the time series is non-stationary. Then we select a significance level α, which is usually 5%. In essence, α is the probability of incorrectly rejecting the null hypothesis when it is actually true. So in our case, α=5%, there is 5% risk of concluding that the time series is stationary, when it’s actually not.</p><p id="4679" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The test result will give us a p-value. If it’s lower than 0.05, we can reject our null-hypothesis.</p><p id="6f32" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">As you can see, all 4 variables are stationary according to the ADF test.</p><p id="185c" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Usually, to apply some time series forecasting models such as ARIMA and others, stationarity is a must-have, so we are lucky here. Generally, meteorological and climatic data are often analyzed in different time-series related learning materials, since they are stationary in most cases.</p><h1 id="9072" class="on oi fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">3. Distributions</h1><p id="ec4e" class="pw-post-body-paragraph nd ne fq nf b go pi nh ni gr pj nk nl nm pk no np nq pl ns nt nu pm nw nx ny fj bk">After concluding that all our time series are stationary, let’s have a look at how they are distributed. To do that we will use the well-known seaborn library and its function <em class="nz">pairplot</em>, which allows to create informative plots with hists and kdes.</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="e71e" class="oh oi fq oe b bg oj ok l ol om">ax = sns.pairplot(df, diag_kind='kde')<br/>ax.map_upper(sns.histplot, bins=20)<br/>ax.map_lower(sns.kdeplot, levels=5, color='.1')<br/>plt.show()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qb"><img src="../Images/7e170e4e1b89387902da9d18d0263fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtdrk3Br5dAYNSnqOkGG5Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="66bc" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Let’s consider the example of t2m (1 row and 1 column). When analyzing the kernel density estimation (kde) plot it’s clear that the distribution of this variable is multimodal, meaning it has 2 or more “bells”. So during the following stages of the current article we will try to transform the variable to resemble a <strong class="nf fr">normal distribution</strong>.</p><p id="64a3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Other plots in the 1st column and row are identical in terms of the information they provide, but they are visualized differently. Basically, these are scatter plots, which allow to identify how two variables are correlated. So the darker the color of a point or the closer a point to the central circle, the higher the density of points in this area.</p><h1 id="a43a" class="on oi fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk"><strong class="al">4. Box-Cox Transformation</strong></h1><p id="b3f0" class="pw-post-body-paragraph nd ne fq nf b go pi nh ni gr pj nk nl nm pk no np nq pl ns nt nu pm nw nx ny fj bk">Since we have discovered that the air temperature time series is stationary, but not normally distributed, let’s try to fix that using Box-Cox transformation. To do that we will use scipy package and its function <em class="nz">boxcox</em>.</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="f586" class="oh oi fq oe b bg oj ok l ol om">df_d['t2m_box'], _ = stats.boxcox(df_d.t2m)<br/>fig, ax = plt.subplots(nrows=1, ncols=2, figsize=(15,7))<br/>sns.histplot(df_d.t2m_box, kde=True, ax=ax[0])<br/>sns.histplot(df_d.t2m, kde=True, ax=ax[1])</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qc"><img src="../Images/1b8b07eba99a1d17396bcfb5708d1747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g7p330cmoqgukwxVh5PWAg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="85a1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The left part of the plot is our time series distribution after BoxCox transformation, and as you can see, it’s still far from being called “normally” distributed. But if we compare it with the one on the right, we can say it definitely got closer to a normal one.</p><p id="c7e3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Another thing we can do to make sure that the performed transformation was useful is to create a probability plot. In essence, we plot quantiles of a theoretical distribution (in our case normal) against samples of our empirical data (i.e. the time series we consider). The closer the points to the white line, the better.</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="8100" class="oh oi fq oe b bg oj ok l ol om">fig = plt.figure()<br/><br/>ax1 = fig.add_subplot(211)<br/>prob = stats.probplot(df_d.t2m, dist=stats.norm, plot=ax1)<br/>ax1.get_lines()[1].set_color('w')<br/>ax1.get_lines()[0].set_color('#8dd3c7')<br/>ax1.set_title('Probplot against normal distribution')<br/><br/>ax2 = fig.add_subplot(212)<br/>prob = stats.probplot(df_d.t2m_box, dist=stats.norm, plot=ax2)<br/>ax2.get_lines()[1].set_color('w')<br/>ax2.get_lines()[0].set_color('#8dd3c7')<br/>ax2.set_title('Probplot after Box-Cox transformation')<br/>plt.tight_layout()fig = plt.figure()<br/><br/>ax1 = fig.add_subplot(211)<br/>prob = stats.probplot(df_d.t2m, dist=stats.norm, plot=ax1)<br/>ax1.set_title('Probplot against normal distribution')<br/><br/>ax2 = fig.add_subplot(212)<br/>prob = stats.probplot(df_d.t2m_box, dist=stats.norm, plot=ax2)<br/>ax2.set_title('Probplot after Box-Cox transformation')<br/>plt.tight_layout()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qd"><img src="../Images/b5ef301fb62270b7c6e400ffceac1241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tz6A1fCjuwiTWc_6otZ8g.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><blockquote class="oa ob oc"><p id="bc40" class="nd ne nz nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">If you are going to use the transformed time series for ML modeling, don’t forget to apply reverse BoxCox transformation, otherwise you’ll have to deal with inadequate numbers!</p></blockquote><h1 id="e561" class="on oi fq bf oo op oq gq or os ot gt ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk"><strong class="al">5. Autocorrelation</strong></h1><p id="8dfd" class="pw-post-body-paragraph nd ne fq nf b go pi nh ni gr pj nk nl nm pk no np nq pl ns nt nu pm nw nx ny fj bk">And the last step in our analysis is autocorrelation. Autocorrelation function(ACF) estimates correlation between a time series and a lagged version of it. Or in other words, how a specific value of a time series correlates with other prior values in different time intervals. <br/>It might also be helpful to plot partial autocorrelation function (PACF), which is the same as autocorrelation, but with correlation at shorter lags removed. So it estimates the correlation between values within a certain timestamp, but controlling the influence of other values.</p><pre class="mm mn mo mp mq od oe of bp og bb bk"><span id="b2bc" class="oh oi fq oe b bg oj ok l ol om">for var in df.columns[:-1]:<br/>  fig, (ax1, ax2) = plt.subplots(2,1,figsize=(10,8))<br/>  plot_acf(df_d.t2m, ax = ax1)<br/>  plot_pacf(df_d.t2m, ax = ax2)<br/>  opinionated.set_title_and_suptitle(vars[var], '',position_title=[0.38,1],<br/>                                     position_sub_title=[0.95, 1])<br/>  plt.tight_layout()<br/>  plt.show()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qe"><img src="../Images/0dd2ecabf7f1fdb15e13be386904ee29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fwqvM9KXfK_yM9pmGfk-lQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image by <a class="af nc" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="aa70" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">As you can see there is a really strong partial autocorrelation in the surface pressure time series with 1 day lag. Then it weakens significantly and after the 3 day lag it’s almost absent. Such an analysis might help you to better understand the nature of the data you are dealing with, and hence, derive more meaningful conclusions.</p></div></div></div><div class="ab cb qf qg qh qi" role="separator"><span class="qj by bm qk ql qm"/><span class="qj by bm qk ql qm"/><span class="qj by bm qk ql"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="47e0" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">This is it, a really short and straight-forward pipeline to conduct an exploratory data analysis when dealing with time series. It’s important to remember that the methods you should use are highly depended on the questions you need to tackle.</p><p id="f987" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Hopefully this article was informative and insightful for you!</p><p id="145a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">===========================================</p><p id="02dc" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Reference:</strong></p><p id="16cf" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">[1] Muñoz Sabater, J. (2019): ERA5-Land hourly data from 1950 to present. Copernicus Climate Change Service (C3S) Climate Data Store (CDS). DOI: 10.24381/cds.e2161bac (Accessed on 16–04–2024)</p><p id="80f4" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">===========================================</p><p id="0138" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr"><em class="nz">All my publications on Medium are free and open-access, that’s why I’d really appreciate if you followed me here!</em></strong></p><p id="c100" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">P.s. I’m extremely passionate about (Geo)Data Science, ML/AI and Climate Change. So if you want to work together on some project pls contact me in <a class="af nc" href="https://www.linkedin.com/in/alexxxroz/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</p><p id="69aa" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">🛰️Follow for more🛰️</p></div></div></div></div>    
</body>
</html>