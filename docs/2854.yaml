- en: Dog Poop Compass
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://towardsdatascience.com/dog-poop-compass-bayesian-analysis-of-canine-business-f95a4b9f2bf9?source=collection_archive---------3-----------------------#2024-11-25](https://towardsdatascience.com/dog-poop-compass-bayesian-analysis-of-canine-business-f95a4b9f2bf9?source=collection_archive---------3-----------------------#2024-11-25)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A Bayesian analysis of canine business
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://datawondering.com/?source=post_page---byline--f95a4b9f2bf9--------------------------------)[![Dima
    Sergeev](../Images/62e582badeef3041a535414ac5b79048.png)](https://datawondering.com/?source=post_page---byline--f95a4b9f2bf9--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--f95a4b9f2bf9--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--f95a4b9f2bf9--------------------------------)
    [Dima Sergeev](https://datawondering.com/?source=post_page---byline--f95a4b9f2bf9--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--f95a4b9f2bf9--------------------------------)
    ·22 min read·Nov 25, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: tl;dr
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Do dogs poop facing North and South? Turns out they do! Want to learn how to
    measure this at home using a compass app, Bayesian statistics, and one dog (dog
    not included)? Jump in!
  prefs: []
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This is my dog. His name is Auri and he is a 5 year old Cavalier King Charles
    Spaniel.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/5f8a4dec752dfd712c3586dc50a6a50c.png)'
  prefs: []
  type: TYPE_IMG
- en: Auri (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: As many other dog owners, during our walks I noticed that Auri has a very particular
    ritual when he needs to go to the bathroom. When he finds a perfect spot he starts
    circling around something like a compass.
  prefs: []
  type: TYPE_NORMAL
- en: At first I was simply amused by this behaviour. After all, who knows what goes
    through a dog’s mind? But after a while I remembered reading a research paper
    from 2013 titled [“Dogs are sensitive to small variations of the Earth’s magnetic
    field”](https://frontiersinzoology.biomedcentral.com/counter/pdf/10.1186/1742-9994-10-80.pdf).
    The research was conducted on a relatively large sample of dogs and confirmed
    that “dogs preferred to excrete with the body being aligned along the north-south
    axis”.
  prefs: []
  type: TYPE_NORMAL
- en: '*Now that could be an interesting research to try out!* I thought to myself.
    And how lucky that I have a perfect test subject, a lovely canine of my own. I
    decided to replicate the findings and confirm (or debunk!) the hypothesis with
    Auri, my N=1 unsuspecting research participant.'
  prefs: []
  type: TYPE_NORMAL
- en: And so began my long journey of data collection spanning multiple months and
    capturing over 150 of “alignment sessions” if you catch my drift.
  prefs: []
  type: TYPE_NORMAL
- en: Data Collection
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For my study, I needed to have a compass measurement for every time Auri pooped.
    Thank to modern technological advancements we not only have [a calculator app
    for iPad](https://www.theverge.com/2024/6/10/24175487/ipad-calculator-app-ipados18-pencil-apple-wwdc2024)
    but also a [fairly accurate](https://www.simplymac.com/apps/how-accurate-is-the-iphone-compass)
    compass on a phone. And that’s what I decided to use.
  prefs: []
  type: TYPE_NORMAL
- en: The approach was very simple. Every time my dog settled to have some private
    time I opened the compass app, aligned my phone along Auri’s body and took a screenshot.
    In the original paper the authors eloquently called the alignment as *a compass
    direction of the thoracic spine (between scapulae) towards the head*. Very scientific.
    All it means is that the compass arrow is supposed to point at the same direction
    as dog’s head.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/40d6a8344373312ad0c80743e791b191.png)'
  prefs: []
  type: TYPE_IMG
- en: '[Dogs are sensitive to small variations of the Earth’s magnetic field, Vlastimil
    Hart et al.](https://frontiersinzoology.biomedcentral.com/counter/pdf/10.1186/1742-9994-10-80.pdf)'
  prefs: []
  type: TYPE_NORMAL
- en: Anyways, that’s what I did in total 150 something times over the course of a
    few months. I could almost sense the passer bys’ confusion mixed with curiosity
    as I was seemingly taking pictures of all my dog’s relief acts. But was it worth
    it? Let’s find out!
  prefs: []
  type: TYPE_NORMAL
- en: Analysis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I’ll briefly discuss the data extraction and preprocessing here and then jump
    straight to working with circular distributions and hypothesis testing.
  prefs: []
  type: TYPE_NORMAL
- en: 'As always, all the code can be found on my GitHub here: [Data Wondering](https://github.com/DmitrySerg/data-wondering/tree/main/bayesian-dog-poop).'
  prefs: []
  type: TYPE_NORMAL
- en: How to process app screenshots?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'After data collection I had a series of screenshots of the compass app:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d2b8c3a46070b0eb2047d7317029992d.png)'
  prefs: []
  type: TYPE_IMG
- en: Compass app screenshot (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: Being lazy as I am I didn’t feel like scrolling through all of them patiently
    writing down the compass degrees. So I decided to send all those images to my
    notebook and automate the process.
  prefs: []
  type: TYPE_NORMAL
- en: The task was simple — all I needed from the images was the big numbers at the
    bottom of the screen. Fortunately, there are a lot of small pretrained networks
    out there that can do basic [OCR](https://en.wikipedia.org/wiki/Optical_character_recognition)
    (stands for Optical character recognition). I opted for an `[easyocr](https://github.com/JaidedAI/EasyOCR)`
    package which was a bit on a slower end but free and easy to work with.
  prefs: []
  type: TYPE_NORMAL
- en: I’ll walk you through a quick example of using `easyocr` alongside with `[opencv](https://opencv.org/)`
    to extract the numbers from a single screenshot.
  prefs: []
  type: TYPE_NORMAL
- en: 'First, let’s load the image and display it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/c42af7627123c9f8bf71f71b333cbb6a.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, I convert the image to greyscale to remove any color information and
    make it less noisy:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/eb2cd69c076f290f6deee122198215a6.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: 'And then I zoom in on the area of interest:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6e9f14b9749c3719bfde09111822d570.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: Finally, I use *easyocr* to extract the numbers from the image. It does extract
    both the number and the confidence score but I am only interested in the number.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: And that’s it! I wrote a simple for loop to iterate through all the screenshots
    and saved the results to a CSV file.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here’s a link to the full preprocessing notebook: [Data Preprocessing](https://github.com/DmitrySerg/data-wondering/blob/main/bayesian-dog-poop/notebooks/0-data-preprocessing.ipynb).'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a068fb6851bf4c3f1511a667403b7d8b.png)'
  prefs: []
  type: TYPE_IMG
- en: Image by author
  prefs: []
  type: TYPE_NORMAL
- en: 'Spinning the wheel: Circular Distributions'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'I don’t usually work with circular distributions so I had to do some reading.
    Unlike regular data that we are used to, circular data has a peculiar property:
    the “ends” of the distribution are connected.'
  prefs: []
  type: TYPE_NORMAL
- en: For example, if you take the distribution of hours in a day, you would find
    that the distance between 23:00 and 00:00 is the same as between 00:00 and 01:00\.
    Or, in the case of compass degrees, the distance between 359° and 0° is the same
    as between 0° and 1°.
  prefs: []
  type: TYPE_NORMAL
- en: Even calculating a sample mean is not straightforward. A standard arithmetic
    mean between 360° and 0° would give 180° although both 360° and 0° point to the
    exact same direction.
  prefs: []
  type: TYPE_NORMAL
- en: 'Similarly in my case, I got almost perfectly opposite estimates when calculating
    the mean in an arithmetic and in correct way. I converted the degrees to radians
    using a helper function from this nice library: [pingouin](https://pingouin-stats.org/build/html/generated/pingouin.convert_angles.html#pingouin.convert_angles)
    and calculated the mean using the `circ_mean` function.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Next, I wanted to visualize the compass distribution. I used the [Von Mises
    distribution](https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.vonmises.html)
    to model the circular data and drew the polar plot using [matplotlib](https://matplotlib.org/stable/gallery/pie_and_polar_charts/polar_demo.html).
  prefs: []
  type: TYPE_NORMAL
- en: 'The **Von Mises** distribution is the circular analogue of the normal distribution.
    It is defined by two parameters: the mean location μ and the concentration κ.
    The concentration parameter controls the spread and is analogous to the inverse
    of the variance. When κ is 0 the distribution is uniform, as κ increases the distribution
    contracts around the mean.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Let’s import the necessary libraries and define the helper functions:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Now let’s load the data and plot the charts:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/c24f301cacfa262e4d67cac6d7174a2e.png)'
  prefs: []
  type: TYPE_IMG
- en: Circular histogram of doggy business (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: From the histogram it’s clear that Auri has his preferences when choosing the
    relief direction. There’s a clear spike towards the North and a dip towards the
    South. Nice!
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/222d793339b8090e7ae2514350de4bef.png)'
  prefs: []
  type: TYPE_IMG
- en: Circular KDE of doggy business (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: With the KDE plot we get a smoother representation of the distribution. And
    the good news is that it is very far from being a uniform circle.
  prefs: []
  type: TYPE_NORMAL
- en: It’s time to validate it statistically!
  prefs: []
  type: TYPE_NORMAL
- en: Statistically Significant Poops
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Just as circular data requires special treatment for visualizations and distributions,
    it also requires special statistical tests.
  prefs: []
  type: TYPE_NORMAL
- en: I’ll be using a few tests from the [pingouin](https://pingouin-stats.org/) library
    I already mentioned earlier. The first test I’ll use is the [Rayleigh test](https://en.wikipedia.org/wiki/Rayleigh_test)
    which is a test for uniformity of circular data. The null hypothesis claims that
    the data is uniformly distributed around the circle and the alternative is that
    it is not.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Good news, everyone! The p-value is less than 0.05 and we reject the null hypothesis.
    Auri’s strategic poop positioning is not random!
  prefs: []
  type: TYPE_NORMAL
- en: The only downside is that the test [assumes](https://pingouin-stats.org/build/html/generated/pingouin.circ_rayleigh.html#:~:text=The%20assumptions%20for%20the%20Rayleigh%20test%20are%20that%20(1)%20the%20distribution%20has%20only%20one%20mode%20and%20(2)%20the%20data%20is%20sampled%20from%20a%20von%20Mises%20distribution.)
    that the distribution has only one mode and the data is sampled from a von Mises
    distribution. Oh well, let’s try something else then. Auri’s data clearly has
    multiple modes.
  prefs: []
  type: TYPE_NORMAL
- en: 'The next on the list is the [V-test](https://pingouin-stats.org/build/html/generated/pingouin.circ_vtest.html).
    This test checks if the data is non-uniform with a specified mean direction. From
    the documentation we get that:'
  prefs: []
  type: TYPE_NORMAL
- en: The V test has more power than the Rayleigh test and is preferred if there is
    reason to believe in a specific mean direction.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Perfect! Let’s try it.
  prefs: []
  type: TYPE_NORMAL
- en: From the distribution it’s clear that Auri prefers the South direction above
    all. I’ll set the mean direction to *π* radians (South) and run the test.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Now we’re getting somewhere! The p-value is close to zero and we reject the
    null hypothesis. Auri is a statistically significant South-facing pooper!
  prefs: []
  type: TYPE_NORMAL
- en: 'Bayesian Poops: Math Part'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: And now for something completely different. Let’s try a Bayesian approach.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start, I decided to see how estimate of the mean direction changes as the
    sample size increased. The idea is simple: I’ll start with a circular uniform
    prior distribution and update it with every new data point.'
  prefs: []
  type: TYPE_NORMAL
- en: We’ll need to define a few things, so let’s get down to math. If you’re not
    a fan of equations, feel free to skip to the next section with cool visualizations!
  prefs: []
  type: TYPE_NORMAL
- en: 1\. The von Mises Distribution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The von Mises distribution *p*(*θ*∣*μ*,*κ*) has a probability density function
    given by:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/153d3e75814e41fee3e319b418c92d04.png)'
  prefs: []
  type: TYPE_IMG
- en: 'where:'
  prefs: []
  type: TYPE_NORMAL
- en: '*μ* is the mean direction'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*κ* is the concentration parameter (analogous to the inverse of the variance
    in a normal distribution)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*I*₀(*κ*) is the modified Bessel function of the first kind, ensuring the distribution
    is normalized'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2\. Prior and Likelihood
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Suppose we have:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Prior** distribution:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/8010e8d19defce9596996125e37e3f10.png)'
  prefs: []
  type: TYPE_IMG
- en: '**Likelihood** for a new observation *θₙ*​:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/c9d1d390c5ee0568b67651f9e0c25829.png)'
  prefs: []
  type: TYPE_IMG
- en: 'We want to update our prior using Bayes’ theorem:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1d8f4c98f3ecf59bb25c702fea2008a5.png)'
  prefs: []
  type: TYPE_IMG
- en: where
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/809ddcb2163e11ec9ed62d25c60d82ea.png)'
  prefs: []
  type: TYPE_IMG
- en: 3\. Multiply the Prior and Likelihood in the von Mises Form
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The product of two von Mises distributions with parameters (*μ*1​, *κ*1​) and
    (*μ*2​, *κ*2​) leads to another von Mises distribution with updated parameters.
    Let’s go through the steps:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Given:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/92d4f8bcc8d3c734ff8f511f99a8ba00.png)'
  prefs: []
  type: TYPE_IMG
- en: and
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d8f77c2f341da83aa3755011b4a9ce09.png)'
  prefs: []
  type: TYPE_IMG
- en: 'the posterior is proportional to the product:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/a74b4917ed7e0983db2e356c1ff07ab8.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Using the trigonometric identity for the sum of cosines:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8d1a83615e3beff9bdfdd82522036c45.png)'
  prefs: []
  type: TYPE_IMG
- en: 'This becomes:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/97d5cac76fba491d58565a68ad31a8d6.png)'
  prefs: []
  type: TYPE_IMG
- en: 4\. Convert to Polar Form for the Posterior
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Final stretch! The expression above is a von Mises distribution in disguise.
    We can rewrite it in the polar form to estimate the updated mean direction and
    concentration parameter.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/38e1ec079dac7c897cfc0d05cc05dfb4.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Now the expression for posterior simplifies to:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/fa65729c47adb45aeb8f1f47ec179f5b.png)'
  prefs: []
  type: TYPE_IMG
- en: Let’s pause here and take a closer look at the simplified expression.
  prefs: []
  type: TYPE_NORMAL
- en: 'Notice that *C cos⁡(θ)+S sin⁡(θ)* is the dot product of two vectors *(C,S)*
    and *(cos⁡(θ),sin⁡(θ))* which we can represent as:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../Images/e55fa1f7ad146a555e8d99c3ccae9565.png)'
  prefs: []
  type: TYPE_IMG
- en: where *ϕ* is the angle between the vectors *(C,S)* and *(cos⁡(θ),sin⁡(θ))*.
  prefs: []
  type: TYPE_NORMAL
- en: '2\. The magnitudes of the vectors are:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1269d39f1d6f2a13fb79e3ee462307fe.png)'
  prefs: []
  type: TYPE_IMG
- en: '3\. The angle between the vector *(cos⁡(θ),sin⁡(θ))* and a positive x-axis
    is just *θ* and between (*C*,*S*) and a positive x-axis is, by definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/8d5262110a8eb0510b7fb1535870124c.png)'
  prefs: []
  type: TYPE_IMG
- en: '4\. So the angle between the two vectors is:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/9add255caf9dec0d8e5df60d5562c82f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Substitute our findings back into the simplified expression for the posterior:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/1c148acca19a7dcbcaccc482d3492e97.png)'
  prefs: []
  type: TYPE_IMG
- en: or
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/279236a278e5a9f1aa533be01b8966b9.png)'
  prefs: []
  type: TYPE_IMG
- en: where
  prefs: []
  type: TYPE_NORMAL
- en: '*kappa_post*​ is the posterior concentration parameter:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/af71fa7345762ab766cbd3321ca5c5e5.png)'
  prefs: []
  type: TYPE_IMG
- en: '*mu_post* is the posterior mean direction'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../Images/89a801944a9a6d545204de03fc64779e.png)'
  prefs: []
  type: TYPE_IMG
- en: Yay, we made it! The posterior is also a von Mises distribution with updated
    parameters (*mu_post*, *kappa_post*). Now we can update the prior with every new
    observation and see how the mean direction changes.
  prefs: []
  type: TYPE_NORMAL
- en: 'Bayesian Poops: Fun Part'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Welcome back to those of you who skipped the math and congratulations to those
    who made it through! Let’s code the Bayesian update and vizualize the results.
  prefs: []
  type: TYPE_NORMAL
- en: First, let’s define the helper functions for visualizing the posterior distribution.
    We’ll need to it to create a nice animation later on.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Now we’re ready to write the update loop. Remember that we need to set our prior
    distribution. I’ll start with a circular uniform distribution which is equivalent
    to a von Mises distribution with a concentration parameter of 0\. For the *kappa_likelihood*
    I set a fixed moderate concentration parameter of 2\. That’ll make the posterior
    update more visible.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'And that’s it! The code will generate a GIF showing the posterior distribution
    update with every new observation. Here’s the glorious result:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/d5a76b28902d12b5ed3cf7d2a22721d0.png)'
  prefs: []
  type: TYPE_IMG
- en: Posterior Distribution Updates (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: With every new observation the posterior distribution gets more and more concentrated
    around the true mean direction. If only I could replace the red line with Auri’s
    silhouette, it would be perfect!
  prefs: []
  type: TYPE_NORMAL
- en: 'We can further visualize the history of the posterior mean direction and concentration
    parameter. Let’s plot them:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/d4c8d5d53048ea1461be6445f5414f86.png)'
  prefs: []
  type: TYPE_IMG
- en: Posterior mu, kappa evolution (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: The plot shows how the posterior mean direction and concentration parameter
    evolve with every new observation. The mean direction eventually converges to
    the sample value, while the concentration parameter increases, as the estimate
    becomes more certain.
  prefs: []
  type: TYPE_NORMAL
- en: 'Bayes Factor: PyMC for Doggy Compass'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The last thing I wanted to try was to use the [Bayes Factor](https://en.wikipedia.org/wiki/Bayes_factor#:~:text=7%20External%20links-,Definition,The%20key%20data%2Ddependent%20term)
    approach for hypothesis testing. The idea behind the Bayes Factor is very simple:
    it’s **the ratio of two marginal likelihoods** for two competing hypotheses/models.'
  prefs: []
  type: TYPE_NORMAL
- en: 'In general, the Bayes Factor is defined as:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6710866b0a2e923660c1aabceea9cc6e.png)'
  prefs: []
  type: TYPE_IMG
- en: 'where:'
  prefs: []
  type: TYPE_NORMAL
- en: '*p*(*D*∣*Mi*​) and *p*(*D*∣*Mj*​) are the marginal likelihoods of the data
    under the *i* and *j* hypothesis'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*p*(*Mi*​∣*D*) and *p*(*Mj*​∣*D*) are the posterior probabilities of the models
    given the data'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*p*(*Mi*​) and *p*(*Mj*​) are the prior probabilities of the models'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The result is a number that tells us how much more likely one hypothesis is
    compared to the other. There are different approaches to interpret the Bayes Factor,
    but a common one is to use the Jeffreys’ scale by [Harold Jeffreys](https://en.wikipedia.org/wiki/Harold_Jeffreys):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/0eaf9f40b882a7a1620073bbf551998e.png)'
  prefs: []
  type: TYPE_IMG
- en: What are the models you might ask? Simple! They are distributions with different
    parameters. I’ll be using PyMC to define the models and sample posterior distributions
    from them.
  prefs: []
  type: TYPE_NORMAL
- en: First of all, let’s re-itroduce the null hypothesis. I still assume it’s a circular
    uniform Von Mises distribution with *kappa*=0 but this time we need to calculate
    the likelihood of the data under this hypothesis. To simplify further calculations,
    we’ll be calculating log-likelihoods.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Next, it’s time to build the alternative model. Starting with a simple scenario
    of a **Unimodal South** direction, where I assume that the distribution is concentrated
    around 180° or π in radians.
  prefs: []
  type: TYPE_NORMAL
- en: Unimodal South
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let’s define the model in PyMC. We’ll use Von Mises distribution with a fixed
    location parameter *μ*=*π* and a Half-Normal prior for the non-negative concentration
    parameter *κ*. This allows the model to learn the concentration parameter from
    the data and check if the South direction is preferred.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'This gives us a nice simple model which we can also visualize:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/593f54b39c0eee81f5a23a73261c574a.png)'
  prefs: []
  type: TYPE_IMG
- en: PyMC model graph (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: 'And here’s the posterior distribution for the concentration parameter *κ*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/3fa40f32492d0ce6d1e920ef4f734a3f.png)'
  prefs: []
  type: TYPE_IMG
- en: Posterior kappa distribution (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: All that’s left is to calculate the log-likelihood for the alternative model
    and the Bayes Factor.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Since we’re dividing the likelihood of the alternative model by the likelihood
    of the null model, the Bayes Factor indicates how much more likely the data is
    under the alternative hypothesis. In this case, we get 32.46, a very strong evidence,
    suggesting that the data is **not uniformly distributed** around the circle and
    there is **a preference for the South direction**.
  prefs: []
  type: TYPE_NORMAL
- en: However, we additionally calculate the probability that the concentration parameter
    *kappa* is greater than 0.5\. This is a simple way to check if the distribution
    is significantly different from the uniform one. With the Unimodal South model,
    this probabiliy is only 0.0649, meaning that the distribution is still quite spread
    out.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s try another model: **Bimodal North-South Mixture**.'
  prefs: []
  type: TYPE_NORMAL
- en: Bimodal North-South Mixture
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This time I’ll assume that the distribution is bimodal with peaks around 0°
    and 180°, just as we’ve seen in the compass rose.
  prefs: []
  type: TYPE_NORMAL
- en: To achieve this, I’ll need a mixture of two Von Mises distributions with different
    fixed mean directions and a shared concentration parameter.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s define a few helper functions first:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'And now back to the model:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'Once again, let’s visualize the model graph and the posterior distribution
    for the concentration parameter *κ*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/222efe40ea36448f214e2a79f610f7f4.png)'
  prefs: []
  type: TYPE_IMG
- en: PyMC model graph (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/207caa35505a70f08a1b9cc1e25fe3c8.png)'
  prefs: []
  type: TYPE_IMG
- en: Posterior kappa distribution (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: 'And finally, let’s calculate the Bayes Factor and the probability that the
    concentration parameter *κ* is greater than 0.5:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: '**Fantastic!** Both our metrics indicate that this model is a much better fit
    for the data. The Bayes Factor suggests a **decisive evidence** and most of the
    posterior *κ* samples are greater than 0.5 with the mean value of 0.99 as we’ve
    seen on the distribution plot.'
  prefs: []
  type: TYPE_NORMAL
- en: Let’s try a couple more models before wrapping up.
  prefs: []
  type: TYPE_NORMAL
- en: Bimodal West-South Mixture
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This model once again assumes a bimodal distribution but this time with peaks
    around 270° and 180°, which were common directions in the compass rose.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/5219e45a7ce051409efb73ec8d109d41.png)'
  prefs: []
  type: TYPE_IMG
- en: Posterior kappa distribution (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: Nope, definitely not as good as the previous model. Next!
  prefs: []
  type: TYPE_NORMAL
- en: Quadrimodal Mixture
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Final round. Maybe my dog really likes to align himself with the cardinal directions?
    Let’s try a quadrimodal distribution with peaks around 0°, 90°, 180°, and 270°.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/7255e38fa56766715c59510730e66198.png)'
  prefs: []
  type: TYPE_IMG
- en: Posterior kappa distribution (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: Well… Not really. Although the probability that the concentration parameter
    κ*κ* is greater than 0.5 is quite high, the Bayes Factor is 0.0.
  prefs: []
  type: TYPE_NORMAL
- en: The great thing about Bayes Factor is that it penalizes overly complex models
    effectively preventing overfitting.
  prefs: []
  type: TYPE_NORMAL
- en: Model Comparison
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let’s summarize the results of all models using information criteria. We’ll
    use the [Widely Applicable Information Criterion](https://en.wikipedia.org/wiki/Watanabe%E2%80%93Akaike_information_criterion#:~:text=In%20statistics%2C%20the%20Widely%20Applicable,it%20wasn't%20trained%20on.)
    (WAIC) and the Leave-One-Out Cross-Validation (LOO) to compare the models.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/933f6bcd2e583901690ea52c834927aa.png)'
  prefs: []
  type: TYPE_IMG
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/9efe5507cc67224a3d34af59f266bc41.png)'
  prefs: []
  type: TYPE_IMG
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/043cc2eaa59b47d70b13d446fdb79308.png)'
  prefs: []
  type: TYPE_IMG
- en: WAIC comparison (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: And we have a winner! The **Bimodal North-South model** is the best fit for
    the data according to both WAIC and LOO.
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![](../Images/b56b077782d1353c637f65c70d300be5.png)'
  prefs: []
  type: TYPE_IMG
- en: Christmas Auri (image by author)
  prefs: []
  type: TYPE_NORMAL
- en: What a journey! What started a few months ago as a simple observation of my
    dog’s pooping habits turned into a full-blown Bayesian analysis.
  prefs: []
  type: TYPE_NORMAL
- en: In this article, I’ve shown how to model circular data, estimate the mean direction
    and concentration parameter, and update the posterior distribution with new observations.
    We’ve also seen how to use the Bayes Factor for hypothesis testing and compare
    models using information criteria.
  prefs: []
  type: TYPE_NORMAL
- en: And the results were super interesting! Auri does indeed have preferences and
    somehow manages to align himself across the North-South axis. If I ever get lost
    in the woods with my dog, I know what direction to follow. Just need a big enough
    sample size to be sure!
  prefs: []
  type: TYPE_NORMAL
- en: I hope you enjoyed this journey as much as I did. If you have any questions
    or suggestions, feel free to reach out. And if you’d like to support my work,
    consider buying me a coffee ❤️
  prefs: []
  type: TYPE_NORMAL
- en: '[![](../Images/961c46077716eccc51e2bd91a0299d05.png)](https://www.buymeacoffee.com/datawondering)'
  prefs: []
  type: TYPE_NORMAL
- en: 'My socials:'
  prefs: []
  type: TYPE_NORMAL
- en: '[Data Wondering blog [English]](https://substack.com/@datawondering)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Data Wondering blog [Russian]](https://t.me/data_wondering)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'References:'
  prefs: []
  type: TYPE_NORMAL
- en: Dogs are sensitive to small variations of the Earth’s magnetic field, Vlastimil
    Hart et al., [[link]](https://frontiersinzoology.biomedcentral.com/counter/pdf/10.1186/1742-9994-10-80.pdf)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Biostatistical Analysis, Fifth Edition, Jerrold H. Zar, [[link]](https://bayesmath.com/wp-content/uploads/2021/05/Jerrold-H.-Zar-Biostatistical-Analysis-5th-Edition-Prentice-Hall-2009.pdf)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: PyMC, Probabilistic Programming in Python, [[link]](https://www.pymc.io/welcome.html)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
