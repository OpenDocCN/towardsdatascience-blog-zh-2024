<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>NuCS: A Constraint Solver for Research, Teaching, and Production Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>NuCS: A Constraint Solver for Research, Teaching, and Production Applications</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nucs-7b260afc2fe4?source=collection_archive---------11-----------------------#2024-11-22">https://towardsdatascience.com/nucs-7b260afc2fe4?source=collection_archive---------11-----------------------#2024-11-22</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="fr fs ft fu fv fw fo fp paragraph-image"><div role="button" tabindex="0" class="fx fy ed fz bh ga"><div class="fo fp fq"><img src="../Images/495306191bc8964f9fe64b4124ca060f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4IxPWIlDlRY_S7Hn"/></div></div><figcaption class="gd ge gf fo fp gg gh bf b bg z dx">Photo by <a class="af gi" href="https://unsplash.com/@eprouzet?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Eric Prouzet</a> on <a class="af gi" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div/><div><h2 id="498a" class="pw-subtitle-paragraph hi gk gl bf b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx cq dx">Blazing-fast constraint solving in pure Python</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hy hz ia ib ic ab"><div><div class="ab id"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@yangeorget?source=post_page---byline--7b260afc2fe4--------------------------------" rel="noopener follow"><div class="l ie if by ig ih"><div class="l ed"><img alt="Yan Georget" class="l ep by dd de cx" src="../Images/4555bf99c8c71f6a3c905e828819c599.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/0*kFb70RVej7xc7IDa.JPG"/><div class="ii by l dd de em n ij eo"/></div></div></a></div></div><div class="ik ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--7b260afc2fe4--------------------------------" rel="noopener follow"><div class="l il im by ig in"><div class="l ed"><img alt="Towards Data Science" class="l ep by br io cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ii by l br io em n ij eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="ip ab q"><div class="ab q iq"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ir is bk"><a class="af ag ah ai aj ak al am an ao ap aq ar it" data-testid="authorName" href="https://medium.com/@yangeorget?source=post_page---byline--7b260afc2fe4--------------------------------" rel="noopener follow">Yan Georget</a></p></div></div></div><span class="iu iv" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b ir is dx"><button class="iw ix ah ai aj ak al am an ao ap aq ar iy iz ja" disabled="">Follow</button></p></div></div></span></div></div><div class="l jb"><span class="bf b bg z dx"><div class="ab cn jc jd je"><div class="jf jg ab"><div class="bf b bg z dx ab jh"><span class="ji l jb">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar it ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--7b260afc2fe4--------------------------------" rel="noopener follow"><p class="bf b bg z jj jk jl jm jn jo jp jq bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="iu iv" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">6 min read</span><div class="jr js l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Nov 22, 2024</span></div></span></div></span></div></div></div><div class="ab cp jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki"><div class="h k w ea eb q"><div class="ky l"><div class="ab q kz la"><div class="pw-multi-vote-icon ed ji lb lc ld"><div class=""><div class="le lf lg lh li lj lk am ll lm ln ld"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l lo lp lq lr ls lt lu"><p class="bf b dy z dx"><span class="lf">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao le lv lw ab q ee lx ly" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lz"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q kj kk kl km kn ko kp kq kr ks kt ku kv kw kx"><div class="ma k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al mb an ao ap iy mc md me" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep mf cn"><div class="l ae"><div class="ab cb"><div class="mg mh mi mj mk gb ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al mb an ao ap iy ml mm ly mn mo mp mq mr s ms mt mu mv mw mx my u mz na nb"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al mb an ao ap iy ml mm ly mn mo mp mq mr s ms mt mu mv mw mx my u mz na nb"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al mb an ao ap iy ml mm ly mn mo mp mq mr s ms mt mu mv mw mx my u mz na nb"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><h1 id="600a" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">TLDR</h1><p id="f1fc" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk"><a class="af gi" href="https://github.com/yangeorget/nucs" rel="noopener ugc nofollow" target="_blank">NuCS</a> is a <strong class="oa gm">Python library</strong> for solving Constraint Satisfaction and Optimisation Problems (CSP and COP) that I am developing as a side project. Because it is 100% written in Python, NuCS is easy to install and allows to model complex problems in a few lines of code. The NuCS solver is also very fast because it is powered by <a class="af gi" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"><strong class="oa gm">Numpy</strong></a> and <a class="af gi" href="https://numba.pydata.org/" rel="noopener ugc nofollow" target="_blank"><strong class="oa gm">Numba</strong></a>.</p><p id="6b6f" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Many problems can be formulated as CSPs. This is why a constraint library such as NuCS can benefit a lot of developers or data scientists.</p><p id="62e2" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Let's consider the famous N-queens problem which consists in placing <em class="oz">N</em> queens on a <em class="oz">N x N </em>chessboard such that the queens don't threaten each other.</p><figure class="pb pc pd pe pf fw fo fp paragraph-image"><div class="fo fp pa"><img src="../Images/12beb4d111f5e0a9295ba09c194decc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/0*aBP-uodcwX2Z5Mk0.png"/></div><figcaption class="gd ge gf fo fp gg gh bf b bg z dx">A solution to the 8-queens problem. Source: <a class="af gi" href="http://yue-guo.com/wp-content/uploads/2019/02/N_queen.png" rel="noopener ugc nofollow" target="_blank">Yue Guo</a></figcaption></figure><p id="e9a3" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">The <strong class="oa gm">14200</strong> solutions to the <strong class="oa gm">12-queens</strong> problems are found in less than <strong class="oa gm">2s</strong> on a MacBook Pro M2 running:</p><ul class=""><li id="01bd" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk">Python 3.11,</li><li id="73dd" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">Numpy 2.0.1,</li><li id="08a9" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">Numba 0.60.0 and</li><li id="995c" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk"><strong class="oa gm">NuCS 3.0.0.</strong></li></ul><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="9504" class="ps nd gl pp b bg pt pu l pv pw">(venv) ➜  nucs git:(main) time NUMBA_CACHE_DIR=.numba/cache python -m nucs.examples.queens -n 12 --log_level=ERROR --processors=6<br/>{<br/>    'ALG_BC_NB': 262006,<br/>    'ALG_BC_WITH_SHAVING_NB': 0,<br/>    'ALG_SHAVING_NB': 0,<br/>    'ALG_SHAVING_CHANGE_NB': 0,<br/>    'ALG_SHAVING_NO_CHANGE_NB': 0,<br/>    'PROPAGATOR_ENTAILMENT_NB': 0,<br/>    'PROPAGATOR_FILTER_NB': 2269965,<br/>    'PROPAGATOR_FILTER_NO_CHANGE_NB': 990435,<br/>    'PROPAGATOR_INCONSISTENCY_NB': 116806,<br/>    'SOLVER_BACKTRACK_NB': 131000,<br/>    'SOLVER_CHOICE_NB': 131000,<br/>    'SOLVER_CHOICE_DEPTH': 10,<br/>    'SOLVER_SOLUTION_NB': 14200<br/>}<br/>NUMBA_CACHE_DIR=.numba/cache python -m nucs.examples.queens -n 12    6.65s user 0.53s system 422% cpu 1.699 total</span></pre><h1 id="58ca" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">What is constraint programming ?</h1><p id="8fe5" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk"><strong class="oa gm">Constraint programming </strong>is a paradigm for solving combinatorial problems. In constraint programming, users declaratively state the constraints on the feasible solutions for a set of decision variables. Constraints specify the properties of a solution to be found. The solver combines constraint propagation and backtracking to find the solutions.</p><p id="a97c" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">As an example, here is a model for the <a class="af gi" href="https://www.csplib.org/Problems/prob019" rel="noopener ugc nofollow" target="_blank">Magic Sequence Problem</a> (find a sequence <em class="oz">x_0, … x_n-1</em> such that, for each <em class="oz">i </em>in<em class="oz"> [0, n-1],</em> <em class="oz">x_i</em> is the number of occurrences of <em class="oz">i</em> in the sequence) using NuCS:</p><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="15d0" class="ps nd gl pp b bg pt pu l pv pw">class MagicSequenceProblem(Problem):<br/>    def __init__(self, n: int):<br/>        super().__init__([(0, n)] * n)<br/>        for i in range(n):<br/>            self.add_propagator((list(range(n)) + [i], ALG_COUNT_EQ, [i]))<br/>        # redundant constraints<br/>        self.add_propagator((list(range(n)), ALG_AFFINE_EQ, [1] * n + [n]))<br/>        self.add_propagator((list(range(n)), ALG_AFFINE_EQ, list(range(n)) + [n]))</span></pre><blockquote class="px py pz"><p id="7088" class="ny nz oz oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In NuCS, a constraint is named a propagator.</p></blockquote><p id="9186" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">The propagator (here <em class="oz">ALG_COUNT_EQ</em>) simply states that <em class="oz">x_i</em> is the number of occurrences of <em class="oz">i</em> in the sequence. The following two <em class="oz">ALG_AFFINE_EQ</em> propagators are redundant, meaning that they are not necessary for NuCS to find the solution but they speed up the resolution process.</p><p id="b2e5" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">See <a class="af gi" href="https://nucs.readthedocs.io/en/latest/reference.html#propagators" rel="noopener ugc nofollow" target="_blank">the documentation</a> for a complete list of propagator supported by NuCS. Note that most propagators in NuCS are <strong class="oa gm">global</strong> (aka <em class="oz">n</em>-ary) and implement <strong class="oa gm">state-of-art</strong> propagation algorithms.</p><h1 id="7fc5" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Python</h1><p id="4f45" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">Python is the language of choice for data scientists: it has a simple syntax, a growing community and a great number of data science and machine learning libraries.</p><p id="c7e7" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">But on the other hand, Python is known to be a slow language : maybe 50 to 100 times slower than C depending on the benchmarks.</p><p id="05cb" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">The choice of Python for developing a high performance constraint programming library was not so obvious but we will see that the combined use of Numpy (high performance computing package) and Numba (Just-In-Time compilation for Python) helps a lot.</p><p id="76b8" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Many attempts have been made to write constraint solvers in Python, but these are either slow or are only <strong class="oa gm">wrappers</strong> and depend on <strong class="oa gm">external</strong> solvers written in Java or C/C++.</p><h1 id="9983" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Numpy</h1><p id="423d" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk"><a class="af gi" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank">NumPy</a> brings the computational power of languages like C and Fortran to Python.</p><div class="qa qb qc qd qe qf"><a href="https://numpy.org/?source=post_page-----7b260afc2fe4--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qg ab jb"><div class="qh ab co cb qi qj"><h2 class="bf gm ir z jj qk jl jm ql jo jq gk bk">NumPy</h2><div class="qm l"><h3 class="bf b ir z jj qk jl jm ql jo jq dx">Powerful N-dimensional arrays Fast and versatile, the NumPy vectorization, indexing, and broadcasting concepts are the…</h3></div><div class="qn l"><p class="bf b dy z jj qk jl jm ql jo jq dx">numpy.org</p></div></div><div class="qo l"><div class="qp l qq qr qs qo qt gb qf"/></div></div></a></div><blockquote class="px py pz"><p id="7db3" class="ny nz oz oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In NuCS, everything is a Numpy array.</p></blockquote><p id="da04" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">This allows to leverage Numpy's indexing and broadcasting capabilities and to write compact propagators such as <em class="oz">Max_i x_i &lt;= y</em></p><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="bc86" class="ps nd gl pp b bg pt pu l pv pw">def compute_domains_max_leq(domains: NDArray, parameters: NDArray) -&gt; int:<br/>  x = domains[:-1]<br/>  y = domains[-1]<br/>  if np.max(x[:, MAX]) &lt;= y[MIN]:<br/>      return PROP_ENTAILMENT<br/>  y[MIN] = max(y[MIN], np.max(x[:, MIN]))<br/>  if y[MIN] &gt; y[MAX]:<br/>      return PROP_INCONSISTENCY<br/>  for i in range(len(x)):<br/>      x[i, MAX] = min(x[i, MAX], y[MAX])<br/>      if x[i, MAX] &lt; x[i, MIN]:<br/>          return PROP_INCONSISTENCY<br/>  return PROP_CONSISTENCY</span></pre><h1 id="fb0a" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Numba</h1><p id="ae9c" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">Numba is an open source <strong class="oa gm">Just-In-Time</strong> compiler that translates a subset of Python and NumPy code into fast machine code.</p><div class="qa qb qc qd qe qf"><a href="https://numba.pydata.org/?source=post_page-----7b260afc2fe4--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qg ab jb"><div class="qh ab co cb qi qj"><h2 class="bf gm ir z jj qk jl jm ql jo jq gk bk">Numba: A High Performance Python Compiler</h2><div class="qm l"><h3 class="bf b ir z jj qk jl jm ql jo jq dx">@njit(parallel=True) def simulator(out): # iterate loop in parallel for i in prange(out.shape[0]): out[i] = run_sim()…</h3></div><div class="qn l"><p class="bf b dy z jj qk jl jm ql jo jq dx">numba.pydata.org</p></div></div><div class="qo l"><div class="qu l qq qr qs qo qt gb qf"/></div></div></a></div><p id="ccad" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In the following example, we find the 14200 solutions to the <strong class="oa gm">12-queens</strong> problems (note that we use a single processor here).</p><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="e9c1" class="ps nd gl pp b bg pt pu l pv pw">NUMBA_DISABLE_JIT=1 python -m nucs.examples.queens -n 12 --log_level=ERROR   179.89s user 0.31s system 99% cpu 3:00.57 total</span></pre><p id="625d" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">We achieve a <strong class="oa gm">x60</strong> speed-up by enabling Just-In-Time compilation:</p><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="bf75" class="ps nd gl pp b bg pt pu l pv pw">NUMBA_CACHE_DIR=.numba/cache python -m nucs.examples.queens -n 12    3.03s user 0.06s system 99% cpu 3.095 total</span></pre><p id="df47" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In order to let Numba JIT-compile your code, you should :</p><ul class=""><li id="c92d" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk">avoid OOP,</li><li id="fed4" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">use supported types or Numpy arrays,</li><li id="c7a2" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">use a subset of the Python language,</li><li id="bb74" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">use a subset of Numpy's functions.</li></ul><p id="9227" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In NuCS, these guidelines have been successfully implemented for :</p><ul class=""><li id="b329" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk"><strong class="oa gm">propagators</strong> (see <a class="af gi" href="https://nucs.readthedocs.io/en/latest/reference.html#propagators" rel="noopener ugc nofollow" target="_blank">https://nucs.readthedocs.io/en/latest/reference.html#propagators</a> for the list of propagators implemented in NuCS),</li><li id="7429" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk"><strong class="oa gm">consistency algorithms</strong> (see <a class="af gi" href="https://nucs.readthedocs.io/en/latest/reference.html#consistency-algorithms" rel="noopener ugc nofollow" target="_blank">https://nucs.readthedocs.io/en/latest/reference.html#consistency-algorithms</a> for the list of consistency algorithms implemented in NuCS),</li><li id="d310" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk"><strong class="oa gm">heuristics</strong> (see <a class="af gi" href="https://nucs.readthedocs.io/en/latest/reference.html#heuristics" rel="noopener ugc nofollow" target="_blank">https://nucs.readthedocs.io/en/latest/reference.html#heuristics</a> for the list of heuristics implemented in NuCS).</li></ul><p id="a2ea" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Thanks to Numpy and Numba, NuCS achieves performance similar to that of solvers written in Java or C/C++.</p><blockquote class="px py pz"><p id="8f2c" class="ny nz oz oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Note that, since the Python code is compiled and the result cached, performance will always be significantly better when you run your program a second time.</p></blockquote><h1 id="3ba1" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Examples</h1><p id="ae2c" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">NuCS comes with many <a class="af gi" href="https://nucs.readthedocs.io/en/latest/reference.html#examples" rel="noopener ugc nofollow" target="_blank">models</a> for classic constraint programming problems such as:</p><ul class=""><li id="4517" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk">some crypto-arithmetic puzzles: <strong class="oa gm">Alpha</strong>, <strong class="oa gm">Donald</strong>,</li><li id="4c3c" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">Balanced Incomplete Block Design</strong> problem,</li><li id="d050" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">Golomb ruler</strong> problem,</li><li id="c4fb" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">knapsack</strong> problem,</li><li id="0038" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">magic sequenc</strong>e problem,</li><li id="a982" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">magic square</strong> problem,</li><li id="9e7c" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">quasigroup</strong> problem,</li><li id="f654" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">n-queens</strong> problem,</li><li id="b83e" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">Schur lemma</strong> problem,</li><li id="7084" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">sports tournament scheduling</strong> problem,</li><li id="74e9" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the <strong class="oa gm">Sudoku</strong> problem.</li></ul><p id="1bc0" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Some of these examples require some advanced techniques:</p><ul class=""><li id="a1e0" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk">redundant constraints,</li><li id="d0a4" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">custom heuristics,</li><li id="bbca" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">custom consistency algorithms</li></ul><p id="68d9" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Most of these models are also available in <a class="af gi" href="https://www.csplib.org/Languages/NuCS/models/" rel="noopener ugc nofollow" target="_blank">CSPLib</a>, the bible for anything CSP related.</p><h1 id="c95f" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Statistics and Logging</h1><p id="cd2f" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">When solutions are searched for, NuCS also aggregates some <a class="af gi" href="https://nucs.readthedocs.io/en/latest/reference.html#statistics" rel="noopener ugc nofollow" target="_blank">statistics</a>:</p><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="b233" class="ps nd gl pp b bg pt pu l pv pw">{<br/>    'ALG_BC_NB': 262006,<br/>    'ALG_BC_WITH_SHAVING_NB': 0,<br/>    'ALG_SHAVING_NB': 0,<br/>    'ALG_SHAVING_CHANGE_NB': 0,<br/>    'ALG_SHAVING_NO_CHANGE_NB': 0,<br/>    'PROPAGATOR_ENTAILMENT_NB': 0,<br/>    'PROPAGATOR_FILTER_NB': 2269965,<br/>    'PROPAGATOR_FILTER_NO_CHANGE_NB': 990435,<br/>    'PROPAGATOR_INCONSISTENCY_NB': 116806,<br/>    'SOLVER_BACKTRACK_NB': 131000,<br/>    'SOLVER_CHOICE_NB': 131000,<br/>    'SOLVER_CHOICE_DEPTH': 10,<br/>    'SOLVER_SOLUTION_NB': 14200<br/>}</span></pre><p id="9a71" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Here we can see that:</p><ul class=""><li id="eb2e" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk">bound consistency was computed 262006 times,</li><li id="42db" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">2268895 propagators were applied but without effect 990435 times while inconsistencies were detected 116806 times,</li><li id="299a" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">they were 131000 choices and backtracks, with a maximum choice depth of 10,</li><li id="fdbf" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">finally, 14200 solutions were found.</li></ul><p id="509e" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Playing with the model and understanding how it affects the statistics has proven to be a very useful exercise in getting the most out of NuCS.</p><p id="a25e" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">NuCS also comes with some basic logging capabilities.</p><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="b306" class="ps nd gl pp b bg pt pu l pv pw">NUMBA_CACHE_DIR=.numba/cache python -m nucs.examples.golomb -n 10 --symmetry_breaking --log_level=INFO</span></pre><pre class="qv po pp pq bp pr bb bk"><span id="0fcc" class="ps nd gl pp b bg pt pu l pv pw">2024-11-12 17:27:45,110 - INFO - nucs.solvers.solver - Problem has 82 propagators<br/>2024-11-12 17:27:45,110 - INFO - nucs.solvers.solver - Problem has 45 variables<br/>2024-11-12 17:27:45,110 - INFO - nucs.solvers.backtrack_solver - BacktrackSolver uses variable heuristic 0<br/>2024-11-12 17:27:45,110 - INFO - nucs.solvers.backtrack_solver - BacktrackSolver uses domain heuristic 0<br/>2024-11-12 17:27:45,110 - INFO - nucs.solvers.backtrack_solver - BacktrackSolver uses consistency algorithm 2<br/>2024-11-12 17:27:45,110 - INFO - nucs.solvers.backtrack_solver - Choice points stack has a maximal height of 128<br/>2024-11-12 17:27:45,172 - INFO - nucs.solvers.backtrack_solver - Minimizing variable 8<br/>2024-11-12 17:27:45,644 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 80<br/>2024-11-12 17:27:45,677 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 75<br/>2024-11-12 17:27:45,677 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 73<br/>2024-11-12 17:27:45,678 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 72<br/>2024-11-12 17:27:45,679 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 70<br/>2024-11-12 17:27:45,682 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 68<br/>2024-11-12 17:27:45,687 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 66<br/>2024-11-12 17:27:45,693 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 62<br/>2024-11-12 17:27:45,717 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 60<br/>2024-11-12 17:27:45,977 - INFO - nucs.solvers.backtrack_solver - Found a (new) solution: 55<br/>{<br/>    'ALG_BC_NB': 22652,<br/>    'ALG_BC_WITH_SHAVING_NB': 0,<br/>    'ALG_SHAVING_NB': 0,<br/>    'ALG_SHAVING_CHANGE_NB': 0,<br/>    'ALG_SHAVING_NO_CHANGE_NB': 0,<br/>    'PROPAGATOR_ENTAILMENT_NB': 107911,<br/>    'PROPAGATOR_FILTER_NB': 2813035,<br/>    'PROPAGATOR_FILTER_NO_CHANGE_NB': 1745836,<br/>    'PROPAGATOR_INCONSISTENCY_NB': 11289,<br/>    'SOLVER_BACKTRACK_NB': 11288,<br/>    'SOLVER_CHOICE_NB': 11353,<br/>    'SOLVER_CHOICE_DEPTH': 9,<br/>    'SOLVER_SOLUTION_NB': 10<br/>}<br/>[ 1  6 10 23 26 34 41 53 55]</span></pre><h1 id="b2b6" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Customization</h1><p id="af6e" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">Finally, NuCS is a very open platform were almost anything can be customized:</p><ul class=""><li id="33bd" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk">propagators,</li><li id="efdb" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">consistency algorithms,</li><li id="375b" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">heuristics,</li><li id="d57e" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">solvers.</li></ul><p id="da19" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In the following <strong class="oa gm">Golomb ruler </strong>example, a custom consistency algorithm is registered before being used:</p><pre class="pb pc pd pe pf po pp pq bp pr bb bk"><span id="6a6e" class="ps nd gl pp b bg pt pu l pv pw">    consistency_alg_golomb = register_consistency_algorithm(golomb_consistency_algorithm)<br/>    solver = BacktrackSolver(problem, consistency_alg_idx=consistency_alg_golomb)</span></pre><h1 id="a5d8" class="nc nd gl bf ne nf ng hl nh ni nj ho nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Conclusion</h1><p id="a786" class="pw-post-body-paragraph ny nz gl oa b hj ob oc od hm oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">In conclusion, NuCS is a constraint solver library with a lot of features. Although it is written entirely in Python, it is very fast and can be used for a wide range of applications: research, teaching and production.</p><p id="dd79" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Don’t hesitate to contact me on Github if you’d like to take part in NuCS development!</p><p id="854a" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Some useful links to go further:</p><ul class=""><li id="ee94" class="ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot pg ph pi bk">the source code: <a class="af gi" href="https://github.com/yangeorget/nucs" rel="noopener ugc nofollow" target="_blank">https://github.com/yangeorget/nucs</a></li><li id="e68b" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the documention: <a class="af gi" href="https://nucs.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">https://nucs.readthedocs.io/en/latest/index.html</a></li><li id="8ab1" class="ny nz gl oa b hj pj oc od hm pk of og oh pl oj ok ol pm on oo op pn or os ot pg ph pi bk">the Pip package: <a class="af gi" href="https://pypi.org/project/NUCS/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/NUCS/</a></li></ul><p id="d1f9" class="pw-post-body-paragraph ny nz gl oa b hj ou oc od hm ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">If you enjoyed this article about NuCS, please clap <strong class="oa gm">50</strong> times !</p></div></div></div></div>    
</body>
</html>