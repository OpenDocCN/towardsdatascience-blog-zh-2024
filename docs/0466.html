<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>An Introduction to Air Travel Network Optimization Using Mixed Integer Programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>An Introduction to Air Travel Network Optimization Using Mixed Integer Programming</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-0dd288ba9738?source=collection_archive---------7-----------------------#2024-02-18">https://towardsdatascience.com/introduction-0dd288ba9738?source=collection_archive---------7-----------------------#2024-02-18</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="776f" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">How to design an algorithm to route passenger demand across a network in the most cost-effective manner</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@rohan2465?source=post_page---byline--0dd288ba9738--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Rohan Nanda" class="l ep by dd de cx" src="../Images/a1cc23be56f19fe6c75094e9859ffdc0.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*tUJOxEZFxlRDrHPnqaY94Q.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--0dd288ba9738--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@rohan2465?source=post_page---byline--0dd288ba9738--------------------------------" rel="noopener follow">Rohan Nanda</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--0dd288ba9738--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">8 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Feb 18, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><h1 id="6bec" class="mj mk fq bf ml mm mn gq mo mp mq gt mr ms mt mu mv mw mx my mz na nb nc nd ne bk"><strong class="al">Introduction:</strong></h1><p id="a60b" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">This is a take on the Vehicle Routing Problem problem, but adapted to the air transport networks, namely the <strong class="nh fr">Origin Destination-to-Leg</strong> problem.</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div role="button" tabindex="0" class="ok ol ed om bh on"><div class="ob oc od"><img src="../Images/3d4a0648185fb304f0805b133a61619d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZR1OjP6qeduPdquo"/></div></div><figcaption class="op oq or ob oc os ot bf b bg z dx">Photo by <a class="af ou" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">NASA</a> on <a class="af ou" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1b92" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">A little background first: Airlines are constantly faced with the question of how to address demand between city-pairs — do they open a direct connection, or provide connecting itineraries so that the demand is channeled through one or more hubs? The latter is of course preferable from a passenger perspective, but is more costly for the airline and therefore riskier — what if the flight is not filled? Operating a route is very expensive. In other words, we are trying to do this*:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc pa"><img src="../Images/cf268b098a59afa69e2695a8d576a259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*nK9NR2z5mecnQzsWhnC8CA.png"/></div><figcaption class="op oq or ob oc os ot bf b bg z dx">Figure 1: Schema of the problem we are trying to solve. On the Left we have the Origin-Destination (OD) demand, while the Right we have the Legs (with associated traffic routing), which can be thought of as the market response to demand.</figcaption></figure><p id="0088" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk"><em class="pb">*Graph theory enthusiasts will recognize this as a special case of the Graph Sparsification problem, which has seen considerable attention lately.</em></p><p id="d633" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">The industry typically addresses this using so-called itinerary choice models, which are simply probabilistic models to determine which routings passengers will prefer on the basis of number of connections, route length, flight times etc… While this works well when the network shape is already fixed, deciding which routes to open is more complicated. This is because there are a number of routes which are only viable if they can capture enough connecting traffic from other sources — this in turn only occurs if there are no direct routes to serve said traffic. In other words, the status of each route is dependent on the status of neighboring routes, turning this into a combinatorial problem.</p><p id="5365" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">This is precisely the kind of problem that Mixed Integer Programs (MIP) are designed for! Specifically, we will formulate a problem to reflect the following behaviors: <strong class="nh fr">Network Flow Conservation </strong>and<strong class="nh fr"> Edge Activation Costs to enforce sparsification.</strong></p><h1 id="bb9f" class="mj mk fq bf ml mm mn gq mo mp mq gt mr ms mt mu mv mw mx my mz na nb nc nd ne bk">Toy Problem:</h1><p id="2b69" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">For the rest of this article, I will use a toy example as illustration. To completely describe the problem, we need the following inputs:</p><h2 id="ea05" class="pc mk fq bf ml pd pe pf mo pg ph pi mr no pj pk pl ns pm pn po nw pp pq pr ps bk"><strong class="al">Input Graph:</strong></h2><p id="570b" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">A dense Origin-Destination bidirectional graph <strong class="nh fr"><em class="pb">G = (V, E)</em></strong>, with <strong class="nh fr"><em class="pb">n </em></strong>vertices <strong class="nh fr"><em class="pb">V</em></strong> and <strong class="nh fr"><em class="pb">m</em></strong> edges <strong class="nh fr"><em class="pb">E</em></strong>. Each edge has as attribute the Origin-Destination demand (<strong class="nh fr"><em class="pb">O</em></strong><em class="pb">) </em>and the distance between each city-pair (<strong class="nh fr"><em class="pb">Distance</em></strong>). Typically, the demand follows a pareto distribution, where a few edges have high demand and the rest have low demand*:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div role="button" tabindex="0" class="ok ol ed om bh on"><div class="ob oc pt"><img src="../Images/3e5fb688745397298df9ada053a9162d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADb4oRWFERD3DmQwnR9vvQ.png"/></div></div><figcaption class="op oq or ob oc os ot bf b bg z dx">Figure 2: Input Demand Graph (L) and Distribution of demand by edges (R)</figcaption></figure><p id="72b7" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk"><em class="pb">*Graph generated by randomly instantiating the coordinates of the nodes and their population. Using the so-called gravity model for transport, a realistic demand profile can then be obtained. For more information, see </em><a class="af ou" href="https://www.princeton.edu/~alaink/Orf467F12/The%20Gravity%20Model.pdf" rel="noopener ugc nofollow" target="_blank"><em class="pb">link</em></a></p><h2 id="8c6f" class="pc mk fq bf ml pd pe pf mo pg ph pi mr no pj pk pl ns pm pn po nw pp pq pr ps bk">Cost Assumptions:</h2><p id="81e2" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">Depending on the edge distance and typical vehicle type that would be assigned, each edge would have the following cost properties:</p><ul class=""><li id="f93f" class="nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa pu pv pw bk">Cost of per passenger, <strong class="nh fr"><em class="pb">Costₚₐₓ</em></strong>, where pax is short-hand for passenger. In practice, it is the cost-per-seat that should be considered, rather than cost-per-pax, since not every vehicle is necessarily filled completely. However, this would require discrete modelling of each vehicle (and an associated integer variable), which would explode the size of the problem.</li><li id="f988" class="nf ng fq nh b go px nj nk gr py nm nn no pz nq nr ns qa nu nv nw qb ny nz oa pu pv pw bk">Minimum cost of operating a route, <strong class="nh fr"><em class="pb">Costₘᵢₙ</em></strong>. Think of this as the edge activation cost.</li></ul><p id="b0bc" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Bear in mind that both <strong class="nh fr"><em class="pb">Costₚₐₓ </em></strong>and <strong class="nh fr"><em class="pb">Costₘᵢₙ</em></strong> are <em class="pb">m × 1 </em>vectors (one per edge), and both costs scale linearly with distance.</p><p id="8282" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">With this, we have everything we need to design our MIP. As you might have guessed, the idea is to minimize the cost function of the system while respecting the network flow constraint.</p><h1 id="f812" class="mj mk fq bf ml mm mn gq mo mp mq gt mr ms mt mu mv mw mx my mz na nb nc nd ne bk"><strong class="al">Network Flow Conservation</strong></h1><p id="2d36" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">This is a well-known condition, which states that the inflow and outflow of each vertex must be balanced, unless it is a source or sink:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qc"><img src="../Images/63ec1ba87684aa282018a23597606351.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*jvPofr7VxN8Gq9fDuRzkBw.png"/></div></figure><p id="9948" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Here <strong class="nh fr"><em class="pb">(i, j, k)</em></strong> are vertex indices. I’m personally not a big fan of this type of notation, and prefer the equivalent expression using the concept of the edge-incidence matrix from graph theory. This is usually denoted by the <em class="pb">n × m</em> matrix <strong class="nh fr"><em class="pb">B</em></strong>, where each row entry is zero except at the incidence vertices for the corresponding edge, which are 1 &amp; -1 to represent the source &amp; sink:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qd"><img src="../Images/8c249021959fb3327d6546c6377046ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*2koAFBVGz0S7C46MblSlVA.png"/></div></figure><p id="b370" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">If we initialize an <em class="pb">m × m </em>variable matrix (let’s call it <strong class="nh fr"><em class="pb">R</em></strong> for Itinerary Routing — see Figure 1) to represent the flow routing for each demand edge in <strong class="nh fr"><em class="pb">G</em></strong>, we can equivalently formulate the above condition by:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qe"><img src="../Images/96b8bde9106bcd387e70bd0b647420d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/1*kuDJgzgeoa1iq1YoDBaEmg.png"/></div></figure><p id="7c7e" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Where <strong class="nh fr"><em class="pb">diag(O)</em></strong> is an <em class="pb">m × m</em> matrix with each diagonal entry corresponding to the demand from edge <em class="pb">i</em>. If you multiply out any row <em class="pb">i</em> of the RHS, it immediately becomes obvious why any <strong class="nh fr"><em class="pb">R</em></strong> that satisfies this equation is valid from a flow conservation perspective.</p><p id="d050" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Note however that both the <strong class="nh fr"><em class="pb">B</em></strong> and <strong class="nh fr"><em class="pb">R</em></strong> are directional. In the context of our cost function, we don’t really care whether some flows are negative — we just want the absolute, total number of passengers flowing along the edge <em class="pb">i</em> in order to quantify the cost of carrying them. To represent this, we can define the <em class="pb">m × 1</em> leg vector <strong class="nh fr"><em class="pb">L</em></strong>:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qf"><img src="../Images/e2ed1cb38f8206debefc2c59c136b385.png" data-original-src="https://miro.medium.com/v2/resize:fit:198/format:webp/1*lfyCJ1_yRb_XQc9hqp-I6A.png"/></div></figure><p id="66df" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">With these definitions, we have a function mapping <strong class="nh fr"><em class="pb">O → L </em></strong>that is compatible with the network flow conservation principle<em class="pb">.</em> From hereon, <strong class="nh fr"><em class="pb">L</em></strong> represents the total passenger volume on each edge.</p><h1 id="30d1" class="mj mk fq bf ml mm mn gq mo mp mq gt mr ms mt mu mv mw mx my mz na nb nc nd ne bk">Edge Activation</h1><p id="effa" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">This is the heart of the problem! Consider that if <strong class="nh fr"><em class="pb">Costₘᵢₙ=0</em></strong>, the solution would be trivial, with <strong class="nh fr"><em class="pb">L </em></strong>mapping to <strong class="nh fr"><em class="pb">O </em></strong>on a one-to-one basis. This is because any alternative routing would necessarily cover a longer distance than the direct route, so that the cheapest option would always be the latter. However, in the presence of <strong class="nh fr"><em class="pb">Costₘᵢₙ, </em></strong>there is a trade-off between the <strong class="nh fr"><em class="pb">△Cost</em></strong> incurred by longer distance travelled vs.<strong class="nh fr"><em class="pb"> △Cost</em></strong> incurred through edge-activation. In other words, we need the cost profile for each edge to be:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qg"><img src="../Images/09c27a4ca94509f72262b762fa8997a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*LpeXFeoi5o-K7Hz15HOj3Q.png"/></div><figcaption class="op oq or ob oc os ot bf b bg z dx">Figure 3: Illustration of the cost function with edge activation costs</figcaption></figure><p id="65c3" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">There are 3 parts to this function:</p><ul class=""><li id="c3d6" class="nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa pu pv pw bk">If the number of passengers is zero, no costs are incurred (<strong class="nh fr"><em class="pb">Cost</em></strong> <strong class="nh fr"><em class="pb">=</em></strong> 0<strong class="nh fr"><em class="pb">)</em></strong></li><li id="4cf2" class="nf ng fq nh b go px nj nk gr py nm nn no pz nq nr ns qa nu nv nw qb ny nz oa pu pv pw bk">If the number of passengers is between 0 and the threshold, a fixed cost is incurred (<strong class="nh fr"><em class="pb">Cost</em></strong> <strong class="nh fr"><em class="pb">=</em></strong> <strong class="nh fr"><em class="pb">Cₘᵢₙ)</em></strong>, no matter the number of passengers.</li><li id="4060" class="nf ng fq nh b go px nj nk gr py nm nn no pz nq nr ns qa nu nv nw qb ny nz oa pu pv pw bk">If the number of passengers exceeds the threshold, costs scale linearly with ​according to the cost per pax <strong class="nh fr"><em class="pb">(Cost = Cₚₐₓ.L)</em></strong></li></ul><p id="d04b" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">If it were not for the zero-point discontinuity, this would have been a pretty simple problem to solve. Instead, we have a non-convex, combinatorial problem because there is a sudden shift in behavior depending on whether the number of passengers along an edge is zero or not. In this situation, we need an activation (binary) variable to tell the algorithm which condition to follow. Using the big-M approach, we can formulate this as follows:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qh"><img src="../Images/1df0f9bed7e9cc9a9655e4eefc993f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:184/format:webp/1*CDfYiaKPewfd1xqhRDLmxg.png"/></div></figure><p id="b0b9" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Where the <em class="pb">m × 1</em> vector of binary variables <strong class="nh fr"><em class="pb">z</em></strong><em class="pb"> </em>(i.e. <strong class="nh fr"><em class="pb">z ∈ [0,1]</em></strong>) indicates if a route is open or not, and a very large scalar variable <strong class="nh fr"><em class="pb">M</em></strong>. If you’re not familiar with the big-M method, you can read up on it <a class="af ou" href="https://en.wikipedia.org/wiki/Big_M_method" rel="noopener ugc nofollow" target="_blank">here</a>. In this context, it simply enforces the following conditions:</p><ul class=""><li id="ea17" class="nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa pu pv pw bk"><strong class="nh fr"><em class="pb">Lᵢ = 0 </em></strong><em class="pb">→</em><strong class="nh fr"><em class="pb"> zᵢ=0</em></strong></li><li id="f3a8" class="nf ng fq nh b go px nj nk gr py nm nn no pz nq nr ns qa nu nv nw qb ny nz oa pu pv pw bk"><strong class="nh fr"><em class="pb">Lᵢ &gt;0</em></strong><em class="pb"> → </em><strong class="nh fr"><em class="pb">zᵢ=1</em></strong></li></ul><p id="a6be" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Ideally, we would have liked to simply multiply the cost function by this activation variable to tell it which cost behavior to follow. However, this would make the constraint non-linear and very complicated to solve. Instead, we can use Big-M again, this time to linearize the problem while getting the same effect:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qi"><img src="../Images/5bd96d3186cb461140043fef13a5bf59.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*SEsYP54JVif1r523AxIlTw.png"/></div></figure><p id="e4e1" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Combining the cost minimization objective with the ≥ inequalities, we basically end up with a minmax problem where:</p><ul class=""><li id="1c19" class="nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa pu pv pw bk"><strong class="nh fr"><em class="pb">zᵢ=0 → Costᵢ = minmax(0, -M) = 0</em></strong>.</li><li id="e577" class="nf ng fq nh b go px nj nk gr py nm nn no pz nq nr ns qa nu nv nw qb ny nz oa pu pv pw bk"><strong class="nh fr"><em class="pb">zᵢ=1 → Costᵢ = minmax(Cₘᵢₙ, CₚₐₓL)</em></strong>.</li></ul><p id="5204" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">And there we have it! The complete formulation of the problem is shown:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div class="ob oc qj"><img src="../Images/44218b9e33a6678bd3f9ceacb602009c.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*yuf-qlss1Tqa14Qa0KlOGA.png"/></div></figure><p id="52af" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">We now only have to plug in some numbers to see the magic happen.</p><h1 id="b25c" class="mj mk fq bf ml mm mn gq mo mp mq gt mr ms mt mu mv mw mx my mz na nb nc nd ne bk">Sensitivity to minimum threshold</h1><p id="7769" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">It should be clear from the description that the minimum threshold is the main input of interest here, because it defines the degree of sparsification. It’s interesting to see the impact using progressively higher thresholds:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div role="button" tabindex="0" class="ok ol ed om bh on"><div class="ob oc qk"><img src="../Images/5ebbc530cc607635549d02f84209dcfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OfAAtnPJUs6gju78pG4aSA.png"/></div></div><figcaption class="op oq or ob oc os ot bf b bg z dx">Figure 4: From Left to Right, applying Low, Mid and High Thresholds for edge costs</figcaption></figure><p id="1999" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Notice how, no matter the threshold, the graph remains connected — this is a result of the network flow conservation principle, to ensure all demand is satisfied. Another neat way to visualize it is to look at the demand distribution along edges:</p><figure class="oe of og oh oi oj ob oc paragraph-image"><div role="button" tabindex="0" class="ok ol ed om bh on"><div class="ob oc ql"><img src="../Images/8e4d531731f90fb0d94727f43873349b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPdFNjv1SFwOUe0_8lKg5w.png"/></div></div><figcaption class="op oq or ob oc os ot bf b bg z dx">Figure 5: Low, Mid and High Thresholds on the Input Cost function vs. Output Traffic Distribution</figcaption></figure><p id="335f" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">Here we see how the higher the threshold, the higher the level of consolidation (fewer routes with higher volume of traffic), and a correspondingly high number of routes with no traffic.</p><h1 id="73a0" class="mj mk fq bf ml mm mn gq mo mp mq gt mr ms mt mu mv mw mx my mz na nb nc nd ne bk">Conclusion</h1><p id="65fd" class="pw-post-body-paragraph nf ng fq nh b go ni nj nk gr nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa fj bk">This was a simple introduction to what is in reality a very complex problem (there is far more nuance to airline networks than just minimum threshold costs). Still, it demonstrates one of the core behaviors of real networks, while giving a basic introduction to some key concepts for formulating MIPs. The codes for this are on my <a class="af ou" href="https://github.com/rn306/OD-to-LEG" rel="noopener ugc nofollow" target="_blank">Github</a>, feel free to give it a try.</p><p id="c187" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">If you actually try to run it, you’ll soon notice that solve time scales exponentially with the number of vertices in the graph. This is especially the case if you solve it with cvxpy — a common (but rudimentary) open source python library for simple optimization problems. That said, even the sophisticated commercial solvers soon run into their limits. This is the unescapable truth of combinatorial problems; they scale poorly, and are often impractical beyond a certain problem size.</p><p id="9ec5" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk">In the next article, I will introduce a way to try to abstract away some of the complexity by using Graph Neural Networks as surrogate models.</p><p id="c8c0" class="pw-post-body-paragraph nf ng fq nh b go ov nj nk gr ow nm nn no ox nq nr ns oy nu nv nw oz ny nz oa fj bk"><em class="pb">All images unless otherwise stated are by me, the author.</em></p></div></div></div></div>    
</body>
</html>