<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Streamlining Giants</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Streamlining Giants</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/streamlining-giants-8a26aa1e91d3?source=collection_archive---------5-----------------------#2024-02-29">https://towardsdatascience.com/streamlining-giants-8a26aa1e91d3?source=collection_archive---------5-----------------------#2024-02-29</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="a617" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">The Evolution of Model Compression in the LLM Era</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://natecibik.medium.com/?source=post_page---byline--8a26aa1e91d3--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Nate Cibik" class="l ep by dd de cx" src="../Images/008c22b715ddf4f1d0f9970142edc09f.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*TlTicsMyk_8gZjhet5H3KQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--8a26aa1e91d3--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://natecibik.medium.com/?source=post_page---byline--8a26aa1e91d3--------------------------------" rel="noopener follow">Nate Cibik</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--8a26aa1e91d3--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">20 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Feb 29, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div></div></div><div class="mj bh"><figure class="mk ml mm mn mo mj bh paragraph-image"><img src="../Images/b460d40c5ff6a9302412017e3f460052.png" data-original-src="https://miro.medium.com/v2/resize:fit:4800/format:webp/1*D2uILG9zKCPUYJMkDdIC_Q.jpeg"/><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Image by author using DALL-E 3.</figcaption></figure></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="3a4a" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The advent of <a class="af nt" href="https://arxiv.org/abs/1706.03762" rel="noopener ugc nofollow" target="_blank">transformers</a> in 2017 set off a landslide of AI milestones, starting with the spectacular achievements of large language models (LLMs) in natural language processing (NLP), and quickly catalyzing advancement in other domains such as <a class="af nt" rel="noopener" target="_blank" href="/navigating-the-future-62ea60f27046">computer vision and robotics</a>. The unification of NLP and computer vision problems into a common architecture accelerated efforts in learning joint vision-language representation spaces, which enabled the seminal achievements in vision-language modeling surrounding contrastive language-image pretraining (<a class="af nt" href="https://arxiv.org/abs/2103.00020" rel="noopener ugc nofollow" target="_blank">CLIP</a>) in 2021, and lead to the birth of large multimodal models (<a class="af nt" href="https://huyenchip.com/2023/10/10/multimodal.html" rel="noopener ugc nofollow" target="_blank">LMMs</a>).</p><p id="7f79" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">This dawning era of large models has demonstrated awe-inspiring capabilities and marked several major strides toward artificial general intelligence (AGI), but the enormous size of these models makes them difficult to deploy. As with many transformative technologies before them, the alluring capabilities of LLMs were at first accessible only to those with the resources to operate at the bleeding edge of technology. While private research has continued to push the limits of performance using LMMs with hundreds of billions of parameters, open-source research has established a pattern of catching up to these watermarks using much smaller models.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu nu"><img src="../Images/30002d7396d4738166ced1b8f2d8eb55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jYm8uK_oQFfqCf-T.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Image by author. Over time, open-source LLMs are closing the performance gap with much smaller sizes.</figcaption></figure><p id="5477" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Even with this increasing potency, however, the smallest LLMs will not fit on consumer GPUs for inference, let alone be trained, without <em class="nz">model compression</em> techniques being applied. Fortunately, the tantalizing capabilities of these models have driven researchers to find effective methods for squeezing them into smaller spaces. Thanks to their efforts, we can now deploy LLMs easily on consumer hardware, as well as fine-tune them to our desired use cases, without requiring the resources of the corporate titans. This series provides a comprehensive review of four model compression techniques that enable LLM inference and fine-tuning in resource-constrained environments, outlined below:</p><h2 id="8367" class="oa ob fq bf oc od oe of og oh oi oj ok ng ol om on nk oo op oq no or os ot ou bk">Model Compression Techniques for LLMs</h2><ol class=""><li id="3aa5" class="mx my fq mz b go ov nb nc gr ow ne nf ng ox ni nj nk oy nm nn no oz nq nr ns pa pb pc bk"><strong class="mz fr">Pruning</strong> — removal of network parameters individually (unstructured) or in groups (structured) based on their importance in order to decrease model complexity while maintaining accuracy.</li><li id="e732" class="mx my fq mz b go pd nb nc gr pe ne nf ng pf ni nj nk pg nm nn no ph nq nr ns pa pb pc bk"><strong class="mz fr">Quantization</strong> — discretizing and/or reducing the resolution of the numeric space of the weights to save space and ease computation.</li><li id="8d2a" class="mx my fq mz b go pd nb nc gr pe ne nf ng pf ni nj nk pg nm nn no ph nq nr ns pa pb pc bk"><strong class="mz fr">Knowledge Distillation</strong> — small models trained to target the learned functions of large experts can be trained with unlabeled data and outperform similar small models trained on the original task.</li><li id="e8a5" class="mx my fq mz b go pd nb nc gr pe ne nf ng pf ni nj nk pg nm nn no ph nq nr ns pa pb pc bk"><strong class="mz fr">Parameter-Efficient Fine-Tuning </strong>— reduces the number of trainable parameters required to fine-tune a model for task-specific behavior.</li></ol><p id="5cdb" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Each of these techniques has been shown to greatly increase efficiency of large models with relatively innocuous effects on performance, bringing the awe-inspiring powers of the large pre-trained language model (PLM) colossus down to earth where they can be used by anyone. Here we explore each technique in detail, so that we are empowered to employ them in our own work. Like LLMs, these topics can only be compressed to a certain extent before significant loss of knowledge occurs. Hence, we will break this discussion into a series of articles to give each of these techniques the space it deserves, and properly review these rich legacies of research which together provide us with powerful channels for bringing fire to mankind.</p><p id="304b" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In this article, we start at the beginning with the oldest technique on our list, almost as old as the backpropagation-trained neural networks that it compresses: <em class="nz">pruning</em>. First, a quick journey through the history of pruning will teach us the distinctions between <em class="nz">unstructured</em> and <em class="nz">structured</em> pruning techniques, along with their comparative strengths and weaknesses. Equipped with this prerequisite knowledge, we then review the application of these approaches in today’s world of LLMs, and offer closing thoughts.</p><p id="936c" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The forthcoming installments in the Streamlining Giants series will provide similar dives into each of the remaining compression techniques: quantization, knowledge distillation, and parameter-efficient fine-tuning, elucidating a clear and comprehensive understanding of each so that we can approach the game of LLM development playing with a full deck.</p></div></div></div><div class="ab cb pi pj pk pl" role="separator"><span class="pm by bm pn po pp"/><span class="pm by bm pn po pp"/><span class="pm by bm pn po"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="9bb3" class="pq ob fq bf oc pr ps gq og pt pu gt ok pv pw px py pz qa qb qc qd qe qf qg qh bk">Pruning</h1></div></div><div class="mj"><div class="ab cb"><div class="lm qi ln qj lo qk cf ql cg qm ci bh"><figure class="mk ml mm mn mo mj qo qp paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qn"><img src="../Images/0b57e051eb629525605208005640a589.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*kZMz9cwtGd1GyqZLAbm0HA.jpeg"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Image by author using DALL-E 3.</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="dab0" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The quest to refine neural networks for practical applications traces its roots back to the foundational days of the field. When <a class="af nt" href="https://www.cs.utoronto.ca/~hinton/absps/naturebp.pdf" rel="noopener ugc nofollow" target="_blank">Rumelhart, Hinton, and Williams</a> first demonstrated how to use the backpropagation algorithm to successfully train multi-layer neural networks that could learn complex, non-linear representations in 1986, the vast potential of these models became apparent. However, the computational power available in the 1980s restricted their practical use and the complexity of problems they could solve, a situation which mirrors the challenges we face with deploying LLMs today. Although the scale of models and the considerations being made were very different, early discoveries in network minimization would pave the way for big wins in model compression decades later. In this section, we take a brief journey through the history and motivations driving pruning research, discover the comparative strengths and weaknesses of <em class="nz">unstructured</em> versus <em class="nz">structured </em>methods, and prepare ourselves to explore their use in the modern era of LLMs.</p><p id="9a58" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Network pruning was originally motivated by the pursuit of better model generalization through freezing unimportant weights at zero, somewhat akin in theory to L1/Lasso and L2/Ridge regularization in linear regression, though different in that weights are selected and hard-set to zero (pruned) after training based on an importance criteria rather than being coaxed towards zero mathematically by the loss function during training (informed readers will know that regularization can also be achieved in neural network training using <em class="nz">weight decay</em>).</p><p id="666c" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The common motivation behind both regularization and pruning (which can be seen as a form of regularization) is the theoretical and empirical evidence that neural networks are most effective at learning when overparameterized thanks to a <a class="af nt" href="https://arxiv.org/abs/1804.10200" rel="noopener ugc nofollow" target="_blank">higher-dimensional manifold of the loss function’s global minima</a> and a larger exploration space in which effective subnetworks are more likely to be initialized (see “<a class="af nt" href="https://arxiv.org/abs/1803.03635" rel="noopener ugc nofollow" target="_blank">the lottery ticket hypothesis</a>”). However, this overparameterization in turn leads to overfitting on the training data, and ultimately results in a network with many <a class="af nt" href="https://arxiv.org/abs/1306.0543" rel="noopener ugc nofollow" target="_blank">redundant</a> or inactive weights. Although the theoretical mechanisms underlying the “unreasonable effectiveness” of overparameterized neural networks were less well studied at the time, researchers in the 1980s correctly hypothesized that it should be possible to remove a large portion of the network weights after training without significantly affecting task performance, and that performing iterative rounds of pruning and fine-tuning the remaining model weights should lead to better generalization, enhancing the model’s ability to perform well on unseen data.</p><h2 id="1a67" class="oa ob fq bf oc od oe of og oh oi oj ok ng ol om on nk oo op oq no or os ot ou bk">Unstructured Pruning</h2><p id="9e26" class="pw-post-body-paragraph mx my fq mz b go ov nb nc gr ow ne nf ng ox ni nj nk oy nm nn no oz nq nr ns fj bk">To select parameters for removal, a measure of their impact on the cost function, or “saliency,” is required. While the earliest works in network minimization worked under the assumption that the magnitude of parameters should serve as a suitable measure of their saliency, LeCun et al. made a significant step forward in 1989 with “Optimal Brain Damage” (<a class="af nt" href="https://proceedings.neurips.cc/paper/1989/hash/6c9882bbac1c7093bd25041881277658-Abstract.html" rel="noopener ugc nofollow" target="_blank">OBD</a>), in which they proposed to use a theoretically justifiable measure of saliency using second-derivative information of the cost function with respect to the parameters, allowing them to directly identify the parameters which could be removed with the least increase in error.</p><p id="9147" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Written in the era when the model of interest was a fully-connected neural network containing just 2,600 parameters, the authors of OBD were less concerned about removing weights due to computational efficiency than we are today with our billionaire behemoths, and were more interested in improving the model’s ability to generalize to unseen data by reducing model complexity. Even operating on a tiny model like this, however, the calculation of second-derivative information (Hessian matrix) is very expensive, and required the authors to make three convenient mathematical assumptions: 1) that the model is currently trained to an optimum, meaning the gradient of the loss with respect to every weight is currently zero and the slope of the gradient is positive in both directions, which zeroes out the first-order term of the Taylor expansion and implies the change in loss caused by pruning any parameter is positive, 2) that the Hessian matrix is diagonal, meaning the change in loss caused by removal of each parameter is independent, and therefore the loss deltas can be summed over subset of weights to calculate the total change in loss caused by their collective removal, and 3) that the loss function is nearly quadratic, meaning higher-order terms can be neglected from the <a class="af nt" href="https://www.khanacademy.org/math/ap-calculus-bc/bc-series-new/bc-10-11/v/maclaurin-and-taylor-series-intuition" rel="noopener ugc nofollow" target="_blank">Taylor expansion</a>.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qq"><img src="../Images/8422e5c3bae38ec0d439b39f58d75a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AAkpJiE7kAyrrn1VnaYofg.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://proceedings.neurips.cc/paper/1989/hash/6c9882bbac1c7093bd25041881277658-Abstract.html" rel="noopener ugc nofollow" target="_blank">OBD</a> are superior to magnitude-based pruning (left). Accuracy of OBD saliency estimation (right).</figcaption></figure><p id="e1bf" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Despite this requisite list of naïve assumptions, their theoretically justified closed-form saliency metric proved itself superior to magnitude-based pruning in accurately identifying the least important weights in a network, able to retain more accuracy at higher rates of compression. Nevertheless, the efficacy and profound simplicity of magnitude-based pruning methods would make them the top choice for many future research endeavors in model compression, particularly as network sizes began to scale quickly, and Hessians became exponentially more frightening. Still, this successful demonstration of using a theoretically justified saliency measure to more accurately estimate saliency and thereby enable more aggressive pruning provided an inspirational recipe for future victories in model compression, although it would be some time before those seeds bore fruit.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qr"><img src="../Images/cade3f82744602e3474c8e935cf3b1de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gIFhUW46XHoV2Vwe0RktwQ.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://proceedings.neurips.cc/paper/1989/hash/6c9882bbac1c7093bd25041881277658-Abstract.html" rel="noopener ugc nofollow" target="_blank">OBD</a> show that repeated iterations of pruning and fine-tuning preserve original performance levels even down to less than half the original parameter count. The implications in the context of today’s world of large models is clear, but they were more interested in boosting model generalization.</figcaption></figure><p id="d0c4" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Four years later in 1993, Hassibi et al.’s Optimal Brain Surgeon (<a class="af nt" href="https://www.researchgate.net/publication/3568764_Optimal_Brain_Surgeon_and_general_network_pruning" rel="noopener ugc nofollow" target="_blank">OBS</a>) expanded on the concept of OBD and raised the levels of compression possible without increasing error by eschewing the diagonality assumption of OBD and instead considering the cross-terms within the Hessian matrix. This allowed them to determine optimal updates to the remaining weights based on the removal of a given parameter, simultaneously pruning and optimizing the model, thereby avoiding the need for a retraining phase. However, this meant even more complex mathematics, and OBS was thus initially of limited utility to 21st Century researchers working with much larger networks. Nonetheless, like OBD, OBS would eventually see its legacy revived in future milestones, as we will see later.</p><p id="7940" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">The pruning methods in OBD and OBS are examples of <em class="nz">unstructured pruning</em>, wherein weights are pruned on an individual basis based on a measure of their saliency. A modern exemplar of unstructured pruning techniques is <a class="af nt" href="https://arxiv.org/abs/1506.02626" rel="noopener ugc nofollow" target="_blank">Han et al. 2015</a>, which reduced the sizes of the early workhorse convolutional neural networks (CNNs) <a class="af nt" href="https://proceedings.neurips.cc/paper_files/paper/2012/file/c399862d3b9d6b76c8436e924a68c45b-Paper.pdf" rel="noopener ugc nofollow" target="_blank">AlexNet</a> and <a class="af nt" href="https://arxiv.org/abs/1409.1556" rel="noopener ugc nofollow" target="_blank">VGG-16</a> by 9x and 13x, respectively, with no loss in accuracy, using one or more rounds of magnitude-based weight pruning and fine-tuning. Their method unfortunately requires performing sensitivity analysis of the network layers to determine the best pruning rate to use for each individual layer, and works best when retrained at least once, which means it would not scale well to extremely large networks. Nevertheless, it is impressive to see the levels of pruning which can be accomplished using their unstructured approach, especially since they are using magnitude-based pruning. As with any unstructured approach, the reduced memory footprint can only be realized by using sparse matrix storage techniques which avoid storing the zeroed parameters in dense matrices. Although they do not employ it in their study, the authors mention in their related work section that the hashing trick (as demonstrated in the 2015 <a class="af nt" href="https://arxiv.org/abs/1504.04788" rel="noopener ugc nofollow" target="_blank">HashedNets</a> paper) is complementary to unstructured pruning, as increasing sparsity decreases the number of unique weights in the network, thereby reducing the probability of hash collisions, which leads to lower storage demands and more efficient weight retrieval by the hashing function.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qs"><img src="../Images/0418d95168c6cfaede32dfa609d56390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*53c2bwabwbivI4r4cAEV-A.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://arxiv.org/abs/1506.02626" rel="noopener ugc nofollow" target="_blank">Han et al. 2015</a> show the power of unstructured pruning in CNNs of the time period. Notice the “free lunch” compression of 40–50% of parameters pruned away with no accuracy loss and no retraining.</figcaption></figure><p id="b3bd" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">While unstructured pruning has the intended regularization effect of improved generalization through reduced model complexity, and the memory footprint can then be shrunk substantially by using sparse matrix storage methods, the gains in computational efficiency offered by this type of pruning are not so readily accessed. Simply zeroing out individual weights without consideration of the network architecture will create matrices with irregular sparsity that will realize no efficiency gains when computed using dense matrix calculations on standard hardware. Only specialized hardware which is explicitly designed to exploit sparsity in matrix operations can unlock the computational efficiency gains offered by unstructured pruning. Fortunately, consumer hardware with these capabilities is <a class="af nt" href="https://developer.nvidia.com/blog/accelerating-inference-with-sparsity-using-ampere-and-tensorrt/" rel="noopener ugc nofollow" target="_blank">becoming more mainstream</a>, enabling their users to actualize performance gains from the sparse matrices created from unstructured pruning. However, even these specialized hardware units must impose a sparsity ratio expectation on the number of weights in each matrix row which should be pruned in order to allow for the algorithmic exploitation of the resulting sparsity, known as <em class="nz">semi-structured pruning</em>, and enforcing this constraint has been shown to degrade performance more than purely unstructured pruning.</p><h2 id="dd98" class="oa ob fq bf oc od oe of og oh oi oj ok ng ol om on nk oo op oq no or os ot ou bk">Structured Pruning</h2><p id="4892" class="pw-post-body-paragraph mx my fq mz b go ov nb nc gr ow ne nf ng ox ni nj nk oy nm nn no oz nq nr ns fj bk">We’ve seen that unstructured pruning is a well-established regularization technique that is known to improve model generalization, reduce memory requirements, and offer efficiency gains on specialized hardware. However, the more tangible benefits to computational efficiency are offered by <em class="nz">structured pruning</em>, which entails removing entire structural components (filters, layers) from the network rather than individual weights, which reduces the complexity of the network in ways that align with how computations are performed on hardware, allowing for gains in computational efficiency to be easily realized without specialized kit.</p><p id="fe63" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">A formative work in popularizing the concept of structured pruning for model compression was the 2016 Li et al. paper “<a class="af nt" href="https://arxiv.org/abs/1608.08710" rel="noopener ugc nofollow" target="_blank">Pruning Filters for Efficient ConvNets</a>,” where, as the title suggests, the authors pruned filters and their associated feature maps from CNNs in order to greatly improve computational efficiency, as the calculations surrounding these filters can be easily excluded by physically removing the chosen kernels from the model, directly reducing the size of the matrices and their multiplication operations without needing to worry about exploiting sparsity. The authors used a simple sum of filter weights (L1 norm) for magnitude-based pruning of the filters, demonstrating that their method could reduce inferences costs of VGG-16 and <a class="af nt" href="https://arxiv.org/abs/1512.03385" rel="noopener ugc nofollow" target="_blank">ResNet-110</a> by 34% and 38%, respectively, without significant degradation of accuracy.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qt"><img src="../Images/e5b14bea61ffe97a84ad1fe9ea848816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_aUolNdwknYnROAL5zIwvA.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx"><a class="af nt" href="https://arxiv.org/abs/1608.08710" rel="noopener ugc nofollow" target="_blank">Li et al. 2016</a> shows the effect of pruning convolutional filters from a CNN.</figcaption></figure><p id="90e5" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Their study also reveals some fascinating insights about how convolutional networks work by comparing the sensitivity of individual CNN layers to pruning, revealing that layers on the very beginning or past halfway through the depth of the network were able to be pruned aggressively with almost no impact on the model performance, but that layers around 1/4 of the way into the network were very sensitive to pruning and doing so made recovering model performance difficult, even with retraining. The results, shown below, reveal that the layers which are most sensitive to pruning are those containing many filters with large absolute sums, supporting the theory of magnitude as a saliency measure, as these layers are clearly more important to the network, since pruning them away causes pronounced negative impact on model performance which is difficult to recover.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qu"><img src="../Images/c1acdb658016554f31de6bb5cd0490c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5JHlgCZtyn9pxMZmTd_Mw.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://arxiv.org/abs/1608.08710" rel="noopener ugc nofollow" target="_blank">Li et al. 2016</a> reveal marked differences in the sensitivity of CNN layers to filter pruning.</figcaption></figure><p id="0999" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Most importantly, the results from Li et al. show that many layers in a CNN could be pruned of even up to 90% of their filters without harming (and in some cases even improving) model performance. Additionally, they found that when pruning filters from the insensitive layers, iterative retraining layer-by-layer was unnecessary, and a single round of pruning and retraining (for 1/4 of the original training time) was all that was required to recover model performance after pruning away significant portions of the network. This is great news in terms of efficiency, since multiple rounds of retraining can be costly, and previous work had reported requiring up to 3x original training time to produce their pruned models. Below we can see the overall results from Li et al. which reveal that the number of floating point operations (FLOPs) could be reduced between 15 and 40 percent in the CNNs studied without harming performance, and in fact offering gains in many instances, setting a firm example of the importance of pruning models after training.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qv"><img src="../Images/25f464067d2d49b748bb8f2a47f0a4f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sCc4CozzbGtvRlmatnDuwQ.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://arxiv.org/abs/1608.08710" rel="noopener ugc nofollow" target="_blank">Li et al. 2016</a> comparing their select pruning configurations to the baseline CNNs, evaluated on CIFAR-10 (top three models) and ImageNet (ResNet-34 section).</figcaption></figure><p id="6c68" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Although this study was clearly motivated by efficiency concerns, we know from decades of evidence linking reduced model complexity to improved generalization that these networks should perform better on unseen data as well, a fundamental advantage which motivated pruning research in the first place. However, this pruning method requires a sensitivity analysis of the network layers in order to be done correctly, requiring additional effort and computation. Further, as LeCun and his colleagues correctly pointed out back in 1989: although magnitude-based pruning is a time-tested strategy, we should expect a theoretically justified metric of salience to produce a superior pruning strategy, but with the size of modern neural networks, computing the Hessian matrix required for the second-order Taylor expansions used in their OBD method would be too intensive. Fortunately, a happy medium was forthcoming.</p><p id="ab0e" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Trailing Li et al. by only a few months in late 2016, <a class="af nt" href="https://arxiv.org/abs/1611.06440" rel="noopener ugc nofollow" target="_blank">Molchanov and his colleagues at Nvidia</a> reinvestigated the use of Taylor expansion to quantify salience for structured pruning of filters from CNNs. In contrast to OBD, they avoid the complex calculation of the second-order terms, and instead extract a useful measure of saliency by considering the variance rather than the mean of the first-order Taylor expansion term. The study provides empirical comparison of several saliency measures against an “oracle” ranking which was computed by exhaustively calculating the change in loss caused by removing each filter from a fine-tuned VGG-16. In the results shown below, we can see that the proposed Taylor expansion saliency measure most closely correlates with the oracle rankings, followed in second place by the more computationally intensive OBD, and the performance results reflect that these methods are also best at preserving accuracy, with the advantage more clearly in favor of the proposed Taylor expansion method when plotting over GFLOPs. Interestingly, the inclusion of random filter pruning in their study shows us that it performs surprisingly well compared to minimum weight (magnitude-based) pruning, challenging the notion that weight magnitude is a reliable measure of saliency, at least for the CNN architectures studied.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qw"><img src="../Images/cf21399bc3d12c2a9c942efa73372998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1jy81eXaGH40cQNENF0n7A.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://arxiv.org/abs/1611.06440" rel="noopener ugc nofollow" target="_blank">Molchanov et al. 2016</a> show first-order Taylor expansion providing effective measure of filter saliency, representing the highest correlations with oracle ranking and best preservation of accuracy.</figcaption></figure></div></div></div><div class="ab cb pi pj pk pl" role="separator"><span class="pm by bm pn po pp"/><span class="pm by bm pn po pp"/><span class="pm by bm pn po"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="568b" class="pq ob fq bf oc pr ps gq og pt pu gt ok pv pw px py pz qa qb qc qd qe qf qg qh bk">Pruning LLMs</h1></div></div><div class="mj"><div class="ab cb"><div class="lm qi ln qj lo qk cf ql cg qm ci bh"><figure class="mk ml mm mn mo mj qo qp paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qn"><img src="../Images/5f7619db0965723a96214dfe3fec7320.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*lm0zjqCjknnKW4TCXKNSaA.jpeg"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Image by author using DALL-E 3.</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="050c" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">After the widespread adoption of LLMs, researchers naturally moved to investigate the use of pruning on these architectures. Both unstructured and structured pruning can be successfully applied to LLMs to reduce their model size substantially with negligible drops in performance. As one might expect, however, the enormous size of these models requires special considerations to be made, since calculating saliency measures over models containing tens or hundreds of billions of weights is very costly, and retraining to recover model performance after pruning is prohibitively expensive. Thus, there is newfound motivation to perform pruning with as little retraining as possible, and to enforce simplicity in the saliency measures used for pruning.</p><p id="0ca7" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Consistent with the previous eras of pruning research, it is apparent that LLMs can be pruned far more aggressively using unstructured as opposed to structured methods, but again the efficiency gains are more directly accessible with the latter. For practitioners with better access to specialized resources, exploiting the sparse matrices and massive compression rates provided by unstructured pruning may be the right choice, but for many people, the accessible efficiency gains on general hardware offered by structured pruning will be more appealing, despite the more modest levels of compression. In this section, we will review both approaches in today’s LLM landscape, so that we are equipped to make the best choice given our individual circumstances.</p><h2 id="23ac" class="oa ob fq bf oc od oe of og oh oi oj ok ng ol om on nk oo op oq no or os ot ou bk">Unstructured Pruning of LLMs</h2><p id="ab2b" class="pw-post-body-paragraph mx my fq mz b go ov nb nc gr ow ne nf ng ox ni nj nk oy nm nn no oz nq nr ns fj bk">In early 2023, <a class="af nt" href="https://arxiv.org/abs/2301.00774" rel="noopener ugc nofollow" target="_blank">SparseGPT</a> was the first work to investigate unstructured pruning of GPT models with billions of parameters, proposing an efficient method using a novel approximate sparse regression solver to determine the prunable weights in models of this scale within a matter of hours, and demonstrating that the largest open source models of the day (≤175B) could be pruned to between 50% and 60% sparsity with minimal loss of accuracy in one shot without any retraining at all, significantly exceeding the results offered by magnitude-based approaches in the one-shot setting. Their approach takes an iterative perspective on OBS, finding that the same mathematical result can be broken down into a series of operations which are more efficient to compute. However, since their method is still an example of unstructured pruning, specialized hardware is necessary for realizing efficiency gains from their technique, and enforcing the required 2:4 or 4:8 semi-structured sparsity pattern expectation causes drops in performance compared to purely unstructured pruning.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qx"><img src="../Images/ee5766a643b4513311f2f9384c9146b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6VLJaPTcDqEuPtyKfIdhXQ.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://arxiv.org/abs/2301.00774" rel="noopener ugc nofollow" target="_blank">SparseGPT</a> show clear advantage over magnitude based pruning (left), and demonstrate the detrimental effects of enforcing sparsity patterns to enable hardware optimization (right).</figcaption></figure><p id="9f69" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Later in mid-2023, the authors of <a class="af nt" href="https://arxiv.org/abs/2306.11695" rel="noopener ugc nofollow" target="_blank">Wanda</a> postulated about why quantization had seen so much more research interest than pruning in the LLM era, whereas previously the two compression techniques were equally popular. They attributed this to the fact that up until SparseGPT, all pruning methods required retraining the LLM at some point, making them cost-prohibitive to anyone without the resources to do so, creating a significant deterrent to both research and practical adoption. While SparseGPT showed that one-shot pruning was possible, their iterative OBS approach is still quite computationally intensive. In this light, Wanda opts for a simple magnitude-based unstructured pruning method, which they augment by multiplying the weight magnitudes by the norm of their associated input activations creating a more descriptive and wholistic magnitude-based measure of saliency. The comparison chart below shows the saliency formulations and complexities of these unstructured approaches.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qy"><img src="../Images/851115ffa10405e0ffdf05de08c14ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jan9p719dUyVmta5DAggMg.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Table from <a class="af nt" href="https://arxiv.org/abs/2306.11695" rel="noopener ugc nofollow" target="_blank">Sun et al. 2023</a> compares unstructured pruning approaches for LLMs and their complexity.</figcaption></figure><p id="130d" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Wanda’s approach also produces pruned models that are ready to use without any retraining, but as an unstructured approach, again requires special hardware for efficiency gains. Nevertheless, for those equipped to take advantage of unstructured pruning, Wanda’s approach matches or exceeds the results of SparseGPT while reducing complexity by an entire factor of the model’s hidden dimension, establishing it as a strong choice for the compression of LLMs.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qz"><img src="../Images/7a3ad35c80394d85378d8469b274cc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jb8_hzymZ5OIbSnwnllD4A.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Table from <a class="af nt" href="https://arxiv.org/abs/2306.11695" rel="noopener ugc nofollow" target="_blank">Sun et al. 2023</a> shows competitive performance with SparseGPT with a fraction of the complexity.</figcaption></figure><h2 id="94ac" class="oa ob fq bf oc od oe of og oh oi oj ok ng ol om on nk oo op oq no or os ot ou bk">Structured Pruning of LLMs</h2><p id="4ff0" class="pw-post-body-paragraph mx my fq mz b go ov nb nc gr ow ne nf ng ox ni nj nk oy nm nn no oz nq nr ns fj bk">Contemporaneously with Wanda, researchers at the National University of Singapore offered a structured pruning method called <a class="af nt" href="https://arxiv.org/abs/2305.11627" rel="noopener ugc nofollow" target="_blank">LLM-Pruner</a>. In their study, they found it necessary to settle for a 20% pruning rate, since more aggressive pruning led to substantially degraded performance. Also, while it was necessary to retrain the weights after pruning to recover model performance, they were able to achieve this using low-rank adaptation (<a class="af nt" href="https://arxiv.org/abs/2106.09685" rel="noopener ugc nofollow" target="_blank">LoRA</a>) in just 3 hours on 50k training samples. Although the efficiency of fine-tuning with LoRA is a relief, their method nonetheless requires gradients for the full model to be generated to measure parameter saliency before pruning, so while resource-constrained users may enjoy the pruned model, performing the operation themselves may not be possible.</p><p id="9820" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Just slightly later in 2023, <a class="af nt" href="https://arxiv.org/abs/2305.18403" rel="noopener ugc nofollow" target="_blank">LoRAPrune</a> improved on the effectiveness for structured pruning of LLMs substantially by using the gradients and weights of LoRA training to establish parameter importance in the larger network, and performing iterative rounds of pruning on both the network and corresponding LoRA weights. This method is able to prune the LLaMA-65B model on a single 80GB A100 GPU, thanks to depending on the gradients of the efficient low-rank parameter space rather than the full model. Since the LLM weights remain frozen during the process, they can be quantized to 8-bit to save memory with minimal impact on the results.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qt"><img src="../Images/6f323a2d614994c41f5a0c613dc64582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BUk9sTd0cgS2sXZZ9vA1Ww.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Helpful graphic from <a class="af nt" href="https://arxiv.org/abs/2305.18403" rel="noopener ugc nofollow" target="_blank">Zhang et al. 2023</a> depicts the structured pruning method used in LoRAPrune.</figcaption></figure><p id="56ee" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Although they came up against the same sensitivity of the LLM to more aggressive levels of structured pruning, the authors of LoRAPrune demonstrate through extensive experimentation that their method produced pruned models with superior performance compared to previous structured methods using only a fraction of the resources to perform the pruning operation.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu ra"><img src="../Images/c354234a8a204088dac00f5e3bc0bbff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1GVjnnl8Bw3YAY8yB9b9Q.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://arxiv.org/abs/2305.18403" rel="noopener ugc nofollow" target="_blank">LoRAPrune</a> demonstrate a clear advantage after fine-tuning compared with previous methods.</figcaption></figure><p id="85bd" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In October of 2023, researchers at Microsoft proposed <a class="af nt" href="https://arxiv.org/abs/2310.18356" rel="noopener ugc nofollow" target="_blank">LoRAShear</a>, a structured pruning method which uses Dependency Graph Analysis on the LLM and progressive structured pruning via LoRA Half-Space Projected Gradient (LHSPG), which “transfers the knowledge stored in the relatively redundant structures to the important structures to better preserve the knowledge of the pretrained LLM.” Additionally, they go beyond the trend in previous works of performing only instruction-based fine-tuning to recover knowledge, and instead first adaptively create a subset from the pretraining datasets based on the resulting performance distribution to recover the general pretraining knowledge that was lost during pruning, and then proceeding to “perform the usual instructed finetuning to recover domain-specific expertise and the instruction capacity of pruned LLMs.” With their more involved approach, they achieve a mere 1% drop in performance at the 20% pruning rate, and maintain an unprecedented 82% of original performance at the 50% pruning rate.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu rb"><img src="../Images/2457542d271dee6ac816b97ec4f2a110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X9NzyHQv1qd2I2lsgCM8pQ.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from LoRAShear shows superior performance, albeit with a much more complex pruning algorithm.</figcaption></figure><p id="b39e" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">Then in early 2024, the aptly named <a class="af nt" href="https://arxiv.org/abs/2402.05406" rel="noopener ugc nofollow" target="_blank">Bonsai</a> demonstrated a superior method for structured pruning of LLMs using only forward pass information, drastically reducing the computational requirements for performing the pruning process by not requiring gradients, thereby empowering those most in need of pruned models to generate them within their resource-constrained environments. With their efficient approach, they are able to closely match the performance of LoRAShear in the instruction-tuned only condition, although it would appear the additional considerations made by LoRAShear do pay dividends in knowledge recovery, but the differing spreads of evaluation datasets used in the two studies unfortunately disallow for clear comparison. Interestingly, LoRAShear is unmentioned in the Bonsai paper, presumably for the reason that the additional levels of complexity in the former make for a muddy comparison with the more straightforward methods examined by the latter, but we are left to speculate. Nevertheless, Bonsai contributes a powerful and valuable step towards democratizing LLMs and their pruning by focusing on simplicity and efficiency, able to perform the pruning operation using only the amount of GPU memory needed to run inference for a given model, and achieves impressive results with the most accessible method of structured LLM pruning published so far.</p><figure class="mk ml mm mn mo mj mt mu paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu rc"><img src="../Images/ee2bb241e10ac109fbc70f90e45a5114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIZWaMCw3uaH-gbUVLXK4g.png"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Results from <a class="af nt" href="https://arxiv.org/abs/2402.05406" rel="noopener ugc nofollow" target="_blank">Dery et al.</a> show Bonsai achieves superior performance to previous structured pruning methods.</figcaption></figure></div></div></div><div class="ab cb pi pj pk pl" role="separator"><span class="pm by bm pn po pp"/><span class="pm by bm pn po pp"/><span class="pm by bm pn po"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="4f8d" class="pq ob fq bf oc pr ps gq og pt pu gt ok pv pw px py pz qa qb qc qd qe qf qg qh bk">Conclusion</h1></div></div><div class="mj"><div class="ab cb"><div class="lm qi ln qj lo qk cf ql cg qm ci bh"><figure class="mk ml mm mn mo mj qo qp paragraph-image"><div role="button" tabindex="0" class="nv nw ed nx bh ny"><div class="mt mu qn"><img src="../Images/d51a02f57e1aebfb01cd6d23bac8b10b.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*I4SErLm35uIakoXG9r6IgQ.jpeg"/></div></div><figcaption class="mq mr ms mt mu mv mw bf b bg z dx">Image by author using DALL-E 3.</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="ac5e" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">In this article, we’ve journeyed through the history of network pruning, starting with the dawn of unstructured techniques in the late 1980s to the current trends in LLM applications. We’ve seen that pruning is broadly categorized as either <em class="nz">unstructured</em> or <em class="nz">structured</em> pruning, depending on whether the weights are considered individually or in groups, and that the latter, while only usable at lower compression rates, provides direct relief in computational burden. We saw that gains in efficiency can be realized in the unstructured setting, but only when special storage techniques and hardware are used, and that an additional “semi-structured” condition must be obeyed for the hardware acceleration to work, which comes at a cost in performance compared with pure unstructured pruning. Pure unstructured pruning provides the most stunning compression rates with no loss in accuracy, but the irregular sparsity created does not provide efficiency gains outside of storage size, making it less appealing in the context of democratizing LLMs.</p><p id="cd18" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">We’ve explored the concept of saliency, which refers to the various measures of importance (saliency) by which model parameters can be pruned. The most simple and accessible estimation of saliency is weight magnitude, where weights closer to zero are assumed to be less important. Although this approach is not theoretically sound (as near-zero weights can indeed be important to model performance), it is still extremely effective, and the lack of complex calculations gives it persisting popularity. On the other hand, theoretically sound measures of saliency date back to the earliest days of trainable neural networks, and are proven to produce superior models compared to magnitude-based pruning, but the complex calculations required by these early methods don’t scale well to the size of today’s LLMs. Fortunately, motivated researchers in the modern era have found ways to calculate these saliency metrics more efficiently, but alas, they still require the calculation of the gradients. In the most recent work from 2024, Bonsai demonstrated that accurate pruning can be achieved without gradients, using only the information from the forward pass.</p><p id="30f0" class="pw-post-body-paragraph mx my fq mz b go na nb nc gr nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns fj bk">While modern pruning research is driven primarily by the interest of compressing the unwieldy sizes of today’s top performing models so that they can be deployed on reasonably sized hardware, pruning was originally motivated by the improved generalizability that results from reducing model complexity. This regularization effect is surely taking effect in pruned LLMs, which is presumably a benefit, but the actual impact of this is less studied in today’s literature. While improving model generalizability and reducing overfitting through regularization are known to be beneficial, there may be special considerations which need to be made in the context of LLMs, which are often expected to recall minute details in vast sums of training data, depending on the use case. Therefore, it would be fruitful for future work to investigate at what point this regularization starts to have deleterious effects on intended use cases of LLMs.</p><h2 id="cf46" class="oa ob fq bf oc od oe of og oh oi oj ok ng ol om on nk oo op oq no or os ot ou bk">In the next episode…</h2><p id="a755" class="pw-post-body-paragraph mx my fq mz b go ov nb nc gr ow ne nf ng ox ni nj nk oy nm nn no oz nq nr ns fj bk">The methods investigated in this article offer effective model compression through the removal of model parameters, known as <em class="nz">pruning</em>, but this is only one approach to model compression. In the next article, we will explore the concept of <em class="nz">quantization</em> at various resolutions, developing a functional knowledge of the subject within a reasonable memory footprint.</p></div></div></div></div>    
</body>
</html>