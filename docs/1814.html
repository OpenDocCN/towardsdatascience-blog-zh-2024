<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Unit Disk and 2D Bounded KDE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Unit Disk and 2D Bounded KDE</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/unit-disk-and-2d-bounded-kde-2cb5c3544f1c?source=collection_archive---------8-----------------------#2024-07-25">https://towardsdatascience.com/unit-disk-and-2d-bounded-kde-2cb5c3544f1c?source=collection_archive---------8-----------------------#2024-07-25</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="0ed4" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">How to extend Bounded Kernel Density Estimation to the 2D case? Let’s explore how to fix boundary bias around the unit disk.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@thom01.rouch?source=post_page---byline--2cb5c3544f1c--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Thomas Rouch" class="l ep by dd de cx" src="../Images/a8440bbed59cd8d9cdd752cf1fea2831.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*bzXmGPw5ErdKoJZ6gYLBsw.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--2cb5c3544f1c--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@thom01.rouch?source=post_page---byline--2cb5c3544f1c--------------------------------" rel="noopener follow">Thomas Rouch</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--2cb5c3544f1c--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">12 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jul 25, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/ec9b89e02ffca87b6de3078ca825c636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dYWtBRPEw_JZc7JW"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@leo_visions_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Leo_Visions</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2d36" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">0. Introduction</h1><h2 id="b633" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">MonteCarlo Integration</h2><p id="ea96" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">N</span>umerical methods become essential when closed-form solutions for integrals are unavailable. While traditional numerical integration techniques like trapezoidal integration are highly effective for low-dimensional and smooth integrals, their efficiency diminishes rapidly, becoming clearly intractable as the dimensionality of the integrand increases.</p><p id="f3d3" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Unlike traditional techniques, the convergence rate of Monte Carlo methods, which leverage randomness to evaluate integrals, does not depend on the dimensionality of the integrand. It depends solely on the number of random samples drawn.</p><h2 id="543c" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Sampling</h2><p id="8f26" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">As</span> described in the equation below, the Monte Carlo estimates the integral by a weighted mean of the operand evaluated at samples drawn from a given distribution.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj pz"><img src="../Images/6d160d6f1e82e716632aebce4d6465d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*69SK5y99QKpbxcdyEyqqhQ.png"/></div></figure><p id="028c" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Monte Carlo Integration thus requires to be able to sample from arbitrary distributions across arbitrary dimensions.</p><p id="2e7e" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">With <code class="cx qa qb qc qd b">n</code> samples, these methods converge to the correct result at a rate of <code class="cx qa qb qc qd b">O(1/sqrt(n))</code>. To halve the error, you need four times as many samples. Therefore, optimizing the sampling process to make the most of each sample is crucial.</p><p id="53b1" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Uniform sampling helps ensuring that all regions of the integrand are equally likely to be sampled, avoiding the redundancy of closely spaced samples that provide little additional information.</p><p id="6bdb" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Other techniques like importance sampling for instance aims at reducing the variance by prioritizing the sampling of more significant regions of the integrand.</p><h2 id="c34a" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Visualize 2D Disk Sampling</h2><p id="b36a" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he book <a class="af nb" href="https://pbrt.org/" rel="noopener ugc nofollow" target="_blank"><em class="qe">PBRT (Physically Based Rendering: From Theory To Implementation)</em></a> does a great job at explaining methods to sample from different geometries like disks, triangles or hemispheres to compute solutions to the integral equations that describe light scattering.</p><p id="bb9d" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">I was excited by the variety of methods I discovered for sampling a disk and intrigued by their underlying principles. To better understand and visually compare these 2D distributions, I decided to plot a density map for each method.</p><p id="b3d4" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">However, a boundary bias occurs when running kernel density estimation (KDE) on a disk because the kernel function extends beyond the boundary of the disk, leading to an underestimation of the density near the edges.</p><p id="1c55" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">This article aims at providing a way to visualize an unbiased density map of the 2D unit disk.</p><h2 id="3b8b" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Article Outline</h2><p id="881d" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">B</span>uilding upon my previous article <a class="af nb" href="https://medium.com/towards-data-science/bounded-kernel-density-estimation-2082dff3f47f" rel="noopener"><em class="qe">Bounded Kernel Density Estimation</em></a>, where I explored various methods used to address the boundary bias in the 1D context, we’ll test the following methods:</p><ul class=""><li id="6cdd" class="os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk qf qg qh bk"><em class="qe">Reflection</em>: Reflect points with respect to the circle’s edge</li><li id="7249" class="os ot fq ou b go qi ow ox gr qj oz pa of qk pc pd oj ql pf pg on qm pi pj pk qf qg qh bk"><em class="qe">Transform</em>: Map bounded disk to an unbounded space to perform KDE</li><li id="6cb1" class="os ot fq ou b go qi ow ox gr qj oz pa of qk pc pd oj ql pf pg on qm pi pj pk qf qg qh bk"><em class="qe">Weighting</em>: Cut and normalize the kernels spreading outside the disk</li></ul></div></div></div><div class="ab cb qn qo qp qq" role="separator"><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qv"><img src="../Images/b9ef2f835f1665dd3581a0c8ba5c5944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Svt6HBDuiV7R2Wdk"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@nateshipps?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nathan Shipps</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="70c3" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">1. Boundary Bias around the disk</h1><h2 id="1b05" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Boundary bias</h2><p id="1dc8" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">As</span> As discussed in the introduction, conventional Kernel Density Estimations (KDE) struggle to effectively manage distributions with compact support, such as points within a disk.</p><p id="7cde" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Indeed, as illustrated in the figure below with a square domain, kernel span tends to leak beyond the boundary, artificially lowering the density near the edges.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/9f37564088b91ec08ce16c5e5d9ccd74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*67EdpsxkJdS6A8O_7KQ52w.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Kernel leaking beyond the boundaries of a square — Figure by the author</figcaption></figure><h2 id="3b33" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk"><span class="l pm pn po bo pp pq pr ps pt ed">V</span>anilla Gaussian KDE</h2><p id="0931" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he code below samples points on a grid at regular intervals across the unit square, retaining only those within the disk to input into a vanilla Gaussian KDE. Predicted densities are then set to zero outside the disk after the KDE evaluation to keep the boundary constraint.</p><p id="58fc" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Finally, the density is normalized by multiplying it by the disk area (π), ensuring an expected density of 1.0 throughout the interior of the disk.</p><blockquote class="qx qy qz"><p id="80a2" class="os ot qe ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">In<!-- --> practice, the input points are not lying on a regular grid, and thus we need to sample a grid at display resolution to evaluate the estimated KDE.</p></blockquote><figure class="ml mm mn mo mp mq"><div class="ra io l ed"><div class="rb rc l"/></div></figure><p id="6e4d" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The left figure below has been obtained by running the code above. A noticeable density decrease can be observed around the disk’s edge. To better illustrate the falloff near the edge, I have also extracted the density profile along the diagonal, which ideally should be a perfect step function.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rd"><img src="../Images/3e6859b460524a0397a5bd55438960df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cUAvygggyoJ9xcewBQ5CAA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Left: Base KDE on samples drawn uniformly within the unit disk. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure></div></div></div><div class="ab cb qn qo qp qq" role="separator"><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj re"><img src="../Images/a451c14e76bf8026d821782d91e85316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OkrF-euewyKGe3G4"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@sekatsky?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Михаил Секацкий</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="86bc" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">2. Reflection Trick</h1><h2 id="898e" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Reflection</h2><p id="65cd" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">In</span> 1D, the trick consists in augmenting the set of samples by reflecting them across the left and right boundaries. It helps compensating the lack of neighbors on the other side of the boundary. This is equivalent to reflecting the tails of the local kernels to keep them in the bounded domain. The formula below is used to reflect positive 1D values.</p><blockquote class="qx qy qz"><p id="242f" class="os ot qe ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Note that it works best when the density derivative is zero at the boundary.</p></blockquote><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rf"><img src="../Images/98530866e0af243fd41b016f0e38e7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*XjcvLpANVzEjz04a6u_7dw.png"/></div></figure><p id="dbd7" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">However, in 2D, there isn’t a universal reflection formula; it depends on the boundary shape. Intuitively, the reflection should align with the boundary normals. Therefore, for a disk, it makes sense to reflect points along the radial direction, which means that the reflection only modifies the radius.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rg"><img src="../Images/ddcf038f7fde1be4df50505f03c5a337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-2I8ql2XgtfXeL7iM3D-Q.png"/></div></div></figure><blockquote class="qx qy qz"><p id="17b5" class="os ot qe ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Note that handling boundary reflections of the unit square is more challenging than the disk due to the non-differentiability of its boundary line at the corners.</p></blockquote><h2 id="0544" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Intuitive Disk Reflection</h2><p id="79d1" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">I</span>ntuitively, we can mimic the 1D case by reflecting the point symmetrically across the boundary. A point at radius <code class="cx qa qb qc qd b">r</code> is at a distance of <code class="cx qa qb qc qd b">1-r</code> from the edge. By adding this distance beyond the boundary, we get <code class="cx qa qb qc qd b">2-r</code>. The equation and figure below demonstrate how points are reflected across the edge of the unit disk using this symmetry.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rh"><img src="../Images/c43146ac1fac68bc6df51db91490fe1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*5NnAzA8KQi_4d0w4C5dq8w.png"/></div></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj ri"><img src="../Images/978bb2781e207ce52a903fd5cc3d4cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RMfdJ8CEDsBAgbTtExigaw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Colored points reflected symmetrically across the unit disk edge using f(r)=2-r. Circles at radius r=1 and r=2. — Figure by the author</figcaption></figure><p id="c313" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">However, when this method is applied to correct the density map, a slight falloff around the edge is still noticeable, although it significantly improves upon the standard KDE.</p><figure class="ml mm mn mo mp mq"><div class="ra io l ed"><div class="rb rc l"/></div></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rd"><img src="../Images/b884385683ef61bf3bf280acaa30518f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJUJHX8ud9kzfYX4MjiRjQ.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Left: Reflection KDE on samples drawn uniformly within the unit disk. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure><h2 id="5587" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Optimized Disk Reflection</h2><p id="bfc7" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">L</span>et’s see how we can improve this reflection function to better suit the disk boundary. Unlike the 1D case, the <code class="cx qa qb qc qd b">f(r)=2-r</code> reflection distorts the space and maps the unit disk of area π to a larger ring of area 3π.</p><p id="c2f5" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Ideally we’d like that the area of each differential surface inside the disk remains invariant during the reflection mapping. As illustrated in the figure below, we consider differential variations dr and dθ around a point at radius r.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rj"><img src="../Images/607de0ee48e70824896038fb61d2c310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJBuuzw4w_mn_SNr6fUwDA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Differential surface before (r, dr, dθ) and after the reflection — Figure by the author</figcaption></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rk"><img src="../Images/3720ba80ee5feeef4ebad68f7c0fee6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ki9kjj014XCaWMglcMOsHA.png"/></div></div></figure><p id="4fd9" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The conservation of area results in a differential equation that the reflection function must satisfy. Note that the minus sign arises because the function f is necessarily decreasing due to its reflective nature.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rl"><img src="../Images/ce8684a6bdcce66d55a294d7c1a33ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J950RePUIgoxvT3JRo73wA.png"/></div></div></figure><p id="815c" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Given the boundary condition <code class="cx qa qb qc qd b">f(1)=1</code> , there’s a single solution to the differential equation <code class="cx qa qb qc qd b">-x=yy'</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rm"><img src="../Images/c11701f3d19077d43ee4f32d22b606e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*UhVk_R1PXmapZTOlh4hmzw.png"/></div></figure><p id="031c" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">We just have to update our code with the new reflection formula. Reflected points are now contained within the ring between radii 1 and √2. As we can see, reflected points are not too distorted and keep a similar local density.</p><figure class="ml mm mn mo mp mq"><div class="ra io l ed"><div class="rb rc l"/></div></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rn"><img src="../Images/5713b62b40d16b0e1158ed018bf357da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qVUGbsZiZkvfKki2AO8Mmw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Colored points reflected across the unit disk edge using f(r)=sqrt(2-r²). Circles at radius r=1, r=sqrt(2) and r=2. — Figure by the author</figcaption></figure><p id="5516" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">This time, the resulting density estimate looks nearly perfect!</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rd"><img src="../Images/d18de7cdf9572a7a9f18ba3c79502412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFLejA1XlrlCPDeqNJCZ0g.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Left: Optimized reflection KDE on samples drawn uniformly within the unit disk. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure></div></div></div><div class="ab cb qn qo qp qq" role="separator"><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/03232e5fa3a128665deea8c6fe3bb939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F59hXy96BuLZ7EGX"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@spacex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">SpaceX</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2cb3" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">3. Transformation Trick</h1><h2 id="7c01" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">KDE in transformed space</h2><p id="abd1" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he transformation trick maps the bounded data to an unbounded space, where the vanilla KDE can be safely applied. This results in using a different kernel function for each input sample.</p><blockquote class="qx qy qz"><p id="f450" class="os ot qe ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">However, as seen in previous article <a class="af nb" href="https://medium.com/towards-data-science/bounded-kernel-density-estimation-2082dff3f47f" rel="noopener"><em class="fq">Bounded Kernel Density Estimation</em></a>, , when the density is non-zero at the boundary and does not tend to infinity, it often results in unwanted artifacts.</p></blockquote><h2 id="af3d" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Transformation</h2><p id="c5a1" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">B</span>uilding upon our approach from the previous section, we will again use central symmetry and choose a transformation <code class="cx qa qb qc qd b">f</code> that alters only the radius. Transformed variables will be indicated with a tilde <code class="cx qa qb qc qd b">~</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj ro"><img src="../Images/5b4f6a1a2a188469ad2b463c870c6ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*lXorZpO6rXJcUqzdYCKGXA.png"/></div></figure><p id="3b20" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">However, unlike the reflection case, where we preserved the unit disk and used the transformation solely to add new points, here we directly transform and use the points from within the unit disk.</p><p id="070f" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Thus the boundary conditions are different and enforce instead to left the origin untouched and to dilate the disk to infinity.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rp"><img src="../Images/955be14ee2706712da691cf257bfd8ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*x2LwyeociPY_wzsta2C0hw.png"/></div></figure><h2 id="024a" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Density Transformation</h2><p id="d5fe" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">W</span>hen applying a transformation T to a multi-dimensional random variable U, the resulting density is found by dividing by the absolute value of the determinant of the Jacobian matrix of T.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rq"><img src="../Images/198b30a69bbf3e6710e4b3f31a971c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lRbECEHY0-Zf7vzecs5dg.png"/></div></div></figure><p id="d195" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">For instance, the polar transformation gives us the following density.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rr"><img src="../Images/d67aab7843e4c3b8a8829d0c4d9da02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*325CcM2Xbq1Ofjh24TV5eA.png"/></div></figure><p id="721e" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Based on the two previous properties, we can derive the relationship between the density before and after the transformation. This will enable us to recover the true density from the density estimated on the transformed points.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rs"><img src="../Images/8647eca330ee2cb37f89ee21b4bb4579.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*-16Cay1lVvcdEkWLMY8h6w.png"/></div></figure><h2 id="8025" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Which transformation to choose? Log, Inverse ?</h2><p id="42ee" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>here are plenty of functions that start from zero and increase to infinity as they approach 1. There is no one-size-fits-all answer.</p><p id="8857" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The figure below showcases potential candidate functions created using logarithmic and inverse transformations to introduce a singularity at <code class="cx qa qb qc qd b">r=-1</code> and <code class="cx qa qb qc qd b">r=1</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/7cb4fa038b8fdca1a34f48f27ca9ffce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POsipzdHUdwqm4nN7FUQdQ.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Examples of functions that equal zero at the origin and tend to infinity as they approach +/-1 — Figure by the author</figcaption></figure><p id="4b98" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Based on the equation describing the transformed density, we aim to find a transformation that maps the uniform distribution to a form easily estimable by vanilla KDE. If we have a uniform distribution <code class="cx qa qb qc qd b">p(x,y)</code>, the density in transformed space is thus proportional to the function <code class="cx qa qb qc qd b">g</code> below.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rt"><img src="../Images/cda78ca4d98f029d2cf455cc0c8c9da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*PGEga7sp4p2OUKhY4Fv80A.png"/></div></figure><p id="3de5" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Logarithmic and inverse candidates give the following <code class="cx qa qb qc qd b">g</code> functions.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj ru"><img src="../Images/42e89020c8d230eb49779cafba117417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNytlM66ziHnADo4wShUXQ.png"/></div></div></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rv"><img src="../Images/39c366866c1df22882164b364a735321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5HgmwYOGiVAypq0YpmdTTg.png"/></div></div></figure><p id="f2eb" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">They’re both equivalent when <code class="cx qa qb qc qd b">r</code> approaches zero and only converge to a meaningful value when α is equal to one.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rw"><img src="../Images/f7d4637b486fd2ea9d5c7ef4c8f4b641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NmXBeuL4HUV-EwloH3XSdw.png"/></div></div></figure><p id="f9d5" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The figure below illustrates the three cases, with each column corresponding to the log transform with alpha values of 0.5, 1 and 2.</p><p id="06af" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The first row shows the transformed space, comparing the density along the diagonal as estimated by the KDE on the transformed points (blue) against the expected density profile corresponding to the uniform distribution in the original space (red). The second row displays these same curves, but mapped back to the original space.</p><blockquote class="qx qy qz"><p id="fddb" class="os ot qe ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Keep in mind that the transformation and KDE are still performed in 2D on the disk. The one-dimensional curves shown below are extracted from the 2D results.</p></blockquote></div></div><div class="mq"><div class="ab cb"><div class="ll rx lm ry ln rz cf sa cg sb ci bh"><figure class="ml mm mn mo mp mq sc sd paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/d74c925d22997679fcec81e4e6300eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dWLTx-aCBEy5A1abHsnECw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Density along the diagonal in transformed and original domain (first and second row). The columns correspond to the log-based transformation with alpha equal to 0.5 / 1 / 2 — Figure by the author</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="794b" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Both <strong class="ou fr">α&lt;1 </strong>and<strong class="ou fr"> α&gt;1 </strong>introduce singularities near the origin, which completely ruin the interior density estimate. As for <strong class="ou fr">α=1</strong>, the expected density in transformed space is highly non-differentiable at the origin, resembling a pointed hat shape, which is impossible to fit with gaussian kernels.</p><p id="462c" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Moreover, the tail density is highly sensible to noise, which can produce high-frequency artifacts near the boundaries. In my opinion, this issue is more problematic than the original bias we are trying to address.</p><h2 id="cfca" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Try with another Kernel?</h2><p id="4d8f" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk">To achieve more accurate fit for the expected pointed shape when <strong class="ou fr">α=1</strong>, I estimated the density using a triangular kernel instead of a Gaussian one, as shown in the code below.</p><figure class="ml mm mn mo mp mq"><div class="ra io l ed"><div class="rb rc l"/></div></figure><p id="0d6e" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Although the fit is slightly better, it remains highly biased at the origin. Additionally, the boundary becomes completely unstable, oscillating at high frequency due to the low bandwidth required to fit the very steep pointed shape at the origin.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/2d3763d0cec90680876ade34c66beb03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f2ik_iOwqV8Tiqymqqa84w.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Density along the diagonal in transformed and original domain (first and second row), for the log-based transformation with alpha equal 1, using a triangle filter — Figure by the author</figcaption></figure><h2 id="14a4" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Try with the tangent function?</h2><p id="3cb6" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he tangent function also proves to be a suitable candidate to introduce a singularity at <code class="cx qa qb qc qd b">r=1</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj se"><img src="../Images/c518663356641f0e3a3a74fa5f30ace8.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/0*xfvHMPz1Ic_aby6Z"/></div></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj sf"><img src="../Images/d8d5c736e87d89e16ee3aa2e47569a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hSVdf8zXKgGxCls1SzKzgw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Tangent function modified to tend to infinity as the radius approaches +/-1 — Figure by the author</figcaption></figure><p id="27a5" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Fortunately, its corresponding <code class="cx qa qb qc qd b">g</code> function turns out to be differentiable at the origin, which should make it much easier to fit.</p><blockquote class="qx qy qz"><p id="64c7" class="os ot qe ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">To maintain readability and avoid redundancy, I will not include the mathematical details that led to these results.</p></blockquote><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj sg"><img src="../Images/83026a897d26229483f8e6ce6dd3b7a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WbQsJQa9K9mQJAnQ"/></div></div></figure><p id="db5d" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">However, as illustrated in the figure below, we’re still subject to the same instability around the boundary.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/f9637ffbd11644ad0df22aafb2107245.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ICwiJClX96j81Xz1NQDVg.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Density along the diagonal in transformed and original domain (first and second row), for the tan-based transformation — Figure by the author</figcaption></figure><h2 id="c41a" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Conclusion</h2><p id="d1ce" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he transformation method appears unsuitable for our uniform distribution within the 2D disk. It introduces excessive variance near the boundaries and significantly disrupts the interior, which was already perfectly unbiased.</p><p id="ed1b" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Despite the poor performance, I’ve also generated the resulting 2D density map obtained with the Transform KDE using the log and tangent transformations.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/de437992636891765c692b65831f8da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6UN8RfleZypyG8fTjo6_Q.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Left: Log Transform KDE on samples drawn uniformly within the unit disk. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/6469a37826922a1ce11469f73cf0b55a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCFgEwrD_u355lVHJjV-MQ.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Left: Tangent Transform KDE on samples drawn uniformly within the unit disk. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure></div></div></div><div class="ab cb qn qo qp qq" role="separator"><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj sh"><img src="../Images/d05eb760e26f8b70089908e9aae880ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*svdgwFsO8ZH-Vm84"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@saltsup?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Piret Ilver</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="c327" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">4. Cut-and-Normalize Trick</h1><h2 id="113f" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Weighting</h2><p id="d549" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">S</span>ince the density is artificially lower around he boundary because of the lack of neighbors, we could compute how much of our local kernel has been lost outside the bounded domain and leverage it to correct the bias.</p><p id="1328" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">In 1D, this involves computing the integral of a Gaussian over an interval. It’s straightforward, as it can be done by estimating the Cumulative Density Function at both ends of the interval and subtracting the values.</p><p id="dd12" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">However, in 2D, this requires computing the integral of a 2D Gaussian over a disk. Since there is no analytical solution for this, it must be numerically approximated, making it more computationally expensive.</p><h2 id="3a78" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Numerical Approximation</h2><p id="0671" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">It</span> would be too expensive to perform numerical integration for each single predicted density. Since we are essentially computing the convolution between a binary disk and a Gaussian kernel, I propose discretizing the unit square to perform numerical convolution.</p><p id="f111" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">In the code below, we assume an isotropic Gaussian and retrieve the kernel standard deviation. Subsequently, we perform the convolution on the binary disk mask using OpenCV, resulting in the array shown in the figure below. Notice how closely it approximates the biased vanilla KDE.</p><figure class="ml mm mn mo mp mq"><div class="ra io l ed"><div class="rb rc l"/></div></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj si"><img src="../Images/a580a9450e42692374802764e4dedbf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kUPv8oSlNCMOEVL4T6_TDA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Gaussian Blur applied on the binary image of the Unit Disk. Circle at radius 1— Figure by the author</figcaption></figure><h2 id="b532" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Result</h2><p id="8d14" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">O</span>nce the correction weight map has been computed, we can apply it to the biased predicted density. The corrected density map is then almost perfect.</p><figure class="ml mm mn mo mp mq"><div class="ra io l ed"><div class="rb rc l"/></div></figure><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qw"><img src="../Images/927a7a7233330a6f97e6a3a168970531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XIjx65cNeMYoU00jKqGC5Q.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Left: Cut-and-Normalize KDE on samples drawn uniformly within the unit disk. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure></div></div></div><div class="ab cb qn qo qp qq" role="separator"><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj sj"><img src="../Images/9fb00bbf65647ea62f693c37a2f9672e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RybBN77fNNNDItsO"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@floschmaezz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Florian Schmetz</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="7518" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Conclusion</h1><h2 id="3d99" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Performance</h2><p id="11d8" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he <strong class="ou fr">Reflection</strong> and <strong class="ou fr">Cut-and-Normalize</strong> methods are very easy to use and effectively mitigate the boundary bias. In contrast, the <strong class="ou fr">Transform</strong> method shows poor performance on the uniform 2D disk, despite testing various singular functions and kernel types.</p><h2 id="dd05" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Speed</h2><p id="cdc2" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he <strong class="ou fr">Reflection</strong> method transforms the input of the KDE, whereas the <strong class="ou fr">Cut-and-Normalize </strong>method transforms its output.</p><p id="08ee" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Since the Gaussian KDE has a time complexity that is quadratic in the number of samples, i.e. O(n²), <strong class="ou fr">Reflection</strong> is approximately four times slower than<strong class="ou fr"> Cut-and-Normalize</strong> because it requires twice as many samples.</p><p id="a893" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Thus, the <strong class="ou fr">Cut-and-Normalize </strong>method seems to be the easiest and fastest way to compensate the boundary bias on the 2D uniform Disk distribution.</p><h2 id="57e6" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Visualize 2D Disk Sampling</h2><p id="6210" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">We</span> can now simulate different disk sampling strategies and compare them based on their density map, without having to worry about the boundary bias.</p></div></div></div><div class="ab cb qn qo qp qq" role="separator"><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt qu"/><span class="qr by bm qs qt"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="26dd" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">I hope you enjoyed reading this article and that it gave you more insights on how to perform bounded Kernel Density Estimation in the 2D case.</p></div></div></div></div>    
</body>
</html>