<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Towards Reliable Synthetic Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Towards Reliable Synthetic Control</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/towards-reliable-synthetic-control-156106a1a7cb?source=collection_archive---------10-----------------------#2024-04-16">https://towardsdatascience.com/towards-reliable-synthetic-control-156106a1a7cb?source=collection_archive---------10-----------------------#2024-04-16</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="7c66" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Making the estimated treatment effect close to the truth</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@hangyu_5199?source=post_page---byline--156106a1a7cb--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Hang Yu" class="l ep by dd de cx" src="../Images/feb12ff14af31f9875ea2ad121d5a41e.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*90Kh75UPYO6k-69hmbvp7g.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--156106a1a7cb--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@hangyu_5199?source=post_page---byline--156106a1a7cb--------------------------------" rel="noopener follow">Hang Yu</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--156106a1a7cb--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Apr 16, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/eb95de0aa20bbae59206eab33ec61516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cjzgSOfcgLh4aS0f"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@jhaland?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jørgen Håland</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="ed31" class="nd ne fq bf nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa bk">Introduction</h2><p id="36be" class="pw-post-body-paragraph ob oc fq od b go oe of og gr oh oi oj no ok ol om ns on oo op nw oq or os ot fj bk">In recent years, the Synthetic Control (SC) approach has gained increasing adoption in industry for measuring the the Average Treatment Effect (ATE) of interventions when Randomized Control Trials (RCTs) are not available. One such example is measuring the financial impact of outdoor advertisements on billboards whereby we cannot conduct random treatment assignment in practice.</p><p id="4814" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">The basic idea of SC is to estimate ATE by comparing the treatment group against the predicted counterfactual. However, applying SC in practice is usually challenged by the limited knowledge of its validity due to the absence of the true counterfactual in the real world. To mitigate the concern, in this article, I would like to discuss the actionable best practices that help to maximise the reliability of the SC estimation.</p><p id="c2f5" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">The insights and conclusions are obtained through experiments based on diverse synthetic data. The code for data generation, causal inference modeling, and analysis is available in the Jupyter notebook hosted on <a class="af nc" href="https://github.com/simon19891101/ML_experiments/blob/main/sc_reliability.ipynb" rel="noopener ugc nofollow" target="_blank">Github</a>.</p><h2 id="b94e" class="nd ne fq bf nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa bk">Synthetic Control in a Nutshell</h2><p id="9890" class="pw-post-body-paragraph ob oc fq od b go oe of og gr oh oi oj no ok ol om ns on oo op nw oq or os ot fj bk">The key to measure the ATE of such events is to identify the counterfactual of the treatment group, which is the treatment group in the absence of the treatment, and quantify the post-treatment difference between the two. It is simple for RCTs as the randomised control statistically approximates the counterfactual. However, it’s challenging otherwise due to the unequal pre-experiment statistics between the treatment and control.</p><p id="c5b9" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">As a causal inference technique, SC represents the counterfactual by a synthetic control group created based on some untreated control units. This synthetic control group statistically equals the treatment group pre treatment and is expected to approximate the untreated behaviour of the treatment group post treatment. Mathematically presented below, it is created using the function <em class="oz">f</em> whose parameters are obtained by minimising the pre-treatment difference between the treated group and the control synthesised by <em class="oz">f </em>[1]:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pa"><img src="../Images/ccb82095d449247db6f520792528b8ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/0*jbq-R6qdOY_uSybA"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">In the experiment, there are J groups whereby group 1 is the treatment group and others are controls. Each group has its observed outcome at time t denoted by Yjt. f is the model and Y1t^N refers to the counterfactual. Image by author.</figcaption></figure><p id="589e" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">In practice, the popular options for the function <em class="oz">f </em>include but are not limited to<em class="oz"> </em>the<em class="oz"> </em>weighted sum [1], Bayesian Structural Time Series (BSTS) [2], etc.</p><h2 id="150e" class="nd ne fq bf nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa bk">Actions towards Reliable Synthetic Control</h2><p id="7a4f" class="pw-post-body-paragraph ob oc fq od b go oe of og gr oh oi oj no ok ol om ns on oo op nw oq or os ot fj bk">Despite the solid theoretical foundation, applying SC in practice usually faces the challenge that we don’t know how accurate the estimated ATE is because there exists no post-treatment counterfactual in reality to validate the synthesised one. However, there are some actions we can take to optimise the modeling process and maximise the reliability. Next, I will describe these actions and demonstrate how they influence the estimated ATE via a range of experiments based on the synthetic time-series data with diverse temporal characteristics.</p><p id="3359" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk"><strong class="od fr">Experiment Setup</strong></p><p id="ddbe" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">All the experiments presented in this article are based on synthetic time-series data. These data are generated using the <em class="oz">timeseries-generator</em> package that produces time series capturing the real-world factors including GDP, holidays, weekends, and so on.</p><div class="pb pc pd pe pf pg"><a href="https://github.com/Nike-Inc/timeseries-generator/tree/master?source=post_page-----156106a1a7cb--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">GitHub — Nike-Inc/timeseries-generator: A library to generate synthetic time series data by…</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">A library to generate synthetic time series data by easy-to-use factors and generator — Nike-Inc/timeseries-generator</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">github.com</p></div></div><div class="pp l"><div class="pq l pr ps pt pp pu lr pg"/></div></div></a></div><p id="f26b" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">The data generation aims to simulate the campaign performance of the stores in New Zealand from 01/01/2019 to 31/12/2019. To make the potential conclusions statistically significant, 500 time series are generated to represent the stores. Each time series has the statistically randomised linear trend, white noise, store factor, holiday factor, weekday factor, and seasonality. A random sample of 10 stores are presented below.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pv"><img src="../Images/39da389cc3047302d4c018b1f29e5acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dxf_dqEb3U8beKgahQza6A.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Randomly sampled synthetic time series for 10 stores in New Zealand. Image by author.</figcaption></figure><p id="6842" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Store1 is selected to be the treatment group whereas others play the role of control groups. Next, the outcome of store1 is uplifted by 20% from 2019-09-01 onwards to simulate the treated behaviour whereas its original outcome serves as the real counterfactual. This 20% uplift establishes the actual ATE to validate the actions later on.</p><pre class="mm mn mo mp mq pw px py bp pz bb bk"><span id="2bd6" class="qa ne fq px b bg qb qc l qd qe">cutoff_date_sc = '2019-09-01'<br/>df_sc.loc[cutoff_date_sc:] = df_sc.loc[cutoff_date_sc:]*1.2</span></pre><p id="aecc" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">The figure below visualises the simulated treatment effect and the true counterfactual of the treatment group.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qf"><img src="../Images/6f77c0f19357bf38fa330e96c1b3eba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IexTm89DztpI3pnIIqT1ew.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">The simulated ATE of +20% and the true counterfactual of store1. Image by author.</figcaption></figure><p id="c9c2" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Given the synthetic data, the BSTS in Causalimpact is adopted to estimate the synthesised ATE. Then, the estimation is compared against the actual ATE using Mean Absolute Percentage Error (MAPE) to evaluate the corresponding action.</p><div class="pb pc pd pe pf pg"><a href="https://github.com/jamalsenouci/causalimpact/tree/master?source=post_page-----156106a1a7cb--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">GitHub — jamalsenouci/causalimpact: Python port of CausalImpact R library</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">Python port of CausalImpact R library. Contribute to jamalsenouci/causalimpact development by creating an account on…</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">github.com</p></div></div><div class="pp l"><div class="qg l pr ps pt pp pu lr pg"/></div></div></a></div><p id="60cb" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Next, let’s go through the actions along with the related experiments to see how to produce reliable ATE estimation.</p><p id="6ef5" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk"><strong class="od fr">Treatment-control Correlation</strong></p><p id="3e80" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">The first action to achieve reliable ATE estimation is selecting the control groups that exhibit high pre-treatment correlations with the treatment group. The rationale is that a highly correlated control is likely to consistently resemble the untreated treatment group over time.</p><p id="87bc" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">To validate this hypothesis, let’s evaluate the ATE estimation produced using every single control with its full data since 01/01/2019 to understand the impact of correlation. Firstly, the correlation coefficients between the treatment group (store1) and the control groups (store2 to 499) are calculated [3].</p><pre class="mm mn mo mp mq pw px py bp pz bb bk"><span id="8d5d" class="qa ne fq px b bg qb qc l qd qe">def correlation(x, y):<br/>    shortest = min(x.shape[0], y.shape[0])<br/>    return np.corrcoef(x.iloc[:shortest].values, y.iloc[:shortest].values)[0, 1]</span></pre><p id="36b7" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">As shown in the figure below, the distribution of the correlations range from -0.1 to 0.9, which provides a comprehensive understanding about the impact across various scenarios.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qh"><img src="../Images/57a4d48a0f278fc2e34884da82890db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*zuP4LlHyVMCL12ZsCeg0qw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Distribution of the pre-treatment correlation. Image by author.</figcaption></figure><p id="09de" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Then, every individual control is used to predict the counterfactual, estimate the ATE, and report the MAPE. In the figure below, the averaged MAPE of ATE with its 95% confidence interval is plotted against the corresponding pre-treatment correlation. Here, the correlation coefficients are rounded to one decimal place to facilitate aggregation and improve the statistical significance in the analysis. Looking at the results, it is obvious that the estimation shows a higher reliability when the control gets more correlated with the treatment group.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qi"><img src="../Images/8bb621fd0777b123764e2a4376e462a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1XkPFXT-0hkCll8c94VR3w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">The MAPE of ATE for different correlation levels. Image by author.</figcaption></figure><p id="ec76" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Now let’s see some examples that demonstrate the impact of pre-treatment correlation: store88 with a correlation of 0.88 delivers a MAPE of 0.12 that is superior to 0.62 given by store3 with a correlation of 0.43. Besides the promising accuracy, the probabilistic intervals are correspondingly narrow, which implies high prediction certainty.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qf"><img src="../Images/d424496ce2675f0f2d080ddb982e67d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*myWb-vCI67b2Sf35s8LlOQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Example to demonstrate the impact of correlation. Image by author.</figcaption></figure><p id="4fdd" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk"><strong class="od fr">Model Fitting Window</strong></p><p id="6409" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Next, the fitting window, which is the length of the pre-treatment interval used for fitting the model, needs to be properly configured. This is because too much context could result in a loss of recency while insufficient context might lead to overfitting.</p><p id="a785" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">To understand how fitting window impacts the accuracy of ATE estimation, a wide range of values from 1 month to 8 months before the treatment date are experimented. For each fitting window, every single unit of the 499 control groups is evaluated individually and then aggregated to calculate the averaged MAPE with the 95% confidence interval. As depicted in the figure below, there exists a sweet spot nearby 2 and 3 months that optimise the reliability. Identifying the optimal point is outside the scope of this discussion but it’s worth noting that the training window needs to be carefully selected.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qj"><img src="../Images/5c883c0d27917417c399a6f213d8c4b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4oPLAk1eMOH6jtjFfiTGw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">The MAPE of ATE for different training windows. Image by author.</figcaption></figure><p id="05df" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">The figure shows two examples: the MAPE of control group 199 is reduced from 0.89 to 0.68 when its fitting window is increased from 1 month to 3 months because the short window contains insufficient knowledge to produce the counterfactual.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qf"><img src="../Images/d560703f856911244947cdd60cec747b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AnmpXi5fCa3RdiG38elHfw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Example to demonstrate the impact of training window. Image by author.</figcaption></figure><p id="fd20" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk"><strong class="od fr">Number of Control Units</strong></p><p id="f896" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Lastly, the number of the selected control groups matters.</p><p id="3840" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">This hypothesis is validated by investigating the estimation accuracy for different numbers of controls ranging from 1 to 10. In detail, for each control count, the averaged MAPE is calculated based on the estimations produced by 50 random control sets with each containing the corresponding number of control groups. This operation avoids unnecessarily enumerating every possible combination of controls while statistically controls for correlation. In addition, the fitting window is set to 3 months for every estimation.</p><p id="5041" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">Looking at the results below, increasing the number of controls is overall leading towards a more reliable ATE estimation.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qi"><img src="../Images/fe4b7d2cd20f809b7c4eadbc5493bc8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r_BN6BYLZ5hOnPT3lD8Q1g.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">The MAPE of ATE for different number of controls. Image by author.</figcaption></figure><p id="b419" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">The examples below demonstrate the effect. The first estimation is generated using store311 whereas the second one further adds store301 and store312.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qf"><img src="../Images/dfcdc45b31e211a635dd8aa206a3fe2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lM8T8rRwvT2fEGB4ReQGdA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Example to demonstrate the impact of number of controls. Image by author.</figcaption></figure><h2 id="4dc1" class="nd ne fq bf nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa bk">Conclusions</h2><p id="1668" class="pw-post-body-paragraph ob oc fq od b go oe of og gr oh oi oj no ok ol om ns on oo op nw oq or os ot fj bk">In this article, I discussed the possible actions that make the SC estimation more reliable. Based on the experiments with diverse synthetic data, the pre-treatment correlation, fitting window, and number of control units are identified as compelling directions to optimise the estimation. Finding the optimal value for each action is out of the scope of this discussion. However, if you feel interested, parameter search using an isolated blank period for validation [4] is one possible solution.</p><p id="7488" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk"><em class="oz">All the images are produced by the author unless otherwise noted. The discussions are inspired by the great work “Synthetic controls in action” [1].</em></p><h2 id="cf36" class="nd ne fq bf nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa bk">References</h2><p id="1bbc" class="pw-post-body-paragraph ob oc fq od b go oe of og gr oh oi oj no ok ol om ns on oo op nw oq or os ot fj bk">[1] Abadie, Alberto, and Jaume Vives-i-Bastida. “Synthetic controls in action.” <em class="oz">arXiv preprint arXiv:2203.06279</em> (2022).</p><p id="6eff" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">[2]Brodersen, Kay H., et al. “Inferring causal impact using Bayesian structural time-series models.” (2015): 247–274.</p><p id="8c29" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">[3]https://medium.com/@dreamferus/how-to-synchronize-time-series-using-cross-correlation-in-python-4c1fd5668c7a</p><p id="94e0" class="pw-post-body-paragraph ob oc fq od b go ou of og gr ov oi oj no ow ol om ns ox oo op nw oy or os ot fj bk">[4]Abadie, Alberto, and Jinglong Zhao. “Synthetic controls for experimental design.” <em class="oz">arXiv preprint arXiv:2108.02196</em> (2021).</p></div></div></div></div>    
</body>
</html>