# è®¡ç®—Statsmodelsä¸­A/Bæµ‹è¯•çš„æœ€å°æ ·æœ¬é‡ï¼šå¦‚ä½•è®¡ç®—ä»¥åŠä¸ºä»€ä¹ˆ

> åŽŸæ–‡ï¼š[https://towardsdatascience.com/computing-minimum-sample-size-for-a-b-tests-in-statsmodels-how-and-why-398e357945d9?source=collection_archive---------3-----------------------#2024-05-31](https://towardsdatascience.com/computing-minimum-sample-size-for-a-b-tests-in-statsmodels-how-and-why-398e357945d9?source=collection_archive---------3-----------------------#2024-05-31)

## æ·±å…¥æŽ¢è®¨Statsmodelså¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨æ•°å€¼ä¼˜åŒ–è€Œéžå°é—­å½¢å¼çš„å…¬å¼

[](https://jasonjiajs.medium.com/?source=post_page---byline--398e357945d9--------------------------------)[![Jason Jia](../Images/e3e3bdf0873cb48384dcf2f76a964ebd.png)](https://jasonjiajs.medium.com/?source=post_page---byline--398e357945d9--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--398e357945d9--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--398e357945d9--------------------------------) [Jason Jia](https://jasonjiajs.medium.com/?source=post_page---byline--398e357945d9--------------------------------)

Â·å‘è¡¨äºŽ[Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--398e357945d9--------------------------------) Â·é˜…è¯»æ—¶é—´10åˆ†é’ŸÂ·2024å¹´5æœˆ31æ—¥

--

![](../Images/cfc8f9479bd992d2d46961c47bd201c2.png)

ç”±DALL-Eç”Ÿæˆçš„å›¾åƒ

# ä»‹ç»

## ç›®å‰æ²¡æœ‰å…³äºŽStatsmodelså¦‚ä½•è®¡ç®—æœ€å°æ ·æœ¬é‡çš„å¥½èµ„æºã€‚

åœ¨è¿›è¡ŒA/Bæµ‹è¯•ä¹‹å‰ï¼Œè®¡ç®—æ‰€éœ€çš„æœ€å°æ ·æœ¬é‡è‡³å…³é‡è¦ã€‚ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•æ˜¯åœ¨Pythonçš„StatsmodelsåŒ…ä¸­è°ƒç”¨[tt_ind_solve_powerå‡½æ•°](https://www.statsmodels.org/stable/generated/statsmodels.stats.power.tt_ind_solve_power.html)ï¼Œä½†ç›®å‰åœ¨ç†è§£å®ƒçš„å·¥ä½œåŽŸç†æ—¶å­˜åœ¨ä¸¤ä¸ªç©ºç™½ï¼š

1. æœ‰å¾ˆå¤šä¼˜ç§€çš„æ–‡ç« ï¼ˆä¾‹å¦‚[Stan Nsky](/experiment-sample-size-calculation-using-power-analysis-81cb1bc5f74b)ï¼ŒTDS 2019ï¼‰è§£é‡Šäº†å‚æ•°çš„å«ä¹‰å¹¶æä¾›äº†å‡½æ•°è°ƒç”¨çš„ç¤ºä¾‹ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¹¶æ²¡æœ‰è§£é‡Šè¯¥å‡½æ•°æ˜¯å¦‚ä½•å®žé™…è®¡ç®—æ ·æœ¬é‡çš„ï¼Œä¹Ÿæ²¡æœ‰è¯´æ˜Žä¸ºä»€ä¹ˆè¯¥è¿‡ç¨‹æ˜¯æ­£ç¡®çš„ã€‚

2. ä¹Ÿæœ‰è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼ˆä¾‹å¦‚[Mintao Wei](/probing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b#c172)ï¼ŒTDS 2023ï¼‰è§£é‡Šäº†åŸºäºŽzæ£€éªŒçš„æ¯”ä¾‹ç»Ÿè®¡æŽ¨å¯¼ï¼Œä¾‹å¦‚è½¬æ¢çŽ‡ï¼Œè¿™æ˜¯è®¸å¤šåœ¨çº¿æ ·æœ¬é‡è®¡ç®—å™¨ï¼ˆä¾‹å¦‚[Evan Millerçš„è®¡ç®—å™¨](https://www.evanmiller.org/ab-testing/sample-size.html)ï¼‰ä¹Ÿå¸¸ç”¨çš„æ–¹æ³•ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯Statsmodelsä½¿ç”¨çš„æ–¹æ³•ï¼Œå› æ­¤ç»“æžœå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚

## è¿™å¯¹æ•°æ®ç§‘å­¦å®¶æ¥è¯´å¾ˆé‡è¦ï¼Œå› ä¸ºStatsmodelså¸¸ç”¨äºŽPythonä¸­è®¡ç®—æ ·æœ¬é‡ã€‚

æ•°æ®ç§‘å­¦å®¶ç»å¸¸ä½¿ç”¨ Statsmodels æ¥èŽ·å–æœ€å°æ ·æœ¬é‡ï¼Œä½†å¯èƒ½ä¸çŸ¥é“å®ƒé‡‡ç”¨äº†ä¸Žå¤§å¤šæ•°æ–‡ç« æè¿°çš„æ–¹å¼ä»¥åŠå¤§å¤šæ•°åœ¨çº¿è®¡ç®—å™¨ä½¿ç”¨çš„æ–¹æ³•ä¸åŒçš„æ–¹å¼ã€‚äº†è§£è¯¥å‡½æ•°çš„å·¥ä½œåŽŸç†æ˜¯è‡³å…³é‡è¦çš„ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿä¿¡ä»»å…¶ç»“æžœã€‚

## æœ¬æ–‡é€šè¿‡è§£é‡Š Statsmodels çš„å®žé™…å·¥ä½œåŽŸç†æ¥å¡«è¡¥è¿™ä¸€ç©ºç™½ã€‚

æœ¬æ–‡æ—¨åœ¨åšå‡ºåˆ›æ–°æ€§è´¡çŒ®ï¼Œè§£é‡Š `tt_ind_solve_power` å¦‚ä½•å®žé™…è®¡ç®—æ ·æœ¬é‡ï¼Œä¸ºä»€ä¹ˆè¯¥è¿‡ç¨‹æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”å®ƒç›¸å¯¹äºŽå°é—­å½¢å¼è§£æ³•å¸¦æ¥çš„ä¼˜åŠ¿ã€‚[1]

**ç¬¬1éƒ¨åˆ†ï¼š** å®ƒå°†é¦–å…ˆè§£é‡Šæ ·æœ¬é‡å¦‚ä½•è®¡ç®—ä»¥åŠä¸ºä»€ä¹ˆè¯¥ç¨‹åºæ˜¯æ­£ç¡®çš„ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š

1.  æ˜¾ç¤ºæ ·æœ¬é‡è®¡ç®—çš„ç»Ÿè®¡æŽ¨å¯¼ã€‚

1.  ç¼–å†™ä¸€ä¸ªç®€åŒ–ç‰ˆçš„`tt_ind_solve_power`ï¼Œå®ƒæ˜¯ç»Ÿè®¡æŽ¨å¯¼çš„ç²¾ç¡®å®žçŽ°ï¼Œå¹¶ä¸”äº§ç”Ÿä¸ŽåŽŸå§‹å‡½æ•°ç›¸åŒçš„è¾“å‡ºã€‚

**ç¬¬2éƒ¨åˆ†ï¼š** æŽ¥ä¸‹æ¥ï¼Œå®ƒå°†è§£é‡Šå®ƒç›¸å¯¹äºŽå°é—­å½¢å¼è§£æ³•å¸¦æ¥çš„ä¸¤ä¸ªä¼˜åŠ¿ï¼š

1.  æ³›åŒ–æ€§ä¼˜åŠ¿

1.  ç»Ÿè®¡ç›´è§‰çš„ä¼˜åŠ¿

# ç¬¬1éƒ¨åˆ†ï¼šStatsmodels å¦‚ä½•è®¡ç®—æœ€å°æ ·æœ¬é‡ä»¥åŠä¸ºä»€ä¹ˆå®ƒæ˜¯æ­£ç¡®çš„

## 1.1. æ˜¾ç¤ºæ ·æœ¬é‡è®¡ç®—çš„ç»Ÿè®¡æŽ¨å¯¼

## **æ ¸å¿ƒæ€æƒ³**

ä¸€èˆ¬çš„A/Bæµ‹è¯•æ˜¯ä¸€ä¸ªæ— é…å¯¹çš„åŒæ ·æœ¬tæ£€éªŒã€‚Statsmodels å¹¶ä¸ä½¿ç”¨å°é—­å½¢å¼çš„è§£æ³•ï¼Œè€Œæ˜¯é€šè¿‡ä¸¤ä¸ªæ­¥éª¤æ¥èŽ·å¾—æœ€å°æ ·æœ¬é‡ï¼š

1.  å¯¹äºŽç»™å®šçš„æ ·æœ¬é‡ï¼Œè®¡ç®—è¯¥æ£€éªŒçš„åŠŸæ•ˆã€‚

1.  è¿è¡Œæ•°å€¼ä¼˜åŒ–ç®—æ³•ï¼Œæ‰¾åˆ°è¿”å›žç›®æ ‡åŠŸæ•ˆçš„æ ·æœ¬é‡ã€‚

## **ç¬¦å·å’Œæ¦‚å¿µ**

ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­ä½¿ç”¨çš„ä¸€äº›æœ¯è¯­ï¼š

+   **n**ï¼šæœ€å°æ‰€éœ€æ ·æœ¬é‡ã€‚n = n_1 + n_2

+   **n_1, n_2**ï¼šæ²»ç–—ç»„å’Œå¯¹ç…§ç»„çš„æœ€å°æ‰€éœ€æ ·æœ¬é‡

+   **æ¯”ä¾‹ï¼š** n_2 = n_1 * æ¯”ä¾‹ï¼Œå¯¹äºŽ50:50çš„åˆ†é…ï¼Œæ¯”ä¾‹ = 1

+   **p**ï¼špå€¼

+   **ð›¼:** æ˜¾è‘—æ€§æ°´å¹³ / Iç±»é”™è¯¯

+   **ð›½:** IIç±»é”™è¯¯ï¼›1-ð›½æ˜¯æ£€éªŒçš„åŠŸæ•ˆ

+   **Î¼_1, Î¼_2**ï¼šæ²»ç–—ç»„å’Œå¯¹ç…§ç»„çš„å‡å€¼

+   **XÌ„1, XÌ„2:** æ²»ç–—ç»„å’Œå¯¹ç…§ç»„çš„æ ·æœ¬å‡å€¼

+   **t_(1-ð›¼):** ä¸´ç•Œå€¼ / t-scoreï¼Œæˆªæ–­æ ‡å‡†tåˆ†å¸ƒçš„ä¸Š100ð›¼(%)éƒ¨åˆ†ã€‚

+   **MDE:** æœ€å°å¯æ£€æµ‹æ•ˆåº”ï¼Œæˆ–ç»™å®šæ‰€æœ‰å…¶ä»–å‚æ•°ä¸‹å¯ä»¥æ£€æµ‹åˆ°çš„ç»Ÿè®¡æ˜¾è‘—æ€§å·®å¼‚çš„æ°´å¹³ï¼ˆä¾‹å¦‚ï¼ŒåŸºç¡€è½¬æ¢çŽ‡ä¸º10%ï¼Œé¢„æœŸæå‡ä¸º50%ï¼Œå› æ­¤é¢„æœŸçš„æ²»ç–—è½¬æ¢çŽ‡ä¸º15%ï¼Œæ„å‘³ç€MDEä¸º15-10=5%=0.05ï¼‰

+   **ðœŽ:** æ¯ç»„è§‚å¯Ÿå€¼çš„æ ‡å‡†å·®ï¼Œå‡è®¾æ˜¯ç›¸åŒçš„

+   **d:** Cohenâ€™s d / æ ‡å‡†åŒ–æ•ˆåº”å¤§å°ï¼Œç”± MDE / ðœŽ ç»™å‡º

+   **H_0, H_1:** åŽŸå‡è®¾ï¼Œå¤‡æ‹©å‡è®¾

## **æŽ¨å¯¼æ£€éªŒåŠŸæ•ˆçš„å…¬å¼**

1.  **å®šä¹‰åŽŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾ï¼š**

**2. æŽ¨å¯¼åŽŸå‡è®¾ä¸‹æ£€éªŒç»Ÿè®¡é‡çš„åˆ†å¸ƒï¼ˆH_0ï¼‰ï¼š**

æˆ‘ä»¬å‘çŽ°**åœ¨åŽŸå‡è®¾ä¸‹**ï¼Œæ£€éªŒç»Ÿè®¡é‡tæœä»Ž**tåˆ†å¸ƒ**ï¼Œå…¶**è‡ªç”±åº¦ä¸º(n_1 + n_2 - 2)**ã€‚

è¿™å¯ä»¥ä»Žä»¥ä¸‹å†…å®¹å¾—å‡ºï¼š

å…¶ä¸­Xçš„æ ·æœ¬æ–¹å·®è®¡ç®—å¦‚ä¸‹ï¼š

**3\. æŽ¨å¯¼å¤‡æ‹©å‡è®¾(H_1)ä¸‹æ£€éªŒç»Ÿè®¡é‡çš„åˆ†å¸ƒï¼š**

æˆ‘ä»¬å‘çŽ°**åœ¨å¤‡æ‹©å‡è®¾ä¸‹**ï¼Œå‡è®¾å‡å€¼å·®å¼‚ä¸ºæœ€å°å¯æ£€æµ‹æ•ˆåº”ï¼ˆMDEï¼‰ï¼Œæ£€éªŒç»Ÿè®¡é‡tæœä»Ž**éžä¸­å¿ƒtåˆ†å¸ƒ**ï¼Œå…¶**éžä¸­å¿ƒæ€§å‚æ•°Î¸ = d * sqrt((n1 * n2) / (n1 + n2))**ï¼Œè‡ªç”±åº¦ä¸º**(n_1 + n_2 - 2)**ã€‚

ä¸€ä¸ªå…·æœ‰æ­£éžä¸­å¿ƒæ€§å‚æ•°çš„éžä¸­å¿ƒtåˆ†å¸ƒï¼ˆnctï¼‰å¯ä»¥ç²—ç•¥åœ°çœ‹ä½œæ˜¯ä¸€ä¸ªæ ‡å‡†tåˆ†å¸ƒå‘å³å¹³ç§»çš„ç»“æžœã€‚[2] ç›´è§‚åœ°è¯´ï¼Œæ ‡å‡†tåˆ†å¸ƒå‘ç”Ÿåœ¨åŽŸå‡è®¾ä¸‹ï¼Œå½“æˆ‘ä»¬æœŸæœ›å¹³å‡æ•ˆæžœä¸º0æ—¶ï¼Œè€Œéžä¸­å¿ƒtåˆ†å¸ƒå‘ç”Ÿåœ¨å¤‡æ‹©å‡è®¾ä¸‹ï¼Œå½“æˆ‘ä»¬æœŸæœ›ä¸€ä¸ªæ­£çš„æ•ˆæžœï¼Œå¹¶ä¸”è¯¥æ•ˆæžœçš„å¹³å‡å€¼å¤§è‡´ç­‰äºŽMDEã€‚

å®šä¹‰ï¼šå…·æœ‰éžä¸­å¿ƒæ€§å‚æ•°Î¸å’Œè‡ªç”±åº¦Î½çš„éžä¸­å¿ƒtåˆ†å¸ƒéšæœºå˜é‡Tå®šä¹‰å¦‚ä¸‹ï¼š

å…¶ä¸­Zæ˜¯æ ‡å‡†æ­£æ€éšæœºå˜é‡ï¼Œ*V*æ˜¯è‡ªç”±åº¦ä¸ºÎ½çš„å¡æ–¹åˆ†å¸ƒéšæœºå˜é‡ã€‚

è¯æ˜Žä»Žä»¥ä¸‹è§‚å¯Ÿå¼€å§‹ï¼šåœ¨å¤‡æ‹©å‡è®¾ä¸‹ï¼ŒçœŸå®žçš„å‡å€¼å·®å¼‚ä¸ºMDEï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‡åŽ»MDEå¹¶é™¤ä»¥æ€»ä½“æ ‡å‡†å·®ï¼Œä»Žè€Œå¾—åˆ°æ ‡å‡†æ­£æ€å˜é‡ã€‚

**4\. è®¡ç®—åŠŸæ•ˆ**

æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†åŽŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾ä¸‹æ£€éªŒç»Ÿè®¡é‡çš„åˆ†å¸ƒï¼Œå¹¶ä¸”ä¸¤ç§åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆcdfï¼‰éƒ½æ˜¯å·²çŸ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è®¡ç®—åŠŸæ•ˆï¼Œç»™å®šæ˜¾è‘—æ€§æ°´å¹³å’Œæ£€éªŒç±»åž‹ï¼ˆåŒå°¾ã€å¤§äºŽã€å°äºŽï¼‰ã€‚ä¸‹å›¾å¯è§†åŒ–äº†è¿™ä¸€è¿‡ç¨‹ï¼š

![](../Images/f7537362230bff4e8f958aaa8ca1cac5.png)

ä½œè€…æä¾›çš„å›¾è¡¨

åœ¨Pythonä¸­ï¼Œå®žçŽ°å¦‚ä¸‹ï¼š

```py
def power(self, effect_size, nobs1, alpha, ratio=1, df=None,
          alternative='two-sided'):
    nobs2 = nobs1*ratio
    if df is None:
        df = (nobs1 + nobs2 - 2)

    # Get non-centrality parameter
    nobs = nobs1 * nobs2 / (nobs1 + nobs2)
    d = effect_size
    nc_param = d * np.sqrt(nobs)

    # Get effective level of signifiance, alpha_
    if alternative in ['two-sided']:
        alpha_ = alpha / 2.
    elif alternative in ['smaller', 'larger']:
        alpha_ = alpha
    else:
        raise ValueError("alternative has to be 'two-sided', 'larger' " +
                        "or 'smaller'")

    # Compute power of a t-test
    power = 0
    if alternative in ['two-sided', 'larger']:
        crit_upp = stats.t.isf(alpha_, df) # isf = inverse survival function = value where Pr(t > value) = alpha
        power += 1 - special.nctdtr(df, nc_param, crit_upp)  # 1 - Pr(t < crit_upp) = Pr(t > crit_upp) for non-central t distribution
    if alternative in ['two-sided', 'smaller']:
        crit_low = stats.t.ppf(alpha_, df) # ppf = percent point function = value where Pr(t < value) = alpha
        power += special.nctdtr(df, nc_param, crit_low) # 
    return power
```

## **é€šè¿‡æ•°å€¼ä¼˜åŒ–èŽ·å–æœ€å°æ ·æœ¬é‡**

æ—¢ç„¶æˆ‘ä»¬çŽ°åœ¨çŸ¥é“äº†å¦‚ä½•ä¸ºä¸€ç»„ç»™å®šçš„å‚æ•°è®¡ç®—åŠŸæ•ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œæ•°å€¼ä¼˜åŒ–æ–¹æ³•æ¥æ‰¾åˆ°å®žçŽ°ç›®æ ‡åŠŸæ•ˆçš„æœ€å°æ ·æœ¬é‡ã€‚ç”±äºŽæ€»æ ·æœ¬é‡æ˜¯æ²»ç–—ç»„æ ·æœ¬é‡çš„å‡½æ•°ï¼ˆn = n_1 + æ¯”ä¾‹ * n_1ï¼‰ï¼Œæˆ‘ä»¬å°†æ±‚è§£n_1ã€‚

ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºåŠŸæ•ˆéšç€æ ·æœ¬é‡n_1çš„å¢žåŠ è€Œå•è°ƒå¢žåŠ ã€‚ç›´è§‚åœ°è¯´ï¼Œæ›´å¤šçš„æ ·æœ¬æ„å‘³ç€A/Bæµ‹è¯•ç»“æžœæ›´åŠ å¯é ï¼Œå› æ­¤ï¼Œå¦‚æžœå¤‡æ‹©å‡è®¾ä¸ºçœŸï¼Œæ›´å¤šçš„å€¼å°†æ‹’ç»åŽŸå‡è®¾ï¼ˆè§ä¸‹å›¾å·¦ä¾§å­å›¾ï¼‰ã€‚

ä½†è¿™ä¹Ÿæ„å‘³ç€ï¼Œå‡åŽ»ç›®æ ‡åŠŸæ•ˆåŽï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢žçš„å‡½æ•°ï¼Œèµ·ç‚¹ä¸ºè´Ÿï¼Œç»ˆç‚¹ä¸ºæ­£ã€‚æ ¹æ®ä»‹å€¼å®šç†å’Œå‡½æ•°çš„å•è°ƒæ€§ï¼Œå­˜åœ¨ä¸€ä¸ªå”¯ä¸€çš„æ ¹ï¼Œå¯¹åº”äºŽæˆ‘ä»¬çš„æœ€å°æ ·æœ¬é‡ï¼ˆè§ä¸‹å›¾å³ä¾§å­å›¾ï¼‰ã€‚

![](../Images/c66e6dffb8db57745b2cf9d9a2543f10.png)

ä½œè€…æä¾›çš„å›¾è¡¨

ä¸€ç§æµè¡Œä¸”é«˜æ•ˆçš„æ•°å€¼ä¼˜åŒ–æ–¹æ³•æ˜¯**Brentæ–¹æ³•**ã€‚Brentæ–¹æ³•æ˜¯ä¸€ç§æ ¹æ±‚è§£ç®—æ³•ï¼Œç»“åˆäº†å¦‚äºŒåˆ†æ³•ã€å‰²çº¿æ³•å’ŒåäºŒæ¬¡æ’å€¼ç­‰å¤šç§æŠ€æœ¯ã€‚æœ‰å…³å…¶åœ¨Statsmodelsä¸­å®žçŽ°çš„æ›´å¤šç»†èŠ‚ï¼Œå¯ä»¥å‚è§[æ­¤å¤„](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.brentq.html)ã€‚

åœ¨Pythonä¸­ï¼Œå®žçŽ°å¦‚ä¸‹ï¼š

```py
def solve_power(self, effect_size=None, nobs1=None, alpha=None, power=None,
                ratio=1., alternative='two-sided'):
    print('--- Arguments: ---')
    print('effect_size:', effect_size, 'nobs1:', nobs1, 'alpha:', alpha, 'power:', power, 'ratio:', ratio, 'alternative:', alternative, '\n')

    # Check that only nobs1 is None
    kwds = dict(effect_size=effect_size, nobs1=nobs1, alpha=alpha,
                power=power, ratio=ratio, alternative=alternative)
    key = [k for k,v in kwds.items() if v is None]
    assert(key == ['nobs1'])

    # Check that the effect_size is not 0
    if kwds['effect_size'] == 0:
        raise ValueError('Cannot detect an effect-size of 0\. Try changing your effect-size.')

    # Initialize the counter
    self._counter = 0

    # Define the function that we want to find the root of
    # We want to find nobs1 s.t. current power = target power, i.e. current power - target power = 0
    # So func = current power - target power
    def func(x):
        kwds['nobs1'] = x
        target_power = kwds.pop('power') # always the same target power specified in keywords, e.g. 0.8
        current_power = self.power(**kwds) # current power given the current nobs1, note that self.power does not have power as an argument
        kwds['power'] = target_power # add back power to kwds

        fval = current_power - target_power
        print(f'Iteration {self._counter}: nobs1 = {x}, current power - target power = {fval}')
        self._counter += 1
        return fval

    # Get the starting values for nobs1, given the brentq_expanding algorithm
    # In the original code, this is the self.start_bqexp dictionary set up in the __init__ method
    bqexp_fit_kwds = {'low': 2., 'start_upp': 50.}

    # Solve for nobs1 using brentq_expanding
    print('--- Solving for optimal nobs1: ---')
    val, _ = brentq_expanding(func, full_output=True, **bqexp_fit_kwds)

    return val
```

## 1.2\. ç¼–å†™ä¸€ä¸ªç²¾ç®€ç‰ˆçš„tt_ind_solve_powerï¼Œå®ƒæ˜¯ç»Ÿè®¡æŽ¨å¯¼çš„ç²¾ç¡®å®žçŽ°ï¼Œå¹¶äº§ç”Ÿä¸ŽåŽŸå‡½æ•°ç›¸åŒçš„è¾“å‡º

Statsmodelsä¸­çš„æºæ–‡ä»¶å¯ä»¥åœ¨[æ­¤å¤„](https://github.com/statsmodels/statsmodels/blob/main/statsmodels/stats/power.py)æ‰¾åˆ°ã€‚è™½ç„¶åŽŸå‡½æ•°è¢«ç¼–å†™å¾—æ›´ä¸ºå¼ºå¤§ï¼Œä½†å®ƒçš„æ™®é€‚æ€§ä¹Ÿä½¿å¾—æˆ‘ä»¬å¾ˆéš¾ç†è§£ä»£ç æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

å› æ­¤ï¼Œæˆ‘é€è¡ŒæŸ¥çœ‹äº†æºä»£ç ï¼Œå¹¶å°†å…¶ä»Ž1600è¡Œç®€åŒ–ä¸º160è¡Œï¼Œå°†10å¤šä¸ªå‡½æ•°å‡å°‘åˆ°ä»…2ä¸ªï¼ŒåŒæ—¶ç¡®ä¿å®žçŽ°ä¿æŒä¸å˜ã€‚

ç²¾ç®€ç‰ˆçš„ä»£ç ä»…åŒ…å«TTestIndPowerç±»ä¸‹çš„ä¸¤ä¸ªå‡½æ•°ï¼Œå®Œå…¨éµå¾ªç¬¬ä¸€éƒ¨åˆ†ä¸­è§£é‡Šçš„ç»Ÿè®¡æŽ¨å¯¼ã€‚

1.  **power**ï¼Œç”¨äºŽè®¡ç®—ç»™å®šæ ·æœ¬é‡ä¸‹çš„åŠŸæ•ˆ

1.  **solve_power**ï¼Œä½¿ç”¨Brentæ–¹æ³•æ‰¾åˆ°å®žçŽ°ç›®æ ‡åŠŸæ•ˆçš„æœ€å°æ ·æœ¬é‡

è¿™æ˜¯ç²¾ç®€ç‰ˆçš„å®Œæ•´ä»£ç ï¼Œå¹¶åŒ…å«ä¸€ä¸ªæµ‹è¯•ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦äº§ç”Ÿä¸ŽåŽŸå‡½æ•°ç›¸åŒçš„è¾“å‡ºï¼š

# ç¬¬2éƒ¨åˆ†ï¼šStatsmodelsä½¿ç”¨çš„æ•°å€¼ä¼˜åŒ–æ–¹æ³•çš„ä¼˜åŠ¿

## 2.1\. å¯æŽ¨å¹¿æ€§çš„å¥½å¤„

è¿™ç§æ–¹æ³•å¯ä»¥å¾ˆå®¹æ˜“åœ°æŽ¨å¹¿åˆ°æŸ¥æ‰¾å…¶ä»–æ„Ÿå…´è¶£çš„å‚æ•°ï¼ˆä¾‹å¦‚ï¼ŒæŸ¥æ‰¾æ˜¾è‘—æ€§æ°´å¹³æˆ–æœ€å°å¯æ£€æµ‹æ•ˆåº”ï¼Œè€Œä¸æ˜¯æ ·æœ¬é‡ï¼‰ã€‚

é€šè¿‡å°é—­è§£æ³•æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªå‚æ•°æ‰¾åˆ°ä¸€ä¸ªæ–¹ç¨‹ï¼Œè¿™å¯èƒ½æ˜¯å¤æ‚çš„æˆ–ä¸å¯è¡Œçš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŒæ ·çš„æ•°å€¼ä¼˜åŒ–æ–¹æ³•é€‚ç”¨äºŽä»»ä½•å‚æ•°ã€‚

## 2.2\. å¯¹ç»Ÿè®¡ç›´è§‰çš„å¥½å¤„

è¿™ç§æ–¹æ³•å¯ä»¥è¯´æ›´ç›´è§‚ï¼Œå› ä¸ºå®ƒæ˜¯ç»Ÿè®¡åŠŸæ•ˆæ¦‚å¿µçš„è‡ªç„¶æ‰©å±•ã€‚æ­¤å¤–ï¼Œéžä¸­å¿ƒtåˆ†å¸ƒçš„æ¦‚å¿µæä¾›äº†æ›´æ¸…æ™°çš„æ´žè§ï¼Œå¸®åŠ©æˆ‘ä»¬ç†è§£å½“å…¶ä»–å‚æ•°å˜åŒ–æ—¶ï¼Œæœ€å°æ ·æœ¬é‡æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚

**æ¡ˆä¾‹1ï¼šå‚æ•°å˜åŒ–å¯¼è‡´Î¸å¢žåŠ ï¼Œä»Žè€Œå¢žåŠ åŠŸæ•ˆ**

è®°ä½ï¼Œéžä¸­å¿ƒæ€§å‚æ•°æ˜¯Î¸ = d * sqrt((n1 * n2) / (n1 + n2))ã€‚Î¸çš„å¢žåŠ å®žé™…ä¸Šä¼šå°†éžä¸­å¿ƒåˆ†å¸ƒå‘å³ç§»åŠ¨ï¼Œå‡å°‘åœ¨ä¸¤ç§å‡è®¾ä¸‹åˆ†å¸ƒçš„é‡å éƒ¨åˆ†ã€‚

è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºï¼š

+   MDEçš„å¢žåŠ ä¼šå¢žåŠ Cohen's dï¼Œä»Žè€Œå¢žåŠ Î¸

+   äººç¾¤æ ‡å‡†å·®çš„å‡å°‘ä¼šå¢žåŠ Cohen's dï¼Œä»Žè€Œå¢žåŠ Î¸

è¿™ä¼šåœ¨ç›¸åŒçš„æ ·æœ¬é‡ä¸‹å¢žåŠ åŠŸæ•ˆï¼ˆè§ä¸‹å›¾ä¸­çš„æ¡ˆä¾‹1ï¼‰ï¼Œä»Žè€Œå‡å°‘æœ€å°æ ·æœ¬é‡ã€‚

**æ¡ˆä¾‹ 2ï¼šå‚æ•°å˜åŒ–ç›´æŽ¥å¯¼è‡´åŠŸæ•ˆå¢žåŠ è€Œä¸æ”¹å˜Î¸**

+   æ˜¾è‘—æ€§æ°´å¹³çš„æé«˜æ„å‘³ç€æ›´å¤šçš„å€¼å°†å¯¼è‡´æ‹’ç»é›¶å‡è®¾ã€‚è¿™ç›´æŽ¥å¢žåŠ äº†åŠŸæ•ˆï¼ˆè§ä¸‹å›¾ä¸­çš„æ¡ˆä¾‹ 2ï¼‰ï¼Œå¹¶å‡å°‘äº†æœ€å°æ ·æœ¬é‡ã€‚

**æ¡ˆä¾‹ 3ï¼šç›®æ ‡åŠŸæ•ˆçš„å˜åŒ–**

+   ç›®æ ‡åŠŸæ•ˆçš„å¢žåŠ æ„å‘³ç€åˆå§‹çš„æ ·æœ¬é‡nå°†æ— æ³•æ»¡è¶³æ›´é«˜çš„ç›®æ ‡åŠŸæ•ˆï¼Œå› æ­¤éœ€è¦å¢žåŠ æœ€å°æ ·æœ¬é‡ã€‚

![](../Images/5d68924648af71a50c77c3c4ec9f8591.png)

å›¾è¡¨ç”±ä½œè€…æä¾›

# ç»“è®º

åœ¨Statsmodelsä¸­è§£å†³æœ€å°æ ·æœ¬é‡çš„å‡½æ•°åŠŸèƒ½å¼ºå¤§ï¼Œå¹¶ä¾èµ–äºŽæ•°å€¼ä¼˜åŒ–ã€‚è™½ç„¶ä¸Žæ ‡å‡†çš„å°é—­å½¢å¼è§£æ³•ä¸åŒï¼Œä½†è¿™ç§æ–¹æ³•æ›´å®¹æ˜“ç†è§£è®¡ç®—æ ·æœ¬é‡èƒŒåŽçš„ç»Ÿè®¡ç›´è§‰ï¼Œå¹¶èƒ½å¤ŸæŽ¨å¹¿åˆ°è®¡ç®—å…¶ä»–æ„Ÿå…´è¶£çš„å‚æ•°ã€‚è¿™æ˜¯æ•°æ®ç§‘å­¦å®¶ï¼Œå°¤å…¶æ˜¯å¯¹è¥é”€å’Œäº§å“åˆ†æžæ„Ÿå…´è¶£çš„äººå‘˜å€¼å¾—ç†è§£çš„ä¸€ç§æ–¹æ³•ã€‚

# å‚è€ƒæ–‡çŒ®

é‚“ç«‹ï¼ˆ2020ï¼‰ã€‚A/Bæµ‹è¯•æ‰€éœ€çš„æ ·æœ¬é‡ã€‚[https://towardsdatascience.com/required-sample-size-for-a-b-testing-6f6608dd330a](/required-sample-size-for-a-b-testing-6f6608dd330a)

Kohavi, R., Tang, D., & Xu, Yï¼ˆ2020ï¼‰ã€‚å€¼å¾—ä¿¡èµ–çš„åœ¨çº¿å¯¹ç…§å®žéªŒï¼šA/Bæµ‹è¯•å®žç”¨æŒ‡å—ã€‚åœ¨*å€¼å¾—ä¿¡èµ–çš„åœ¨çº¿å¯¹ç…§å®žéªŒï¼šA/Bæµ‹è¯•å®žç”¨æŒ‡å—*ï¼ˆç¬¬Ié¡µï¼‰ã€‚å‰‘æ¡¥ï¼šå‰‘æ¡¥å¤§å­¦å‡ºç‰ˆç¤¾ã€‚

Miller, E.ï¼ˆ2013ï¼‰ã€‚[æ ·æœ¬é‡è®¡ç®—å™¨](https://www.evanmiller.org/ab-testing/sample-size.html)ã€‚

Nsky, S.ï¼ˆ2019ï¼‰ã€‚ä½¿ç”¨åŠŸæ•ˆåˆ†æžè®¡ç®—å®žéªŒæ ·æœ¬é‡ã€‚[https://towardsdatascience.com/experiment-sample-size-calculation-using-power-analysis-81cb1bc5f74b](/experiment-sample-size-calculation-using-power-analysis-81cb1bc5f74b)

éŸ¦é“­ï¼ˆ2023ï¼‰ã€‚æŽ¢è®¨æœ€å°æ ·æœ¬é‡å…¬å¼ï¼šæŽ¨å¯¼ä¸Žåº”ç”¨ã€‚[https://towardsdatascience.com/probing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b](/probing-into-minimum-sample-size-formula-derivation-and-usage-8db9a556280b)

# è„šæ³¨

[1] Rä¸­çš„ç­‰æ•ˆå‡½æ•°æ˜¯`pwr.t.test`ã€‚æˆ‘ä»¬ä½¿ç”¨Pythonç‰ˆæœ¬ï¼Œå› ä¸ºå¼€æºä»£ç ä¾›è¯»è€…æŸ¥çœ‹ã€æ¯”è¾ƒå’Œå®žè·µã€‚

[2] ä¸€èˆ¬çš„éžä¸­å¿ƒtåˆ†å¸ƒä¸æ˜¯å¯¹ç§°çš„ï¼Œä¹Ÿä¸ä»¥Cohençš„dä¸ºä¸­å¿ƒï¼Œä½†éšç€è‡ªç”±åº¦çš„å¢žåŠ ï¼Œè¶‹å‘äºŽå¯¹ç§°ã€‚
