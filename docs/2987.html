<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Translating a Memoir: A Technical Journey</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Translating a Memoir: A Technical Journey</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/translating-a-memoir-a-technical-journey-08913ca60020?source=collection_archive---------9-----------------------#2024-12-11">https://towardsdatascience.com/translating-a-memoir-a-technical-journey-08913ca60020?source=collection_archive---------9-----------------------#2024-12-11</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="dacc" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx"><em class="hd">Leveraging GPT-3.5 and unstructured APIs for translations</em></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@ValeriaCortezVD?source=post_page---byline--08913ca60020--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Valeria Cortez" class="l ep by dd de cx" src="../Images/e2d607ca9f86b3a5d72026c357cc8aa3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*c76Fgu9COT5bF_oSHYdk5Q@2x.jpeg"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--08913ca60020--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://medium.com/@ValeriaCortezVD?source=post_page---byline--08913ca60020--------------------------------" rel="noopener follow">Valeria Cortez</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--08913ca60020--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">6 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Dec 11, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk ld le ab q ee lf lg" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lc"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lb lc">4</span></p></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lh k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al li an ao ap ie lj lk ll" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lm cn"><div class="l ae"><div class="ab cb"><div class="ln lo lp lq lr ls ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="1b68" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk"><strong class="mm fr">This blog post details how I utilised GPT to translate the personal memoir of a family friend, making it accessible to a broader audience.</strong> Specifically, I employed GPT-3.5 for translation and Unstructured’s APIs for efficient content extraction and formatting.</p><p id="04a3" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">The memoir, a heartfelt account by my family friend Carmen Rosa, chronicles her upbringing in Bolivia and her romantic journey in Paris with an Iranian man during the vibrant 1970s. Originally written in Spanish, we aimed to preserve the essence of her narrative while expanding its reach to English-speaking readers through the application of LLM technologies.</p><figure class="nj nk nl nm nn no ng nh paragraph-image"><div role="button" tabindex="0" class="np nq ed nr bh ns"><div class="ng nh ni"><img src="../Images/56510196d4a4728b280ce74035ebef0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TDfCHL6K8wYGU9fGiWHnWw.png"/></div></div><figcaption class="nu nv nw ng nh nx ny bf b bg z dx">Cover image of “Un Destino Sorprendente”, used with permission of author Carmen Rosa Wichtendahl.</figcaption></figure><p id="8314" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">Below you can read the translation process in more detail or you can <a class="af nz" href="https://colab.research.google.com/drive/1FxdtBO8iy1vnXG3VpjRIJ5yZEIEPHk9u#scrollTo=HDEwiI1j3mwH" rel="noopener ugc nofollow" target="_blank">access here the Colab Notebook.</a></p><h1 id="6025" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Translating the document</h1><p id="7f35" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">I followed the next steps for the translation of the book:</p><ol class=""><li id="846e" class="mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf pb pc pd bk"><strong class="mm fr">Import Book Data:</strong> I imported the book from a Docx document using the Unstructured API and divided it into chapters and paragraphs.</li><li id="7e67" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pb pc pd bk"><strong class="mm fr">Translation Technique: </strong>I translated each chapter using GPT-3.5. For each paragraph, I provided the latest three translated sentences (if available) from the same chapter. This approach served two purposes:</li></ol><ul class=""><li id="784f" class="mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf pj pc pd bk"><strong class="mm fr"><em class="pk">Style Consistency:</em></strong> Maintaining a consistent style throughout the translation by providing context from previous translations.</li><li id="a671" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pj pc pd bk"><strong class="mm fr"><em class="pk">Token Limit:</em></strong><em class="pk"> </em>Limiting the number of tokens processed at once to avoid exceeding the model’s context limit.</li></ul><p id="4b92" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk"><strong class="mm fr">3. Exporting translation as Docx: </strong>I used Unstructured’s API once again to save the translated content in Docx format.</p><h1 id="4f9a" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Technical implementation</h1><h2 id="7dd1" class="pl ob fq bf oc pm pn po of pp pq pr oi mt ps pt pu mx pv pw px nb py pz qa qb bk">1. Libraries</h2><p id="7a29" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">We’ ll start with the installation and import of the necessary libraries.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="eeca" class="qg ob fq qd b bg qh qi l qj qk">pip install --upgrade openai <br/>pip install python-dotenv<br/>pip install unstructured<br/>pip install python-docx</span></pre><pre class="ql qc qd qe bp qf bb bk"><span id="c259" class="qg ob fq qd b bg qh qi l qj qk">import openai<br/><br/># Unstructured<br/>from unstructured.partition.docx import partition_docx<br/>from unstructured.cleaners.core import group_broken_paragraphs<br/><br/># Data and other libraries<br/>import pandas as pd<br/>import re<br/>from typing import List, Dict<br/>import os<br/>from dotenv import load_dotenv</span></pre><h2 id="f416" class="pl ob fq bf oc pm pn po of pp pq pr oi mt ps pt pu mx pv pw px nb py pz qa qb bk">2. Connecting to OpenAI’s API</h2><p id="fb99" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">The code below sets up the OpenAI API key for use in a Python project. You need to save your API key in an <code class="cx qm qn qo qd b">.env</code> file.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="f98c" class="qg ob fq qd b bg qh qi l qj qk">import openai<br/><br/># Specify the path to the .env file<br/>dotenv_path = '/content/.env'<br/><br/>_ = load_dotenv(dotenv_path) # read local .env file<br/>openai.api_key  = os.environ['OPENAI_API_KEY']</span></pre><h2 id="6433" class="pl ob fq bf oc pm pn po of pp pq pr oi mt ps pt pu mx pv pw px nb py pz qa qb bk">3. Loading the book</h2><p id="9251" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">The code allows us to import the book in Docx format and divide it into individual paragraphs.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="3d99" class="qg ob fq qd b bg qh qi l qj qk">elements = partition_docx(<br/>    filename="/content/libro.docx", <br/>    paragraph_grouper=group_broken_paragraphs<br/>)</span></pre><p id="580d" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">The code below returns the paragraph in the 10th index of <code class="cx qm qn qo qd b">elements</code>.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="4feb" class="qg ob fq qd b bg qh qi l qj qk">print(elements[10])<br/><br/># Returns: Destino sorprendente, es el título que la autora le puso ...</span></pre><h2 id="b979" class="pl ob fq bf oc pm pn po of pp pq pr oi mt ps pt pu mx pv pw px nb py pz qa qb bk">4. Group book into titles and chapters</h2><p id="4358" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">The next step involves creating a list of chapters. Each chapter will be represented as a dictionary containing a title and a list of paragraphs. This structure simplifies the process of translating each chapter and paragraph individually. Here’s an example of this format:</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="8298" class="qg ob fq qd b bg qh qi l qj qk">[<br/>  {"title": title 1, "content": [paragraph 1, paragraph 2, ..., paragraph n]},<br/>  {"title": title 2, "content": [paragraph 1, paragraph 2, ..., paragraph n]},<br/>  ...<br/>  {"title": title n, "content": [paragraph 1, paragraph 2, ..., paragraph n]},<br/>]</span></pre><p id="fda7" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">To achieve this, we’ll create a function called <code class="cx qm qn qo qd b">group_by_chapter</code>. Here are the key steps involved:</p><ol class=""><li id="7380" class="mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf pb pc pd bk"><strong class="mm fr">Extract Relevant Information: </strong>We can get each narrative text and title by calling <code class="cx qm qn qo qd b">element.category</code><em class="pk">. </em>Those are the only categories we’re interested in translating at this point.</li><li id="4053" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pb pc pd bk"><strong class="mm fr">Identify Narrative Titles:</strong> We recognise that some titles should be part of the narrative text. To account for this, we assume that italicised titles belong to the narrative paragraph.</li></ol><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="3f3d" class="qg ob fq qd b bg qh qi l qj qk">def group_by_chapter(elements: List) -&gt; List[Dict]:<br/>    chapters = []<br/>    current_title = None<br/><br/>    for element in elements:<br/><br/>      text_style = element.metadata.emphasized_text_tags # checks if it is 'b' or 'i' and returns list<br/>      unique_text_style = list(set(text_style)) if text_style is not None else None<br/><br/>      # we consider an element a title if it is a title category and the style is bold<br/>      is_title = (element.category == "Title") &amp; (unique_text_style == ['b'])<br/><br/>      # we consider an element a narrative content if it is a narrative text category or<br/>      # if it is a title category, but it is italic or italic and bold<br/>      is_narrative = (element.category == "NarrativeText") | (<br/>          ((element.category == "Title") &amp; (unique_text_style is None)) |<br/>          ((element.category == "Title") &amp; (unique_text_style == ['i'])) |<br/>          ((element.category == "Title") &amp; (unique_text_style == ['b', 'i']))<br/>      )<br/><br/>      # for new titles<br/>      if is_title:<br/>        print(f"Adding title {element.text}")<br/><br/>        # Add previous chapter when a new one comes in, unless current title is None<br/>        if current_title is not None:<br/>          chapters.append(current_chapter)<br/><br/>        current_title = element.text<br/>        current_chapter = {"title": current_title, "content": []}<br/><br/>      elif is_narrative:<br/>        print(f"Adding Narrative {element.text}")<br/>        current_chapter["content"].append(element.text)<br/><br/>      else:<br/>        print(f'### No need to convert. Element type: {element.category}')<br/><br/><br/>    return chapters</span></pre><p id="30e5" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">In the example below, we can see an example:</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="27ff" class="qg ob fq qd b bg qh qi l qj qk">book_chapters[2] <br/><br/># Returns <br/>{'title': 'Proemio',<br/> 'content': [<br/>    'La autobiografía es considerada ...',<br/>    'Dentro de las artes literarias, ...',<br/>    'Se encuentra más próxima a los, ...',<br/>  ]<br/>}</span></pre><h2 id="a4ad" class="pl ob fq bf oc pm pn po of pp pq pr oi mt ps pt pu mx pv pw px nb py pz qa qb bk">5. Book translation</h2><p id="19e6" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">To translate the book, we follow these steps:</p><ol class=""><li id="424d" class="mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf pb pc pd bk"><strong class="mm fr">Translate Chapter Titles:</strong> We translate the title of each chapter.</li><li id="f5f1" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pb pc pd bk"><strong class="mm fr">Translate Paragraphs:</strong> We translate each paragraph, providing the model with the latest three translated sentences as context.</li><li id="46a1" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pb pc pd bk"><strong class="mm fr">Save Translations:</strong> We save both the translated titles and content.</li></ol><p id="52b1" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">The function below automates this process.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="1c60" class="qg ob fq qd b bg qh qi l qj qk">def translate_book(book_chapters: List[Dict]) -&gt; Dict:<br/>  translated_book = []<br/>  for chapter in book_chapters:<br/>    print(f"Translating following chapter: {chapter['title']}.")<br/>    translated_title = translate_title(chapter['title'])<br/>    translated_chapter_content = translate_chapter(chapter['content'])<br/>    translated_book.append({<br/>        "title": translated_title,<br/>        "content": translated_chapter_content<br/>        })<br/>  return translated_book</span></pre><p id="a17e" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">For the title, we ask GPT a simple translation as follows:</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="6b06" class="qg ob fq qd b bg qh qi l qj qk">def translate_title(title: str) -&gt; str:<br/>  response = client.chat.completions.create(<br/>    model="gpt-3.5-turbo",<br/>    messages= [{<br/>        "role": "system",<br/>        "content": f"Translate the following book title into English:\n{title}"<br/>        }]<br/>  )<br/>  return response.choices[0].message.content</span></pre><p id="eeed" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">To translate a single chapter, we provide the model with the corresponding paragraphs. We instruct the model as follows:</p><ol class=""><li id="69ae" class="mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf pb pc pd bk"><strong class="mm fr">Identify the role:</strong> We inform the model that it is a helpful translator for a book.</li><li id="5d3b" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pb pc pd bk"><strong class="mm fr">Provide context:</strong> We share the latest three translated sentences from the chapter.</li><li id="d08d" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pb pc pd bk"><strong class="mm fr">Request translation:</strong> We ask the model to translate the next paragraph.</li></ol><p id="33db" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">During this process, the function combines all translated paragraphs into a single string.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="33e3" class="qg ob fq qd b bg qh qi l qj qk"># Function to translate a chapter using OpenAI API<br/>def translate_chapter(chapter_paragraphs: List[str]) -&gt; str:<br/>    translated_content = ""<br/><br/>    for i, paragraph in enumerate(chapter_paragraphs):<br/><br/>        print(f"Translating paragraph {i + 1} out of {len(chapter_paragraphs)}")<br/><br/>        # Builds the message dynamically based on whether there is previous translated content<br/>        messages = [{<br/>          "role": "system", <br/>          "content": "You are a helpful translator for a book."<br/>        }]<br/><br/>        if translated_content:<br/>            latest_content = get_last_three_sentences(translated_content)<br/>            messages.append(<br/>                {<br/>                  "role": "system",<br/>                  "content": f"This is the latest text from the book that you've translated from Spanish into English:\n{latest_content}"<br/>                }<br/>            )<br/><br/>        # Adds the user message for the current paragraph<br/>        messages.append(<br/>            {<br/>              "role": "user", <br/>              "content": f"Translate the following text from the book into English:\n{paragraph}"<br/>            }<br/>        )<br/><br/>        # Calls the API<br/>        response = client.chat.completions.create(<br/>            model="gpt-3.5-turbo",<br/>            messages=messages<br/>        )<br/><br/>        # Extracts the translated content and appends it<br/>        paragraph_translation = response.choices[0].message.content<br/>        translated_content += paragraph_translation + '\n\n'<br/><br/>    return translated_content</span></pre><p id="d5fa" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">Finally, below we can see the supporting function to get the latest three sentences.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="23f4" class="qg ob fq qd b bg qh qi l qj qk">def get_last_three_sentences(paragraph: str) -&gt; str:<br/>    # Use regex to split the text into sentences<br/>    sentences = re.split(r'(?&lt;!\w\.\w.)(?&lt;![A-Z][a-z]\.)(?&lt;=\.|\?)\s', paragraph)<br/><br/>    # Get the last three sentences (or fewer if the paragraph has less than 3 sentences)<br/>    last_three = sentences[-3:]<br/><br/>    # Join the sentences into a single string<br/>    return ' '.join(last_three)</span></pre><h2 id="80ee" class="pl ob fq bf oc pm pn po of pp pq pr oi mt ps pt pu mx pv pw px nb py pz qa qb bk">6. Book export</h2><p id="9b7e" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">Finally, we pass the dictionary of chapters to a function that adds each title as a heading and each content as a paragraph. After each paragraph, a page break is added to separate the chapters. The resulting document is then saved locally as a Docx file.</p><pre class="nj nk nl nm nn qc qd qe bp qf bb bk"><span id="cc52" class="qg ob fq qd b bg qh qi l qj qk">from docx import Document<br/><br/>def create_docx_from_chapters(chapters: Dict, output_filename: str) -&gt; None:<br/>    doc = Document()<br/><br/>    for chapter in chapters:<br/>        # Add chapter title as Heading 1<br/>        doc.add_heading(chapter['title'], level=1)<br/><br/>        # Add chapter content as normal text<br/>        doc.add_paragraph(chapter['content'])<br/><br/>        # Add a page break after each chapter<br/>        doc.add_page_break()<br/><br/>    # Save the document<br/>    doc.save(output_filename)</span></pre><h1 id="5cc5" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Limitations</h1><p id="36fa" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">While using GPT and APIs for translation is fast and efficient, there are key limitations compared to human translation:</p><ul class=""><li id="edbd" class="mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf pj pc pd bk"><strong class="mm fr">Pronoun and Reference Errors: </strong>GPT did misinterpret pronouns or references in few cases, potentially attributing actions or statements to the wrong person in the narrative. A human translator can better resolve such ambiguities.</li><li id="3f8a" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pj pc pd bk"><strong class="mm fr">Cultural Context:</strong> GPT missed subtle cultural references and idioms that a human translator could interpret more accurately. In this case, several slang terms unique to Santa Cruz, Bolivia, were retained in the original language without additional context or explanation.</li></ul><p id="431d" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">Combining AI with human review can balance speed and quality, ensuring translations are both accurate and authentic.</p><h1 id="8c99" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Conclusion</h1><p id="cee5" class="pw-post-body-paragraph mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf fj bk">This project demonstrates an approach to translating a book using a combination of GPT-3 and Unstructured APIs. By automating the translation process, we significantly reduced the manual effort required. While the initial translation output may require some minor human revisions to refine the nuances and ensure the highest quality, this approach serves as a strong foundation for efficient and effective book translation</p><p id="48b0" class="pw-post-body-paragraph mk ml fq mm b go mn mo mp gr mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf fj bk">If you have any feedback or suggestions on how to improve this process or the quality of the translations, please feel free to share them in the comments below.</p><h1 id="868a" class="oa ob fq bf oc od oe gq of og oh gt oi oj ok ol om on oo op oq or os ot ou ov bk">Appendix</h1><ul class=""><li id="540a" class="mk ml fq mm b go ow mo mp gr ox mr ms mt oy mv mw mx oz mz na nb pa nd ne nf pj pc pd bk">Link to <a class="af nz" href="https://colab.research.google.com/drive/1FxdtBO8iy1vnXG3VpjRIJ5yZEIEPHk9u#scrollTo=XaX0tVYlP9NU" rel="noopener ugc nofollow" target="_blank">Colab Notebook</a></li><li id="e787" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pj pc pd bk">Link to <a class="af nz" href="https://docs.google.com/document/d/1slQQXHqSq4n3d4zCNg9KNF4cIq3RpY4Y/edit?usp=sharing&amp;ouid=114182714261805101186&amp;rtpof=true&amp;sd=true" rel="noopener ugc nofollow" target="_blank">book in original language (Spanish)</a></li><li id="2c8e" class="mk ml fq mm b go pe mo mp gr pf mr ms mt pg mv mw mx ph mz na nb pi nd ne nf pj pc pd bk">Link to <a class="af nz" href="https://docs.google.com/document/d/1DGosQWbXsMlnFlgxha8UOyeX1OqxN2Lk/edit" rel="noopener ugc nofollow" target="_blank">translated book (English)</a></li></ul></div></div></div></div>    
</body>
</html>