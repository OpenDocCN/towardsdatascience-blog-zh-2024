<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Safeguarding Demand Forecasting with Causal Graphs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Safeguarding Demand Forecasting with Causal Graphs</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/safeguarding-demand-forecasting-with-causal-graphs-591511fc8e0e?source=collection_archive---------6-----------------------#2024-06-28">https://towardsdatascience.com/safeguarding-demand-forecasting-with-causal-graphs-591511fc8e0e?source=collection_archive---------6-----------------------#2024-06-28</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="9f76" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Causal AI, exploring the integration of causal reasoning into machine learning</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@raz1470?source=post_page---byline--591511fc8e0e--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Ryan O'Sullivan" class="l ep by dd de cx" src="../Images/7cd161d38d67d2c0b7da2d8f3e7d33fe.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*tAw1S072P0f0sUswKPN6VQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--591511fc8e0e--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@raz1470?source=post_page---byline--591511fc8e0e--------------------------------" rel="noopener follow">Ryan O'Sullivan</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--591511fc8e0e--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">11 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jun 28, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/04ae3f78a67df7e275299b9801cf319b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q1nf4HqZbWGp34XR"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@borisdunand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Boris Dunand</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="6d09" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">What is this series of articles about?</h1><p id="fb1a" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Welcome to my series on Causal AI, where we will explore the integration of causal reasoning into machine learning models. Expect to explore a number of practical applications across different business contexts.</p><p id="ae4f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In the last article we covered <em class="pa">enhancing marketing mix modelling with Causal AI</em>. In this article we will move onto <em class="pa">safeguarding demand forecasting with causal graphs</em>.</p><p id="a34f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">If you missed the last article on marketing mix modelling, check it out here:</p><div class="pb pc pd pe pf pg"><a rel="noopener follow" target="_blank" href="/enhancing-marketing-mix-modelling-with-causal-ai-77f638bce3a9?source=post_page-----591511fc8e0e--------------------------------"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">Enhancing Marketing Mix Modelling with Causal AI</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">Causal AI, exploring the integration of causal reasoning into machine learning</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">towardsdatascience.com</p></div></div><div class="pp l"><div class="pq l pr ps pt pp pu lr pg"/></div></div></a></div><h1 id="7f38" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Introduction</h1><p id="8ed4" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">In this article we will delve into how you can safeguard demand forecasting (or any forecasting use case to be honest) with causal graphs.</p><p id="7eef" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><strong class="ob fr">The following areas will be explored:</strong></p><ul class=""><li id="eb64" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pv pw px bk">A quick forecasting 101.</li><li id="24a1" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">What is demand forecasting?</li><li id="36f6" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">A refresher on causal graphs.</li><li id="8442" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">How can causal graphs safeguard demand forecasting?</li><li id="6da1" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">A Python case study illustrating how causal graphs can safeguard your forecasts from spurious correlations.</li></ul><p id="023b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The full notebook can be found here:</p><div class="pb pc pd pe pf pg"><a href="https://github.com/raz1470/causal_ai/blob/main/notebooks/safeguarding%20demand%20forecasting%20with%20causal%20graphs.ipynb?source=post_page-----591511fc8e0e--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">causal_ai/notebooks/safeguarding demand forecasting with causal graphs.ipynb at main ·…</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">This project introduces Causal AI and how it can drive business value. - causal_ai/notebooks/safeguarding demand…</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">github.com</p></div></div><div class="pp l"><div class="qd l pr ps pt pp pu lr pg"/></div></div></a></div><h1 id="00f3" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Forecasting</h1><h2 id="a08b" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Forecasting 101</h2><p id="2ca2" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Time series forecasting involves predicting future values based on historical observations.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qv"><img src="../Images/1b694d850081befe34ef0aec17da8522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dqente36ipVAVpf_J_lzvg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="faa2" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To start us off, there are a number of terms which it is worth getting familiar with:</p><ol class=""><li id="1f8a" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou qw pw px bk"><strong class="ob fr">Auto-correlation</strong> — The correlation of a series with it’s previous values at different time lags. Helps identify if there is a trend present.</li><li id="95cc" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Stationary</strong> — This is when the statistical properties of a series are constant over time (e.g. mean, variance). Some forecasting methods assume stationarity.</li><li id="d747" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Differencing </strong>— This is when we subtract the previous observation from the current observation to transform a non-stationary series into a stationary one. An important step for models which assume stationarity.</li><li id="1af4" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Seasonality</strong> — A regular repeating cycle which occurs at a fixed interval (e.g. daily, weekly, yearly).</li><li id="f5c4" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Trend </strong>— The long term movement in a series.</li><li id="b50e" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Lag</strong> — The number of time steps between an observation and a previous value.</li><li id="9ba6" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Residuals </strong>— The difference between predicted and actual values.</li><li id="f3aa" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Moving average</strong> — Used to smooth out short term fluctuations by averaging a fixed number of past observations.</li><li id="ee40" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Exponential smoothing </strong>— Weights are applied to past observations, with more emphasis placed on recent values.</li><li id="07e3" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk"><strong class="ob fr">Seasonal decomposition</strong> — This is when we separate a time series into seasonal, trend and residual components.</li></ol><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/5a2ceb597aa90c76f0b68ab324cab690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMQMHT5MG2CEZB5kKbG_Yw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="5f42" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">There a a number of different methods which can be used for forecasting:</p><ul class=""><li id="9e86" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pv pw px bk"><strong class="ob fr">ETS (Error, Trend, Seasonal) </strong>— An exponential smoothing method that models error, trend and seasonality components.</li><li id="a1e4" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk"><strong class="ob fr">Autoregressive models (AR models) </strong>— Models the current value of the series as a linear combination of it’s previous values.</li><li id="04c3" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk"><strong class="ob fr">Moving average models (MA models) </strong>— Models the current value of the series as a linear combination of past forecast errors.</li><li id="18e8" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk"><strong class="ob fr">Autoregressive integrated moving average (ARIMA models)</strong> — Combines AR and MA models with the incorporation of differencing to make the series stationary.</li><li id="ff07" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk"><strong class="ob fr">State space models </strong>— Deconstructs the timeseries into individual components such as trend and seasonality.</li><li id="5b8b" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk"><strong class="ob fr">Hierarchical models </strong>— A method which handles data structured in a hierarchy such as regions.</li><li id="d85e" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk"><strong class="ob fr">Linear regression</strong> — Uses one or more independent variable (feature) to predict the dependent variable (target).</li><li id="d199" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk"><strong class="ob fr">Machine learning (ML)</strong> — Uses more flexible algorithms like boosting to capture complex relationships.</li></ul><p id="7e2d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">If you want to dive further into this topic, I highly recommend the following resource which is well known as the go-to guide for forecasting (the version below is free 😀):</p><div class="pb pc pd pe pf pg"><a href="https://otexts.com/fpp3/?source=post_page-----591511fc8e0e--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">Forecasting: Principles and Practice (3rd ed)</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">3rd edition</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">otexts.com</p></div></div><div class="pp l"><div class="qy l pr ps pt pp pu lr pg"/></div></div></a></div><p id="2b42" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In terms of applying some of the forecasting models using Python, I’d recommend exploring Nixtla which has an extensive list of models implemented and an easy to use API:</p><div class="pb pc pd pe pf pg"><a href="https://github.com/Nixtla?source=post_page-----591511fc8e0e--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">Nixtla</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">Open Source Time Series Ecosystem. Nixtla has 35 repositories available. Follow their code on GitHub.</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">github.com</p></div></div><div class="pp l"><div class="qz l pr ps pt pp pu lr pg"/></div></div></a></div><h2 id="ece5" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Demand forecasting</h2><p id="21dd" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Predicting the demand for your product is important.</p><ul class=""><li id="2952" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pv pw px bk">It can help manage your inventory, avoiding over or understocking.</li><li id="d615" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">It can keep your customers satisfied, ensuring products are available when they want them.</li><li id="640c" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">Reducing holding costs and minimising waste is cost efficient.</li><li id="84f8" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">Essential for strategic planning.</li></ul><p id="f18b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Keeping demand forecasts accurate is essential — In the next section let’s start to think about how causal graphs could safeguard our forecasts…</p><h1 id="2156" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Causal graphs</h1><h2 id="c5a0" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Causal graph refresher</h2><p id="6d07" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I’ve covered causal graphs a few times in my series, but just in case you need a refresher check out my first article where I cover it in detail:</p><div class="pb pc pd pe pf pg"><a rel="noopener follow" target="_blank" href="/using-causal-graphs-to-answer-causal-questions-5fd1dd82fa90?source=post_page-----591511fc8e0e--------------------------------"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">Using Causal Graphs to answer causal questions</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">Causal AI, exploring the integration of causal reasoning into machine learning</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">towardsdatascience.com</p></div></div><div class="pp l"><div class="ra l pr ps pt pp pu lr pg"/></div></div></a></div><h2 id="0190" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">How can causal graphs safeguard demand forecasting?</h2><p id="c0e1" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Taking the graph below as an example, let’s say we want to forecast our target variable. We find we have 3 variables which are correlated with it, so we use them as features. Why would including the spurious correlation be a problem? The more features we include the better our forecast right?</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rb"><img src="../Images/66b864fdc1fb8642ba0489ffac247f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*QGlVK6k4Teg7co7ROGFUZw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="daea" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Well, not really….</p><p id="a984" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">When it comes to demand forecasting one of the major problems is data drift. Data drift in itself isn’t a problem if the relationship between the feature of interest and target remain constant. But when the relationship doesn’t remain constant, our forecasting accuracy will deteriorate.</p><p id="362c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But how is a causal graph going to help us… The idea is that spurious correlations are much more likely to drift, and much more likely to cause problems when they do.</p><p id="5818" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Not convinced? OK it’s time to jump into the case study then!</p><h1 id="3395" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Case study</h1><h2 id="8955" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Background</h2><p id="4e0b" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Your friend has bought an ice cream van. They paid a consultant a lot of money to build them a demand forecast model. It worked really well for the first few months, but in the last couple of months your friend has been understocking ice cream! They remember that your job title was “data something or other” and come to you for advice.</p><h2 id="b862" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Creating the case study data</h2><p id="886f" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Let me start by explaining how I created the data for this case study. I created a simple causal graph with the following characteristics:</p><ol class=""><li id="c713" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou qw pw px bk">Ice cream sales is the target node (X0)</li><li id="5516" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk">Coastal visits is a direct cause of ice cream sales (X1)</li><li id="72c8" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk">Temperature is an indirect cause of ice cream sales (X2)</li><li id="782b" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk">Sharks attacks is a spurious correlation (X3)</li></ol><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rc"><img src="../Images/8038224febe818d6a49a2d0980df047f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*UNFGju7xO36nTQSnZ46hsA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="26e2" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I then used the following data generating process:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rd"><img src="../Images/087d0da8feedce2a5c4b85776f7c2157.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*T8GO4u6QBBZ5_NH4zx0p3Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="10ca" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You can see that each node is influenced by past values of itself and a noise term as well as it’s direct parents. To create the data I use a handy module from the time series causal analysis python package Tigramite:</p><div class="pb pc pd pe pf pg"><a href="https://github.com/jakobrunge/tigramite/tree/master?source=post_page-----591511fc8e0e--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">GitHub - jakobrunge/tigramite: Tigramite is a python package for causal inference with a focus on…</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">Tigramite is a python package for causal inference with a focus on time series data. The Tigramite documentation is at…</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">github.com</p></div></div><div class="pp l"><div class="re l pr ps pt pp pu lr pg"/></div></div></a></div><p id="be25" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Tigramite is a great package but I am not going to cover it in detail this time around as is deserves it own article! Below we use the structural_causal_process module following the data generating process above:</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="2125" class="rj ne fq rg b bg rk rl l rm rn">seed=42<br/>np.random.seed(seed)<br/><br/># create node lookup for channels<br/>node_lookup = {0: 'ice cream sales',<br/>               1: 'coastal visits',<br/>               2: 'temperature',           <br/>               3: 'shark attacks',<br/> }<br/><br/># data generating process<br/>def lin_f(x): <br/>    return x<br/><br/>links_coeffs = {0: [((0, -1), 0.2, lin_f), ((1, -1), 0.9, lin_f)],<br/>                1: [((1, -1), 0.5, lin_f), ((2, -1), 1.2, lin_f)],<br/>                2: [((2, -1), 0.7, lin_f)],<br/>                3: [((3, -1), 0.2, lin_f), ((2, -1), 1.8, lin_f) ],      <br/>}<br/><br/># time series length<br/>T = 1000<br/><br/>data, _ = toys.structural_causal_process(links_coeffs, T=T, seed=seed)<br/>T, N = data.shape<br/><br/># create var name lookup<br/>var_names = [node_lookup[i] for i in sorted(node_lookup.keys())]<br/><br/># initialize dataframe object, specify time axis and variable names<br/>df = pp.DataFrame(data, <br/>                  datatime = {0:np.arange(len(data))}, <br/>                  var_names=var_names)</span></pre><p id="7d41" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">We can then visualise our time series:</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="cb3f" class="rj ne fq rg b bg rk rl l rm rn">tp.plot_timeseries(df)<br/>plt.show()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ro"><img src="../Images/176957d122740457eda755b7ea92f421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*hyvYUnummRBfJMCBOsJvHw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="1b0e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now you understand how I have created the data, lets get back to the case study in the next section!</p><h2 id="539c" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Understanding the data generating process</h2><p id="fe21" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">You start by trying to understand the data generating process by taking the data used in the model. There are 3 features included in the model:</p><ol class=""><li id="4766" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou qw pw px bk">Coastal visits</li><li id="b79f" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk">Temperature</li><li id="632a" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk">Shark attacks</li></ol><p id="51bb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To get an understanding of the causal graph, you use PCMCI (which is has a great implementation in Tigramite), a method which is suitable for causal time series discovery. I am not going to cover PCMCI this time round as it needs it’s own dedicated article. However, if you are unfamiliar with causal discovery in general, use my previous article to get a good introduction:</p><div class="pb pc pd pe pf pg"><a rel="noopener follow" target="_blank" href="/making-causal-discovery-work-in-real-world-business-settings-80e80c5f66b8?source=post_page-----591511fc8e0e--------------------------------"><div class="ph ab ig"><div class="pi ab co cb pj pk"><h2 class="bf fr hw z io pl iq ir pm it iv fp bk">Making Causal Discovery work in real-world business settings</h2><div class="pn l"><h3 class="bf b hw z io pl iq ir pm it iv dx">Causal AI, exploring the integration of causal reasoning into machine learning</h3></div><div class="po l"><p class="bf b dy z io pl iq ir pm it iv dx">towardsdatascience.com</p></div></div><div class="pp l"><div class="rp l pr ps pt pp pu lr pg"/></div></div></a></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rq"><img src="../Images/ef72754fb775f028a38e302643adcd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*AbMT4ST_M0O0wDiOav6jFg.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="4850" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The causal graph output from PCMCI can be seen above. The following things jump out:</p><ol class=""><li id="87db" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou qw pw px bk">Coastal visits is a direct cause of ice cream sales</li><li id="32fd" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk">Temperature is an in-direct cause of ice cream sales</li><li id="94f8" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou qw pw px bk">Sharks attacks is a spurious correlation</li></ol><p id="badd" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You question why anyone with any common sense would include shark attacks as a feature! Looking at the documentation it seems that the consultant used ChatGPT to get a list of features to consider for the model and then used autoML to train the model.</p><p id="c6f0" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">So if ChatGPT and autoML think shark attacks should be in the model, surely it can’t be doing any harm?</p><h2 id="6321" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Pre-processing the case study data</h2><p id="ad7e" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Next let’s visit how I pre-processed the data to make it suitable for this case study. To create our features we need to pick up the lagged values for each column (look back at the data generating process to understand why the features need to be the lagged values):</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="f2d1" class="rj ne fq rg b bg rk rl l rm rn"># create dataframne<br/>df_pd = pd.DataFrame(df.values[0], columns=var_names)<br/><br/># calcuate lagged values for each column<br/>lag_periods = 1 <br/><br/>for col in var_names:<br/>    df_pd[f'{col}_lag{lag_periods}'] = df_pd[col].shift(lag_periods)<br/>    <br/># remove 1st obervations where we don't have lagged values<br/>df_pd = df_pd.iloc[1:, :]<br/><br/>df_pd</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rr"><img src="../Images/298d7e072e0a8fa2f6989842e6bd4ce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QnkeFwTfQO6QGAHtXO6ehQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="fc5b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">We could use these lagged features to predict ice cream sales, but before we do let’s introduce some data drift to the spurious correlation:</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="b555" class="rj ne fq rg b bg rk rl l rm rn"># function to introduce feature drift based on indexes<br/>def introduce_feature_drift(df, start_idx, end_idx, drift_amount):<br/>    drift_period = (df.index &gt;= start_idx) &amp; (df.index &lt;= end_idx)<br/>    df.loc[drift_period, 'shark attacks_lag1'] += np.linspace(0, drift_amount, drift_period.sum())<br/>    return df<br/>    <br/># introduce feature drift<br/>df_pd = introduce_feature_drift(df_pd, start_idx=500, end_idx=999, drift_amount=50.0)<br/><br/># visualise drift<br/>plt.figure(figsize=(12, 6))<br/>sns.lineplot(data=df_pd[['shark attacks_lag1']])<br/>plt.title('Feature Drift Over Time')<br/>plt.xlabel('Index')<br/>plt.ylabel('Value')<br/>plt.legend(['shark attacks_lag1'])<br/>plt.show()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/979c0b072e146bec980c912f27650c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDld-9JZtyZz3JzkCZT4Gw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="f07b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Let’s go back to the case study and understand what we are seeing. Why has the number of shark attacks drifted? You do some research and find out that one of the causes of shark attacks is the number of people surfing. In recent months there has been a huge rise in the popularity of surfing, causing an increase in shark attacks. So how did this effect the ice cream sales forecasting?</p><h2 id="2719" class="qe ne fq bf nf qf qg qh ni qi qj qk nl oi ql qm qn om qo qp qq oq qr qs qt qu bk">Model training</h2><p id="61f3" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">You decide to recreate the model using the same features as the consultant and then using just the direct causes:</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="e3d6" class="rj ne fq rg b bg rk rl l rm rn"># use first 500 observations for training<br/>df_train = df_pd.iloc[0:500, :]<br/><br/># use last 100 observations for evaluation<br/>df_test = df_pd.iloc[900:, :]<br/><br/># set feature lists<br/>X_causal_cols = ["ice cream sales_lag1", "coastal visits_lag1"]<br/>X_spurious_cols = ["ice cream sales_lag1", "coastal visits_lag1", "temperature_lag1", "shark attacks_lag1"]<br/><br/># create target, train and test sets<br/>y_train = df_train['ice cream sales'].copy()<br/>y_test = df_test['ice cream sales'].copy()<br/>X_causal_train = df_train[X_causal_cols].copy()<br/>X_causal_test = df_test[X_causal_cols].copy()<br/>X_spurious_train = df_train[X_spurious_cols].copy()<br/>X_spurious_test = df_test[X_spurious_cols].copy()</span></pre><p id="b888" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The model trained on just the direct causes looks good on both the train and test set.</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="5843" class="rj ne fq rg b bg rk rl l rm rn"># train and validate model<br/>model_causal = RidgeCV()<br/>model_causal = model_causal.fit(X_causal_train, y_train)<br/>print(f'Coefficient: {model_causal.coef_}')<br/><br/>yhat_causal_train = model_causal.predict(X_causal_train)<br/>yhat_causal_test = model_causal.predict(X_causal_test)<br/><br/>mse_train = mean_squared_error(y_train, yhat_causal_train)<br/>mse_test = mean_squared_error(y_test, yhat_causal_test)<br/>print(f"Mean Squared Error train: {round(mse_train, 2)}")<br/>print(f"Mean Squared Error test: {round(mse_test, 2)}")<br/><br/>r2_train = r2_score(y_train, yhat_causal_train)<br/>r2_test = r2_score(y_test, yhat_causal_test)<br/>print(f"R2 train: {round(r2_train, 2)}")<br/>print(f"R2 test: {round(r2_test, 2)}")</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rt"><img src="../Images/a99b661eb27182a3109420cb80d4d844.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*It87ZXMOdajMUo-jFqSXKw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="db06" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">However, when you train the model using all of the features you see that the model performs well on the train set but not the test set. Seem’s like you identified the problem!</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="bf9f" class="rj ne fq rg b bg rk rl l rm rn"># train and validate model<br/>model_spurious = RidgeCV()<br/>model_spurious = model_spurious.fit(X_spurious_train, y_train)<br/>print(f'Coefficient: {model_spurious.coef_}')<br/><br/>yhat_spurious_train = model_spurious.predict(X_spurious_train)<br/>yhat_spurious_test = model_spurious.predict(X_spurious_test)<br/><br/>mse_train = mean_squared_error(y_train, yhat_spurious_train)<br/>mse_test = mean_squared_error(y_test, yhat_spurious_test)<br/>print(f"Mean Squared Error train: {round(mse_train, 2)}")<br/>print(f"Mean Squared Error test: {round(mse_test, 2)}")<br/><br/>r2_train = r2_score(y_train, yhat_spurious_train)<br/>r2_test = r2_score(y_test, yhat_spurious_test)<br/>print(f"R2 train: {round(r2_train, 2)}")<br/>print(f"R2 test: {round(r2_test, 2)}") </span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk ru"><img src="../Images/34b3554125a3463125a1508807f62962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*tybJJ0_rGluuy7Wtuszkyw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><p id="94d2" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">When we compare the predictions from both models of the test set we can see why your friend has been understocking on ice cream!</p><pre class="mm mn mo mp mq rf rg rh bp ri bb bk"><span id="6c61" class="rj ne fq rg b bg rk rl l rm rn"># combine results<br/>df_comp = pd.DataFrame({<br/>    'Index': np.arange(99),<br/>    'Actual': y_test,<br/>    'Causal prediction': yhat_causal_test,<br/>    'Spurious prediction': yhat_spurious_test<br/>})<br/><br/># melt the DataFrame to long format for seaborn<br/>df_melted = df_comp.melt(id_vars=['Index'], value_vars=['Actual', 'Causal prediction', 'Spurious prediction'], var_name='Series', value_name='Value')<br/><br/># visualise results for test set<br/>plt.figure(figsize=(12, 6))<br/>sns.lineplot(data=df_melted, x='Index', y='Value', hue='Series')<br/>plt.title('Actual vs Predicted')<br/>plt.xlabel('Index')<br/>plt.ylabel('Value')<br/>plt.legend(title='Series')<br/>plt.show()</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rv"><img src="../Images/4c4b584d2faa4298eb39573a56423033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CfGOtI7irHI1z6g0T2d6kw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">User generated image</figcaption></figure><h1 id="bc1e" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Closing thoughts</h1><p id="b3fa" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Today we explored how harmful including spurious correlations in your forecasting models can be. Let’s finish off with some closing thoughts:</p><ul class=""><li id="c396" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pv pw px bk">The aim of this article was to start you thinking about how understanding the causal graph can improve your forecasts.</li><li id="024f" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">I know the example was a little over-exaggerated (I would hope common sense would have helped in this scenario!) but it hopefully illustrates the point.</li><li id="6424" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">Another interesting point to mention is that the coefficient for shark attacks was negative. This is another pitfall as logically we would have expected this spurious correlation to be positive.</li><li id="de13" class="nz oa fq ob b go py od oe gr pz og oh oi qa ok ol om qb oo op oq qc os ot ou pv pw px bk">Medium-long term demand forecasting it very hard — You often need a forecasting model for each feature to be able to forecast multiple timesteps ahead. Interesting, causal graphs (specifically structural causal models) lend themselves well to this problem.</li></ul></div></div></div><div class="ab cb rw rx ry rz" role="separator"><span class="sa by bm sb sc sd"/><span class="sa by bm sb sc sd"/><span class="sa by bm sb sc"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="d9a2" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Follow me if you want to continue this journey into Causal AI — In the next article we see how we move onto comparing how CUPED and double machine learning can help power your experiments.</p></div></div></div></div>    
</body>
</html>