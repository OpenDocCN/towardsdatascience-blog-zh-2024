<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>GPS Interpolation Using Maps and Kinematics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>GPS Interpolation Using Maps and Kinematics</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/gps-interpolation-using-maps-and-kinematics-6a56fdf29179?source=collection_archive---------8-----------------------#2024-12-03">https://towardsdatascience.com/gps-interpolation-using-maps-and-kinematics-6a56fdf29179?source=collection_archive---------8-----------------------#2024-12-03</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="db43" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">How do you apply dead reckoning to your geospatial dataset?</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@joao.figueira?source=post_page---byline--6a56fdf29179--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="João Paulo Figueira" class="l ep by dd de cx" src="../Images/54e4176f66e4ab0324d86ec71d8b033d.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*KhSF0xxPYqlN4Y6vnClBQQ.png"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--6a56fdf29179--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@joao.figueira?source=post_page---byline--6a56fdf29179--------------------------------" rel="noopener follow">João Paulo Figueira</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--6a56fdf29179--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">10 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Dec 3, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/7a5b8092a3b3ab020e63db27f247df36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j3TQT4xmsGVRbtXN2I0rrA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">The picture above illustrates the GPS interpolation process. The red dots represent the known and repeated GPS locations, with more than one location per dot, while the blue dots represent the inferred locations of the repeated points along the road using the vehicle’s speed. (Image created by the author using OpenStreetMap data and imagery.)</figcaption></figure><p id="de00" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Modern cars, vans, and trucks are moving generators of <a class="af nx" href="https://en.wikipedia.org/wiki/Telematics" rel="noopener ugc nofollow" target="_blank">telematics</a> data. Vehicle telematics data streams usually carry various signals, the GPS location being one of the most frequent. You can also find signals such as instantaneous speed, acceleration, fuel tank or battery capacity, and other exotic signals like windshield-wiper status and external temperature.</p><p id="ce50" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">GPS receivers typically sample data once per second (1 Hz), which is appropriate for most applications, but other vehicle sensors may have different signal generation frequencies. The signal generation frequency is programmable and generally balances telecommunications costs and the information content's usefulness. Some signals are sent as they change, while others might get sent only after a given percent change to avoid unnecessary costs.</p><p id="5615" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The telematics data streams have different approaches to packaging the signal values when sending them over the wireless connection. The most basic signal packaging approach independently sends each signal whenever it is generated or significantly changed. Each data packet contains the source identification, signal identification, and signal value. Another approach is to package all signal values as a standard record whenever each value changes. There is no preset emission frequency, and the unchanged values repeat on consecutive messages. We usually find this signal packaging approach on the receiving end of the communications link and when the sender uses the former approach.</p><p id="ee8b" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The final approach, similar to the previous one, fixes the emission frequency, usually synchronized with the GPS, highlighting the importance of this signal in the process.</p><p id="b485" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The second approach, which is the subject of this article, has some side effects, namely, the repetition of the GPS coordinates on all intermediate data packets between changes in the GPS signal. The following picture illustrates this effect on the <a class="af nx" href="https://ar5iv.labs.arxiv.org/html/2203.08630" rel="noopener ugc nofollow" target="_blank">Extended Vehicle Energy Dataset</a> (EVED).</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj ny"><img src="../Images/1917c41de824a73411006846bed7a825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXol1I4UrpN-VNN3A8h7cA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="bf nz">Figure 1</strong> — Data from the EVED shows how often the GPS location repeats while the vehicle moves. (Image source: Author)</figcaption></figure><p id="6b5d" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">It is usual to handle data, as depicted in <strong class="nd fr">Figure 1</strong>, using the latitude and longitude as keys when removing duplicate rows. This technique keeps an aggregate of all the other columns, typically the first-row value. However, it may drastically reduce the number of rows in the dataset, rendering the data less valuable, similar to the third packaging approach.</p><p id="0b53" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Between changes in the GPS signal (rows 1, 8, and 14), all other records carry the original GPS coordinates, even if the vehicle is moving, as demonstrated by the speed signal in <strong class="nd fr">Figure 1</strong> above. We can interpolate the geographic locations of the interim records, increasing the resolution of the GPS sensor and improving the dataset quality.</p><p id="8330" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">This article illustrates how to perform the GPS location interpolation mentioned above using map information and the speed signal.</p><h1 id="bced" class="oa ob fq bf nz oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Interpolation</h1><p id="275e" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">GPS interpolation is the process of inferring geospatial locations missing from our input dataset using auxiliary data. If you like, this is akin to <a class="af nx" href="https://en.wikipedia.org/wiki/Dead_reckoning" rel="noopener ugc nofollow" target="_blank">dead reckoning</a>, a process through which GPS receivers infer the current location when you drive through a tunnel. Here, we apply a similar concept to a dataset where vehicle signals have higher sampling rates than the GPS receiver.</p><p id="75e5" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Dead reckoning uses a map to determine the road ahead and assumes a constant speed throughout the tunnel (or GPS blind spot). Here, we will use a similar approach. Knowing the map geometry between two consecutive and distinct GPS samples provides accurate distance information. If available, the speed signal helps us determine the approximate GPS location of the interim signals using simple kinematic calculations. Otherwise, we can assume a constant average speed between two consecutive locations. Fortunately, the EVED reports instantaneous speeds.</p><p id="072c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The first problem we must solve is measuring the distance between two consecutive and distinct GPS locations. We do this by using map information. We must use the map to avoid the error of measuring the <a class="af nx" href="https://en.wikipedia.org/wiki/Geographical_distance" rel="noopener ugc nofollow" target="_blank">geographical distance</a> (<a class="af nx" href="https://en.wikipedia.org/wiki/As_the_crow_flies" rel="noopener ugc nofollow" target="_blank">as the crow flies</a>) between the locations, as illustrated in <strong class="nd fr">Figure 2</strong> below.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pa"><img src="../Images/fc0ed168f41697b1096c47128d767663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iNEtPT_9sMW3OEU3EXgAkw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="bf nz">Figure 2 </strong>— Blue dots are map vertexes, while red dots are map-matched GPS locations. The interpolated locations will occur along the blue line, and we must use the distance between consecutive samples along the red line’s geometry. The green line represents the distance between consecutive GPS locations without considering the map geometry, while the red line uses the map geometry. In this case, the red line is longer than the green one. (Image source: Author)</figcaption></figure><p id="0c00" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The GPS interpolation process requires auxiliary techniques to implement, such as map matching, map alignment, speed integration, and map projection. Let's examine each one.</p><h2 id="8523" class="pb ob fq bf nz pc pd pe oe pf pg ph oh nk pi pj pk no pl pm pn ns po pp pq pr bk">Map Matching</h2><p id="d6bb" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">Map matching projects sequences of sampled GPS locations to the most likely trajectory over a digital map. I have already discussed this process in two other articles, exploring its applications to <a class="af nx" href="https://medium.com/towards-data-science/map-matching-for-trajectory-prediction-be307a1547f0" rel="noopener">trajectory</a> and <a class="af nx" href="https://medium.com/towards-data-science/map-matching-for-speed-prediction-f1a534626368" rel="noopener">speed</a> predictions. Please review these two articles and their supporting code as they support this material.</p><p id="468c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">After running the map-matching process, we collect the projection of the original GPS samples to the map edges and the sequence of map vertexes corresponding to the traveled route. <strong class="nd fr">Figure 2</strong> above illustrates this, with the map vertexes in blue and the GPS projections in red. Before proceeding, we must compute the merged sequence of vertexes and GPS projections in a process that I call "map alignment."</p><h2 id="7c6f" class="pb ob fq bf nz pc pd pe oe pf pg ph oh nk pi pj pk no pl pm pn ns po pp pq pr bk">Map Alignment</h2><p id="9d5b" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">As previously stated, the map-matching process produces two disjoint sets of points, namely the edge-projected GPS locations and the map vertexes, sequenced along the route direction. Before further processing, we must merge these location sets to ensure the correct sequencing between the sets. Unfortunately, the edge-projected GPS locations do not carry the edge information, so we must find the corresponding edge identified by the endpoint vertexes. This process produces a list of map edges with the matching GPS location projections.</p><p id="d2d7" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Once done, we finish the map alignment process by converting the list of map edges to a complementary format: a list of GPS segments. We identify each GPS segment with its starting and ending locations and any map vertexes between them. <strong class="nd fr">Figure 3</strong> below illustrates these concepts, with the blue bar identifying the map edge and the red bar identifying the GPS segment.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pa"><img src="../Images/21bfbbbe6d1479de8fb991fa0676ec76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SHMmPCwxxdi9w4i6-49DyA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="bf nz">Figure 3 </strong>— The map alignment process correctly sequences the map vertexes and the projected GPS locations and splits the resulting list into GPS segments, shown in red. Note that each GPS segment contains the projected GPS endpoints and all the included map vertexes within. (Image source: Author)</figcaption></figure><p id="5453" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Now, we can examine and process each GPS segment separately. To better illustrate this concept, the first GPS segment of <strong class="nd fr">Figure 1</strong> above would encompass rows <em class="ps">one </em>to <em class="ps">eight</em> along any map vertexes detected between them.</p><p id="597c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The typical GPS segment illustrated in <strong class="nd fr">Figure 3</strong> above would have a set of signal records corresponding to each endpoint. <strong class="nd fr">Figure 1</strong> shows that the first two GPS locations have seven and six records, respectively. We aim to project those to the segment's geography using whatever information we can collect about the car's motion. Fortunately, the EVED has both the timestamps and the recorded vehicle speed. We can reconstruct the displacements along the segment with some kinematics and place the interpolated GPS locations.</p><p id="fe7a" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">If you have ever studied kinematics, you know that:</p><blockquote class="pt pu pv"><p id="b518" class="nb nc ps nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><a class="af nx" href="https://physics.info/motion-graphs/" rel="noopener ugc nofollow" target="_blank">On a velocity-time graph, the area under the curve is the change in position.</a></p></blockquote><p id="b5da" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">To recover the estimated distances between consecutive projected GPS locations, we need to compute the integral of the time versus speed.</p><h2 id="f321" class="pb ob fq bf nz pc pd pe oe pf pg ph oh nk pi pj pk no pl pm pn ns po pp pq pr bk">Speed Integration</h2><p id="af00" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk"><strong class="nd fr">Figure 1</strong> above shows that, for each record, we have values for the timestamp, measured in milliseconds since the trip started, and the car velocity, measured in kilometers per hour. To reconstruct all the intermediary distances, we compute a simple <a class="af nx" href="https://en.wikipedia.org/wiki/Trapezoidal_rule" rel="noopener ugc nofollow" target="_blank">trapezoidal integral</a> for each step and then adjust for the actual GPS segment length computed along the map.</p><p id="1ef5" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The final adjustment step is needed because the speed signal will have some noise, which is assumed to have the same distribution throughout. Therefore, the distance computed from the integral will generally differ from the map distance.</p><p id="f2d3" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">To bridge this difference, we compute a correction factor between both distances, which allows us to calculate the adjusted distances between projected GPS locations. With this final information, we can now interpolate the repeated GPS locations along the segment.</p><h2 id="e841" class="pb ob fq bf nz pc pd pe oe pf pg ph oh nk pi pj pk no pl pm pn ns po pp pq pr bk">Map Projection</h2><p id="fc1f" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">The final step of the interpolation process is transferring the extra and repeated GPS locations to the map geometry. We compute each position using the previous one and move in the segment’s direction according to the previously calculated distance. <strong class="nd fr">Figure 4</strong> below illustrates this process.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pa"><img src="../Images/a9595c6220ef433a28b1cb99a8543891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DpKQkVEN9NvX71FtDhvkzw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="bf nz">Figure 4 </strong>— The map projection process uses the integrated distances and the GPS segment headings to calculate where to place the projected locations. From left to right, we use the position of the original GPS locations in red or the map vertexes in blue and the corresponding heading and distance to calculate the projected green GPS location. (Image source: Author)</figcaption></figure><p id="f094" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">To respect the map geometry, the algorithm must consider map vertices between successive GPS locations during computation. In the case depicted in <strong class="nd fr">Figure 4</strong> above, the initial GPS location in red had four repetitions that we could project to the new green points using both the signal timestamps and the recorded speeds. The algorithm must correctly assign the distances even when crossing a map vertex, as depicted.</p><p id="f128" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">When projecting the interpolated GPS locations, the algorithm uses the segment heading, the previous location, and the interim distance to compute the next point using a <a class="af nx" href="https://www.movable-type.co.uk/scripts/latlong.html" rel="noopener ugc nofollow" target="_blank">well-known formula</a>.</p><p id="2c8f" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The final set of GPS locations, including the sampled and interpolated ones, is stored for later use. Let's see how this is done.</p><h1 id="f6cd" class="oa ob fq bf nz oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Implementation</h1><p id="aa3d" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">Before trying to run this article’s code, read the prerequisite articles and run their code. This article’s code requires you to download and generate a database containing the EVED data, which is already map-matched, and the projected link durations. Please see the reference materials below.</p><p id="ca9c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The Python code that implements the concepts described in this article is available in the accompanying <a class="af nx" href="https://github.com/joaofig/gps-oversample" rel="noopener ugc nofollow" target="_blank">GitHub repository</a>. You must execute the main script from the command line to interpolate all trips.</p><pre class="ml mm mn mo mp pw px py bp pz bb bk"><span id="2e02" class="qa ob fq px b bg qb qc l qd qe">uv run interpolate-gps.py</span></pre><p id="a2cc" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">This script iterates through all trips and processes one at a time. The first step is to load the map-matched trip polyline, where each point is a map vertex (the blue dots in the previous figures). These polylines were generated in earlier articles and should be stored in the database as encoded strings.</p><h2 id="6f6e" class="pb ob fq bf nz pc pd pe oe pf pg ph oh nk pi pj pk no pl pm pn ns po pp pq pr bk">Polyline Decoding</h2><p id="c44d" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">Decoding the polyline requires a dedicated function adapted from the public <a class="af nx" href="https://valhalla.github.io/valhalla/decoding/" rel="noopener ugc nofollow" target="_blank">Valhalla repositories</a>.</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 5</strong> — The code above adapts the original Valhalla polyline decoding function. One of the improvements is the option to reorder the coordinate pairs as (latitude, longitude) instead of the default (longitude, latitude). The original code is licensed by its authors under the <a class="af nx" href="https://github.com/valhalla/valhalla" rel="noopener ugc nofollow" target="_blank">MIT license</a>. (Image source: Author)</figcaption></figure><h2 id="dc34" class="pb ob fq bf nz pc pd pe oe pf pg ph oh nk pi pj pk no pl pm pn ns po pp pq pr bk">GPS Segment Generation</h2><p id="b004" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">Next, the script collects and aligns the map-matched trip data (the red dots) with the map vertexes. This processing results in a list of GPS segments, structures containing the sequential pairs of map-matched GPS locations with any map vertexes in between.</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 6 </strong>— A GPS Segment is a list of points where the first and last are guaranteed to be map-matched GPS locations. Any points in between will be map vertexes. (Image source: Author)</figcaption></figure><p id="6350" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We use a function that accepts a Pandas DataFrame containing the original trajectory with the unique locations and the map-matched trajectory polyline to compute the list of GPS segments.</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 7 </strong>— The function above converts the map-matched trajectory with unique locations and the map-matched polyline into a list of GPS segments. (Image source: Author)</figcaption></figure><p id="1e18" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The code then computes the repeated location projections along the segment’s geometry for each GPS segment. Note that this only occurs for the repeated locations corresponding to the starting GPS point. The end GPS point is repeated as the starting point of the next segment in the sequence.</p><p id="8efb" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We use a dedicated trajectory class to help us calculate GPS segments. As you can see from <strong class="nd fr">Figure 7</strong> above, the function initializes the trajectory object using the sequence of distinct GPS locations, the corresponding timestamps, and the database identifiers for each point. This object then merges itself with the decoded polyline to return a …</p><p id="87f9" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The dead reckoning function projects the repeated locations using the GPS segment, the calculated distances, and known durations.</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 8</strong> — The function above generates the GPS projections of the initial GPS location using the available distance and duration information. (Image source: Author)</figcaption></figure><p id="944c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The function above generates a list of points containing all the projections from the first GPS location, annotated with the row identifiers for later database insertion. This way, the code that uses these projected locations can refer back to the original row of data.</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 9</strong> — The algorithm stores each location generated through map projection in the structure above. Besides the geospatial coordinates, the object stores the time offset and the original row identifier. (Image source: Author)</figcaption></figure><p id="cd43" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We use the function below to compute a location based on a source location, a bearing, and a distance. The bearing is the angle measured in degrees from true North in the clockwise direction, so the East is 90 degrees and the South is 180 degrees.</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 10</strong> — The function above moves a point along a given distance and heading and is the foundation for GPS location interpolation. (Image source: Author)</figcaption></figure><p id="ceca" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We can now see how the main function loop integrates all these components. It is worth noting that the code keeps two copies of the original map-matched trajectory, one with the whole data and the second with only the unique locations (see lines 11–14 below).</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 11</strong> — Main loop of the GPS interpolation application. (Image source: Author)</figcaption></figure><p id="7dd4" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The last thing the code does is insert the interpolated locations into the database in a dedicated table that is 1:1 related to the original signals table.</p><figure class="ml mm mn mo mp mq"><div class="qf io l ed"><div class="qg qh l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Figure 12 </strong>— The function above computes the time versus displacement function derivatives and stores all the signals in the database. See below for an explanation of these calculations. (Image source: Author)</figcaption></figure><p id="1e3f" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The refined data can now be used for an interesting case study, identifying road sections subject to the harshest braking and acceleration.</p><h1 id="150c" class="oa ob fq bf nz oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Case Study: Harsh Braking</h1><p id="26fe" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">With the added resolution of the interpolated GPS locations, we can gain better insights into vehicle behavior and make more precise computations. To illustrate how to use the improved location resolution, we study where cars break the harshest by computing an interesting movement feature: the <a class="af nx" href="https://en.wikipedia.org/wiki/Jerk_%28physics%29" rel="noopener ugc nofollow" target="_blank">jerk</a> (or jolt). We can reliably compute this kinematic entity with shorter time intervals and corresponding speeds.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qi"><img src="../Images/b9ec47c42fe674c69c560169fa71eebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*ZeDf21lCAIQQQ-V0csgphQ.png"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="bf nz">Figure 13 </strong>— The jerk or jolt is the first derivative of the instantaneous acceleration. A high positive value means a sharp acceleration, while a significant negative value indicates a harsh brake. (Image source: Author using <a class="af nx" href="https://en.wikipedia.org/wiki/Jerk_(physics)" rel="noopener ugc nofollow" target="_blank">Wikipedia’s notation</a>)</figcaption></figure><p id="42b9" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The zones of the harshest braking can be highlighted on a map using the derived interpolated GPS locations to calculate the instantaneous jerk through the third derivative of the <strong class="nd fr"><em class="ps">r(t)</em></strong> function, where <strong class="nd fr"><em class="ps">r</em></strong> is the displacement and <strong class="nd fr"><em class="ps">t</em></strong> is time.</p><p id="2294" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><strong class="nd fr">Figure 14</strong> below shows the results of plotting the harshest brakes computed as values lower than 𝜇-3𝜎 of the jerk distribution. You can interact with this map through a dedicated <a class="af nx" href="https://github.com/joaofig/gps-oversample/blob/main/02-jerk.ipynb" rel="noopener ugc nofollow" target="_blank">Jupyter notebook</a>.</p></div></div><div class="mq"><div class="ab cb"><div class="ll qj lm qk ln ql cf qm cg qn ci bh"><figure class="ml mm mn mo mp mq qp qq paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qo"><img src="../Images/dcfdaf21c3291b2b37a1bbe647d30d3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*DDiMfGkSFS528h1YecM5Xg.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="bf nz">Figure 14</strong> — The map above displays a portion of Ann Arbor’s map, with each red dot representing a point where the database recorded an exceptionally harsh brake. (Image created by the author using OpenStreetMap data and imagery.)</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="0498" class="oa ob fq bf nz oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Conclusion</h1><p id="b1be" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">In this article, we have looked at the problem of interpolating GPS locations using maps and intermediate signals, such as time and speed. After map-matching the sampled GPS locations, we retrieved the corresponding ma-generated tree containing the inferred trajectory path, and we used those geometries to project the missing GPS locations to the “correct” places using the known speeds and interim durations. After interpolating all EVED data, we used it to detect the areas in Ann Harbor where we expect to see the harshest braking as a proxy for possibly hazardous spots.</p><h1 id="60fa" class="oa ob fq bf nz oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Credits</h1><p id="4842" class="pw-post-body-paragraph nb nc fq nd b go ov nf ng gr ow ni nj nk ox nm nn no oy nq nr ns oz nu nv nw fj bk">I used <a class="af nx" href="https://app.grammarly.com/" rel="noopener ugc nofollow" target="_blank">Grammarly</a> to review the writing and accepted several of its rewriting suggestions.</p><p id="96a4" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><a class="af nx" href="https://www.jetbrains.com/ai/" rel="noopener ugc nofollow" target="_blank">JetBrains' AI</a> assistant wrote some of the code, and it has become a staple of my everyday work with Python.</p><h1 id="4ed0" class="oa ob fq bf nz oc od gq oe of og gt oh oi oj ok ol om on oo op oq or os ot ou bk">Reference</h1><div class="qr qs qt qu qv qw"><a rel="noopener follow" target="_blank" href="/map-matching-for-trajectory-prediction-be307a1547f0?source=post_page-----6a56fdf29179--------------------------------"><div class="qx ab ig"><div class="qy ab co cb qz ra"><h2 class="bf fr hw z io rb iq ir rc it iv fp bk">Map-Matching for Trajectory Prediction</h2><div class="rd l"><h3 class="bf b hw z io rb iq ir rc it iv dx">Where are you going? Should you be going that way?</h3></div><div class="re l"><p class="bf b dy z io rb iq ir rc it iv dx">towardsdatascience.com</p></div></div><div class="rf l"><div class="rg l rh ri rj rf rk lq qw"/></div></div></a></div><div class="qr qs qt qu qv qw"><a rel="noopener follow" target="_blank" href="/map-matching-for-speed-prediction-f1a534626368?source=post_page-----6a56fdf29179--------------------------------"><div class="qx ab ig"><div class="qy ab co cb qz ra"><h2 class="bf fr hw z io rb iq ir rc it iv fp bk">Map-Matching for Speed Prediction</h2><div class="rd l"><h3 class="bf b hw z io rb iq ir rc it iv dx">How fast will you drive?</h3></div><div class="re l"><p class="bf b dy z io rb iq ir rc it iv dx">towardsdatascience.com</p></div></div><div class="rf l"><div class="rl l rh ri rj rf rk lq qw"/></div></div></a></div><p id="dba1" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><a class="af nx" href="https://physics.info/motion-graphs/" rel="noopener ugc nofollow" target="_blank">Graphs of Motion — The Physics Hypertextbook</a></p><p id="2bf4" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><a class="af nx" href="https://www.movable-type.co.uk/scripts/latlong.html" rel="noopener ugc nofollow" target="_blank">Movable Type Scripts — Calculate distance, bearing, and more between Latitude/Longitude points</a></p></div></div></div><div class="ab cb rm rn ro rp" role="separator"><span class="rq by bm rr rs rt"/><span class="rq by bm rr rs rt"/><span class="rq by bm rr rs"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="2815" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">João Paulo Figueira is a Data Scientist at <a class="af nx" href="https://tblx.io/" rel="noopener ugc nofollow" target="_blank">tb.lx by Daimler Truck</a> in Lisbon, Portugal.</p></div></div></div></div>    
</body>
</html>