<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Out-of-Office Emails Are Boring: Making Them Pop with Generative AI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Out-of-Office Emails Are Boring: Making Them Pop with Generative AI</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-out-of-office-emails-pop-with-generative-ai-876d4fb81342?source=collection_archive---------10-----------------------#2024-01-09">https://towardsdatascience.com/making-out-of-office-emails-pop-with-generative-ai-876d4fb81342?source=collection_archive---------10-----------------------#2024-01-09</a></blockquote><div><div class="em ff fg fh fi fj"/><div class="fk fl fm fn fo"><div class="ab cb"><div class="ci bh ew ex ey ez"><div/><div><h2 id="b4ea" class="pw-subtitle-paragraph go fq fr bf b gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd cq dx">I just couldn’t get myself to write yet another out-of-office message, so I developed an AI-powered app to make my digital presence felt while I was off on a month-long holiday.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://osheikhomar.medium.com/?source=post_page---byline--876d4fb81342--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Omar Ali Sheikh" class="l ep by dd de cx" src="../Images/e4fe8498d467204e79a562cd0491e581.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*y1M0qsuZBWzdZc___4X43Q.jpeg"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--876d4fb81342--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://osheikhomar.medium.com/?source=post_page---byline--876d4fb81342--------------------------------" rel="noopener follow">Omar Ali Sheikh</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--876d4fb81342--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">18 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 9, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk lb lc ab q ee ld le" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap ie li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="b9b7" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk"><em class="nf">TLDR; This article outlines the development of a web-app for crafting non-traditional out-of-office emails with Generative AI. Should you choose to peruse this article, dear reader, you will be rewarded with a large number of words strung together to describe how I designed and built a Python app that utilizes GPT-4 and DALL-E 3 for generating auto-reply messages with accompanying pictures. If, on the other hand, you just want to try out the app yourself, I got your back; the source code is up for grabs on </em><a class="af ng" href="https://github.com/sheikhomar/roll" rel="noopener ugc nofollow" target="_blank"><em class="nf">GitHub</em></a><em class="nf">.</em></p></div></div><div class="nh bh"><figure class="ni nj nk nl nm nh bh paragraph-image"><img src="../Images/85ff7ba640459bff178059f0d2b8124e.png" data-original-src="https://miro.medium.com/v2/resize:fit:3744/format:webp/1*3y8IEBlNh-RYDKDoxyexJQ.png"/><figcaption class="no np nq nr ns nt nu bf b bg z dx">A screenshot of the app I built for constructing out-of-office emails with Generative AI. This UI allows users to manage the auto-reply creations and programmatically set up Outlook out-of-office settings. Although the shown text is in Danish, the generative model can produce texts in other languages with a slight change in the prompt for the model. A short screencast of the user interface can be found towards the end of this article. Image by the author.</figcaption></figure></div><div class="ab cb"><div class="ci bh ew ex ey ez"><h1 id="188a" class="nv nw fr bf nx ny nz gr oa ob oc gu od oe of og oh oi oj ok ol om on oo op oq bk">Embracing Generative AI for Auto-Replies</h1><p id="68ae" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">Out-of-office emails are bland.</p><p id="a0a7" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">There, I’ve said it.</p><p id="fb73" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">But do they have to be this way? Why not use Large Language Models to sprinkle some flair into these messages? And for that extra pizzazz, why not use Text-to-Image models to generate snazzy images that accompany these texts?</p><p id="a4f8" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">With generative models just a few API calls away, making auto-reply emails pop couldn’t be easier. In this article, I’ll show you how. We’ll take Python and Open AI’s API for a test drive. We’ll create whimsical yet professional out-of-office emails and integrate them into Outlook. And for those who prefer to dive straight into the code, it’s all there for you on <a class="af ng" href="https://github.com/sheikhomar/roll" rel="noopener ugc nofollow" target="_blank">GitHub</a>.</p><div class="ow ox oy oz pa pb"><a href="https://github.com/sheikhomar/roll?source=post_page-----876d4fb81342--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab ih"><div class="pd ab co cb pe pf"><h2 class="bf fs hx z ip pg ir is ph iu iw fq bk">GitHub - sheikhomar/roll: A Gen AI-based app for adding flair to your auto-reply messages</h2><div class="pi l"><h3 class="bf b hx z ip pg ir is ph iu iw dx">ROLL takes care of your Outlook inbox, dutifully informing others while you’re out of the office, whether on a holiday, in a day-long workshop, or just taking a long nap after a hearty lunch.</h3></div><div class="pj l"><p class="bf b dy z ip pg ir is ph iu iw dx">github.com</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp lr pb"/></div></div></a></div><h1 id="86d7" class="nv nw fr bf nx ny nz gr oa ob oc gu od oe of og oh oi oj ok ol om on oo op oq bk">What is the Endgame here?</h1><p id="d01f" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">As any self-respecting software engineer knows, we can’t get into the technical wizardry before we know what we want to achieve.</p><p id="bffb" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk"><strong class="ml fs">Goal 1:</strong> We want to get an LLM to whip up Danish texts that tickle the funny bone. Not only that, it would be neat to pair these messages with relevant images, because who would not appreciate cartoonish images in their inbox?</p><p id="97f8" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk"><strong class="ml fs">Goal 2:</strong> Quality is vital. Especially since these auto-reply messages are sent from my work inbox. Outputs from current AI models are far from perfect. Even powerful LLMs like GPT-4 occasionally trip over the grammar rules in Danish. We need make sure that the generated content is both correct and appropriate.</p><p id="ba8c" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk"><strong class="ml fs">Goal 3:</strong> Anyone who wrestled with Outlook knows the absurd number of clicks it takes to manually change out-of-office settings. Automation is not just a buzzword here, but as necessary as a cup of Espresso on a Monday morning.</p><p id="513a" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk"><strong class="ml fs">Goal 4:</strong> Even if generative models cooked up the perfect auto-reply email, the magic will soon wear off, if the same text is served every time. So, we want the emails to change frequently. Either every time an auto-reply is sent or on a schedule, say, every 24 hours.</p><p id="ca24" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">In this article, we’ll focus on goals 1 to 3. We’ll save the scheduling part of the project for a future article because it can get quite complicated and deserves its own write-up.</p><h1 id="8bc0" class="nv nw fr bf nx ny nz gr oa ob oc gu od oe of og oh oi oj ok ol om on oo op oq bk">How to Stack Code Blocks Without Toppling the Tower?</h1><p id="9510" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">Requirements gathering: check. Time to code, right?</p><p id="a41a" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Wrong!</p><p id="f60b" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">We can’t just start typing away like caffeinated code monkeys. We need to think about how to structure our code. We are engineers, after all.</p><p id="f981" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">A quick drawing on a blank endpaper of the book <em class="nf">C# 4.0 The Complete Reference — </em>which, by the way, is an excellent book for adjusting the height of computer monitors — yields a structure with three ‘layers’:</p><figure class="ni nj nk nl nm nh nr ns paragraph-image"><div role="button" tabindex="0" class="pr ps ed pt bh pu"><div class="nr ns pq"><img src="../Images/8682194c03c0fabd7260f1037f1e5e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbycZIkmmEDQU9PFQu5eZg.png"/></div></div><figcaption class="no np nq nr ns nt nu bf b bg z dx">A drawing that maps out our strategy for organizing the code into independent units, <a class="af ng" href="https://en.wikipedia.org/wiki/Single_responsibility_principle" rel="noopener ugc nofollow" target="_blank">each with its own responsibility.</a> Image created by yours truly.</figcaption></figure><p id="0fe0" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">At the bottom layer are the components that deal with external systems:</p><ul class=""><li id="dd52" class="mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pv pw px bk"><strong class="ml fs">Generate AI API</strong> is a unit of abstraction for the generative models. In this project, we’ll rely on OpenAI’s models. Specifically, GPT-4 for drafting the texts and DALL-E 3 for the visuals in our auto-replies.</li><li id="e500" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk"><strong class="ml fs">Data Repository </strong>serves as our digital library to store our creations. We’ll keep things simple and store everything as files on disk.</li><li id="a405" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk"><strong class="ml fs">Outlook Client</strong> is our interface with Microsoft Outlook. It allows us to set the out-of-office settings programmatically, thereby automating what would otherwise be a click-fest worthy of a League of Legends tournament.</li></ul><p id="83a6" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">In the middle layer, we have a service layer, which contains the components that perform all the heavy lifting:</p><ul class=""><li id="7c79" class="mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pv pw px bk"><strong class="ml fs">Content Generator</strong> churns out texts, but also generates images that accompany these texts. It relies on the Generative AI component to deliver its output.</li><li id="75f6" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk"><strong class="ml fs">File Downloader</strong> is necessary as DALL-E’s creations have a shelf-life of just 24 hours. This component downloads these fleeting masterpieces off the internet before they vanish into thin air.</li><li id="3dff" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk"><strong class="ml fs">Image Optimizer</strong> trims the excess bytes off of images generated by DALL-E. This can be done by resizing them and maybe applying a quantization algorithm. The idea is to make emails containing images faster to transmit over the wire.</li><li id="695a" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk"><strong class="ml fs">HTML Creator</strong> is responsible for formatting a given text message and an optimized image as HTML text ready to be sent as an auto-reply email.</li></ul><p id="6b63" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Capping it all off at the top layer is the <strong class="ml fs">User Interface</strong>, our command-and-control center, where we oversee everything. Here, we ensure that when the LLM decides to produce prose containing made-up words that almost seem to be, but not entirely, Danish, we can step in and save the day.</p><p id="85ab" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">The UI also allows us to generate new images based on the text. And most importantly, this is where we can configure the out-of-office settings in Outlook with a click of a button — freeing up precious seconds for other rather enjoyable cognitive endeavors such as optimizing exact <em class="nf">k</em>-nearest-neighbor search algorithms.</p><p id="a4c4" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Now that we have laid out the software design , it’s time for coding.</p><p id="7b4c" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Let’s roll!</p><h1 id="ae33" class="nv nw fr bf nx ny nz gr oa ob oc gu od oe of og oh oi oj ok ol om on oo op oq bk">How to Build the Tower Brick by Brick?</h1><p id="867e" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">This section details in broad strokes how to implement each component described in the previous section. The aim is not to explain each line of code in detail but to provide enough context to clarify the intention of what is happening in the code. The comments in the code and naming should cover the rest. If that is not the case, you are welcome to direct a comment my way.</p><h2 id="75f9" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">Generative AI API</h2><p id="9731" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">To implement the Generative AI component, we can go down the well-trodden path of utilizing libraries like <a class="af ng" href="https://github.com/langchain-ai/langchain" rel="noopener ugc nofollow" target="_blank">LangChain</a> and <a class="af ng" href="https://github.com/openai/openai-python" rel="noopener ugc nofollow" target="_blank">OpenAI’s official Python SDK</a>. Instead, let’s veer off onto another, more well-structured trail and use <a class="af ng" href="https://github.com/lastmile-ai/aiconfig" rel="noopener ugc nofollow" target="_blank">AIConfig</a>.</p><p id="81cc" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Interestingly, AIConfig emphasizes on managing the Generative AI parts of a system through configuration files. This should strike a chord with senior software engineers. By decoupling the behavior of the AI from the application code, we get a more maintainable codebase, which is a cornerstone of high-quality software engineering. Plus, the config-driven approach structures our experiments and allows us to tweak the prompts faster without changing our code.</p><p id="7617" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">If this piqued your curiosity, check out Sarmad’s insightful article:</p><div class="ow ox oy oz pa pb"><a href="https://blog.lastmileai.dev/open-sourcing-aiconfig-6fbab53a59f7?source=post_page-----876d4fb81342--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab ih"><div class="pd ab co cb pe pf"><h2 class="bf fs hx z ip pg ir is ph iu iw fq bk">Open-sourcing AIConfig</h2><div class="pi l"><h3 class="bf b hx z ip pg ir is ph iu iw dx">A config-driven, source-control-friendly AI application development framework</h3></div><div class="pj l"><p class="bf b dy z ip pg ir is ph iu iw dx">blog.lastmileai.dev</p></div></div><div class="pk l"><div class="qu l pm pn po pk pp lr pb"/></div></div></a></div><p id="cc38" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">With AIConfig, the code for interacting with the AI becomes refreshingly simple. We just need to instantiate an instance of <code class="cx qv qw qx qy b">AIConfigRuntime</code> from a configuration file, and then issue calls to the appropriate model using named settings:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="b756" class="rc nw fr qy b bg rd re l rf rg">import anyio<br/>from aiconfig import AIConfigRuntime, InferenceOptions<br/>from pathlib import Path<br/><br/>async def main():<br/>  # Create an AIConfigRuntime object from a config file<br/>  config_path = Path("config/auto-reply-content-gen.aiconfig.json")<br/>  runtime: AIConfigRuntime = AIConfigRuntime.load(config_path)<br/><br/>  # Run inference using the prompt named `generate-text`<br/>  inference_options = InferenceOptions(stream=False)<br/>  msg = await runtime.run("generate-text", options=inference_options)<br/><br/>  # Done!<br/>  print(f"Generated message: {msg}")<br/><br/>if __name__ == "__main__":<br/>    anyio.run(main)</span></pre><p id="919a" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Banking on AIConfig in our project, the Generative AI component boils down to a few lines of code. For this reason, we are not going to write a custom wrapper code for this component, as we would have, if we were implementing it with LangChain. Less headache and no need to hurl choice words at LangChain for its convoluted design and shaky abstractions. Another delightful upside of using AIConfig is that we don’t have to roll out our own configuration logic e.g. with <a class="af ng" href="https://github.com/facebookresearch/hydra" rel="noopener ugc nofollow" target="_blank">Hydra</a>.</p><h2 id="0659" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">Data Repository</h2><p id="1970" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">Data Repository ensures that our content can be stored and retrieved reliably as files on disk. It uses a data class named <code class="cx qv qw qx qy b">AutoReplyRecord</code> to organize the information and JSON as the serialization format. Our implementation <code class="cx qv qw qx qy b">DataRepository</code> exposes CRU operations, i.e., the standard CRUD operations but without allowing for deletion:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="cde2" class="rc nw fr qy b bg rd re l rf rg">import shutil<br/>import uuid<br/>from datetime import datetime<br/>from pathlib import Path<br/>from typing import List, Optional<br/><br/>import aiofiles<br/>from pydantic import BaseModel, Field<br/><br/>from roll.utils import utcnow<br/><br/>class DataRepository:<br/>    """Represents a file-based data repository."""<br/><br/>    def __init__(self, data_dir: Path) -&gt; None:<br/>        """Initializes a new instance of the DataRepository class.<br/><br/>        Args:<br/>            data_dir (Path): The directory to store data in.<br/>        """<br/>        self._data_dir = data_dir<br/>        if not self._data_dir.exists():<br/>            self._data_dir.mkdir(parents=True, exist_ok=True)<br/><br/>    async def get_keys(self) -&gt; List[str]:<br/>        """Returns the keys of existing records."""<br/>        file_names = [<br/>            file_path.name<br/>            for file_path in self._data_dir.iterdir()<br/>            if file_path.is_dir()<br/>        ]<br/>        return file_names<br/><br/>    async def get_all(self) -&gt; List[AutoReplyRecord]:<br/>        """Returns existing records.<br/><br/>        Returns:<br/>            List[AutoReplyRecord]: A list of all records order by created time.<br/>        """<br/>        keys = await self.get_keys()<br/>        records = [await self.get(key=key) for key in keys]<br/>        sorted_records = sorted(records, key=lambda r: r.created_at, reverse=True)<br/>        return list(sorted_records)<br/><br/>    async def create(<br/>        self, ai_config_path: Path, html_template_path: Path<br/>    ) -&gt; AutoReplyRecord:<br/>        """Create a new record.<br/><br/>        Args:<br/>            ai_config_path (Path): The path to the AI Config file.<br/>            html_template_path (Path): The path to the HTML template file.<br/><br/>        Returns:<br/>            AutoReplyRecord: The newly created record.<br/>        """<br/>        key = uuid.uuid4().hex<br/><br/>        dir_path = self._data_dir / key<br/>        dir_path.mkdir(parents=True, exist_ok=True)<br/><br/>        new_ai_config_path = dir_path / ai_config_path.name<br/>        shutil.copyfile(src=ai_config_path, dst=new_ai_config_path)<br/><br/>        new_html_template_path = dir_path / html_template_path.name<br/>        shutil.copyfile(src=html_template_path, dst=new_html_template_path)<br/><br/>        record = AutoReplyRecord(<br/>            key=key,<br/>            dir=dir_path,<br/>            ai_config_path=new_ai_config_path,<br/>            html_template_path=new_html_template_path,<br/>        )<br/><br/>        await self.save(record=record)<br/>        return record<br/><br/>    async def save(self, record: AutoReplyRecord) -&gt; None:<br/>        """Save the given record to disk.<br/><br/>        Args:<br/>            record (AutoReplyRecord): The record to save.<br/>        """<br/>        file_path = record.dir / RECORD_FILE_NAME<br/>        async with aiofiles.open(file_path, mode="w") as f:<br/>            await f.write(record.to_json(indent=2))<br/><br/>    async def get(self, key: str) -&gt; Optional[AutoReplyRecord]:<br/>        """Finds a record by its key.<br/><br/>        Args:<br/>            key (str): The key to search for.<br/><br/>        Returns:<br/>            Optional[AutoReplyRecord]: The record if found, None otherwise.<br/>        """<br/>        file_path = self._data_dir / key / RECORD_FILE_NAME<br/>        if not file_path.exists():<br/>            return None<br/>        async with aiofiles.open(file_path, mode="r") as f:<br/>            json_data = await f.read()<br/>        return AutoReplyRecord.from_json(json_data=json_data)</span></pre><h2 id="dbdf" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">Outlook Client</h2><p id="246d" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">Automating Outlook becomes child’s play, when you have a tool like <a class="af ng" href="https://github.com/ecederstrand/exchangelib" rel="noopener ugc nofollow" target="_blank">exchangelib</a>. It is a Python library that lets you interact with the Microsoft Exchange API like a champ. An excellent piece of software that we’ll use in this project.</p><p id="f8e0" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">For this particular app, we just want to play with Outlook’s out-of-office settings. Therefore, we’ll put together a wrapper class that provides two pieces of functionality; backing up the current out-of-office settings and applying new settings.</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="09ba" class="rc nw fr qy b bg rd re l rf rg">import json<br/>from base64 import b64encode<br/>from datetime import datetime, timedelta, timezone<br/>from pathlib import Path<br/>from typing import cast<br/><br/>import aiofiles<br/>from exchangelib import Account, Credentials, OofSettings<br/>from exchangelib.ewsdatetime import EWSDateTime<br/><br/><br/>class OutlookAutoReplyClient:<br/>    """Represents a client for interacting with Outlook's out-of-office settings."""<br/><br/>    def __init__(self, login_name: str, password: str, account_name: str) -&gt; None:<br/>        """Initializes a new instance of the OutlookAutoReplyClient class.<br/><br/>        Args:<br/>            login_name (str): The login name of the Outlook account.<br/>            password (str): The password of the Outlook account.<br/>            account_name (str): The name of the Outlook account.<br/><br/>        """<br/>        credentials = Credentials(username=login_name, password=password)<br/>        self._account = Account(<br/>            account_name, credentials=credentials, autodiscover=True<br/>        )<br/><br/>    async def backup_to_json_file(self, output_path: Path) -&gt; None:<br/>        """Backup Outlook's current out-of-office settings to disk.<br/><br/>        Args:<br/>            output_path (Path): The location where to store the backup.<br/>        """<br/>        oof = cast(OofSettings, self._account.oof_settings)<br/>        start_at = cast(EWSDateTime, oof.start)<br/>        end_at = cast(EWSDateTime, oof.end)<br/>        settings = {<br/>            "state": oof.state,<br/>            "start": start_at.ewsformat(),<br/>            "end": end_at.ewsformat(),<br/>            "external_audience": oof.external_audience,<br/>            "internal_reply": oof.internal_reply,<br/>            "external_reply": oof.external_reply,<br/>        }<br/>        # Save settings to disk as JSON<br/>        async with aiofiles.open(output_path, "w") as file:<br/>            json_content = json.dumps(settings, indent=2)<br/>            await file.write(json_content)<br/><br/>    async def set_internal_reply(self, html_content: str) -&gt; None:<br/>        """Sets the internal auto-reply message for a month.<br/><br/>        Args:<br/>            html_content (str): The message to set as the internal auto-reply.<br/>        """<br/>        start_at = datetime.now(tz=timezone.utc) - timedelta(days=1)<br/>        end_at = datetime.now(tz=timezone.utc) + timedelta(days=5)<br/><br/>        print(f"Setting internal auto-reply message from {start_at} to {end_at}...")<br/>        self._account.oof_settings = OofSettings(<br/>            state=OofSettings.ENABLED,<br/>            external_audience="None",<br/>            internal_reply=html_content,<br/>            external_reply="-",  # Cannot be empty string or None!<br/>            start=start_at,<br/>            end=end_at,<br/>        )</span></pre><h2 id="abac" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">Content Generator</h2><p id="4710" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">Now, to the heart of our project: the Content Generator. We need generate two types of content. First, we craft an auto-reply text using GPT-4. Then, we let DALL-E 3 generate an image incorporating elements from the generated text.</p><p id="5787" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Unfortunately, DALL-E 3 has a <a class="af ng" href="https://cookbook.openai.com/articles/what_is_new_with_dalle_3" rel="noopener ugc nofollow" target="_blank">limit on its prompt</a>. To work around this, we use GPT-4 to craft a concise prompt for DALL-E 3 that incorporates aspects extracted from a given text.</p><p id="887b" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">This process requires three distinct calls to the AI models:</p><ul class=""><li id="445c" class="mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pv pw px bk"><code class="cx qv qw qx qy b">generate-text</code> asks GPT-4 to concoct new text that can be used in an auto-reply email.</li><li id="000c" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk"><code class="cx qv qw qx qy b">generate-dall-e-prompt</code> calls GPT-4, prompting it to come up with a prompt designed specifically for DALL-E 3 based on our generated text from the first call. This is a bit meta, like writing code to generate code.</li><li id="83c4" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk"><code class="cx qv qw qx qy b">generate-image</code> asks DALL-E 3 to generate an image that should accompany the auto-reply message. Here, we use prompt generated by the <code class="cx qv qw qx qy b">generate-dall-e-prompt</code> call.</li></ul><p id="9338" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">We’ll let AIConfig orchestrate the entire process. For that, it needs a configuration file that describes how to achieve our desired result. We create a configuration file that contains three named prompts:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="4fed" class="rc nw fr qy b bg rd re l rf rg">{<br/>  "name": "auto-reply-content-generator",<br/>  "description": "Configuration for generating content for auto-reply messages.",<br/>  "schema_version": "latest",<br/>  "metadata": {<br/>    "model_parsers": {<br/>      "gpt-4-1106-preview": "gpt-4"<br/>    }<br/>  },<br/>  "prompts": [<br/>    {<br/>      "name": "generate-text",<br/>      "input": "Write an auto-reply message in Danish following the same structure of earlier messages.",<br/>      "metadata": {<br/>        "model": {<br/>          "name": "gpt-4-1106-preview",<br/>          "settings": {<br/>            "model": "gpt-4-1106-preview",<br/>            "max_tokens": 1000,<br/>            "temperature": 0.1,<br/>            "system_prompt": "You're a renowned expert at crafting witty and engaging out-of-office replies in Danish. [...]"<br/>          }<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "name": "generate-dall-e-prompt",<br/>      "input": "Generate a prompt for DALL-E 3 to create an illustration that complements the following out-of-office message:\n{{auto_reply_message}}",<br/>      "metadata": {<br/>        "model": {<br/>          "name": "gpt-4-1106-preview",<br/>          "settings": {<br/>            "model": "gpt-4-1106-preview",<br/>            "max_tokens": 1000,<br/>            "temperature": 0.1,<br/>            "system_prompt": "You are an expert prompt engineer for the image generation model: DALL-E 3. [...]"<br/>          }<br/>        },<br/>        "parameters": {<br/>          "auto_reply_message": "Parameter for the auto-reply message."<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "name": "generate-image",<br/>      "input": "{{dall_e_prompt}}",<br/>      "metadata": {<br/>        "model": {<br/>          "name": "dall-e-3",<br/>          "settings": {<br/>            "model": "dall-e-3",<br/>            "size": "1792x1024",<br/>            "quality": "standard"<br/>          }<br/>        },<br/>        "parameters": {<br/>          "dall_e_prompt": "Parameter for the DALL-E prompt."<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="5a64" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">It is relatively straightforward to read the configuration file, once you understand the configuration schema:</p><div class="ow ox oy oz pa pb"><a href="https://aiconfig.lastmileai.dev/docs/overview/ai-config-format?source=post_page-----876d4fb81342--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab ih"><div class="pd ab co cb pe pf"><h2 class="bf fs hx z ip pg ir is ph iu iw fq bk">AIConfig Specification | AIConfig</h2><div class="pi l"><h3 class="bf b hx z ip pg ir is ph iu iw dx">aiconfig files are source-control friendly JSON documents that contain generative AI model settings, prompt inputs and outputs, and flexible multi-purpose metadata.</h3></div><div class="pj l"><p class="bf b dy z ip pg ir is ph iu iw dx">aiconfig.lastmileai.dev</p></div></div></div></a></div><p id="8ca3" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Next, we construct a class that exposes two main methods: <code class="cx qv qw qx qy b">generate_message</code> and <code class="cx qv qw qx qy b">generate_image</code>. Inside these methods, we inject our configuration file into AIConfig and let it perform its magic:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="1bc5" class="rc nw fr qy b bg rd re l rf rg">from pathlib import Path<br/><br/>from aiconfig import AIConfigRuntime, InferenceOptions<br/><br/><br/>class AutoReplyContentGenerator:<br/>    """Represents a class that generates content for auto-reply messages."""<br/><br/>    def __init__(self, config_file_path: Path, output_dir: Path, verbose: bool) -&gt; None:<br/>        """Initializes a new instance of the AutoReplyContentGenerator class.<br/><br/>        Args:<br/>            config_file_path (Path): The path to the AI Config file to use.<br/>            output_dir (Path): The directory to save outputs to.<br/>            verbose (bool): Whether to print debug messages to stdout.<br/>        """<br/>        if not config_file_path.exists():<br/>            raise ValueError(f"File {config_file_path} not found")<br/><br/>        self._output_path: Path = output_dir / config_file_path.name<br/>        self._runtime: AIConfigRuntime = AIConfigRuntime.load(config_file_path)<br/>        self._verbose = verbose<br/><br/>    async def generate_message(self) -&gt; str:<br/>        """Generates an auto-reply message.<br/><br/>        Returns:<br/>            str: The generated message.<br/>        """<br/>        inference_options = InferenceOptions(stream=False)<br/><br/>        if self._verbose:<br/>            print("Running inference for prompt 'generate-text'...")<br/><br/>        auto_reply_message = await self._runtime.run_and_get_output_text(<br/>            prompt_name="generate-text",<br/>            options=inference_options,<br/>        )<br/>        self._save_outputs()<br/><br/>        print(f"Generated auto-reply message:\n{auto_reply_message}\n")<br/>        return auto_reply_message<br/><br/>    async def generate_image(self, auto_reply_message: str) -&gt; str:<br/>        """Generates an image to accompany the given auto-reply message.<br/><br/>        Args:<br/>            auto_reply_message (str): The auto-reply message to use as inspiration for the image generation.<br/><br/>        Returns:<br/>            str: The URL of the generated image.<br/>        """<br/>        if self._verbose:<br/>            print("Running inference for prompt 'generate-dall-e-prompt'...")<br/><br/>        inference_options = InferenceOptions(stream=False)<br/>        dall_e_prompt = await self._runtime.run_and_get_output_text(<br/>            prompt_name="generate-dall-e-prompt",<br/>            options=inference_options,<br/>            params={<br/>                "auto_reply_message": auto_reply_message,<br/>            },<br/>        )<br/>        self._save_outputs()<br/><br/>        if self._verbose:<br/>            print(f"Generated prompt for DALL-E:\n{dall_e_prompt}\n")<br/>            print("Running inference for prompt 'generate-image'...")<br/><br/>        image_url = await self._runtime.run_and_get_output_text(<br/>            prompt_name="generate-image",<br/>            options=inference_options,<br/>            params={<br/>                "dall_e_prompt": dall_e_prompt,<br/>            },<br/>        )<br/>        self._save_outputs()<br/><br/>        if self._verbose:<br/>            print(f"Generated image URL:\n{image_url}\n")<br/><br/>        return image_url<br/><br/>    def _save_outputs(self) -&gt; None:<br/>        """Saves the outputs of the models to a JSON file."""<br/>        self._runtime.save(<br/>            json_config_filepath=str(self._output_path),<br/>            include_outputs=True,<br/>        )</span></pre><h2 id="0430" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">File Downloader</h2><p id="c0b9" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">Just like there are numerous programming language, there are a plethora of ways to download a file from the internet with Python. But as a wise engineer may say: “Choose the tool as you would choose your programming language, carefully and with regard to your project’s requirements”. We’ll roll with the asynchronous <a class="af ng" href="https://github.com/aio-libs/aiohttp" rel="noopener ugc nofollow" target="_blank">aiohttp</a> library paired with <a class="af ng" href="https://github.com/tqdm/tqdm" rel="noopener ugc nofollow" target="_blank">tqdm</a> for that satisfying visual feedback of download progress, because why the hell not:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="7eaf" class="rc nw fr qy b bg rd re l rf rg">from pathlib import Path<br/>from typing import Optional<br/>from urllib.parse import unquote, urlparse<br/><br/>import aiofiles<br/>import aiohttp<br/>from tqdm.asyncio import tqdm_asyncio<br/><br/><br/>class FileDownloader:<br/>    """Represents a class that downloads files."""<br/><br/>    def __init__(<br/>        self,<br/>        output_dir: Path,<br/>        verify_ssl: bool,<br/>        verbose: bool,<br/>        download_chunk_size: int = 1024,<br/>    ) -&gt; None:<br/>        """Initializes a new instance of the FileDownloader class.<br/><br/>        Args:<br/>            output_dir (Path): The directory to save downloaded files to.<br/>            verify_ssl (bool): Whether to verify SSL certificates when downloading files.<br/>            download_chunk_size (int, optional): The size of each chunk to download. Defaults to 1024.<br/>        """<br/>        self._http = aiohttp.ClientSession(<br/>            connector=aiohttp.TCPConnector(ssl=verify_ssl)  # type: ignore<br/>        )<br/>        self._chunk_size = download_chunk_size<br/><br/>        self._output_dir = output_dir<br/>        self._output_dir.mkdir(parents=True, exist_ok=True)<br/>        self._verbose = verbose<br/><br/>    async def download_one(<br/>        self, url: str, local_file_name: Optional[str] = None<br/>    ) -&gt; Path:<br/>        """Downloads an file from a URL and stores it on local disk.<br/><br/>        Args:<br/>            url (str): The URL to download the file from.<br/>            local_file_name (Optional[str], optional): The name of the file to save the downloaded file to. Defaults to None.<br/><br/>        Returns:<br/>            Path: The location of the downloaded file in the local disk.<br/>        """<br/>        file_path = self._get_local_file_path(url=url, file_name=local_file_name)<br/>        async with self._http.get(url=url) as response:<br/>            if response.status != 200:<br/>                raise Exception(f"Failed to download file: {response.status}")<br/><br/>            if self._verbose:<br/>                print(f"Downloading file from {url} to {file_path}...")<br/><br/>            total_size = int(response.headers.get("content-length", 0))<br/>            with tqdm_asyncio(<br/>                total=total_size, unit="B", unit_scale=True, desc="Downloading"<br/>            ) as progress_bar:<br/>                async with aiofiles.open(file_path, "wb") as file:<br/>                    async for data in response.content.iter_chunked(self._chunk_size):<br/>                        await file.write(data)<br/>                        progress_bar.update(len(data))<br/>        return file_path<br/><br/>    async def close(self) -&gt; None:<br/>        """Closes the HTTP session."""<br/>        await self._http.close()<br/><br/>    def _get_local_file_path(self, url: str, file_name: Optional[str]) -&gt; Path:<br/>        """Gets the path to save the downloaded file to.<br/><br/>        Args:<br/>            file_name (Optional[str]): The name of the file to save the downloaded file to. Defaults to None.<br/><br/>        Returns:<br/>            Path: The path to save the downloaded file to.<br/>        """<br/>        if file_name is None:<br/>            file_name = unquote(urlparse(url).path.split("/")[-1])<br/>        file_path = self._output_dir / file_name<br/>        if file_path.exists():<br/>            # raise Exception(f"File {file_path} already downloaded.")<br/>            print(f"WARNING. File {file_path} already exists. Overwritting...")<br/>        return file_path</span></pre><h2 id="373a" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">Image Optimizer</h2><p id="f559" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">We can reduce the file sizes of DALL-E 3 creations significantly by resizing and quantizing them. With <a class="af ng" href="https://github.com/python-pillow/Pillow" rel="noopener ugc nofollow" target="_blank">Pillow</a>, these two operations require few lines of code. We wrap these in a class:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="1a15" class="rc nw fr qy b bg rd re l rf rg">from pathlib import Path<br/><br/>from PIL import Image<br/><br/><br/>class ImageOptimizer:<br/>    def __init__(self, max_width: int, quantize: bool, image_quality: int) -&gt; None:<br/>        """Initializes a new instance of the ImageOptimizer class.<br/><br/>        Args:<br/>            max_width (int): The maximum width of the image in pixels.<br/>            quantize (bool): Whether to quantize the image to reduce file size.<br/>            image_quality (int): The quality of the image when saving it to disk from 1 to 100.<br/>        """<br/>        self._max_width = max_width<br/>        self._quantize = quantize<br/>        self._image_quality = image_quality<br/><br/>    def run(self, input_path: Path) -&gt; Path:<br/>        """Optimizes an image and stores the image on disk.<br/><br/>        Args:<br/>            input_path (Path): The path to the image to optimize.<br/><br/>        Returns:<br/>            Path: The location of the optimized image on disk.<br/>        """<br/>        output_path = input_path.parent / f"{input_path.stem}-optimized.jpg"<br/><br/>        img = Image.open(input_path)<br/>        img = img.convert("RGB")<br/><br/>        img.thumbnail(size=(self._max_width, self._max_width), resample=Image.LANCZOS)<br/><br/>        if self._quantize:<br/>            # Quantize image to reduce file size. Pillow converts the image to a<br/>            # palette image with at most 256 colors. This is done by storing 1 byte for<br/>            # each pixel instead of storing 3 bytes for R, G and B for each pixel.<br/>            # The single byte is used to store the index into the palette.<br/>            img = img.quantize()<br/><br/>            if output_path.suffix.lower() in [".jpg", ".jpeg"]:<br/>                # Convert to RGB before saving to JPEG to avoid errors.<br/>                img = img.convert("RGB")<br/><br/>        img.save(output_path, optimize=True, quality=self._image_quality)<br/>        return output_path</span></pre><h2 id="dbb2" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">HTML Creator</h2><p id="c779" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">Once we generate some text and pair it with an image, we transform the content into a single email artifact. The alternative, using linked images, entails figuring out how to host images for our out-of-office emails. Is it worth it? Not for a project of this scale.</p><p id="9480" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">We can easily sidestep the hassle of image hosting. <a class="af ng" href="https://en.wikipedia.org/wiki/MIME" rel="noopener ugc nofollow" target="_blank">MIME</a> is a standard that allows us to combine text and images by constructing an HTML-based email with the image embedded in the markup.</p><p id="ebfd" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">For the email layout, we create an external file to use as an HTML template. No point in hard-coding it, as nobody wants that code smell lingering around. This template contains three customizable fields: one for the text and the other two fields for the image.</p><p id="eee1" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">We give the text a touch of HTML styling. Nothing too gaudy, just enough to make it have the proper spacing. To encode the image binary into text so it can be embedded in the markup, we apply Base64.</p><p id="f81d" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Here is the code:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="3f2d" class="rc nw fr qy b bg rd re l rf rg">from base64 import b64encode<br/>from pathlib import Path<br/><br/>import aiofiles<br/><br/><br/>class AutoReplyHtmlCreator:<br/>    """Represents a class that creates the HTML for an auto-reply message."""<br/><br/>    def __init__(self, template_file_path: Path) -&gt; None:<br/>        """Initializes a new instance of the AutoReplyHtmlCreator class.<br/><br/>        Args:<br/>            template_file_path (Path): The path to the HTML template to use.<br/>        """<br/>        self._template_file_path = template_file_path<br/><br/>        if not template_file_path.exists():<br/>            raise ValueError(f"File {template_file_path} not found")<br/><br/>    async def run(self, message: str, image_file_path: Path, output_path: Path) -&gt; str:<br/>        """Creates the HTML for an auto-reply message.<br/><br/>        Args:<br/>            message (str): The message to include in the auto-reply.<br/>            image_file_path (Path): The path to the image to include in the auto-reply.<br/>            output_path (Path): The path to save the HTML to.<br/><br/>        Returns:<br/>            str: The HTML for the auto-reply message.<br/>        """<br/>        async with aiofiles.open(self._template_file_path, "r") as file:<br/>            template = await file.read()<br/><br/>        async with aiofiles.open(image_file_path, "rb") as file:<br/>            image_data = await file.read()<br/>            image_base64 = b64encode(image_data).decode("utf-8")<br/><br/>        message_in_html = message.replace("\n\n", "&lt;/p&gt;&lt;p&gt;")<br/>        message_in_html = message_in_html.replace("\n", "&lt;br/&gt;")<br/>        message_in_html = f"&lt;p&gt;{message_in_html}&lt;/p&gt;"<br/><br/>        html = template.replace("{{CONTENT}}", message_in_html)<br/>        html = html.replace("{{IMAGE_BASE64}}", image_base64)<br/>        html = html.replace("{{IMAGE_CONTENT_TYPE}}", "image/jpeg")<br/><br/>        async with aiofiles.open(output_path, "w") as file:<br/>            await file.write(html)<br/><br/>        return html</span></pre><h2 id="b448" class="qd nw fr bf nx qe qf qg oa qh qi qj od ms qk ql qm mw qn qo qp na qq qr qs qt bk">User Interface</h2><p id="141e" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">The last missing piece is the user interface. For this, we use <a class="af ng" href="https://github.com/streamlit/streamlit" rel="noopener ugc nofollow" target="_blank">Streamlit </a>to create a basic web interface as our needs are simple:</p><ul class=""><li id="93a2" class="mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne pv pw px bk">A neat list displaying previously crafted digital masterpieces.</li><li id="a49b" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk">Buttons to cook up a pair of fresh text message and image.</li><li id="556a" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk">A place to tweak the text message to ironing out any creases.</li><li id="0eb1" class="mj mk fr ml b gp py mn mo gs pz mq mr ms qa mu mv mw qb my mz na qc nc nd ne pv pw px bk">A button to set out-of-office setting in Outlook programmatically.</li></ul><p id="5e57" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">The UI makes use of all of our components to deliver the above functionality. In the code listing below, I’ve tried to spare you, dear reader, the nitty-gritty of the entire code. If you are interested, you are welcome to peruse the full implementation on <a class="af ng" href="https://github.com/sheikhomar/roll/blob/main/tools/streamlit_ui.py" rel="noopener ugc nofollow" target="_blank">GitHub</a>:</p><pre class="ni nj nk nl nm qz qy ra bp rb bb bk"><span id="5f06" class="rc nw fr qy b bg rd re l rf rg">from pathlib import Path<br/>from typing import cast<br/><br/>import anyio<br/>import streamlit as st<br/>from roll.config import settings<br/>from roll.data import ActiveOutOfOfficeSetting, AutoReplyRecord, DataRepository<br/>from roll.email import AutoReplyHtmlCreator, OutlookAutoReplyClient<br/>from roll.image import ImageOptimizer<br/>from roll.io import FileDownloader<br/>from roll.models import AutoReplyContentGenerator<br/>from roll.utils import utcnow<br/><br/><br/>class StreamlitApp:<br/>    def __init__() -&gt; None:<br/>        ...<br/><br/>    async def run(self) -&gt; None:<br/>        await self._setup_page_config()<br/>        await self._build_sidebar()<br/>        await self._build_main_content()<br/><br/>    async def _setup_page_config(self) -&gt; None:<br/>        ...<br/><br/>    async def _build_sidebar(self) -&gt; None:<br/>        ...<br/><br/>    async def _build_main_content(self) -&gt; None:<br/>        ...<br/><br/>    async def _render_navbar(self, record: AutoReplyRecord) -&gt; None:<br/>        ...<br/><br/>    async def _create_new_content(self) -&gt; None:<br/>        ...<br/><br/>    async def _generate_message(self, record: AutoReplyRecord) -&gt; None:<br/>        ...<br/><br/>    async def _generate_image(self, record: AutoReplyRecord) -&gt; None:<br/>        ...<br/><br/>    async def _set_out_of_office(self, record: AutoReplyRecord) -&gt; None:<br/>        ...<br/><br/><br/>async def main() -&gt; None:<br/>    """Main entry point of the UI."""<br/>    app = StreamlitApp(<br/>        data_dir=Path("data/repository"),<br/>        ai_config_path=Path("config/auto-reply-content-gen.aiconfig.json"),<br/>        html_template_file_path=Path("config/auto-reply-template.html"),<br/>        oof_data_dir=Path("data/oof"),<br/>        outlook_login_name=settings.LOGIN,<br/>        outlook_password=settings.PASSWORD,<br/>        outlook_account_name=settings.ACCOUNT_NAME,<br/>    )<br/>    await app.run()<br/><br/><br/>if __name__ == "__main__":<br/>    anyio.run(main)</span></pre><p id="faaa" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Below is a screencast of the user interface. The sidebar on the left is a gallery, which displays our past creations. Clicking the edit (✏️) button in the sidebar brings the content to the main stage on the right. Here, we can tweak the existing message or conjure up a new one, along with its visual counterpart. You can easily let the LLM produce texts in other languages, just tweak the prompt in the AIConfig file as discussed in the article. The <code class="cx qv qw qx qy b">Set out-of-office</code> button takes the displayed content and sets it as our Outlook out-of-office message.</p></div></div><div class="nh bh"><figure class="ni nj nk nl nm nh bh paragraph-image"><img src="../Images/e622741baaabb1c6bf3a07fd21bec94d.png" data-original-src="https://miro.medium.com/v2/resize:fit:4800/format:webp/1*hv831SHoEVoMPx8VybhvLA.gif"/><figcaption class="no np nq nr ns nt nu bf b bg z dx">A short screencast of the user interface, courtesy of yours truly.</figcaption></figure></div><div class="ab cb"><div class="ci bh ew ex ey ez"><h1 id="b3a3" class="nv nw fr bf nx ny nz gr oa ob oc gu od oe of og oh oi oj ok ol om on oo op oq bk">Time to Wrap Up</h1><p id="c831" class="pw-post-body-paragraph mj mk fr ml b gp or mn mo gs os mq mr ms ot mu mv mw ou my mz na ov nc nd ne fk bk">We went through the process of developing a Python program that creates atypical out-of-office emails using GPT-4 and DALL-E 3.</p><p id="8ea0" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Sure, we could slap together a monstrous 1000-line script to achieve our goals quickly. But we didn’t. We followed our software engineering principles — ingrained into us by years of brainwashing, and eager to do the same for the new generation of wide-eyed software engineers.</p><p id="073d" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">Instinctively, we recalled that software engineering is more about thoughtful design than mere coding. Therefore, we started the undertaking by carefully considering how to structure the code.</p><p id="fdf4" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">We attempted to organize our code into classes, using descriptive names and type hints for clarity. Trying to write as little code as possible, we relied on other engineers’ work by using their Python libraries to solve our problems.</p><p id="99e7" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">While we’ve set aside the scheduling aspect for a later, unspecified date, we’ve laid a solid foundation. Our app can generate whimsical yet professional auto-replies with relevant images. On top of that, it allows us to seamlessly integrate the emails into Outlook with a single click of a button.</p><p id="ec5d" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk">So, next time you’re away — whether on a holiday, in a full-day workshop, or just taking a nap after a hearty lunch — why not let Generative AI generate your auto-relies, which may leave your colleagues smiling and, perhaps, wanting more.</p></div></div></div><div class="ab cb rh ri rj rk" role="separator"><span class="rl by bm rm rn ro"/><span class="rl by bm rm rn ro"/><span class="rl by bm rm rn"/></div><div class="fk fl fm fn fo"><div class="ab cb"><div class="ci bh ew ex ey ez"><p id="d217" class="pw-post-body-paragraph mj mk fr ml b gp mm mn mo gs mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne fk bk"><em class="nf">Thank you for reading. If you fancy more articles like this in the future, follow me on Medium or connect on </em><a class="af ng" href="https://www.linkedin.com/in/osheikhomar/" rel="noopener ugc nofollow" target="_blank"><em class="nf">LinkedIn</em></a><em class="nf">.</em></p></div></div></div></div>    
</body>
</html>