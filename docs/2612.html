<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Understanding K-Fold Target Encoding to Handle High Cardinality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Understanding K-Fold Target Encoding to Handle High Cardinality</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-k-fold-target-encoding-to-handle-high-cardinality-296387753e3f?source=collection_archive---------6-----------------------#2024-10-26">https://towardsdatascience.com/understanding-k-fold-target-encoding-to-handle-high-cardinality-296387753e3f?source=collection_archive---------6-----------------------#2024-10-26</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="9344" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Balancing complexity and performance: An in-depth look at K-fold target encoding</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@fhlpmah?source=post_page---byline--296387753e3f--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Fhilipus Mahendra" class="l ep by dd de cx" src="../Images/84e51da9cca72313e627a8dd380ab40b.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*WyDOWr058AvurEU-_it9Mw.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--296387753e3f--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@fhlpmah?source=post_page---byline--296387753e3f--------------------------------" rel="noopener follow">Fhilipus Mahendra</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--296387753e3f--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Oct 26, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/b01cfdfe1508b5c3c7adb5366bd3429f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAL6Co9XoO_rZ89cG71sfg.jpeg"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@kommumikation?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener ugc nofollow" target="_blank">Mika Baumeister</a> on <a class="af nb" href="https://unsplash.com/photos/white-printing-paper-with-numbers-Wpnoqo2plFA?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="b207" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Introduction</h1><p id="96d2" class="pw-post-body-paragraph ny nz fq oa b go ob oc od gr oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">Data science practitioners encounter numerous challenges when handling diverse data types across various projects, each demanding unique processing methods. A common obstacle is working with data formats that traditional machine learning models struggle to process effectively, resulting in subpar model performance. Since most machine learning algorithms are optimized for numerical data, transforming categorical data into numerical form is essential. However, this often oversimplifies complex categorical relationships, especially when the feature have high cardinality — meaning a large number of unique values — which complicates processing and impedes model accuracy.</p><p id="0abe" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">High cardinality refers to the number of unique elements within a feature, specifically addressing the distinct count of categorical labels in a machine learning context. When a feature has many unique categorical labels, it has high cardinality, which can complicate model processing. To make categorical data usable in machine learning, these labels are often converted to numerical form using encoding methods based on data complexity. One popular method is One-Hot Encoding, which assigns each unique label a distinct binary vector. However, with high-cardinality data, One-Hot Encoding can dramatically increase dimensionality, leading to complex, high-dimensional datasets that require significant computational capacity for model training and potentially slow down performance.</p><p id="bd98" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Consider a dataset with 2,000 unique IDs, each ID linked to one of only three countries. In this case, while the ID feature has a cardinality of 2,000 (since each ID is unique), the country feature has a cardinality of just 3. Now, imagine a feature with 100,000 categorical labels that must be encoded using One-Hot Encoding. This would create an extremely high-dimensional dataset, leading to inefficiency and significant resource consumption.</p><p id="7464" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">A widely adopted solution among data scientists is <strong class="oa fr">K-Fold Target Encoding</strong>. This encoding method helps reduce feature cardinality by replacing categorical labels with target-mean values, based on K-Fold cross-validation. By focusing on individual data patterns, K-Fold Target Encoding lowers the risk of overfitting, helping the model learn specific relationships within the data rather than overly general patterns that can harm model performance.</p><h1 id="eb0b" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">How it works</h1><p id="1459" class="pw-post-body-paragraph ny nz fq oa b go ob oc od gr oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">K-Fold Target Encoding involves dividing the dataset into several equally-sized subsets, known as “folds,” with “K” representing the number of these subsets. By folding the dataset into multiple groups, this method calculates the cross-subset weighted mean for each categorical label, enhancing the encoding’s robustness and reducing overfitting risks.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj oz"><img src="../Images/c004e10d4c2c0c7e0ffcbbe240651a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*Ae58D5YERKpx7RQRerYmzQ.jpeg"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Fig 1. Indonesian Domestic Flights Dataset [1]</figcaption></figure><p id="43de" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Using an example from <strong class="oa fr">Fig 1</strong>. of a sample dataset of Indonesian domestic flights emissions for each flight cycle, we can put this technique into practice. The base question to ask with this dataset is “What is the weighted mean for each categorical labels in ‘Airlines’ by looking at feature ‘HC Emission’ ?”. However, you might come with the same question people been asking me about. “But, if you just calculated them using the targeted feature, couldn’t it result as another high cardinality feature?”. The simple answer is “Yes, it could”.</p><p id="3954" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Why?</p><p id="f771" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In cases where a large dataset has a highly random target feature without identifiable patterns, K-Fold Target Encoding might produce a wide variety of mean values for each categorical label, potentially preserving high cardinality rather than reducing it. However, the primary goal of K-Fold Target Encoding is to address high cardinality, not necessarily to reduce it drastically. This method works best when there is a meaningful correlation between the target feature and segments of the data within each categorical label.</p><p id="9bf5" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">How does K-Fold Target Encoding operate? The simplest way to explain this is that, in each fold, you calculate the mean of the target feature from the other folds. This approach provides each categorical label with a unique weight, represented as a numerical value, making it more informative. Let’s look at an example calculation using our dataset for a clearer understanding.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj pa"><img src="../Images/eab2ff1f3d35d8a892639110151687f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*PsMNGQycASEpjfwOA_bj_A.jpeg"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Fig 2. Indonesian Domestic Flights Dataset After K-Fold Assigned [1]</figcaption></figure><p id="3e05" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">To calculate the weight of the ‘AirAsia’ label for the first observation, start by splitting the data into multiple folds, as shown in<strong class="oa fr"> Fig 2</strong>. You can assign folds manually to ensure equal distribution, or automate this process using the following sample code:</p><pre class="ml mm mn mo mp pb pc pd bp pe bb bk"><span id="1dd7" class="pf nd fq pc b bg pg ph l pi pj">import seaborn as sns<br/>import matplotlib.pyplot as plt<br/><br/># In order to split our data into several parts equally lets assign KFold numbers to each of the data randomly.<br/><br/># Calculate the number of samples per fold<br/>num_samples = len(df) // 8<br/><br/># Assign fold numbers<br/>df['kfold'] = np.repeat(np.arange(1, 9), num_samples)<br/><br/># Handle any remaining samples (if len(df) is not divisible by 8)<br/>remaining_samples = len(df) % 8<br/>if remaining_samples &gt; 0:<br/>    df.loc[-remaining_samples:, 'kfold'] = np.arange(1, remaining_samples + 1)<br/><br/># Shuffle again to ensure randomness<br/>fold_df = df.sample(frac=1, random_state=42).reset_index(drop=True)</span></pre></div></div><div class="mq"><div class="ab cb"><div class="ll pk lm pl ln pm cf pn cg po ci bh"><div class="ml mm mn mo mp ab ke"><figure class="le mq pp pq pr ps pt paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><img src="../Images/8336953e4307378b5f5c17677b7ecba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*5dJw8kgMJj9uzwTUdufS9A.jpeg"/></div></figure><figure class="le mq pp pq pr ps pt paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><img src="../Images/6434adc4235962e6f83cd02c49fdd233.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*JHySUwCPJykN6QJ9sD64bw.jpeg"/></div></figure><figure class="le mq pu pq pr ps pt paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><img src="../Images/c7509a7f71f2fbcbb706e1bb0ff39ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*Vy_zwvjMGR51jF_pBUfWYQ.jpeg"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx pv ed pw px">Fig 3. Category-Specific Mean Calculation Process [1]</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="df31" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">With your dataset now split into folds, the next step is to calculate the mean of the same label across other folds. For example, ‘AirAsia’ in Fold 1 would use the mean from Folds 2, 3, 4, 5, 6, and so on, resulting in a mean of 11.3. This process continues across all folds, so Fold 2 would incorporate the mean from Folds 1, 3, 4, 5, 6, etc. The final results of these calculations are illustrated in <strong class="oa fr">Fig 4.</strong></p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj py"><img src="../Images/c3a3b50c783d067bc55689d27078d34f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1NAe6gp4ge7HiOYtUzs8A.jpeg"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Fig 4. K-Fold Target Encoding (only category-specific mean) Results [1]</figcaption></figure><p id="360d" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">This calculation is known as the “category-specific mean,” which defines the average value for each categorical label based on similar label instances. Another essential calculation is the “global mean,” which defines the average intensity of your categorical label based on a user-defined global mean weight. The global mean serves as a baseline or “neutral” encoding, especially valuable for rare categories where the category-specific mean may rely on limited data points.</p><p id="e603" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">In K-Fold Target Encoding, both the category-specific and global means are typically combined to create a more robust and comprehensive representation. For a detailed illustration, refer to <strong class="oa fr">Fig 5.</strong></p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pz"><img src="../Images/eb730016418393663ac4f2e45b17e95c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5KJ10Bd8vNQIJXhaVvnhA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Fig 5. Mathematical Form of K-Fold Target Encoder. [1]</figcaption></figure><p id="7b90" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">The mathematical formula makes it easier to understand how this calculation works. Here, <em class="qa">m</em> represents a user-defined weight, allowing control over the influence of the global mean in the final calculation. Now, we can apply this formula to the dataset from <strong class="oa fr">Fig 2</strong> and implement it using the code below.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qb"><img src="../Images/1e94835c575331036b4660a6ad6f1b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOkKU22Ta_eby7ACWCMSiQ.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Fig 6. K-Fold Target Encoding Process Using Both Means. [1]</figcaption></figure><pre class="ml mm mn mo mp pb pc pd bp pe bb bk"><span id="ec6e" class="pf nd fq pc b bg pg ph l pi pj"># First we have to encode the categorical features using K-Fold target encoding<br/><br/>def useful_feature(df, target, weight):<br/>  utilized_feature = [c for c in df.columns if c not in (target)]<br/>  obj = [col for col in df.columns if df[col].dtype == 'object']<br/>  global_mean = df[target].mean()<br/><br/>  for objek in obj:<br/>        df[f"countperobject_{objek}"] = 0<br/>        df[f"meanperobject_{objek}"] = 0<br/><br/>        # Compute aggregations<br/>        agg = df.groupby(objek)[target].agg(['count', 'mean']).reset_index()<br/><br/>        counts = agg['count'].values<br/>        mean = agg['mean'].values<br/><br/>        # Iterate over each row<br/>        for i in range(1, 9): # design regarding to the length of the k-fold<br/>          for index, row in df.iterrows():<br/><br/>              # Get the category and target value<br/>              if row["kfold"] != i:<br/>                  category = row[objek]<br/>                  target_val = row[target]<br/><br/>                  # Get the count from agg<br/>                  count_agg = agg[(agg[objek] == category)]['count'].values<br/>                  if len(count_agg) &gt; 0:<br/>                      df.at[index, f"countperobject_{objek}"] = count_agg[0]<br/><br/>                  # Get the mean from agg<br/>                  mean_agg = agg[(agg[objek] == category)]['mean'].values<br/>                  if len(mean_agg) &gt; 0:<br/>                      df.at[index, f"meanperobject_{objek}"] = mean_agg[0]<br/><br/>        # Now find the weighted mean<br/>        df[f"weightedmean_{objek}"] = ((df[f"countperobject_{objek}"] * df[f"meanperobject_{objek}"]) + (weight * global_mean))/(weight + df[f"countperobject_{objek}"])<br/><br/>  encoding_maps = {}<br/>  for objek in obj:<br/>      encoding_maps[objek] = df.groupby(objek)[[f"countperobject_{objek}", f"meanperobject_{objek}"]].mean().to_dict()<br/><br/>  return df, encoding_maps</span></pre><p id="2d04" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Now with plotting the same formula into each of the categorical labels, the outcome would look like Fig 7.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj py"><img src="../Images/caa8f4225cb974b9f4c5cf1c46d4c84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZ1PALUTOiJ_aFdFGg8i9A.jpeg"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Fig 7. K-Fold Target Encoding Final Result (Both Means). [1]</figcaption></figure><p id="48ff" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">It’s important to remember that this method can be risky if there is a significant difference between your training and test datasets. For example, if AirAsia consistently produces high volumes of HC emissions in your training data, but in your test data, Garuda has the highest HC emissions distributed evenly, the model may overfit to the training pattern, leading to lower accuracy on new data.</p></div></div></div><div class="ab cb qc qd qe qf" role="separator"><span class="qg by bm qh qi qj"/><span class="qg by bm qh qi qj"/><span class="qg by bm qh qi"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="b457" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Thanks for reading this article, hope you can get a better view of what is K-Fold Target Encoding and when to use it. Go check out my social media here and help me grow a better community for future data talents!!!:</p><p id="cb6f" class="pw-post-body-paragraph ny nz fq oa b go ou oc od gr ov of og oh ow oj ok ol ox on oo op oy or os ot fj bk">Linkedin: <a class="af nb" href="https://www.linkedin.com/in/fhlpmah/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/fhlpmah/</a><br/>Dev.to: <a class="af nb" href="https://dev.to/fhlpmah" rel="noopener ugc nofollow" target="_blank">https://dev.to/fhlpmah</a><br/>Instagram: <a class="af nb" href="https://www.instagram.com/fmasmoro/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/fmasmoro/</a></p><h1 id="24c3" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">Resources</h1><p id="168c" class="pw-post-body-paragraph ny nz fq oa b go ob oc od gr oe of og oh oi oj ok ol om on oo op oq or os ot fj bk">[1] Image Made by The Author.<br/>[2] Datasets are Artificially Simulated by The Author. Inspired by: Organization ICA, 2023, <em class="qa">ICAO Aircraft Engine Emissions Databank </em><a class="af nb" href="https://www.easa.europa.eu/en/domains/environment/icao-aircraft-engine-emissions-databank" rel="noopener ugc nofollow" target="_blank">https://www.easa.europa.eu/en/domains/environment/icao-aircraft-engine-emissions-databank</a>.<br/>[3] All Codes is written by The Author.</p></div></div></div></div>    
</body>
</html>