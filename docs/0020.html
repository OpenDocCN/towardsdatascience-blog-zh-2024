<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>What Next? Exploring Graph Neural Network Recommendation Engines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>What Next? Exploring Graph Neural Network Recommendation Engines</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-next-exploring-graph-neural-network-recommendation-engines-67d6a39d8817?source=collection_archive---------7-----------------------#2024-01-04">https://towardsdatascience.com/what-next-exploring-graph-neural-network-recommendation-engines-67d6a39d8817?source=collection_archive---------7-----------------------#2024-01-04</a></blockquote><div><div class="em ff fg fh fi fj"/><div class="fk fl fm fn fo"><div class="ab cb"><div class="ci bh ew ex ey ez"><div/><div><h2 id="c0f8" class="pw-subtitle-paragraph go fq fr bf b gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd cq dx">It’s so difficult to decide what to watch next. Let’s build an AI algorithm to do it for us!</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@josephgeorgelewis2000?source=post_page---byline--67d6a39d8817--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Joseph George Lewis" class="l ep by dd de cx" src="../Images/2d7c47bd9a323dd0f4a6b610e7fb08fd.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*yqpjcZquA54GshI5QdQO_w.jpeg"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--67d6a39d8817--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://medium.com/@josephgeorgelewis2000?source=post_page---byline--67d6a39d8817--------------------------------" rel="noopener follow">Joseph George Lewis</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--67d6a39d8817--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">11 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jan 4, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk ld le ab q ee lf lg" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lc"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count lb lc">2</span></p></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lh k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al li an ao ap ie lj lk ll" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lm cn"><div class="l ae"><div class="ab cb"><div class="ln lo lp lq lr ls ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al li an ao ap ie lt lu lg lv lw lx ly lz s ma mb mc md me mf mg u mh mi mj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml mm"><img src="../Images/628ac2f367b7a6b89a76b45eab5a8607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_KvLIUahIdsuwnTe"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Photo by <a class="af nd" href="https://unsplash.com/es/@dexezekiel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dex Ezekiel</a> on <a class="af nd" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="efdd" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The recommendation of content is a common application of machine learning and artificial intelligence. This article will review a <strong class="ng fs">Graph Neural Network</strong> approach to content recommendation, using <strong class="ng fs">Link Regression</strong>. The objective is to build a content recommendation engine that <strong class="ng fs">predicts how a user would rate unseen content based on their ratings of content they have seen</strong>.</p><p id="e4c5" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">We will start with a concept review of Graph Neural Networks (GNNs) along with an introduction to <strong class="ng fs">PyTorch Geometric (PyG),</strong> a GNN package in Python. Then we will apply these concepts to a recommendation engine of our own to get AI-powered content recommendations.</p><p id="0381" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Thank you for taking the time to read and as always the code on my GitHub and useful links will be available in the references at the end of the post.</p></div></div></div><div class="ab cb oa ob oc od" role="separator"><span class="oe by bm of og oh"/><span class="oe by bm of og oh"/><span class="oe by bm of og"/></div><div class="fk fl fm fn fo"><div class="ab cb"><div class="ci bh ew ex ey ez"><p id="4609" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><strong class="ng fs">Concept Review</strong></p><p id="b939" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Let’s start with a concept review; it’s really important to understand all of the moving parts of Graph Neural Networks or GNNs before we can use one. Before we start to understand GNNs it’s most important to understand graphs! So let’s review what we mean when we talk about graphs in this context.</p><p id="d227" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><strong class="ng fs">Graph Data Structures</strong></p><p id="3a5e" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">When I talk about a graph in the context of a GNN, I am referring to a <strong class="ng fs">Graph Data Structure</strong>. This is not the same thing as a chart or a figure which is used to visualise data, as you would sometimes expect from the word ‘graph’.</p><p id="8f1f" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">It might be useful to think of graph data structures in the context of a social network. This is similar to how social media sites store data. Imagine your Facebook profile. You might be connected to your brother and your old friend from high school, and the graph data structure would look like this:</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml oi"><img src="../Images/64e0a960e7a7b6fb5a92adad3746194c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f2klt_wjl1_a3ealjQqVqA.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Image by Author</figcaption></figure><p id="62e6" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Each person is a<strong class="ng fs"> node, </strong>which just means a dot in our representation. Our nodes have characteristics like the names of the people they represent. Each connection is an <strong class="ng fs">edge</strong> and they represent a link (friendship) between two nodes.</p><p id="b812" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Now, it is no stretch for us to expand this network. Your brother may be connected to his boss. Now we have an important concept and idea. This is the idea of <strong class="ng fs">degrees of separation</strong>. We can (somewhat safely) assume that your opinions and preferences are more closely aligned with your brother than with your brother’s boss. This is simply because you are directly connected to your brother but you have to make a jump to get to his boss:</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml oj"><img src="../Images/ab5d5dec4779b6eb47abd83117d2e306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJlOsLcI0hvfvAZ0uBsd6w.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Image by Author</figcaption></figure><p id="cd85" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Now, let’s revisit that old friend from high school. We already know our nodes can have characteristics like names and ages. Let’s now build on that by giving our edges characteristics too! Let’s say the number of times you message a friend gives the edge a characteristic. We will call this the <strong class="ng fs">edge weight</strong>. In our example this may look something like this, where the edge weight is expressed in the thickness of the edge; more messages equates to a thicker line:</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml ok"><img src="../Images/3c16165fd89248a057346bf7c44cec98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4sx1MBgBUeFQ01cLlcCc1g.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Image by Author</figcaption></figure><p id="94cf" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Now that we know the weight of an edge, we can use that too in building up our idea of preference and opinion. Someone you message regularly is, again, more likely to enjoy the same things you do; that’s why you are friends! So from this example, we can not only say your brother is more like you than someone further down the line of connections, but also that you have more in common than someone else who is directly connected to you.</p><p id="3d3d" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The final complication we can add here is making our graph <strong class="ng fs">heterogenous</strong>. This is just a fancy way of saying there are two types of node. Let’s apply this example to our project and say we have people and anime:</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml ol"><img src="../Images/4e1ef7b87ccfce3983ac1c525ffd07a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tl6I7KcFRygq1Yi-4DtU1w.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Image by Author</figcaption></figure><p id="a598" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">This final graph is very close to the actual data used in this project. We can see that you and your brother both enjoyed Pokemon. Your brother also really enjoyed Attack on Titan. So in this simple graph, we can already see how an algorithm could recommend Attack on Titan to you!</p><p id="9b71" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">As we multiply this idea out we can start to see how massive graphs of data can be used to make judgments and suggestions for millions of users, so it’s no wonder why Netflix knows you want to watch The Office for the thousandth time. But it’s okay… we all do! Let’s now examine how these graph datasets are used by a neural network.</p><p id="c7d0" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><strong class="ng fs">Graph Neural Networks</strong></p><p id="7317" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Graph Neural Networks, or GNNs, are an extension of Neural Networks, in that they use Graph Data Structures or <strong class="ng fs">Geometric </strong>data instead of the typical tabular data structures used by more traditional Neural Networks. This means they are at a foundational level very similar, both have input, hidden, and output layers. Both have several different types of layers in common too including Convolutional and Linear layers that are explored here. The main difference is in how the data is treated before and during the training process.</p><p id="75e4" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">In this project, Graph SAGE is used which is a layer in the neural network. Graph SAGE among other possible options is responsible for <strong class="ng fs">message passing. </strong>This is also sometimes called <strong class="ng fs">encoding</strong>. The message-passing process just involves building an understanding of each node and edge based on its neighbors:</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml om"><img src="../Images/204ba776fd99dfc9415440eeba0c4de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ygm2QHu5yxJL4KdWpcKAQ.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Image by Author</figcaption></figure><p id="f69a" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Each node passes a message to its neighboring nodes. This gives the network an understanding of the type of users who watch this anime, as well as an understanding of the type of anime this user likes! There is a note that is particularly relevant to this point in the application section.</p><p id="09a7" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The SAGE layer is a type of <strong class="ng fs">Convolutional layer</strong>. We can compare this to a Convolutional layer in a CNN for image recognition. Instead of building an understanding of the image based on neighboring pixels, here we do it based on neighboring nodes! To get a better understanding of this process, an amazing YouTube series is recommended at the end of this article.</p><p id="dad8" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The final bit of our network is simply using a <strong class="ng fs">Linear</strong> layer to predict the rating! The linear layer works in much the same way as in other neural networks. Producing a regression that predicts the rating based on the features it has been given. We can use multiple Linear layers at the end of our network to give a set number of output neurons that represent our prediction. This concludes the concept review!</p><h2 id="4312" class="on oo fr bf op oq or os ot ou ov ow ox nn oy oz pa nr pb pc pd nv pe pf pg ph bk">Application of GNN using PyTorch Geometric</h2><p id="455d" class="pw-post-body-paragraph ne nf fr ng b gp pi ni nj gs pj nl nm nn pk np nq nr pl nt nu nv pm nx ny nz fk bk">The practical application of this project follows along with the PyTorch Geometric example for link regression and applies it to the anime dataset. A link to the PyTorch Geometric code is given at the end of the article.</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml pn"><img src="../Images/f2ee4640fe9c6cc1a4e93dd6a4c3a2c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_wI_J2a5Neht-gKa"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Photo by <a class="af nd" href="https://unsplash.com/@akin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Akin Cakiner</a> on <a class="af nd" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b15a" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Now let’s stop sitting around and get building!</p><p id="0f03" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The data used for the project comes from Kaggle and is based on user ratings of various anime. The dataset has been sampled with 6,000 unique users and their ratings of different anime taken. The data is sampled due to limited training resources which may affect the accuracy of the model. Future work could see increased resources used to train this model.</p><p id="63fc" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Some visualizations are given below to get a quick understanding of the dataset as well as some features of the anime that may affect user ratings:</p></div></div><div class="ms"><div class="ab cb"><div class="ln po lo pp lp pq cf pr cg ps ci bh"><div class="mn mo mp mq mr ab kf"><figure class="lc ms pt pu pv pw px paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><img src="../Images/a4541ed0f570ea16edf9ddd6f3446587.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*DYKCHW6hLTuBLMqwCtWFVA.png"/></div></figure><figure class="lc ms py pu pv pw px paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><img src="../Images/fdf9c4015c1a42c8f2f02c5f03f1742f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*_V1uL-h8eqONtbVBFbQFeA.png"/></div><figcaption class="my mz na mk ml nb nc bf b bg z dx pz ed qa qb">Source: Images by Author</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ew ex ey ez"><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml qc"><img src="../Images/db8db24379ea1c197b381a796f9c1961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NusyjVdoXi1VviOhoxOsyQ.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Images by Author</figcaption></figure><p id="b92e" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The scatter plot gives a sense of scale as to just how many individual pieces of content we are dealing with!</p><p id="70ce" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><strong class="ng fs">Feature Engineering</strong></p><p id="dbb2" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The features above that seem to affect average ratings the most are the type of anime (Movie, Series, etc…) and the genre (Action, Comedy, etc…). These will be used as node features in the network. The code for this step is given below. The features are taken into tensors and then concatenated along the same axis so that each node has features related to its type and genre:</p><figure class="mn mo mp mq mr ms"><div class="qd ip l ed"><div class="qe qf l"/></div></figure><p id="58ee" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">These node features will be useful, however, we can also extract an additional feature the title of the anime. To do this, a <strong class="ng fs">sentence transformer</strong> is used to generate an embedding of the title. This embedding is also used as a feature:</p><figure class="mn mo mp mq mr ms"><div class="qd ip l ed"><div class="qe qf l"/></div></figure><p id="93ef" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">This embedding based on the anime title might be a useful feature, as the network could pick up on users rating content similarly based on the name. For example, users who like “Pokemon: X and Y” might also like “Pokemon: Diamond and Pearl”. The embeddings for each would also be similar.</p><p id="361e" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><strong class="ng fs">Building a Graph Dataset</strong></p><p id="edd0" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The feature selected above will allow the network to learn about how users interact with different types, genres, and titles of anime. The network can use these features to make better predictions. It is also possible to use user-features but for simplicity, we will just give the anime features. It is important to note that both users and anime will be nodes in our graph dataset. The code to build this object is quite complicated; the first step involves building a sequential set of IDs for users and anime and mapping those back onto the original data. The next step shown in the code below involves using those mappings to build the PyTorch data object:</p><figure class="mn mo mp mq mr ms"><div class="qd ip l ed"><div class="qe qf l"/></div></figure><p id="0e89" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><em class="qg">Note: In building our graph dataset, we make it Undirected. So each user is rating an anime with a rating label, but each anime is also rating a user with the same label. This is so that the message-passing step allows each node to learn about itself and all of its connections. This may not be appropriate in all applications but here it enables the graph to understand more about the type of users who watch this anime and the type of anime this user enjoys.</em></p><p id="6d09" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><strong class="ng fs">Building a Graph Neural Network</strong></p><p id="190e" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">For those familiar with PyTorch, the Geometric equivalent will look very similar. This application uses three different objects:</p><ul class=""><li id="bd66" class="ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz qh qi qj bk">GNN Encoder — Use SageConv layers to encode graph features with message passing.</li><li id="5735" class="ne nf fr ng b gp qk ni nj gs ql nl nm nn qm np nq nr qn nt nu nv qo nx ny nz qh qi qj bk">The Edge decoder — Use Linear layers to decode the edges and predict the ratings.</li><li id="8736" class="ne nf fr ng b gp qk ni nj gs ql nl nm nn qm np nq nr qn nt nu nv qo nx ny nz qh qi qj bk">Model class — combines the above two objects and defines the overall training process of encoding/decoding.</li></ul><p id="293a" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Each of the encoder and decoder objects implements just two functions:</p><ul class=""><li id="804d" class="ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz qh qi qj bk">An init function — Defines the structure of the layers.</li><li id="f0ec" class="ne nf fr ng b gp qk ni nj gs ql nl nm nn qm np nq nr qn nt nu nv qo nx ny nz qh qi qj bk">A forward function — Defines the transformations taken on the input to the layers.</li></ul><p id="9a8d" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">A graphical representation of our network would look something like this:</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml qp"><img src="../Images/75c69fc5d44f97ba0bc3f9cdd30b27f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fIKflfq_72T_uLzP9Fm3pw.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Image by Author</figcaption></figure><p id="b642" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">This is a good chance to review why the GNN is so good for Graph data structures:</p><ul class=""><li id="3e0b" class="ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz qh qi qj bk">The input layer (Sage CONV) has no fixed input size so a graph of any size can be used to build that embedding</li><li id="99f1" class="ne nf fr ng b gp qk ni nj gs ql nl nm nn qm np nq nr qn nt nu nv qo nx ny nz qh qi qj bk">Once the embedding of the graph is built through the message passing layers (Graph SAGE One and Two) more traditional layers like Linear layers can be used</li></ul><p id="e3ac" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">In code, this is:</p><figure class="mn mo mp mq mr ms"><div class="qd ip l ed"><div class="qe qf l"/></div></figure><p id="e51f" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">The final step is building out the training process. In this example, I have chosen to use the RMSE measure for loss. This code is fairly standard for training neural networks in PyTorch so please check the documentation or leave a comment if you would be interested in a more detailed article on this:</p><figure class="mn mo mp mq mr ms"><div class="qd ip l ed"><div class="qe qf l"/></div></figure><p id="8210" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Once the training process is defined we begin to train the model.</p><p id="a9d8" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk"><strong class="ng fs">Evaluating the model</strong></p><p id="ec7b" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Before the model is evaluated it is important to highlight one drawback of the dataset. That is the ratings provided are actually ordinal given at absolute values i.e. 0, 1, 2, … so strictly speaking a regression isn’t the most appropriate decision. In a real-world scenario, this may be a problem but for this project, we will stick with the regression approach and round our values at the end.</p><p id="f70d" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Before evaluating it is important we use our unseen test data to make final judgments on the model. It is also important in this case that we clamp our predictions so that the model only predicts between 0 and 10 the available values for users rating anime:</p><figure class="mn mo mp mq mr ms"><div class="qd ip l ed"><div class="qe qf l"/></div></figure><p id="6c06" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">When evaluating the model we used the Root Mean Square Error (RMSE) in predictions. On assessing the model we can see that the overall RMSE (on unseen test data) was 1.23.</p><p id="3c9d" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">We can review what this looks like across each different actual rating using the charts below:</p><figure class="mn mo mp mq mr ms mk ml paragraph-image"><div role="button" tabindex="0" class="mt mu ed mv bh mw"><div class="mk ml qq"><img src="../Images/1afb0535b53d4335b9bf4ecb2072b2ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xoOiRMPQJ-IjKCBmhKv23g.png"/></div></div><figcaption class="my mz na mk ml nb nc bf b bg z dx">Source: Image by Author</figcaption></figure><p id="b752" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Not very many anime had below a five rating so given that training samples were more scarce, the model had a hard time predicting an accurate low score. That being said, the higher ratings were commonly predicted correctly. Particularly around an 8 target rating where the model seemed to estimate the most correct ratings.</p><p id="44fe" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">In a deployed product, the model would make estimates and then return either these raw scores to users, or in some cases we could see a threshold set. For example, if the model predicts you will rate content at a 7 or above, then the algorithm will recommend that you watch the anime.</p><p id="fdf7" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">There are also future recommendations for a project like this. For example, exploring the use of link prediction instead of link regression or even link classification. There is also a suggestion that more of the training data, hyperparameter tuning or other boosted learning methods could be used, however, that was outside of the resource limits for me! Until then I’ve got lots of great new content recommendations to get on with thanks to my Graph Neural Network!</p></div></div></div><div class="ab cb oa ob oc od" role="separator"><span class="oe by bm of og oh"/><span class="oe by bm of og oh"/><span class="oe by bm of og"/></div><div class="fk fl fm fn fo"><div class="ab cb"><div class="ci bh ew ex ey ez"><p id="c98b" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">This concludes the exploration of graph neural networks as recommendation engines. Throughout this project, I’ve learned a lot about graph data structures as well as GNNs. There is also a lot more to learn so please stick around for a future article where I will explore explainable AI using this codebase and the Captum Python Package.</p><h2 id="fe16" class="on oo fr bf op oq or os ot ou ov ow ox nn oy oz pa nr pb pc pd nv pe pf pg ph bk">References</h2><p id="68c0" class="pw-post-body-paragraph ne nf fr ng b gp pi ni nj gs pj nl nm nn pk np nq nr pl nt nu nv pm nx ny nz fk bk">Code:</p><div class="qr qs qt qu qv qw"><a href="https://github.com/josephlewisjgl/GNNRecommender?source=post_page-----67d6a39d8817--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qx ab ih"><div class="qy ab co cb qz ra"><h2 class="bf fs hx z ip rb ir is rc iu iw fq bk">GitHub - josephlewisjgl/GNNRecommender: Bootstrapped tutorial from PyTorch Geometric. Using anime…</h2><div class="rd l"><h3 class="bf b hx z ip rb ir is rc iu iw dx">Bootstrapped tutorial from PyTorch Geometric. Using anime dataset to build recommendations. - GitHub …</h3></div><div class="re l"><p class="bf b dy z ip rb ir is rc iu iw dx">github.com</p></div></div><div class="rf l"><div class="rg l rh ri rj rf rk ls qw"/></div></div></a></div><p id="db4e" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Dataset (licensed in the Public Domain, CC0 <a class="af nd" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank">https://creativecommons.org/publicdomain/zero/1.0/</a>):</p><div class="qr qs qt qu qv qw"><a href="https://www.kaggle.com/datasets/CooperUnion/anime-recommendations-database?source=post_page-----67d6a39d8817--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qx ab ih"><div class="qy ab co cb qz ra"><h2 class="bf fs hx z ip rb ir is rc iu iw fq bk">Anime Recommendations Database</h2><div class="rd l"><h3 class="bf b hx z ip rb ir is rc iu iw dx">Recommendation data from 76,000 users at myanimelist.net</h3></div><div class="re l"><p class="bf b dy z ip rb ir is rc iu iw dx">www.kaggle.com</p></div></div><div class="rf l"><div class="rl l rh ri rj rf rk ls qw"/></div></div></a></div><p id="cd14" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">YouTube Explainer series on GNNs: <a class="af nd" href="https://www.youtube.com/watch?v=fOctJB4kVlM" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=fOctJB4kVlM</a></p><p id="683d" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">PyTorch Geometric Docs:</p><div class="qr qs qt qu qv qw"><a href="https://pytorch-geometric.readthedocs.io/en/latest/index.html?source=post_page-----67d6a39d8817--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qx ab ih"><div class="qy ab co cb qz ra"><h2 class="bf fs hx z ip rb ir is rc iu iw fq bk">PyG Documentation - pytorch_geometric documentation</h2><div class="rd l"><h3 class="bf b hx z ip rb ir is rc iu iw dx">It consists of various methods for deep learning on graphs and other irregular structures, also known as geometric deep…</h3></div><div class="re l"><p class="bf b dy z ip rb ir is rc iu iw dx">pytorch-geometric.readthedocs.io</p></div></div></div></a></div><p id="7a08" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">PyTorch Geometric Link Regression Example:</p><div class="qr qs qt qu qv qw"><a href="https://colab.research.google.com/drive/1N3LvAO0AXV4kBPbTMX866OwJM9YS6Ji2?usp=sharing&amp;source=post_page-----67d6a39d8817--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qx ab ih"><div class="qy ab co cb qz ra"><h2 class="bf fs hx z ip rb ir is rc iu iw fq bk">Google Colaboratory</h2><div class="rd l"><h3 class="bf b hx z ip rb ir is rc iu iw dx">Edit description</h3></div><div class="re l"><p class="bf b dy z ip rb ir is rc iu iw dx">colab.research.google.com</p></div></div><div class="rf l"><div class="rm l rh ri rj rf rk ls qw"/></div></div></a></div><p id="9f85" class="pw-post-body-paragraph ne nf fr ng b gp nh ni nj gs nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz fk bk">Sage Conv Medium Article from <span class="ib"><span class="ib" aria-hidden="false"><a class="rn ic ro" href="https://medium.com/u/e1ffb7719884?source=post_page---user_mention--67d6a39d8817--------------------------------" rel="noopener" target="_blank">Sahil Sheikh</a></span></span>:</p><div class="qr qs qt qu qv qw"><a href="https://medium.com/@sheikh.sahil12299/exploring-sageconv-a-powerful-graph-neural-network-architecture-44b7974b1fe0?source=post_page-----67d6a39d8817--------------------------------" rel="noopener follow" target="_blank"><div class="qx ab ih"><div class="qy ab co cb qz ra"><h2 class="bf fs hx z ip rb ir is rc iu iw fq bk">Exploring SageConv: A Powerful Graph Neural Network Architecture</h2><div class="rd l"><h3 class="bf b hx z ip rb ir is rc iu iw dx">Graph Neural Networks (GNNs) are a class of deep learning models that are designed to operate on graph-structured data…</h3></div><div class="re l"><p class="bf b dy z ip rb ir is rc iu iw dx">medium.com</p></div></div><div class="rf l"><div class="rp l rh ri rj rf rk ls qw"/></div></div></a></div></div></div></div></div>    
</body>
</html>