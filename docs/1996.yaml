- en: 'Real world Use Cases: Forecasting Service Utilization Using Tabnet and Optuna'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 真实世界的应用案例：使用 Tabnet 和 Optuna 进行服务利用率预测
- en: 原文：[https://towardsdatascience.com/real-world-use-cases-forecasting-service-utilization-using-tabnet-and-optuna-26308db615c3?source=collection_archive---------8-----------------------#2024-08-15](https://towardsdatascience.com/real-world-use-cases-forecasting-service-utilization-using-tabnet-and-optuna-26308db615c3?source=collection_archive---------8-----------------------#2024-08-15)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/real-world-use-cases-forecasting-service-utilization-using-tabnet-and-optuna-26308db615c3?source=collection_archive---------8-----------------------#2024-08-15](https://towardsdatascience.com/real-world-use-cases-forecasting-service-utilization-using-tabnet-and-optuna-26308db615c3?source=collection_archive---------8-----------------------#2024-08-15)
- en: '![](../Images/316bd735324a679d8146caf7b72e8144.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/316bd735324a679d8146caf7b72e8144.png)'
- en: Image generated by Dall-e
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 图片由 Dall-e 生成
- en: Data science is at its best out in the real world. I intend to share insights
    from various productionized projects I have been involved in.
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据科学在实际应用中最为出色。我打算分享一些我参与的各种生产化项目中的见解。
- en: '[](https://medium.com/@hampusg?source=post_page---byline--26308db615c3--------------------------------)[![Hampus
    Gustavsson](../Images/a22f27fc40e4a612058379928d30f609.png)](https://medium.com/@hampusg?source=post_page---byline--26308db615c3--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--26308db615c3--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--26308db615c3--------------------------------)
    [Hampus Gustavsson](https://medium.com/@hampusg?source=post_page---byline--26308db615c3--------------------------------)'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@hampusg?source=post_page---byline--26308db615c3--------------------------------)[![Hampus
    Gustavsson](../Images/a22f27fc40e4a612058379928d30f609.png)](https://medium.com/@hampusg?source=post_page---byline--26308db615c3--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--26308db615c3--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--26308db615c3--------------------------------)
    [Hampus Gustavsson](https://medium.com/@hampusg?source=post_page---byline--26308db615c3--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--26308db615c3--------------------------------)
    ·7 min read·Aug 15, 2024
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: ·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--26308db615c3--------------------------------)
    ·阅读时间：7 分钟·2024年8月15日
- en: --
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: During my years working as a Data Scientist, I have met a lot of students interested
    in becoming one themselves, or newly graduated just starting out. Starting a career
    in data science, like any field, involves a steep learning curve.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在我作为数据科学家的这些年里，我遇到了许多有兴趣成为数据科学家的学生，或者是刚毕业的新手。开始数据科学的职业生涯，像任何领域一样，都需要经历一个陡峭的学习曲线。
- en: 'One, very good, question that I keep getting is: *I have learned a lot about
    the theoretical aspects of data science, but what does a real world example look
    like?*'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我经常被问到一个非常好的问题：*我已经学到了很多数据科学的理论知识，但现实世界中的例子是什么样的呢？*
- en: I want to share small pieces of work, from different projects I have been working
    on throughout my career. Even though some might be a few years old, I will only
    write about subjects which I still find relevant. I will try to keep the overarching
    picture clear and concise, so that new aspiring colleagues will get a grasp of
    what might be coming up. But I also want to stop and look into details, which
    I hope that more experienced developers might get some insights out of.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我希望分享一些小的工作片段，来自我整个职业生涯中参与的不同项目。虽然其中一些可能已有几年历史，但我只会写我仍然认为有价值的主题。我会尽量保持整体画面清晰简洁，让有志的同行能了解接下来可能会遇到的内容。但我也希望停下来深入探讨细节，期望有经验的开发者能从中获得一些启示。
- en: '**Business Case**'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '**商业案例**'
- en: Let’s now delve into the specific business case that drove this initiative.
    The team included a project manager, client stakeholders, and myself. The client
    needed a way to forecast the usage of a specific service. The reason behind this
    was resource allocation for maintaining the service and dynamic pricing. Experience
    with behaviour about the service usage was mostly kept within skilled coworkers,
    and this application was a way to be more resilient towards them retiring together
    with their knowledge. Also, the onboarding process of new hirings was thought
    to be easier with this kind of tool at hand.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们深入探讨推动这一项目的具体业务案例。团队包括项目经理、客户利益相关者和我本人。客户需要一种方法来预测特定服务的使用情况。这样做的原因是为了服务的资源分配和动态定价。关于服务使用行为的经验主要由经验丰富的同事掌握，而这个应用程序旨在增强对他们退休和相关知识流失的抵御能力。此外，使用这种工具可以使新员工的入职过程变得更加简便。
- en: '**Data and Analytical Setup**'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据和分析设置**'
- en: The data had a lot of features, both categorical and numerical. For the use
    case, there was a need to forecast the usage with a dynamical horizon, i.e. a
    need to make predictions for different periods of time into the future. There
    were also many, correlated and uncorrelated, values needed to be forecasted.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 数据包含了很多特征，包括分类特征和数值特征。在此用例中，需要预测具有动态时间范围的使用情况，即需要对未来不同时间段的使用情况进行预测。还需要预测许多相关和不相关的值。
- en: These multivariate time series made the attention mostly focused on experimenting
    with time series based models. But ultimately, Tabnet was adopted, a model that
    processes data as tabular.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这些多变量时间序列使得关注点主要集中在基于时间序列的模型实验上。但最终，Tabnet被采纳为处理表格数据的模型。
- en: There are several interesting features in the Tabnet architecture. This article
    will not delve into model details. But for the theoretical background I recommend
    doing some research. If you don’t find any good resources, I find [this article](https://medium.com/@turkishtechnology/deep-learning-with-tabnet-b881236e28c1)
    a good overview or [this paper](https://arxiv.org/abs/1908.07442) for a more in
    depth exploration.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Tabnet架构中有几个有趣的特性。本文不会深入探讨模型细节，但我建议进行一些相关的理论研究。如果找不到合适的资源，我认为[这篇文章](https://medium.com/@turkishtechnology/deep-learning-with-tabnet-b881236e28c1)是一个很好的概述，或者可以参考[这篇论文](https://arxiv.org/abs/1908.07442)进行更深入的探索。
- en: As a hyper parameter tuning framework, Optuna was used. There are also other
    frameworks in Python to use, but I have yet to find a reason not to use Optuna.
    Optuna was used as a Bayesian hyperparameter tuning, saved to disk. Other features
    utilized are early stopping and warm starting. Early stopping is used for resource
    saving purposes, not letting non promising looking trials run for too long. Warm
    starting is the ability to start from previous trials. This I find useful when
    new data arrives, and not having to start the tuning from scratch.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 作为超参数调优框架，使用了Optuna。虽然Python中还有其他框架可供选择，但我至今没有找到不使用Optuna的理由。Optuna被用作贝叶斯超参数调优，并保存到磁盘。其他功能包括提前停止和热启动。提前停止用于节省资源，防止没有前景的实验运行过长时间。热启动则是从先前的实验开始调整。我觉得当新数据到来时，这一点非常有用，可以避免从头开始调优。
- en: The initial parameter widths, will be set as recommended in the [Tabnet documentation](https://github.com/dreamquark-ai/tabnet)
    or from the parameter ranges discussed in the [Tabnet paper](https://arxiv.org/abs/1908.07442).
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 初始参数宽度将根据[Tabnet文档](https://github.com/dreamquark-ai/tabnet)中的建议或[Tabnet论文](https://arxiv.org/abs/1908.07442)中讨论的参数范围进行设置。
- en: To convey for the heteroscedastic nature of the residuals, Tabnet was implemented
    as a quantile regression model. To do this, or for implementing any model in this
    fashion, the *pinball loss function*, with suitable upper and lower quantiles,
    was used. This loss function has a skewed loss function, punishing errors unequally
    depending if they are positive or negative.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 为了表达残差的异方差性，采用了Tabnet作为分位回归模型。为此，或者说为了以这种方式实现任何模型，使用了*弹球损失函数*，并设置了适当的上下分位点。该损失函数具有偏斜性，根据误差是正值还是负值不平等地惩罚误差。
- en: '**Walkthrough with Code**'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '**代码演示**'
- en: The requirements used for these snippets are as follows.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 这些代码片段所用的要求如下。
- en: '[PRE0]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Code for defining the model.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 定义模型的代码。
- en: '[PRE1]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: As a data manipulation framework, Pandas was used. I would also recommend using
    Polars, as a more efficient framework.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 作为数据处理框架，使用了Pandas。我还推荐使用Polars，它是一个更高效的框架。
- en: 'The Tabnet implementation comes with a pre-built local and global feature importance
    attribute to the fitted model. The inner workings on this can be studied in the
    article posted previous, but as the business use case goes this serves two purposes:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: Tabnet 实现包含了预构建的局部和全局特征重要性属性，已附加到拟合模型中。这方面的内部工作可以在之前发布的文章中进行研究，但就商业用例而言，这有两个目的：
- en: Sanity check — client can validate the model.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Sanity check — 客户可以验证模型。
- en: Business insights — the model can provide new insights about the business to
    the client.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 商业洞察 — 该模型可以为客户提供关于业务的新洞察。
- en: together with the subject matter experts. In the end application, the interpretability
    was included to be displayed to the user. Due to data anonymization, there will
    not be a deep dive into interpretability in this article, but rather save it for
    a case where the true features going into the model can be discussed and displayed.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 与主题专家一起。在最终应用中，解释性被包括进来，以便展示给用户。由于数据匿名化，本篇文章不会深入探讨解释性，而是保留在能够讨论和展示模型中真实特征的案例中再进行说明。
- en: Code for the fitting and searching steps.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 拟合和搜索步骤的代码。
- en: '[PRE2]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The data are being split into a training, validation and testing set. The usage
    for the different datasets are:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 数据正在被分割为训练集、验证集和测试集。不同数据集的用途如下：
- en: Train. This is the dataset the model learns from. Consists in this project of
    80%.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练集。是模型学习的基准数据集。本项目中占数据的80%。
- en: Validation. Is the dataset Optuna calculates its metrics from, and hence the
    metric optimized for. 10% of the data for this project.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证集。是Optuna计算其指标的数据集，因此该指标是优化的目标。本项目中占数据的10%。
- en: Test. This is the dataset used to determine the true model performance. If this
    metric is not good enough, it might be worth going back to investigating other
    models. This dataset is also used to decide when it is time to stop the hyper
    parameter tuning. It is also on the basis of this dataset the KPI’s are derived
    and visualisations shared with the stakeholders.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试集。这个数据集用于确定模型的真实表现。如果该指标不够好，可能值得回去调查其他模型。这个数据集还用于决定何时停止超参数调优。KPI的推导以及与利益相关者共享的可视化图表也是基于这个数据集。
- en: One final note is that to mimic the behavior of when the model is deployed,
    as much as possible, the datasets is being split on time. This means that the
    data from the first 80% of the period goes into the training part, the next 10%
    goes into validation and the most recent 10% into testing.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 最后需要注意的是，为了尽可能模拟模型部署时的行为，数据集是按时间分割的。这意味着，周期的前80%的数据用于训练部分，接下来的10%用于验证，最近的10%用于测试。
- en: '![](../Images/457c9b60de76deafea9d022d15c28ab4.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/457c9b60de76deafea9d022d15c28ab4.png)'
- en: Illustration of time series data split. Plots created by the author.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列数据分割的示意图。图表由作者创建。
- en: For the example presented here, the trials are saved to disk. A more common
    approach is to save it to a cloud storage for better accessibility and easier
    maintenance. Optuna also comes with a UI for visualization, which can be spin
    up running the following command in the terminal.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这里展示的例子，试验结果被保存到磁盘。更常见的方法是将其保存到云存储中，以便更好地访问和更容易维护。Optuna 还附带了一个可视化的 UI，可以通过在终端中运行以下命令启动：
- en: '[PRE3]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: A manual task for sanity checking the parameter tuning, is to see how close
    to the sampling limits, the optimal parameters are. If they are reasonably far
    away from the bounds set, there is no need to look further into broadening the
    search space.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 用于 sanity check 的手动任务是查看最优参数与采样限制的接近程度。如果它们距离设置的边界合理地远，则无需进一步拓展搜索空间。
- en: An in-depth look into what is displayed from the tuning can be found [here](https://optuna-dashboard.readthedocs.io/en/latest/getting-started.html).
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 对于调优中显示的内容的深入分析，请查看[这里](https://optuna-dashboard.readthedocs.io/en/latest/getting-started.html)。
- en: And here is a visualisation of some of the results.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一些结果的可视化。
- en: '![](../Images/2aa2d5280c0f9aebe258635ec2917aba.png)![](../Images/fa264aa50a22d3afb54580c6f7c987a0.png)![](../Images/5a099d16c8bb0be766afb92ee9ce6adf.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2aa2d5280c0f9aebe258635ec2917aba.png)![](../Images/fa264aa50a22d3afb54580c6f7c987a0.png)![](../Images/5a099d16c8bb0be766afb92ee9ce6adf.png)'
- en: Visualisation of model performance. Plots created by the author.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 模型表现的可视化。图表由作者创建。
- en: '**Conclusions and client remarks.**'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**结论和客户反馈。**'
- en: The graph indicates increased uncertainty when forecasting service usage further
    into the future. This is to be expected, also confirmed by the client.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示，随着预测服务使用情况的时间延长，预测的不确定性增加。这是预期中的情况，客户也确认了这一点。
- en: As noticed, the model is having difficulties finding the spikes that are out
    of the ordinary. In the real use case, the effort was focused on looking into
    more sources of data, to see if the model could better predict these outliers.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 如所注意到的，模型在识别不寻常的峰值时遇到了困难。在实际使用案例中，努力的重点是寻找更多的数据源，看看模型是否能够更好地预测这些异常值。
- en: In the final product there was also introduced a novelty score for the data
    point predicted, using the library Deepchecks. This came out of discussions with
    the client, trying to detect data drift and also for user insights into the data.
    In another article, there will be a deep dive on how this could be developed.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在最终产品中，还引入了对预测数据点的新颖性评分，使用了Deepchecks库。这是在与客户的讨论中提出的，目的是检测数据漂移，并为用户提供数据的见解。在另一篇文章中，会深入探讨如何开发这一功能。
- en: '**Thank you for reading!**'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '**感谢阅读！**'
- en: I hope you found this article useful and/or inspiring. If you have any comments
    or question, please reach out! You can also connect with me on [LinkedIn](https://www.linkedin.com/in/hampus-gustavsson-23721a116/).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 希望你觉得这篇文章有用和/或启发。如果你有任何评论或问题，请随时联系我！你也可以在[LinkedIn](https://www.linkedin.com/in/hampus-gustavsson-23721a116/)上与我联系。
