<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>While Using RLS When Manipulating Relationships in Power BI, What Can Go Wrong?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>While Using RLS When Manipulating Relationships in Power BI, What Can Go Wrong?</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/while-using-rls-when-manipulating-relationships-in-power-bi-what-can-go-wrong-708c0996038a?source=collection_archive---------13-----------------------#2024-11-05">https://towardsdatascience.com/while-using-rls-when-manipulating-relationships-in-power-bi-what-can-go-wrong-708c0996038a?source=collection_archive---------13-----------------------#2024-11-05</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="cd10" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx"><em class="hd">When we have RLS in place, there are some restrictions when we try to manipulate Relationships. However, Microsoft’s documentation doesn’t provide many details on this topic. So, let’s dissect this. You will experience a big surprise.</em></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="he hf hg hh hi ab"><div><div class="ab hj"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@salvatorecagliari?source=post_page---byline--708c0996038a--------------------------------" rel="noopener follow"><div class="l hk hl by hm hn"><div class="l ed"><img alt="Salvatore Cagliari" class="l ep by dd de cx" src="../Images/a24b0cefab6e707cfee06cde9e857559.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/da:true/resize:fill:88:88/0*pOkUYGxmbbFyWocH"/><div class="ho by l dd de em n hp eo"/></div></div></a></div></div><div class="hq ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--708c0996038a--------------------------------" rel="noopener follow"><div class="l hr hs by hm ht"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hu cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="ho by l br hu em n hp eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hv ab q"><div class="ab q hw"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hx hy bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hz" data-testid="authorName" href="https://medium.com/@salvatorecagliari?source=post_page---byline--708c0996038a--------------------------------" rel="noopener follow">Salvatore Cagliari</a></p></div></div></div><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hx hy dx"><button class="ic id ah ai aj ak al am an ao ap aq ar ie if ig" disabled="">Follow</button></p></div></div></span></div></div><div class="l ih"><span class="bf b bg z dx"><div class="ab cn ii ij ik"><div class="il im ab"><div class="bf b bg z dx ab in"><span class="io l ih">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hz ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--708c0996038a--------------------------------" rel="noopener follow"><p class="bf b bg z ip iq ir is it iu iv iw bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="ia ib" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">7 min read</span><div class="ix iy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Nov 5, 2024</span></div></span></div></span></div></div></div><div class="ab cp iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo"><div class="h k w ea eb q"><div class="ke l"><div class="ab q kf kg"><div class="pw-multi-vote-icon ed io kh ki kj"><div class=""><div class="kk kl km kn ko kp kq am kr ks kt kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bf b dy z dx"><span class="kl">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk lb lc ab q ee ld le" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jp jq jr js jt ju jv jw jx jy jz ka kb kc kd"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap ie li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap ie ls lt le lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/5efb2e912c9c5b78fcb5e90615781dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VzERkw1eICQU3TJs"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@jcorl?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joseph Corl</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="e196" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Introduction</h1><p id="9a50" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">In DAX, when we want to manipulate Relationships between tables, we can use one of these functions:</p><ul class=""><li id="f97d" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk"><a class="af nc" href="https://learn.microsoft.com/en-us/dax/crossfilter-function-dax" rel="noopener ugc nofollow" target="_blank">CROSSFILTER()</a></li><li id="c91c" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk"><a class="af nc" href="https://learn.microsoft.com/en-us/dax/userelationship-function-dax" rel="noopener ugc nofollow" target="_blank">USERELATIONSHIP()</a></li></ul><p id="fc0b" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">We can find the following sentences in the Microsoft documentation about the interaction between these two functions and RLS:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pi"><img src="../Images/ccc119a5d33c6fedb55b68406cc69334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CaDvFfCuX0O3WiFxrb5Zeg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 1 — Part of MS Documentation about CROSSFILTER() and USERELATIONSHIP() and RLS (Figure by the Author)</figcaption></figure><p id="22d3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">While the sentence is unclear for <a class="af nc" href="https://dax.guide/crossfilter/" rel="noopener ugc nofollow" target="_blank">CROSSFILTER()</a>, it is much clearer for <a class="af nc" href="https://dax.guide/userelationship/" rel="noopener ugc nofollow" target="_blank">USERELATIONSHIP()</a>:</p><p id="fc19" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">These functions don’t work correctly when manipulating relationships between tables affected by RLS rules.</p><p id="2af5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But what does this mean?</p><p id="ffaa" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Let’s look at it in more detail.</p><h1 id="d1ea" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">The Data model and the Report</h1><p id="54c6" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">For this example, I work with the following data model:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pj"><img src="../Images/f4b854c9d0373760fad5a2d530ce9691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zhCmCz8I5L_pn9cRToO9Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 2 — Data model used for this example (Figure by the Author)</figcaption></figure><p id="e3a6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Three things are important:</p><ol class=""><li id="1e59" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pk pb pc bk">The table ‘Date’ has three Relationships to ‘Online Sales’: Order, Due, and Ship Date.</li><li id="1a6a" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pk pb pc bk">The ‘Geography’ table has Relationships to the ‘Store’ and ‘Customer’ tables, but only the Relationship to the ‘Store’ table is active.</li><li id="38fb" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pk pb pc bk">The table ‘AccessByCountry’ contains some users with an assigned country. It controls each user’s permissions.</li></ol><p id="295f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Report contains the following Visuals:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/04756c605685827204b8b44f053a5eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dject0ySKfXnVlOUoOZKJQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 3 — Report used for the Example (Figure by the Author)</figcaption></figure><p id="31d5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I added an RLS Rule to the table ‘AccessByCountry’:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pm"><img src="../Images/73383c5375272d882c77f9f0bf1277f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdMTmhNbZ57apq_XURsxig.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 4 — Add an RLS role to the table ‘AccessByCountry’ to check for the current User (Figure by the Author)</figcaption></figure><h1 id="0c08" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Manipulate the relationships</h1><p id="40b6" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I use the USERELATIONSHIP() function for two new Measures, ‘Sum Online Sales by Ship Date’ and ‘Sum Online Sales (By Customer Location)’:</p><pre class="mm mn mo mp mq pn po pp bp pq bb bk"><span id="145b" class="pr ne fq po b bg ps pt l pu pv">Sum Online Sales by Ship Date =<br/>                   CALCULATE(Sum Online Sales],<br/>                             USERELATIONSHIP('Online Sales'[ShipDate]<br/>                                            ,'Date'[Date])<br/>                             )</span></pre><p id="26f9" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">And:</p><pre class="mm mn mo mp mq pn po pp bp pq bb bk"><span id="87eb" class="pr ne fq po b bg ps pt l pu pv">Sum Online Sales (By Customer Location) = <br/>    CALCULATE([Sum Online Sales]<br/>                ,USERELATIONSHIP('Customer'[GeographyKey]<br/>                                ,'Geography'[GeographyKey])<br/>                )</span></pre><p id="e45f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This way, I activate the Disabled Relationships while calculating the Measure.</p><p id="0ed4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Later on, I will create a Measure using the CROSSFILTER() function.</p><p id="881c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now, it’s essential to understand which Measure uses which Relationship and if it’s affected by the RLS role:</p><ul class=""><li id="6eb7" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">The Measure ‘Sales by Ship Date’ manipulates the Relationship to the Date table. No RLS role is set up on either of these tables.</li><li id="18a9" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">The Measure ‘Sum Online Sales (By Customer Location)’ manipulates the relationship between ‘Customer’ and ‘Geography’.</li><li id="af42" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">The RLS role is set up on the table ‘AccessByCountry’, which filters the ‘Geography’ table.</li><li id="7043" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">The RLS indirectly filters the ‘Online Sales’ table through the ‘Store’ and ‘Customer’ tables.</li></ul><h1 id="c248" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Test Measures with RLS using USERELATIONSHIP()</h1><p id="5e3c" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Now, I test the RLS role by using the ‘View as’ feature:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pw"><img src="../Images/aceb47bca4a8b0ab3b44f9b7d0b1ee12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eEsykHwWhUmx6VHP1_VNNA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 5 — Test the RLS role using the Email-address for david2@contoso.com, which has access to Germany (Figure by the Author)</figcaption></figure><p id="18f4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As soon as I click on OK, the RLS role is activated, and I see what happens:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk px"><img src="../Images/a2e6ad32e3ffcbad7fc440e225ec54cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fLK-AmUeRiMMv6gXKFY8g.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 6 — Error for the Visual using the Measure which manipulates the relationship with the Geography table, but no error for the one using the Date table (Figure by the Author)</figcaption></figure><p id="36fd" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you can see, the Measure using the Ship Date still works, as no RLS role affects the Date table.</p><p id="27eb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">However, the measure that manipulates the relationship to the ‘Geography’ table no longer works. Please note that both functions (USERELATIONSHIP() and CROSSFILTER()) are mentioned in the error message.</p><p id="6dc6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The reason is that the USERELATIONSHIP() function has the potential to circumvent the RLS role, rendering it ineffective.</p><p id="e7e6" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This is why it is not allowed.</p><p id="10e3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Interestingly, the Measure, which manipulates the Relationships to the Date table, still works, even though the Measure still affects how the data in the ‘Online Sales’ table is filtered. Power BI recognizes that no RLS role affects the ‘Date’ table.</p><h1 id="c8de" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Test Measures with RLS using CROSSFILTER()</h1><p id="6c32" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Now, let’s try something different:</p><p id="aa93" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I want to calculate the ‘Sales by Customer Location’ percentage related to Sales in all Regions.</p><p id="f6ab" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">For this, I create the following Measure:</p><pre class="mm mn mo mp mq pn po pp bp pq bb bk"><span id="fd9b" class="pr ne fq po b bg ps pt l pu pv">% Sales vs all Customer Type = <br/>    [Sum Online Sales]<br/>    /<br/>        CALCULATE([Sum Online Sales]<br/>                ,REMOVEFILTERS(‘Geography‘)<br/>                )</span></pre><p id="457f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This is the Result:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk py"><img src="../Images/c36103ae2255ea117f09aecc0e2de986.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*MsucAmo7_LfkDSu_6S-ruw.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 7 — Result of the new Measure to get the Ratio of Sales vs all Stores from all Regions and with the Customer Type column from the Customer table (Figure by the Author)</figcaption></figure><p id="181d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This measure works without problems, even when tested with the RLS role.</p><p id="2484" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As there is only one Store in each Country and City, the result, when using the RLS Role, always returns 100%.</p><p id="2207" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Syntax above can be changed by using the <a class="af nc" href="https://dax.guide/crossfilter/" rel="noopener ugc nofollow" target="_blank">CROSSFILTER()</a> function. By setting the Relationship between the ‘Store’ and ‘Geography’ tables to None:</p><pre class="mm mn mo mp mq pn po pp bp pq bb bk"><span id="bc95" class="pr ne fq po b bg ps pt l pu pv">% Sales vs all Geographies = <br/>    [Sum Online Sales]<br/>    /<br/>        CALCULATE([Sum Online Sales]<br/>                ,CROSSFILTER('Geography'[GeographyKey]<br/>                            ,'Store'[GeographyKey]<br/>                            ,None)<br/>                )</span></pre><p id="89fe" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The result is precisely the same as before.</p><p id="65b5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But when testing the RLS role, we get a surprise:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk pz"><img src="../Images/f3682bd6123fa9643f299bb604bc2964.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*gtU9EgPGl_Gkf39TPX07DQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 8 — Result of the new Measure when testing the RLS role. (Figure by the Author)</figcaption></figure><p id="d519" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This result is weird!</p><p id="cc1d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To understand what happens, let’s add a Measure without the Division, only with the second part of the Measure above:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qa"><img src="../Images/fc06adcafae3e7e24f942a2b4e5fa2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1MhMpqv7c5QnWBI8wwZTw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 9 — Result of the Measure calculating all Sales for all Regions using CROSSFILTER() and while testing the RLS role. (Figure by the Author)</figcaption></figure><p id="cb11" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">When we add some more Measures to compare the results, we can see what happens:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qb"><img src="../Images/047dc104af5f9d04edbac89ae69f22e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npliOlHyQW6_EvDAlBV0FA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 10 — Analyzing the Results by adding more Measures and without activating the RLS testing (Figure by the Author)</figcaption></figure><p id="82ab" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you can see, the Sales for Germany calculated by the Customer’s Geography (See above for the Measure) are precisely the same as the result of the Measure, which uses CROSSFILTER() to deactivate the Relationship between Store and Geography.</p><p id="f3b5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This means the following:</p><ul class=""><li id="e0b0" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pa pb pc bk">I use CROSSFILTER() to Disable the Relationship between the tables ‘Store’ and ‘Geography’.</li><li id="74ba" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">I test the RLS role. The RLS expression filters the ‘Geography’ table.</li><li id="fc2c" class="nz oa fq ob b go pd od oe gr pe og oh oi pf ok ol om pg oo op oq ph os ot ou pa pb pc bk">Power BI detects the (inactive) relationship between ‘Geography’ and ‘Customer’ and activates it to calculate the result.</li></ul><p id="2cff" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This leads to unexpected, misleading, and wrong results, which must be avoided.</p><p id="229d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">While using USERELATIONSHIP() causes an error, using CROSSFILTER() can change the result unexpectedly.</p><p id="5eb2" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The above example is not very practical, as using REMOVEFILTER() is more straightforward. I only wanted to give you an example to show you what happens.</p><h1 id="d38c" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Solving the problem</h1><p id="e409" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">This scenario is not uncommon, although I do not recommend building a data model in this way.</p><p id="476c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In such a specific scenario, I recommend integrating the columns from the Geography table into the Store and Customer tables.</p><p id="7876" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">However, adding Relationships from the ‘AccessByCountry’ table to both tables, ‘Store’ and ‘Customer’, is impossible. This will create ambiguity, which Power BI will not allow.</p><p id="d8e9" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Therefore, I must duplicate this table and connect each of them to the two tables, ‘Store’ and ‘Customer’ individually:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qc"><img src="../Images/b6f73bbdfe2cdc3ec3187f2d365cb1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fzk57wpUeDdM_k2ECiwPxQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 11 — Modified data model (Figure by the Author)</figcaption></figure><p id="59f5" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Now, I can set up the RLS role to filter both tables. I can even set up different rules to allow separate access to the Stores and Customer’s Geographies.</p><p id="220f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I can set up my Measures as needed and manipulate the filter without restrictions.</p><p id="b0ef" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I no longer need to separate Measures, for example, by Store Geography or Customer Geography, as I must only use the columns from the correct table.</p><p id="90a4" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">OK, now I have the same content twice (Each Geography column for both tables, ‘Store’ and ‘Customer’). However, they are each in their separate table, so this shouldn’t be a problem.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qd"><img src="../Images/39510df365a038ab121e7f3fe9e4d63f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4enfgPDaVEBlIKG0EDyXw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Figure 12 — Result after remodeling and while testing the RLS role (Figure by the Author)</figcaption></figure><h1 id="9239" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Conclusion</h1><p id="6e5e" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">You must pay extra attention when using RLS roles.</p><p id="cf88" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">While using USERELATIONSHIP() and CROSSFILTER() is common in several scenarios; this can cause issues when RLS roles are set up in the data model.</p><p id="3741" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you have seen above, using them is no problem when the relationship is unaffected by any RLS role.</p><p id="5f2e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But as soon as you try to manipulate a Relationship affected by an RLS role, you can have issues, especially when using CROSSFILTER().</p><p id="6fbe" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Weirdly, you get potentially unexpected results instead of an error message. These results can be challenging to explain.</p><p id="951f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In my example, the results are OK when the (inactive) relationship between Geography and Customer is removed. The behavior shown above is specific to my data model.</p><p id="1042" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">But, as you have seen, all problems disappear with some tweaks in the data model.</p><p id="c9ea" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As I have stated multiple times in previous pieces, a good data model is the base for a good solution in Power BI.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qe"><img src="../Images/0933f1330a314ae8411b5a6c74c78d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oKTfDX23gQAPxXEE"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@jakubzerdzicki?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jakub Żerdzicki</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="b440" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">References</h1><p id="e477" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Like in my previous articles, I use the Contoso sample dataset. You can download the ContosoRetailDW Dataset for free from Microsoft <a class="af nc" href="https://www.microsoft.com/en-us/download/details.aspx?id=18279" rel="noopener ugc nofollow" target="_blank">here</a>.</p><p id="6996" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Contoso Data can be freely used under the MIT License, as described <a class="af nc" href="https://github.com/microsoft/Power-BI-Embedded-Contoso-Sales-Demo" rel="noopener ugc nofollow" target="_blank">here</a>.</p><p id="8d30" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I changed the dataset to shift the data to contemporary dates.</p><div class="qf qg qh qi qj qk"><a href="https://medium.com/@salvatorecagliari/subscribe?source=post_page-----708c0996038a--------------------------------" rel="noopener follow" target="_blank"><div class="ql ab ih"><div class="qm ab co cb qn qo"><h2 class="bf fr hx z ip qp ir is qq iu iw fp bk">Get an email whenever Salvatore Cagliari publishes.</h2><div class="qr l"><h3 class="bf b hx z ip qp ir is qq iu iw dx">Get an email whenever Salvatore Cagliari publishes. By signing up, you will create a Medium account if you don't…</h3></div><div class="qs l"><p class="bf b dy z ip qp ir is qq iu iw dx">medium.com</p></div></div><div class="qt l"><div class="qu l qv qw qx qt qy lr qk"/></div></div></a></div><p id="7090" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I make my articles accessible to everyone, even though Medium has a paywall. This allows me to earn a little for each reader, but I turn it off so you can read my pieces without cost.</p><p id="a2a0" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I write these pieces in the evenings and at the weekends, which is a lot of work.</p><p id="d582" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You can support my work through</p><p id="4348" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><a class="af nc" href="https://buymeacoffee.com/salvatorecagliari" rel="noopener ugc nofollow" target="_blank">https://buymeacoffee.com/salvatorecagliari</a></p><p id="3042" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Or scan this QR Code:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qz"><img src="../Images/e7ac062070dcd7a00dcf995ad7e95434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btH95UXO7gboS30eZMk6ug.png"/></div></figure><p id="0316" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Any support is greatly appreciated and helps me find more time to create more content for you.</p><p id="2647" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Thank you a lot.</p></div></div></div></div>    
</body>
</html>