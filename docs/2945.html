<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Building a Fantasy Football Research Agent with LangGraph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Building a Fantasy Football Research Agent with LangGraph</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-fantasy-football-research-agent-with-langgraph-ad8deb0126f1?source=collection_archive---------7-----------------------#2024-12-05">https://towardsdatascience.com/building-a-fantasy-football-research-agent-with-langgraph-ad8deb0126f1?source=collection_archive---------7-----------------------#2024-12-05</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="d4d6" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">An end-to-end guide covering integration with the Sleeper API, creation of a Streamlit UI, and deployment via AWS CDK</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://evandiewald.medium.com/?source=post_page---byline--ad8deb0126f1--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Evan Diewald" class="l ep by dd de cx" src="../Images/207d5c48363d21c0d9fb5ae3428f6363.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*gqHbPeCNrrM96gLvF40ZJw.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--ad8deb0126f1--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://evandiewald.medium.com/?source=post_page---byline--ad8deb0126f1--------------------------------" rel="noopener follow">Evan Diewald</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--ad8deb0126f1--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">9 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Dec 5, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/6164ac579dfc394bf298bcb623544676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xXwl0LlaKrjmL4nJ"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@fotograw?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dmitriy Demidov</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="87f4" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">It’s embarrassing how much time I spend thinking about my fantasy football team.</p><p id="03f6" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Managing a squad means processing a firehose of information — injury reports, expert projections, upcoming bye weeks, and favorable matchups. And it’s not just the volume of data, but the ephermerality— if your star RB tweaks a hamstring during Wednesday practice, you better not be basing lineup decisions off of Tuesday’s report.</p><p id="02c8" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This is why general-purpose chatbots like Anthropic’s Claude and OpenAI’s ChatGPT are essentially useless for fantasy football recommendations, as they are limited to a static training corpus that cuts off months, even years ago.</p><p id="d5f0" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">For instance, if we ask Claude Sonnet 3.5 who the current best running back is, we see names like Christian McCaffrey, Breece Hall, and Travis Etienne, who have had injury-ridden or otherwise disappointing seasons thus far in 2024. There is no mention of Saquon Barkley or Derrick Henry, the obvious frontrunners at this stage. (Though to Claude’s credit, it discloses its limitations.)</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj ny"><img src="../Images/6700132629c292799231a2c0c0f1580b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gh9y3w3hSE8kkn2WNuKmOw.png"/></div></div></figure><p id="7521" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Apps like <a class="af nb" href="https://www.perplexity.ai/" rel="noopener ugc nofollow" target="_blank">Perplexity</a> are more accurate because they do access a search engine with up-to-date information. However, it of course has no knowledge of my entire roster situation, the state of our league’s playoff picture, or the nuances of our keeper rules.</p><p id="705c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">There is an opportunity to tailor a fantasy football-focused <strong class="ne fr">Agent </strong>with tools and personalized context for each user.</p><p id="6d2a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Let’s dig into the implementation.</p><h2 id="9b12" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">Architecture Overview</h2><p id="8d99" class="pw-post-body-paragraph nc nd fq ne b go ou ng nh gr ov nj nk nl ow nn no np ox nr ns nt oy nv nw nx fj bk">The heart of the chatbot will be a <a class="af nb" href="https://www.langchain.com/langgraph" rel="noopener ugc nofollow" target="_blank">LangGraph</a> Agent based on the <a class="af nb" href="https://arxiv.org/abs/2210.03629" rel="noopener ugc nofollow" target="_blank">ReAct</a> framework. We’ll give it access to tools that integrate with the <a class="af nb" href="https://docs.sleeper.com/" rel="noopener ugc nofollow" target="_blank">Sleeper API</a> for common operations like checking the league standings, rosters, player stats, expert analysis, and more.</p><p id="d1de" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In addition to the LangGraph API server, our backend will include a small Postgres database and Redis cache, which are used to manage state and route requests. We’ll use <a class="af nb" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">Streamlit</a> for a simple, but effective UI.</p><p id="8e23" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">For development, we can run all of these components locally via <a class="af nb" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank">Docker Compose</a>, but I’ll also show the infrastructure-as-code (IaC) to deploy a scalable stack with <a class="af nb" href="https://docs.aws.amazon.com/cdk/api/v2/" rel="noopener ugc nofollow" target="_blank">AWS CDK</a>.</p><h2 id="67e5" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">Sleeper API Integration</h2><p id="bbfc" class="pw-post-body-paragraph nc nd fq ne b go ou ng nh gr ov nj nk nl ow nn no np ox nr ns nt oy nv nw nx fj bk"><a class="af nb" href="https://sleeper.com" rel="noopener ugc nofollow" target="_blank">Sleeper</a> graciously exposes a public, read-only API that we can tap into for user &amp; league details, including a full list of players, rosters, and draft information. Though it’s not documented explicitly, I also found some GraphQL endpoints that provide critical statistics, projections, and — perhaps most valuable of all — recent expert analysis by NFL reporters.</p><p id="f6e0" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I created a simple API client to access the various methods, which you can find <a class="af nb" href="https://github.com/evandiewald/fantasy-football-agent/blob/main/fantasy_chatbot/sleeper.py" rel="noopener ugc nofollow" target="_blank">here</a>. The one trick that I wanted to highlight is the <code class="cx oz pa pb pc b">requests-cache</code> <a class="af nb" href="https://requests-cache.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">library</a>. I don’t want to be a greedy client of Sleeper’s freely-available datasets, so I cache responses in a local Sqlite database with a basic TTL mechanism.</p><p id="92d8" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Not only does this lessen the amount redundant API traffic bombarding Sleeper’s servers (reducing the chance that they blacklist my IP address), but it significantly reduces latency for my clients, making for a better UX.</p><p id="df43" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Setting up and using the cache is dead simple, as you can see in this snippet —</p><pre class="ml mm mn mo mp pd pc pe bp pf bb bk"><span id="f4f5" class="pg oa fq pc b bg ph pi l pj pk">import requests_cache<br/>from urllib.parse import urljoin<br/>from typing import Union, Optional<br/>from pathlib import Path<br/><br/><br/>class SleeperClient:<br/>    def __init__(self, cache_path: str = '../.cache'):<br/><br/>        # config<br/>        self.cache_path = cache_path<br/>        self.session = requests_cache.CachedSession(<br/>            Path(cache_path) / 'api_cache', <br/>            backend='sqlite',<br/>            expire_after=60 * 60 * 24,<br/>        )<br/><br/>        ...<br/><br/>    def _get_json(self, path: str, base_url: Optional[str] = None) -&gt; dict:<br/>        url = urljoin(base_url or self.base_url, path)<br/>        return self.session.get(url).json()<br/><br/>    def get_player_stats(self, player_id: Union[str, int], season: Optional[int] = None, group_by_week: bool = False):<br/>        return self._get_json(<br/>            f'stats/nfl/player/{player_id}?season_type=regular&amp;season={season or self.nfl_state["season"]}{"&amp;grouping=week" if group_by_week else ""}',<br/>            base_url=self.stats_url,<br/>        )</span></pre><p id="5f7f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">So running something like</p><p id="1beb" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><code class="cx oz pa pb pc b">self.session.get(url)</code></p><p id="2afe" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">first checks the local Sqlite cache for an unexpired response that particular request. If it’s found, we can skip the API call and just read from the database.</p><h2 id="0291" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">Defining the Tools</h2><p id="27ad" class="pw-post-body-paragraph nc nd fq ne b go ou ng nh gr ov nj nk nl ow nn no np ox nr ns nt oy nv nw nx fj bk">I want to turn the Sleeper API client into a handful of key functions that the Agent can use to inform its responses. Because these functions will effectively be invoked by the LLM, I find it important to annotate them clearly and ask for simple, flexible arguments.</p><p id="ce52" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">For example, Sleeper’s API’s generally ask for numeric player id’s, which makes sense for a programmatic interface. However, I want to abstract that concept away from the LLM and just have it input player names for these functions. To ensure some additional flexibility and allow for things like typos, I implemented a basic “<a class="af nb" href="https://github.com/rapidfuzz/RapidFuzz" rel="noopener ugc nofollow" target="_blank">fuzzy search</a>” method to map player name searches to their associated player id.</p><pre class="ml mm mn mo mp pd pc pe bp pf bb bk"><span id="41a5" class="pg oa fq pc b bg ph pi l pj pk"># file: fantasy_chatbot/league.py<br/><br/>def get_player_id_fuzzy_search(self, player_name: str) -&gt; tuple[str, str]:<br/>  # will need a simple search engine to go from player name to player id without needing exact matches. returns the player_id and matched player name as a tuple<br/>  nearest_name = process.extract(query=player_name, choices=self.player_names, scorer=fuzz.WRatio, limit=1)[0]<br/>  return self.player_name_to_id[nearest_name[0]], self.player_names[nearest_name[2]]<br/><br/># example usage in a tool<br/>def get_player_news(self, player_name: Annotated[str, "The player's name."]) -&gt; str:<br/>    """<br/>    Get recent news about a player for the most up-to-date analysis and injury status.<br/>    Use this whenever naming a player in a potential deal, as you should always have the right context for a recommendation.<br/>    If sources are provided, include markdown-based link(s)<br/>    (e.g. [Rotoballer](https://www.rotoballer.com/player-news/saquon-barkley-has-historic-night-sunday/1502955) )<br/>    at the bottom of your response to provide proper attribution<br/>    and allow the user to learn more.<br/>    """<br/>    player_id, player_name = self.get_player_id_fuzzy_search(player_name)<br/>    # news<br/>    news = self.client.get_player_news(player_id, limit=3)<br/>    player_news = f"Recent News about {player_name}\n\n"<br/>    for n in news:<br/>        player_news += f"**{n['metadata']['title']}**\n{n['metadata']['description']}"<br/>        if analysis := n['metadata'].get('analysis'):<br/>            player_news += f"\n\nAnalysis:\n{analysis}"<br/>        if url := n['metadata'].get('url'):<br/>            # markdown link to source<br/>            player_news += f"\n[{n['source'].capitalize()}]({url})\n\n"<br/><br/>   return player_news</span></pre><p id="71ab" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This is better than a simple map of name to player id because it allows for misspellings and other typos, e.g. <code class="cx oz pa pb pc b">saquon</code> → <code class="cx oz pa pb pc b">Saquon Barkley</code></p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj pl"><img src="../Images/091f3735f1f8c100a869129af236093f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*X8IWaGUOARHnmS5CUnGQ4w.png"/></div></figure><p id="ca9e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I created a number of useful tools based on these principles:</p><ul class=""><li id="9c1a" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pm pn po bk">Get League Status (standings, current week, no. playoff teams, etc.)</li><li id="3e17" class="nc nd fq ne b go pp ng nh gr pq nj nk nl pr nn no np ps nr ns nt pt nv nw nx pm pn po bk">Get Roster for Team Owner</li><li id="5be8" class="nc nd fq ne b go pp ng nh gr pq nj nk nl pr nn no np ps nr ns nt pt nv nw nx pm pn po bk">Get Player News (up-to-date articles / analysis about the player)</li><li id="7585" class="nc nd fq ne b go pp ng nh gr pq nj nk nl pr nn no np ps nr ns nt pt nv nw nx pm pn po bk">Get Player Stats (weekly points scored this season with matchups)</li><li id="46e8" class="nc nd fq ne b go pp ng nh gr pq nj nk nl pr nn no np ps nr ns nt pt nv nw nx pm pn po bk">Get Player Current Owner (critical for proposing trades)</li><li id="cb8a" class="nc nd fq ne b go pp ng nh gr pq nj nk nl pr nn no np ps nr ns nt pt nv nw nx pm pn po bk">Get Best Available at Position (the waiver wire)</li><li id="71dc" class="nc nd fq ne b go pp ng nh gr pq nj nk nl pr nn no np ps nr ns nt pt nv nw nx pm pn po bk">Get Player Rankings (performance so far, broken down by position)</li></ul><p id="4bdb" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">You can probably think of a few more functions that would be useful to add, like details about recent transactions, league head-to-heads, and draft information.</p><h2 id="7ada" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">LangGraph Agent</h2><p id="1e1a" class="pw-post-body-paragraph nc nd fq ne b go ou ng nh gr ov nj nk nl ow nn no np ox nr ns nt oy nv nw nx fj bk">The impetus for this entire project was an opportunity to learn the LangGraph ecosystem, which may be becoming the de facto standard for constructing agentic workflows.</p><p id="1aa1" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I’ve hacked together agents from scratch in the past, and I wish I had known about LangGraph at the time. It’s not just a thin wrapper around the various LLM providers, it provides immense utility for building, deploying, &amp; monitoring complex workflows. I’d encourage you to check out the <a class="af nb" href="https://academy.langchain.com/courses/intro-to-langgraph" rel="noopener ugc nofollow" target="_blank">Introduction to LangGraph</a> course by LangChain Academy if you’re interested in diving deeper.</p><p id="9ad9" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">As mentioned before, the graph itself is based on the ReAct framework, which is a popular and effective way to get LLM’s to interact with external tools like those defined above.</p><p id="eca6" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I’ve also added a node to persist long-term memories about each user, so that information can be persisted across sessions. I want our agent to “remember” things like users’ concerns, preferences, and previously-recommended trades, as this is not a feature that is implemented particularly well in the chatbots I’ve seen. In graph form, it looks like this:</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj pu"><img src="../Images/436f6bbcdcdf128744ef4cb4a3d1ecaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*ZzlpGPazE96e54VDG3mEdw.png"/></div></figure><p id="4213" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Pretty simple right? Again, you can checkout the full graph definition in the <a class="af nb" href="https://github.com/evandiewald/fantasy-football-agent/blob/main/fantasy_chatbot/chatbot.py" rel="noopener ugc nofollow" target="_blank">code</a>, but I’ll highlight the <code class="cx oz pa pb pc b">write_memory</code> node, which is responsible for writing &amp; updating a profile for each user. This allows us to track key interactions while being efficient about token use.</p><pre class="ml mm mn mo mp pd pc pe bp pf bb bk"><span id="c8ee" class="pg oa fq pc b bg ph pi l pj pk">def write_memory(state: MessagesState, config: RunnableConfig, store: BaseStore):<br/>    """Reflect on the chat history and save a memory to the store."""<br/><br/>    # get the username from the config<br/>    username = config["configurable"]["username"]<br/><br/>    # retrieve existing memory if available<br/>    namespace = ("memory", username)<br/>    existing_memory = store.get(namespace, "user_memory")<br/><br/>    # format the memories for the instruction<br/>    if existing_memory and existing_memory.value:<br/>        memory_dict = existing_memory.value<br/>        formatted_memory = (<br/>            f"Team Name: {memory_dict.get('team_name', 'Unknown')}\n"<br/>            f"Current Concerns: {memory_dict.get('current_concerns', 'Unknown')}"<br/>            f"Other Details: {memory_dict.get('other_details', 'Unknown')}"<br/>        )<br/>    else:<br/>        formatted_memory = None<br/><br/>    system_msg = CREATE_MEMORY_INSTRUCTION.format(memory=formatted_memory)<br/><br/>    # invoke the model to produce structured output that matches the schema<br/>    new_memory = llm_with_structure.invoke([SystemMessage(content=system_msg)] + state['messages'])<br/><br/>    # overwrite the existing user profile<br/>    key = "user_memory"<br/>    store.put(namespace, key, new_memory)</span></pre><p id="922e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">These memories are surfaced in the <a class="af nb" href="https://github.com/evandiewald/fantasy-football-agent/blob/main/fantasy_chatbot/prompts.py" rel="noopener ugc nofollow" target="_blank">system prompt</a>, where I also gave the LLM basic details about our league and how I want it to handle common user requests.</p><h2 id="71f2" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">Streamlit UI and Demo</h2><p id="7f82" class="pw-post-body-paragraph nc nd fq ne b go ou ng nh gr ov nj nk nl ow nn no np ox nr ns nt oy nv nw nx fj bk">I’m not a frontend developer, so the UI leans heavily on Streamlit’s components and familiar chatbot patterns. Users input their Sleeper username, which is used to lookup their available leagues and persist memories across threads.</p><p id="2605" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I also added a couple of bells and whistles, like implementing token streaming so that users get instant feedback from the LLM. The other important piece is a “research pane”, which surfaces the results of the Agent’s tool calls so that user can inspect the raw data that informs each response.</p><p id="ce19" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Here’s a quick demo.</p><figure class="ml mm mn mo mp mq"><div class="pv io l ed"><div class="pw px l"/></div></figure><h2 id="a78c" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">Deployment</h2><p id="4e52" class="pw-post-body-paragraph nc nd fq ne b go ou ng nh gr ov nj nk nl ow nn no np ox nr ns nt oy nv nw nx fj bk">For development, I recommend deploying the components locally via the provided <code class="cx oz pa pb pc b">docker-compose.yml</code> file. This will expose the API locally at <code class="cx oz pa pb pc b">http://localhost:8123</code> , so you can rapidly test changes and connect to it from a local Streamlit app.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj py"><img src="../Images/5afeba0c67645f244863f81be5d72e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNzcdUCzn2wLWZ0MFLZexQ.png"/></div></div></figure><p id="5749" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I have also included IaC for an AWS CDK-based deployment that I use to host the app on the internet. Most of the resources are defined <a class="af nb" href="https://github.com/evandiewald/fantasy-football-agent/blob/main/deploy/lib/fantasy-football-agent-stack.ts" rel="noopener ugc nofollow" target="_blank">here</a>. Notice the parallels between the <code class="cx oz pa pb pc b">docker-compose.yml</code> and the CDK code related to the ECS setup:</p><p id="6cbe" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Snippet from <code class="cx oz pa pb pc b">docker-compose.yml</code> for the LangGraph API container:</p><pre class="ml mm mn mo mp pd pc pe bp pf bb bk"><span id="0a49" class="pg oa fq pc b bg ph pi l pj pk"># from docker-compose.yml<br/><br/>langgraph-api:<br/>    image: "fantasy-chatbot"<br/>    ports:<br/>        - "8123:8000"<br/>    healthcheck:<br/>        test: curl --request GET --url http://localhost:8000/ok<br/>        timeout: 1s<br/>        retries: 5<br/>        interval: 5s<br/>    depends_on:<br/>        langgraph-redis:<br/>            condition: service_healthy<br/>        langgraph-postgres:<br/>            condition: service_healthy<br/>    env_file: "../.env"<br/>    environment:<br/>        REDIS_URI: redis://langgraph-redis:6379<br/>        POSTGRES_URI: postgres://postgres:postgres@langgraph-postgres:5432/postgres?sslmode=disable// file: fantasy-football-agent-stack.ts</span></pre><p id="5329" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">And here is the analogous setup in the CDK stack:</p><pre class="ml mm mn mo mp pd pc pe bp pf bb bk"><span id="32c7" class="pg oa fq pc b bg ph pi l pj pk">// fantasy-football-agent-stack.ts<br/><br/>const apiImageAsset = new DockerImageAsset(this, 'apiImageAsset', {<br/>  directory: path.join(__dirname, '../../fantasy_chatbot'),<br/>  file: 'api.Dockerfile',<br/>  platform: assets.Platform.LINUX_AMD64,<br/>});<br/>const apiContainer = taskDefinition.addContainer('langgraph-api', {<br/>  containerName: 'langgraph-api',<br/>  image: ecs.ContainerImage.fromDockerImageAsset(apiImageAsset),<br/>  portMappings: [{<br/>    containerPort: 8000,<br/>  }],<br/>  environment: {<br/>    ...dotenvMap,<br/>    REDIS_URI: 'redis://127.0.0.1:6379',<br/>    POSTGRES_URI: 'postgres://postgres:postgres@127.0.0.1:5432/postgres?sslmode=disable'<br/>  },<br/>  logging: ecs.LogDrivers.awsLogs({<br/>    streamPrefix: 'langgraph-api',<br/>  }),<br/>});<br/><br/>apiContainer.addContainerDependencies(<br/>  {<br/>    container: redisContainer,<br/>    condition: ecs.ContainerDependencyCondition.HEALTHY,<br/>  },<br/>  {<br/>    container: postgresContainer,<br/>    condition: ecs.ContainerDependencyCondition.HEALTHY,<br/>  },<br/>)</span></pre><p id="e961" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Aside from some subtle differences, it’s effectively a 1:1 translation, which is always something I look for when comparing local environments to “prod” deployments. The <code class="cx oz pa pb pc b">DockerImageAsset</code> is a particularly useful resource, as it handles building and deploying (to ECR) the Docker image during synthesis.</p><blockquote class="pz qa qb"><p id="2945" class="nc nd qc ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">Note: </strong>Deploying the stack to your AWS account via <code class="cx oz pa pb pc b">npm run cdk deploy</code> WILL incur charges. In this demo code I have not included any password protection on the Streamlit app, meaning anyone who has the URL can use the chatbot! I highly recommend adding some additional security if you plan to deploy it yourself.</p></blockquote><h2 id="294f" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">Takeaways</h2><p id="f283" class="pw-post-body-paragraph nc nd fq ne b go ou ng nh gr ov nj nk nl ow nn no np ox nr ns nt oy nv nw nx fj bk"><strong class="ne fr">You want to keep your tools simple</strong>. This app does a lot, but is still missing some key functionality, and it will start to break down if I simply add more tools. In the future, I want to break up the graph into task-specific sub-components, e.g. a “News Analyst” Agent and a “Statistician” Agent.</p><p id="fa9e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">Traceability and debugging are more important with Agent-based apps than traditional software</strong>. Despite significant advancements in models’ ability to produce structured outputs, LLM-based function calling is still inherently less reliable than conventional programs. I used LangSmith extensively for debugging.</p><p id="6a34" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">In an age of commoditized language models, there is no replacement for reliable reporters.</strong> We’re at a point where you can put together a reasonable chatbot in a weekend, so how do products differentiate themselves and build moats? This app (or any other like it) would be useless without access to high-quality reporting from analysts and experts. In other words, the Ian Rapaport’s and Matthew Berry’s of the world are more valuable than ever.</p><h2 id="9396" class="nz oa fq bf ob oc od oe of og oh oi oj nl ok ol om np on oo op nt oq or os ot bk">Repo</h2><div class="qd qe qf qg qh qi"><a href="https://github.com/evandiewald/fantasy-football-agent/tree/main?source=post_page-----ad8deb0126f1--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="qj ab ig"><div class="qk ab co cb ql qm"><h2 class="bf fr hw z io qn iq ir qo it iv fp bk">GitHub - evandiewald/fantasy-football-agent</h2><div class="qp l"><h3 class="bf b hw z io qn iq ir qo it iv dx">Contribute to evandiewald/fantasy-football-agent development by creating an account on GitHub.</h3></div><div class="qq l"><p class="bf b dy z io qn iq ir qo it iv dx">github.com</p></div></div><div class="qr l"><div class="qs l qt qu qv qr qw lq qi"/></div></div></a></div><p id="0571" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><em class="qc">All images, unless otherwise noted, are by the author.</em></p></div></div></div></div>    
</body>
</html>