- en: Productionizing a RAG App with Prefect, Weave, and RAGAS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½¿ç”¨Prefectã€Weaveå’ŒRAGASå®ç°RAGåº”ç”¨çš„ç”Ÿäº§åŒ–
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/productionizing-a-rag-app-04c857e0966e?source=collection_archive---------7-----------------------#2024-08-03](https://towardsdatascience.com/productionizing-a-rag-app-04c857e0966e?source=collection_archive---------7-----------------------#2024-08-03)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/productionizing-a-rag-app-04c857e0966e?source=collection_archive---------7-----------------------#2024-08-03](https://towardsdatascience.com/productionizing-a-rag-app-04c857e0966e?source=collection_archive---------7-----------------------#2024-08-03)
- en: Adding evaluation, automated data pulling, and other improvements.
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ·»åŠ è¯„ä¼°ã€è‡ªåŠ¨åŒ–æ•°æ®æå–åŠå…¶ä»–æ”¹è¿›ã€‚
- en: '[](https://medium.com/@ed.izaguirre?source=post_page---byline--04c857e0966e--------------------------------)[![Ed
    Izaguirre](../Images/c9eded1f06c47571baa662107428483f.png)](https://medium.com/@ed.izaguirre?source=post_page---byline--04c857e0966e--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--04c857e0966e--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--04c857e0966e--------------------------------)
    [Ed Izaguirre](https://medium.com/@ed.izaguirre?source=post_page---byline--04c857e0966e--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@ed.izaguirre?source=post_page---byline--04c857e0966e--------------------------------)[![Ed
    Izaguirre](../Images/c9eded1f06c47571baa662107428483f.png)](https://medium.com/@ed.izaguirre?source=post_page---byline--04c857e0966e--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--04c857e0966e--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--04c857e0966e--------------------------------)
    [Ed Izaguirre](https://medium.com/@ed.izaguirre?source=post_page---byline--04c857e0966e--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--04c857e0966e--------------------------------)
    Â·12 min readÂ·Aug 3, 2024
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--04c857e0966e--------------------------------)
    Â·é˜…è¯»æ—¶é•¿12åˆ†é’ŸÂ·2024å¹´8æœˆ3æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/105f6f4816994872796a36639b99148d.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/105f6f4816994872796a36639b99148d.png)'
- en: From Film Search to Rosebud ğŸŒ¹. Image from Unsplash.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ä»ç”µå½±æœç´¢åˆ°â€œç«ç‘°budâ€ğŸŒ¹ã€‚å›¾ç‰‡æ¥è‡ªUnsplashã€‚
- en: '**Table of Contents**'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '**ç›®å½•**'
- en: '[Introduction](#d4f8)'
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[ä»‹ç»](#d4f8)'
- en: '[Offline Evaluation](#fdde)'
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[ç¦»çº¿è¯„ä¼°](#fdde)'
- en: '[Online Evaluation](#9988)'
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[åœ¨çº¿è¯„ä¼°](#9988)'
- en: '[Automated Data Pulling with Prefect](#690c)'
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[ä½¿ç”¨Prefectè¿›è¡Œè‡ªåŠ¨åŒ–æ•°æ®æå–](#690c)'
- en: '[Summary](#0875)'
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[æ‘˜è¦](#0875)'
- en: '**Relevant Links**'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '**ç›¸å…³é“¾æ¥**'
- en: '[GitHub repo](https://github.com/EdIzaguirre/Rosebud)'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[GitHubä»“åº“](https://github.com/EdIzaguirre/Rosebud)'
- en: '[Link to earlier article discussing Film Search, a dev version of this project](https://medium.com/towards-data-science/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad)'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[é“¾æ¥åˆ°ä¹‹å‰è®¨è®ºç”µå½±æœç´¢çš„æ–‡ç« ï¼Œè¿™æ˜¯è¯¥é¡¹ç›®çš„å¼€å‘ç‰ˆ](https://medium.com/towards-data-science/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad)'
- en: '[Try out the app](https://filmsearch.azurewebsites.net/) (now 100% free! ğŸ¤‘)'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[å°è¯•è¯¥åº”ç”¨](https://filmsearch.azurewebsites.net/)ï¼ˆç°åœ¨100%å…è´¹ï¼ğŸ¤‘ï¼‰'
- en: Introduction
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä»‹ç»
- en: 'A few months ago, I released the *Film Search* app, a Retrieval-Augmented Generation
    (RAG) application designed to recommend films based on user queries. For example,
    a user may ask: *â€œFind me drama movies in English that are less than 2 hours long
    and feature dogs.â€* and receive a recommendation like:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: å‡ ä¸ªæœˆå‰ï¼Œæˆ‘å‘å¸ƒäº†*ç”µå½±æœç´¢*åº”ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºç”¨æˆ·æŸ¥è¯¢æ¨èç”µå½±çš„æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯èƒ½ä¼šé—®ï¼šâ€œ*å¸®æˆ‘æ‰¾åˆ°å°‘äº2å°æ—¶ã€è‹±è¯­ç”µå½±å¹¶ä¸”æœ‰ç‹—çš„å‰§æƒ…ç‰‡*ã€‚â€ç„¶åä¼šæ”¶åˆ°ç±»ä¼¼çš„æ¨èï¼š
- en: 'Title of Film: Hachi: A Dogâ€™s Tale'
  id: totrans-20
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ç”µå½±æ ‡é¢˜ï¼šã€Šå¿ çŠ¬å…«å…¬çš„æ•…äº‹ã€‹
- en: ''
  id: totrans-21
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Runtime: 93 minutes'
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿è¡Œæ—¶ï¼š93åˆ†é’Ÿ
- en: 'Release Year: 2009'
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å‘è¡Œå¹´ä»½ï¼š2009
- en: 'Streaming: Not available for streaming'
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æµåª’ä½“ï¼šæ— æ³•åœ¨çº¿è§‚çœ‹
- en: This film tells the poignant true story of Hachiko, an Akita dog known for his
    remarkable loyalty to his owner. The emotional depth and the themes of friendship
    and loyalty resonate strongly, making it a touching drama that showcases the profound
    bond between humans and dogs. Itâ€™s perfect for anyone looking for a heartfelt
    story that highlights the importance of companionship.
  id: totrans-25
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è¿™éƒ¨ç”µå½±è®²è¿°äº†å¿ è¯šäºä¸»äººçš„ç§‹ç”°çŠ¬å…«å…¬çš„æ„ŸäººçœŸå®æ•…äº‹ã€‚ç”µå½±æ·±åˆ»çš„æƒ…æ„Ÿè¡¨è¾¾ä»¥åŠå‹è°Šå’Œå¿ è¯šçš„ä¸»é¢˜äº§ç”Ÿäº†å¼ºçƒˆå…±é¸£ï¼Œä½¿å…¶æˆä¸ºä¸€éƒ¨æ„Ÿäººçš„å‰§ä½œï¼Œå±•ç°äº†äººç±»ä¸ç‹—ä¹‹é—´æ·±åšçš„çº½å¸¦ã€‚å¯¹äºä»»ä½•å¯»æ±‚ä¸€æ®µçªæ˜¾é™ªä¼´é‡è¦æ€§çš„çœŸæŒšæ•…äº‹çš„äººæ¥è¯´ï¼Œè¿™éƒ¨ç”µå½±éƒ½æ˜¯å®Œç¾çš„é€‰æ‹©ã€‚
- en: ''
  id: totrans-26
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: â€¦
  id: totrans-27
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: â€¦
- en: This was not just a simple RAG app, however. It included what is known as **self-querying
    retrieval**. This means that the bot takes the userâ€™s query and transforms it
    by adding metadata filters. This ensures any documents pulled into the chat modelâ€™s
    context respects the constraints set by the userâ€™s query. For more information,
    I recommend checking out my earlier article linked above.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œè¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ RAG åº”ç”¨ã€‚å®ƒåŒ…æ‹¬äº†è¢«ç§°ä¸º **è‡ªæŸ¥è¯¢æ£€ç´¢** çš„åŠŸèƒ½ã€‚è¿™æ„å‘³ç€æœºå™¨äººä¼šè·å–ç”¨æˆ·çš„æŸ¥è¯¢ï¼Œå¹¶é€šè¿‡æ·»åŠ å…ƒæ•°æ®è¿‡æ»¤å™¨æ¥è½¬æ¢å®ƒã€‚è¿™ç¡®ä¿äº†ä»»ä½•æ‹‰å–åˆ°èŠå¤©æ¨¡å‹ä¸Šä¸‹æ–‡ä¸­çš„æ–‡æ¡£éƒ½éµå®ˆç”¨æˆ·æŸ¥è¯¢è®¾ç½®çš„çº¦æŸæ¡ä»¶ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œå»ºè®®æŸ¥é˜…æˆ‘ä¹‹å‰çš„æ–‡ç« é“¾æ¥ã€‚
- en: 'Unfortunately, there were some issues with the app:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å¹¸çš„æ˜¯ï¼Œåº”ç”¨ç¨‹åºå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š
- en: There was no offline evaluation done, besides passing the â€˜eye testâ€™. This test
    is necessary, but not sufficient.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é™¤äº†é€šè¿‡â€œçœ¼ç›æµ‹è¯•â€ä¹‹å¤–ï¼Œæ²¡æœ‰è¿›è¡Œç¦»çº¿è¯„ä¼°ã€‚è¿™ä¸ªæµ‹è¯•æ˜¯å¿…è¦çš„ï¼Œä½†ä¸è¶³å¤Ÿã€‚
- en: Observability was non-existent. If a query went poorly, you had to manually
    pull up the project and run some ad-hoc scripts in an attempt to see what went
    wrong.
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¯è§‚å¯Ÿæ€§å‡ ä¹ä¸å­˜åœ¨ã€‚å¦‚æœæŸ¥è¯¢å¤±è´¥ï¼Œä½ å¿…é¡»æ‰‹åŠ¨æ‰“å¼€é¡¹ç›®å¹¶è¿è¡Œä¸€äº›ä¸´æ—¶è„šæœ¬ï¼Œè¯•å›¾æŸ¥çœ‹å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚
- en: The Pinecone vector database had to be pulled manually. This meant the documents
    would quickly be out of date if, say, a film got pulled from a streaming service.
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pinecone å‘é‡æ•°æ®åº“å¿…é¡»æ‰‹åŠ¨æ‹‰å–ã€‚è¿™æ„å‘³ç€å¦‚æœæŸéƒ¨ç”µå½±è¢«ä»æµåª’ä½“æœåŠ¡ä¸­ä¸‹æ¶ï¼Œæ–‡æ¡£ä¼šè¿…é€Ÿè¿‡æ—¶ã€‚
- en: 'In this article, I will briefly cover some of the improvements made to the
    Film Search app. This will cover:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ç®€è¦ä»‹ç»ä¸€äº›å¯¹ç”µå½±æœç´¢åº”ç”¨ç¨‹åºæ‰€åšçš„æ”¹è¿›ã€‚å†…å®¹åŒ…æ‹¬ï¼š
- en: '**Offline Evaluation using RAGAS and Weave**'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ä½¿ç”¨ RAGAS å’Œ Weave çš„ç¦»çº¿è¯„ä¼°**'
- en: '**Online Evaluation and Observability**'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**åœ¨çº¿è¯„ä¼°ä¸å¯è§‚å¯Ÿæ€§**'
- en: '**Automated Data Pulling using Prefect**'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ä½¿ç”¨ Prefect çš„è‡ªåŠ¨åŒ–æ•°æ®æ‹‰å–**'
- en: 'One thing before we jump in: I found the name *Film Search* to be a bit generic,
    so I rebranded the app as *Rosebud* ğŸŒ¹*,* hence the image shown above. Real film
    geeks will [understand the reference](https://www.youtube.com/watch?v=O4mQqVqRB7I).'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æˆ‘ä»¬æ·±å…¥è®¨è®ºä¹‹å‰ï¼Œæˆ‘å‘ç°â€œç”µå½±æœç´¢â€è¿™ä¸ªåå­—æœ‰äº›æ™®é€šï¼Œå› æ­¤æˆ‘å°†åº”ç”¨é‡æ–°å‘½åä¸º *Rosebud* ğŸŒ¹ï¼Œå› æ­¤ä¸Šé¢æ˜¾ç¤ºçš„æ˜¯è¯¥å›¾åƒã€‚çœŸæ­£çš„ç”µå½±è¿·ä¼š [ç†è§£è¿™ä¸ªå¼•ç”¨](https://www.youtube.com/watch?v=O4mQqVqRB7I)ã€‚
- en: Offline Evaluation
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¦»çº¿è¯„ä¼°
- en: It is important to be able to judge if a change made to your LLM application
    improves or degrades its performance. Unfortunately, evaluation of LLM apps is
    a difficult and novel space. There is simply not much agreement on what constitutes
    a good evaluation.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: èƒ½å¤Ÿåˆ¤æ–­å¯¹ LLM åº”ç”¨æ‰€åšçš„æ›´æ”¹æ˜¯æå‡äº†æ€§èƒ½è¿˜æ˜¯é™ä½äº†æ€§èƒ½éå¸¸é‡è¦ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒLLM åº”ç”¨çš„è¯„ä¼°æ˜¯ä¸€ä¸ªå¤æ‚ä¸”å…¨æ–°çš„é¢†åŸŸã€‚å¯¹äºä»€ä¹ˆæ„æˆä¸€ä¸ªå¥½çš„è¯„ä¼°ï¼Œç›®å‰å‡ ä¹æ²¡æœ‰ä¸€è‡´çš„æ„è§ã€‚
- en: For RosebudğŸŒ¹, I decided to tackle what is known as the [RAG triad](https://www.trulens.org/trulens_eval/getting_started/core_concepts/rag_triad/).
    This approach is promoted by TruLens, a platform to evaluate and track LLM applications.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äº RosebudğŸŒ¹ï¼Œæˆ‘å†³å®šå¤„ç†è¢«ç§°ä¸º [RAG ä¸‰åˆä¸€æ–¹æ³•](https://www.trulens.org/trulens_eval/getting_started/core_concepts/rag_triad/)
    çš„é—®é¢˜ã€‚è¿™ç§æ–¹æ³•æ˜¯ç”± TruLens æ¨å¹¿çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯„ä¼°å’Œè·Ÿè¸ª LLM åº”ç”¨çš„å¹³å°ã€‚
- en: '![](../Images/d536e3e20215d54bdf6e350f4f06a994.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d536e3e20215d54bdf6e350f4f06a994.png)'
- en: The RAG Triad. Image by author.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: RAG ä¸‰åˆä¸€æ–¹æ³•ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: 'The triad covers three aspects of a RAG app:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‰åˆä¸€æ–¹æ³•æ¶µç›–äº† RAG åº”ç”¨çš„ä¸‰ä¸ªæ–¹é¢ï¼š
- en: '**Context Relevancy**: When a query is made by the user, documents fill the
    context of the chat model. Is the retrieved context actually useful? If not, you
    may need to tweak things like document embedding, chunking, or metadata filtering.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ä¸Šä¸‹æ–‡ç›¸å…³æ€§**ï¼šå½“ç”¨æˆ·å‘å‡ºæŸ¥è¯¢æ—¶ï¼Œæ–‡æ¡£å¡«å……äº†èŠå¤©æ¨¡å‹çš„ä¸Šä¸‹æ–‡ã€‚æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡å®é™…ä¸Šæœ‰ç”¨å—ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´æ–‡æ¡£åµŒå…¥ã€åˆ†å—æˆ–å…ƒæ•°æ®è¿‡æ»¤ç­‰æ–¹é¢ã€‚'
- en: '**Faithfulness:** Is the modelâ€™s response actually grounded in the retrieved
    documents? You donâ€™t want the model making up facts; the whole point of RAG is
    to help reduce hallucinations by using retrieved documents.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å‡†ç¡®æ€§**ï¼šæ¨¡å‹çš„å›ç­”æ˜¯å¦ç¡®å®åŸºäºæ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼Ÿä½ ä¸å¸Œæœ›æ¨¡å‹ç¼–é€ äº‹å®ï¼›RAG çš„å…³é”®å°±åœ¨äºé€šè¿‡ä½¿ç”¨æ£€ç´¢åˆ°çš„æ–‡æ¡£æ¥å‡å°‘å¹»è§‰ã€‚'
- en: '**Answer Relevancy:** Does the modelâ€™s response actually answer the userâ€™s
    query? If the user asks for â€œ*Comedy films made in the 1990s?*â€, the modelâ€™s answer
    better contain only comedy films made in the 1990s.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å›ç­”ç›¸å…³æ€§**ï¼šæ¨¡å‹çš„å›ç­”æ˜¯å¦çœŸçš„è§£ç­”äº†ç”¨æˆ·çš„æŸ¥è¯¢ï¼Ÿå¦‚æœç”¨æˆ·è¯¢é—®â€œ*1990å¹´ä»£çš„å–œå‰§ç”µå½±*â€ï¼Œæ¨¡å‹çš„å›ç­”æœ€å¥½åªåŒ…å«1990å¹´ä»£çš„å–œå‰§ç”µå½±ã€‚'
- en: 'There are a few ways to attempt to assess these three functions of a RAG app.
    One way would be to use human expert evaluators. Unfortunately, this would be
    expensive and wouldnâ€™t scale. For RosebudğŸŒ¹ I decided to use **LLMs-as-a-judges**.
    This means using a chat model to look at each of the three criteria above and
    assigning a score of 0 to 1 for each. This method has the advantage of being cheap
    and scaling well. To accomplish this, I used [RAGAS](https://github.com/explodinggradients/ragas),
    a popular framework that helps you evaluate your RAG applications. The RAGAS framework
    includes the three metrics mentioned above and makes it fairly easy to use them
    to evaluate your apps. Below is a code snippet demonstrating how I conducted this
    offline evaluation:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: è¯„ä¼° RAG åº”ç”¨çš„è¿™ä¸‰ä¸ªåŠŸèƒ½æœ‰å‡ ç§æ–¹å¼ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨äººç±»ä¸“å®¶è¯„ä¼°å‘˜ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ ·åšä¼šå¾ˆæ˜‚è´µï¼Œå¹¶ä¸”éš¾ä»¥æ‰©å±•ã€‚å¯¹äº RosebudğŸŒ¹ï¼Œæˆ‘å†³å®šä½¿ç”¨ **LLMs
    ä½œä¸ºè¯„å®¡å‘˜**ã€‚è¿™æ„å‘³ç€ä½¿ç”¨èŠå¤©æ¨¡å‹æ¥æŸ¥çœ‹ä¸Šè¿°ä¸‰ä¸ªæ ‡å‡†ä¸­çš„æ¯ä¸€ä¸ªï¼Œå¹¶ä¸ºæ¯ä¸ªæ ‡å‡†æ‰“åˆ†ï¼ŒèŒƒå›´ä» 0 åˆ° 1ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯æˆæœ¬ä½ä¸”æ˜“äºæ‰©å±•ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨äº† [RAGAS](https://github.com/explodinggradients/ragas)ï¼Œè¿™æ˜¯ä¸€ä¸ªæµè¡Œçš„æ¡†æ¶ï¼Œå¸®åŠ©ä½ è¯„ä¼°
    RAG åº”ç”¨ã€‚RAGAS æ¡†æ¶åŒ…æ‹¬ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼Œå¹¶ä½¿ä½ èƒ½å¤Ÿç›¸å¯¹å®¹æ˜“åœ°ä½¿ç”¨å®ƒä»¬æ¥è¯„ä¼°åº”ç”¨ã€‚ä¸‹é¢æ˜¯æˆ‘è¿›è¡Œç¦»çº¿è¯„ä¼°æ—¶ä½¿ç”¨çš„ä»£ç ç‰‡æ®µï¼š
- en: '[PRE0]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'A few notes:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: å‡ ç‚¹è¯´æ˜ï¼š
- en: 'With twenty questions and three criteria to judge across, youâ€™re looking at
    sixty LLM calls for a single evaluation! It gets even worse though; with the `rosebud_chat_model`
    , there are two calls for every query: one to construct the metadata filter and
    another to provide the answer, so really this is 120 calls for a single eval!
    All models used in this evaluation are the new `gpt-4o-mini`, which I strongly
    recommend. In my experience the calls cost $0.05 per evaluation.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æœ‰äºŒåä¸ªé—®é¢˜å’Œä¸‰ä¸ªè¯„åˆ¤æ ‡å‡†ï¼Œä½ éœ€è¦è¿›è¡Œå…­åæ¬¡ LLM è°ƒç”¨æ¥å®Œæˆä¸€æ¬¡è¯„ä¼°ï¼ä¸è¿‡æƒ…å†µæ›´ç³Ÿï¼›ä½¿ç”¨ `rosebud_chat_model` æ—¶ï¼Œæ¯ä¸ªæŸ¥è¯¢éœ€è¦ä¸¤æ¬¡è°ƒç”¨ï¼šä¸€æ¬¡æ„å»ºå…ƒæ•°æ®è¿‡æ»¤å™¨ï¼Œå¦ä¸€æ¬¡æä¾›ç­”æ¡ˆï¼Œå› æ­¤ä¸€æ¬¡è¯„ä¼°å®é™…ä¸Šéœ€è¦
    120 æ¬¡è°ƒç”¨ï¼æœ¬æ¬¡è¯„ä¼°ä¸­ä½¿ç”¨çš„æ‰€æœ‰æ¨¡å‹éƒ½æ˜¯æ–°çš„ `gpt-4o-mini`ï¼Œæˆ‘å¼ºçƒˆæ¨èä½¿ç”¨ã€‚åœ¨æˆ‘çš„ç»éªŒä¸­ï¼Œæ¯æ¬¡è¯„ä¼°çš„è°ƒç”¨è´¹ç”¨ä¸º $0.05ã€‚
- en: Note that we are using `asyncio.run` to run the evals. It is ideal to use asynchronous
    calls because you donâ€™t want to evaluate each question sequentially one after
    the other. Instead, with `asyncio` we can begin evaluating other questions as
    we wait for previous I/O operations to finish.
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `asyncio.run` æ¥è¿è¡Œè¯„ä¼°ã€‚ä½¿ç”¨å¼‚æ­¥è°ƒç”¨æ˜¯ç†æƒ³çš„ï¼Œå› ä¸ºä½ ä¸æƒ³è®©æ¯ä¸ªé—®é¢˜æŒ‰é¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¯„ä¼°ã€‚ç›¸åï¼Œä½¿ç”¨ `asyncio`
    æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç­‰å¾…å‰ä¸€ä¸ª I/O æ“ä½œå®Œæˆæ—¶ï¼Œå¼€å§‹è¯„ä¼°å…¶ä»–é—®é¢˜ã€‚
- en: There are a total of twenty questions for a single evaluation. These span a
    variety of typical film queries a user may ask. I mostly came up with these myself,
    but in practice it would be better to use queries actually asked by users in production.
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¯æ¬¡è¯„ä¼°å…±æœ‰äºŒåä¸ªé—®é¢˜ã€‚è¿™äº›é—®é¢˜æ¶µç›–äº†ç”¨æˆ·å¯èƒ½æå‡ºçš„å„ç§å…¸å‹ç”µå½±æŸ¥è¯¢ã€‚æˆ‘å¤§éƒ¨åˆ†æ˜¯è‡ªå·±æƒ³å‡ºæ¥çš„ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæœ€å¥½ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒä¸­å®é™…ç”±ç”¨æˆ·æå‡ºçš„æŸ¥è¯¢ã€‚
- en: Notice the `weave.init` and the `@weave.op` decorator that are being used. These
    are part of the new [Weave library](https://wandb.ai/site/weave/) from Weights
    & Biases (W&B). Weave is a complement to the traditional W&B library, with a focus
    on LLM applications. It allows you to capture inputs and outputs of LLMs by using
    a the simple `@weave.op` decorator. It also allows you to capture the results
    of evaluations using `weave.Evaluation(â€¦)` . By integrating RAGAS to perform evaluations
    and Weave to capture and log them, we get a powerful duo that helps GenAI developers
    iteratively improve their applications. You also get to log the model latency,
    cost, and more.
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ³¨æ„ä½¿ç”¨çš„ `weave.init` å’Œ `@weave.op` è£…é¥°å™¨ã€‚è¿™äº›æ˜¯æ¥è‡ª Weights & Biases (W&B) çš„æ–° [Weave
    åº“](https://wandb.ai/site/weave/) çš„ä¸€éƒ¨åˆ†ã€‚Weave æ˜¯ä¼ ç»Ÿ W&B åº“çš„è¡¥å……ï¼Œä¸“æ³¨äº LLM åº”ç”¨ã€‚å®ƒé€šè¿‡ç®€å•çš„ `@weave.op`
    è£…é¥°å™¨ï¼Œå…è®¸ä½ æ•è· LLM çš„è¾“å…¥å’Œè¾“å‡ºã€‚å®ƒè¿˜å…è®¸ä½ ä½¿ç”¨ `weave.Evaluation(â€¦)` æ•è·è¯„ä¼°ç»“æœã€‚é€šè¿‡é›†æˆ RAGAS è¿›è¡Œè¯„ä¼°ï¼Œå¹¶ä½¿ç”¨
    Weave æ•è·å’Œè®°å½•è¿™äº›è¯„ä¼°ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¼ºå¤§çš„ç»„åˆï¼Œå¸®åŠ© GenAI å¼€å‘è€…é€æ­¥æ”¹è¿›ä»–ä»¬çš„åº”ç”¨ã€‚ä½ è¿˜å¯ä»¥è®°å½•æ¨¡å‹çš„å»¶è¿Ÿã€æˆæœ¬ç­‰ä¿¡æ¯ã€‚
- en: '![](../Images/ec7f61849ae276bbcc97508920e22e5b.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/ec7f61849ae276bbcc97508920e22e5b.png)'
- en: Example of Weave + RAGAS integration. Image by author.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Weave + RAGAS é›†æˆç¤ºä¾‹ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: In theory, one can now tweak a hyperparameter (e.g. temperature), re-run the
    evaluation, and see if the adjustment has a positive or negative impact. Unfortunately,
    in practice I found the LLM judging to be finicky, and I am [not the only one](https://x.com/aparnadhinak/status/1748368364395721128).
    LLM judges seem to be fairly bad at using a floating point value to assess these
    metrics. Instead, it appears they seem to do better at classification e.g. a thumbs
    up/thumbs down. RAGAS doesnâ€™t yet support LLM judges performing classification.
    Writing it by hand doesnâ€™t seem too difficult, and perhaps in a future update
    I may attempt this myself.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ç†è®ºä¸Šï¼Œç°åœ¨å¯ä»¥è°ƒæ•´ä¸€ä¸ªè¶…å‚æ•°ï¼ˆä¾‹å¦‚æ¸©åº¦ï¼‰ï¼Œé‡æ–°è¿è¡Œè¯„ä¼°ï¼Œç„¶åæŸ¥çœ‹è°ƒæ•´æ˜¯å¦äº§ç”Ÿæ­£é¢æˆ–è´Ÿé¢å½±å“ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®é™…æ“ä½œä¸­æˆ‘å‘ç°LLMåˆ¤æ–­æœ‰äº›æŒ‘å‰”ï¼Œæˆ‘[å¹¶éå”¯ä¸€ä¸€ä¸ª](https://x.com/aparnadhinak/status/1748368364395721128)ã€‚LLMè¯„åˆ¤ä¼¼ä¹å¾ˆéš¾ä½¿ç”¨æµ®ç‚¹å€¼æ¥è¯„ä¼°è¿™äº›æŒ‡æ ‡ã€‚ç›¸åï¼Œå®ƒä»¬ä¼¼ä¹åœ¨åˆ†ç±»ä»»åŠ¡ä¸Šè¡¨ç°å¾—æ›´å¥½ï¼Œä¾‹å¦‚èµæˆ–è¸©ã€‚RAGASå°šä¸æ”¯æŒLLMè¯„åˆ¤è¿›è¡Œåˆ†ç±»ã€‚æ‰‹åŠ¨ç¼–å†™è¿™ä¸ªåŠŸèƒ½ä¼¼ä¹ä¸éš¾ï¼Œä¹Ÿè®¸åœ¨æœªæ¥çš„æ›´æ–°ä¸­ï¼Œæˆ‘ä¼šå°è¯•è‡ªå·±å®ç°ã€‚
- en: '**Online Evaluation**'
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**åœ¨çº¿è¯„ä¼°**'
- en: Offline evaluation is good for seeing how tweaking hyperparameters affects performance,
    but in my opinion online evaluation is far more useful. In RosebudğŸŒ¹ I have now
    incorporated the use of ğŸ‘/ğŸ‘ buttons at the bottom of every response to provide
    feedback.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: ç¦»çº¿è¯„ä¼°æœ‰åŠ©äºæŸ¥çœ‹è°ƒæ•´è¶…å‚æ•°å¦‚ä½•å½±å“æ€§èƒ½ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼Œåœ¨çº¿è¯„ä¼°è¦æ›´æœ‰ç”¨ã€‚åœ¨RosebudğŸŒ¹ä¸­ï¼Œæˆ‘ç°åœ¨å·²ç»åœ¨æ¯ä¸ªå“åº”çš„åº•éƒ¨åŠ å…¥äº†ğŸ‘/ğŸ‘æŒ‰é’®æ¥æä¾›åé¦ˆã€‚
- en: '![](../Images/c9351c7a2914be0e13e6295426c304fd.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c9351c7a2914be0e13e6295426c304fd.png)'
- en: Example of online feedback. Image by author.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨çº¿åé¦ˆç¤ºä¾‹ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚
- en: 'When a user clicks on either button they are told that their feedback was logged.
    Below is a snippet of how this was accomplished in the Streamlit interface:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç”¨æˆ·ç‚¹å‡»ä»»ä¸€æŒ‰é’®æ—¶ï¼Œä»–ä»¬ä¼šè¢«å‘ŠçŸ¥åé¦ˆå·²è®°å½•ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Streamlit ç•Œé¢ä¸­å®ç°è¿™ä¸€åŠŸèƒ½çš„ä»£ç ç‰‡æ®µï¼š
- en: '[PRE1]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Note that the process of sending the feedback to W&B runs on a separate thread
    rather than on the main thread. This is to prevent the user from getting stuck
    for a few seconds waiting for the logging to complete.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œå‘é€åé¦ˆåˆ°W&Bçš„è¿‡ç¨‹æ˜¯é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œã€‚è¿™æ˜¯ä¸ºäº†é¿å…ç”¨æˆ·åœ¨ç­‰å¾…æ—¥å¿—å®Œæˆæ—¶è¢«å¡ä½ã€‚
- en: 'A W&B table is used to store the feedback. Five quantities are logged in the
    table:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨W&Bè¡¨æ ¼æ¥å­˜å‚¨åé¦ˆã€‚è¡¨æ ¼ä¸­è®°å½•äº†äº”ä¸ªæ•°é‡ï¼š
- en: '**Sentiment:** Whether the user clicked thumbs up or thumbs down'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æƒ…æ„Ÿ:** ç”¨æˆ·ç‚¹å‡»äº†èµè¿˜æ˜¯è¸©'
- en: '**Query:** The userâ€™s query, e.g. *Find me drama movies in English that are
    less than 2 hours long and feature dogs.*'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æŸ¥è¯¢:** ç”¨æˆ·çš„æŸ¥è¯¢ï¼Œä¾‹å¦‚ *æ‰¾æˆ‘ä¸€äº›è‹±æ–‡çš„ç‹—ç‹—é¢˜æçš„å‰§æƒ…ç‰‡ï¼Œæ—¶é•¿ä¸åˆ°2å°æ—¶ã€‚*'
- en: '**Query_Constructor:** The results of the query constructor, which rewrites
    the userâ€™s query and includes metadata filtering if necessary, e.g.'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æŸ¥è¯¢æ„é€ å™¨:** æŸ¥è¯¢æ„é€ å™¨çš„ç»“æœï¼Œå®ƒé‡å†™äº†ç”¨æˆ·çš„æŸ¥è¯¢ï¼Œå¹¶åœ¨å¿…è¦æ—¶åŒ…æ‹¬å…ƒæ•°æ®è¿‡æ»¤ï¼Œä¾‹å¦‚'
- en: '[PRE2]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '**Context:** The retrieved context based on the reconstructed query, e.g. *Title:
    Hachi: A Dogâ€™s Tale. Overview: A drama based on the true story of a college professorâ€™sâ€¦*'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ä¸Šä¸‹æ–‡:** åŸºäºé‡æ„åçš„æŸ¥è¯¢æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚ *æ ‡é¢˜: å“ˆå¥‡ï¼šä¸€åªç‹—çš„æ•…äº‹ã€‚æ¦‚è¿°: åŸºäºä¸€ä½å¤§å­¦æ•™æˆçœŸå®æ•…äº‹çš„å‰§æƒ…ç‰‡â€¦â€¦*'
- en: '**Response:** The modelâ€™s response'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å“åº”:** æ¨¡å‹çš„å“åº”'
- en: All of this is logged conveniently in the same project as the Weave evaluations
    shown earlier. Now, when a query goes south it is as simple as hitting the thumbs
    down button to see exactly what happened. This will allow much faster iteration
    and improvement of the RosebudğŸŒ¹ recommendation application.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€æœ‰è¿™äº›éƒ½æ–¹ä¾¿åœ°è®°å½•åœ¨ä¸å…ˆå‰å±•ç¤ºçš„Weaveè¯„ä¼°ç›¸åŒçš„é¡¹ç›®ä¸­ã€‚ç°åœ¨ï¼Œå½“æŸ¥è¯¢å‡ºé”™æ—¶ï¼Œåªéœ€ç‚¹å‡»è¸©æŒ‰é’®ï¼Œå°±å¯ä»¥çœ‹åˆ°å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™å°†å¤§å¤§åŠ é€ŸRosebudğŸŒ¹æ¨èåº”ç”¨çš„è¿­ä»£å’Œæ”¹è¿›ã€‚
- en: '![](../Images/f1ec5605b853d379a932d40b1012a4c2.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f1ec5605b853d379a932d40b1012a4c2.png)'
- en: Image showing observability of the modelâ€™s response. Note on the left-hand side
    how it is seamless to transition between W&B and Weave. Image by author.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: æ˜¾ç¤ºæ¨¡å‹å“åº”å¯è§‚å¯Ÿæ€§çš„å›¾åƒã€‚æ³¨æ„å·¦ä¾§å¦‚ä½•åœ¨W&Bå’ŒWeaveä¹‹é—´æ— ç¼åˆ‡æ¢ã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚
- en: '**Automated Data Pulling using Prefect**'
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '**ä½¿ç”¨Prefectè‡ªåŠ¨åŒ–æ•°æ®æ‹‰å–**'
- en: To ensure recommendations from RosebudğŸŒ¹ continue to stay accurate it was important
    to automate the process of pulling data and uploading them to Pinecone. For this
    task, I chose [Prefect](https://www.prefect.io/). Prefect is a popular workflow
    orchestration tool. I was looking for something lightweight, easy to learn, and
    Pythonic. I found all of this in Prefect.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ç¡®ä¿RosebudğŸŒ¹çš„æ¨èæŒç»­å‡†ç¡®ï¼Œè‡ªåŠ¨åŒ–æ‹‰å–æ•°æ®å¹¶ä¸Šä¼ åˆ°Pineconeçš„è¿‡ç¨‹å˜å¾—å°¤ä¸ºé‡è¦ã€‚ä¸ºæ­¤ï¼Œæˆ‘é€‰æ‹©äº†[Prefect](https://www.prefect.io/)ã€‚Prefectæ˜¯ä¸€ä¸ªæµè¡Œçš„å·¥ä½œæµç¼–æ’å·¥å…·ã€‚æˆ‘æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªè½»é‡ã€æ˜“å­¦ä¸”ç¬¦åˆPythoné£æ ¼çš„å·¥å…·ï¼Œè€ŒPrefectæ­£ç¬¦åˆè¿™äº›è¦æ±‚ã€‚
- en: '![](../Images/74bf21e667d7580aa0f0a410a2ac3d9f.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/74bf21e667d7580aa0f0a410a2ac3d9f.png)'
- en: Automated flow for pulling and updating Pinecone vector store provided by Prefect.
    Image by author.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: Prefect æä¾›çš„è‡ªåŠ¨åŒ–æµç¨‹ç”¨äºæ‹‰å–å’Œæ›´æ–° Pinecone å‘é‡å­˜å‚¨ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚
- en: 'Prefect offers a variety of ways to schedule your workflows. I decided to use
    the [push work pools with automatic infrastructure provisioning](https://docs.prefect.io/latest/tutorial/work-pools/#push-work-pools-with-automatic-infrastructure-provisioning).
    I found that this setup balances simplicity with configurability. It allows the
    user to task Prefect with automatically provisioning all of the infrastructure
    needed to run your flow in your cloud provider of choice. I chose to deploy on
    Azure, but deploying on GCP or AWS only requires changing a few lines of code.
    Refer to the `pinecone_flow.py` file for more details. A simplified flow is provided
    below:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: Prefect æä¾›å¤šç§æ–¹å¼æ¥è°ƒåº¦æ‚¨çš„å·¥ä½œæµã€‚æˆ‘å†³å®šä½¿ç”¨[å¸¦è‡ªåŠ¨åŸºç¡€è®¾æ–½é…ç½®çš„æ¨é€å·¥ä½œæ± ](https://docs.prefect.io/latest/tutorial/work-pools/#push-work-pools-with-automatic-infrastructure-provisioning)ã€‚æˆ‘å‘ç°è¿™ç§è®¾ç½®åœ¨ç®€æ˜“æ€§ä¸å¯é…ç½®æ€§ä¹‹é—´è¾¾åˆ°äº†å¹³è¡¡ã€‚å®ƒå…è®¸ç”¨æˆ·å°†
    Prefect ä»»åŠ¡å§”æ‰˜ç»™è‡ªåŠ¨é…ç½®è¿è¡Œæ‚¨å·¥ä½œæµæ‰€éœ€çš„æ‰€æœ‰åŸºç¡€è®¾æ–½ï¼Œéƒ¨ç½²åˆ°æ‚¨é€‰æ‹©çš„äº‘æä¾›å•†ã€‚æˆ‘é€‰æ‹©äº†åœ¨ Azure ä¸Šè¿›è¡Œéƒ¨ç½²ï¼Œä½†åœ¨ GCP æˆ– AWS ä¸Šéƒ¨ç½²åªéœ€æ›´æ”¹å‡ è¡Œä»£ç ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ
    `pinecone_flow.py` æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ç®€åŒ–åçš„æµç¨‹ï¼š
- en: '[PRE3]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Notice how simple it is to turn Python functions into a Prefect flow. All you
    need are some sub-functions styled with `@task` decorators and a `@flow` decorator
    on the main function. Also note that after uploading the documents to Pinecone,
    the last step of our flow publishes the dataset to Weave. This is important for
    reproducibility purposes. To learn the basics of Prefect I recommend going through
    the tutorials [on their website](https://docs.prefect.io/latest/tutorial/).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„å°† Python å‡½æ•°è½¬æ¢ä¸º Prefect æµç¨‹æ˜¯å¤šä¹ˆç®€å•ã€‚æ‚¨åªéœ€è¦ä¸€äº›ä½¿ç”¨ `@task` è£…é¥°å™¨çš„å­å‡½æ•°ï¼Œä»¥åŠåœ¨ä¸»å‡½æ•°ä¸Šä½¿ç”¨ `@flow`
    è£…é¥°å™¨ã€‚è¿˜è¦æ³¨æ„ï¼Œåœ¨å°†æ–‡æ¡£ä¸Šä¼ åˆ° Pinecone åï¼Œæˆ‘ä»¬çš„æµç¨‹çš„æœ€åä¸€æ­¥ä¼šå°†æ•°æ®é›†å‘å¸ƒåˆ° Weaveã€‚è¿™å¯¹äºå¯é‡å¤æ€§éå¸¸é‡è¦ã€‚è¦äº†è§£ Prefect çš„åŸºæœ¬çŸ¥è¯†ï¼Œå»ºè®®æµè§ˆ[ä»–ä»¬ç½‘ç«™ä¸Šçš„æ•™ç¨‹](https://docs.prefect.io/latest/tutorial/)ã€‚
- en: At the bottom of the script we see how deployment is done in Prefect.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è„šæœ¬çš„åº•éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä½•åœ¨ Prefect ä¸­è¿›è¡Œéƒ¨ç½²ã€‚
- en: We need to provide a `name` for the deployment. This is arbitrary.
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬éœ€è¦ä¸ºéƒ¨ç½²æä¾›ä¸€ä¸ª `name` ã€‚è¿™ä¸ªåç§°å¯ä»¥éšæ„ã€‚
- en: We also need to specify a `work_pool_name` . Push work pools in Prefect automatically
    send tasks to serverless computers without needing a middleman. This name needs
    to match the name used to create the pool, which weâ€™ll see below.
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ª `work_pool_name` ã€‚Prefect ä¸­çš„æ¨é€å·¥ä½œæ± ä¼šè‡ªåŠ¨å°†ä»»åŠ¡å‘é€åˆ°æ— æœåŠ¡å™¨è®¡ç®—æœºï¼Œè€Œæ— éœ€ä¸­ä»‹ã€‚è¿™ä¸ªåç§°éœ€è¦ä¸åˆ›å»ºæ± æ—¶ä½¿ç”¨çš„åç§°åŒ¹é…ï¼Œä¸‹é¢æˆ‘ä»¬å°†çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚
- en: You also need to specify a `cron` , which is short for chronograph. This allows
    you to specify how often to repeat a workflow. The value `â€œ0 0 * * 0â€` means repeat
    this workflow every week. Check out [this website](https://cloud.google.com/scheduler/docs/configuring/cron-job-schedules)
    for details on how the `cron` syntax works.
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ª `cron` ï¼Œå³è®¡æ—¶å™¨çš„ç®€å†™ã€‚å®ƒå…è®¸æ‚¨æŒ‡å®šé‡å¤å·¥ä½œæµçš„é¢‘ç‡ã€‚å€¼ä¸º `"0 0 * * 0"` æ„å‘³ç€æ¯å‘¨é‡å¤æ­¤å·¥ä½œæµã€‚æœ‰å…³ `cron`
    è¯­æ³•å¦‚ä½•å·¥ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[è¿™ä¸ªç½‘ç«™](https://cloud.google.com/scheduler/docs/configuring/cron-job-schedules)ã€‚
- en: Finally, you need to specify a `DeploymentImage` . Here you specify both a `name`
    and a `platform` . The name is arbitrary, but the platform is not. Since I want
    to deploy to Azure compute instances, and these instances run Linux, itâ€™s important
    I specify that in the `DeploymentImage` .
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæ‚¨éœ€è¦æŒ‡å®šä¸€ä¸ª `DeploymentImage` ã€‚åœ¨æ­¤å¤„ï¼Œæ‚¨éœ€è¦æŒ‡å®š `name` å’Œ `platform` ã€‚åç§°å¯ä»¥éšæ„ï¼Œä½†å¹³å°ä¸è¡Œã€‚å› ä¸ºæˆ‘æƒ³éƒ¨ç½²åˆ°
    Azure è®¡ç®—å®ä¾‹ï¼Œå¹¶ä¸”è¿™äº›å®ä¾‹è¿è¡Œ Linuxï¼Œæ‰€ä»¥åœ¨ `DeploymentImage` ä¸­æŒ‡å®šè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚
- en: 'To deploy this flow on Azure using the CLI, run the following commands:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: è¦ä½¿ç”¨ CLI åœ¨ Azure ä¸Šéƒ¨ç½²æ­¤å·¥ä½œæµï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
- en: '[PRE4]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'These commands will automatically provision all of the necessary infrastructure
    on Azure. This includes an Azure Container Registry (ACR) that will hold a Docker
    image containing all files in your directory as well as any necessary libraries
    listed in a `requirements.txt` . It will also include an Azure Container Instance
    (ACI) Identity that will have permissions necessary to deploy a container with
    the aforementioned Docker image. Finally, the `deployment run` command will schedule
    the code to be run every week. You can check the Prefect dashboard to see your
    flow get run:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›å‘½ä»¤å°†è‡ªåŠ¨é…ç½® Azure ä¸Šæ‰€éœ€çš„æ‰€æœ‰åŸºç¡€è®¾æ–½ã€‚å…¶ä¸­åŒ…æ‹¬ä¸€ä¸ª Azure å®¹å™¨æ³¨å†Œè¡¨ (ACR)ï¼Œå®ƒå°†ä¿å­˜åŒ…å«æ‚¨ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„ Docker é•œåƒä»¥åŠåœ¨
    `requirements.txt` ä¸­åˆ—å‡ºçš„ä»»ä½•å¿…è¦åº“ã€‚å®ƒè¿˜å°†åŒ…æ‹¬ä¸€ä¸ª Azure å®¹å™¨å®ä¾‹ (ACI) èº«ä»½ï¼Œè¯¥èº«ä»½å°†å…·æœ‰éƒ¨ç½²ä¸Šè¿° Docker é•œåƒå®¹å™¨æ‰€éœ€çš„æƒé™ã€‚æœ€åï¼Œ`deployment
    run` å‘½ä»¤å°†æ¯å‘¨è°ƒåº¦ä¸€æ¬¡ä»£ç è¿è¡Œã€‚æ‚¨å¯ä»¥æŸ¥çœ‹ Prefect ä»ªè¡¨æ¿ï¼ŒæŸ¥çœ‹æ‚¨çš„å·¥ä½œæµè¿è¡Œæƒ…å†µï¼š
- en: '![](../Images/fd1b54cdc71bbf012184a5f21cddd770.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/fd1b54cdc71bbf012184a5f21cddd770.png)'
- en: Image of a flow in Prefect being successfully run. Image by author.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: Prefectæµç¨‹æˆåŠŸè¿è¡Œçš„å›¾åƒã€‚å›¾åƒç”±ä½œè€…æä¾›ã€‚
- en: By updating my Pinecone vector store weekly, I can ensure that the recommendations
    from Rosebud ğŸŒ¹ remain accurate.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡æ¯å‘¨æ›´æ–°æˆ‘çš„Pineconeå‘é‡å­˜å‚¨ï¼Œæˆ‘å¯ä»¥ç¡®ä¿Rosebud ğŸŒ¹çš„æ¨èç»“æœä¿æŒå‡†ç¡®ã€‚
- en: Summary
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ‘˜è¦
- en: In this article, I discussed my experience improving the Rosebud ğŸŒ¹ app. This
    included the process of incorporating offline and online evaluation, as well as
    automating the update of my Pinecone vector store.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘è®¨è®ºäº†æˆ‘åœ¨æ”¹è¿›Rosebud ğŸŒ¹åº”ç”¨ç¨‹åºæ–¹é¢çš„ç»éªŒã€‚è¿™åŒ…æ‹¬äº†æ•´åˆç¦»çº¿å’Œåœ¨çº¿è¯„ä¼°çš„è¿‡ç¨‹ï¼Œä»¥åŠè‡ªåŠ¨æ›´æ–°æˆ‘çš„Pineconeå‘é‡å­˜å‚¨ã€‚
- en: 'Some other improvements not mentioned in this article:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: å…¶ä»–ä¸€äº›æœªåœ¨æœ¬æ–‡ä¸­æåŠçš„æ”¹è¿›ï¼š
- en: Including ratings from [The Movie Database](https://www.themoviedb.org/?language=en-US)
    in the film data. You can now ask for â€œ*highly rated films*â€ and the chat model
    will filter for films above a 7/10.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åœ¨ç”µå½±æ•°æ®ä¸­åŠ å…¥äº†[ç”µå½±æ•°æ®åº“](https://www.themoviedb.org/?language=en-US)çš„è¯„åˆ†ã€‚ç°åœ¨ä½ å¯ä»¥è¦æ±‚â€œ*é«˜è¯„åˆ†ç”µå½±*â€ï¼ŒèŠå¤©æ¨¡å‹å°†ç­›é€‰å‡ºè¯„åˆ†é«˜äº7/10çš„ç”µå½±ã€‚
- en: Upgraded chat models. Now the query and summary models are using `gpt-4o-mini`
    . Recall that the LLM judge model is also using `gpt-4o-mini` .
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å‡çº§ç‰ˆèŠå¤©æ¨¡å‹ã€‚ç°åœ¨æŸ¥è¯¢å’Œæ‘˜è¦æ¨¡å‹ä½¿ç”¨çš„æ˜¯`gpt-4o-mini`ã€‚è¯·è®°ä½ï¼ŒLLM åˆ¤æ–­æ¨¡å‹ä¹Ÿåœ¨ä½¿ç”¨`gpt-4o-mini`ã€‚
- en: Embedding model upgraded to `text-embedding-3-small` from `text-embedding-ada-002`
    .
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åµŒå…¥æ¨¡å‹å·²ä»`text-embedding-ada-002`å‡çº§ä¸º`text-embedding-3-small`ã€‚
- en: Years now span 1950â€“2023, instead of starting at 1920\. Film data from 1920â€“1950
    was not high quality, and only messed up recommendations.
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç°åœ¨çš„å¹´ä»½è·¨åº¦ä¸º1950â€“2023å¹´ï¼Œè€Œä¸æ˜¯ä»1920å¹´å¼€å§‹ã€‚1920â€“1950å¹´çš„ç”µå½±æ•°æ®è´¨é‡è¾ƒå·®ï¼Œåªä¼šå¯¼è‡´æ¨èç»“æœæ··ä¹±ã€‚
- en: UI is cleaner, with all details regarding the project relegated to a sidebar.
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç”¨æˆ·ç•Œé¢æ›´åŠ ç®€æ´ï¼Œæ‰€æœ‰é¡¹ç›®ç›¸å…³çš„ç»†èŠ‚éƒ½è¢«ç§»åˆ°äº†ä¾§è¾¹æ ã€‚
- en: Vastly improved documentation on GitHub.
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GitHubä¸Šçš„æ–‡æ¡£å¤§å¹…æ”¹è¿›ã€‚
- en: Bug fixes.
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é”™è¯¯ä¿®å¤ã€‚
- en: As mentioned at the top of the article, the app is now 100% free to use! I will
    foot the bill for queries for the foreseeable future (hence the choice of `gpt-4o-mini`
    instead of the more expensive `gpt-4o`). I really want to get the experience of
    running an app in production, and having my readers test out RosebudğŸŒ¹ is a great
    way to do this. In the unlikely event that the app really blows up, I will have
    to come up with some other model of funding. But that would a great problem to
    have.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœ¬æ–‡å¼€å¤´æ‰€è¿°ï¼Œè¯¥åº”ç”¨ç°åœ¨å®Œå…¨å…è´¹ä½¿ç”¨ï¼æˆ‘å°†åœ¨å¯é¢„è§çš„æœªæ¥æ‰¿æ‹…æŸ¥è¯¢è´¹ç”¨ï¼ˆå› æ­¤é€‰æ‹©äº†`gpt-4o-mini`è€Œä¸æ˜¯æ›´æ˜‚è´µçš„`gpt-4o`ï¼‰ã€‚æˆ‘éå¸¸å¸Œæœ›èƒ½å¤Ÿè·å¾—è¿è¥ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒåº”ç”¨çš„ç»éªŒï¼Œè®©è¯»è€…ä»¬è¯•ç”¨RosebudğŸŒ¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼ã€‚å¦‚æœåº”ç”¨çœŸçš„çˆ†ç«ï¼Œå°½ç®¡è¿™ä¸å¤ªå¯èƒ½ï¼Œæˆ‘å°†éœ€è¦æ‰¾åˆ°å…¶ä»–çš„èµ„é‡‘æ¨¡å¼ã€‚ä½†å¦‚æœçœŸæœ‰è¿™ç§é—®é¢˜ï¼Œé‚£å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚
- en: Enjoy discovering awesome films! ğŸ¥
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: äº«å—å‘ç°ç²¾å½©ç”µå½±çš„ä¹è¶£ï¼ğŸ¥
