<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Using IPython Jupyter Magic Commands to Improve the Notebook Experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Using IPython Jupyter Magic Commands to Improve the Notebook Experience</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-ipython-jupyter-magic-commands-to-improve-the-notebook-experience-f2c870cab356?source=collection_archive---------2-----------------------#2024-02-19">https://towardsdatascience.com/using-ipython-jupyter-magic-commands-to-improve-the-notebook-experience-f2c870cab356?source=collection_archive---------2-----------------------#2024-02-19</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="82e2" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">A post on creating a custom IPython Jupyter Magic command</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@stefan.krawczyk?source=post_page---byline--f2c870cab356--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Stefan Krawczyk" class="l ep by dd de cx" src="../Images/150405abaad9590e1dc2589168ed2fa3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*WguG4w7ZZiDFLAxQQGNoww.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--f2c870cab356--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@stefan.krawczyk?source=post_page---byline--f2c870cab356--------------------------------" rel="noopener follow">Stefan Krawczyk</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--f2c870cab356--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">12 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Feb 19, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">4</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/2795ea522a2ce09a38aa5c62dc372b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmarpCpXctBHaTMcBDUrpg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Learn to apply some magic to your notebooks. Image by author using DALL-E-3. A version of this post originally appeared <a class="af nc" href="https://blog.dagworks.io/p/using-ipython-jupyter-magic-commands" rel="noopener ugc nofollow" target="_blank">here</a>.</figcaption></figure><h1 id="c0b7" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Introduction</h1><p id="6acb" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Jupyter Notebooks are commonplace in data science. They allow a mixture of “read, evaluate, print, [in a] loop” (REPL) code writing and documentation in a single place. They’re most commonly used for analysis and brainstorming purposes, but also, more contentiously, some prefer notebooks to scripts to run production code (but we won’t focus on that here).</p><p id="9c61" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Invariably, the code written in notebooks will be repetitive in some way such as setting up a database connection, displaying an output, saving results, interacting with an internal platform tool, etc. It’s best to store this code as functions and/or modules to make them reusable and more easily manage them.</p><p id="fb07" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">However, the notebook experience is not always improved when you do that. For instance, you still need to import and call these functions throughout your notebook, which doesn’t change the notebook experience much at all. So what is the answer to augmenting the notebook development experience itself? <a class="af nc" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html" rel="noopener ugc nofollow" target="_blank">IPython Jupyter Magic Commands</a>.</p><p id="5b91" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">IPython Jupyter Magic commands (e.g. lines in notebook cells starting with <code class="cx pa pb pc pd b">%</code> or <code class="cx pa pb pc pd b">%%</code>) can decorate a notebook cell, or line, to modify its behavior. Many are available by default, including <code class="cx pa pb pc pd b">%timeit</code> to measure the execution time of the cell and <code class="cx pa pb pc pd b">%bash</code> to execute shell commands, and others are provided by extensions <a class="af nc" href="https://pypi.org/project/ipython-sql/" rel="noopener ugc nofollow" target="_blank">such as </a><code class="cx pa pb pc pd b">%sql</code> <a class="af nc" href="https://pypi.org/project/ipython-sql/" rel="noopener ugc nofollow" target="_blank">to write SQL queries</a> directly in a cell of your notebook.</p><p id="8f7d" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In this post, we’ll show how your team can turn any utility function(s) into reusable IPython Jupyter magics for a better notebook experience. As an example, we’ll use <a class="af nc" href="https://github.com/dagworks-inc/hamilton" rel="noopener ugc nofollow" target="_blank">Hamilton</a>, an open source library we created, to motivate the creation of a magic that facilitates better development ergonomics for using it. You needn’t know what Hamilton is to understand this post.</p><blockquote class="pe pf pg"><p id="8238" class="nz oa ph ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><em class="fq">Note. Nowadays, there are many flavors of notebooks (</em><a class="af nc" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"><em class="fq">Jupyter</em></a><em class="fq">, </em><a class="af nc" href="https://code.visualstudio.com/docs/datascience/jupyter-notebooks" rel="noopener ugc nofollow" target="_blank"><em class="fq">VSCode</em></a><em class="fq">, </em><a class="af nc" href="https://docs.databricks.com/en/notebooks/index.html" rel="noopener ugc nofollow" target="_blank"><em class="fq">Databricks</em></a><em class="fq">, etc.), but they’re all built on top of IPython. Therefore, the Magics developed should be reusable across environments.</em></p></blockquote><h1 id="3330" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Understanding IPython Jupyter Magics</h1><p id="0133" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">IPython Jupyter Magics (which we’ll shorten to just Magics) are bits of code that can be dynamically loaded into your notebooks. They come in two flavors, line and cell magics.</p><p id="db64" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><strong class="ob fr"><em class="ph">Line magic</em></strong>, as it suggests, operates on a single line. That is, it only takes in as input what is specified on the same line. They are denoted by a single <code class="cx pa pb pc pd b">%</code> in front of the command.</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="7d12" class="pl ne fq pd b bg pm pn l po pp"># will only time the first line<br/>%time print("hello")<br/>print("world")</span></pre><p id="17d3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><strong class="ob fr"><em class="ph">Cell magic</em></strong>, as it suggests, takes the entire contents of a cell. They are denoted by a double `<code class="cx pa pb pc pd b">%%</code>`in front of the command.</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="a766" class="pl ne fq pd b bg pm pn l po pp"># will time the entire cell<br/>%%timeit<br/>print("hello")<br/>print("world")</span></pre><p id="032f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Jupyter comes with <a class="af nc" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html" rel="noopener ugc nofollow" target="_blank">several in-built magic commands</a>. You can think of them as “command line” tools that have access to the entire notebook context. This allows them to interact with the notebook output (e.g., printing results, displaying a PNG, rendering HTML), but also to modify the state of existing variables and write to other code and markdown cells!</p><p id="dea3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This is great for developing internal tooling because it can abstract away and hide from the user unnecessary complexities, making the experience “magical”. This is a powerful tool to develop your own “platform efforts”, especially for MLOps and LLMOps purposes, as you can hide what is being integrated with from having to be exposed in the notebook. It therefore also means that notebooks don’t need to be updated if this abstracted code changes under-the-hood, since it can all be hidden in a python dependency upgrade.</p><h1 id="067b" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Workflow example</h1><p id="0ba7" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Magic commands have the potential to make your workflow simpler and faster. For example, if you prefer to develop in a notebook before moving your code to a Python module, this can involve error-prone cutting &amp; pasting. For this purpose, the magic <code class="cx pa pb pc pd b">%%writefile my_module.py</code> will directly create a file and copy your cell content into it.</p><p id="9922" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">On the opposite hand, you might prefer developing in <code class="cx pa pb pc pd b">my_module.py</code> in your IDE and then load it into a notebook to test your functions. This usually involves restarting the notebook kernel to refresh the module imports, which can be tedious. In that case, <code class="cx pa pb pc pd b">%autoreload</code> will automatically reload every module imports before every cell execution, removing this friction point!</p><h1 id="17d7" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">The Need for Custom Magic Commands</h1><p id="b55f" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">In the post <a class="af nc" href="https://blog.dagworks.io/p/how-well-structured-should-your-data" rel="noopener ugc nofollow" target="_blank">How well-structured should your data code be?</a>, it is argued that standardization/centralization/“platform” efforts, should change the shape of the “move quickly vs. built-to-last” trade-off curve for the better. A concrete tactic to change this trade-off is to implement better tooling. Better tooling should make what used to be complex, simpler and accessible. Which is exactly what you can achieve with your own custom Magic commands, which translates to less of a trade-off to be made.</p><h1 id="f715" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">A Hamilton Magic Command</h1><p id="25e0" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk"><em class="ph">For those unfamiliar with Hamilton we point readers to the many TDS articles with it (e.g. </em><a class="af nc" rel="noopener" target="_blank" href="/functions-dags-introducing-hamilton-a-microframework-for-dataframe-generation-more-8e34b84efc1d"><em class="ph">origin story</em></a><em class="ph">, </em><a class="af nc" rel="noopener" target="_blank" href="/llmops-production-prompt-engineering-patterns-with-hamilton-5c3a20178ad2"><em class="ph">Production prompt engineering</em></a><em class="ph">, </em><a class="af nc" href="https://medium.com/towards-data-science/simplify-airflow-dag-creation-and-maintenance-with-hamilton-in-8-minutes-e6e48c9c2cb0" rel="noopener"><em class="ph">Simplifying Airflow DAG Creation &amp; Maintenance</em></a>,<em class="ph"> </em><a class="af nc" href="https://medium.com/towards-data-science/tidy-production-pandas-with-hamilton-3b759a2bf562" rel="noopener"><em class="ph">Tidy Production Pandas</em></a>,<em class="ph"> etc.) as well as </em><a class="af nc" href="https://www.tryhamilton.dev/" rel="noopener ugc nofollow" target="_blank"><em class="ph">https://www.tryhamilton.dev/</em></a><em class="ph">.</em></p><p id="14e3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><a class="af nc" href="https://github.com/dagworks-inc/hamilton" rel="noopener ugc nofollow" target="_blank">Hamilton</a> is an open source tool that we created at Stitch Fix back in 2019. Hamilton helps data scientists and engineers define testable, modular, self-documenting dataflows, that encode lineage and metadata. Hamilton achieves these traits in part by requiring Python functions to be curated into modules.</p><p id="f7f1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Nonetheless, the typical Jupyter notebook usage pattern leads to code residing in the notebook and nowhere else posing a developer ergonomics challenge:</p><blockquote class="pe pf pg"><p id="ce87" class="nz oa ph ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><strong class="ob fr"><em class="fq">How can we enable someone to create Python modules easily and quickly from a notebook, while also improving the development experience?</em></strong></p></blockquote><p id="61c1" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The Hamilton developer loop looks like the following:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pq"><img src="../Images/b08c25854dbcff9a783f416a19bac357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kUgUwmQKnNpDkZBE.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Hamilton development loop. Image by author.</figcaption></figure><p id="6988" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Take a minute to read this loop. The loop shows that anytime a code change is made, the user would need to not only re-import the Python module, but also recreate the Driver object as well. Since notebooks allow cell execution in any order, it can become difficult for the user to track which version is loaded for each module and what is currently loaded in a Driver. This burden lies on the user and might require restarting the kernel, which would lose other computations (thankfully, Hamilton can be set up to execute complex dataflows and resume where you left-off…), which is less than ideal.</p><p id="7bd8" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Here’s how we could improve this loop using Magics:</p><ol class=""><li id="0840" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pr ps pt bk">Create a “temporary” Python module from the functions defined in a cell, and import this new module directly in the notebook.</li><li id="bcd7" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pr ps pt bk">Automatically visualize the directed acyclic graph (DAG) defined by the functions to reduce visualization boilerplate code.</li><li id="28fd" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pr ps pt bk">Rebuild all Hamilton Drivers found in the notebook with updated modules, saving the user time to have to remember to manually recreate drivers to pick up the change.</li></ol><h1 id="09d6" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">What we’re going to implement</h1><p id="7210" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">We would like a command that looks like this:</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="056c" class="pl ne fq pd b bg pm pn l po pp">%%cell_to_module -m my_module --display --rebuild-drivers<br/><br/>def my_func(some_input: str) -&gt; str:<br/>  """Some logic"""<br/>  return ...</span></pre><p id="cdf3" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">And cause the following behavior after running the cell:</p><ul class=""><li id="e771" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pz ps pt bk">Create a module with the name my_module in the notebook.</li><li id="0835" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pz ps pt bk">Display the DAG constructed by the functions within the cell.</li><li id="3a83" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pz ps pt bk">Rebuild any downstream drivers that used my_module in <em class="ph">other cells,</em> saving the user having to re-run those cells.</li></ul><p id="80c0" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">As you can see this is a non-trivial Magic command, since we’re adjusting output of the cell and state of the notebook.</p><h1 id="c020" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Building a Custom Magic Command</h1><p id="456d" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Here we lay out step by step how to create a Magic Command. To avoid only showing a trivial “hello world” example, we’ll explain how we built Hamilton’s <code class="cx pa pb pc pd b">%%cell_to_module</code> magic as well.</p><h1 id="2c9f" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Step 1: Setting up your code</h1><p id="d67e" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Create a new Python module where we’ll write the magic code and a jupyter notebook to try it. The name of this module (i.e., `.py` file) will be the name of the extension you’ll need to load.</p><p id="419f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">If Jupyter notebook is installed, you have all the required Python dependencies already. Then, add libraries you will need for your Magic, in our case Hamilton (`<code class="cx pa pb pc pd b">pip install sf-hamilton[visualization]</code>`).</p><h1 id="6dc9" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Step 2: Define your Magic Command</h1><p id="5d63" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">To define a simple Magic command, you can use functions or objects (<a class="af nc" href="https://ipython.readthedocs.io/en/stable/config/custommagics.html" rel="noopener ugc nofollow" target="_blank">see these docs</a>). For more complex Magics where state is needed, you will need the class approach. We’ll use the class based approach here. To start we need to import IPython modules/functions and then define a class that inherits <code class="cx pa pb pc pd b">magic.Magics</code>. Each method decorated with <code class="cx pa pb pc pd b">@cell_magic</code> or <code class="cx pa pb pc pd b">@line_magic</code> defines a new magic, and the class can house however many of them.</p><p id="5da7" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To start, your code should look like this at a high level:</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="c877" class="pl ne fq pd b bg pm pn l po pp"># my_magic.py<br/><br/>from IPython.core import magic<br/>from IPython.core.magic_arguments import argument, magic_arguments, parse_argstring<br/>@magic.magics_class<br/>class MyMagic(magic.Magics):<br/>   """Custom class you write"""<br/>   @magic_arguments() # needs to be on top to enable parsing<br/>   @argument(...)   <br/>   @magic.cell_magic<br/>   def a_cell_magic_command(self, line, cell):<br/>      ...<br/>   @magic_arguments() # needs to be on top to enable parsing<br/>   @argument(...)   <br/>   @magic.line_magic<br/>   def a_line_magic_command(self, line):<br/>     ...</span></pre><p id="a1a0" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">For stateful magic, it can be useful to add an <code class="cx pa pb pc pd b">__init__()</code> method (i.e. constructor). It is not needed in our case.</p><p id="cc88" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">By inheriting from `magic.Magics`, this class has access to several important fields including self.shell, which is the <a class="af nc" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.interactiveshell.html#IPython.core.interactiveshell.InteractiveShell" rel="noopener ugc nofollow" target="_blank">IPython InteractiveShell</a> that underlies the notebook. Using it allows you to pull and introspect variables loaded in the active Jupyter notebook.</p><p id="ef29" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Our Hamilton Magic Command will start off looking like:</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="595d" class="pl ne fq pd b bg pm pn l po pp">from IPython.core import magic<br/>from IPython.core.magic_arguments import argument, magic_arguments, parse_argstring<br/><br/>@magic.magics_class<br/>class HamiltonMagics(magic.Magics):<br/>    """Magics to facilitate Hamilton development in Jupyter notebooks"""<br/>  @magic_arguments()  # needed on top to enable parsing<br/>  @arguments(...)<br/>  @magics.cell_magic<br/>  def cell_to_module(self, line, cell):<br/>    ...</span></pre><h1 id="3f9a" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Step 3: Parsing input arguments</h1><p id="764c" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Next, we specify what arguments will be passed and how to parse them. For each argument, add a <em class="ph">@argument</em>, and add a <em class="ph">@magic_arguments()</em> decorator on top. They follow a similar pattern to <a class="af nc" href="https://docs.python.org/3/library/argparse.html" rel="noopener ugc nofollow" target="_blank">argparse</a> arguments if you’re familiar, but they aren’t quite as fully featured. Within the function, you need to call the <em class="ph">parse_argstring()</em> function. It receives the function itself to read instructions from the decorators, and `<em class="ph">line</em>` (the one with <code class="cx pa pb pc pd b">%</code> or <code class="cx pa pb pc pd b">%%</code>) which contains the arguments values.</p><p id="498e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Our command would start to look like this:</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="56b9" class="pl ne fq pd b bg pm pn l po pp">@magic_arguments() # needs to be on top to enable parsing<br/># flag, long form, default value, help string.<br/>@argument("-a", "--argument", default="some_value", help="Some optional line argument")   <br/>@magic.cell_magic<br/>def a_cell_magic_command(self, line, cell):<br/>   args = parse_argstring(self.a_cell_magic_command, line)<br/>   if args.argument:<br/>      # do stuff -- place your utility functions here</span></pre><p id="a531" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Note, for required arguments, there is no facility in <em class="ph">magic_arguments()</em> for that, so you need to manually check in the body of the function for correctness, etc.</p><p id="bb09" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Continuing our dissection of the Hamilton Magic example, the method on the class now looks like the following; we use many optional arguments:</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="1ba0" class="pl ne fq pd b bg pm pn l po pp">@magic_arguments()  # needed on top to enable parsing<br/>@argument(<br/>    "-m", "--module_name", help="Module name to provide. Default is jupyter_module."<br/>)  # keyword / optional arg<br/>@argument(<br/>    "-c", "--config", help="JSON config, or variable name containing config to use."<br/>)  # keyword / optional arg<br/>@argument(<br/>    "-r", "--rebuild-drivers", action="store_true", help="Flag to rebuild drivers"<br/>)  # Flag / optional arg<br/>@argument(<br/>    "-d", "--display", action="store_true", help="Flag to visualize dataflow."<br/>)  # Flag / optional arg<br/>@argument(<br/>    "-v", "--verbosity", type=int, default=1, help="0 to hide. 1 is normal, default"<br/>)  # keyword / optional arg<br/>@magics.cell_magic<br/>def cell_to_module(self, line, cell):<br/>    """Execute the cell and dynamically create a Python module from its content.<br/><br/>     A Hamilton Driver is automatically instantiated with that module for variable `{MODULE_NAME}_dr`.<br/>        &gt; %%cell_to_module -m MODULE_NAME --display --rebuild-drivers<br/>    Type in ?%%cell_to_module to see the arugments to this magic.<br/>    """<br/>    # specify how to parse by passing <br/>    args = parse_argstring(self.cell_to_module, line)  <br/>    # now use args for logic ...</span></pre><p id="4b29" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Note, the extra arguments to <em class="ph">@argument</em> are useful for when someone uses <code class="cx pa pb pc pd b">?</code> to query what the magic does. I.e. <code class="cx pa pb pc pd b">?%%cell_to_module</code> will show documentation.</p><h1 id="9ee3" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Step 4: Implement the Command’s Logic</h1><p id="d324" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Now that we have parsed the arguments, we can implement the logic of the magic command. There aren’t any particular constraints here and you can write any Python code. Skipping a generic example (you have enough to get started from the prior step), let’s dig into our Hamilton Magic example. For it, we want to use the arguments to determine the desired behavior for the command:</p><ol class=""><li id="0cee" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pr ps pt bk">Create the Python module with <em class="ph">module_name</em>.</li><li id="662d" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pr ps pt bk">If <em class="ph">— rebuild-driver</em>, rebuild the drivers, passing in verbosity.</li><li id="5600" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pr ps pt bk">If <em class="ph">— config</em> is present, get that ready.</li><li id="3647" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pr ps pt bk">If <em class="ph">— display</em>, display the DAG.</li></ol><p id="84ff" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">See comments in the code for explanations:</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="a472" class="pl ne fq pd b bg pm pn l po pp"># we're in the bowels of def cell_to_module(self, line, cell):<br/># and we remove an indentation for readability<br/>...<br/># specify how to parse by passing this method to the function <br/>args = parse_argstring(self.cell_to_module, line)<br/># we set a default value, else use the passed in value <br/># for the module name.<br/>if args.module_name is None:<br/>    module_name = "jupyter_module"<br/>else:<br/>    module_name = args.module_name<br/># we determine whether the configuration is a variable<br/># in the notebook environment<br/># or if it's a JSON string that needs to be parsed.<br/>display_config = {}<br/>if args.config:<br/>    if args.config in self.shell.user_ns:<br/>        display_config = self.shell.user_ns[args.config]<br/>else:<br/>    if args.config.startswith("'") or args.config.startswith('"'):<br/>        # strip quotes if present<br/>        args.config = args.config[1:-1]<br/>    try:<br/>        display_config = json.loads(args.config)<br/>    except json.JSONDecodeError:<br/>        print("Failed to parse config as JSON. "<br/>              "Please ensure it's a valid JSON string:")<br/>        print(args.config)<br/># we create the python module (using a custom function)<br/>module_object = create_module(cell, module_name)<br/># shell.push() assign a variable in the notebook. <br/># The dictionary keys are the variable name<br/>self.shell.push({module_name: module_object})<br/># Note: self.shell.user_ns is a dict of all variables in the notebook<br/># -- we pass that down via self.shell.<br/>if args.rebuild_drivers:<br/>    # rebuild drivers that use this module (custom function)<br/>    rebuilt_drivers = rebuild_drivers(<br/>        self.shell, module_name, module_object, <br/>        verbosity=args.verbosity<br/>    )<br/>    self.shell.user_ns.update(rebuilt_drivers)<br/># create a driver to display things for every cell with %%cell_to_module<br/>dr = (<br/>    driver.Builder()<br/>    .with_modules(module_object)<br/>    .with_config(display_config)<br/>    .build()<br/>)<br/>self.shell.push({f"{module_name}_dr": dr})<br/>if args.display:<br/>    # return will go to the output cell. <br/>    # To display multiple elements, use IPython.display.display(<br/>    # print("hello"), dr.display_all_functions(), ... )<br/>    return dr.display_all_functions()</span></pre><p id="4557" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Notice how we use <code class="cx pa pb pc pd b">self.shell</code>. This allows us to update and inject variables into the notebook. The values returned by the function will be used as “cell output” (where you see printed values).</p><h1 id="4bbb" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Step 5: Register your Magic Command</h1><p id="c620" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Lastly, we need to tell IPython and the notebook about the Magic Command. Our module where our Magic is defined must have the following function to register our Magic class, and be able to load our extension. If doing anything stateful, this is where you’d instantiate it.</p><p id="9976" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Notice that the argument `ipython` here is the same InteractiveShell available through <code class="cx pa pb pc pd b">self.shell</code> in the class method we defined.</p><pre class="mm mn mo mp mq pi pd pj bp pk bb bk"><span id="d4db" class="pl ne fq pd b bg pm pn l po pp">def load_ipython_extension(ipython: InteractiveShell):<br/>  """<br/>  Any module file that define a function named `load_ipython_extension`<br/>  can be loaded via `%load_ext module.path` or be configured to be<br/>  autoloaded by IPython at startup time.<br/>  """<br/>  ipython.register_magics(MyMagic)<br/>  ipython.register_magics(HamiltonMagics)</span></pre><p id="2d55" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">See the full <a class="af nc" href="https://github.com/DAGWorks-Inc/hamilton/blob/main/hamilton/plugins/jupyter_magic.py" rel="noopener ugc nofollow" target="_blank">Hamilton Magic Command here</a>.</p><h1 id="5949" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Try it out</h1><p id="f0c3" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">To load your magic in the notebook, try the following:</p><p id="9b16" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><code class="cx pa pb pc pd b">%load_ext my_magic</code></p><p id="2fef" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">in the case of our Hamilton Magic we’d load it via:</p><p id="e60f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><code class="cx pa pb pc pd b">%load_ext hamilton.plugins.jupyter_magic</code></p><p id="c6ba" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">While you’re developing, use this to reload your updated magic without having to restart the notebook kernel.</p><p id="242e" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><code class="cx pa pb pc pd b">%reload_ext my_magic</code></p><p id="88b0" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You can then invoke the magic commands defined on a per line or cell basis. So for the Hamilton one we’d now be able to do:</p><p id="718f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk"><code class="cx pa pb pc pd b">%%?cell_to_module</code></p><p id="c276" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Here’s an example use of it, with it injecting the visualization:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qa"><img src="../Images/d7005592ce1910bd5c6144271f319361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/0*KqzsezRGWbQ8OpIk.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Example showing the magic in action.</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qb"><img src="../Images/678f3c262e4d8d42f81b65d8bcee585f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*BTV4H6qeqoRBEzOn.gif"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Animated gif of adding functions and hitting enter to refresh the image.</figcaption></figure><h1 id="4de4" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">What you’d do next</h1><p id="7081" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">In a real world use case, you would most likely version and package your magic likely into a library, that you can then manage easily in python environments as required. With the Hamilton Magic Command it’s packaged into the Hamilton library, and thus to get it, one need only install sf-hamilton and loading the magic command would become accessible in the notebook.</p><h1 id="1e6e" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">To close</h1><p id="ee4a" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">In this post we showed you the steps required to create and load your own IPython Jupyter Magic Command. Hopefully you’re now thinking of the common cells/task/actions that you perform in a notebook setting, which could be enhanced/simplified/or even removed with the addition of a simple Magic!</p><p id="d584" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">To demonstrate a real-life example, we motivated and showed the internals of a Hamilton Magic Command to show a command that was built to improve the developer experience within a Jupyter notebook, by augmenting the output and changing internal state.</p><p id="e3fb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">We hope that this post helps you get over the hump and create something more ergonomic and useful for you and your teams’ Jupyter Notebook experience.</p><h1 id="2b43" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Some other resources</h1><ul class=""><li id="c209" class="nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou pz ps pt bk"><a class="af nc" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html" rel="noopener ugc nofollow" target="_blank">Built-in magic commands — IPython 8.21.0 documentation</a></li><li id="d285" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pz ps pt bk"><a class="af nc" href="https://ipython.readthedocs.io/en/stable/config/custommagics.html" rel="noopener ugc nofollow" target="_blank">Defining custom magics — IPython 8.21.0 documentation</a></li><li id="e9d7" class="nz oa fq ob b go pu od oe gr pv og oh oi pw ok ol om px oo op oq py os ot ou pz ps pt bk"><a class="af nc" href="https://ipython-books.github.io/14-creating-an-ipython-extension-with-custom-magic-commands/" rel="noopener ugc nofollow" target="_blank">1.4. Creating an IPython extension with custom magic commands</a></li></ul></div></div></div></div>    
</body>
</html>