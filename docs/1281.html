<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Marketing Science 101: How to Analyze Geo-Based Campaigns With Synthetic Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Marketing Science 101: How to Analyze Geo-Based Campaigns With Synthetic Control</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-analyze-geo-based-campaigns-with-synthetic-control-a90b839479a8?source=collection_archive---------8-----------------------#2024-05-22">https://towardsdatascience.com/how-to-analyze-geo-based-campaigns-with-synthetic-control-a90b839479a8?source=collection_archive---------8-----------------------#2024-05-22</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="ae8e" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Using Meta’s GeoLift Library</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@mandymliu?source=post_page---byline--a90b839479a8--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Mandy Liu" class="l ep by dd de cx" src="../Images/ca4530dd41121dc7ab6d1ec9134bb08d.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*NhlnVldTfFKDMskdpEAmUQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--a90b839479a8--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@mandymliu?source=post_page---byline--a90b839479a8--------------------------------" rel="noopener follow">Mandy Liu</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--a90b839479a8--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">6 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">May 22, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/35d2615d2d8eab8cdb7d716962c85c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wr-1jh_Iua4FSno6"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@dead____artist?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Z</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9227" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><em class="nz">(If you are not a Medium member, read the full story </em><a class="af nc" href="https://medium.com/towards-data-science/how-to-analyze-geo-based-campaigns-with-synthetic-control-a90b839479a8?sk=41d22feddba967359a2c1471215a6212" rel="noopener"><em class="nz">here</em></a><em class="nz">)</em></p><p id="2deb" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Navigating the complexities of location-based testing can be challenging.</p><p id="ff95" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Luckily, <a class="af nc" href="https://facebookincubator.github.io/GeoLift/docs/intro" rel="noopener ugc nofollow" target="_blank">GeoLift</a> is here to optimize the process.</p><p id="9a45" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Developed by Meta’s Marketing Science team, this open-sourced library is designed for conducting geo-based experiments. It enables us to:</p><ol class=""><li id="7ab6" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny oa ob oc bk">Effortlessly select test markets, and</li><li id="2d1d" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny oa ob oc bk">Generate a synthetic control market to benchmark against your chosen test locations</li></ol><p id="b025" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">While the GeoLift documentation offers a comprehensive guide on selecting test markets, this article will focus specifically on <strong class="nf fr">how to create and utilize a synthetic control market</strong>.</p><p id="6d3b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Let’s dive in.</p><h1 id="651b" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Synthetic control method (SCM)</h1><p id="ac47" class="pw-post-body-paragraph nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny fj bk">The graphs illustrate the comparison between the “difference in difference” method and the synthetic control method (SCM).</p></div></div><div class="mr"><div class="ab cb"><div class="lm pj ln pk lo pl cf pm cg pn ci bh"><div class="mm mn mo mp mq ab ke"><figure class="lb mr po pp pq pr ps paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><img src="../Images/0e3507b10492d1be57b427f2fb35c480.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*sUvStoj0LfH2iNVfHwkhvg.png"/></div></figure><figure class="lb mr pt pp pq pr ps paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><img src="../Images/374975efcbf4583aa6c8008deaaf0a9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*peGaG7PnAlgpYNnB-cd8QA.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx pu ed pv pw">Generated by Author using ChatGPT x Wolfram</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="11f3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">According to Wikipedia, SCM</p><blockquote class="px"><p id="6efc" class="py pz fq bf qa qb qc qd qe qf qg ny dx">is designed to estimate the potential outcomes for a treatment group had the treatment not been applied. Unlike the difference in differences approach, SCM adjusts for time-varying confounders by weighting the control group to closely resemble the treatment group prior to the intervention</p></blockquote><p id="9e70" class="pw-post-body-paragraph nd ne fq nf b go qh nh ni gr qi nk nl nm qj no np nq qk ns nt nu ql nw nx ny fj bk">Simply put, SCM constructs a “parallel universe” that allows you to <strong class="nf fr">observe potential outcomes if the campaign had not been launched</strong>, enabling a clear comparison and measurement of the campaign’s true incremental effects</p><h1 id="8062" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Streamlined guide to creating synthetic control</h1><p id="b492" class="pw-post-body-paragraph nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny fj bk"><strong class="nf fr">1. Process data</strong></p><p id="80e0" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">2. Generate weights</strong></p><p id="442c" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">3. Visualize synthetic control</strong></p><p id="02df" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">4. Measure lift</strong></p><p id="9f5c" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The first two steps are detailed in the GeoLift documentation. I’ll include the code and output here for consistency.</p><p id="83ff" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We’ll execute the initial steps in R and the final two in Python.</p><p id="5e62" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">If you’re primarily a Python user, don’t worry — the R code is straightforward and easy to follow. I promise it will be a breeze!</p><h1 id="7e9d" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">1. Process data</h1><p id="4403" class="pw-post-body-paragraph nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny fj bk"><strong class="nf fr">What your data should look like:</strong></p><ul class=""><li id="7c41" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Daily or weekly granularity</li><li id="f493" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">At least 4–5x the test duration of pre-campaign historical data</li><li id="37a8" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">20 or more geo-units</li><li id="1819" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">More on <a class="af nc" href="https://facebookincubator.github.io/GeoLift/docs/Best%20Practices/BestPractices" rel="noopener ugc nofollow" target="_blank">best practices</a></li></ul><p id="2a2d" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Install packages:</strong></p><ul class=""><li id="9564" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Install R and RStudio <a class="af nc" href="https://posit.co/download/rstudio-desktop/" rel="noopener ugc nofollow" target="_blank">here</a></li><li id="9871" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">Install GeoLift package <a class="af nc" href="https://facebookincubator.github.io/GeoLift/docs/GettingStarted/InstallingR" rel="noopener ugc nofollow" target="_blank">here</a></li></ul><p id="711b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Load data:</strong></p><ul class=""><li id="efb0" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Load GeoLift data included in GeoLift package into R. The data is simulated of 40 US cities across 90 days, from 2021–01–01 to 2021–03–31</li></ul><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="f292" class="qr oj fq qo b bg qs qt l qu qv">library(GeoLift)<br/><br/>data(GeoLift_PreTest)</span></pre><ul class=""><li id="af3b" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Check data</li></ul><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="55af" class="qr oj fq qo b bg qs qt l qu qv">&gt; head(GeoLift_PreTest)<br/>  location    Y       date<br/>1 new york 3300 2021-01-01<br/>2 new york 3202 2021-01-02<br/>3 new york 4138 2021-01-03<br/>4 new york 3716 2021-01-04<br/>5 new york 3270 2021-01-05<br/>6 new york 3260 2021-01-06</span></pre><ul class=""><li id="dbf5" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Format data</li></ul><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="494e" class="qr oj fq qo b bg qs qt l qu qv">GeoTestData_PreTest &lt;- GeoDataRead(data = GeoLift_PreTest,<br/>                                   date_id = "date",<br/>                                   location_id = "location",<br/>                                   Y_id = "Y",<br/>                                   X = c(), #empty list as we have no covariates<br/>                                   format = "yyyy-mm-dd",<br/>                                   summary = TRUE)<br/><br/>##################################<br/>#####       Summary       #####<br/>##################################<br/>* Raw Number of Locations: 40<br/>* Time Periods: 90<br/>* Final Number of Locations (Complete): 40</span></pre><ul class=""><li id="3c51" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk"><em class="nz">Y_id</em> is your key performance indicator, such as revenue or active user count.</li><li id="4cf3" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk"><em class="nz">X = c()</em> allows you to include optional covariates that dynamically correlate with your objective metric, such as user retention, rather than static metrics like city population or median income.</li></ul><h1 id="af35" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">2. Generate weights</h1><p id="927b" class="pw-post-body-paragraph nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny fj bk">Let’s say our experiment is going to be in Austin, Texas. Our objective is to create a synthetic control that closely mirrors Austin’s conditions before the experiment begins.</p><p id="35b2" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Create weights:</strong></p><ul class=""><li id="fc6c" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Specify Austin as test city</li></ul><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="fb49" class="qr oj fq qo b bg qs qt l qu qv">weights &lt;- GetWeights(Y_id = "Y",<br/>                          location_id = "location",<br/>                          time_id = "time",<br/>                          data = GeoTestData_PreTest,<br/>                          locations = c("austin"),<br/>                          pretreatment_end_time = 90,<br/>                          fixed_effects = TRUE)</span></pre><ul class=""><li id="5851" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk"><em class="nz">pretreatment_end_time = 90 </em>uses the 90 days of historical data before the test begins to synthesize a control city. Adjust this duration as needed to fit your experiment</li><li id="d56e" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">To test in multiple cities, specify them in <em class="nz">locations</em>, for example, <em class="nz">locations = c(“austin”, “dallas”)</em></li></ul><p id="bfc0" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">To exclude any markets from control:</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="9d23" class="qr oj fq qo b bg qs qt l qu qv">exclude_markets &lt;- c("honolulu","washington")<br/>GeoTestData_PreTest_Excl &lt;- subset(GeoTestData_PreTest, !location %in% exclude_markets)</span></pre><p id="6b89" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Then feed <em class="nz">GeoTestData_PreTest_Excl</em> into the <em class="nz">GetWeights</em> function above.</p><p id="d50a" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Display top weights:</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="0e64" class="qr oj fq qo b bg qs qt l qu qv">&gt; head(dplyr::arrange(weights, desc(weight)))<br/>     location     weight<br/>1  cincinnati 0.35232541<br/>2     detroit 0.27955009<br/>3    honolulu 0.12960818<br/>4 minneapolis 0.10951033<br/>5    portland 0.06265098<br/>6 san antonio 0.01844960</span></pre><p id="55c3" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Download weights and market data to csv:</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="b3ab" class="qr oj fq qo b bg qs qt l qu qv">write.csv(weights, "/Users/mandyliu/Documents/R/geolift_weights.csv", row.names=FALSE)<br/>write.csv(GeoLift_PreTest, "/Users/mandyliu/Documents/R/market_data.csv", row.names=FALSE)</span></pre><h1 id="b864" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">3. Visualize synthetic control</h1><p id="183a" class="pw-post-body-paragraph nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny fj bk">Now that we have the weights file, we’ll create a synthetic control geo to compare against our test market, Austin.</p><p id="3faf" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Set up:</strong></p><ul class=""><li id="7691" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Import packages in Python</li></ul><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="2c70" class="qr oj fq qo b bg qs qt l qu qv">import pandas as pd<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>from datetime import datetime, timedelta, date</span></pre><ul class=""><li id="d9fe" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Read data</li></ul><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="90f2" class="qr oj fq qo b bg qs qt l qu qv">df_weights = pd.read_csv('/Users/mandyliu/Documents/R/geolift_weights.csv')  <br/>df_markets = pd.read_csv('/Users/mandyliu/Documents/R/market_data.csv')</span></pre></div></div><div class="mr"><div class="ab cb"><div class="lm pj ln pk lo pl cf pm cg pn ci bh"><div class="mm mn mo mp mq ab ke"><figure class="lb mr qw pp pq pr ps paragraph-image"><img src="../Images/cac3289e17affc0face75ec36d0a873f.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*shc-FEGE0Ep14RAMM2Cq8A.png"/></figure><figure class="lb mr qx pp pq pr ps paragraph-image"><img src="../Images/cdf25bd7dfd363629c72bd8b784ac7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*9wTIZ2MqFW9YStUlsmce9A.png"/><figcaption class="mx my mz mj mk na nb bf b bg z dx qy ed qz pw">Created by author in Jupyter notebook</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="c2e1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Combine weights and cities together to create a single control:</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="47a8" class="qr oj fq qo b bg qs qt l qu qv"># convert to pandas datetime<br/>df_markets['date']=pd.to_datetime(df_markets['date'],format = '%Y-%m-%d')<br/><br/># combine control markets with weights<br/>df_markets_weights = df_markets.merge(df_weights, on='location')<br/>df_markets_weights['weighted_Y'] = df_markets_weights['Y'] * df_markets_weights['weight']<br/><br/># sum weighted_Y by date to create a single synthetic control city<br/>df_syn_control = df_markets_weights.groupby('date').sum('weighted_Y')\<br/>.reset_index()[['date','weighted_Y']].rename(columns = {'weighted_Y':'Y'})<br/>df_syn_control['location'] = 'syn_control'<br/><br/># append Austin data to syn control<br/>df_markets_austin = df_markets[df_markets['location']=='austin'].reset_index(drop = True)<br/>df_syn_control_austin = pd.concat([df_markets_austin,df_syn_control],ignore_index = True)</span></pre><p id="fb76" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Visualize Austin vs. synthetic control</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="2ada" class="qr oj fq qo b bg qs qt l qu qv">sns.lineplot(data=df_syn_control_austin, x="date", y="Y",hue = 'location',palette=['purple', 'pink'])<br/>plt.xticks(rotation=45)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ra"><img src="../Images/ab8e346385d8339fdfa3a609e2d6e775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3rkhwyq-Z2X7Rco1kBLUw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Created by author in Jupyter notebook</figcaption></figure><p id="c8e9" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Check correlation:</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="0419" class="qr oj fq qo b bg qs qt l qu qv">df_corr = df_syn_control[['date','Y']].merge(df_markets_austin[['date','Y']],on = 'date')<br/>df_corr['Y_x'].corr(df_corr['Y_y'])</span></pre><p id="f107" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">The correlation between Austin and the synthetic control stands at <em class="nz">0.950 </em>— solid!</p><h1 id="fce8" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Measure lift</h1><p id="1aa5" class="pw-post-body-paragraph nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny fj bk">There is a slight twist.</p><p id="e2a1" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Although Austin and its control show high correlation, the graph reveals that the control consistently registers higher values.</p><p id="7890" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">To facilitate a straightforward comparison, we can apply a multiplier to align the pre-launch values.</p><p id="b2d9" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Create multiplier:</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="b9d6" class="qr oj fq qo b bg qs qt l qu qv"># create multiplier<br/>austin_Y = df_markets_austin.loc[df_markets_austin['date']==df_markets_austin['date'].max(),'Y'].iloc[0]<br/>syn_control_Y = df_syn_control.loc[df_syn_control['date']==df_syn_control['date'].max(),'Y'].iloc[0]<br/><br/>M = austin_Y/syn_control_Y</span></pre><p id="c31b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><em class="nz">M = 0.9556415990151904</em></p><p id="bbc9" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Simulate post-launch data:</strong></p><ul class=""><li id="fd30" class="nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny qm ob oc bk">Create two weeks’ data after launch date on 2021–04–01</li></ul><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="b861" class="qr oj fq qo b bg qs qt l qu qv"># create a list of dates<br/>date_list = []<br/>start_date = df_markets_austin['date'].max()<br/><br/>k = 15<br/>for day in range(1,k):<br/>    date = start_date + timedelta(days=day)<br/>    date_list.append(date)<br/><br/># create fake austin data post-launch<br/>data_austin_new = {<br/>    "date":date_list, <br/>    "Y":   df_markets_austin.tail(14)['Y'].values*1.2, #assuming a 20% lift<br/>    "location":  ['austin'] * 14<br/>}<br/>df_austin_new = pd.DataFrame(data_austin_new)<br/>df_markets_austin_test = pd.concat([df_markets_austin,df_austin_new])<br/><br/># create fake synthetic control data post-launch<br/>data_syn_control_new = {<br/>    "date":date_list, <br/>    "Y":   df_syn_control.tail(14)['Y'].values, <br/>    "location":  ['syn_control'] * 14<br/>}<br/>df_syn_control_new = pd.DataFrame(data_syn_control_new)<br/>df_syn_control_test = pd.concat([df_syn_control,df_syn_control_new])<br/><br/>#adjust synthetic control with multiplier M<br/>df_syn_control_adj = df_syn_control_test.copy()<br/>df_syn_control_adj['Y'] = df_syn_control_adj['Y']*M<br/><br/># combine austin and adjusted control data<br/>df_syn_control_austin_adj = pd.concat([df_markets_austin_test,df_syn_control_adj]\<br/>                                      ,ignore_index = True)</span></pre><p id="928b" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><strong class="nf fr">Visualize Austin vs. adjusted control:</strong></p><pre class="mm mn mo mp mq qn qo qp bp qq bb bk"><span id="db55" class="qr oj fq qo b bg qs qt l qu qv">ax = sns.lineplot(data=df_syn_control_austin_adj, x="date", y="Y",hue = 'location',palette=['purple', 'pink'])<br/>ax.axvline(x = date(2021,3,31),c='b', linestyle = "dashed")<br/>plt.xticks(rotation=45)</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rb"><img src="../Images/e0032aafd669b12d6e589c5163de86f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LBqkYslOBqy8YvudOVSjhA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Created by author in Jupyter notebook</figcaption></figure><p id="9976" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">We’ve created a compelling graph that beautifully illustrates the different before and after launch!</p><h1 id="71d8" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Take-away</h1><p id="b075" class="pw-post-body-paragraph nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny fj bk">While real-life data may be more complex, comparing the test market and synthetic control enables us to observe incremental lift over time</p><p id="2a2f" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">Since we use historical data to calibrate the control group closely to the treatment group before intervention, the synthetic method often yields more reliable and interpretable results than the difference in difference approach.</p><h1 id="b224" class="oi oj fq bf ok ol om gq on oo op gt oq or os ot ou ov ow ox oy oz pa pb pc pd bk">Resources</h1><ul class=""><li id="18ee" class="nd ne fq nf b go pe nh ni gr pf nk nl nm pg no np nq ph ns nt nu pi nw nx ny qm ob oc bk">Github <a class="af nc" href="https://github.com/mandymliu/geolift" rel="noopener ugc nofollow" target="_blank">link</a> for everything in this note</li><li id="7747" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">Meta GeoLift <a class="af nc" href="https://facebookincubator.github.io/GeoLift/blog" rel="noopener ugc nofollow" target="_blank">blog</a></li><li id="83f9" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">Meta GeoLift <a class="af nc" href="https://github.com/facebookincubator/GeoLift/tree/GeoLiftPython" rel="noopener ugc nofollow" target="_blank">github</a></li><li id="b083" class="nd ne fq nf b go od nh ni gr oe nk nl nm of no np nq og ns nt nu oh nw nx ny qm ob oc bk">GeoLift user Facebook <a class="af nc" href="https://www.facebook.com/groups/1225502237950330" rel="noopener ugc nofollow" target="_blank">group</a></li></ul></div></div></div><div class="ab cb rc rd re rf" role="separator"><span class="rg by bm rh ri rj"/><span class="rg by bm rh ri rj"/><span class="rg by bm rh ri"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="f788" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk">You might also enjoy this:</p><div class="rk rl rm rn ro rp"><a rel="noopener follow" target="_blank" href="/3-painful-mistakes-i-made-as-a-junior-data-scientist-df06b9513b47?source=post_page-----a90b839479a8--------------------------------"><div class="rq ab ig"><div class="rr ab co cb rs rt"><h2 class="bf fr hw z io ru iq ir rv it iv fp bk">3 Painful Mistakes I Made as a Junior Data Scientist</h2><div class="rw l"><h3 class="bf b hw z io ru iq ir rv it iv dx">Learn from them to fast-track your career today</h3></div><div class="rx l"><p class="bf b dy z io ru iq ir rv it iv dx">towardsdatascience.com</p></div></div><div class="ry l"><div class="rz l sa sb sc ry sd lr rp"/></div></div></a></div><p id="0360" class="pw-post-body-paragraph nd ne fq nf b go ng nh ni gr nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny fj bk"><em class="nz">Connect with me: </em><a class="af nc" href="https://x.com/Mandy_L_" rel="noopener ugc nofollow" target="_blank"><em class="nz">Twitter/X</em></a><em class="nz"> | </em><a class="af nc" href="https://www.linkedin.com/in/mandy-liu-2551724a/" rel="noopener ugc nofollow" target="_blank"><em class="nz">LinkedIn</em></a></p></div></div></div></div>    
</body>
</html>