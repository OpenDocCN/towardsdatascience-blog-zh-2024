<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>How to Easily Validate Your Data with Pandera</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>How to Easily Validate Your Data with Pandera</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-easily-validate-your-data-with-pandera-a9cd22c515a5?source=collection_archive---------7-----------------------#2024-08-14">https://towardsdatascience.com/how-to-easily-validate-your-data-with-pandera-a9cd22c515a5?source=collection_archive---------7-----------------------#2024-08-14</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="62c7" class="pw-subtitle-paragraph gr fp fq bf b gs gt gu gv gw gx gy gz ha hb hc hd he hf hg cq dx">Learn how to build a simple data model that validates your data through type hints</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hh hi hj hk hl ab"><div><div class="ab hm"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@conalhenderson?source=post_page---byline--a9cd22c515a5--------------------------------" rel="noopener follow"><div class="l hn ho by hp hq"><div class="l ed"><img alt="Conal Henderson" class="l ep by dd de cx" src="../Images/e10624264efc3861a2384493fa5ee55a.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*XoKsrulCAfjIFoF754QKYw.jpeg"/><div class="hr by l dd de em n hs eo"/></div></div></a></div></div><div class="ht ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--a9cd22c515a5--------------------------------" rel="noopener follow"><div class="l hu hv by hp hw"><div class="l ed"><img alt="Towards Data Science" class="l ep by br hx cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hr by l br hx em n hs eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hy ab q"><div class="ab q hz"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ia ib bk"><a class="af ag ah ai aj ak al am an ao ap aq ar ic" data-testid="authorName" href="https://medium.com/@conalhenderson?source=post_page---byline--a9cd22c515a5--------------------------------" rel="noopener follow">Conal Henderson</a></p></div></div></div><span class="id ie" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b ia ib dx"><button class="if ig ah ai aj ak al am an ao ap aq ar ih ii ij" disabled="">Follow</button></p></div></div></span></div></div><div class="l ik"><span class="bf b bg z dx"><div class="ab cn il im in"><div class="io ip ab"><div class="bf b bg z dx ab iq"><span class="ir l ik">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar ic ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--a9cd22c515a5--------------------------------" rel="noopener follow"><p class="bf b bg z is it iu iv iw ix iy iz bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="id ie" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">6 min read</span><div class="ja jb l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Aug 14, 2024</span></div></span></div></span></div></div></div><div class="ab cp jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr"><div class="h k w ea eb q"><div class="kh l"><div class="ab q ki kj"><div class="pw-multi-vote-icon ed ir kk kl km"><div class=""><div class="kn ko kp kq kr ks kt am ku kv kw km"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kx ky kz la lb lc ld"><p class="bf b dy z dx"><span class="ko">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kn lg lh ab q ee li lj" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count le lf">2</span></p></button></div></div></div><div class="ab q js jt ju jv jw jx jy jz ka kb kc kd ke kf kg"><div class="lk k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al ll an ao ap ih lm ln lo" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lp cn"><div class="l ae"><div class="ab cb"><div class="lq lr ls lt lu lv ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al ll an ao ap ih lw lx lj ly lz ma mb mc s md me mf mg mh mi mj u mk ml mm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al ll an ao ap ih lw lx lj ly lz ma mb mc s md me mf mg mh mi mj u mk ml mm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al ll an ao ap ih lw lx lj ly lz ma mb mc s md me mf mg mh mi mj u mk ml mm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mq mr ms mt mu mv mn mo paragraph-image"><div role="button" tabindex="0" class="mw mx ed my bh mz"><div class="mn mo mp"><img src="../Images/9cb51cb89dabc5e3cfd2ce6056273fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPs1I2RwIyme1mzl4Voctw.jpeg"/></div></div><figcaption class="nb nc nd mn mo ne nf bf b bg z dx">Image by <a class="af ng" href="https://www.pexels.com/@divinetechygirl/" rel="noopener ugc nofollow" target="_blank">Christina Morillo</a> on <a class="af ng" href="https://www.pexels.com/photo/man-standing-infront-of-white-board-1181345/" rel="noopener ugc nofollow" target="_blank">Pixels</a></figcaption></figure><p id="bf8e" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">Many <code class="cx gn go gp gq b">pandas</code> tutorials online teach you the basics of manipulating and cleaning data, but rarely do they show how to validate whether data is correct. This is where data validation using <code class="cx gn go gp gq b">pandera</code> comes in.</p><h1 id="4b42" class="od oe fq bf of og oh gu oi oj ok gx ol om on oo op oq or os ot ou ov ow ox oy bk">Why Data Validation?</h1><p id="cf64" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">Like anyone, when I first look at data, I complete basic investigations such as looking at the data types, checking for null values, and visualising data distributions to figure out roughly how I should process data.</p><p id="949f" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">However, we need data validation to confirm our data follows business logic. For example, for data that contains product information, we need to validate that product price has no negative values, or when a user gives an email address, we need to assert the email address follows a recognised pattern.</p><p id="c5d0" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">Neglecting data validation will have downstream impacts on analytics and modelling as poor data quality can lead to <strong class="nj fr">increased bias, noise and inaccuracy.</strong></p><p id="6ce9" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">A recent example of poor data validation is <a class="af ng" href="https://insideainews.com/2021/12/13/the-500mm-debacle-at-zillow-offers-what-went-wrong-with-the-ai-models/" rel="noopener ugc nofollow" target="_blank">Zillow’s house pricing algorithm </a>overvaluing 2/3 of the properties Zillow purchased, leading to a $500 million fall in Zillow property valuations in Q3 and Q4 of 2021 alone.</p><p id="0ca9" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">This shows that not only do you have to be conscious of whether your data meets validation criteria, but whether it reflects reality which in Zillow’s case it did not.</p></div></div></div><div class="ab cb pe pf pg ph" role="separator"><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="0f39" class="od oe fq bf of og pm gu oi oj pn gx ol om po oo op oq pp os ot ou pq ow ox oy bk">What is Pandera?</h1><p id="a407" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk"><code class="cx gn go gp gq b"><a class="af ng" href="https://pandera.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">Pandera</a></code> is a Python package that provides a well-documented and flexible API that integrates with both <code class="cx gn go gp gq b">pandas</code> and <code class="cx gn go gp gq b">polars</code> — the two main Python data libraries.</p><p id="2c95" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">We can use <code class="cx gn go gp gq b">pandera</code> to validate dataframe data types and properties using <strong class="nj fr">business logic and domain expertise</strong>.</p></div></div></div><div class="ab cb pe pf pg ph" role="separator"><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="7012" class="od oe fq bf of og pm gu oi oj pn gx ol om po oo op oq pp os ot ou pq ow ox oy bk">Outline</h1><p id="812d" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">This article will cover:</p><ul class=""><li id="7f8e" class="nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc pr ps pt bk">How to get started with <code class="cx gn go gp gq b">pandera</code></li><li id="9705" class="nh ni fq nj b gs pu nl nm gv pv no np nq pw ns nt nu px nw nx ny py oa ob oc pr ps pt bk">How to define a <code class="cx gn go gp gq b">pandera</code> data model</li><li id="3491" class="nh ni fq nj b gs pu nl nm gv pv no np nq pw ns nt nu px nw nx ny py oa ob oc pr ps pt bk">How to validate data and handle errors</li></ul></div></div></div><div class="ab cb pe pf pg ph" role="separator"><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="1b0b" class="od oe fq bf of og pm gu oi oj pn gx ol om po oo op oq pp os ot ou pq ow ox oy bk">Setup</h1><h2 id="927b" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Install Dependencies</h2><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="57e1" class="qt oe fq gq b bg qu qv l qw qx">pip install pandas<br/>pip install pandera</span></pre><h2 id="10f1" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Data</h2><p id="da3e" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">The data used for this article is fake football market data generated using Claude.ai.</p></div></div></div><div class="ab cb pe pf pg ph" role="separator"><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="00a0" class="od oe fq bf of og pm gu oi oj pn gx ol om po oo op oq pp os ot ou pq ow ox oy bk">Define the Validation Model</h1><p id="7f40" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">The package allows you to define either a validation schema or a data validation model which closely resembles another great data validation package called <code class="cx gn go gp gq b"><a class="af ng" href="https://docs.pydantic.dev/latest/" rel="noopener ugc nofollow" target="_blank">Pydantic</a></code>.</p><p id="8c11" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">For this exercise, we will focus on the validation model as it allows for <strong class="nj fr">type hint integration </strong>with our Python code, and I find it is a bit more readable than the validation schema. However, if you want to leverage the validation schema, the model has a method to transform it into a schema.</p><p id="3447" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">You can find information about both validation methods here:</p><ul class=""><li id="de53" class="nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc pr ps pt bk"><a class="af ng" href="https://pandera.readthedocs.io/en/stable/dataframe_schemas.html" rel="noopener ugc nofollow" target="_blank">DataFrameSchema</a></li><li id="3152" class="nh ni fq nj b gs pu nl nm gv pv no np nq pw ns nt nu px nw nx ny py oa ob oc pr ps pt bk"><a class="af ng" href="https://pandera.readthedocs.io/en/stable/dataframe_models.html" rel="noopener ugc nofollow" target="_blank">DataFrameModel</a></li></ul><h2 id="0247" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Load Data</h2><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="714a" class="qt oe fq gq b bg qu qv l qw qx">data = {<br/>    'dob': pd.to_datetime(['1990-05-15', '1988-11-22', '1995-03-10', '1993-07-30', '1992-01-18', '1994-09-05', '1991-12-03', '1989-06-20', '1996-02-14', '1987-08-08']),<br/>    'age': [34, 35, 29, 31, 32, 30, 32, 35, 28, 37],<br/>    'country': ['England', 'Spain', 'Germany', 'France', 'Italy', 'Brazil', 'Argentina', 'Netherlands', 'Portugal', 'England'],<br/>    'current_club': ['Manchester United', 'Chelsea', 'Bayern Munich', 'Paris Saint-Germain', 'Juventus', 'Liverpool', 'Barcelona', 'Ajax', 'Benfica', 'Real Madrid'],<br/>    'height': pd.array([185, 178, None, 176, 188, 182, 170, None, 179, 300], dtype='Int16'),<br/>    'name': ['John Smith', 'Carlos Rodriguez', 'Hans Mueller', 'Pierre Dubois', 'Marco Rossi', 'Felipe Santos', 'Diego Fernandez', 'Jan de Jong', 'Rui Silva', 'Gavin Harris'],<br/>    'position': ['Forward', 'Midfielder', 'Defender', 'Goalkeeper', 'Defender', 'Forward', 'Midfielder', 'Defender', 'Forward', 'Midfielder'],<br/>    'value_euro_m': [75.5, 90.2, 55.8, 40.0, 62.3, 88.7, 70.1, 35.5, 45.9, 95.0],<br/>    'joined_date': pd.to_datetime(['2018-07-01', '2015-08-15', None, '2017-06-30', '2016-09-01', None, '2021-07-15', '2014-08-01', '2022-01-05', '2019-06-01']),<br/>    'number': [9, 10, 4, 1, 3, 11, 8, 5, 7, 17],<br/>    'signed_from': ['Everton', 'Atletico Madrid', 'Borussia Dortmund', None, 'AC Milan', 'Santos', None, 'PSV Eindhoven', 'Sporting CP', 'Newcastle United'],<br/>    'signing_fee_euro_m': [65.0, 80.5, 45.0, None, 55.0, 75.2, 60.8, None, 40.5, 85.0],<br/>    'foot': ['right', 'left', 'right', 'both', 'right', 'left', 'left', 'right', 'both', 'right'],<br/>}<br/><br/>df = pd.DataFrame(data)</span></pre></div></div><div class="mv"><div class="ab cb"><div class="lq qy lr qz ls ra cf rb cg rc ci bh"><figure class="mq mr ms mt mu mv re rf paragraph-image"><div role="button" tabindex="0" class="mw mx ed my bh mz"><div class="mn mo rd"><img src="../Images/e3e1bc6302c113c4e0752e131a944a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*1_mCgJ3Miy54pbJHuOkZ4g.png"/></div></div><figcaption class="nb nc nd mn mo ne nf bf b bg z dx">Image by author</figcaption></figure></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="bb9e" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Check the Data Types</h2><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="3197" class="qt oe fq gq b bg qu qv l qw qx">data.types</span></pre><figure class="mq mr ms mt mu mv mn mo paragraph-image"><div class="mn mo rg"><img src="../Images/6e878c39c8dda42332ac60e5846fe134.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*SNzxmDh22rnLICx21ud-Ug.png"/></div><figcaption class="nb nc nd mn mo ne nf bf b bg z dx">Image by author</figcaption></figure><p id="0dc5" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">We can use the data types to help define our data model.</p><h2 id="a1a5" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Create Data Model</h2><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="01fd" class="qt oe fq gq b bg qu qv l qw qx">class PlayerSchema(pa.DataFrameModel):<br/>    <br/>    dob: Series[pd.Timestamp] = pa.Field(nullable=False, ge=pd.Timestamp('1975-01-01'))<br/>    age: Series[pa.Int64] = pa.Field(ge=0, le=50, nullable=False)<br/>    country: Series[pa.String] = pa.Field(nullable=False)<br/>    current_club: Series[pa.String] = pa.Field(nullable=False)<br/>    height: Series[pa.Int16] = pa.Field(ge=120, le=210, nullable=True)<br/>    name: Series[pa.String] = pa.Field(nullable=False)<br/>    position: Series[pa.String] = pa.Field(nullable=False)<br/>    value_euro_m: Series[pa.Float64] = pa.Field(ge=0, le=200)<br/>    joined_date: Series[pd.Timestamp] = pa.Field(nullable=True, ge=pd.Timestamp('2000-01-01'))<br/>    number: Series[pa.Int64] = pa.Field(ge=0, le=99)<br/>    signed_from: Series[pa.String] = pa.Field(nullable=True)<br/>    signing_fee_euro_m: Series[pa.Float64] = pa.Field(ge=0, le=300, nullable=True)<br/>    foot: Series[pa.String] = pa.Field(nullable=False, isin=['right', 'left', 'both', 'unknown'])</span></pre><p id="5733" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">Above, we define a schema by sub-classing <code class="cx gn go gp gq b">pa.DataFrameModel</code> which is done in the same way you sub-class <code class="cx gn go gp gq b">BaseModel</code> in <code class="cx gn go gp gq b"><a class="af ng" href="https://docs.pydantic.dev/latest/" rel="noopener ugc nofollow" target="_blank">Pydantic</a></code>. We then populated the schema with the corresponding <strong class="nj fr">columns in our dataset</strong>, providing the <strong class="nj fr">data type expected</strong> in each column, and <strong class="nj fr">defining boundaries</strong> using the <code class="cx gn go gp gq b">pa.Field</code> method.</p><p id="b7e2" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk"><code class="cx gn go gp gq b">Pandera</code> has great integration with <code class="cx gn go gp gq b">pandas</code> meaning you can use <code class="cx gn go gp gq b">pandas</code> data types (e.g. <code class="cx gn go gp gq b">pd.Timestamp</code>) as well as pandera data types (e.g. <code class="cx gn go gp gq b">pa.Int64</code>) to define each column.</p><h2 id="38a3" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Reuse Fields</h2><p id="608e" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">To avoid repeating fields, we can reuse fields by using <code class="cx gn go gp gq b">partial</code> from the built-in Python library <code class="cx gn go gp gq b">functools.</code></p><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="9046" class="qt oe fq gq b bg qu qv l qw qx">from functools import partial<br/><br/>NullableField = partial(pa.Field, nullable=True)<br/>NotNullableField = partial(pa.Field, nullable=False)</span></pre><p id="8e27" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">The <code class="cx gn go gp gq b">partial</code> class creates a <strong class="nj fr">new function that applies a specified subset of parameters </strong>from the original function.</p><p id="074d" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">Above, we created two reusable fields for model variables that either contain null values or do not contain null values.</p><p id="076d" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">Our updated data model looks like this</p><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="6a55" class="qt oe fq gq b bg qu qv l qw qx">class PlayerSchema(pa.DataFrameModel):<br/>    <br/>    dob: Series[pd.Timestamp] = pa.Field(nullable=False, ge=pd.Timestamp('1975-01-01'))<br/>    age: Series[pa.Int64] = pa.Field(ge=0, le=50, nullable=False)<br/>    country: Series[pa.String] = NotNullableField()<br/>    current_club: Series[pa.String] = NotNullableField()<br/>    height: Series[pa.Int16] = pa.Field(ge=120, le=250, nullable=True)<br/>    name: Series[pa.String] = NotNullableField()<br/>    position: Series[pa.String] = NotNullableField()<br/>    value_euro_m: Series[pa.Float64] = pa.Field(ge=0, le=200)<br/>    joined_date: Series[pd.Timestamp] = pa.Field(nullable=True, ge=pd.Timestamp('2000-01-01'))<br/>    number: Series[pa.Int64] = pa.Field(ge=0, le=99)<br/>    signed_from: Series[pa.String] = NullableField() <br/>    signing_fee_euro_m: Series[pa.Float64] = pa.Field(ge=0, le=300, nullable=True)<br/>    foot: Series[pa.String] = pa.Field(nullable=False, isin=['right', 'left', 'both', 'unknown'])</span></pre><p id="e532" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">As partial creates a new function, we have to use brackets to call our new fields.</p></div></div></div><div class="ab cb pe pf pg ph" role="separator"><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="dc37" class="od oe fq bf of og pm gu oi oj pn gx ol om po oo op oq pp os ot ou pq ow ox oy bk">Validate Data</h1><p id="7159" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">Now that the data model has been defined, we can use it to validate our data.</p><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="ceae" class="qt oe fq gq b bg qu qv l qw qx">@pa.check_types<br/>def load_data() -&gt; DataFrame[PlayerSchema]:<br/>    return pd.read_parquet('../data/player_info_cleaned.parquet')</span></pre><p id="3f4c" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">To validate the data, we use a <strong class="nj fr">combination of type hints and decorators</strong>. The <code class="cx gn go gp gq b">@pa.check_types</code> decorator denotes the data should be validated in line with the schema defined in the return type hint <code class="cx gn go gp gq b">DataFrame[PlayerSchema].</code></p><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="05db" class="qt oe fq gq b bg qu qv l qw qx">@pa.check_types<br/>def validate_data(df: DataFrame) -&gt; DataFrame[PlayerSchema]:<br/>    try:<br/>        return df<br/>    except pa.errors.SchemaError as e:<br/>        print(e)<br/><br/>validate_data(df)<br/># error in check_types decorator of function 'load_data': Column 'height' failed element-wise validator number 1: less_than_or_equal_to(210) failure cases: 300</span></pre><p id="4aa5" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">Using a try-except block, we can <strong class="nj fr">catch any errors</strong> thrown when the data is loaded and validated. The result shows that the ‘height’ column <strong class="nj fr">fails the less than or equal to test</strong>, with one height labelled as 300cm which isn’t correct.</p><h2 id="f046" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Clean data</h2><p id="20ba" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">There are many strategies to clean data, some of which I have detailed in my previous article.</p><div class="rh ri rj rk rl rm"><a href="https://medium.com/@conalhenderson/master-pandas-to-build-modular-and-reusable-data-pipelines-1d12b003a423?source=post_page-----a9cd22c515a5--------------------------------" rel="noopener follow" target="_blank"><div class="rn ab ik"><div class="ro ab co cb rp rq"><h2 class="bf fr ia z is rr iu iv rs ix iz fp bk">Master Pandas to Build Modular and Reusable Data Pipelines</h2><div class="rt l"><h3 class="bf b ia z is rr iu iv rs ix iz dx">Build modular, reusable and efficient data pipelines by leveraging pandas to implement key data processing strategies.</h3></div><div class="ru l"><p class="bf b dy z is rr iu iv rs ix iz dx">medium.com</p></div></div><div class="rv l"><div class="rw l rx ry rz rv sa lv rm"/></div></div></a></div><p id="9b4d" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">For the sake of simplicity, I will impute any values above 210cm with the median height for the population.</p><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="784f" class="qt oe fq gq b bg qu qv l qw qx">def clean_height(df: DataFrame) -&gt; DataFrame[PlayerSchema]:<br/>    data = df.copy()<br/>    data.loc[data[PlayerSchema.height] &gt; 210, PlayerSchema.height] = round(data[PlayerSchema.height].median())<br/>    return data<br/><br/>df = clean_height(df) </span></pre><p id="096c" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">Another useful property of <code class="cx gn go gp gq b">pandera</code> is the schema can be used to <strong class="nj fr">specify column names </strong>you would like to analyse in pandas. For example, instead of explicitly labelling ‘height’ we can use <code class="cx gn go gp gq b">PlayerSchema.height</code>to <strong class="nj fr">improve readability and encourage consistency</strong> in our code.</p><h2 id="c5ab" class="pz oe fq bf of qa qb qc oi qd qe qf ol nq qg qh qi nu qj qk ql ny qm qn qo qp bk">Re-validation</h2><p id="eb0f" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">As our data has already been loaded in, we can adapt the previous function to take in a dataframe as an input, run the dataframe through the try-except block and evaluate using the decorator and type hint.</p><pre class="mq mr ms mt mu qq gq qr bp qs bb bk"><span id="a6c5" class="qt oe fq gq b bg qu qv l qw qx">validate_data_2(df)<br/><br/># if there are no errors, the dataframe is the output. </span></pre><p id="ab6f" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">This time there are no errors meaning the dataframe is returned as the function output.</p></div></div></div><div class="ab cb pe pf pg ph" role="separator"><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk pl"/><span class="pi by bm pj pk"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="704c" class="od oe fq bf of og pm gu oi oj pn gx ol om po oo op oq pp os ot ou pq ow ox oy bk">Conclusion</h1><p id="2fc5" class="pw-post-body-paragraph nh ni fq nj b gs oz nl nm gv pa no np nq pb ns nt nu pc nw nx ny pd oa ob oc fj bk">This article has outlined why it is important to validate data to check it is c<strong class="nj fr">onsistent with business logic and reflects the real world</strong>, with the example of Zillow used to illustrate how poor data validation can have drastic consequences.</p><p id="7498" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk"><code class="cx gn go gp gq b">Pandera</code> was used to show how data validation can be easily integrated with <code class="cx gn go gp gq b">pandas</code> to quickly <strong class="nj fr">validate a schema</strong> that closely resembles <code class="cx gn go gp gq b">Pydantic </code>using <strong class="nj fr">decorators</strong> and <strong class="nj fr">type hints</strong>. It was also shown how <code class="cx gn go gp gq b">pa.Field</code> can be used to <strong class="nj fr">set boundaries for your data </strong>and when used with <code class="cx gn go gp gq b">partial</code>reusable fields can be created to increase code readability.</p><p id="94db" class="pw-post-body-paragraph nh ni fq nj b gs nk nl nm gv nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc fj bk">I hope you found this article useful and thanks for reading. Reach out to me on <a class="af ng" href="https://www.linkedin.com/in/conal-henderson-4128631b6/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> if you have any questions!</p></div></div></div></div>    
</body>
</html>