<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Building an Email Assistant Application with Burr</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Building an Email Assistant Application with Burr</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-an-email-assistant-application-with-burr-324bc34c547d?source=collection_archive---------4-----------------------#2024-04-25">https://towardsdatascience.com/building-an-email-assistant-application-with-burr-324bc34c547d?source=collection_archive---------4-----------------------#2024-04-25</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="25a9" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">A tutorial to demonstrate how to use Burr, using simple OpenAI client calls to GPT4, and FastAPI to create a custom email assistant agent.</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@stefan.krawczyk?source=post_page---byline--324bc34c547d--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Stefan Krawczyk" class="l ep by dd de cx" src="../Images/150405abaad9590e1dc2589168ed2fa3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*WguG4w7ZZiDFLAxQQGNoww.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--324bc34c547d--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@stefan.krawczyk?source=post_page---byline--324bc34c547d--------------------------------" rel="noopener follow">Stefan Krawczyk</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--324bc34c547d--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">12 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Apr 25, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">2</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mj mk ml mm mn mo mp mq paragraph-image"><div class="ab cn cb mr"><img src="../Images/7b059bfe0d0e941f2f4d698e8c8ce886.png" data-original-src="https://miro.medium.com/v2/format:webp/0*3ELuL8FDfPSEGxbw.png"/></div><figcaption class="mt mu mv mp mq mw mx bf b bg z dx">The control flow of the agent application we’ll create. Image by author.</figcaption></figure><p id="366b" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">In this tutorial, I will demonstrate how to use <a class="af nu" href="https://github.com/dagworks-inc/burr" rel="noopener ugc nofollow" target="_blank">Burr</a>, an open source framework (disclosure: I helped create it), using simple OpenAI client calls to GPT4, and <a class="af nu" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">FastAPI</a> to create a custom email assistant agent. We’ll describe the challenge one faces and then how you can solve for them. For the application frontend we provide a reference implementation but won’t dive into details for it.</p><h1 id="c740" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk"><strong class="al">Why are interactive agents applications a challenge?</strong></h1><p id="dfb6" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">LLMs rarely achieve complex goals on their own, and almost never on the first try. While it is in vogue to claim that ChatGPT given an internet connection can solve the world’s problems, the majority of high-value tools we’ve encountered use a blend of AI ingenuity and human guidance. This is part of the general move towards building agents — an approach where the AI makes decisions from information it receives — this could be information it queries, information a user provides, or information another LLM gives it.</p><p id="0d99" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">A simple example of this is a tool to help you draft a response to an email. You put the email and your response goals, and it writes the response for you. At a minimum, you’ll want to provide feedback so it can adjust the response. Furthermore, you will want it to give a chance to ask clarifying questions (an overly confident yet incorrect chatbot helps no one).</p><p id="e599" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">In designing this interaction, your system will, inevitably, become a back-and-forth between user/LLM control. In addition to the standard challenges around AI applications (unreliable APIs, stochastic implementations, etc…), you will face a suite of new problems, including:</p><ol class=""><li id="8e43" class="my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt ow ox oy bk">Logically modeling a set of interaction points/flows</li><li id="748c" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Persisting the state so the user can pick up the interaction/application from where it left off</li><li id="7802" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Monitoring the decisions the LLM made (E.G. whether to ask the user questions or not)</li></ol><p id="39b3" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">And so on… In this post we’re going to walk through how to approach solving these — we’ll use the Burr library as well as FastAPI to build a web service to address these challenges in an extensible, modular manner; so you can then use this as a blue print for your own agent assistant needs.</p><h1 id="120e" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">The Tools</h1><h1 id="1a97" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Burr</h1><p id="425e" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk"><a class="af nu" href="https://github.com/dagworks-inc/burr" rel="noopener ugc nofollow" target="_blank">Burr</a> is a lightweight python library you use to build applications as state machines. You construct your application out of a series of actions (these can be either decorated functions or objects), which declare inputs from state, as well as inputs from the user. These specify custom logic (delegating to any framework), as well as instructions on how to update state. State is immutable, which allows you to inspect it at any given point. Burr handles orchestration, monitoring and persistence.</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="c252" class="pi nw fq pf b bg pj pk l pl pm">@action(reads=["counter"], writes=["counter"])<br/>def count(state: State) -&gt; Tuple[dict, State]:<br/>    current = state["counter"] + 1<br/>    result = {"counter": current}<br/>    return result, state.update(counter=counter)</span></pre><p id="793d" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">Note that the action above has two returns — the results (the counter), and the new, modified state (with the counter field incremented).</p><p id="f518" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">You run your Burr actions as part of an application — this allows you to string them together with a series of (optionally) conditional transitions from action to action.</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="1886" class="pi nw fq pf b bg pj pk l pl pm">from burr.core import ApplicationBuilder, default, expr<br/>app = (<br/>    ApplicationBuilder()<br/>    .with_state(counter=0) # initialize the count to zero<br/>    .with_actions(<br/>        count=count, <br/>        done=done # implementation left out above<br/>    ).with_transitions(<br/>        ("count", "count", expr("counter &lt; 10")), # Keep counting if the counter is less than 10<br/>        ("count", "done", default) # Otherwise, we're done<br/>    ).with_entrypoint("count") # we have to start somewhere<br/>    .build()<br/>)</span></pre><p id="83f4" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">Burr comes with a user-interface that enables monitoring/telemetry, as well as hooks to persist state/execute arbitrary code during execution.</p><p id="ba70" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">You can visualize this as a flow chart, i.e. graph / state machine:</p><figure class="mj mk ml mm mn mo mp mq paragraph-image"><div class="mp mq pn"><img src="../Images/82b3314c0dd8202e046fac71eb013c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/0*fj0cmDv7m3ckbloV.png"/></div><figcaption class="mt mu mv mp mq mw mx bf b bg z dx">Image of our application as produced by Burr. Image by author.</figcaption></figure><p id="a199" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">And monitor it using the local telemetry debugger:</p><figure class="mj mk ml mm mn mo mp mq paragraph-image"><div role="button" tabindex="0" class="pp pq ed pr bh ps"><div class="mp mq po"><img src="../Images/7cfd6694f108ffd1e74d01f09afba486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6DUwDb4W4LDwI0QE.png"/></div></div><figcaption class="mt mu mv mp mq mw mx bf b bg z dx">Burr comes with a UI — this is what it looks like when inspecting a run of our counter example. Image by author.</figcaption></figure><p id="6350" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">While we showed the (very simple) counter example above, Burr is more commonly used for building chatbots/agents (we’ll be going over an example in this post).</p><h1 id="d2f5" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">FastAPI</h1><p id="67c5" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk"><a class="af nu" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">FastAPI</a> is a framework that lets you expose python functions in a REST API. It has a simple interface — you write your functions then decorate them, and run your script — turning it into a server with self-documenting endpoints through <a class="af nu" href="https://www.openapis.org/" rel="noopener ugc nofollow" target="_blank">OpenAPI</a>.</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="5843" class="pi nw fq pf b bg pj pk l pl pm">@app.get("/")<br/>def read_root():<br/>    return {"Hello": "World"}<br/><br/>@app.get("/items/{item_id}")<br/>def read_item(item_id: int, q: Union[str, None] = None):<br/>    """A very simpler example of an endpoint that takes in arguments."""<br/>    return {"item_id": item_id, "q": q}</span></pre><p id="a42f" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">FastAPI is easy to deploy on any cloud provider — it is infrastructure-agnostic and can generally scale horizontally (so long as consideration into state management is done). See <a class="af nu" href="https://fastapi.tiangolo.com/deployment/cloud/?h=deploy" rel="noopener ugc nofollow" target="_blank">this page</a> for more information.</p><h1 id="348f" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">React (or any frontend framework)</h1><p id="23d9" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">You can use any frontend framework you want — react-based tooling, however, has a natural advantage as it models everything as a function of state, which can map 1:1 with the concept in Burr. In the demo app we use <a class="af nu" href="https://react.dev/" rel="noopener ugc nofollow" target="_blank">react</a>, <a class="af nu" href="https://tanstack.com/query/latest/docs/framework/react/overview" rel="noopener ugc nofollow" target="_blank">react-query</a>, and <a class="af nu" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank">tailwind</a>, but we’ll be skipping over this largely (it is not central to the purpose of the post).</p><h1 id="7397" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Building</h1><p id="8534" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">Let’s dig a bit more into the conceptual model. At a high-level, our email assistant will do the following:</p><ol class=""><li id="2866" class="my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt ow ox oy bk">Accept an email + instructions to respond</li><li id="29c5" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Come up with a set of clarifying questions (if the LLM deems it required)</li><li id="502d" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Generates a draft using the answer to those questions</li><li id="c0dd" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Accept feedback to that draft and generates another one, repeating until the user is happy</li><li id="9aae" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Return the final draft (done)</li></ol><h1 id="d601" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Modeling Control Flow</h1><p id="7572" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">As Burr requires you to build a control flow from <em class="pt">actions</em> and <em class="pt">transitions</em>, we can initially model this as a simple flowchart.</p><figure class="mj mk ml mm mn mo mp mq paragraph-image"><div class="ab cn cb mr"><img src="../Images/7b059bfe0d0e941f2f4d698e8c8ce886.png" data-original-src="https://miro.medium.com/v2/format:webp/0*3ELuL8FDfPSEGxbw.png"/></div><figcaption class="mt mu mv mp mq mw mx bf b bg z dx">What our application will look like. Image by author.</figcaption></figure><p id="f407" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">We drafted this before actually writing any code — you will see it transforms to code naturally.</p><p id="68c5" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">The green nodes represent actions (these take state in and modify it), and the blue nodes represent inputs (these are points at which the app has to pause and ask the user for information). Note that there is a loop (formulate_draft ⇔process_feedback) — we iterate on feedback until we’re happy with the results.</p><p id="dae0" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">This diagram is simply a stylized version of what Burr shows you — the modeling is meant to be close to the actual code. We have not displayed state information (the data the steps take in/return), but we’ll need to track the following (that may or may not be populated at any given point) so we can make decisions about what to do next:</p><ol class=""><li id="0722" class="my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt ow ox oy bk">The initial inputs: <code class="cx pu pv pw pf b">{email_to_respond: str, response_instructions: str}</code></li><li id="c990" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">The questions the LLM asks and the user responses (if any):<code class="cx pu pv pw pf b">{clarifications: list[str], response_instructions: list[str]}</code></li><li id="2f31" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">The list of drafts + feedback: <code class="cx pu pv pw pf b">{drafts: list[str], feedback_history: list[str]}</code></li><li id="c11e" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">The final result: <code class="cx pu pv pw pf b">{final_result: str}</code></li></ol><h1 id="b612" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Implementing/Testing</h1><p id="bd6b" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">Looking at the requirements above, we can build a straightforward burr application since we can very closely match our code with our diagram above. Let’s take a look at the <a class="af nu" href="https://github.com/DAGWorks-Inc/burr/blob/c3810dcf5a4aa44153957377ddb17fc97e05ac92/examples/email-assistant/application.py#L32C1-L65C46" rel="noopener ugc nofollow" target="_blank">determine_clarifications</a> step, for example:</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="2e64" class="pi nw fq pf b bg pj pk l pl pm">@action(<br/>    reads=["response_instructions", "incoming_email"], <br/>    writes=["clarification_questions"]<br/>)<br/>def determine_clarifications(state: State) -&gt; Tuple[dict, State]:<br/>    """Determines if the response instructions require clarification."""<br/>    <br/>    incoming_email = state["incoming_email"]<br/>    response_instructions = state["response_instructions"]<br/>    client = _get_openai_client()<br/>    <br/>    result = client.chat.completions.create(<br/>        model="gpt-4",<br/>        messages=[<br/>            {<br/>                "role": "system",<br/>                "content": ("You are a chatbot that has the task of "<br/>                            "generating responses to an email on behalf "<br/>                            "of a user. "),<br/>            },<br/>            {<br/>                "role": "user",<br/>                "content": (<br/>                    f"The email you are to respond to is: {incoming_email}."<br/>                     # ... left out, see link above<br/>                    "The questions, joined by newlines, must be the only "<br/>                    "text you return. If you do not need clarification, "<br/>                    "return an empty string."<br/>                ),<br/>            },<br/>        ],<br/>    )<br/>    content = result.choices[0].message.content<br/>    all_questions = content.split("\n") if content else []<br/>    return {"clarification_questions": all_questions}, state.update(<br/>        clarification_questions=all_questions)</span></pre><p id="7dbe" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">Note that this uses simple OpenAI calls — you can replace this with <a class="af nu" href="https://www.langchain.com/" rel="noopener ugc nofollow" target="_blank">Langchain</a>, <a class="af nu" href="https://www.llamaindex.ai/" rel="noopener ugc nofollow" target="_blank">LlamaIndex</a>, <a class="af nu" href="https://github.com/dagWorks-Inc/hamilton" rel="noopener ugc nofollow" target="_blank">Hamilton</a> (or something else) if you prefer more abstraction, and delegate to whatever LLM you like to use. And, you should probably use something a little more concrete (E.G. <a class="af nu" href="https://github.com/jxnl/instructor" rel="noopener ugc nofollow" target="_blank">instructor</a>) to guarantee output shape.</p><p id="7583" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">To tie these together, we put them into the application builder — this allows us to set conditional transitions (e.g. <code class="cx pu pv pw pf b">len(clarification_questions&gt;0</code>) and therefore connect actions, recreating the diagram above.</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="721b" class="pi nw fq pf b bg pj pk l pl pm">application = (<br/>    ApplicationBuilder()<br/>    # define our actions<br/>    .with_actions(<br/>        process_input,<br/>        determine_clarifications,<br/>        clarify_instructions,<br/>        formulate_draft,<br/>        process_feedback,<br/>        final_result,<br/>    )<br/>    # define how our actions connect<br/>    .with_transitions(<br/>        ("process_input", "determine_clarifications"),<br/>        (<br/>            "determine_clarifications",<br/>            "clarify_instructions",<br/>            expr("len(clarification_questions) &gt; 0"),<br/>        ),<br/>        ("determine_clarifications", "formulate_draft"),<br/>        ("clarify_instructions", "formulate_draft"),<br/>        ("formulate_draft", "process_feedback"),<br/>        ("process_feedback", "formulate_draft", expr("len(feedback) &gt; 0")),<br/>        ("process_feedback", "final_result"),<br/>    )<br/>    .with_state(draft_history=[])<br/>    .with_entrypoint("process_input")<br/>    .build()<br/>)</span></pre><p id="b7b1" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">To iterate on this, we used a <a class="af nu" href="https://github.com/DAGWorks-Inc/burr/blob/main/examples/email-assistant/notebook.ipynb" rel="noopener ugc nofollow" target="_blank">jupyter notebook.</a> Running our application is simple — all you do is call the <code class="cx pu pv pw pf b">.run()</code> method on the Application, with the right <em class="pt">halting</em> conditions. We’ll want it to halt before any action that requires user input (<code class="cx pu pv pw pf b">clarify_instructions</code> and <code class="cx pu pv pw pf b">process_feedback</code>), and after <code class="cx pu pv pw pf b">final_result</code>. We can then run it in a while loop, asking for user input and feeding it back to the state machine:</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="cbb8" class="pi nw fq pf b bg pj pk l pl pm">def request_answers(questions):<br/>    """Requests answers from the user for the questions the LLM has"""<br/>    answers = []<br/>    print("The email assistant wants more information:\n")<br/>    for question in questions:<br/>        answers.append(input(question))<br/>    return answers<br/><br/>def request_feedback(draft):<br/>    """Requests feedback from the user for a draft"""<br/>    print( <br/>        f"here's a draft!: \n {draft} \n \n What feedback do you have?",<br/>    )<br/>    return input("Write feedback or leave blank to continue (if you're happy)")<br/>inputs = {<br/>    "email_to_respond" : EMAIL,<br/>    "response_instructions" : INSTRUCTIONS<br/>}<br/><br/># in our notebook cell:<br/>while True:<br/>    action, result, state = app.run(<br/>        halt_before=["clarify_instructions", "process_feedback"], <br/>        halt_after=["final_result"],<br/>        inputs=inputs<br/>    )<br/>    if action.name == "clarify_instructions":<br/>        questions = state["clarification_questions"]<br/>        answers = request_answers(questions)<br/>        inputs = {<br/>            "clarification_inputs" : answers<br/>        }<br/>    if action.name == "process_feedback":<br/>        feedback = request_feedback(state["current_draft"])<br/>        inputs = {"feedback" : feedback}<br/>    if action.name == "final_result":<br/>        print("final result is:", state["current_draft"])<br/>        break</span></pre><p id="47a7" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">You can then use the Burr UI to monitor your application as it runs!</p><figure class="mj mk ml mm mn mo mp mq paragraph-image"><div role="button" tabindex="0" class="pp pq ed pr bh ps"><div class="mp mq po"><img src="../Images/fe14069261250066fd0ba15e25320d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SJPDK6gIXre7dkWy.png"/></div></div><figcaption class="mt mu mv mp mq mw mx bf b bg z dx">Example of using the Burr UI (with the email app UI) and then seeing it’s execution. Image by author.</figcaption></figure><h1 id="53c6" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Persistence</h1><p id="2a34" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">We’re going to persist our results to an SQLite server (although as you’ll see later on this is customizable). To do this, we need to add a few lines to the ApplicationBuilder.</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="d1c9" class="pi nw fq pf b bg pj pk l pl pm">state_persister = SQLLitePersister(<br/>    db_path="sqllite.db", <br/>    table_name="email_assistant_table"<br/>)<br/><br/>app = (<br/>    ApplicationBuilder().<br/>    ... # the code we had above<br/>    .initialize(  <br/>        initializer=state_persister,<br/>        resume_at_next_action=True,<br/>        default_state={"chat_history" : []},<br/>        default_entrypoint="process_input"<br/>    )<br/>    .with_identifiers(app_id=app_id)<br/>    .build()<br/>)</span></pre><p id="bbb3" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">This ensures that every email draft we create will be saved and can be loaded at every step. When you want to resume a prior draft of an email, all you have to do is rerun the code and it will start where it left off.</p><h1 id="0bf7" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Integrating in a web server</h1><p id="6a40" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">To expose this in a web server we’ll be using FastAPI to create endpoints and Pydantic to represent types. Before we get into the details, we’ll note that Burr naturally provides an <code class="cx pu pv pw pf b">application_id</code> (either generated or specified) for every instance of an application. In this case the <code class="cx pu pv pw pf b">application_id</code> would correspond to a particular email draft. This allows us to uniquely access it, query from the db, etc… It also allows for a partition key (E.G. user_id) so you can add additional indexing in your database. We center the API around inputs/outputs</p><h1 id="aeb6" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Endpoints</h1><p id="cf91" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">We will construct the following endpoints:</p><ol class=""><li id="3161" class="my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt ow ox oy bk"><code class="cx pu pv pw pf b">POST /create</code>: This will create a new application and return the ID</li><li id="4bae" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk"><code class="cx pu pv pw pf b">PUT /initialize_draft/{id}/</code>: This calls out to process_input, passing in the email and instructions</li><li id="7654" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk"><code class="cx pu pv pw pf b">PUT /clarify_instructions/{id}</code>: This will give answers back to the LLM</li><li id="2529" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk"><code class="cx pu pv pw pf b">PUT /process_feedback/{id}</code>: This will give feedback back to the LLM</li><li id="ffca" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk"><code class="cx pu pv pw pf b">GET /{id}/state</code>: This will return the current state of the application</li></ol><p id="32ed" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">The GET endpoint allows us to get the current state of the application — this enables the user to reload if they quit the browser/get distracted. Each of these endpoints will return the full state of the application, which can be rendered on the frontend. Furthermore, it will indicate the next API endpoint we call, which allows the UI to render the appropriate form and submit to the right endpoint.</p><p id="ba85" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">Using FastAPI + Pydantic, this becomes very simple to implement. First, let’s add a utility to get the application object. This will use a cached version or instantiate it:</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="e010" class="pi nw fq pf b bg pj pk l pl pm">@functools.lru_cache(maxsize=128)<br/>def get_application(app_id: str) -&gt; Application:<br/>    app = email_assistant_application.application(app_id=app_id)<br/>    return app</span></pre><p id="7dca" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">All this does is call our function application in email_assistant that recreates the application. We have not included the <code class="cx pu pv pw pf b">create</code> function here, but it calls out to the same API.</p><h1 id="cf0a" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Data Model</h1><p id="eca7" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">Let’s then define a Pydantic model to represent the state, and the app object in FastAPI:</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="b4b0" class="pi nw fq pf b bg pj pk l pl pm">class EmailAssistantState(pydantic.BaseModel):<br/>    app_id: str<br/>    email_to_respond: Optional[str]<br/>    response_instructions: Optional[str]<br/>    questions: Optional[List[str]]<br/>    answers: Optional[List[str]]<br/>    drafts: List[str]<br/>    feedback_history: List[str]<br/>    final_draft: Optional[str]<br/>    # This stores the next step, which tells the frontend which ones to call<br/>    next_step: Literal[<br/>        "process_input", "clarify_instructions", <br/>        "process_feedback", None]<br/><br/>    @staticmethod<br/>    def from_app(app: Application):<br/>        # implementation left out, call app.state and translate to <br/>        # pydantic model we can use `app.get_next_action()` to get <br/>        #the next step and return it to the user<br/>        ...</span></pre><p id="34b7" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">Note that every endpoint will return this same pydantic model!</p><h1 id="e131" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Endpoints</h1><p id="0598" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">Given that each endpoint returns the same thing (a representation of the current state as well as the next step to execute), they all look the same. We can first implement a generic <code class="cx pu pv pw pf b">run_through</code><em class="pt"> </em>function, which will progress our state machine forward, and return the state.</p><pre class="mj mk ml mm mn pe pf pg bp ph bb bk"><span id="e7a1" class="pi nw fq pf b bg pj pk l pl pm">def run_through(<br/>    project_id: str, <br/>    app_id: Optional[str], <br/>    inputs: Dict[str, Any]<br/>) -&gt; EmailAssistantState:<br/>    email_assistant_app = get_application(project_id, app_id)<br/>    email_assistant_app.run(<br/>        halt_before=["clarify_instructions", "process_feedback"],<br/>        halt_after=["final_result"],<br/>        inputs=inputs,<br/>    )<br/>    return EmailAssistantState.from_app(email_assistant_app)</span></pre><p id="fed3" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">This represents a simple but powerful architecture. We can continue calling these endpoints until we’re at a “terminal” state, at which point we can always ask for the state. If we decide to add more input steps, we can modify the state machine and add more input steps. We are not required to hold state in the app (it is all delegated to Burr’s persistence), so we can easily load up from any given point, allowing the user to wait for seconds, minutes, hours, or even days before continuing.</p><p id="a818" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">As the frontend simply renders based on the current state and the next step, it will always be correct, and the user can always pick up where they left off. With Burr’s telemetry capabilities you can debug any state-related issues, ensuring a smooth user experience.</p><h1 id="f1dc" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Adding a UI</h1><p id="6249" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">Now that we have a set of endpoints, the UI is simple. In fact, it mirrors the API almost exactly. We won’t dig into this too much, but the high-level is that you’ll want the following capabilities:</p><ol class=""><li id="1f9f" class="my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt ow ox oy bk">Render the current state (show the history, latest draft)</li><li id="f673" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Include a form for the next action’s inputs (provide feedback, answer clarifications)</li><li id="0956" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt ow ox oy bk">Post the results to your FastAPI endpoints, pause for response, GOTO (1)</li></ol><p id="40ff" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">You can see the UI <a class="af nu" href="https://github.com/DAGWorks-Inc/burr/blob/main/telemetry/ui/src/examples/EmailAssistant.tsx" rel="noopener ugc nofollow" target="_blank">here</a>. Here’s an example of it in action:</p><figure class="mj mk ml mm mn mo mp mq paragraph-image"><div role="button" tabindex="0" class="pp pq ed pr bh ps"><div class="mp mq po"><img src="../Images/3e645b6e63e200b656e18c6fce0a0cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jQ6fpBYv-mGTcuVF.png"/></div></div></figure><p id="df2a" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">You can play around with it if you download burr (`<code class="cx pu pv pw pf b">pip install “burr[start]” &amp;&amp; burr</code>`), and navigate to <a class="af nu" href="http://localhost:7241/demos/email-assistant" rel="noopener ugc nofollow" target="_blank">http://localhost:7241/demos/email-assistant</a>.</p><p id="9115" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">Note that there are <em class="pt">many</em> tools that make this easier/simpler to prototype, including <a class="af nu" href="https://docs.chainlit.io/get-started/overview" rel="noopener ugc nofollow" target="_blank">chainlit</a>, <a class="af nu" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">streamlit</a>, etc… The backend API we built is amenable to interacting with them as well.</p><h1 id="804d" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Additional Capabilities</h1><h2 id="71ad" class="px nw fq bf nx py pz qa oa qb qc qd od nh qe qf qg nl qh qi qj np qk ql qm qn bk">Customizing Persistence</h2><p id="c52c" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">While we used the simple SQLLite persister, you can use any of the others that come with Burr or implement your own to match your schema/db infrastructure. To do this you implement the <a class="af nu" href="https://burr.dagworks.io/reference/persister/#burr.core.persistence.BaseStatePersister" rel="noopener ugc nofollow" target="_blank">BaseStatePersister</a> class, and add it in with the ApplicationBuilder, instead of the SQLLite persister we used above.</p><h2 id="5e18" class="px nw fq bf nx py pz qa oa qb qc qd od nh qe qf qg nl qh qi qj np qk ql qm qn bk">Additional Monitoring/Visibility</h2><p id="662a" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">Using the Burr UI to monitor is not the only way. You can integrate your own by leveraging <a class="af nu" href="https://burr.dagworks.io/concepts/hooks/" rel="noopener ugc nofollow" target="_blank">lifecycle hooks</a>, enabling you to log data in a custom format to, say, <a class="af nu" href="http://datadog.com/" rel="noopener ugc nofollow" target="_blank">datadog</a>, <a class="af nu" href="https://www.langchain.com/langsmith" rel="noopener ugc nofollow" target="_blank">langsmith</a>, or <a class="af nu" href="http://langfuse.com/" rel="noopener ugc nofollow" target="_blank">langfuse</a>.</p><p id="31ed" class="pw-post-body-paragraph my mz fq na b go nb nc nd gr ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt fj bk">Furthermore, you can leverage additional monitoring capabilities to track spans/traces, either logging them directly to the Burr UI or to any of the above providers. See the list of available hooks <a class="af nu" href="https://burr.dagworks.io/reference/lifecycle/#hooksref" rel="noopener ugc nofollow" target="_blank">here</a>.</p><h2 id="09dc" class="px nw fq bf nx py pz qa oa qb qc qd od nh qe qf qg nl qh qi qj np qk ql qm qn bk">Async/Streaming</h2><p id="7f82" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">While we kept the APIs we exposed synchronous for simplicity, Burr supports asynchronous execution as well. Burr also supports streaming responses for those who want to provide a more interactive UI/reduce<em class="pt"> time to first token</em>.</p><h1 id="b5b1" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">So how does it do in practice?</h1><p id="d6ae" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">As with any LLM application, the entire prompt matters. If you can provide the right guidance, the results are going to be better than if you don’t. Much like if you are going to instruct a human, more guidance is always better. That said, if you find yourself always correcting some aspect, then changing the base prompt is likely the best course of action. For example, using a <a class="af nu" href="https://neptune.ai/blog/zero-shot-and-few-shot-learning-with-llms#:~:text=%E2%80%9COne%2Dshot%E2%80%9D%20means%20we,examples%20%E2%80%93%20you%20get%20the%20gist." rel="noopener ugc nofollow" target="_blank">single-shot or few-shot</a> approach might be a good choice to try to help instruct the LLM as to what you’d like to see given your specific context.</p><h1 id="519a" class="nv nw fq bf nx ny nz gq oa ob oc gt od oe of og oh oi oj ok ol om on oo op oq bk">Post Summary</h1><p id="b6c9" class="pw-post-body-paragraph my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt fj bk">In this post we discussed how to address some of the challenges around building human-in-the-loop agentic workflows. We ran through an example of making an email assistant using Burr to build and run it as a state machine, and FastAPI to run Burr in a web service. We finally showed how you can extend the tooling we used here for a variety of common production needs — e.g. monitoring &amp; storage.</p><h2 id="6952" class="px nw fq bf nx py pz qa oa qb qc qd od nh qe qf qg nl qh qi qj np qk ql qm qn bk">Additional Resources</h2><ul class=""><li id="face" class="my mz fq na b go or nc nd gr os nf ng nh ot nj nk nl ou nn no np ov nr ns nt qo ox oy bk">Join Burr’s <a class="af nu" href="https://discord.gg/6Zy2DwP4f3" rel="noopener ugc nofollow" target="_blank">Discord</a> for help or if you have questions!</li><li id="61f7" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt qo ox oy bk"><a class="af nu" href="http://github.com/dagworks-inc/burr" rel="noopener ugc nofollow" target="_blank">Burr’s Github repository</a> (if you like it we’d love a ⭐️)</li><li id="4098" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt qo ox oy bk"><a class="af nu" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">FastAPI guide</a></li><li id="a2ad" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt qo ox oy bk"><a class="af nu" href="https://github.com/DAGWorks-Inc/burr/tree/main/examples/web-server" rel="noopener ugc nofollow" target="_blank">Technical deep-dive of built with a web-server on github</a></li><li id="bdd5" class="my mz fq na b go oz nc nd gr pa nf ng nh pb nj nk nl pc nn no np pd nr ns nt qo ox oy bk"><a class="af nu" href="https://github.com/DAGWorks-Inc/burr/tree/main/examples/email-assistant" rel="noopener ugc nofollow" target="_blank">Code for the email assistant</a></li></ul></div></div></div></div>    
</body>
</html>