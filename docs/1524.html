<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Managing Pivot Table and Excel Charts with VBA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Managing Pivot Table and Excel Charts with VBA</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/managing-pivot-table-and-excel-charts-with-vba-3dc5d672dff0?source=collection_archive---------12-----------------------#2024-06-18">https://towardsdatascience.com/managing-pivot-table-and-excel-charts-with-vba-3dc5d672dff0?source=collection_archive---------12-----------------------#2024-06-18</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="1a92" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Save precious hours by automating working with pivot tables and charts using VBA</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@himalaya.birshrestha?source=post_page---byline--3dc5d672dff0--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Himalaya Bir Shrestha" class="l ep by dd de cx" src="../Images/9766140c1c44381029d0a78154217775.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*lJ98JUmwLo6o5791TmzNJQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--3dc5d672dff0--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@himalaya.birshrestha?source=post_page---byline--3dc5d672dff0--------------------------------" rel="noopener follow">Himalaya Bir Shrestha</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--3dc5d672dff0--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">9 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jun 18, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><p id="2497" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">As digitalization and innovation are taking over different domains, working with big datasets has become a norm and commonplace in Universities, research organizations, and industries. Automating the common tasks can save several hours for analysts, so they can spend less time on processing and managing data, and more time on the juicy part, which is analyzing and generating insights.</p><p id="a855" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">A pivot table is one such tool, which allows generaling several insights from stacked datasets. One can perform tons of analysis just by playing with the field settings of the pivot table based on the requirements. If someone has numerous stacked datasets that can be transformed into pivot tables, how can the pivot tables be refreshed automatically? How can one automate the selection of chart colors based on the series name and manage other chart elements? This blog post gives the answers to such questions by an illustrative example, step by step.</p><p id="390c" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">While it could take considerable effort to set up the code in the beginning, once it is set up, it can be very handy and time-saving to analysts who work with numerous large datasets daily. Let’s get started.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf ng"><img src="../Images/f4ecc8bd15caabeef8b391591514fc84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Odk38WFeJZHmrgB8"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Photo by <a class="af nx" href="https://unsplash.com/@levajsics?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Norbert Levajsics</a> on <a class="af nx" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div></div><div class="ab cb ny nz oa ob" role="separator"><span class="oc by bm od oe of"/><span class="oc by bm od oe of"/><span class="oc by bm od oe"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="f9a3" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">Data</h2><p id="889a" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">I took the sample data from the website of <a class="af nx" href="https://www.excel-easy.com/data-analysis/pivot-tables.html" rel="noopener ugc nofollow" target="_blank">Excel-Easy</a>. This is a nice website containing beginner-friendly tutorials on basic Excel and VBA functionalities. The dataset contains records of fruit and vegetable sales in specific countries in 2016 and 2017. The dataset contains six fields: Order ID, Product, Category, Amount, Date, and Country. I divided this dataset into 2 csv files called <code class="cx pg ph pi pj b">results1.csv</code> and <code class="cx pg ph pi pj b">results2.csv</code> for creating pivot tables.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf pk"><img src="../Images/f5bf4bd47288e4652e7b60d3b12e1dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8omNFj0qfAcD2_oh0SUuFA.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Structure of dataset. Illustration by Author.</figcaption></figure><p id="effe" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">I pulled this dataset in the <code class="cx pg ph pi pj b">RawData</code> worksheet. I created a dynamic range called <code class="cx pg ph pi pj b">raw_data_source</code> with the following formula:</p><p id="9ecf" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">=OFFSET(RawData!$A$1, 0, 0, COUNTA(RawData!$A:$A), COUNTA(RawData!$1:$1))</strong></p><p id="4ea7" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The reason for creating a dynamic range was that the size (number of rows) of the dataset was different in different CSV files, and I wanted to use the entire dataset as source of the pivot table.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf pl"><img src="../Images/787818780f73d2439d1ba882f8f9a452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7yWhs-W4Z7fpIC0UuvfCDQ.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Creating a dynamic named range as source for the pivot table. Illustration by Author.</figcaption></figure><h2 id="04c7" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">Pivot tables and charts</h2><p id="9b1d" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">The dataset in the <code class="cx pg ph pi pj b">raw_data_source</code> range in the <code class="cx pg ph pi pj b">RawData</code> sheet was used as a data source to create two simple pivot tables and charts.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf pm"><img src="../Images/afe820de943480d30e9dd8eb9d2c2e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K6e_9NwLuvIenxEslf7MXw.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Specifying the source of the pivot table. Illustration by Author.</figcaption></figure><p id="c16f" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The first one portrayed total fruits and vegetable sales by individual products filterable by country with the field settings as shown.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf pn"><img src="../Images/3ce903eacb27581bcafc363ed7fc36d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3We_DXTScosLvthHsI3HAw.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">First pivot chart and its settings. Illustration by Author.</figcaption></figure><p id="0187" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The second one portrayed total fruit and vegetable sales by countries.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf po"><img src="../Images/db3162aae0e2636485d4dfa74618719c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQd6GkPUwS3j1Ig3eCUYDA.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Second pivot chart and its settings. Illustration by Author.</figcaption></figure><h2 id="b26d" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">1. Automating refreshing pivot tables based on a new dataset</h2><p id="d248" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">In this step, I wanted to automate the refreshing of the datasets from the file I specified. I created a placeholder in the <code class="cx pg ph pi pj b">Admin</code> sheet to place the path of the CSV data whose dataset I wanted to pull and refresh the pivot tables with. I named the cell <code class="cx pg ph pi pj b">A2</code> as <code class="cx pg ph pi pj b">filepath</code> as shown below:</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf pp"><img src="../Images/d18a0b9e83d709020bfa5db1e8f8755a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5yZPphxcsaLKxrgxRfs3Q.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Placeholder for file pathname with dataset. Illustration by Author.</figcaption></figure><p id="7fd6" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The code for this step is given below in the <code class="cx pg ph pi pj b">UpdateRawData</code> subroutine. I declared the variables <code class="cx pg ph pi pj b">wb</code>, <code class="cx pg ph pi pj b">ws_admin</code>, <code class="cx pg ph pi pj b">ws_rawdata</code>, and <code class="cx pg ph pi pj b">filepath</code> for the names of the workbook, Admin sheet, RawData sheet, and path of the file containing the dataset respectively. First I cleared the contents of the RawData sheet. Then I went to the source workbook based on the filename, selected the corresponding sheet, copied its contents, returned to the <code class="cx pg ph pi pj b">ws_rawdata</code> sheet, and pasted the contents as values. Finally, I refreshed the workbook using the code <code class="cx pg ph pi pj b">wb.RefreshAll</code> that refreshed the entire workbook including the sheets with the pivot table and chart respectively.</p><pre class="nh ni nj nk nl pq pj pr bp ps bb bk"><span id="5426" class="pt oh fq pj b bg pu pv l pw px">Sub UpdateRawData()<br/><br/>Dim wb As Workbook<br/>Dim ws_admin As Worksheet<br/>Dim ws_rawdata As Worksheet<br/>Dim filepath As String<br/><br/>Set wb = ThisWorkbook<br/>Set ws_admin = wb.Worksheets(“Admin”)<br/>Set ws_rawdata = wb.Worksheets(“RawData”)<br/><br/>'Clear Rawdata sheet<br/>ws_rawdata.Activate<br/>Cells.Clear<br/><br/>'get file path<br/>filepath = ws_admin.Range(“filepath”)<br/><br/>Application.DisplayAlerts = False<br/><br/>'Open source file and select all contents<br/>Dim src_wb As Workbook<br/>Dim src_ws As Worksheet<br/><br/>Set src_wb = Workbooks.Open(filepath)<br/>Set src_ws = src_wb.Sheets(1)<br/>src_ws.UsedRange.Select<br/><br/>'Copy all<br/>Selection.Copy<br/><br/>'Paste all<br/>ws_rawdata.Range(“A1”).PasteSpecial xlPasteValues<br/><br/>'Close source file<br/>src_wb.Close SaveChanges:=False<br/><br/>wb.RefreshAll<br/><br/>Application.DisplayAlerts = True<br/><br/>End Sub</span></pre><p id="95a8" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">I linked this subroutine to the <strong class="mk fr">Refresh files and charts</strong> button. Once I specified the filename in the placeholder and clicked on the button, the dataset and pivot tables were updated automatically.</p><h2 id="5e5f" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">2. Creating a colors table using VBA</h2><p id="28c6" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">I created a table in the <code class="cx pg ph pi pj b">Admin</code> sheet containing the list of the specific fruits and vegetables available in the dataset. In column F, I specified the tentative hexadecimal color codes for the color of each fruit or vegetable. I wanted to use these colors to update the colors in pivot charts. First, I wanted to paint column F with the color I specified in each cell.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf py"><img src="../Images/cef0874d1ee3959d227d299d7955504e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JtsCSNw17KIKaOwjRFuGPA.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Creating a list of available fruits and vegetables in the dataset along with their corresponding hexadecimal color codes. Illustration by Author.</figcaption></figure><h2 id="9401" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">Hexadecimal color code</h2><p id="380c" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">The hexadecimal code for each color is a 6-digit hexadecimal number (0 to 9 or A to F) with base 16. In a hexadecimal color code <code class="cx pg ph pi pj b">RRGGBB</code>, each pair of two letters represents the various shades of red, green, and blue color. In a Red Green Blue (RGB) system, the value of each shade ranges from 0 to 255.</p><p id="3016" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">For example, for a hexadecimal color code <code class="cx pg ph pi pj b">ffab23</code>, I calculated the corresponding RGB code with the following calculation. <code class="cx pg ph pi pj b">ffab23</code> in the hexadecimal system translates to (255, 171, 35) in the RGB system referring to the Red, Green, and Blue color components respectively.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf pz"><img src="../Images/4e0c4c79ddb75cf914723fe4accf4610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n0C7AtKBK7aTxe3fWdLyWA.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Calculating RGB code for a hexadecimal color code ffab23 manually. Illustration by Author.</figcaption></figure><p id="1670" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">This can also be visualized by going to the Custom Colors option in Excel as shown below:</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf qa"><img src="../Images/6aaf8d00e234ed7ed48d7edb7a2a7d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YheFdKzZKmP3IfjhSaNg0A.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Demonstrating RGB components and actual color for the hexadecimal color code ffab23. Illustration by Author.</figcaption></figure><p id="6b2d" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In Excel VBA, using <code class="cx pg ph pi pj b"><strong class="mk fr">&amp;H</strong></code> in combination with a value implies that it is a hexadecimal number and the <code class="cx pg ph pi pj b">Val()</code> function returns the corresponding decimal number. In the Immediate Window below, <code class="cx pg ph pi pj b">r</code>, <code class="cx pg ph pi pj b">g</code>, and <code class="cx pg ph pi pj b">b</code> represent the corresponding decimal values for each shade of Red, Green, and Blue respectively.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf qb"><img src="../Images/cb9331018b2f160b63822fa597e82fc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JLc76rZjbjBSkIXRS_Jhfg.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Immediate window displaying how the corresponding decimal values are derived in VBA from hexadecimal code. Illustration by Author.</figcaption></figure><p id="6932" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In the code below, I created a named range <code class="cx pg ph pi pj b">color_code_range</code> for the table containing the hexadecimal color code for each fruit or vegetable. I looped through each cell in the selection, derived the red, green, and blue components in decimal numbers, and painted the interior of the cell with the same RGB color code.</p><pre class="nh ni nj nk nl pq pj pr bp ps bb bk"><span id="d13f" class="pt oh fq pj b bg pu pv l pw px">Sub refresh_color_table()<br/><br/>Dim wb As Workbook<br/>Dim ws_admin As Worksheet<br/><br/>Set wb = ThisWorkbook<br/>Set ws_admin = wb.Sheets(“Admin”)<br/>ws_admin.Range("color_code_range").Select<br/> <br/>Dim c As Range<br/>Dim r, g, b As Long<br/>Dim Hex As String<br/><br/>For Each c In Selection<br/><br/>     Hex = c.Value<br/> <br/>     r = Val("&amp;H" &amp; Mid(Hex, 1, 2))<br/>     g = Val("&amp;H" &amp; Mid(Hex, 3, 2))<br/>     b = Val("&amp;H" &amp; Mid(Hex, 5, 2))<br/>     c.Interior.Color = RGB(r, g, b)<br/><br/>Next c<br/><br/>End Sub</span></pre><p id="12c5" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">When I ran the above subroutine, the column F gets painted with the same color as the color code as shown:</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf qc"><img src="../Images/c271a6cf5daa5b7f63d663750f671282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhqFgI3oRllSoUCn06qckA.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Painting the cells with the color code mentioned in it. Illustration by Author.</figcaption></figure><p id="b1c0" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">If the color code is changed, and the code is run again, it will generate new colors in the table. Isn’t that cool?</p><h2 id="b75d" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">3. Working with a dictionary in VBA</h2><p id="7249" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">In the next step, I wanted to assign the colors in the pivot charts based on the custom colors I chose above. For this purpose, I created a dictionary containing the product name as keys and the corresponding hexadecimal color codes as values.</p><p id="92ec" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The pre-requisite for creating a dictionary object in VBA is to activate the Microsoft Scripting Runtime beforehand. For this, you can go to Tools -&gt; References -&gt; Check the box next to Microsoft Scripting Runtime and click on ok.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf qd"><img src="../Images/1bbd6b917235f828e43963dc49cd8128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KoXL9UVDTyu4zwZD5bP-Ig.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Pre-requisite for working with a dictionary in Excel VBA. Illustration by Author.</figcaption></figure><p id="8146" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In the code below, I created a dictionary object called <code class="cx pg ph pi pj b">colorMap</code>. I looped through the Range E2:F10 in the <code class="cx pg ph pi pj b">Admin</code> sheet. I added the contents in column E as keys, and the contents in column F as their corresponding values.</p><pre class="nh ni nj nk nl pq pj pr bp ps bb bk"><span id="f4e4" class="pt oh fq pj b bg pu pv l pw px">Sub create_dict()<br/><br/>Dim wb As Workbook<br/>Dim ws_admin As Worksheet<br/><br/>Set wb = ThisWorkbook<br/>Set ws_admin = wb.Sheets(“Admin”)<br/><br/>Dim colorMap As Dictionary<br/>Set colorMap = New Dictionary<br/><br/>Dim i As Integer<br/><br/>For i = 2 To 10<br/>    If Not colorMap.Exists(Range("E" &amp; i).Value) Then<br/>        colorMap.Add Range("E" &amp; i).Value, Range("F" &amp; i).Value<br/>    End If<br/>Next i<br/><br/>For Each Key In colorMap.Keys()<br/>     Debug.Print Key &amp; ": " &amp; colorMap(Key)<br/>Next Key<br/><br/>End Sub</span></pre><p id="3ca9" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In the second for loop above, I looped through each key of the colorMap dictionary and printed the keys and values in the immediate window as shown below:</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div class="ne nf qe"><img src="../Images/a30fc8c8a5eeefcdc4e7761894af41bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*hGZcXMu22Zu-_WrQ5n54Cw.png"/></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Printing the contents of the colorMap dictionary object. Illustration by Author.</figcaption></figure><h2 id="cb4d" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">4. Managing pivot chart elements using VBA</h2><p id="7a3c" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">Based on the learnings from the previous steps, I wanted to go one step further and update the pivot chart elements using VBA. In this case, I wanted to set the chart title automatically based on a cell value and apply the colors of specific fruits and vegetables defined in the <code class="cx pg ph pi pj b">Admin</code> sheet to the pivot charts.</p><p id="78fc" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">In this step, I assigned <code class="cx pg ph pi pj b">Plot1</code> and <code class="cx pg ph pi pj b">Plot2</code> sheets as an array called <code class="cx pg ph pi pj b">sheetNames</code>. I declared <code class="cx pg ph pi pj b">chartObj</code> as ChartObject. Within each sheet, I looped through each ChartObject among all ChartObjects.</p><p id="f400" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk"><strong class="mk fr">Note:</strong> <a class="af nx" href="https://learn.microsoft.com/en-us/office/vba/api/excel.chartobject" rel="noopener ugc nofollow" target="_blank">ChartObject</a> acts as a container for a <a class="af nx" href="https://learn.microsoft.com/en-us/office/vba/api/excel.chart(object)" rel="noopener ugc nofollow" target="_blank">Chart</a> object in VBA that controls the size and appearance of the embedded chart in a worksheet. It is a member of the <a class="af nx" href="https://learn.microsoft.com/en-us/office/vba/api/excel.chartobjects" rel="noopener ugc nofollow" target="_blank">ChartObjects</a> collection. It is important to understand the differences in the methods and properties of each of these objects in VBA.</p><p id="a4b7" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">After going through each chartObj, I set the title for each chart based on the value in cell E1. Next, I looped through each series in the overall Series Collection of the Chart object. I assigned the series name (i.e., name of fruit or vegetable) to a variable called <code class="cx pg ph pi pj b">itemName</code>, and got the corresponding color code from the <code class="cx pg ph pi pj b">colorMap</code> dictionary. Similar to step 2, I got the red, green, and blue components of the color code in decimal numbers, and filled the series bar with the RGB colors.</p><pre class="nh ni nj nk nl pq pj pr bp ps bb bk"><span id="98f3" class="pt oh fq pj b bg pu pv l pw px">Sub refresh_plots()<br/><br/>Dim wb As Workbook<br/>Dim ws_admin As Worksheet<br/>Dim ws As Worksheet<br/><br/>Set wb = ThisWorkbook<br/>Set ws_admin = wb.Sheets("Admin")<br/><br/>Dim colorMap<br/>Set colorMap = CreateObject("Scripting.Dictionary")<br/>Dim i As Integer<br/><br/>For i = 2 To 10<br/>     If Not colorMap.Exists(Range("E" &amp; i).Value) Then<br/>          colorMap.Add Range("E" &amp; i).Value, Range("F" &amp; i).Value<br/>     End If<br/>Next i<br/><br/>Dim sheetNames As Variant<br/>Dim sheetName As Variant<br/>sheetNames = Array("Plot1", "Plot2")<br/><br/>Dim hex_color_code As String<br/>Dim r, g, b As Integer<br/><br/>Dim chartObj As ChartObject<br/><br/>For Each sheetName In sheetNames<br/>     Set ws = wb.Sheets(sheetName)<br/> <br/>     For Each chartObj In ws.ChartObjects<br/> <br/>          chartObj.Chart.HasTitle = True<br/>          chartObj.Chart.ChartTitle.Text = ws.Range("E1").Value<br/> <br/>          For Each Series In chartObj.Chart.SeriesCollection<br/><br/>               itemName = Series.Name<br/>               hex_color_code = colorMap(itemName)<br/> <br/>               r = Val("&amp;H" &amp; Mid(hex_color_code, 1, 2))<br/>               g = Val("&amp;H" &amp; Mid(hex_color_code, 3, 2))<br/>               b = Val("&amp;H" &amp; Mid(hex_color_code, 5, 2))<br/>               Series.Format.Fill.ForeColor.RGB = RGB(r, g, b)<br/> <br/>          Next Series<br/>     Next chartObj<br/>Next sheetName<br/><br/>End Sub</span></pre><p id="be9c" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">An illustration of the use of this code is depicted below.</p><figure class="nh ni nj nk nl nm ne nf paragraph-image"><div role="button" tabindex="0" class="nn no ed np bh nq"><div class="ne nf qf"><img src="../Images/cdfe81230c6b410e79176524e22ccd66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jrJAhM5qxAZC7cbvwycXTA.png"/></div></div><figcaption class="ns nt nu ne nf nv nw bf b bg z dx">Transformation of pivot chart elements using the VBA code. Illustration by Author.</figcaption></figure><h2 id="fdf3" class="og oh fq bf oi oj ok ol om on oo op oq mr or os ot mv ou ov ow mz ox oy oz pa bk">Conclusion</h2><p id="a26f" class="pw-post-body-paragraph mi mj fq mk b go pb mm mn gr pc mp mq mr pd mt mu mv pe mx my mz pf nb nc nd fj bk">In this post, I illustrated how one can customize and automate working with pivot tables and charts using VBA. I have demonstrated the automation of four key tasks: refreshing pivot tables and charts with new datasets; creating color tables based on hexadecimal color code; how to work with dictionaries in VBA; and managing and updating pivot chart elements using VBA. In the second step, I have elaborated the conversion of hexadecimal color codes to the corresponding RGB color codes using both Excel and VBA, and used this technique in the subsequent steps.</p><p id="210b" class="pw-post-body-paragraph mi mj fq mk b go ml mm mn gr mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd fj bk">The code and Excel file for this post are present in this GitHub <a class="af nx" href="https://github.com/hbshrestha/Data_Analytics" rel="noopener ugc nofollow" target="_blank">repository</a>. Thank you for reading!</p></div></div></div></div>    
</body>
</html>