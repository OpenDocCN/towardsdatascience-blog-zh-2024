# 解锁洞察：构建一个使用逻辑回归的评分卡

> 原文：[https://towardsdatascience.com/unlocking-insights-building-a-scorecard-with-logistic-regression-d05cd5eb0927?source=collection_archive---------2-----------------------#2024-02-15](https://towardsdatascience.com/unlocking-insights-building-a-scorecard-with-logistic-regression-d05cd5eb0927?source=collection_archive---------2-----------------------#2024-02-15)

## *想要一张信用卡？一份保险单？你是否曾想过那个塑造这些决策的三位数字号码是什么？*

[](https://medium.com/@morozov6?source=post_page---byline--d05cd5eb0927--------------------------------)[![Vassily Morozov](../Images/ad68147fa291f1e1e2c03ec958232717.png)](https://medium.com/@morozov6?source=post_page---byline--d05cd5eb0927--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--d05cd5eb0927--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--d05cd5eb0927--------------------------------) [Vassily Morozov](https://medium.com/@morozov6?source=post_page---byline--d05cd5eb0927--------------------------------)

·发表于 [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--d05cd5eb0927--------------------------------) ·9分钟阅读·2024年2月15日

--

## **简介**

许多行业都使用评分卡来做出决策。金融机构和保险公司使用评分卡来决定某人是否适合信用或保险。某些国家甚至使用社会评分来评估个人的可信度并判断他们的行为*。*

例如，在使用评分卡做出自动决策之前，客户会走进银行，与银行工作人员讨论他们希望借款的金额以及为何需要贷款。银行员工可能会将他们自己的思维方式和偏见融入决策过程中。这个人来自哪里？他们穿什么？甚至，今天我感觉如何？

*评分卡使竞争环境平等，并允许每个人在相同的基础上进行评估。*

![](../Images/e0e5b113e73d07b45653694be961b5c8.png)

由 [DeepAI](https://deepai.org/machine-learning-model/text2img) 图像生成器生成

最近，我参加了几个[*Kaggle*](https://www.kaggle.com/) 竞赛，并分析了特色数据集。2024年的首场比赛旨在确定客户离开银行的可能性。这是一个常见的任务，对市场营销部门非常有用。为了这场比赛，我决定放下通常在这些任务中使用的基于树和集成建模技术，回归基础：使用**逻辑回归**。

在这里，我将引导你了解逻辑回归模型的开发过程，将其转化为分数，并将其呈现为记分卡。这样做的目的是展示如何揭示数据及其与二元目标之间的关系。这种模型的优势在于它更简单、更容易解释，甚至对非技术观众也能轻松理解。

我的Kaggle笔记本，包含所有的代码和数学公式，可以在[*这里*](https://www.kaggle.com/code/vassyesboy/scorecard-logistic-regression-s4e1)找到。这篇文章将重点介绍亮点。

## 什么是分数？

我们在这里描述的分数是基于逻辑回归模型的。该模型为我们的输入特征分配权重，并输出一个概率，我们可以通过校准步骤将其转换为分数。一旦获得分数，我们就可以通过记分卡来表示：展示个人根据可用数据的得分。

让我们通过一个简单的例子来了解一下。

X先生走进银行，寻找一个新业务的贷款。银行使用一个简单的基于收入和年龄的分数来决定是否批准该个人。

X先生是一个收入相对较低的年轻人。他因为年龄受到惩罚，但在收入范围内得分较高（第二高）。总的来说，他在这张记分卡上得了24分，这是一个中等分数（最高分为52分）。

银行通常会使用一个分数截断线，来根据内部政策决定需要多少分才能被接受。这个分数是基于逻辑回归模型的，逻辑回归是基于一些二元定义，通过一组特征来预测对数几率。

对于银行而言，逻辑回归可能用于预测那些错过还款的人。对于保险公司，可能是预测曾经提出过索赔的人。对于社交分数，可能是预测那些曾经参加过无政府主义集会的人（虽然我不太确定这些分数具体预测什么，但我会很感兴趣想了解！）。

我们不会逐一讲解完整模型开发所需的所有步骤，但将探讨一些关键步骤：

+   **证据权重转换**：通过像X先生的例子一样将我们的连续特征离散化，进行分组。

+   **校准我们的逻辑回归输出以生成分数**：将我们的概率转换为更易于用户理解的数字，即转换为分数。

+   **将我们的分数表示为记分卡**：展示每个特征如何影响最终分数。

## **证据权重转换**

在“X先生”的例子中，我们看到模型有两个基于数值的特征：X先生的年龄和收入。这些变量被分组，以便更容易理解模型及其驱动个人评分的因素。直接使用这些连续变量（与分组相比）可能意味着对于数值上的微小差异，评分会有显著不同。在信用或保险风险的背景下，这会使得决策更难以辩解和解释。

有多种方法可以进行分组，但通常会先采取一种初步的自动化方法，然后手动微调分组以使其具有定性意义。在这里，我将每个连续特征单独输入决策树，以获得初步的分组集合。

一旦分组确定，我便计算了每个分组的证据权重。该公式如下所示：

证据权重（WoE）的公式。分布可以反转，以改变特征之间的关系。

这是一种在信用评分模型中常用的转换技术，通常使用逻辑回归，因为它与对数几率之间有线性关系，而逻辑回归旨在预测的正是这一点。我不会在这里深入数学内容，因为这些内容在我的[Kaggle笔记本](https://www.kaggle.com/code/vassyesboy/scorecard-logistic-regression-s4e1)中已详细覆盖。

一旦我们得到了每个分组特征的证据权重，就可以可视化这个趋势。对于银行客户流失预测的Kaggle数据，我包含了几个特征来说明这些转换。

![](../Images/d0d573064f4101b1fe9758b8b7cdf117.png)

*图片由作者提供*

每个证据权重周围的红色条表示95%的置信区间，这意味着我们有95%的把握认为证据权重会落在这个范围内。较窄的区间通常与拥有足够样本量且可以对证据权重保持信心的稳健分组相关。

例如，分组余额的16和22类的客户离开银行的数量较少（分别为19和53个案例），并且它们的置信区间最宽。

这些模式揭示了特征之间的关系以及客户离开银行的概率。年龄特征稍微更容易理解，因此我们先从这个开始。

**随着客户年龄的增长，他们更有可能离开银行。**

这个趋势相当清晰，并且大部分是单调的，除了某些组别，比如25-34岁的个体比18-24岁的个体更不可能离开银行。除非有强有力的理由来支持这种情况（此时领域知识发挥作用！），我们可能会考虑将这两个类别进行合并，以确保单调趋势。

单调趋势在做出授予信用或保险政策的决策时非常重要，因为这通常是监管要求，以确保模型不仅准确，而且可以解释。

这引出了余额特征。模式并不明确，我们在这里没有真正的依据。确实，余额较低的客户离开银行的可能性较小，但你需要将多个组进行分段才能使这一趋势有意义。

通过将类别2–9、13–21分组，并将22单独分为一组（分别进入1、2和3组），我们可以开始看到趋势。然而，这样做的缺点是会丧失特征的细粒度，可能会影响下游模型的表现。

![](../Images/9c845ebff89e82b494838188fd785703.png)

*作者提供的图片*

对于Kaggle竞赛，我的模型不需要可解释性，因此我没有重新分组任何特征，只是专注于基于我应用的自动分组生成最具预测性的得分。在行业应用中，我可能会三思而后行。

值得注意的是，我们的洞察仅限于我们已有的特征，且观察到的行为可能还有其他潜在原因。例如，年龄趋势可能是由于政策变动驱动的，如转向在线银行，但如果没有额外的数据，这种因素无法在模型中被捕捉到。

如果你想对数值特征进行自动分组，应用此转换并为自己生成相关图表，可以使用我整理的Python仓库[这里](https://github.com/VassMorozov/Weights-of-Evidence)进行任何二元分类任务的创建。

一旦这些特征可用，我们就可以拟合逻辑回归模型。拟合后的逻辑回归将具有截距，并且模型中的每个特征都会有一个系数。基于此，我们可以输出某人可能离开银行的概率。我在这里不会花时间讨论如何拟合回归模型，但和之前一样，所有细节都可以在我的[Kaggle笔记本](https://www.kaggle.com/code/vassyesboy/scorecard-logistic-regression-s4e1)中找到。

# **校准我们的逻辑回归输出以生成得分**

拟合后的逻辑回归可以输出一个概率，但这对于非技术用户来说并不特别有用。因此，我们需要对这些概率进行校准，并将其转换为更简洁、更易于解释的结果。

请记住，逻辑回归的目的是预测对数赔率。我们可以通过对这些赔率进行线性转换来生成得分，具体方法如下：

在信用风险中，将赔率翻倍和1:1赔率通常分别设定为20和500，但这并非总是如此，值可能会有所不同。为了我的分析，我坚持使用了这些值。

我们可以通过绘制其分布来可视化校准后的得分。

![](../Images/f966b0f3b1b52776a11f1152698f8921.png)

*作者提供的图片*

我将分布按目标变量（客户是否离开银行）进行拆分，这提供了一个有用的验证，确保所有先前的步骤都已正确执行。那些更可能离开银行的客户分数较低，而那些留下的客户分数较高。虽然存在重叠，但分数很少是完美的！

基于这个分数，市场营销部门可以设定一个分数门槛，以确定应该将哪些客户作为特定营销活动的目标。这个门槛可以通过查看分布并将分数转换回概率来设置。

将分数500转化为概率为50%（记住，我们的1:1赔率在校准步骤中等于500）。这意味着，得分低于500的客户中，约有一半会离开银行。如果我们希望吸引更多这类客户，我们只需提高分数门槛。

## 将我们的分数表示为评分卡

我们已经知道，逻辑回归由一个截距和每个使用特征的一组权重组成。我们还知道，证据权重与对数赔率之间存在直接的线性关系。了解这一点后，我们可以将每个特征的证据权重转换为分数，以了解它对整体分数的贡献。

我已在我的[Kaggle笔记本](https://www.kaggle.com/code/vassyesboy/scorecard-logistic-regression-s4e1)中展示了模型中所有特征的情况，但以下是我们在将变量转换为证据权重形式时已经看到的示例。

**年龄**

**余额**

与证据权重形式相比，这种表示的优势在于，它应该对任何人都有意义，而无需理解底层的数学原理。我可以告诉市场营销的同事，48到63岁之间的客户分数低于其他客户。没有账户余额的客户比有高余额的客户更可能离开。

你可能已经注意到，在评分卡中，余额趋势与在证据权重阶段观察到的相反。现在，低余额的客户分数较低。这是因为该特征在模型中的系数是负值，从而反转了最初的趋势。这种情况可能发生，因为在拟合模型过程中，特征之间存在各种交互作用。必须决定是否接受这些交互作用，或者如果趋势变得不合常理，是否希望删除该特征。

支持文档可以解释任何分数的完整细节以及它是如何开发的（或者至少应该解释！），但仅凭评分卡，任何人都应该能够立即获得洞察！

## 结论

我们探讨了基于逻辑回归开发分数的一些关键步骤以及它所带来的洞察。最终输出的简洁性是为什么这种类型的分数至今仍被使用，尽管有更先进的分类技术。

我为这次竞赛开发的评分模型曲线下面积为87.4%，而基于集成技术的最佳解决方案大约为90%。这表明，尽管这个简单模型在追求准确性的情况下并不完美，但它仍然具有竞争力。然而，如果你在下一个分类任务中寻找一个简单且易于解释的模型，为什么不考虑使用评分卡来深入了解你的数据呢？

## 参考文献

[1] Walter Reade, Ashley Chow, [使用银行流失数据集进行二分类](https://kaggle.com/competitions/playground-series-s4e1) (2024), Kaggle.
