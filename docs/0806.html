<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Intersect Multiple 3D Lines (Closest Point)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Intersect Multiple 3D Lines (Closest Point)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/intersect-multiple-3d-lines-closest-point-93e06b296f15?source=collection_archive---------11-----------------------#2024-03-27">https://towardsdatascience.com/intersect-multiple-3d-lines-closest-point-93e06b296f15?source=collection_archive---------11-----------------------#2024-03-27</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="8c19" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Seeking intersection of a batch of 3D lines is more of a minimization problem than an actual intersection test, as usually done with 2 rays</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@thom01.rouch?source=post_page---byline--93e06b296f15--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Thomas Rouch" class="l ep by dd de cx" src="../Images/a8440bbed59cd8d9cdd752cf1fea2831.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*bzXmGPw5ErdKoJZ6gYLBsw.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--93e06b296f15--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@thom01.rouch?source=post_page---byline--93e06b296f15--------------------------------" rel="noopener follow">Thomas Rouch</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--93e06b296f15--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">5 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Mar 27, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/23b99afae4ea83fbbf90d039e7880ddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DipwYurHv9xriZix"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@baud_wisselmann?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Baudouin Wisselmann</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="cbcc" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">1. Introduction</h1><h2 id="f0f9" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Motivation</h2><p id="2990" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">F</span>iguring out where several 3D lines meet is really useful in fields like 3D Reconstruction or Augmented Reality. For instance, it helps us triangulate a 3D point from its multi-view 2D image detections or find the main 3D center of attention of a camera rotating around an object.</p><p id="620e" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Even though each line may contain some noise, having many of them helps reducing the variability, much like when we calculate the average of several samples.</p><h2 id="6f6a" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Two rays VS multiple rays</h2><p id="9dc7" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">In</span> a previous article called <a class="af nb" href="https://medium.com/towards-data-science/3d-ray-intersection-closest-point-dc8c72122224" rel="noopener"><strong class="ou fr"><em class="pz">Intersect 3D Rays (Closest Point)</em></strong></a><strong class="ou fr"> </strong>I explained how to intersect a pair of 3D rays. But, what if we want to intersect <code class="cx qa qb qc qd b">n</code> rays? As we’ll see in this article, moving from 2 to <code class="cx qa qb qc qd b">n</code> rays isn’t just a generalization, it’s fundamentally different.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qe"><img src="../Images/1b07c39a95a5ac807f401cb8542537f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZrMVglFo3kJBg3om9oLIQ.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Intersecting two rays VS intersecting multiple rays — Figure by the author</figcaption></figure><p id="d15c" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The simple fact of asking a question implies that the question is worth asking. Thus, seeking the intersection of a group of 3D rays inherently suggests the existence of such a common point of convergence, even if there’s some noise.</p><blockquote class="qf qg qh"><p id="5cde" class="os ot pz ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Q<!-- -->uick reminder: Mathematically, a ray is defined by its origin <code class="cx qa qb qc qd b"><em class="fq">o</em></code> and direction <code class="cx qa qb qc qd b"><em class="fq">d</em></code>. Since it’s a 1D space, any point along the ray is parametrized by its positive distance (or time) <code class="cx qa qb qc qd b"><em class="fq">t</em></code> with respect to the origin.</p></blockquote><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qi"><img src="../Images/b203aab18b69d9958f77df43a81e9975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/0*ME0kx_m7Ul9AIIlG"/></div></figure><p id="af16" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">In the case of two rays, we solve for the parametrization <code class="cx qa qb qc qd b">t1</code> and <code class="cx qa qb qc qd b">t2</code> along each ray near the closest point, then determine from this whether the rays intersect or not, i.e. if <code class="cx qa qb qc qd b">t1&gt;0</code> and <code class="cx qa qb qc qd b">t2&gt;0</code>. Since optimal <code class="cx qa qb qc qd b">t1</code> and <code class="cx qa qb qc qd b">t2</code>can be computed independently, this method also allows early stopping, e.g. skip computation of <code class="cx qa qb qc qd b">t2</code> if <code class="cx qa qb qc qd b">t1&lt;0</code>.</p><p id="ff9f" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">In the case of <code class="cx qa qb qc qd b">n</code> rays, we can assume that the rays are intersecting and directly solve for the 3D intersection point, instead of solving for the <code class="cx qa qb qc qd b">n </code>optimal parametrizations along each ray. Hence, it’s more of a minimization problem than an actual intersection test.</p><h2 id="bb31" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Ray or Line ?</h2><p id="25ea" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">S</span>ince we’re not checking the parametrization along each ray, it’s more accurate to talk about lines instead of rays; hence the title of the article. A line is just a ray without the constraint on <code class="cx qa qb qc qd b">t</code>.</p></div></div></div><div class="ab cb qj qk ql qm" role="separator"><span class="qn by bm qo qp qq"/><span class="qn by bm qo qp qq"/><span class="qn by bm qo qp"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qr"><img src="../Images/cf400ffcbad1d9aadc8070d6c7e1efc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QmuZxhxlAe0vBG5f"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Photo by <a class="af nb" href="https://unsplash.com/@profwicks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ben Wicks</a> on <a class="af nb" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="7cb0" class="nc nd fq bf ne nf ng gq nh ni nj gt nk nl nm nn no np nq nr ns nt nu nv nw nx bk">2. Analytical Solution</h1><h2 id="188f" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Useful vector trick</h2><p id="d140" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">B</span>efore diving into the main topic, I’d like to quickly discuss a vector trick that will be very useful to us later on.</p><p id="af3e" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Scaling a vector by a dot product can also be seen as a matrix-vector product. Terms can indeed be re-arranged thanks to the associative property of the product operator.</p><p id="7614" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">This will help us factorize an equation by highlighting its linearity in variable <code class="cx qa qb qc qd b">c</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qs"><img src="../Images/c1d4319308900121a6598c77f4ebe650.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/0*Z9IYJVdLuyVyP_uk"/></div></figure><h2 id="c2ab" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Minimization Problem</h2><p id="1787" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he intersection point can be defined as the 3D point <code class="cx qa qb qc qd b">x</code> that minimizes the sum of squared distances with respect to each input ray.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qt"><img src="../Images/d403e6a27a2ff2bcc0d3e96325c0e595.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/0*pcN2U0gqYl6Lgp3l"/></div></figure><h2 id="56fc" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Orthogonal Projection of a point onto a line</h2><p id="4165" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he vector going from the ray origin <code class="cx qa qb qc qd b">o</code> to the point <code class="cx qa qb qc qd b">x</code> can be expressed as the sum of two orthogonal vectors. As illustrated in the diagram below, the first one goes from <code class="cx qa qb qc qd b">o</code> to <code class="cx qa qb qc qd b">p</code> along the line, whereas the second one goes from <code class="cx qa qb qc qd b">p</code> to <code class="cx qa qb qc qd b">x</code>.</p><p id="5b54" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Once we know the coordinates of this point <code class="cx qa qb qc qd b">p</code>, i.e. the projection of <code class="cx qa qb qc qd b">x</code>, we can deduce the distance from the point <code class="cx qa qb qc qd b">x</code> to the line by computing the norm of the vector <code class="cx qa qb qc qd b">x-p</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qu"><img src="../Images/64f27de9b05c63410518f2bef96796a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C1PRcEZIsadmo1GhoQ_f3g.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Point-Line distance — Figure by the author</figcaption></figure><p id="870b" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Let’s compute <code class="cx qa qb qc qd b">p</code>.</p><p id="4410" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">As illustrated in the system of equations below, the point <code class="cx qa qb qc qd b">p</code> is defined by two key properties: it belongs to the line (with unknown ray parameter <code class="cx qa qb qc qd b">tp</code>) and is such as <code class="cx qa qb qc qd b">x-p</code> is orthogonal to the line.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qv"><img src="../Images/0fb7bb8ad8a1414552434596ea33ed5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/0*3pyutT9u0Yj7j2hY"/></div></figure><p id="2701" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">Introducing the ray parametrization into the second equation yields the value of <code class="cx qa qb qc qd b">tp</code>, which is the dot product between <code class="cx qa qb qc qd b">x-o</code> and <code class="cx qa qb qc qd b">d</code>.</p><blockquote class="qf qg qh"><p id="2eee" class="os ot pz ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">N.B. We assume that the ray direction <code class="cx qa qb qc qd b">d</code> has been normalized.</p></blockquote><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qw"><img src="../Images/1c44f02776cff66034693bcfb45907a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/0*OmLyL0q7PIayiZ4b"/></div></figure><p id="8730" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">We can now put it back into the ray parametrization to retrieve point <code class="cx qa qb qc qd b">p</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qx"><img src="../Images/06e5b5e3e9e225349ed2706a4bd4dffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/0*YC6haFeAS_R_hZBs"/></div></figure><p id="9b13" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The vector trick mentioned previously is helpful here to emphasize the linearity with respect to <code class="cx qa qb qc qd b">x-o</code>, which will help the factorization.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qy"><img src="../Images/7b04856deed4550341f6d8420785b00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/0*SVpeQNqKtac0dmoD"/></div></figure><h2 id="efa7" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Point-Line Distance</h2><p id="9476" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">As</span> explained previously, the point-line distance can now be computed from the norm of <code class="cx qa qb qc qd b">x-p</code>. Note the nice factorization in <code class="cx qa qb qc qd b">x-o</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj qz"><img src="../Images/027e5ab503c42eef4076e4784444edd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/0*1ckv4bF39yubpeLg"/></div></figure><h2 id="0ad3" class="ny nd fq bf ne nz oa ob nh oc od oe nk of og oh oi oj ok ol om on oo op oq or bk">Loss Function</h2><p id="c9bd" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">T</span>he point-line distance formula gives us the loss function <code class="cx qa qb qc qd b">L</code> we seek to minimize.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj ra"><img src="../Images/c9728f659328ff17ac5550964f64766e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BnDJ36aWoB_EpoZ3"/></div></div></figure><p id="f141" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The factorization in <code class="cx qa qb qc qd b">x-o</code> makes it straightforward to derive its gradient with respect to <code class="cx qa qb qc qd b">x</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="ab cn cb rb"><img src="../Images/a7e5da2ad869b81e396dbaad7c533648.png" data-original-src="https://miro.medium.com/v2/format:webp/0*rjWAqrtmbzZ3uvTl"/></div></figure><p id="e053" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The minimum value of this convex loss function can now be obtained by identifying the point where its gradient equals zero.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj rc"><img src="../Images/e9a31697717faecae4cc637d755618af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kRTHDRdK3QlBxVp9"/></div></div></figure><p id="8018" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">We end up with a linear <code class="cx qa qb qc qd b">3x3</code> system of equations <code class="cx qa qb qc qd b">Ax=b</code>, where the matrix <code class="cx qa qb qc qd b">A</code> and vector <code class="cx qa qb qc qd b">b</code> are defined as follows:</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj rd"><img src="../Images/184740c7a3c7faa5ffe524f5425ef3dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/0*gJ9p2B0AYp-bwnA3"/></div></figure><p id="f76f" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">The 3D point closest to all the lines is thus obtained by inverting <code class="cx qa qb qc qd b">A</code>.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="mi mj re"><img src="../Images/472bb130b9bc6c9d2050a35ad7d6d48f.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/0*P8ytXGMOZumVgPsj"/></div></figure></div></div></div><div class="ab cb qj qk ql qm" role="separator"><span class="qn by bm qo qp qq"/><span class="qn by bm qo qp qq"/><span class="qn by bm qo qp"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="7c84" class="nc nd fq bf ne nf rf gq nh ni rg gt nk nl rh nn no np ri nr ns nt rj nv nw nx bk">Conclusion</h1><p id="01da" class="pw-post-body-paragraph os ot fq ou b go ov ow ox gr oy oz pa of pb pc pd oj pe pf pg on ph pi pj pk fj bk pl"><span class="l pm pn po bo pp pq pr ps pt ed">L</span>east-Squares minimization can often be reduced to a plain normal equation, where the pseudo-inverse matrix is used to aggregate the <code class="cx qa qb qc qd b">n</code> observations into a square invertible matrix.</p><p id="25d0" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">It’s worth mentioning that we don’t require the pseudo-inverse here, as the square shape naturally arises from the sum of outer products of the ray directions.</p><p id="fb35" class="pw-post-body-paragraph os ot fq ou b go pu ow ox gr pv oz pa of pw pc pd oj px pf pg on py pi pj pk fj bk">I hope you enjoyed reading this article and that it gave you more insights on how to intersect multiple 3D lines!</p></div></div></div></div>    
</body>
</html>