<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Unit Disk Uniform Sampling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Unit Disk Uniform Sampling</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/unit-disk-uniform-sampling-91880f3740fa?source=collection_archive---------11-----------------------#2024-09-16">https://towardsdatascience.com/unit-disk-uniform-sampling-91880f3740fa?source=collection_archive---------11-----------------------#2024-09-16</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="28fc" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Discover the optimal transformations to apply on the standard [0,1] uniform random generator for uniformly sampling a 2D disk</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@thom01.rouch?source=post_page---byline--91880f3740fa--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Thomas Rouch" class="l ep by dd de cx" src="../Images/a8440bbed59cd8d9cdd752cf1fea2831.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*bzXmGPw5ErdKoJZ6gYLBsw.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--91880f3740fa--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@thom01.rouch?source=post_page---byline--91880f3740fa--------------------------------" rel="noopener follow">Thomas Rouch</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--91880f3740fa--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">13 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Sep 16, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/a5274695921aab399278b1c4885a9e40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cFvTSqx1ygVrbaU_"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@little_klein?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Vitolda Klein</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="5381" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">0. Introduction</h1><p id="2a5d" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">In</span> my previous article on <a class="af nc" rel="noopener" target="_blank" href="/unit-disk-and-2d-bounded-kde-2cb5c3544f1c"><em class="pe">Unit Disk and 2D Bounded KDE</em></a>, I discussed the importance of being able to sample arbitrary distributions. This is especially relevant for applications like Monte Carlo integration, which is used to solve complex integrals, such as light scattering in <a class="af nc" href="https://pbrt.org/" rel="noopener ugc nofollow" target="_blank"><em class="pe">Physically Based Rendering</em> (PBRT)</a>.</p><p id="ab7d" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Sampling in 2D introduces new challenges compared to 1D. This article focuses on uniformly sampling the 2D unit disk and visualizing how transformations applied to a standard [0,1] uniform random generator create different distributions.</p><p id="8917" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">We’ll also explore how these transformations, though yielding the same distribution, affect Monte Carlo integration by introducing distortion, leading to increased variance.</p></div></div></div><div class="ab cb pk pl pm pn" role="separator"><span class="po by bm pp pq pr"/><span class="po by bm pp pq pr"/><span class="po by bm pp pq"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="d5d0" class="nd ne fq bf nf ng ps gq ni nj pt gt nl nm pu no np nq pv ns nt nu pw nw nx ny bk">1. How to sample a disk uniformly?</h1><h2 id="230d" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Introduction</h2><p id="3410" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">R</span>andom number generators often offer many predefined sampling distributions. However, for highly specific distributions, you’ll likely need to create your own. This involves combining and transforming basic distributions to achieve the desired outcome.</p><p id="d4db" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">For instance, to uniformly sample the interval between <code class="cx qo qp qq qr b">a</code> and <code class="cx qo qp qq qr b">b</code>, you can apply an affine transform on the standard uniform sampling from <code class="cx qo qp qq qr b">[0,1]</code>.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qs"><img src="../Images/516b44fb76ab4312ef169c2eddd881ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/0*raskBKiuHC66mi5F"/></div></figure><p id="92df" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">In this article, we’ll explore how to uniformly sample points within the 2D unit disk by building on the basic [0,1] uniform sampling.</p><blockquote class="qt qu qv"><p id="8a8c" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">For readability, I’ve intentionally used the adjective “unit” in two different contexts in this article. The “unit square” refers to the [0,1]² domain, reflecting the range of the basic random generator. Conversely, the “unit disk” is described within [-1,1]² for convenience in polar coordinates. In practice, we can easily map between these using an affine transformation. We’ll denote <code class="cx qo qp qq qr b"><em class="fq">u</em></code> and <code class="cx qo qp qq qr b"><em class="fq">v</em></code> as samples drawn from the standard [0,1] or [-1,1] uniform distribution.</p></blockquote><h2 id="2de2" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Rejection Sampling</h2><p id="86cb" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">U</span>sing the [0,1] uniform sampling twice allows us to uniformly sample the unit square [0,1]².</p><p id="5a8c" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">A very simple approach known as “Rejection Sampling” consists in sampling the unit square and rejecting any sample falling outside the disk.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qw"><img src="../Images/b57ec900cb99f629ec666feb67555de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4w8i8aAlQUw9vDDZ1a-Pw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Rejection sampling of the inner disk inside the unit square. Valid (green) and invalid (red) samples - Figure by the author</figcaption></figure><p id="c94e" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">This results in points that follow a uniform 2D distribution within the disk contained in the unit square, as illustrated in the figure below.</p><blockquote class="qt qu qv"><p id="f417" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The density maps in this article are generated by sampling many points from the specified distribution and then applying a Kernel Density Estimator. Methods for addressing boundary bias in the density are detailed in the previous article <a class="af nc" href="https://medium.com/towards-data-science/unit-disk-and-2d-bounded-kde-2cb5c3544f1c" rel="noopener"><strong class="ob fr">“Unit Disk and 2D Bounded KDE”</strong></a><strong class="ob fr">.</strong></p></blockquote><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/8c919f93803088a39ebc292a4867d14a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uhLYDjT5ngxendODQvA0pQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Density of the 2D Disk Rejection Sampling estimated by Kernel Density Estimation on 10000 samples. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure><p id="dd59" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">A major drawback is that rejection sampling can require many points to get the desired number of valid samples, with no upper limit on the total number, leading to inefficiencies and higher computational costs.</p><h2 id="b0eb" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Intuitive Polar Sampling</h2><p id="8e7c" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">An</span> intuitive approach is to use polar coordinates for uniform sampling: draw a radius within [0,1] and an angle within [0, 2π].</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qy"><img src="../Images/9fde3aeb830972d63181fc0952465bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*v3TM0oqvtU0cxQ5R"/></div></figure><p id="ed3d" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Both the radius and angle are uniform, what could possibly go wrong?However, this method leads to an infinite density singularity at the origin, as illustrated by the empirical density map below.</p><blockquote class="qt qu qv"><p id="733c" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">To ensure the linear colormap remains readable, the density map has been capped at an arbitrary maximum value of 10. Without this cap, the map would display a single red dot at the center of a blue disk.</p></blockquote><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/703362cd37e51f257f4e683ecbe0bafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SqzbNicUd6Y8x4ApWKyLTw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Density of the 2D Disk Polar Sampling estimated by Kernel Density Estimation on 10000 samples. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure><p id="8eb3" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The figure below uses color to show how the unit square, sampled with (u,v), maps to the unit disk with (x,y) using the polar transform defined above. The colored areas in the square are equal, but this equality does not hold once mapped to the disk. This visually illustrates the density map: large radii exhibit much lower density, as they are distributed across a wider ring farther from the origin.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/2a382094b8d35583d98252686f0411b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-i8kUe3LwU7IA5KTHLGk8w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Unit Square with colored columns. Right: Corresponding Polar mapping to the unit Disk — Figure by the author</figcaption></figure><p id="db06" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Let’s explore the mathematical details. When applying a transform T to a multi-dimensional random variable A, the resulting density is found by dividing by the absolute value of the determinant of the Jacobian of T.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qz"><img src="../Images/a8abf9f098f02118f970822f08eb3f9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5EE6in_QRnSZ8k_w"/></div></div></figure><p id="7f7a" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The polar transform is given by the equation below.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk ra"><img src="../Images/41afde5c216d7426b06161afcf45a0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/0*lZBEx5MkENXjJ4rQ"/></div></figure><p id="6e12" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">We can compute the determinant of its jacobian.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rb"><img src="../Images/7956a7c947454501ea73e841f646e328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y3itJZHMwtRd6Gzq"/></div></div></figure><p id="4a1d" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Thus, the polar transformation results in a density that is inversely proportional to the radius, explaining the observed singularity.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rc"><img src="../Images/541ef3e656fd05b05971494499aedab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NikymM8eq992RTeu"/></div></div></figure><blockquote class="qt qu qv"><p id="63c1" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The 1D density profile along the diagonal shown above corresponds to the absolute value of the inverse function, which is then set to zero outside [-1, 1]. At first glance, this might seem counterintuitive, given that the 1D inverse function isn’t integrable over [-1, 1]! However, it’s essential to remember that the integration is performed in 2D using polar coordinates, not in 1D.</p></blockquote><h2 id="8d91" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Uniform Polar Sampling — Differential Equation</h2><p id="3420" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">T</span>here are two ways to find the correct polar transform that results in an uniform distribution. Either by solving a differential equation or by using the inversion method. Let’s explore both approaches.</p><p id="5bca" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">To address the heterogeneity in the radius, we introduce a function <code class="cx qo qp qq qr b">f</code> to adjust it: <code class="cx qo qp qq qr b">r=f(u)</code>. The angle, however, is kept uniform due to the symmetry of the disk. We can then solve the differential equation that ensures the determinant of the corresponding Jacobian remains constant, to keep the same density.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rd"><img src="../Images/ee411bd3612c9bde862c2440a846ebd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8o9rM-0E7SS45qAC"/></div></div></figure><p id="b05e" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">We get <code class="cx qo qp qq qr b">ff'=c</code>, which has a unique solution given the boundary conditions <code class="cx qo qp qq qr b">f(0)=0</code> and <code class="cx qo qp qq qr b">f(1)=1</code>. We end up with the following transform.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qy"><img src="../Images/41f3a71c921a9a3e5a7cd576b78dfb69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*AqbzPsT9XEh6Q6N4"/></div></figure><h2 id="df2a" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Uniform Polar Sampling — Inversion Method</h2><p id="7da1" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">T</span>he inversion method is easier to grasp in the discrete case. Consider three possible values A, B and C with probabilities of 60%, 10%, and 30%, respectively. As shown in the figure below, we can stack these probabilities to reach a total height of 100%. By uniformly drawing a percentage U between 0% and 100% and mapping it to the corresponding value A, B or C on the stack, we can transform a uniform sampling into our discrete non‑uniform distribution.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk re"><img src="../Images/c50128307bf4c521f590cac4c091e850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FY58M2B3LgNIlOQH41kNSA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Inversion Method in the discrete case. Left: Histogram. Right: Cumulative Distribution Function — Figure by the author</figcaption></figure><p id="6ecb" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">This is very similar in the continuous case. The inversion method begins by integrating the probability distribution function (PDF) <code class="cx qo qp qq qr b">p</code> of a 1D variable <code class="cx qo qp qq qr b">X</code> to obtain the cumulative distribution function (CDF) <code class="cx qo qp qq qr b">P(X&lt;x)</code>, which increases from 0 to 1. Then, by sampling a uniform variable <code class="cx qo qp qq qr b">U</code> from [0,1] and applying the inverse CDF to <code class="cx qo qp qq qr b">U</code>, we can obtain a sample <code class="cx qo qp qq qr b">x</code> that follows the desired distribution <code class="cx qo qp qq qr b">p</code>.</p><p id="86d1" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Assuming a uniform disk distribution p(x,y), we can deduce the corresponding polar distribution p(r,θ) to enforce.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rf"><img src="../Images/158a480f82f7d2357573594d66f5e7d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/0*xVs9zNJZKY223ock"/></div></figure><p id="4d6b" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">It turns out that this density p(r,θ) is separable, and we can independently sample r and θ from their respective expected 1D marginal densities using the inversion method.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rg"><img src="../Images/c8998592f5d477f8a6bf68efb89c300b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IerDtsT-nn5JzA30"/></div></div></figure><blockquote class="qt qu qv"><p id="839b" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">When the joint density isn’t separable, we first sample a variable from its marginal density and then draw the second variable from its conditional density given the first variable.</p></blockquote><p id="e793" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">We integrate these marginal densities into CDFs.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rh"><img src="../Images/1593123dc07477176a02e805fdf61785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ya5dlGUWjqmhTtVq"/></div></div></figure><p id="58c8" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Sampling uniform (u,v) within [0,1] and applying the inverse CDFs gives us the following transform, which is the same as the one obtained above using the differential equation.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk qy"><img src="../Images/41f3a71c921a9a3e5a7cd576b78dfb69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*AqbzPsT9XEh6Q6N4"/></div></figure><p id="99ec" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The resulting distribution is effectively uniform, as confirmed by the empirical density map shown below.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/01ae07e8d0830d602305ff7df78d08ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYMIlwoYlvxifZpjpJV_lQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Density of the 2D Disk correct Polar Sampling estimated by Kernel Density Estimation on 10000 samples. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure><p id="2ecc" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The square root function effectively adjusts the colored columns to preserve their relative areas when mapped to the disk.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/a79f57174d1044604cd5d22745c3cc43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8b67JDwQrfNRd3h1ndC-w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Unit Square with colored columns. Right: Corresponding Polar and Uniform Polar mappings to the unit Disk — Figure by the author</figcaption></figure></div></div></div><div class="ab cb pk pl pm pn" role="separator"><span class="po by bm pp pq pr"/><span class="po by bm pp pq pr"/><span class="po by bm pp pq"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ri"><img src="../Images/5974c2eb8ff4287c6aa830c034e5c49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ee1dt416qDsUzp-G"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@mangofantasy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tim Johnson</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a5bd" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">2. How to sample a disk uniformly, but with less distortion?</h1><h2 id="276f" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Introduction</h2><p id="80d7" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">In</span> applications like Physically Based Rendering (See <a class="af nc" href="https://pbrt.org/" rel="noopener ugc nofollow" target="_blank"><em class="pe">PBRT (Physically Based Rendering: From Theory To Implementation</em></a>), integral equations describing light scattering are solved numerically using Monte-Carlo Integration (MC).</p><p id="7e76" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">MC Integration estimates the integral by a weighted mean of the operand evaluated at samples drawn from a given distribution. With <code class="cx qo qp qq qr b">n</code> samples, it converges to the correct result at a rate of <code class="cx qo qp qq qr b">O(1/sqrt(n))</code>. To halve the error, you need four times as many samples. Therefore, optimizing the sampling process to make the most of each sample is crucial.</p><p id="baad" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Techniques like stratified sampling helps ensuring that all regions of the integrand are equally likely to be sampled, avoiding the redundancy of closely spaced samples that provide little additional information.</p><h2 id="022e" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Distortion</h2><p id="d920" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">T</span>he mapping we discussed earlier is valid as it uniformly samples the unit disk. However, it distorts areas on the disk, particularly near the outer edge. Square regions of the unit square can be mapped to very thin and stretched areas on the disk.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/82158f67d2132e1c07e5ff9a66a269a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O0Rv4muLFV87CXYQNb27qQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Unit Square with colored cells. Right: Corresponding Uniform Polar mapping to the unit Disk — Figure by the author</figcaption></figure><p id="d41c" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">This distortion is problematic because the sampling on the square loses its homogeneous distribution property. Close (u,v) samples can result in widely separated points on the disk, leading to increased variance. As a result, more samples are needed in the Monte Carlo integration to offset this variance.</p><p id="71bf" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">In this section, we’ll introduce another uniform sampling technique that reduces distortion, thereby preventing unnecessary increases in variance.</p><h2 id="3e41" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Shirley’s Concentric Mapping</h2><p id="b024" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">In</span> 1997, Peter Shirley published <a class="af nc" href="https://www.semanticscholar.org/paper/A-Low-Distortion-Map-Between-Disk-and-Square-Shirley-Chiu/43226a3916a85025acbb3a58c17f6dc0756b35ac" rel="noopener ugc nofollow" target="_blank">“<em class="pe">A Low Distortion Map Between Disk and Square”</em></a>. Instead of treating the uniform unit square as a plain parameter space with no spatial meaning, as we did with the radius and angle, he suggests to slightly distort the unit square into the unit disk.</p><p id="d685" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The idea is to map concentric squares within the unit square into concentric circles within the unit disk, as if pinching the corners to round out the square. In the figure below, this approach appears much more natural compared to uniform polar sampling.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/cddf737f5d3641453e7e8a258dc846a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOv8LtKJiCyFlz8SOmJWcA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Unit Square with colored concentric squares. Right: Corresponding Uniform Polar and Shirley mappings to the unit Disk — Figure by the author</figcaption></figure><p id="97fa" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The unit square is divided into eight triangles, with the mapping defined for one triangle and the others inferred by symmetry.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/e4c223e45ef55662010df39806c290cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hq5TpoM0NoU-NbotDxbyVQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Reference Triangle in the Unit Square with colored concentric squares. Right: Corresponding Shirley mapping to the unit Disk — Figure by the author</figcaption></figure><blockquote class="qt qu qv"><p id="0d45" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">As mentioned at the beginning of the article, it is more convenient to switch between the [0,1]² and [-1,1]² definitions of the unit square rather than using cumbersome affine transformations in the equations. Thus, we will use the [-1,1]² unit square to align with the [-1,1]² unit disk definition.</p></blockquote><p id="840e" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">As illustrated in the figure above, the reference triangle is defined by:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rj"><img src="../Images/b996c37f5a4a3d88a8553664bef6d03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YrnWZjWqV5Dq6XP-"/></div></div></figure><p id="f1cd" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Mapping the vertical edges of concentric squares to concentric arc segments means that each point at a given abscissa <code class="cx qo qp qq qr b">u</code> is mapped to the radius <code class="cx qo qp qq qr b">r=u</code>. Next, we need to determine the angular mapping <code class="cx qo qp qq qr b">f</code> that results in a uniform distribution across the unit disk.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rc"><img src="../Images/4c5db9e8566caa81a5ea52cd10e165c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h-2SIEx3jBNfxk2O"/></div></div></figure><p id="20a0" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">We can deduce the determinant of the corresponding Jacobian.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rk"><img src="../Images/bed11fe119615ebdf17837f0eda51781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8MQx8cXoAmAbXIjB"/></div></div></figure><p id="8d73" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">For a uniform disk distribution, the density within the eighth sector of the disk (corresponding to the reference triangle) is as follows.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rl"><img src="../Images/492f63827e6293b91c6c704af7be127a.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/0*WCWpj7HF9ZKiiDz0"/></div></figure><p id="f626" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">On the other side, we have:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rm"><img src="../Images/01b3b0777767ae1fa0929d312e565d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LVhHpCY-Qkuyqo1G"/></div></div></figure><p id="cf2d" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">By combining the three previous equations and <code class="cx qo qp qq qr b">r=u</code> , we get:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rn"><img src="../Images/032e21092ceda6139af757e40f234303.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/0*ftw5qs8sb5wasD2w"/></div></figure><p id="0893" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Integrating the previous equations with a zero constant to satisfy θ=0 when v=0 gives the angle mapping. Finally, we get the following mapping.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk ro"><img src="../Images/bf67419f24d3d8420c292192350c503f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/0*VqldnHrssYusi4eJ"/></div></figure><p id="8e99" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The seven others triangles are deduced by symmetry. The resulting distribution is effectively uniform, as confirmed by the empirical density map shown below.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/9bd1339804169df6bc47d3ff4bf8a554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-dhZrDNvyiwn1AqR9IeWg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Density of the 2D Disk Shirley Sampling estimated by Kernel Density Estimation on 10000 samples. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure><p id="d502" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">As expected, Shirley’s mapping, when applied to the colored grid, significantly reduces cell stretching and distortion compared to the polar mapping.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/0e92c99d7f3f6c564172df9633aa8b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWB7FzgmiALnkztYhys70Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Unit Square with colored cells. Right: Corresponding Uniform Polar and Shirley mappings to the unit Disk — Figure by the author</figcaption></figure><h2 id="9f22" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Variant of Shirley’s Mapping</h2><p id="add5" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">T</span>he θ mapping in Shirley’s method isn’t very intuitive. Thus, as seen in the figure below, it’s tempting to view it simply as a consequence of the more natural constraint that <code class="cx qo qp qq qr b">y</code> depends solely on <code class="cx qo qp qq qr b">v</code>, ensuring that horizontal lines remain horizontal.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/6d1442ee91a6927586b21ab1d317478f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwTwCoOLxXPAaB_mw_t-Bg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Reference Triangle in the Unit Square with colored cells. Right: Corresponding Shirley mapping to the unit Disk — Figure by the author</figcaption></figure><p id="4568" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">However, this intuition is incorrect since the horizontal lines are actually slightly curved. The Shirley mapping presented above, i.e. the only uniform mapping respecting the <code class="cx qo qp qq qr b">r=u</code> constraint, enforces the following y value, which subtly varies with u.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div class="mj mk rp"><img src="../Images/7f96b47fcacf7b8ced28541b6b43f2ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/0*_ypEs1nZcOSY1Flj"/></div></figure><p id="822b" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Although we know it won’t result in a uniform distribution, let’s explore a variant that uses a linear mapping between y and v, just for the sake of experimentation.</p><blockquote class="qt qu qv"><p id="bd41" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The Shirley variant shown here is intended solely for educational purposes, to illustrate how the Shirley mapping alters the horizontal lines by bending them.</p></blockquote><p id="523a" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">We obtain <code class="cx qo qp qq qr b">y</code> by scaling <code class="cx qo qp qq qr b">v</code> by the length of the half-diagonal, which maps the top-right corner of the square to the edge of the disk. The value of <code class="cx qo qp qq qr b">x</code> can then be deduced from <code class="cx qo qp qq qr b">y</code> by using the radius constraint <code class="cx qo qp qq qr b">r=u</code>.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rq"><img src="../Images/c120441217f0189132319f540427ec9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1kgnTivBgrWYNqET"/></div></div></figure><p id="9155" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The figure below shows a side-by-side comparison of the original Shirley mapping and its variant. While both images appear almost identical, it’s worth noting that the variant preserves the horizontality of the lines.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/174e884b9de575a3af855e40da3a29ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*swYtH6r4S1Fa3JB0rl8kZg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Reference Triangle in the Unit Square with colored cells. Right: Corresponding Shirley and Shirley Variant mappings to the unit Disk — Figure by the author</figcaption></figure><p id="a25d" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">As expected, the empirical density map shows notable deviations from uniformity, oscillating between 0.8 and 1.1 rather than maintaining a constant value of 1.0.</p><blockquote class="qt qu qv"><p id="2a13" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Keep in mind that the density shown below depends on the angle, so the 1D density profile would vary if extracted from a different orientation.</p></blockquote><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk qx"><img src="../Images/2eea5aa6c1ce94ba855402bc95addb02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucYYfs4C9Q0z52EnYkcK2Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Left: Density of the 2D Disk Shirley Variant Sampling estimated by Kernel Density Estimation on 10000 samples. Right: Corresponding 1D density profile along the diagonal of the density map — Figure by the author</figcaption></figure></div></div></div><div class="ab cb pk pl pm pn" role="separator"><span class="po by bm pp pq pr"/><span class="po by bm pp pq pr"/><span class="po by bm pp pq"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rr"><img src="../Images/f44cbee23cddba4efa6d43b357688059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yp5CHUxcOYWj9L8M"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@antenna?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Antenna</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="45ff" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">3. Visual Comparison of the sampling methods</h1><h2 id="641f" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Apply the mapping on an image</h2><p id="ee17" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">In</span> the second section of this article, visualizing how a square image is mapped to a disk proved helpful in understanding the distortion caused by the mappings.</p><p id="4368" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">To achieve that, we could naively project each colored pixel from the square onto its corresponding location on the disk. However, this approach is flawed, as it doesn’t ensure that every pixel on the disk will be assigned a color. Additionally, some disk pixels may receive multiple colors, resulting in them being overwritten and causing inaccuracies.</p><p id="26b2" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The correct approach is to reverse the process: iterate over the disk pixels, apply the inverse mapping to find the corresponding floating-point pixel in the square, and then estimate its color through interpolation. This can be done using <code class="cx qo qp qq qr b">cv2.remap</code> from OpenCV.</p><p id="ec71" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Thus, the current mapping formulas only allow us to convert disk to square images. To map from square to disk, we need to reverse these formulas.</p><blockquote class="qt qu qv"><p id="9f53" class="nz oa pe ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">The inverse formulas are not detailed here for the sake of brevity.</p></blockquote><p id="129d" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Each of the following subsections will illustrate both the square-to-disk and disk-to-square mappings using a specific pattern image. Enjoy the exploration!</p><h2 id="f467" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Colored Checkerboard</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/6e68bb7c4d07ae39811ba501cdda1843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PYF2IKbcK7RA7XUBxW3Pxw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Square with colored checkerboard . Bottom: Mappings to the unit Disk — Figure by the author</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rt"><img src="../Images/951dbd261f847974177fc87e6ee1c648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7l_SCMRDxnp5Zj2PHcIbUw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Disk with colored checkerboard . Bottom: Mappings to the unit Square — Figure by the author</figcaption></figure><h2 id="8443" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Part of colored Checkerboard</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/06793fd8131368fea303db7cf59ca355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQ1f6NCICyJfNlKuHw1O_A.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Square with partial colored checkerboard . Bottom: Mappings to the unit Disk — Figure by the author</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rt"><img src="../Images/27f3a5984d5c3d3517a6a24754e067fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_J4ZNkhQibRlmpZxf04Dw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Disk with partial colored checkerboard . Bottom: Mappings to the unit Square — Figure by the author</figcaption></figure><h2 id="e9e1" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Concentric Squares</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/c17bb1039b68847dae28c2928354263d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p33Trb7GE3HNdfgFHMErSg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Square with concentric squares . Bottom: Mappings to the unit Disk — Figure by the author</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rt"><img src="../Images/c5da3217970f81f3c89d1288c61ae1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1F93w8HXw_MaNAlRmTAYg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Disk with concentric squares . Bottom: Mappings to the unit Square — Figure by the author</figcaption></figure><h2 id="ca5f" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Columns</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/ca4a873964a6c98dc02c4ac61abc42cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJqTkdKMUWm5y0GCfltQ5A.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Square with colored columns . Bottom: Mappings to the unit Disk — Figure by the author</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rt"><img src="../Images/5dd29f107f8ec747fdf03d614929260b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r4Hf4Jc3wuTqtQMsJmeE6w.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Disk with colored columns. Bottom: Mappings to the unit Square — Figure by the author</figcaption></figure><h2 id="f2c8" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Concentric Circles</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/a48c6bf470dcb4accd909f44db0d7a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J8RAAmoMux3Jm7jQ7mvH4Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Square with concentric circles . Bottom: Mappings to the unit Disk — Figure by the author</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rt"><img src="../Images/ce17dc7a8e7938d8bfc327c1c1de3e4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bePGchBFHK1tdhhTU1aFCg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Disk with concentric circles . Bottom: Mappings to the unit Square — Figure by the author</figcaption></figure><h2 id="706d" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Quadrants</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/9a3f70f53f7540640d99a0b303e657c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_7QO0k0KLHm-PthUcbEdoQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Square with quadrants . Bottom: Mappings to the unit Disk — Figure by the author</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rt"><img src="../Images/3a9a1579aa6f16a2f9c62620eedd6dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oUzqXTVNblI3S9UqBpKJzg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Disk with quadrants . Bottom: Mappings to the unit Square — Figure by the author</figcaption></figure><h2 id="a5f2" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Face</h2><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rs"><img src="../Images/e1b6a122869cb18b8fbd7a8cb4fd0569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sLI4ZpGyfhvMh1FijihLFQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Square with the author’s profile picture . Bottom: Mappings to the unit Disk — Figure by the author</figcaption></figure><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rt"><img src="../Images/17567825230a5c82cbcb2134b6ad26f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-WEiAzPOt0B_bDZj8tbSg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Top: Unit Disk with the author’s profile picture . Bottom: Mappings to the unit Square — Figure by the author</figcaption></figure></div></div></div><div class="ab cb pk pl pm pn" role="separator"><span class="po by bm pp pq pr"/><span class="po by bm pp pq pr"/><span class="po by bm pp pq"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ru"><img src="../Images/ff489646beee84ef91cbaea2c528c868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RiLYizR_e7JpckqF"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@and_machines?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">and machines</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a73d" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Conclusion</h1><h2 id="cf66" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Uniform Sampling</h2><p id="265c" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">T</span>he naive disk sampling approach using uniform polar coordinates is a good example for understanding how transforming variables can affect their distribution.</p><p id="f8fa" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">Using the inversion method you can now turn a uniform sampling on [0,1] into any 1D distribution, by using its inverse Cumulative Distribution Function (CDF).</p><p id="7fa8" class="pw-post-body-paragraph nz oa fq ob b go pf od oe gr pg og oh oi ph ok ol om pi oo op oq pj os ot ou fj bk">To sample any 2D distribution, we first sample a variable from its marginal density and then draw the second variable from its conditional density given the first variable.</p><h2 id="97a7" class="px ne fq bf nf py pz qa ni qb qc qd nl oi qe qf qg om qh qi qj oq qk ql qm qn bk">Distortion and Variance</h2><p id="ee65" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk ov"><span class="l ow ox oy bo oz pa pb pc pd ed">D</span>epending on your use-case, you might want to guarantee that nearby (u,v) samples will remain close when mapped onto the disk. In such cases, the Shirley transformation is preferable to uniform polar sampling, as it introduces less variance.</p></div></div></div></div>    
</body>
</html>