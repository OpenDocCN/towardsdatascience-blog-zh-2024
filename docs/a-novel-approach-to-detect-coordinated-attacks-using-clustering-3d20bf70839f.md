# 一种利用聚类检测协调攻击的新方法

> 原文：[https://towardsdatascience.com/a-novel-approach-to-detect-coordinated-attacks-using-clustering-3d20bf70839f?source=collection_archive---------4-----------------------#2024-10-16](https://towardsdatascience.com/a-novel-approach-to-detect-coordinated-attacks-using-clustering-3d20bf70839f?source=collection_archive---------4-----------------------#2024-10-16)

## 揭示隐藏的模式：将恶意行为分组

[](https://medium.com/@tbavalatti?source=post_page---byline--3d20bf70839f--------------------------------)[![Trupti Bavalatti](../Images/c7bf54bde41b187f81449c91682b0641.png)](https://medium.com/@tbavalatti?source=post_page---byline--3d20bf70839f--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--3d20bf70839f--------------------------------)[![Towards Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--3d20bf70839f--------------------------------) [Trupti Bavalatti](https://medium.com/@tbavalatti?source=post_page---byline--3d20bf70839f--------------------------------)

·发表于[Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--3d20bf70839f--------------------------------) ·14分钟阅读·2024年10月16日

--

聚类是无监督机器学习中的一种强大技术，它根据数据的固有相似性将数据进行分组。与依赖预先标注数据来指导学习过程的监督学习方法（如分类）不同，聚类是在没有标签的数据上进行操作。这意味着没有预定义的类别或标签，而是算法在没有事先了解分组应如何进行的情况下，发现数据的潜在结构。

聚类的主要目标是将数据点组织成簇，其中同一簇内的数据点相较于不同簇的数据点具有更高的相似性。这一区别使得聚类算法能够形成反映数据自然模式的群体。本质上，聚类旨在最大化簇内相似性，同时最小化簇间相似性。这项技术在需要发现数据中隐藏的关系或结构的场景中特别有用，因此在欺诈检测和异常识别等领域具有重要价值。

通过应用聚类，可以揭示通过其他方法可能不明显的模式和洞察力，它的简单性和灵活性使其能够适应各种数据类型和应用场景。

# **利用聚类检测在线系统中的欺诈行为**

聚类的一个实际应用是在线系统中的欺诈检测。考虑一个例子，多个用户正在向一个网站发起请求，每个请求都包括像IP地址、请求时间和交易金额等详细信息。

以下是聚类如何帮助检测欺诈行为：

+   假设大多数用户是从唯一的IP地址发起请求，并且他们的交易模式自然会有所不同。

+   然而，如果多个请求来自同一IP地址，并显示出类似的交易模式（如频繁的高价值交易），这可能表明有欺诈者从同一来源发起了多个虚假交易。

通过基于IP地址和交易行为对所有用户请求进行聚类，我们可以检测到来自单一IP地址的可疑请求聚类。这可以标记潜在的欺诈活动，并帮助采取预防措施。

下面的图示展示了聚类概念的一个示例。

假设你有代表交易请求的数据点，绘制在一个图表上，其中：

+   X轴：来自同一IP地址的请求数量。

+   Y轴：平均交易金额。

左侧是原始数据。没有标签时，我们可能已经能看到一些模式的形成。右侧是应用聚类后的数据，数据点被分为不同的聚类，每个聚类代表不同的用户行为。

![](../Images/ce11b0595c148b823badf85542bc6bf5.png)

欺诈用户行为的聚类示例。[图片来源](https://developers.google.com/machine-learning/clustering/overview#:~:text=Clustering%20is%20an%20unsupervised%20machine,evaluate%20a%20new%20treatment%20protocol) (CC BY 4.0)

# 定义相似性度量以实现有效的聚类

为了有效地分组数据，我们必须定义一个相似性度量或指标，用来量化数据点之间的接近程度。这个相似性可以通过多种方式进行度量，具体取决于数据的结构和我们希望发现的洞察。有两种主要的相似性度量方法——手动相似性度量和嵌入式相似性度量。

**手动相似性度量**涉及明确地定义一个数学公式，以根据数据点的原始特征进行比较。这种方法直观，我们可以使用欧几里得距离、余弦相似度或Jaccard相似度等距离度量来评估两个数据点的相似性。例如，在欺诈检测中，我们可以手动计算交易属性（如交易金额、请求频率）之间的欧几里得距离，以检测可疑行为的聚类。尽管这种方法相对容易设置，但需要仔细选择相关特征，且可能错过数据中的更深层次模式。

另一方面，**嵌入相似度度量**利用机器学习模型的力量来创建数据的学习表示或嵌入。嵌入是捕捉数据中复杂关系的向量，可以通过像Word2Vec这样的文本模型或用于图像的神经网络生成。一旦计算出这些嵌入，就可以使用传统的度量标准（如余弦相似度）来衡量相似性，但此时比较是在一个转换后的低维空间中进行的，这个空间捕捉了更有意义的信息。嵌入相似度对于复杂数据尤为有用，例如网站上的用户行为或自然语言处理中的文本数据。例如，在电影或广告推荐系统中，用户行为可以被嵌入成向量，并且在这个嵌入空间中的相似性可以用来推荐给相似的用户内容。

虽然手动相似度度量提供了透明性并且能更好地控制特征选择和设置，但嵌入相似度度量能够捕捉到数据中更深层次和更抽象的关系。两者之间的选择取决于数据的复杂性和聚类任务的具体目标。如果你有充分理解的结构化数据，手动度量可能足够了。但如果数据丰富且多维，比如文本或图像分析，基于嵌入的方法可能会给出更有意义的聚类。理解这些权衡对于选择适合的聚类方法至关重要。

在像欺诈检测这样的场景中，数据通常是丰富的，并且基于用户活动的行为，基于嵌入的方法通常更有效，因为它能捕捉到那些可能表明风险活动的细微模式。

# 引入行为分析与聚类分类系统（BACCS）以检测协调的欺诈攻击

协调欺诈攻击行为通常表现出特定的模式或特征。例如，欺诈活动可能来自一组相似的IP地址，或依赖于一致的、重复的战术。检测这些模式对于维持系统的完整性至关重要，而聚类是一种有效的技术，通过共享特征将实体分组。这有助于通过检查聚类中的集体行为来识别潜在的威胁。

然而，仅仅依靠聚类可能不足以准确检测欺诈，因为它也可能将良性活动与有害活动混合在一起。例如，在社交媒体环境中，用户发布像“你今天怎么样？”这样的无害信息，可能会与那些进行网络钓鱼攻击的用户被归为同一类。因此，需要额外的标准来区分有害行为与良性行为。

为了应对这一点，我们引入了**行为分析与聚类分类系统（BACCS）**，作为一个旨在检测和管理恶意行为的框架。BACCS通过生成和分类实体的聚类（如个人账户、组织档案和交易节点）来工作，并且可以广泛应用于社交媒体、银行和电子商务等多个领域。重要的是，BACCS侧重于对行为进行分类，而非内容，使其更适合识别复杂的欺诈活动。

该系统通过分析聚类中实体的整体属性来评估聚类。这些属性通常是布尔值（真/假），系统评估*表现出特定特征的实体比例*来确定聚类的整体性质。例如，聚类中大量新创建账户的存在可能表明有欺诈活动。根据预定义的策略，BACCS识别出指示滥用行为的属性比率组合，并确定相应的应对措施以缓解威胁。

BACCS框架提供了几个优势：

+   它通过基于行为相似性对实体进行分组，从而实现对协调攻击的检测。

+   它通过定义聚类成员的相关属性并应用自定义策略来对聚类进行分类，从而识别潜在的滥用行为。

+   它支持对被标记为有害的聚类采取自动行动，从而确保系统完整性，并增强防范恶意活动的能力。

这种灵活和自适应的方法使得BACCS能够持续演化，确保它能够有效应对跨不同平台和行业的新兴协调攻击形式。

让我们通过一个类比更好地理解：假设你有一辆满载苹果的马车，准备出售。这些苹果在被多名工人装载到马车之前都会被放入袋子中。一些工人不喜欢你，试图在他们的袋子里装入酸苹果来捣乱。你需要识别出任何可能含有酸苹果的袋子。要识别酸苹果，你需要检查它是否软，但问题是，一些苹果天生比其他苹果软。你通过打开每个袋子并挑出五个苹果，检查它们是否软来解决了这些恶意工人的问题。如果几乎所有苹果都很软，那么这个袋子很可能包含酸苹果，你将其放到一边以便稍后进一步检查。一旦你识别出所有可能含有可疑软苹果的袋子，你就将它们的内容倒出，挑出健康的硬苹果，扔掉所有软苹果。你现在已经最小化了顾客咬到酸苹果的风险。

BACCS的操作方式类似；你有的是实体（例如，用户账户），而不是苹果。你有的是恶意用户，而不是坏工人；你有的是按共同特征（例如，相似的账户创建时间）分组的实体，而不是一袋苹果。BACCS对每组实体进行抽样，检查是否有恶意行为的迹象（例如，政策违规率较高）。如果某个组显示出这些迹象的高频率，则会被标记为进一步调查的对象。

就像在教室里检查材料一样，BACCS使用预定义的信号（也称为属性）来评估聚类中实体的质量。如果发现某个聚类存在问题，可以采取进一步的措施来隔离或移除恶意实体。该系统具有灵活性，可以通过调整标记聚类的标准或根据新出现的滥用模式创建新的聚类类型来适应新的恶意行为。

这个类比说明了BACCS如何通过主动识别和缓解潜在问题来帮助维护环境的完整性，为所有合法用户提供一个更安全、更可靠的空间。

该系统提供了众多优势：

+   **更好的精确度**：通过对实体进行聚类，BACCS提供了强有力的协同证据，从而能够制定那些如果应用于孤立的个体实体时会过于模糊的政策。

+   **可解释性**：与某些机器学习技术不同，BACCS所做的分类是透明且易于理解的。追溯和理解某个特定决策是如何做出的非常简单。

+   **快速响应时间**：由于BACCS采用基于规则的系统，而非依赖机器学习，因此无需进行大量的模型训练。这使得响应时间更快，对于及时解决问题至关重要。

如果你：

+   **专注于分类行为而非内容**：尽管BACCS中的许多聚类可能围绕内容（例如，图像、电子邮件内容、用户电话号码）形成，但系统本身并不会直接对内容进行分类。

+   **处理发生频率较高的问题**：BACCS采用统计方法，当聚类中包含大量滥用实体时最为有效。对于稀疏发生的有害事件，可能效果不佳，但对于像垃圾邮件这样的高频问题更为适用。

+   **处理协调或相似行为**：聚类信号主要表示协调或相似的行为，这使得BACCS在解决这些类型的问题时尤为有用。

以下是将BACCS框架融入实际生产系统的方式：

![](../Images/7e03ea5d4326bcdc6564fe0d5ea03c97.png)

设置BACCS在生产环境中的部署。图像来源：作者

1.  当实体在平台上进行活动时，您需要建立一个观察层来捕捉这些活动并将其转化为事件。这些事件随后可以由专门用于聚类分析和执行的系统进行监控。

1.  基于这些事件，系统需要根据各种属性将实体分组到聚类中——例如，所有从同一IP地址发布的用户将被分到一个聚类中。这些聚类随后应转发进行进一步分类。

1.  在分类过程中，系统需要为聚类成员的样本计算一组专业的布尔信号。此类信号的一个例子可能是账户年龄是否小于一天。然后，系统将这些信号计数汇总到聚类中，例如确定在100个用户的样本中，有80个用户的账户年龄小于一天。

1.  这些汇总的信号计数应与政策进行比较，以确定聚类是否看起来异常，并在出现异常时应采取哪些行动。例如，某项政策可能规定，如果某个IP聚类中超过60%的成员账户年龄小于一天，则这些成员应接受进一步验证。

1.  如果某项政策将一个聚类标识为异常，系统应识别出该聚类中所有展示触发该政策的信号的成员（例如，所有账户年龄小于一天的成员）。

1.  系统应将所有此类用户引导到适当的行动框架中，执行政策所指定的行动（例如，进一步验证或封锁其账户）。

通常，从实体活动到采取行动的整个过程是在几分钟内完成的。还必须认识到，尽管该系统为聚类分类提供了框架和基础设施，但客户端/组织需要提供自己的聚类定义、属性和针对特定领域的政策。

# 示例：通过基于IP的聚类和封锁来减轻垃圾邮件问题

我们来看一个例子，我们试图通过按IP对发送电子邮件的用户进行聚类来减轻垃圾邮件问题，如果聚类中超过60%的成员账户年龄小于一天，则对其进行封锁。

![](../Images/afc57a8a55b2c502687d61684e6e7901.png)

聚类和封锁操作。图片由作者提供

成员可能已经存在于聚类中。当聚类达到某一大小或自上次分类以来发生了足够的变化时，可以触发重新分类。

在选择聚类标准和定义用户属性时，目标是识别与您试图检测的特定风险或活动相符合的模式或行为。例如，如果您在进行欺诈行为或协调攻击的检测工作，标准应当捕捉到通常由恶意行为者共享的特征。以下是选择聚类标准和定义用户属性时需要考虑的一些因素：

# 选择聚类标准  

你选择的聚类标准应围绕代表可能表明风险的行为特征。这些特征可能包括：  

+   **基于时间的模式：** 例如，通过用户账户创建时间或在给定时间段内的行为频率将用户分组，可以帮助检测到活动的激增，这可能表明存在协调行为。  

+   **地理位置或IP地址：** 按照IP地址或地理位置对用户进行聚类，尤其有助于检测协调行为，例如来自同一地区的多个欺诈性登录或内容提交。  

+   **内容相似度：** 在误信息或垃圾邮件检测等情况下，通过内容的相似性（例如，帖子/邮件中相似的文本）进行聚类可以识别出可疑的协调行为。  

+   **行为指标：** 特征如交易数量、平均会话时间或与平台的交互类型（例如，点赞、评论或点击）在聚类后可以指示异常模式。  

关键是选择那些不仅与正常用户行为相关联，而且足够独特以隔离风险模式的标准，这将导致更有效的聚类。

## 定义用户属性  

一旦选择了聚类标准，为每个聚类中的用户定义有意义的属性至关重要。这些属性应为可衡量的信号，帮助评估有害行为的可能性。常见的属性包括：  

+   **账户年龄：** 新创建的账户通常涉及恶意活动的风险较高，因此像“账户年龄 < 1天”这样的属性可以标记可疑行为。  

+   **连接密度：** 对于社交媒体平台，像聚类中账户之间的连接或交互数量这样的属性可以指示异常行为。  

+   **交易金额：** 在金融欺诈的情况下，平均交易额或高价值交易的频率可能是标记高风险聚类的关键属性。  

每个属性应清楚地与可能表明合法使用或潜在滥用的行为相关联。重要的是，属性应该是布尔值或数值，便于聚合和比较。  

# 一种巧妙的技巧：通过降低机器学习阈值 + 聚类增加召回率来增强检测能力  

另一种高级策略是使用机器学习分类器的输出作为属性，但调整阈值。通常，你会为分类有害行为设置较高的阈值，以避免假阳性。然而，当与聚类结合时，你可以降低这个阈值，因为聚类本身作为附加信号来加强该属性。  

假设有一个模型 X，能够识别诈骗并禁用模型 X 得分 > 0.95的电子邮件账户。假设这个模型已经在生产中上线，并且以100%的精度在阈值0.95下禁用不良电子邮件账户。我们需要提高这个模型的召回率，同时不影响精度。

+   首先，我们需要定义能够将协调活动归为一组的簇。假设我们知道存在一个协调活动，其中不法分子使用相同的主题行，但不同的电子邮件 ID 来发送欺诈邮件。通过使用BACCS，我们将形成一组组电子邮件账户，这些账户的发送邮件都有相同的主题名称。

+   接下来，我们需要降低原始模型阈值，并定义一个BACCS属性。我们将把模型 X 集成到我们的生产检测基础设施中，并使用降低的模型阈值（例如0.75）创建一个属性。对于那些模型 X 得分 >= 0.75的电子邮件账户，该属性值为“True”。

+   然后我们将定义异常阈值，并说，如果活动名称簇中50%的实体具有该属性，则将这些簇标记为不良簇，并禁用那些该属性为True的广告账户。

所以我们本质上是降低了模型的阈值，并开始在一个显著低于当前模型执行阈值的特定簇中禁用实体，但仍然可以确保执行的精度没有下降，并且召回率得到了提高。让我们来理解一下如何实现的 -

假设我们有6个实体，它们有相同的主题行，且它们的模型 X 得分如下：

![](../Images/9ec8e783ca83d22af447fccf448455a8.png)

通过机器学习模型执行的实体。图像来源：作者

如果我们使用原始模型得分（0.95），我们将只禁用2/6个电子邮件账户。

如果我们按主题行文本对实体进行聚类，并定义策略，找出那些模型 X 得分 >= 0.75且包含超过50%不良实体的簇，我们将禁用以下这些账户：

![](../Images/1fcc8408b39db70bf21ca698596f59f8.png)

通过聚类处理的实体，使用机器学习得分作为属性。图像来源：作者

所以我们将执行召回率从33%提高到了83%。本质上，即使个体行为看起来风险较低，但它们是可疑簇的一部分，这提升了它们的重要性。这种组合为检测有害活动提供了**强信号**，同时最小化了误报的可能性。

通过降低阈值，你可以让聚类过程显现出一些模式，这些模式如果仅依赖分类可能会被忽视。这种方法结合了机器学习模型提供的细致洞察力和聚类能够识别的更广泛的行为模式。它们共同构建了一个更强大的系统，用于检测和减轻风险，并能捕捉到更多实体，同时保持较低的误报率。

# 结论

聚类技术仍然是检测协调攻击和确保系统安全的重要方法，特别是在那些更容易受到欺诈、滥用或其他恶意活动的平台上。通过将相似行为分组到不同的簇中，并应用政策将恶意实体从这些簇中剔除，我们可以检测并减轻有害活动，从而为所有用户确保一个更安全的数字生态系统。选择更先进的基于嵌入的方法有助于比手动相似性检测方法更好地表示复杂的用户行为模式。

随着我们不断推进安全协议，像BACCS这样的框架在打击大规模协调攻击方面发挥着至关重要的作用。将聚类与基于行为的策略相结合，能够实现动态适应，使我们能够迅速响应新型滥用行为，同时加强平台的信任和安全性。

在未来，进一步研究和探索补充性技术以增强聚类效果将是一个重要的机会。诸如基于图的分析方法，用于映射实体之间复杂关系的技术，可以与聚类技术结合，从而在威胁检测中提供更高的精度。此外，将聚类与机器学习分类结合的混合方法，可以在更高召回率和更低假阳性率下有效检测恶意活动。探索这些方法，并不断优化当前方法，将确保我们能够应对数字威胁不断变化的环境。

## 参考文献

1.  [https://developers.google.com/machine-learning/clustering/overview](https://developers.google.com/machine-learning/clustering/overview)
