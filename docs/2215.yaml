- en: 'XPER: Unveiling the Driving Forces of Predictive Performance'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: ÂéüÊñáÔºö[https://towardsdatascience.com/xper-unveiling-the-driving-forces-of-predictive-performance-309ce4f10b0a?source=collection_archive---------12-----------------------#2024-09-10](https://towardsdatascience.com/xper-unveiling-the-driving-forces-of-predictive-performance-309ce4f10b0a?source=collection_archive---------12-----------------------#2024-09-10)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: A new method for decomposing your favorite performance metrics
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[](https://medium.com/@seb.saurin?source=post_page---byline--309ce4f10b0a--------------------------------)[![S√©bastien
    Saurin](../Images/18c4fac70a326896f095a44e8f48b929.png)](https://medium.com/@seb.saurin?source=post_page---byline--309ce4f10b0a--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--309ce4f10b0a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--309ce4f10b0a--------------------------------)
    [S√©bastien Saurin](https://medium.com/@seb.saurin?source=post_page---byline--309ce4f10b0a--------------------------------)'
  prefs: []
  type: TYPE_NORMAL
- en: ¬∑Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--309ce4f10b0a--------------------------------)
    ¬∑9 min read¬∑Sep 10, 2024
  prefs: []
  type: TYPE_NORMAL
- en: --
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/4f1d2a607b94cdbf45159deedd2d0f0e.png)'
  prefs: []
  type: TYPE_IMG
- en: Photo by [Sira Anamwong](https://www.123rf.com/profile_siraanamwong) on [123RF](https://www.123rf.com/)
  prefs: []
  type: TYPE_NORMAL
- en: Co-authored with S. Hu√©, C. Hurlin, and C. P√©rignon.
  prefs: []
  type: TYPE_NORMAL
- en: I - From explaining model forecasts to explaining model performance
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Trustability and acceptability of sensitive AI systems largely depend on the
    capacity of the users to understand the associated models, or at least their forecasts.
    To lift the veil on opaque AI applications, eXplainable AI (XAI) methods such
    as post-hoc interpretability tools (e.g. SHAP, LIME), are commonly utilized today,
    and the insights generated from their outputs are now widely comprehended.
  prefs: []
  type: TYPE_NORMAL
- en: Beyond individual forecasts, we show in this article how to identify the drivers
    of the performance metrics (e.g. AUC, R2) of any classification or regression
    model using the eXplainable PERformance (XPER) methodology. Being able to identify
    the driving forces of the statistical or economic performance of a predictive
    model lies at the very core of modeling and is of great importance for both data
    scientists and experts basing their decisions on such models. The XPER library
    outlined below has proven to be an efficient tool to decompose performance metrics
    into individual feature contributions.
  prefs: []
  type: TYPE_NORMAL
- en: While they are grounded in the same mathematical principles, XPER and SHAP are
    fundamentally different and simply have different goals. While SHAP pinpoints
    the features that significantly influence the model‚Äôs individual predictions,
    XPER identifies the features that contribute the most to the performance of the
    model. The latter analysis can be conducted at the global (model) level or local
    (instance) level. In practice, the feature with the strongest impact on individual
    forecasts (say feature A) may not be the one with the strongest impact on performance.
    Indeed, feature A drives individual decisions when the model is correct but also
    when the model makes an error. Conceptually, if feature A mainly impacts erroneous
    predictions, it may rank lower with XPER than it does with SHAP.
  prefs: []
  type: TYPE_NORMAL
- en: What is a performance decomposition used for? First, it can enhance any post-hoc
    interpretability analysis by offering a more comprehensive insight into the model‚Äôs
    inner workings. This allows for a deeper understanding of why the model is, or
    is not, performing effectively. Second, XPER can help identify and address heterogeneity
    concerns. Indeed, by analyzing individual XPER values, it is possible to pinpoint
    subsamples in which the features have similar effects on performance. Then, one
    can estimate a separate model for each subsample to boost the predictive performance.
    Third, XPER can help to understand the origin of overfitting. Indeed, XPER permits
    us to identify some features which contribute more to the performance of the model
    in the training sample than in the test sample.
  prefs: []
  type: TYPE_NORMAL
- en: '**II - XPER values**'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The XPER framework is a theoretically grounded method that is based on Shapley
    values (Shapley, 1953), a decomposition method from coalitional game theory. While
    the Shapley values decompose a payoff among players in a game, XPER values decompose
    a performance metric (e.g., AUC, R2) among features in a model.
  prefs: []
  type: TYPE_NORMAL
- en: 'Suppose that we train a classification model using three features and that
    its predictive performance is measured with an AUC equal to 0.78\. An example
    of XPER decomposition is the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/ed19686e81aac20f5f77192ce2e89c3a.png)'
  prefs: []
  type: TYPE_IMG
- en: The first XPER value ùúô‚ÇÄ is referred to as the benchmark and represents the performance
    of the model if none of the three features provided any relevant information to
    predict the target variable. When the AUC is used to evaluate the predictive performance
    of a model, the value of the benchmark corresponds to a random classification.
    As the AUC of the model is greater than 0.50, it implies that at least one feature
    contains useful information to predict the target variable. The difference between
    the AUC of the model and the benchmark represents the contribution of features
    to the performance of the model, which can be decomposed with XPER values. In
    this example, the decomposition indicates that the first feature is the main driver
    of the predictive performance of the model as it explains half of the difference
    between the AUC of the model and a random classification (ùúô‚ÇÅ), followed by the
    second feature (ùúô‚ÇÇ) and the third one (ùúô‚ÇÉ). These results thus measure the global
    effect of each feature on the predictive performance of the model and to rank
    them from the least important (the third feature) to the most important (the first
    feature).
  prefs: []
  type: TYPE_NORMAL
- en: While the XPER framework can be used to conduct a global analysis of the model
    predictive performance, it can also be used to provide a local analysis at the
    instance level. At the local level, the XPER value corresponds to the contribution
    of a given instance and feature to the predictive performance of the model. The
    benchmark then represents the contribution of a given observation to the predictive
    performance if the target variable was independent from the features, and the
    difference between the individual contribution and the benchmark is explained
    by individual XPER values. Therefore, individual XPER values allow us to understand
    why some observations contribute more to the predictive performance of a model
    than others, and can be used to address heterogeneity issues by identifying groups
    of individuals for which features have similar effects on performance.
  prefs: []
  type: TYPE_NORMAL
- en: It is also important to note that XPER is both model and metric-agnostic. It
    implies that XPER values can be used to interpret the predictive performance of
    any econometric or machine learning model, and to break down any performance metric,
    such as predictive accuracy measures (AUC, accuracy), statistical loss functions
    (MSE, MAE), or economic performance measure (profit-and-loss functions).
  prefs: []
  type: TYPE_NORMAL
- en: III - XPER in Python
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**01 ‚Äî Download Library ‚öôÔ∏è**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The XPER approach is implemented in Python through the [XPER library](https://github.com/hi-paris/XPER/tree/main).
    To compute XPER values, first one has to install the XPER library as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '**02 ‚Äî Import Library üì¶**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '**03 ‚Äî Load example dataset üíΩ**'
  prefs: []
  type: TYPE_NORMAL
- en: 'To illustrate how to use XPER values in Python, let us take a concrete example.
    Consider a classification problem whose main objective is to predict credit default.
    The dataset can be directly imported from the XPER library such as:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/0cd5be96b19de9169cd43441a17ecb35.png)'
  prefs: []
  type: TYPE_IMG
- en: The primary goal of this dataset, given the included variables, appears to be
    building a predictive model to determine the ‚ÄúLoan_Status‚Äù of a potential borrower.
    In other words, we want to predict whether a loan application will be approved
    (‚Äú1‚Äù) or not (‚Äú0‚Äù) based on the information provided by the applicant.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '**04 ‚Äî Estimate the Model ‚öôÔ∏è**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Then, we need to train a predictive model and to measure its performance in
    order to compute the associated XPER values. For illustration purposes, we split
    the initial dataset into a training and a test set and fit a XGBoost classifier
    on the training set:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '**05 ‚Äî Evaluate Performance üéØ**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The XPER library offers an intuitive and simple way to compute the predictive
    performance of a predictive model. Considering that the performance metric of
    interest is the Areas Under the ROC Curve (AUC), it can be measured on the test
    set as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '**06 ‚Äî Calculate XPER values ‚≠êÔ∏è**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, to explain the driving forces of the AUC the XPER values can be computed
    such as:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'The ¬´ XPER_values ¬ª is a tuple including two elements: the XPER values and
    the individual XPER values of the features.'
  prefs: []
  type: TYPE_NORMAL
- en: For use cases above 10 feature variables it is advised to used the default option
    kernel=True for computation efficiency ‚û°Ô∏è
  prefs: []
  type: TYPE_NORMAL
- en: '**07 ‚Äî Visualization üìä**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: To analyze the driving force at the global level, the XPER library proposes
    a **bar plot** representation of XPER values.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/96d2f3b66c151c225f3bab9e8e57c57b.png)'
  prefs: []
  type: TYPE_IMG
- en: For ease of presentation, feature contributions are expressed in percentage
    of the spread between the AUC and its benchmark, i.e., 0.5 for the AUC, and are
    ordered from the largest to lowest. From this figure, we can see that more than
    78% of the over-performance of the model over a random predictor comes from *Credit
    History*, followed by *Applicant Income* contributing around 16% to the performance,
    and *Co-applicant Income* and *Loan Amount Term* eachaccounting for less than
    6%. On the other hand, we can see that the variable *Loan Amount* almost does
    not help the model to better predict the probability of default as its contribution
    is close to 0.
  prefs: []
  type: TYPE_NORMAL
- en: 'The XPER library also proposes graphical representations to analyze XPER values
    at the local level. First, a **force plot** can be used to analyze driving forces
    of the performance for a given observation:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/9b282ac045d0fc6657a119937bfa7e7a.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The preceding code plots the positive (negative) XPER values of the observation
    #10 in red (blue), as well as the benchmark (0.33) and contribution (0.46) of
    this observation to the AUC of the model. The over-performance of borrower #10
    is due to the positive XPER values of *Loan Amount Term, Applicant Income*, and
    *Credit History.* On the other hand, *Co-Applicant Income* and *Loan Amount* had
    a negative effect and decreased the contribution of this borrower.'
  prefs: []
  type: TYPE_NORMAL
- en: 'We can see that while *Applicant Income* and *Loan Amount* have a positive
    effecton the AUC at the global level, these variables have a negative effect for
    the borrower #10\. Analysis of individual XPER values can thus identify groups
    of observations for which features have different effects on performance, potentially
    highlighting an heterogeneity issue.'
  prefs: []
  type: TYPE_NORMAL
- en: Second, it is possible to represent the XPER values of each observation and
    feature on a single plot. For that purpose, one can rely on a **beeswarm plot**
    which represents the XPER values for each feature as a function of the feature
    value.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/92e09764e5f1dd8a52e04657e33ecb80.png)'
  prefs: []
  type: TYPE_IMG
- en: On this figure, each dot represents an observation. The horizontal axis represents
    the contribution of each observation to the performance of the model, while the
    vertical axis represents the magnitude of feature values. Similarly to the bar
    plot shown previously, features are ordered from those that contribute the most
    to the performance of the model to those that contribute the least. However, with
    the beeswarm plot it is also possible to analyze the effect of feature values
    on XPER values. In this example, we can see large values of *Credit History* are
    associated with relatively small contributions (in absolute value), whereas low
    values lead to larger contributions (in absolute value).
  prefs: []
  type: TYPE_NORMAL
- en: '*All images, unless otherwise stated, are by the author.*'
  prefs: []
  type: TYPE_NORMAL
- en: IV - Acknowledgements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The contributors to this library are:'
  prefs: []
  type: TYPE_NORMAL
- en: '[Sullivan Hu√©](https://www.amse-aixmarseille.fr/fr/membres/hu%C3%A9)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Christophe Hurlin](https://sites.google.com/view/christophe-hurlin/home)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Christophe P√©rignon](https://people.hec.edu/perignon/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[S√©bastien Saurin](https://papers.ssrn.com/sol3/cf_dev/AbsByAuth.cfm?per_id=4582330)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Awais Sani](https://www.linkedin.com/in/awais-hussain-sani-87a35757/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Ga√´tan Brison](https://www.linkedin.com/in/gaetan-brison/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: V - References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[1] L. Shapley, [**A Value for n-Person Games**](https://www.degruyter.com/document/doi/10.1515/9781400829156-012/pdf?licenseType=restricted)
    **(1953),** Contributions to the Theory of Games, 2:307‚Äì317'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] S. Lundberg, S. Lee, [**A unified approach to interpreting model predictions**](https://dl.acm.org/doi/10.5555/3295222.3295230)
    **(2017)**, Advances in Neural Information Processing Systems'
  prefs: []
  type: TYPE_NORMAL
- en: '[3] S. Hu√©, C. Hurlin, C. P√©rignon, S. Saurin, [**Measuring the Driving Forces
    of Predictive Performance: Application to Credit Scoring**](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4280563)
    **(2023),** HEC Paris Research Paper No. FIN-2022‚Äì1463'
  prefs: []
  type: TYPE_NORMAL
