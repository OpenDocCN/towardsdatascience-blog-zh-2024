<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Why You Don’t Need JS to Make 3D plots</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Why You Don’t Need JS to Make 3D plots</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/la-crime-now-in-3d-no-glasses-required-498398c25a39?source=collection_archive---------2-----------------------#2024-06-01">https://towardsdatascience.com/la-crime-now-in-3d-no-glasses-required-498398c25a39?source=collection_archive---------2-----------------------#2024-06-01</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="e434" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Visualizing crime geodata in python</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@alexroz?source=post_page---byline--498398c25a39--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Aleksei Rozanov" class="l ep by dd de cx" src="../Images/748b69bfaccf39c9aa568a9e6f41eec3.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*JISS93SvFnwE3NMNTl8HAQ.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--498398c25a39--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@alexroz?source=post_page---byline--498398c25a39--------------------------------" rel="noopener follow">Aleksei Rozanov</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--498398c25a39--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">6 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jun 1, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/41f0fd59d6221d6335f1d9b4c92ba959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NmbPDC-mvR4oyJJS7xlFA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="0a8f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk ny"><span class="l nz oa ob bo oc od oe of og ed">In</span> my opinion, one of the best features geo data possesses is its capability for 3D visualization. However, due to the amount of computational resources needed for such calculations, it’s really rarely performed in python (often <em class="oh">JavaScript</em> and its libraries used as alternatives). In one of my previous articles I shared six python packages which allow creation of beautiful static and interactive maps, yet only in 2D space.</p><div class="oi oj ok ol om on"><a href="https://medium.com/@alexroz/6-python-libraries-to-make-beautiful-maps-9fb9edb28b27?source=post_page-----498398c25a39--------------------------------" rel="noopener follow" target="_blank"><div class="oo ab ig"><div class="op ab co cb oq or"><h2 class="bf fr hw z io os iq ir ot it iv fp bk">6 python libraries to make beautiful maps</h2><div class="ou l"><h3 class="bf b hw z io os iq ir ot it iv dx">At some point any Data Scientist faces the need to analyze or model geo spatial data, and it can’t be done without the…</h3></div><div class="ov l"><p class="bf b dy z io os iq ir ot it iv dx">medium.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb lq on"/></div></div></a></div><p id="9e93" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Today I want to bridge this gap and investigate with you a really stylish and efficient framework for high-performance web-based visualizations<strong class="ne fr"> </strong><a class="af nb" href="https://deck.gl/" rel="noopener ugc nofollow" target="_blank"><strong class="ne fr">deck.jl</strong></a>, which also has a python library <strong class="ne fr">PyDeck</strong>.</p><p id="ace3" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">To properly explore its capabilities in python we need a large geospatial dataset. A perfect candidate for that is <a class="af nb" href="https://www.kaggle.com/datasets/sumaiaparveenshupti/los-angeles-crime-data-20102020" rel="noopener ugc nofollow" target="_blank">Los Angeles Crime Data 2010–2020</a> dataset from Kaggle. Luckily, it has an <a class="af nb" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank">open license</a>, so we could freely use it for our purposes.</p><p id="4aa4" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The authors distribute two <em class="oh">csv</em> files, which we are going to merge into one filtering out all the columns except longitude and latitude (coordinates of the places where the crimes were conducted).</p><p id="6647" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">🐍The full python code: </strong><a class="af nb" href="https://github.com/alexxxroz/Medium/blob/main/PyDeck_3D_Maps.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="ne fr">GitHub</strong></a><strong class="ne fr">.</strong></p><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="9174" class="pg ph fq pd b bg pi pj l pk pl">import numpy as np<br/>import pandas as pd<br/>import xarray as xr<br/>import geopandas as gpd<br/>import random<br/>import math<br/><br/>import matplotlib.pyplot as plt<br/>from shapely import Point<br/><br/>import cartopy<br/>import cartopy.crs as ccrs<br/>import cartopy.feature as cfeature<br/><br/>import warnings<br/><br/>warnings.filterwarnings('ignore')<br/><br/>recent = pd.read_csv('./LA Crimes/Crime_Data_from_2020_to_Present.csv')[['LAT', 'LON']]<br/>old = pd.read_csv('./LA Crimes/Crime_Data_from_2010_to_2019.csv')[['LAT', 'LON']]<br/>df = pd.concat([old, recent])<br/>df = df[(df.LON!=0) &amp; (df.LAT!=0)] #zeros are Nans according to meta info</span></pre><p id="44d1" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">After loading it in pandas, I want to perform a static 2D visualization using <em class="oh">cartopy</em>, just to have a reliable reference. If we simply plot the data, we’ll get a bunch of data points, which are of no use for us.</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pm"><img src="../Images/e4c1d339c756c6b642af6d8ab0088150.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*vZH5-IEgQcSHSJ_x2D-9Iw.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="a8d6" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Instead let’s perform spatial interpolation using the NN method (you can read more about it in my other article).</p><div class="oi oj ok ol om on"><a rel="noopener follow" target="_blank" href="/3-best-methods-for-spatial-interpolation-912cab7aee47?source=post_page-----498398c25a39--------------------------------"><div class="oo ab ig"><div class="op ab co cb oq or"><h2 class="bf fr hw z io os iq ir ot it iv fp bk">3 Best Methods for Spatial Interpolation</h2><div class="ou l"><h3 class="bf b hw z io os iq ir ot it iv dx">From scratch, in Python</h3></div><div class="ov l"><p class="bf b dy z io os iq ir ot it iv dx">towardsdatascience.com</p></div></div><div class="ow l"><div class="pn l oy oz pa ow pb lq on"/></div></div></a></div><p id="c722" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Basically, it means that we transfer sparse observations into a geographical grid (PyDeck will do the same thing, in this case it can be called data aggregation).</p><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="f7c0" class="pg ph fq pd b bg pi pj l pk pl">def coords(x,y, base=0.01):<br/> x, y = round(base * math.ceil(abs(x)/base),2), round(base * math.ceil(y/base),2)<br/> return (y,x)<br/><br/>def NN(data, LAT, LON):<br/>  array = np.zeros((LAT.shape[0], LON.shape[0]),dtype=int)<br/>  onGrid = data.apply(lambda row: coords(row.LAT, row.LON, 0.01), axis = 1).value_counts()<br/>  for coor in onGrid.index:<br/>    lon_idx, lat_idx = np.where(LON==coor[0]), np.where(LAT==coor[1])<br/>    array[lat_idx,lon_idx] = int(onGrid[coor])<br/>  return array</span></pre><p id="4a97" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">After the algorithm is done (you’ll need to wait for some time, since we have more than 2 mil rows to process), we can wrap its results into an <em class="oh">xarray</em> dataset and map it.</p><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="b1dd" class="pg ph fq pd b bg pi pj l pk pl">LAT, LON = np.arange(round(df.LAT.min()), round(df.LAT.max()), 0.01).astype(np.float32), np.arange(round(df.LON.min()), round(df.LON.max()), 0.01).astype(np.float32)<br/>crimes = NN(df, LAT, LON)<br/>ds = xr.Dataset(<br/>    {'Crimes': (['lat', 'lon'], crimes)},<br/>    coords={'lat': LAT, 'lon': LON})<br/><br/>fig, ax = plt.subplots(subplot_kw=dict(projection=ccrs.PlateCarree()), figsize=(16, 9))<br/><br/>ds.Crimes.plot(ax=ax, cmap='Reds')<br/>ax.set_extent([-118.9, -118.1, 33.6, 34.5 ], crs=ccrs.PlateCarree())<br/>ax.gridlines(draw_labels=True,linewidth=2, color='black', alpha=0.5, linestyle='--')<br/>ax.add_feature(cfeature.BORDERS, edgecolor='black', linewidth=1)<br/><br/>ax.add_feature(cfeature.COASTLINE, edgecolor='black', linewidth=1)<br/>ax.add_feature(cartopy.feature.RIVERS, edgecolor='blue', linewidth=0.5)<br/>states_provinces = cfeature.NaturalEarthFeature(<br/>            category='cultural',  name='admin_1_states_provinces',<br/>            scale='10m', facecolor='none')<br/><br/>plt.show()</span></pre><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj po"><img src="../Images/4cb04396ef5a88ff66debcc1afa1e262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wd4iqMY4x2npb5i_Jdwo0w.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="ec86" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">From my perspective, it looks nice and informative, but if you need to sell this project to someone, you’ll most probably fail with such a map xD. So let’s pip install PyDeck and see what it can do for us!</p><h1 id="5dbe" class="pp ph fq bf pq pr ps gq pt pu pv gt pw px py pz qa qb qc qd qe qf qg qh qi qj bk">1. Hexagons.</h1><p id="7e32" class="pw-post-body-paragraph nc nd fq ne b go qk ng nh gr ql nj nk nl qm nn no np qn nr ns nt qo nv nw nx fj bk">The first type of map layer I found beautiful was the Hexagon layer. You need to specify it while creating the L<strong class="ne fr">ayer</strong> variable in PyDeck. There are several other crucial parameters for us:</p><ul class=""><li id="19cc" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx qp qq qr bk">radius (the radius of hexagon in meters, i.e. spatial resolution in m);</li><li id="b486" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">elevation_scale (scale factor for bins, the greater the value, the higher the hexagons);</li><li id="072a" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">elevation_range (min and max height);</li><li id="dcee" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">pickable (interactively showing the values);</li><li id="cece" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">extruded (cell elevation).</li></ul><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="8a79" class="pg ph fq pd b bg pi pj l pk pl">layer = pdk.Layer(<br/>    'HexagonLayer',<br/>    df,<br/>    get_position=['LON', 'LAT'],<br/>    radius=500, #bin radius<br/>    auto_highlight=True,<br/>    elevation_scale=50, #scale factor for bins (the greater - the higher)<br/>    elevation_range=[0, 3000],<br/>    pickable=True,<br/>    extruded=True,#cell elevation<br/>    )</span></pre><p id="e2e7" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The second variable we need to create is the View state. We need to feed it with:</p><ul class=""><li id="1596" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx qp qq qr bk">longitude and latitude;</li><li id="7793" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">zoom (initial zoom);</li><li id="549a" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">min_zoom and max_zoom;</li><li id="e7f2" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">bearing (left/right view angle);</li><li id="2ef6" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">pitch (up/down view angle).</li></ul><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="5e7b" class="pg ph fq pd b bg pi pj l pk pl">view_state = pdk.ViewState(<br/>    longitude=-118.3,<br/>    latitude=34.4,<br/>    zoom=8,<br/>    min_zoom=6,<br/>    max_zoom=15,<br/>    bearing=-20,#left/right angle<br/>    pitch=20, #up/down angle<br/>    )</span></pre><p id="34c8" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Since we have a large dataset, google colab doesn’t display all the dataset, so you have two options:</p><ul class=""><li id="764f" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx qp qq qr bk">Sample N rows from the dataset;</li><li id="4821" class="nc nd fq ne b go qs ng nh gr qt nj nk nl qu nn no np qv nr ns nt qw nv nw nx qp qq qr bk">Save the map to html and open it in your browser.</li></ul><p id="dd1f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">If you pick the second one, you’ll get this:</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qx"><img src="../Images/39e06c87e81077954efe4dc5f62ec734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rHRUu4U-GW0JgvFk-EasA.gif"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="c1dc" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">To be honest, I love how hexagons look, but I’ve never seen them in any scientific paper/presentation/lecture, so I’d recommend using them consciously.</p><h1 id="0a73" class="pp ph fq bf pq pr ps gq pt pu pv gt pw px py pz qa qb qc qd qe qf qg qh qi qj bk">2. Columns</h1><p id="9d17" class="pw-post-body-paragraph nc nd fq ne b go qk ng nh gr ql nj nk nl qm nn no np qn nr ns nt qo nv nw nx fj bk">Now let’s try to create a similar visualization, but using columns. But in this case we will need to pass to the function the xarray dataset we created earlier and specify the color and the variable to visualize:</p><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="db20" class="pg ph fq pd b bg pi pj l pk pl">layer = pdk.Layer(<br/>    'ColumnLayer',<br/>    ds.to_dataframe().reset_index(),<br/>    get_position=['lon', 'lat'],<br/>    get_elevation='Crimes',<br/>    elevation_scale=10,<br/>    radius=200,<br/>    get_fill_color=['Crimes', 220],<br/>    pickable=True,<br/>    extruded=True,<br/>    )</span></pre><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qx"><img src="../Images/cc30a98b5ee2146008744d31b6a2df27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdq2shD8fW9TNTBUcbtwVQ.gif"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><h1 id="eb23" class="pp ph fq bf pq pr ps gq pt pu pv gt pw px py pz qa qb qc qd qe qf qg qh qi qj bk">3. Scatter plot</h1><p id="5588" class="pw-post-body-paragraph nc nd fq ne b go qk ng nh gr ql nj nk nl qm nn no np qn nr ns nt qo nv nw nx fj bk">In essence, scatter plot is a cloud of points, but the authors of PyDeck developed cylinders, which look quite unique:</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qy"><img src="../Images/02f97b260ea3c59ba0ad2e115cea005f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N9Z_eao2tDKk8557KXYjLA.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="070f" class="pg ph fq pd b bg pi pj l pk pl">layer = pdk.Layer(<br/>    'ColumnLayer',<br/>    df[:15000],<br/>    get_position=['LON', 'LAT'],<br/>    auto_highlight=True,<br/>    get_radius=200,          # Radius is given in meters<br/>    get_fill_color=[180, 0, 200, 140],  # Set an RGBA value for fill<br/>    pickable=True)</span></pre><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qz"><img src="../Images/b181b49d8fcccb41ab7b2117138ad0d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FelYwJp1ZBcCBKJT37etAQ.gif"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><h1 id="03bc" class="pp ph fq bf pq pr ps gq pt pu pv gt pw px py pz qa qb qc qd qe qf qg qh qi qj bk">4. Map style</h1><p id="bfe7" class="pw-post-body-paragraph nc nd fq ne b go qk ng nh gr ql nj nk nl qm nn no np qn nr ns nt qo nv nw nx fj bk">A really cool thing about PyDeck is that as plotly, geemap, folium and other interactive mapping tools, it allows users to change the basemap, meaning you can design a map according to your project’s context:</p><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="afdf" class="pg ph fq pd b bg pi pj l pk pl">r = pdk.Deck(layers=[layer],<br/>             initial_view_state=view_state,<br/>             map_style=pdk.map_styles.LIGHT, # ‘light’, ‘dark’, ‘road’, ‘satellite’, ‘dark_no_labels’, and ‘light_no_labels<br/>             )</span></pre><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qz"><img src="../Images/50b2a8f66e10ec360688621211efbdd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VrPpyx2L1hLu3nmiXKwGcA.gif"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><h1 id="b63a" class="pp ph fq bf pq pr ps gq pt pu pv gt pw px py pz qa qb qc qd qe qf qg qh qi qj bk">5. Titles</h1><p id="30a5" class="pw-post-body-paragraph nc nd fq ne b go qk ng nh gr ql nj nk nl qm nn no np qn nr ns nt qo nv nw nx fj bk">The next feature, which I find super helpful, is changing the interactive data description. By putting a cursor on a column/hexagon/point you can get meta information, but often it looks a little bit preposterous. But in PyDeck you can easily overcome it:</p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div class="ab cn cb ra"><img src="../Images/582e1ea8485234ef1a68a63fe9fa529c.png" data-original-src="https://miro.medium.com/v2/format:webp/0*C3SWa49WrL9g0zVM"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="70c0" class="pg ph fq pd b bg pi pj l pk pl">r = pdk.Deck(layers=[layer],<br/>             initial_view_state=view_state,<br/>                  "html": "&lt;b&gt;Number of crimes:&lt;/b&gt; {elevationValue}",<br/>                  "style": {<br/>                        "backgroundColor": "yellow",<br/>                        "color": "black"<br/>                  }<br/>                },<br/>             )</span></pre><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qz"><img src="../Images/8ea69b8f10ab3eed20ae63fcbfcfb08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LIYMeqmshHRVJASI4DqZ4Q.gif"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><h1 id="493d" class="pp ph fq bf pq pr ps gq pt pu pv gt pw px py pz qa qb qc qd qe qf qg qh qi qj bk">6. View angle</h1><p id="88c1" class="pw-post-body-paragraph nc nd fq ne b go qk ng nh gr ql nj nk nl qm nn no np qn nr ns nt qo nv nw nx fj bk">Finally, the most amazing feature of this library is your ability to change the viewing angle on the map simply by clicking the right button of your mouse:</p><pre class="ml mm mn mo mp pc pd pe bp pf bb bk"><span id="74ab" class="pg ph fq pd b bg pi pj l pk pl">from ipywidgets import HTML<br/><br/>text = HTML(value='Move the viewpoint')<br/><br/>def filter_by_bbox(row, west_lng, east_lng, north_lat, south_lat):<br/>    return west_lng &lt; row['lng'] &lt; east_lng and south_lat &lt; row['lat'] &lt; north_lat<br/><br/>def filter_by_viewport(widget_instance, payload):<br/>    west_lng, north_lat = payload['data']['nw']<br/>    east_lng, south_lat = payload['data']['se']<br/>    filtered_df = df[df.apply(lambda row: filter_by_bbox(row, west_lng, east_lng, north_lat, south_lat), axis=1)]<br/><br/><br/>r.deck_widget.on_click(filter_by_viewport)</span></pre><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj qx"><img src="../Images/0d126df99ce2a038c2d6a607ca604a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sdyBO-G3SrJTkIFlHh5TjQ.gif"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by <a class="af nb" href="https://medium.com/@alexroz" rel="noopener">author</a>.</figcaption></figure><p id="468a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">I definitely enjoy <strong class="ne fr">PyDeck</strong> and plan to dive deeper into the <strong class="ne fr">deck.jl</strong> framework. With super easy and intuitive syntax it allows users to build impressive visualizations being energy-efficient. Python limits the capabilities of this package a lot, so check out their <a class="af nb" href="https://deck.gl/examples" rel="noopener ugc nofollow" target="_blank">gallery</a>, it’s mind blowing, especially their experimental GlobalView feature…</p><p id="5a32" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Hopefully this article was informative and insightful for you!</p><p id="b0ba" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">===========================================</p><p id="c5da" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr"><em class="oh">All my publications on Medium are free and open-access, that’s why I’d really appreciate if you followed me here!</em></strong></p><p id="175f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">P.s. I’m extremely passionate about (Geo)Data Science, ML/AI and Climate Change. So if you want to work together on some project pls contact me in <a class="af nb" href="https://www.linkedin.com/in/alexxxroz/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</p><p id="404c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">🛰️Follow for more🛰️</p></div></div></div></div>    
</body>
</html>