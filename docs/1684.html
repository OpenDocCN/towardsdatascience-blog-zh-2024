<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>How to Test Machine Learning Systems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>How to Test Machine Learning Systems</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-test-machine-learning-systems-d53623d32797?source=collection_archive---------4-----------------------#2024-07-10">https://towardsdatascience.com/how-to-test-machine-learning-systems-d53623d32797?source=collection_archive---------4-----------------------#2024-07-10</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="827a" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx"><strong class="al">From concepts to practical code snippets for effective testing</strong></h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@Eyaltra?source=post_page---byline--d53623d32797--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Eyal Trabelsi" class="l ep by dd de cx" src="../Images/60562caa76b824eac9e21f1c0a2933fc.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*yavjMVASfr5taFbVE2eo7Q.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--d53623d32797--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@Eyaltra?source=post_page---byline--d53623d32797--------------------------------" rel="noopener follow">Eyal Trabelsi</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--d53623d32797--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">14 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jul 10, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj la lb ab q ee lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lg an ao ap id lh li lj" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep lk cn"><div class="l ae"><div class="ab cb"><div class="ll lm ln lo lp lq ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lg an ao ap id lr ls ld lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj mk"><img src="../Images/86f08b665dafcd4e8acdc7008bd32c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7J3d-4gU5LnNgB4XOHhLzg.png"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Image by the author</figcaption></figure><p id="abc9" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Testing in software development is crucial as<strong class="nd fr"> it safeguards the value delivered to your customers. </strong>Delivering a successful product isn’t a one-time effort; it’s an ongoing process. To ensure continuous delivery, we must define success, curate the data, and then train and deploy our models while continuously monitoring and testing our work.</p><p id="1e7c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">To deliver continuously, we must Define success, curate the data, and then train and deploy our models while continuously monitoring and testing our work.<strong class="nd fr"> “Trust” in ML Systems requires more than just testing; it must be integrated into the entire lifecycle </strong>(as shown in another blog of mine)<strong class="nd fr">.</strong></p><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj nx"><img src="../Images/c52c3c0fb594e33d68cd59bc020d2b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8yher9Uy3W5gcWX_"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">The machine learning flow of TRUST can be described in <a class="af ny" href="https://medium.com/bigabids-dataverse/how-to-build-trust-in-machine-learning-the-sane-way-39d879f22e69" rel="noopener">“How to build TRUST in Machine Learning, the sane way”</a> (Image by the author).</figcaption></figure><p id="53a7" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Before diving into the detailed sections, here’s a quick TL;DR for everyone, followed by more in-depth information tailored for ML practitioners.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="317d" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">TL;DR</h1><p id="b343" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk"><a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#78cd" rel="noopener"><strong class="nd fr">Testing machine learning is hard</strong></a> because it’s probabilistic by nature, and must account for diverse data and dynamic real-world conditions.</p><p id="f6b6" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#ffab" rel="noopener"><strong class="nd fr">You should start with a basic CI pipeline.</strong></a> Focus on the most valuable tests for your use case: <a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#34f1" rel="noopener">Syntax Testing</a>, <a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#65d9" rel="noopener">Data Creation Testing</a>, <a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#eef4" rel="noopener">Model Creation Testing</a>, <a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#82c6" rel="noopener">E2E Testing</a>, and <a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#afbe" rel="noopener">Artifact Testing</a>. <strong class="nd fr">Most of the time the most valuable test is </strong><strong class="nd fr">E2E Testing</strong><strong class="nd fr">.</strong></p><p id="89f2" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">To understand what value each kind of test brings we define the following table:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Confidence Gain: </strong>Ensures correctness of the system.<br/><strong class="al">Test Churn: </strong>Indicates how often tests need updates or modifications.<br/><strong class="al">Run Cost: </strong>Represents the computational and time cost of executing the tests.<br/><strong class="al">Case Variation: </strong>Diversity of scenarios covered by the tests.<br/><strong class="al">Pinpointing Issues: </strong>Effectiveness in identifying and locating issues.</figcaption></figure><p id="851c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">To be effective in testing machine learning models, it’s important to follow some <a class="af ny" href="https://medium.com/@Eyaltra/d53623d32797#951a" rel="noopener"><strong class="nd fr">best practices that are unique to ML testin</strong></a><strong class="nd fr">g</strong>, as it differs significantly from regular software testing.</p><p id="bf26" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Now that you’ve got the quick overview, let’s dive deeper into the details for a comprehensive understanding.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="78cd" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Why Testing ML is Hard</h1><p id="e4c3" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Testing machine learning systems introduces unique complexities and challenges:</p><ul class=""><li id="30d8" class="nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw pl pm pn bk"><strong class="nd fr">Data Complexity:</strong> Handling data effectively is challenging; it needs to be valid, accurate, consistent, and timely, and it keeps changing.</li><li id="69e5" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Resource-Intensive Processes:</strong> Both the development and operation of ML systems can be costly and time-consuming, demanding significant computational and financial resources.</li><li id="fba8" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Complexity: </strong>ML systems include many components, and there are a lot of places things can go wrong. In addition, integration often requires proper communication.</li><li id="631e" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">System Dynamics and Testing Maturity: </strong>Machine learning systems are prone to frequent changes and silent failures.</li><li id="79a9" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Probabilistic Nature:</strong> Machine learning models often produce outputs that are not deterministic. In addition, the data fetched may not be deterministic.</li><li id="b8e7" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Specialized Hardware Requirements:</strong> ML systems often require advanced hardware setups, such as GPUs.</li></ul><figure class="ml mm mn mo mp mq mi mj paragraph-image"><div role="button" tabindex="0" class="mr ms ed mt bh mu"><div class="mi mj pt"><img src="../Images/f0273c16788ad1270d7e97ee6948f503.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eC5oaHGPPF695bR7"/></div></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Traditional system testing VS ML projects testing (<a class="af ny" href="https://research.google/pubs/the-ml-test-score-a-rubric-for-ml-production-readiness-and-technical-debt-reduction/" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="ffab" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">How to Start</h1><p id="d517" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk"><strong class="nd fr">Always start with setting up the CI workflow, as it’s straightforward and reduces the barrier to testing.</strong> Setting up CI involves automating your build and test processes, ensuring that code changes are continuously integrated and tested. This automation makes the process more consistent and helps avoid many potential issues.</p><p id="0fdc" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><strong class="nd fr">The good news is that this process is quite repetitive and can be easily automated.</strong> Pre-commit will handle executing the syntax validation process, ensuring that your code “compiles”. Meanwhile, pytest will run the tests to verify that your code behaves as expected.</p><p id="62c6" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Here’s a code snippet for a GitHub Action that sets up this workflow:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This snippet configures a basic CI pipeline for testing.</figcaption></figure><p id="633c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Now that we have a running CI pipeline, we can explore which tests we should run according to the tests’ value.</p><p id="d7df" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><strong class="nd fr">You can start small and gradually expand your tests as you discover bugs, adding tests for each issue you encounter.</strong> <strong class="nd fr">As long as the CI pipeline is in place, the main barrier to testing is simply knowing what to test.</strong></p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="34f1" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk"><strong class="al">Syntax Testing</strong></h1><p id="f555" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">When executing machine learning code, it’s important to verify syntax-related elements early in the development process to identify potential issues before they escalate. Given that machine learning workflows typically consist of a mix of Python code, SQL queries, and configuration files, each component demands specific validation checks:</p><h2 id="800d" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Python Code Validation</strong></h2><p id="1908" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Validating Python code through syntax checks using AST and type checks using MyPy helps prevent runtime errors and functional discrepancies that could impact the entire machine-learning pipeline. <br/>Here’s a code snippet for pre-commit to test Python syntax and typing.</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This snippet configures a pre-commit hook to check the syntax and typing on Python files.</figcaption></figure></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="a735" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">SQL Query Validation</strong></h2><p id="eae2" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Validating SQL queries is crucial for ensuring that data retrieval processes are structured correctly and are free from errors. For static checks like syntax, tools like SQLFluff can be integrated with pre-commit hooks to automatically lint SQL code. <br/>Here’s a code snippet for pre-commit to test SQL syntax.</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This snippet configures a pre-commit hook to check the syntax of SQL files using sqlfluff.</figcaption></figure><p id="e7f9" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">However, to handle runtime issues such as verifying the existence of a column, we would need to use the <code class="cx ql qm qn qo b">EXPLAIN</code> statement on all SQL. This is effective as it only plans the queries but does not execute them. If a query is invalid, the <code class="cx ql qm qn qo b">EXPLAIN</code> command will fail. This method is supported by most SQL dialects but requires database connectivity to execute.<br/>Here’s a code snippet to test SQL syntax and metadata using pytest.</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This snippet configures the pytest test to check the syntax of SQL files.</figcaption></figure></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="77f8" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Configuration File Validation</strong></h2><p id="0a11" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Ensuring the validity of configuration files is critical as they often control the operational parameters of a machine learning model, typically in JSON or YAML formats. For basic validation, it’s essential to check that these files are syntactically correct. <br/>Here’s a code snippet for pre-commit to test YAML and JSON syntax.</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This snippet configures a pre-commit hook to check the syntax of YAML and JSON files.</figcaption></figure><p id="bd56" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">However, syntax validation alone is insufficient. It's crucial to also ensure that the settings—like hyperparameters, input/output configurations, and environmental variables—are suitable for your application. Using a tool like <a class="af ny" href="https://docs.python-cerberus.org/usage.html" rel="noopener ugc nofollow" target="_blank">cerberus</a> via pytest enables comprehensive validation against a predefined schema, ensuring that the configurations are correct and practical.</p><p id="9ae7" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">By testing the syntax of code, queries, and configurations, developers can substantially enhance the stability and reliability of machine learning systems, enabling smoother deployments and operations.</p><p id="ab1f" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><strong class="nd fr">I’d suggest incorporating these checks into every project. </strong>They’re pretty straightforward to replicate and can help you avoid many unnecessary issues. Plus, they’re essentially copy-paste, making them easy to implement.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="65d9" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk"><strong class="al">Data Creation Testing</strong></h1><p id="993b" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Data Creation Testing ensures your feature engineering work correctly, following the idea of <em class="qp">“garbage in, garbage out”</em>.</p><p id="4796" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">In software testing, various methods such as unit tests, property-based testing, component tests, and integration tests each have their own strengths and weaknesses. We will explore each of these strategies in more detail shortly.</p><p id="2bce" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">We will explore all the testing options by starting with an example from the Titanic dataset, where we calculate <code class="cx ql qm qn qo b">get_family_size</code>, where family size is based on the number of parents and siblings.</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This function calculates the family size by adding the number of siblings and parents/children and then adding one to include the individual.</figcaption></figure></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="0962" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk">Data Creation <strong class="al">Unit Tests</strong></h2><p id="8025" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Tests are used for validating the business logic of individual functions, primarily focusing on optimal scenarios, or “happy paths,” but they also help identify issues in less ideal scenarios, known as “paths of sorrow.”<br/>Here is an example of a unit test that checks the <code class="cx ql qm qn qo b">get_family_size</code> functionality:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Testing basic functionality for calculating family size</figcaption></figure><p id="b27b" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">In different modalities, including vision, NLP, and generative AI, unit tests are used a bit differently. For example, in NLP and large language models (LLMs), testing the tokenizer is critical as it ensures accurate text processing by correctly splitting text into meaningful units. In image recognition, tests can check the model’s ability to handle object rotation and varying lighting conditions.</p><p id="b5f8" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">However,<a class="af ny" href="https://tyrrrz.me/blog/unit-testing-is-overrated" rel="noopener ugc nofollow" target="_blank"> unit tests alone are not enough </a>because they focus on specific functions and miss side effects or interactions with other components. While great for checking logical code blocks like loops and conditions, their narrow scope, often using test doubles, can overlook behavior changes in areas not directly tested.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="d179" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk">Data Creation <strong class="al">Property-Based Testing</strong></h2><p id="2c2a" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Property-based testing is a testing approach where properties or characteristics of input data are defined, and test cases are automatically generated to check if these properties hold true for the system under test.</p><p id="50ba" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Property-based testing ensures the system does not encounter issues with extreme or unusual inputs. This method can uncover problems that example-based tests might miss.</p><p id="ba08" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Some good/common properties you should test:</p><ul class=""><li id="15b7" class="nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw pl pm pn bk">The code does not crash. This one is extremely effective.</li><li id="6b96" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk">Equivalent functions return the same results.</li><li id="bc85" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk">Great expectation Invariants.</li><li id="b654" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk">Correct schemas.</li><li id="b86a" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk">Other properties like Idempotent, commutative, associative, etc.</li></ul><p id="dac6" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Here is an example of a property-based test that ensures <code class="cx ql qm qn qo b">get_family_size</code> behaves correctly under a range of edge cases and input variations:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Testing functionality at input boundaries for calculating family size</figcaption></figure><p id="8cd4" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Property tests, while powerful, often overlook the complexities of software dependencies, interdependencies, and external systems. Running in isolation, they may miss interactions, state, and real-world environmental factors.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="8595" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk">Data Creation <strong class="al">Component Tests</strong></h2><p id="0080" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Component testing validates individual parts of a software system in isolation to ensure they function correctly before integration. Excel helps uncover unusual user behaviors and edge cases that unit and property tests might miss, representing the system’s status closely and anticipating ‘creative’ user interactions.</p><p id="2c15" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">To keep these tests maintainable and fast, data samples are used. One should choose the right source data and sample sizes required.</p><p id="3eac" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Here is an example of a component test that ensures <code class="cx ql qm qn qo b">get_family_size</code> behaves correctly on real data, with real dependencies:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Testing functionality according to real traffic and calculating family size</figcaption></figure></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="0c0c" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk">Picking Production or Staging for Data Creation</h2><p id="64c5" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">To keep data volumes manageable, modify your queries or dataset for continuous integration (CI) by injecting a <code class="cx ql qm qn qo b">LIMIT</code><em class="qp"> </em>clause or an aggressive <code class="cx ql qm qn qo b">WHERE</code><em class="qp"> </em>clause.</p><p id="96ef" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><strong class="nd fr">Choosing a staging environment for more controlled, smaller-volume tests is often the best approach</strong>. This environment offers easier reproducibility and fewer privacy concerns. However, since it is not production, <strong class="nd fr">you must verify that the staging and production schemas are identical.</strong><br/>The following code snippet verify production Athena table has the same schema as staging Athena table.</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Verify Athena schema for both tables are the same aka staging is not stale.</figcaption></figure><p id="ab1a" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Choose production to see how features operate with real user data. This environment provides a full-fledged view of system performance and user interaction.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="287e" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Data Creation <strong class="al">Integration Tests</strong></h1><p id="c4ef" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">While component tests provide a focused view, a broader perspective is sometimes necessary. Integration tests evaluate the cooperation between different modules, ensuring they function together seamlessly.</p><p id="6e5e" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The goal of integration testing is to ensure that the pipeline makes sense, not necessarily to verify every small detail for correctness, <strong class="nd fr">so avoid brittle assertion sections</strong>.</p><p id="604c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Here is an example of an integration test that ensures <code class="cx ql qm qn qo b">feature_engineering</code> behaves correctly on real data, with real dependencies:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Verify the feature engineering process produces a dataframe with the correct schema.</figcaption></figure><p id="469a" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Using property tests for a wide portion of feature engineering processes (like integration tests) is not ideal. These tests often require extensive setup and maintenance, and their complexity increases significantly.<br/>Here is an example to show how complicated property-based testing can become:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Verify the feature engineering with property-based testing will be brittle.</figcaption></figure></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="e41d" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk">Data Creation Testing Strategy</h2><p id="1021" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Choosing the right testing strategy is crucial for ensuring robust and maintainable code. Here’s a breakdown of when and how to use different types of tests:</p><ul class=""><li id="b192" class="nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw pl pm pn bk"><strong class="nd fr">Unit Tests</strong>: unit tests are ideal for validating individual functions. They can be fragile, often requiring updates or replacements as the code evolves. While useful early on, their relevance may diminish as the project progresses.</li><li id="6601" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Property-Based Testing</strong>: Best for cases where edge cases could be critical and requirements are stable. These tests are designed to cover a wide range of inputs and validate behavior under theoretical conditions, which makes them robust but sometimes complex to maintain.</li><li id="f4f7" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Component Tests</strong>: These offer a practical balance, being easier to set up than property-based tests. Component tests effectively mimic real-world scenarios, and their relative simplicity allows for easier replication and adaptation. They provide a useful layer of testing that adapts well to changes in the system.</li><li id="ff68" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Integration Tests</strong>: Positioned to confirm the overall system correctness, integration tests blend a high-level view with enough detail to aid in debugging. They focus on the interaction between system parts under realistic conditions, generally checking the properties of outputs rather than exact values. This approach makes integration tests less precise but easier to maintain, avoiding the trap of tests becoming too cumbersome.</li></ul></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="eef4" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk"><strong class="al">Model Creation Testing</strong></h1><p id="d7e9" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">The next set of tests focuses on verifying whether the process of creating a model works properly. The distinction I make in this section, compared to tests related to artifacts, is that these tests do not require a lot of data and should be performed for every pull request.</p><p id="bff0" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">There are many types of tests to ensure the correctness of model training. Below is a non-exhaustive list of some crucial tests you should consider.</p><h2 id="bea2" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Verify Training is Done Correctly</strong></h2><p id="49c0" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk"><strong class="nd fr">To verify correct training, track key indicators such as the loss function</strong>; a consistently decreasing loss signals effective learning. For example, signs of overfitting by comparing performance on training and validation.<br/>The following code snippet validates that the training loss is monotonically decreasing:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Ensure the training process produces monotonically decreasing training losses, verifying the sanity of the metric during model training.</figcaption></figure><p id="f160" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The same strategy for verifying correct training applies to different modalities like NLP, LLM, and vision models.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="cab6" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Ability to Overfit</strong></h2><p id="083f" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Test the model’s capacity to learn from a very small amount of data by making it overfit to this batch and checking for perfect alignment between predictions and labels.<strong class="nd fr"> This is important because it ensures that the model can effectively learn patterns and memorize data, which is a fundamental aspect of its learning capability.</strong><br/>The following tests validate that given enough signal the model can learn:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Verify that the model can overfit by introducing data leakage</figcaption></figure><p id="04bf" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The same strategy for verifying correct training applies to different modalities like NLP, LLM, and vision models.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="2af5" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">GPU/CPU Consistency</strong></h2><p id="7bbb" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Confirming that the model provides consistent output and performance on different computing platforms is crucial for reliability and reproducibility. This ensures that the model performs as expected across various environments, maintaining user trust and delivering a robust machine-learning solution.<br/>The following code snippet validate that the model gives the same predictions for CPU and GPU versions:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Verify that a model produces consistent predictions whether run on a GPU or CPU by comparing their outputs on the same input data.</figcaption></figure><p id="551b" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The same strategy for verifying correct training applies to different modalities like NLP, LLM, and vision models.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="4d4d" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Training is Reproducible</strong></h2><p id="4bc5" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Ensuring the model training process can be consistently replicated is crucial for reliability and credibility. It facilitates debugging and aids collaboration and transparency.<br/>The following code snippet validates the model training is reproducible:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Verify the reproducibility of the training process by verifying that two models trained on the same data produce nearly identical predictions.</figcaption></figure><p id="02e4" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The same strategy for verifying correct training applies to different modalities like NLP, LLM, and vision models.</p><p id="17f9" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><strong class="nd fr">These tests run on small data to provide a sanity check that the model’s basic functionality makes sense.</strong> Further validation and evaluation on larger datasets are necessary to ensure the model delivers real value and performs well in production in the following section.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="82c6" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">4. <strong class="al">E2E Testing</strong></h1><p id="1337" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">E2E testing in machine learning involves testing the combined parts of a pipeline to ensure they work together as expected. This includes data pipelines, feature engineering, model training, and model serialization and export. <strong class="nd fr">The primary goal is to ensure that modules interact correctly when combined and that system and model standards are met.</strong></p><p id="887e" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Conducting E2E tests reduces the risk of deployment failures and ensures effective production operation. It’s important to keep the assertion section not brittle, the goal of the integration test is to make sure the pipeline makes sense, not that it’s correct.</p><p id="80b2" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Integration testing ensures cohesion by verifying that different parts of the machine learning workflow. It detects system-wide issues, such as data format inconsistencies and compatibility problems, and verifies end-to-end functionality, confirming that the system meets overall requirements from data collection to model output.</p><p id="3f26" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk"><strong class="nd fr">Since machine learning systems are complex and brittle, You should add integration tests as early as possible.</strong></p><p id="8c46" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The following snippet is integration tests of the entire ML pipeline:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Verify the end-to-end integration of the machine learning workflow, from data sampling to model training, exporting, and inference, ensuring the predictions are valid.</figcaption></figure><p id="0adc" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Integration tests require careful planning due to their complexity and resource demands and execution time. Even for integration tests, smaller ones are better. These tests can be complex to set up and maintain, especially as systems scale and evolve.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="afbe" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">5. Artifact Testing</h1><p id="5f81" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Once the model has been trained on a sufficiently large dataset, it is crucial to validate and evaluate the resulting model artifact. This section focuses on ensuring that the trained model not only functions correctly but also delivers meaningful and valuable predictions. Comprehensive validation and evaluation processes are necessary to confirm the model’s performance, robustness, and ability to generalize to new, unseen data.</p><p id="639f" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">There are many types of tests to ensure the correctness of model training. Below is a non-exhaustive list of some crucial tests you should consider.</p><h2 id="5f5b" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Model Inference Latency</strong></h2><p id="fb7c" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Measure how long the model takes to make predictions to ensure it meets performance criteria. In scenarios like Adtech, fraud detection, and e-commerce, the model must return results within a few milliseconds; otherwise, it cannot be used.<br/>The following code snippet validates that model latency is acceptable:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This test asserts the inference latency of a trained model is made within 200 milliseconds.</figcaption></figure><p id="70dc" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The same strategy for verifying correct training applies to different modalities like NLP, LLM, and vision models.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="93a7" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Metamorphic Testing Invariance Tests</strong></h2><p id="cbae" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Metamorphic testing involves creating tests that verify the consistency of a model’s behavior under certain transformations of the input data. Invariance tests are a specific type of metamorphic testing that focuses on the model’s stability by ensuring that changes in inputs that should be irrelevant do not affect the outputs.<br/>The following code snippet aims to make sure a change in a column that should not affect the model prediction, actually doesn’t affect the model prediction:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This test checks for model predictions to remain consistent when changing the “Embarked” feature to “B.”</figcaption></figure><p id="f713" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">It can be useful for other modalities as well. In NLP, an invariance metamorphic test could verify that adding punctuation or stopwords to a sentence does not alter the sentiment analysis outcome. In LLM applications, a test could ensure that rephrasing a question without changing its meaning does not affect the generated answer. In vision, an invariance test might check that minor changes in background color do not impact the image classification results.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="fef7" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Metamorphic Testing</strong> <strong class="al">Directional Tests</strong></h2><p id="ec8a" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Metamorphic testing involves creating tests that verify the consistency of a model’s behavior under certain transformations of the input data. Directional tests, a subset of metamorphic testing, focus on ensuring that changes in relevant inputs lead to predictable logic in one direction in the outputs.<br/>The following code snippet aims to make sure a change that travelers that paid mode will have better chances of surviving according to model prediction:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This test ensures that the model’s predictions for the higher paying travel are higher on average.</figcaption></figure><p id="a8fe" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">It can be useful for other modalities as well, In NLP, a directional metamorphic test could involve verifying that increasing the length of a coherent text improves the language model’s perplexity score. In LLM applications, a test could ensure that adding more context to a question-answering prompt leads to more accurate and relevant answers.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h2 id="980d" class="pu oi fq bf oj pv pw px om py pz qa op nk qb qc qd no qe qf qg ns qh qi qj qk bk"><strong class="al">Model Learnt Reasonably</strong></h2><p id="fb5b" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">Ensure that the model achieves acceptable performance across the entire dataset, closely related to model evaluation, verifying its overall effectiveness and reliability.<br/>The following code snippet that validates model performance is acceptable:</p><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">This test asserts the model’s performance achieves an AUC score greater than 0.8.</figcaption></figure><p id="5fcd" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">It’s pretty common to have high-priority segments that need targeted testing to ensure comprehensive model evaluation. Identifying important use cases and testing them separately is crucial to make sure that a model update does not compromise them. For instance, in a cancer detection scenario, certain types of cancer, such as aggressive or late-stage cancers, maybe more critical to detect accurately than more treatable forms.</p><p id="9d6c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The same strategy for verifying correct training applies to different modalities like NLP, LLM, and vision models.</p></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="951a" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Best Practices for ML Testing</h1><ul class=""><li id="79fa" class="nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw pl pm pn bk"><strong class="nd fr">Automate Tests</strong>: this will ensure consistency and save time later.</li><li id="66b2" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Be Pragmatic:</strong> Perfect coverage isn’t necessary; each project has its own tolerance for errors.</li><li id="b5dc" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Avoid testing fatigue and understand the blast radius.</strong></li><li id="dbfc" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Don’t Test External Libraries</strong></li><li id="57d7" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Configurable Parameters</strong>: Code should be composable. To test code, you want the DataFrame to be injectable to the test, and so on.</li><li id="b601" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Tests Should Run in Reasonable Time</strong>: Use small, simple data samples. If your test requires substantial time, consider when to run it. For example, it’s useful to create tests that can be executed manually or scheduled.<br/>The following code snippet makes the CI run on demand and once a day:</li></ul><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx">Add the ability to trigger workflow on a daily schedule at midnight, and manually through a workflow dispatch.</figcaption></figure><ul class=""><li id="c324" class="nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw pl pm pn bk"><strong class="nd fr">Contract Validation and Documentation</strong>: Increase the use of assertions within your code to actively check for expected conditions (active comments), reducing the reliance on extensive unit testing.</li><li id="2035" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Prioritize Integration Tests</strong>: While unit tests are crucial, integration tests ensure that components work together smoothly. Remember, the biggest lie in software development is, “I finished 99% of the code, I just need to integrate it.”</li><li id="7d83" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Continuous improvement</strong>: When you encounter errors in production or during manual testing, include them in your testing suite.</li><li id="91c7" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Avoid Mocking Your Functions</strong>: Mocking your functions can lead to more work and a lot of false alarms.</li><li id="7332" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Tests Should Aim to Represent Real Scenarios.</strong></li><li id="c31f" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Aim for Maintainable and Reliable Tests</strong>: Address flaky tests that fail inconsistently. Flakiness is not linear; even a small percentage of failures can significantly impact overall reliability.</li><li id="3696" class="nb nc fq nd b go po nf ng gr pp ni nj nk pq nm nn no pr nq nr ns ps nu nv nw pl pm pn bk"><strong class="nd fr">Each Type of Test Has its Own Properties:</strong> This table outlines the properties, advantages, and disadvantages of each testing strategy. While the table remains unchanged, the properties of each test may vary slightly depending on the use case.</li></ul><figure class="ml mm mn mo mp mq"><div class="pi io l ed"><div class="pj pk l"/></div><figcaption class="mw mx my mi mj mz na bf b bg z dx"><strong class="al">Confidence Gain: </strong>Ensures correctness of the system.<br/><strong class="al">Test Churn: </strong>Indicates how often tests need updates or modifications.<br/><strong class="al">Run Cost: </strong>Represents the computational and time cost of executing the tests.<br/><strong class="al">Case Variation: </strong>Diversity of scenarios covered by the tests.<br/><strong class="al">Pinpointing Issues: </strong>Effectiveness in identifying and locating issues.</figcaption></figure></div></div></div><div class="ab cb nz oa ob oc" role="separator"><span class="od by bm oe of og"/><span class="od by bm oe of og"/><span class="od by bm oe of"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><h1 id="321b" class="oh oi fq bf oj ok ol gq om on oo gt op oq or os ot ou ov ow ox oy oz pa pb pc bk">Last words</h1><p id="7800" class="pw-post-body-paragraph nb nc fq nd b go pd nf ng gr pe ni nj nk pf nm nn no pg nq nr ns ph nu nv nw fj bk">In this article, we discussed the challenges of testing machine learning models.</p><p id="cc4c" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">I hope I was able to share my enthusiasm for this fascinating topic and that you find it useful. Feel free to reach out to me via <a class="af ny" href="http://eyaltrabelsi@gmail.com/" rel="noopener ugc nofollow" target="_blank">email</a> or <a class="af ny" href="https://www.linkedin.com/in/eyaltrabelsi/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</p><p id="2f2a" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">Thanks to <a class="af ny" href="https://medium.com/u/fbcd18957436" rel="noopener">Almog Baku</a> and <a class="af ny" href="https://medium.com/u/10fa2c0e33e8" rel="noopener">Ron Itzikovitch</a> for reviewing this post and making it much clearer.</p><p id="f0ce" class="pw-post-body-paragraph nb nc fq nd b go ne nf ng gr nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw fj bk">The following testing resources are great :<br/>- <a class="af ny" href="https://eugeneyan.com/writing/unit-testing-ml/" rel="noopener ugc nofollow" target="_blank">Don’t Mock Machine Learning Models In Unit Tests</a><br/>- <a class="af ny" href="https://eugeneyan.com/writing/testing-ml/" rel="noopener ugc nofollow" target="_blank">How to Test Machine Learning Code and Systems</a><br/>- <a class="af ny" href="https://www.jeremyjordan.me/testing-ml/" rel="noopener ugc nofollow" target="_blank">Effective testing for machine learning systems</a><br/>- <a class="af ny" rel="noopener" target="_blank" href="/metamorphic-testing-of-machine-learning-based-systems-e1fe13baf048">Metamorphic Testing of Machine-Learning Based Systems</a></p></div></div></div></div>    
</body>
</html>