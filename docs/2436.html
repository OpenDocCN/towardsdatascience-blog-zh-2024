<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>How Did Open Food Facts Fix OCR-Extracted Ingredients Using Open-Source LLMs?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>How Did Open Food Facts Fix OCR-Extracted Ingredients Using Open-Source LLMs?</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-did-open-food-facts-use-open-source-llms-to-enhance-ingredients-extraction-d74dfe02e0e4?source=collection_archive---------4-----------------------#2024-10-06">https://towardsdatascience.com/how-did-open-food-facts-use-open-source-llms-to-enhance-ingredients-extraction-d74dfe02e0e4?source=collection_archive---------4-----------------------#2024-10-06</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="87d7" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Delve into an end-to-end Machine Learning project to improve the quality of the Open Food Facts database</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@jeremyarancio?source=post_page---byline--d74dfe02e0e4--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Jeremy Arancio" class="l ep by dd de cx" src="../Images/37c4c41e71eb91cfffc7e4ff2bb4394a.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*Ki2CB_h5I6vI2UbzOPobng.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--d74dfe02e0e4--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@jeremyarancio?source=post_page---byline--d74dfe02e0e4--------------------------------" rel="noopener follow">Jeremy Arancio</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--d74dfe02e0e4--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">13 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Oct 6, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/36288a16e720c9435e278bbc7b280c5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-6WhpiGzUAb__bj8tmFwUQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image generated with Flux1</figcaption></figure><p id="ee81" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Open Food Facts’ purpose is to create the largest <strong class="ne fr">open-source food database in the world</strong>. To this day, it has collected over 3 millions products and their information thanks to its contributors.</p><p id="1091" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Nutritional value, eco-score, product origins,… Various data that define each product and give consumers and researchers insights about what they put in their plates.</p><p id="4f99" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This information is provided by the community of users and contributors, who actively add products data, take pictures, and fill any missing data into the database through the <a class="af ny" href="https://play.google.com/store/apps/details?id=org.openfoodfacts.scanner&amp;hl=en_US&amp;pli=1" rel="noopener ugc nofollow" target="_blank">mobile app</a>.</p><p id="3829" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Using the product picture, Open Food Facts extracts the ingredients list, typically located on the back of the packaging, through Optical Character Recognition (OCR). The product composition is then parsed and added to the database.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk nz"><img src="../Images/7c922462d16ef15165355663e856bf04.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*095wbwP-o4N6ykFG.jpg"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">List of ingredients on the product packaging</figcaption></figure><p id="3b57" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">However, it often appears that the text extraction doesn’t go well…</p><pre class="mm mn mo mp mq oa ob oc bp od bb bk"><span id="2570" class="oe of fq ob b bg og oh l oi oj">Ingrédients: Jambon do porc, sel, dextrose, arôme naturels, antioxydant: E316, conservateur: E250<br/>                     ^</span></pre><p id="4bc8" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">These typos may seem minimal, but when the list is parsed to extract individual ingredients, <strong class="ne fr">such errors create unrecognized ingredients,</strong> which harm the quality of the database. Light reflections, folded packaging, low-quality pictures, and other factors all complicate the ingredient parsing process.</p></div></div><div class="mr"><div class="ab cb"><div class="lm ok ln ol lo om cf on cg oo ci bh"><div class="mm mn mo mp mq ab ke"><figure class="lb mr op oq or os ot paragraph-image"><img src="../Images/dd0d3821089e8b68007112d12a755161.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*z0OscAwbw4e7tzPM.jpg"/></figure><figure class="lb mr ou oq or os ot paragraph-image"><img src="../Images/6074f6e9c6d559cc94eab9cbd049ab7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*kcE1i9RReIsLpNDO.jpg"/><figcaption class="mx my mz mj mk na nb bf b bg z dx ov ed ow ox">Examples of packaging pictures where the OCR fails (from the Open Food Facts database)</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="ee22" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">Open Food Facts has tried to solve this issue for years using Regular Expressions and existing solutions such as Elasticsearch’s corrector, without success. Until recently.</strong></p><p id="2569" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Thanks to the latest advancements in artificial intelligence, we now have access to powerful <strong class="ne fr">Large Language Models</strong>, also called <strong class="ne fr">LLMs</strong>.</p><p id="0d4c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">By training our own model, we created the <strong class="ne fr">Ingredients Spellcheck </strong>and managed to not only outperform proprietary LLMs such as <strong class="ne fr">GPT-4o</strong> or <strong class="ne fr">Claude 3.5 Sonnet </strong>on this task, but also to reduce the number of unrecognized ingredients in the database by <strong class="ne fr">11%</strong>.</p><p id="aa97" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">This article walks you through the different stages of the project and shows you how we managed to improve the quality of the database using Machine Learning.</strong></p><p id="8a51" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Enjoy the reading!</p><h1 id="b758" class="oy of fq bf oz pa pb gq pc pd pe gt pf pg ph pi pj pk pl pm pn po pp pq pr ps bk">Define the problem</h1><p id="7531" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk">When a product is added by a contributor, its pictures go through a series of processes to extract all relevant information. One crucial step is the extraction of the <strong class="ne fr">list of ingredients</strong>.</p><p id="c607" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">When a word is identified as an ingredient, it is cross-referenced with a <strong class="ne fr">taxonomy </strong>that contains a predefined list of recognized ingredients. If the word matches an entry in the taxonomy, it is tagged as an ingredient and added to the product’s information.</p><p id="94d0" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This tagging process ensures that ingredients are standardized and easily searchable, providing accurate data for consumers and analysis tools.</p><p id="002c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">But if an ingredient is not recognized, the process fails.</strong></p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk py"><img src="../Images/f91a23509ebc0f515c471094f2bf15bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lke6K2JoJHOEP9p4f-LurQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">The ingredient “Jambon do porc” (Pork ham) was not recognized by the parser (from the Product Edition page)</figcaption></figure><p id="fdfb" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">For this reason, we introduced an additional layer to the process: the <strong class="ne fr">Ingredients Spellcheck</strong>, designed to correct ingredient lists before they are processed by the ingredient parser.</p><p id="fef5" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">A simpler approach would be the <a class="af ny" href="https://norvig.com/spell-correct.html" rel="noopener ugc nofollow" target="_blank">Peter Norvig algorithm</a>, which processes each word by applying a series of character deletions, additions, and replacements to identify potential corrections.</p><p id="167a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">However, this method proved to be insufficient for our use case, for several reasons:</p><ul class=""><li id="e746" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pz qa qb bk"><strong class="ne fr">Special Characters and Formatting</strong>: Elements like commas, brackets, and percentage signs hold critical importance in ingredient lists, influencing product composition and allergen labeling <em class="qc">(e.g., “salt (1.2%)”).</em></li><li id="b838" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk"><strong class="ne fr">Multilingual Challenges</strong>: the database contains products from all over the word with a wide variety of languages. This further complicates a basic character-based approach like Norvig’s, which is language-agnostic.</li></ul><p id="fc7b" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Instead, we turned to the latest advancements in Machine Learning, particularly <strong class="ne fr">Large Language Models (LLMs)</strong>, which excel in a wide variety of <strong class="ne fr">Natural Language Processing (NLP)</strong> tasks, including spelling correction.</p><p id="a7e9" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This is the path we decided to take.</p><h1 id="d27c" class="oy of fq bf oz pa pb gq pc pd pe gt pf pg ph pi pj pk pl pm pn po pp pq pr ps bk">Evaluate</h1><blockquote class="qi qj qk"><p id="c0db" class="nc nd qc ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">You can’t improve what you don’t measure.</p></blockquote><p id="1f3b" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">What is a good correction? And how to measure the performance of the corrector, LLM or non-LLM?</strong></p><p id="5b9a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Our first step is to understand and catalog the diversity of errors the Ingredient Parser encounters.</p><p id="17f5" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Additionally, it’s essential to assess whether an error should even be corrected in the first place. Sometimes, trying to correct mistakes could do more harm than good:</p><pre class="mm mn mo mp mq oa ob oc bp od bb bk"><span id="e678" class="oe of fq ob b bg og oh l oi oj">flour, salt (1!2%)<br/># Is it 1.2% or 12%?...</span></pre><p id="6a3b" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">For these reasons, we created the <strong class="ne fr">Spellcheck Guidelines</strong>, a set of rules that limits the corrections. <em class="qc">These guidelines will serve us in many ways throughout the project, from the dataset generation to the model evaluation.</em></p><p id="753e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The guidelines was notably used to create the <a class="af ny" href="https://huggingface.co/datasets/openfoodfacts/spellcheck-benchmark" rel="noopener ugc nofollow" target="_blank"><strong class="ne fr">Spellcheck Benchmark</strong></a>, a curated dataset containing approximately 300 lists of ingredients manually corrected.</p><p id="3c75" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This benchmark is the <strong class="ne fr">cornerstone of the project</strong>. It enables us to evaluate any solution, Machine Learning or simple heuristic, on our use case.</p><p id="a0f9" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">It goes along the <strong class="ne fr">Evaluation algorithm</strong>, a custom solution we developed that transform a set of corrections into measurable metrics.</p><h2 id="7120" class="ql of fq bf oz qm qn qo pc qp qq qr pf nl qs qt qu np qv qw qx nt qy qz ra rb bk">The Evaluation Algorithm</h2><p id="7e88" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk">Most of the existing metrics and evaluation algorithms for text-relative tasks compute the similarity between a reference and a prediction, such as <a class="af ny" href="https://en.wikipedia.org/wiki/BLEU" rel="noopener ugc nofollow" target="_blank">BLEU</a> or <a class="af ny" href="https://en.wikipedia.org/wiki/ROUGE_(metric)" rel="noopener ugc nofollow" target="_blank">ROUGE </a>scores for language translation or summarization.</p><p id="625f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">However, in our case, these metrics fail short.</p><p id="77c5" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We want to evaluate how well the Spellcheck algorithm recognizes and fixes the right words in a list of ingredients. Therefore, we adapt the <strong class="ne fr">Precision</strong> and <strong class="ne fr">Recall</strong> metrics for our task:</p><blockquote class="qi qj qk"><p id="7e1c" class="nc nd qc ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">Precision </strong>= Right corrections by the model / ​Total corrections made by the model</p><p id="f32a" class="nc nd qc ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">Recall </strong>= Right corrections by the model / ​Total number of errors</p></blockquote><p id="4ddf" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">However, we don’t have the fine-grained view of which words were supposed to be corrected… We only have access to:</p><ul class=""><li id="9be8" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pz qa qb bk"><strong class="ne fr">The <em class="qc">original</em>: the list of ingredients as present in the database;</strong></li><li id="36de" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk"><strong class="ne fr">The <em class="qc">reference</em>: how we expect this list to be corrected;</strong></li><li id="ed23" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk"><strong class="ne fr">The <em class="qc">prediction</em>: the correction from the model.</strong></li></ul><blockquote class="qi qj qk"><p id="9874" class="nc nd qc ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Is there any way to calculate the number of errors that were correctly corrected, the ones that were missed by the Spellcheck, and finally the errors that were wrongly corrected?</p></blockquote><p id="b8bb" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The answer is yes!</p><pre class="mm mn mo mp mq oa ob oc bp od bb bk"><span id="240d" class="oe of fq ob b bg og oh l oi oj">Original:       "Th cat si on the fride,"<br/>Reference:      "The cat is on the fridge."<br/>Prediction:     "Th big cat is in the fridge."</span></pre><p id="284c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">With the example above, we can easily spot which words were supposed to be corrected: <code class="cx rc rd re ob b">The</code> , <code class="cx rc rd re ob b">is</code> and <code class="cx rc rd re ob b">fridge</code> ; and which words were wrongly corrected: <code class="cx rc rd re ob b">on</code> into <code class="cx rc rd re ob b">in</code>. Finally, we see that an additional word was added: <code class="cx rc rd re ob b">big</code> .</p><p id="2e6f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">If we align these 3 sequences in pairs, <code class="cx rc rd re ob b">original-reference</code> and <code class="cx rc rd re ob b">original-prediction</code> , we can detect which words were supposed to be corrected, and those that weren’t. This alignment problem is typical in bio-informatic, called <a class="af ny" href="https://en.wikipedia.org/wiki/Sequence_alignment" rel="noopener ugc nofollow" target="_blank">Sequence Alignment</a>, whose purpose is to identify regions of similarity.</p><p id="1875" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This is a perfect analogy for our spellcheck evaluation task.</p><pre class="mm mn mo mp mq oa ob oc bp od bb bk"><span id="f50d" class="oe of fq ob b bg og oh l oi oj">Original:       "Th    -   cat   si   on   the   fride,"<br/>Reference:      "The   -   cat   is   on   the   fridge."<br/>                  1    0    0    1    0    0     1<br/><br/>Original:       "Th    -   cat   si   on   the   fride,"<br/>Prediction:     "Th   big  cat   is   in   the   fridge."<br/>                  0    1    0    1    1    0     1<br/>                FN    FP         TP   FP         TP</span></pre><p id="c784" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">By labeling each pair with a <code class="cx rc rd re ob b">0</code> or <code class="cx rc rd re ob b">1</code> whether the word changed or not, we can calculate how often the model correctly fixes mistakes <strong class="ne fr">(True Positives — TP)</strong>, incorrectly changes correct words <strong class="ne fr">(False Positives — FP)</strong>, and misses errors that should have been corrected <strong class="ne fr">(False Negatives — FN).</strong></p><p id="af86" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">In other words, we can calculate the <strong class="ne fr">Precision </strong>and <strong class="ne fr">Recall </strong>of the Spellcheck!</p><p id="09d6" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We now have a robust algorithm that is capable of evaluating any Spellcheck solution!</p><p id="55ca" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">You can find the algorithm in the <a class="af ny" href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/spellcheck/src/spellcheck/evaluation/evaluator.py" rel="noopener ugc nofollow" target="_blank">project repository</a>.</p><h1 id="bd5c" class="oy of fq bf oz pa pb gq pc pd pe gt pf pg ph pi pj pk pl pm pn po pp pq pr ps bk">Large Language Models</h1><p id="a8e1" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk">Large Language Models (LLMs) have proved being great help in tackling Natural Language task in various industries.</p><p id="3cf8" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">They constitute a path we have to explore for our use case.</p><blockquote class="qi qj qk"><p id="4ca5" class="nc nd qc ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Many LLM providers brag about the performance of their model on leaderboards, but how do they perform on correcting error in lists of ingredients? Thus, we evaluated them!</p></blockquote><p id="b7eb" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We evaluated <strong class="ne fr">GPT-3.5 </strong>and <strong class="ne fr">GPT-4o </strong>from <strong class="ne fr">OpenAI</strong>, <strong class="ne fr">Claude-Sonnet-3.5 </strong>from <strong class="ne fr">Anthropic</strong>, and <strong class="ne fr">Gemini-1.5-Flash</strong> from <strong class="ne fr">Google </strong>using our custom benchmark and evaluation algorithm.</p><p id="f4ff" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We prompted detailed instructions to orient the corrections towards our custom guidelines.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rf"><img src="../Images/83eadd9bceeee0e567b618410e3800c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gS97vKb5scseuWGdu4k57Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">LLMs evaluation on our benchmark (image from author)</figcaption></figure><p id="a4db" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">GPT-3.5-Turbo</strong> delivered the best performance compared to other models, both in terms of metrics and manual review. Special mention goes to <strong class="ne fr">Claude-Sonnet-3.5</strong>, which showed impressive error corrections (high Recall), but often provided additional irrelevant explanations, lowering its Precision.</p><p id="6e12" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Great! We have an LLM that works! Time to create the feature in the app!</p><p id="9d60" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr"><em class="qc">Well,</em></strong> not so fast…</p><p id="74e9" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Using private LLMs reveals many challenges:</p><ol class=""><li id="d209" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx rg qa qb bk"><strong class="ne fr">Lack of Ownership</strong>: We become dependent on the providers and their models. New model versions are released frequently, altering the model’s behavior. This instability, primarily because the model is designed for general purposes rather than our specific task, complicates long-term maintenance.</li><li id="9f4a" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx rg qa qb bk"><strong class="ne fr">Model Deletion Risk</strong>: We have no safeguards against providers removing older models. For instance, GPT-3.5 is slowly being replace by more performant models, despite being the best model for this task!</li><li id="1835" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx rg qa qb bk"><strong class="ne fr">Performance Limitations</strong>: The performance of a private LLM is constrained by its prompts. In other words, our only way of improving outputs is through better prompts since we cannot modify the core weights of the model by training it on our own data.</li></ol><p id="bb30" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr"><em class="qc">For these reasons, we chose to focus our efforts on open-source solutions that would provide us with complete control and outperform general LLMs.</em></strong></p><h1 id="97bc" class="oy of fq bf oz pa pb gq pc pd pe gt pf pg ph pi pj pk pl pm pn po pp pq pr ps bk">Train our own model</h1><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk rh"><img src="../Images/bb3dbfab4d007c69b8ac90063f64f12f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*01OI_L5U0UkasdviWDOPxg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">The model training workflow: from dataset extraction to model training (image from author)</figcaption></figure><p id="ff27" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Any machine learning solution starts with data. In our case, data is the corrected lists of ingredients.</p><p id="e235" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">However, not all lists of ingredients are equal. Some are free of unrecognized ingredients, some are just so unreadable they would be no point correcting them.</p><p id="021a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Therefore, we find a perfect balance by choosing lists of ingredients having between<strong class="ne fr"> 10 and 40 percent of unrecognized ingredients</strong>. We also ensured there’s no duplicate within the dataset, but also with the benchmark to prevent any data leakage during the evaluation stage.</p><p id="9097" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We extracted 6000 uncorrected lists from the Open Food Facts database using <a class="af ny" href="https://duckdb.org/" rel="noopener ugc nofollow" target="_blank">DuckDB</a>, a fast in-process SQL tool capable of processing millions of rows under the second.</p><p id="0b79" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">However, those extracted lists are not corrected yet, and manually annotating them would take too much time and resources…</p><p id="c96c" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">However, we have access to LLMs we already evaluated on the exact task. Therefore, we prompted GPT-3.5-Turbo, the best model on our benchmark, to correct every list in respect of our guidelines.</strong></p><p id="3d69" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The process took less than an hour and cost nearly <strong class="ne fr">2$</strong>.</p><p id="0e22" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We then manually reviewed the dataset using <a class="af ny" href="https://argilla.io/" rel="noopener ugc nofollow" target="_blank">Argilla</a>, an open-source annotation tool specialized in Natural Language Processing tasks. This process ensures the dataset is of sufficient quality to train a reliable model.</p><p id="5858" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">We now have at our disposal a </strong><a class="af ny" href="https://huggingface.co/datasets/openfoodfacts/spellcheck-dataset" rel="noopener ugc nofollow" target="_blank"><strong class="ne fr">training dataset</strong></a><strong class="ne fr"> and an </strong><a class="af ny" href="https://huggingface.co/datasets/openfoodfacts/spellcheck-benchmark" rel="noopener ugc nofollow" target="_blank"><strong class="ne fr">evaluation benchmark</strong></a><strong class="ne fr"> to train our own model on the Spellcheck task.</strong></p><h2 id="968e" class="ql of fq bf oz qm qn qo pc qp qq qr pf nl qs qt qu np qv qw qx nt qy qz ra rb bk">Training</h2><p id="62b2" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk">For this stage, we decided to go with <strong class="ne fr">Sequence-to-Sequence Language Models</strong>. In other words, these models take a text as input and returns a text as output, which suits the spellcheck process.</p><p id="0ba2" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Several models fit this role, such as the <strong class="ne fr">T5 family</strong> developed by Google in 2020, or the current open-source LLMs such as <strong class="ne fr">Llama</strong> or <strong class="ne fr">Mistral</strong>, which are designed for text generation and following instructions.</p><p id="7485" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The model training consists in a succession of steps, each one requiring different resources allocations, such as cloud GPUs, data validation and logging. For this reason, we decided to orchestrate the training using <a class="af ny" href="https://metaflow.org/" rel="noopener ugc nofollow" target="_blank">Metaflow</a>, a pipeline orchestrator designed for Data science and Machine Learning projects.</p><p id="d083" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The training pipeline is composed as follow:</p><ul class=""><li id="1cf8" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pz qa qb bk">Configurations and hyperparameters are imported to the pipeline from config yaml files;</li><li id="2018" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk">The training job is launched in the cloud using <a class="af ny" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank">AWS Sagemaker</a>, along the set of model hyperparameters and the custom modules such as the evaluation algorithm. Once the job is done, the model artifact is stored in an AWS S3 bucket. All training details are tracked using <a class="af ny" href="https://www.comet.com/site/" rel="noopener ugc nofollow" target="_blank">Comet ML</a>;</li><li id="0c71" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk">The fine-tuned model is then evaluated on the <strong class="ne fr">benchmark </strong>using the evaluation algorithm. Depending on the model sizem this process can be extremely long. Therefore, we used <a class="af ny" href="https://github.com/vllm-project/vllm" rel="noopener ugc nofollow" target="_blank">vLLM</a>, a Python library designed to accelerates LLM inferences;</li><li id="83c7" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk">The predictions against the benchmark, also stored in AWS S3, are sent to <a class="af ny" href="https://argilla.io/" rel="noopener ugc nofollow" target="_blank">Argilla</a> for human-evaluation.</li></ul><p id="189a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">After iterating over and over between refining the data and the model training, we achieved performance <strong class="ne fr">comparable to proprietary LLMs </strong>on the Spellcheck task, scoring an F1-Score of <strong class="ne fr">0.65</strong>.</p></div></div><div class="mr"><div class="ab cb"><div class="lm ok ln ol lo om cf on cg oo ci bh"><div class="mm mn mo mp mq ab ke"><figure class="lb mr ri oq or os ot paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><img src="../Images/7fdb68e96e8e460f5871149e4f6a61df.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*fdGAj-K2IiQVgPP6zMYzCg.png"/></div></figure><figure class="lb mr rj oq or os ot paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><img src="../Images/407f381cc9c76a371fa2ee8a89f453ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*m_EdG5UeBREYmKrVSr14pQ.png"/></div><figcaption class="mx my mz mj mk na nb bf b bg z dx rk ed rl ox">LLMs evaluation on our benchmark (image from author)</figcaption></figure></div></div></div></div><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="f545" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The model, a fine-tuned <a class="af ny" href="https://huggingface.co/mistralai/Mistral-7B-v0.3" rel="noopener ugc nofollow" target="_blank">Mistral-7B-Base-v0.3</a>, is available on the Hugging Face platform and is publicly available, along its <a class="af ny" href="https://huggingface.co/datasets/openfoodfacts/spellcheck-dataset" rel="noopener ugc nofollow" target="_blank">dataset</a> and evaluation <a class="af ny" href="https://huggingface.co/datasets/openfoodfacts/spellcheck-benchmark" rel="noopener ugc nofollow" target="_blank">benchmark</a>.</p><div class="rm rn ro rp rq rr"><a href="https://huggingface.co/openfoodfacts/spellcheck-mistral-7b?source=post_page-----d74dfe02e0e4--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="rs ab ig"><div class="rt ab co cb ru rv"><h2 class="bf fr hw z io rw iq ir rx it iv fp bk">openfoodfacts/spellcheck-mistral-7b · Hugging Face</h2><div class="ry l"><h3 class="bf b hw z io rw iq ir rx it iv dx">We're on a journey to advance and democratize artificial intelligence through open source and open science.</h3></div><div class="rz l"><p class="bf b dy z io rw iq ir rx it iv dx">huggingface.co</p></div></div><div class="sa l"><div class="sb l sc sd se sa sf lr rr"/></div></div></a></div><p id="ed2d" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Furthermore, <strong class="ne fr">we estimated the Spellcheck reduced the number of unrecognized ingredients by 11%, which is promising!</strong></p><p id="9159" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Now comes the final phase of the project: integrating the model into Open Food Facts.</p><h1 id="7d77" class="oy of fq bf oz pa pb gq pc pd pe gt pf pg ph pi pj pk pl pm pn po pp pq pr ps bk">Deployment &amp; Integration</h1><p id="70f5" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk"><strong class="ne fr">Our model is big!</strong></p><p id="0bfa" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">7 billions parameters, which means <strong class="ne fr">14 GB </strong>of memory required to run it in <strong class="ne fr">float16</strong>, without considering the <strong class="ne fr">20% overhead factor.</strong></p><p id="8558" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Additionally, large models often mean <strong class="ne fr">low throughput during inference</strong>, which can make them inappropriate for real-time serving. We need GPUs with large memory to run this model in production, such as the <a class="af ny" href="https://www.nvidia.com/en-us/data-center/l4/" rel="noopener ugc nofollow" target="_blank">Nvidia L4</a>, which is equipped with 24GB of VRAM.</p><p id="eb57" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk"><strong class="ne fr">But the price of running these instances in the cloud is quite expensive…</strong></p><p id="8d70" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">However, a possibility to provide a real-time experience for our users, without requiring GPU instances running 24/7, is <strong class="ne fr">batch inference</strong>.</p><p id="812e" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Lists of ingredients are processed in batches by the model on a regular basis, then stored in the database. <strong class="ne fr">This way, we pay only for the resources used during the batch processing!</strong></p><h2 id="f10c" class="ql of fq bf oz qm qn qo pc qp qq qr pf nl qs qt qu np qv qw qx nt qy qz ra rb bk">Batch Job</h2><p id="c0d7" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk">We developed a batch processing system to handle large-scale text processing using LLMs efficiently with <a class="af ny" href="https://cloud.google.com/batch/docs/get-started" rel="noopener ugc nofollow" target="_blank">Google Batch Job</a>.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk sg"><img src="../Images/e0c7d92fc5854b223efc5af25ed260ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nevKLqwBo6wmAOQz"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Batch processing system (image from author)</figcaption></figure><p id="6fed" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The process begins by extracting data from the Open Food Facts database using DuckDB, which processes <strong class="ne fr">43 GB of data in under 2 minutes!</strong></p><p id="e3a0" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The extracted data is then sent to a Google Bucket, triggering a Google Batch Job.</p><p id="2f2d" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This job uses a pre-prepared Docker image containing all necessary dependencies and algorithms. To optimize the resource-intensive LLM processing, we reuse vLLM achieving impressive performances, <strong class="ne fr">correcting 10,000 lists of ingredients in 20 minutes only with a GPU L4</strong>!</p><p id="864f" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">After successful processing, the corrected data is saved in a intermediate database containing the predictions of all models in Open Food Facts, served by <a class="af ny" href="https://github.com/openfoodfacts/robotoff" rel="noopener ugc nofollow" target="_blank">Robotoff</a>.</p><p id="c5ba" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">When a contributor modifies a product details, they’re presented with the spellcheck corrections, <strong class="ne fr">ensuring users remain the key decision-makers in Open Food Facts’ data quality process.</strong></p><p id="1a42" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">This system allows Open Food Facts to leverage advanced AI capabilities for improving data quality while preserving its community-driven approach.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk sh"><img src="../Images/d73441d66e04c9ab650600565b6475d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5o9gFYzHlgBTnutt1MnE1g.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Batch jobs in GCP (image from author)</figcaption></figure><h1 id="abae" class="oy of fq bf oz pa pb gq pc pd pe gt pf pg ph pi pj pk pl pm pn po pp pq pr ps bk">Conlusion</h1><p id="51dd" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk">In this article, we walked you through the development and the integration of the<strong class="ne fr"> Ingredients Spellcheck</strong>, an LLM-powered up feature to correct OCR-extracted lists of ingredients.</p><p id="c651" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We first developed a set of rules, the <strong class="ne fr">Spellcheck Guidelines</strong>, to restrict the corrections . We created a benchmark of corrected lists of ingredients that, along a custom evaluation algorithm, to evaluate any solution to the problem.</p><p id="1dc0" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">With this setup, we evaluated various private LLMs and determined that <strong class="ne fr">GPT-3.5-Turbo</strong> was the most suitable model for our specific use case. However, we also demonstrated that relying on a private LLM imposes significant limitations, including lack of ownership and restricted opportunities to improve or fine-tune such a large model (175 billion parameters).</p><p id="d922" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">To address these challenges, we decided to <strong class="ne fr">develop our own model</strong>, fine-tuning it on synthetically corrected texts extracted from the database. After several iterations and experiments, we successfully achieved good performances with an <strong class="ne fr">open-source model</strong>. Not only did we match private LLMs performance, it also solved the ownership problem we were facing, giving us full control over our model.</p><p id="7d25" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We then <strong class="ne fr">integrated this model into the Open Food Facts </strong>using <strong class="ne fr">batch inference deployment, </strong>enabling us to process thousands of lists on a regular basis. The predictions are stored in Robotoff database as <strong class="ne fr">Insights </strong>before being validated by contributors, <strong class="ne fr">leaving OFF data quality ownership to contributors</strong>.</p><h1 id="2dd2" class="oy of fq bf oz pa pb gq pc pd pe gt pf pg ph pi pj pk pl pm pn po pp pq pr ps bk">Next step</h1><p id="2265" class="pw-post-body-paragraph nc nd fq ne b go pt ng nh gr pu nj nk nl pv nn no np pw nr ns nt px nv nw nx fj bk"><strong class="ne fr">The Spellcheck integration is still a work in progress</strong>. We are working on designing the user interface to propose ML generated corrections and let contributors accept, deny, or modify corrections. <strong class="ne fr">We expect fully integrating the feature by the end of the year.</strong></p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk si"><img src="../Images/4873fa37ebe6d27a18074cf083f3e87d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCG8KVAH_jLmapejAprfRQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Spellcheck corrections validated by users built in <a class="af ny" href="https://huggingface.co/spaces/openfoodfacts/ingredients-spellcheck-annotate" rel="noopener ugc nofollow" target="_blank">Hugging Face Space</a></figcaption></figure><p id="a414" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Additionally, we plan to continue refining the model through iterative improvements. Its performance can be significantly enhanced by improving the quality of the training data and incorporating user feedback. This approach will allow us to fine-tune the model continuously, ensuring it remains highly effective and aligned with real-world use cases.</p><p id="66db" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">The model, along its datasets, can be find in the official <a class="af ny" href="https://huggingface.co/openfoodfacts" rel="noopener ugc nofollow" target="_blank">Hugging Face repository</a>. The code used to developped this model is available in the <a class="af ny" href="https://github.com/openfoodfacts/openfoodfacts-ai/tree/develop/spellcheck" rel="noopener ugc nofollow" target="_blank">OpenFoodFacts-ai/spellcheck</a> Github repository.</p></div></div></div><div class="ab cb sj sk sl sm" role="separator"><span class="sn by bm so sp sq"/><span class="sn by bm so sp sq"/><span class="sn by bm so sp"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="665a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Thank you for reading that far! We hope you enjoyed the reading.</p><p id="c3ed" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">If you too, you want to contribute to Open Food Facts, you can:</p><ul class=""><li id="f503" class="nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx pz qa qb bk">Contribute to the Open Food Facts <a class="af ny" href="https://github.com/openfoodfacts" rel="noopener ugc nofollow" target="_blank">GitHub</a>: explore open issues that align with your skills,</li><li id="b530" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk">Download the Open Food Facts <a class="af ny" href="https://world.openfoodfacts.org/open-food-facts-mobile-app?utm_source=off&amp;utf_medium=web&amp;utm_campaign=search_and_links_promo_en" rel="noopener ugc nofollow" target="_blank">mobile app</a>: add new products to the database or improve existing ones by simply scanning their barcodes,</li><li id="5793" class="nc nd fq ne b go qd ng nh gr qe nj nk nl qf nn no np qg nr ns nt qh nv nw nx pz qa qb bk">Join the Open Food Facts <a class="af ny" href="https://slack.openfoodfacts.org/" rel="noopener ugc nofollow" target="_blank">Slack</a> and start discussing with other contributors in the OFF community.</li></ul><p id="f84a" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">We can’t wait to see you join the community!</p></div></div></div><div class="ab cb sj sk sl sm" role="separator"><span class="sn by bm so sp sq"/><span class="sn by bm so sp sq"/><span class="sn by bm so sp"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="06ed" class="pw-post-body-paragraph nc nd fq ne b go nf ng nh gr ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx fj bk">Don’t hesitate to check our other articles:</p><div class="rm rn ro rp rq rr"><a href="https://medium.com/@jeremyarancio/duckdb-open-food-facts-the-largest-open-food-database-in-the-palm-of-your-hand-0d4ab30d0701?source=post_page-----d74dfe02e0e4--------------------------------" rel="noopener follow" target="_blank"><div class="rs ab ig"><div class="rt ab co cb ru rv"><h2 class="bf fr hw z io rw iq ir rx it iv fp bk">DuckDB &amp; Open Food Facts: the largest open food database in the palm of your hand 🦆🍊</h2><div class="ry l"><h3 class="bf b hw z io rw iq ir rx it iv dx">Exploit the power of DuckDB to explore the largest open database in the food market.</h3></div><div class="rz l"><p class="bf b dy z io rw iq ir rx it iv dx">medium.com</p></div></div><div class="sa l"><div class="sr l sc sd se sa sf lr rr"/></div></div></a></div></div></div></div></div>    
</body>
</html>