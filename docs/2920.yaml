- en: 'PostgreSQL: Query Optimization for Mere Humans'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: PostgreSQLï¼šä»…ä¸ºæ™®é€šäººä¼˜åŒ–æŸ¥è¯¢
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/query-optimization-for-mere-humans-in-postgresql-875ab864390a?source=collection_archive---------4-----------------------#2024-12-03](https://towardsdatascience.com/query-optimization-for-mere-humans-in-postgresql-875ab864390a?source=collection_archive---------4-----------------------#2024-12-03)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/query-optimization-for-mere-humans-in-postgresql-875ab864390a?source=collection_archive---------4-----------------------#2024-12-03](https://towardsdatascience.com/query-optimization-for-mere-humans-in-postgresql-875ab864390a?source=collection_archive---------4-----------------------#2024-12-03)
- en: Understanding a PostgreSQL execution plan with practical examples
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç†è§£ PostgreSQL æ‰§è¡Œè®¡åˆ’å¹¶é€šè¿‡å®é™…ç¤ºä¾‹è®²è§£
- en: '[](https://medium.com/@Eyaltra?source=post_page---byline--875ab864390a--------------------------------)[![Eyal
    Trabelsi](../Images/60562caa76b824eac9e21f1c0a2933fc.png)](https://medium.com/@Eyaltra?source=post_page---byline--875ab864390a--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--875ab864390a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--875ab864390a--------------------------------)
    [Eyal Trabelsi](https://medium.com/@Eyaltra?source=post_page---byline--875ab864390a--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@Eyaltra?source=post_page---byline--875ab864390a--------------------------------)[![Eyal
    Trabelsi](../Images/60562caa76b824eac9e21f1c0a2933fc.png)](https://medium.com/@Eyaltra?source=post_page---byline--875ab864390a--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--875ab864390a--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--875ab864390a--------------------------------)
    [Eyal Trabelsi](https://medium.com/@Eyaltra?source=post_page---byline--875ab864390a--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--875ab864390a--------------------------------)
    Â·8 min readÂ·Dec 3, 2024
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘å¸ƒäº [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--875ab864390a--------------------------------)
    Â·é˜…è¯»æ—¶é—´ 8 åˆ†é’Ÿ Â·2024å¹´12æœˆ3æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/4f384f53a80ad0fe12427dcc5b83524a.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/4f384f53a80ad0fe12427dcc5b83524a.png)'
- en: Photo by [Greg Rakozy](https://unsplash.com/@grakozy?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
    on [Unsplash](https://unsplash.com/photos/silhouette-photography-of-person-oMpAz-DN-9I?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾ç‰‡æ¥æºï¼š[Greg Rakozy](https://unsplash.com/@grakozy?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
    äº [Unsplash](https://unsplash.com/photos/silhouette-photography-of-person-oMpAz-DN-9I?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash)
- en: Today, users have high expectations for the programs they use. Users expect
    programs to have amazing features, to be fast, and to consume a reasonable amount
    of resources.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚ä»Šï¼Œç”¨æˆ·å¯¹æ‰€ä½¿ç”¨çš„ç¨‹åºæœ‰å¾ˆé«˜çš„æœŸæœ›ã€‚ç”¨æˆ·å¸Œæœ›ç¨‹åºå…·å¤‡æƒŠäººçš„åŠŸèƒ½ï¼Œé€Ÿåº¦å¿«ï¼Œå¹¶ä¸”åˆç†åœ°æ¶ˆè€—èµ„æºã€‚
- en: As developers, we should thrive to give our users the best experience possible.
    Itâ€™s pretty common that the database becomes the bottleneck, and optimizing queries
    and eliminating the bottlenecks is not an easy task. Unfortunately, as programs
    become more and more complex, and as the data become bigger, it becomes harder
    to write flawless SQL queries.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬åº”è¯¥åŠªåŠ›ä¸ºç”¨æˆ·æä¾›æœ€ä½³çš„ä½“éªŒã€‚æ•°æ®åº“æˆä¸ºç“¶é¢ˆæ˜¯å¾ˆå¸¸è§çš„æƒ…å†µï¼Œä¼˜åŒ–æŸ¥è¯¢å¹¶æ¶ˆé™¤ç“¶é¢ˆå¹¶éæ˜“äº‹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œéšç€ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæ•°æ®é‡ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œç¼–å†™å®Œç¾çš„
    SQL æŸ¥è¯¢å˜å¾—æ„ˆåŠ å›°éš¾ã€‚
- en: Today, I am going to focus on a technique to find those bottlenecks, using the
    *Explain* clause. My goal today is to show you that finding and eliminating those
    bottlenecks is not rocket science. Everyone can find their bottlenecks without
    breaking a sweat.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: ä»Šå¤©ï¼Œæˆ‘å°†é‡ç‚¹ä»‹ç»ä¸€ç§é€šè¿‡ä½¿ç”¨ *Explain* å­å¥æ¥æ‰¾åˆ°ç“¶é¢ˆçš„æŠ€æœ¯ã€‚ä»Šå¤©çš„ç›®æ ‡æ˜¯å‘ä½ å±•ç¤ºï¼Œæ‰¾åˆ°å¹¶æ¶ˆé™¤è¿™äº›ç“¶é¢ˆå¹¶ééš¾äº‹ï¼Œä»»ä½•äººéƒ½å¯ä»¥è½»æ¾å‘ç°ç“¶é¢ˆæ‰€åœ¨ã€‚
- en: The code for this article can be found on [GitHub](https://github.com/eyaltrabelsi/my-notebooks/blob/master/Lectures/query_optimization_for_mere_humans/Query%20Optimization%20for%20Mere%20Humans.ipynb).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æ–‡çš„ä»£ç å¯ä»¥åœ¨ [GitHub](https://github.com/eyaltrabelsi/my-notebooks/blob/master/Lectures/query_optimization_for_mere_humans/Query%20Optimization%20for%20Mere%20Humans.ipynb)
    ä¸Šæ‰¾åˆ°ã€‚
- en: 'Note: All images, unless otherwise noted, are by the author.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨ï¼šæ‰€æœ‰å›¾ç‰‡ï¼Œé™¤éå¦æœ‰è¯´æ˜ï¼Œå‡ç”±ä½œè€…æä¾›ã€‚
- en: Letâ€™s explain Explain ğŸ“œ
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬è§£é‡Šä¸€ä¸‹ Explain ğŸ“œ
- en: Interactions with databases are done using declarative languages, where SQL
    is the most common one. The database decides how and what to do behind the scenes
    and the only glimpse it provides is the execution plan.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸æ•°æ®åº“çš„äº¤äº’æ˜¯é€šè¿‡å£°æ˜å¼è¯­è¨€è¿›è¡Œçš„ï¼Œå…¶ä¸­ SQL æ˜¯æœ€å¸¸ç”¨çš„è¯­è¨€ã€‚æ•°æ®åº“å†³å®šäº†èƒŒåå¦‚ä½•ä»¥åŠåšä»€ä¹ˆï¼Œå”¯ä¸€æä¾›çš„è§†è§’æ˜¯æ‰§è¡Œè®¡åˆ’ã€‚
- en: This limitation makes implementing proper debugging tools, and profilers almost
    impossible in practice. **So we are kind of stuck with execution plans.**
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§é™åˆ¶ä½¿å¾—åœ¨å®è·µä¸­å®ç°åˆé€‚çš„è°ƒè¯•å·¥å…·å’Œæ€§èƒ½åˆ†æå™¨å‡ ä¹ä¸å¯èƒ½ã€‚**æ‰€ä»¥æˆ‘ä»¬åœ¨æ‰§è¡Œè®¡åˆ’ä¸Šæœ‰ç‚¹å›°ä½äº†ã€‚**
- en: Buzzword alert ğŸ!! my goal is to democratize execution plans.
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è¡Œä¸šæœ¯è¯­è­¦å‘Š ğŸï¼ï¼æˆ‘çš„ç›®æ ‡æ˜¯è®©æ‰§è¡Œè®¡åˆ’å¤§ä¼—åŒ–ã€‚
- en: 'In PostgreSQL in order to get the execution plan one should use *Explain*/*Explain
    analyze* clauses:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ PostgreSQL ä¸­ï¼Œè¦è·å–æ‰§è¡Œè®¡åˆ’ï¼Œåº”è¯¥ä½¿ç”¨ *Explain*/*Explain analyze* å­å¥ï¼š
- en: '*EXPLAIN* shows what the planner planned to do.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*EXPLAIN* æ˜¾ç¤ºäº†è®¡åˆ’è€…æ‰“ç®—åšä»€ä¹ˆã€‚'
- en: '*EXPLAIN ANALYZE* what the planner plans to do, **execute the query,** and
    also show how it did it.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*EXPLAIN ANALYZE* æ˜¾ç¤ºè®¡åˆ’æ‰§è¡Œè€…çš„è®¡åˆ’ï¼Œ**æ‰§è¡ŒæŸ¥è¯¢ï¼Œ** å¹¶å±•ç¤ºå®ƒæ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚'
- en: '**Pro Tip #1**ğŸ’ƒ: go over an execution plan at least once in your career. It''s
    similar across databases, and it is a rare skill in companies.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“å®¶æç¤º #1**ğŸ’ƒï¼šåœ¨ä½ çš„èŒä¸šç”Ÿæ¶¯ä¸­è‡³å°‘çœ‹ä¸€æ¬¡æ‰§è¡Œè®¡åˆ’ã€‚è¿™åœ¨ä¸åŒçš„æ•°æ®åº“ä¸­ç±»ä¼¼ï¼Œè€Œä¸”åœ¨å…¬å¸ä¸­æ˜¯ä¸€ä¸ªç¨€ç¼ºçš„æŠ€èƒ½ã€‚'
- en: '**Pro Tip #2** ğŸ’ƒ: prefer *EXPLAIN ANALYZE* as it holds more information for
    most cases.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“å®¶æç¤º #2** ğŸ’ƒï¼šæ›´å€¾å‘äºä½¿ç”¨ *EXPLAIN ANALYZE*ï¼Œå› ä¸ºå®ƒåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹åŒ…å«æ›´å¤šä¿¡æ¯ã€‚'
- en: '**Warning #1** âš ï¸ donâ€™t use *EXPLAIN ANALYZE* on destructive operations like
    *DELETE/UPDATE, EXPLAIN* will suffice and it doesnâ€™t run the query.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '**è­¦å‘Š #1** âš ï¸ ä¸è¦åœ¨åƒ *DELETE/UPDATE* è¿™æ ·çš„ç ´åæ€§æ“ä½œä¸Šä½¿ç”¨ *EXPLAIN ANALYZE*ï¼Œ*EXPLAIN* å°±è¶³å¤Ÿäº†ï¼Œå®ƒä¸ä¼šæ‰§è¡ŒæŸ¥è¯¢ã€‚'
- en: '**Warning #2** âš ï¸ donâ€™t use *EXPLAIN ANALYZE* when resources are scarce like
    production monitoring, and when a query never finishes*, EXPLAIN* will suffice
    and it doesnâ€™t run the query.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**è­¦å‘Š #2** âš ï¸ å½“èµ„æºç´§å¼ æ—¶ï¼ˆä¾‹å¦‚ç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼‰ï¼Œä¸è¦ä½¿ç”¨ *EXPLAIN ANALYZE*ï¼Œå¦‚æœæŸ¥è¯¢æ°¸è¿œä¸ä¼šå®Œæˆï¼Œ*EXPLAIN* å°±è¶³å¤Ÿäº†ï¼Œå®ƒä¸ä¼šæ‰§è¡ŒæŸ¥è¯¢ã€‚'
- en: '*Explain* is an awesome tool as it can imply reasons why a query was slow including:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '*Explain* æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œå› ä¸ºå®ƒå¯ä»¥è§£é‡ŠæŸ¥è¯¢æ…¢çš„åŸå› ï¼ŒåŒ…æ‹¬ï¼š'
- en: Missing/Overused indices/partitions.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç¼ºå¤±/è¿‡åº¦ä½¿ç”¨çš„ç´¢å¼•/åˆ†åŒºã€‚
- en: Unoptimized database configurations.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æœªä¼˜åŒ–çš„æ•°æ®åº“é…ç½®ã€‚
- en: Redundant Operations.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å†—ä½™æ“ä½œã€‚
- en: Stale statistics.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¿‡æ—¶çš„ç»Ÿè®¡ä¿¡æ¯ã€‚
- en: Too much I/O.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¿‡å¤šçš„ I/O æ“ä½œã€‚
- en: 'For the more thorough people you can see the *Explain* clause syntax in the
    next figure:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºæ›´ç»†è‡´çš„äººï¼Œä½ å¯ä»¥åœ¨ä¸‹å›¾ä¸­çœ‹åˆ° *Explain* å­å¥çš„è¯­æ³•ï¼š
- en: '![](../Images/61acb4497b1c5ad8f1db4fcd7a3597b8.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/61acb4497b1c5ad8f1db4fcd7a3597b8.png)'
- en: PostgreSQL Explain Clause Syntax
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: PostgreSQL Explain å­å¥è¯­æ³•ã€‚
- en: Understanding Explain AnatomyğŸ«€
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç†è§£ Explain è§£å‰–å­¦ğŸ«€
- en: 'We will use it as an example of a simple query: we want to count the number
    of users that donâ€™t have Twitter handles.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ç”¨å®ƒä½œä¸ºä¸€ä¸ªç®€å•æŸ¥è¯¢çš„ç¤ºä¾‹ï¼šæˆ‘ä»¬æƒ³è®¡ç®—æ²¡æœ‰ Twitter å¥æŸ„çš„ç”¨æˆ·æ•°é‡ã€‚
- en: '[PRE0]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![](../Images/9a8f28ed38a9fe982ff8f92ce75497f5.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/9a8f28ed38a9fe982ff8f92ce75497f5.png)'
- en: We can see the execution plan returned from the EXPLAIN ANALYZE clause
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä» EXPLAIN ANALYZE å­å¥è¿”å›çš„æ‰§è¡Œè®¡åˆ’ã€‚
- en: It looks cryptic at first, and Itâ€™s even longer than our query, and that on
    a small example of real-world execution plans can be overwhelming if you don't
    focus ğŸ˜­.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: èµ·åˆå®ƒçœ‹èµ·æ¥å¾ˆç¥ç§˜ï¼Œè€Œä¸”æ¯”æˆ‘ä»¬çš„æŸ¥è¯¢è¿˜é•¿ï¼Œç”šè‡³åœ¨ä¸€ä¸ªå°çš„å®é™…æ‰§è¡Œè®¡åˆ’ç¤ºä¾‹ä¸­ï¼Œå¦‚æœä¸é›†ä¸­æ³¨æ„åŠ›ï¼Œå®ƒä¼šè®©äººæ„Ÿåˆ°å‹å€’ã€‚
- en: '**But it does provide useful information.** We can see that the query execution
    took 1.27 seconds, while the query planning took only 0.4 milli-seconds (negligible
    time).'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä½†å®ƒç¡®å®æä¾›äº†æœ‰ç”¨çš„ä¿¡æ¯ã€‚** æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŸ¥è¯¢æ‰§è¡ŒèŠ±è´¹äº†1.27ç§’ï¼Œè€ŒæŸ¥è¯¢è®¡åˆ’åªèŠ±è´¹äº†0.4æ¯«ç§’ï¼ˆå¯å¿½ç•¥çš„æ—¶é—´ï¼‰ã€‚'
- en: '![](../Images/d5e57f45b5c3501eb7d865b1efe9c8d4.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/d5e57f45b5c3501eb7d865b1efe9c8d4.png)'
- en: We can see the time the query planning and execution took
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŸ¥è¯¢è®¡åˆ’å’Œæ‰§è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚
- en: The execution plan is structured as an inverse tree. In the next figure, you
    can see the execution plan is divided into different nodes each one of which represents
    a different operation whether it's an *Aggregation* or a *Scan.*
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰§è¡Œè®¡åˆ’çš„ç»“æ„æ˜¯ä¸€ä¸ªåå‘æ ‘ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æ‰§è¡Œè®¡åˆ’è¢«åˆ†æˆä¸åŒçš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸åŒçš„æ“ä½œï¼Œä¸ç®¡æ˜¯ *èšåˆ* è¿˜æ˜¯ *æ‰«æ*ã€‚
- en: '![](../Images/6a7ccef3d946eef093a5bca9a3c0c39d.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/6a7ccef3d946eef093a5bca9a3c0c39d.png)'
- en: We can see the time the query planning and execution took
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŸ¥è¯¢è®¡åˆ’å’Œæ‰§è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚
- en: There are many kinds of nodes operations, from Scan related (*â€˜Seq Scanâ€™, â€˜Index
    Only Scanâ€™, etcâ€¦*), Join related( *â€˜Hash Joinâ€™, â€™Nested Loopâ€™, etcâ€¦),* Aggregation
    related *(â€˜GroupAggregateâ€™, â€™Aggregateâ€™, etcâ€¦)* and others *( â€˜Limitâ€™, â€˜Sortâ€™,
    â€˜materializeâ€™, etc..).* **Fortunately you need to remember any of this.**
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰è®¸å¤šç§èŠ‚ç‚¹æ“ä½œï¼Œä»ä¸æ‰«æç›¸å…³çš„ï¼ˆ*â€˜Seq Scanâ€™ï¼Œâ€˜Index Only Scanâ€™ ç­‰ç­‰*ï¼‰ï¼Œä¸è¿æ¥ç›¸å…³çš„ï¼ˆ*â€˜Hash Joinâ€™ï¼Œâ€˜Nested
    Loopâ€™ ç­‰ç­‰*ï¼‰ï¼Œä¸èšåˆç›¸å…³çš„ï¼ˆ*â€˜GroupAggregateâ€™ï¼Œâ€˜Aggregateâ€™ ç­‰ç­‰*ï¼‰ä»¥åŠå…¶ä»–çš„ï¼ˆ*â€˜Limitâ€™ï¼Œâ€˜Sortâ€™ï¼Œâ€˜materializeâ€™
    ç­‰ç­‰*ï¼‰ã€‚**å¹¸è¿çš„æ˜¯ï¼Œä½ ä¸éœ€è¦è®°ä½è¿™äº›ã€‚**
- en: '**Pro Tip #3** ğŸ’ƒ: Focus is key, look only on nodes that are problematic.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“å®¶æç¤º #3** ğŸ’ƒï¼šé›†ä¸­æ³¨æ„åŠ›ï¼Œä¸“æ³¨äºæœ‰é—®é¢˜çš„èŠ‚ç‚¹ã€‚'
- en: '**Pro Tip #4** ğŸ’ƒ: Cheat ! on the problematic nodes search what they mean in
    the [explain glossary](https://www.pgmustard.com/docs/explain).'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“å®¶æç¤º #4** ğŸ’ƒï¼šä½œå¼Šï¼åœ¨æœ‰é—®é¢˜çš„èŠ‚ç‚¹ä¸Šæœç´¢å®ƒä»¬åœ¨ [explain è¯æ±‡è¡¨](https://www.pgmustard.com/docs/explain)
    ä¸­çš„å«ä¹‰ã€‚'
- en: Now, let's drill down into how we know which node is the problematic one.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢è®¨å¦‚ä½•è¯†åˆ«å‡ºé—®é¢˜èŠ‚ç‚¹ã€‚
- en: '![](../Images/5765a24e17bb9ae9361b2481951954f0.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/5765a24e17bb9ae9361b2481951954f0.png)'
- en: There is a lot of information we can see on each node
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­çœ‹åˆ°å¤§é‡ä¿¡æ¯ã€‚
- en: Let's drill down to what those metrics actually mean.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æ·±å…¥äº†è§£è¿™äº›åº¦é‡æŒ‡æ ‡çš„å®é™…å«ä¹‰ã€‚
- en: '**Actual Loops**: the number of loops the same node executed is 1\. To get
    the total time and rows, the actual time and rows need to be multiplied by loops
    values.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å®é™…å¾ªç¯æ•°**ï¼šç›¸åŒèŠ‚ç‚¹æ‰§è¡Œçš„å¾ªç¯æ¬¡æ•°ä¸º 1ã€‚ä¸ºäº†è·å¾—æ€»æ—¶é—´å’Œè¡Œæ•°ï¼Œå®é™…æ—¶é—´å’Œè¡Œæ•°éœ€è¦ä¹˜ä»¥å¾ªç¯æ¬¡æ•°çš„å€¼ã€‚'
- en: '**Actual Rows**: the actual number of produced rows of the *Aggregate* node
    is 1 (per-loop average and we have loops is 1).'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å®é™…è¡Œæ•°**ï¼š*èšåˆ* èŠ‚ç‚¹ç”Ÿæˆçš„å®é™…è¡Œæ•°ä¸º 1ï¼ˆæ¯æ¬¡å¾ªç¯çš„å¹³å‡å€¼ï¼Œå¾ªç¯æ¬¡æ•°ä¸º 1ï¼‰ã€‚'
- en: '**Plan Rows**: the estimated number of produced rows of the *Aggregate* node
    is 1\. The estimated number of rows can be off depending on statistics.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**è®¡åˆ’è¡Œæ•°**ï¼š*èšåˆ* èŠ‚ç‚¹çš„ä¼°ç®—ç”Ÿæˆè¡Œæ•°ä¸º 1ã€‚è¡Œæ•°çš„ä¼°ç®—å€¼å¯èƒ½ä¼šæ ¹æ®ç»Ÿè®¡æ•°æ®æœ‰æ‰€åå·®ã€‚'
- en: '**Actual Startup Time**: the time it took to return the first row in milliseconds
    of the *Aggregate* node is 1271.157 (aggregated and includes previous operations).'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å®é™…å¯åŠ¨æ—¶é—´**ï¼šè¿”å› *èšåˆ* èŠ‚ç‚¹ç¬¬ä¸€è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œä¸º 1271.157ï¼ˆå·²èšåˆå¹¶åŒ…å«ä¹‹å‰çš„æ“ä½œï¼‰ã€‚'
- en: '**Startup Cost**: arbitrary units that represent the estimated time to return
    the first row of the *Aggregate* node is 845110(aggregated and includes previous
    operations).'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å¯åŠ¨æˆæœ¬**ï¼šè¡¨ç¤ºè¿”å› *èšåˆ* èŠ‚ç‚¹ç¬¬ä¸€è¡Œçš„ä¼°ç®—æ—¶é—´çš„ä»»æ„å•ä½ä¸º 845110ï¼ˆå·²èšåˆå¹¶åŒ…å«ä¹‹å‰çš„æ“ä½œï¼‰ã€‚'
- en: '**Actual Total Time**: the time it took to return all the rows in ms of the
    *Aggregate* node is 1271.158 (per-loop average and we have loops is 1 and aggregated
    and include previous operations).'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**å®é™…æ€»æ—¶é—´**ï¼šè¿”å›æ‰€æœ‰è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰åœ¨ *èšåˆ* èŠ‚ç‚¹ä¸­ä¸º 1271.158ï¼ˆæ¯æ¬¡å¾ªç¯çš„å¹³å‡å€¼ï¼Œå¾ªç¯æ¬¡æ•°ä¸º 1ï¼Œå·²èšåˆå¹¶åŒ…å«ä¹‹å‰çš„æ“ä½œï¼‰ã€‚'
- en: '**Total Cost**: arbitrary units that represent the estimated time to return
    all the rows of *Aggregate* node is 845110 (aggregated).'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**æ€»æˆæœ¬**ï¼šè¡¨ç¤ºè¿”å› *èšåˆ* èŠ‚ç‚¹æ‰€æœ‰è¡Œçš„ä¼°ç®—æ—¶é—´çš„ä»»æ„å•ä½ä¸º 845110ï¼ˆå·²èšåˆï¼‰ã€‚'
- en: '**Plan Width**: the estimated average size of rows of the *Aggregate* node
    is 8 bytes.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**è®¡åˆ’å®½åº¦**ï¼š*èšåˆ* èŠ‚ç‚¹çš„ä¼°ç®—è¡Œå¤§å°ä¸º 8 å­—èŠ‚ã€‚'
- en: '**Pro Tip #5** ğŸ’ƒ: be wary of loops, remember to multiply loops when you care
    about *Actual Rows* and *Actual Total Time.*'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“ä¸šå°è´´å£« #5** ğŸ’ƒï¼šæ³¨æ„å¾ªç¯ï¼Œè®°ä½å½“å…³å¿ƒ *å®é™…è¡Œæ•°* å’Œ *å®é™…æ€»æ—¶é—´* æ—¶ï¼Œè¦ä¹˜ä»¥å¾ªç¯æ¬¡æ•°ã€‚'
- en: We will drill in the next section on a practical example.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è®²è§£ä¸€ä¸ªå®é™…çš„ä¾‹å­ã€‚
- en: 'Example: Performance OptimizationğŸ†'
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¤ºä¾‹ï¼šæ€§èƒ½ä¼˜åŒ–ğŸ†
- en: We will use the same query as before.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„æŸ¥è¯¢ã€‚
- en: '[PRE1]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](../Images/c9d940c226ab0b75dc4f477da4b96027.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c9d940c226ab0b75dc4f477da4b96027.png)'
- en: We will focus on the Seq Scan node which has the longest actual time
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†èšç„¦äºå®é™…æ—¶é—´æœ€é•¿çš„ Seq Scan èŠ‚ç‚¹ã€‚
- en: We focus on the longest operation which is the [sequential scan](https://www.pgmustard.com/docs/explain/sequential-scan)
    on the users' table. The scan filters out 2,487,813 rows and takes us 1.27 seconds
    out of 1.271.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬èšç„¦äºæœ€è€—æ—¶çš„æ“ä½œï¼Œå³å¯¹ç”¨æˆ·è¡¨çš„[é¡ºåºæ‰«æ](https://www.pgmustard.com/docs/explain/sequential-scan)ã€‚è¯¥æ‰«æç­›é€‰å‡ºäº†
    2,487,813 è¡Œï¼Œå ç”¨äº† 1.27 ç§’ï¼ˆæ€»æ—¶é—´ä¸º 1.271 ç§’ï¼‰ã€‚
- en: '**But we are mere humans that donâ€™t tell us anything.** Let''s google it (you
    can use ChatGPT as well) !!!.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä½†æˆ‘ä»¬æ¯•ç«Ÿåªæ˜¯äººç±»ï¼Œè¿™å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å¸¦æ¥ä»»ä½•çº¿ç´¢ã€‚**è®©æˆ‘ä»¬ç”¨ Google æœç´¢ä¸€ä¸‹ï¼ˆä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ ChatGPTï¼‰!!!ã€‚'
- en: '![](../Images/e202c10e9f78a7914c4ec6e1224da7c4.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/e202c10e9f78a7914c4ec6e1224da7c4.png)'
- en: Googling how to make seq scan faster in PostgreSQL
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Google ä¸Šæœç´¢å¦‚ä½•åŠ é€Ÿ PostgreSQL ä¸­çš„é¡ºåºæ‰«æã€‚
- en: '[PRE2]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](../Images/2dbebcdb3d427e75d385fb1194604613.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2dbebcdb3d427e75d385fb1194604613.png)'
- en: We are doing much better, but the Scan node is still the longest in terms of
    actual time
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çš„è¡¨ç°å·²ç»å¥½å¤šäº†ï¼Œä½†â€œæ‰«æâ€èŠ‚ç‚¹åœ¨å®é™…æ—¶é—´ä¸Šä»ç„¶æ˜¯æœ€æ…¢çš„ã€‚
- en: We can see that now we perform an [index only scan](https://www.pgmustard.com/docs/explain/index-only-scan)
    on the users' table. It takes us 0.29 seconds instead of 1.27 seconds, which is
    awesome but not enough for us.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨æˆ‘ä»¬åœ¨ç”¨æˆ·è¡¨ä¸Šæ‰§è¡Œçš„æ˜¯[ä»…ç´¢å¼•æ‰«æ](https://www.pgmustard.com/docs/explain/index-only-scan)ã€‚å®ƒåªç”¨äº†
    0.29 ç§’ï¼Œè€Œä¸æ˜¯ 1.27 ç§’ï¼Œè¿™éå¸¸æ£’ï¼Œä½†å¯¹æˆ‘ä»¬æ¥è¯´ä»ç„¶ä¸å¤Ÿã€‚
- en: '**Pro Tip #6**ğŸ’ƒ: optimize your queries one baby step at a time.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“ä¸šå°è´´å£« #6**ğŸ’ƒï¼šä¸€æ­¥ä¸€æ­¥åœ°ä¼˜åŒ–ä½ çš„æŸ¥è¯¢ã€‚'
- en: To understand how much data is passed to the scan. We could use the buffers
    parameter as you can see down below.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: è¦ç†è§£ä¼ é€’ç»™æ‰«æçš„æ•°æ®é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹æ–¹çš„ç¼“å­˜å‚æ•°ã€‚
- en: '**Pro Tip #7**ğŸ’ƒ: When comparing execution plans, look at several metrics.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“ä¸šå°è´´å£« #7**ğŸ’ƒï¼šåœ¨æ¯”è¾ƒæ‰§è¡Œè®¡åˆ’æ—¶ï¼Œå…³æ³¨å¤šä¸ªåº¦é‡æŒ‡æ ‡ã€‚'
- en: '[PRE3]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](../Images/93d19daed446727c8e7c2a33d3a8c6c9.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/93d19daed446727c8e7c2a33d3a8c6c9.png)'
- en: We can see quite a lot of information about how much data hit the cache or disk
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šå…³äºæ•°æ®å‘½ä¸­ç¼“å­˜æˆ–ç£ç›˜çš„ä¿¡æ¯ã€‚
- en: We have 51,854 pages to read all from the cache (400 MB), so improving configurations
    probably wonâ€™t change things drastically.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬æœ‰51,854é¡µéœ€è¦ä»ç¼“å­˜ä¸­è¯»å–ï¼ˆ400 MBï¼‰ï¼Œå› æ­¤æ”¹è¿›é…ç½®å¯èƒ½ä¸ä¼šå¸¦æ¥å‰§çƒˆå˜åŒ–ã€‚
- en: But, we are not out of options. Since the scan filters out 2,487,813 rows, we
    can change the index into a partial index but it doesnâ€™t come for free. It will
    cause writes to take longer, and it will take additional storage, which is quite
    impactful on systems that scale vertically.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†æ˜¯ï¼Œæˆ‘ä»¬å¹¶éæ²¡æœ‰é€‰æ‹©ã€‚ç”±äºæ‰«ææ’é™¤äº†2,487,813è¡Œæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç´¢å¼•æ›´æ”¹ä¸ºéƒ¨åˆ†ç´¢å¼•ï¼Œä½†è¿™å¹¶ä¸æ˜¯å…è´¹çš„ã€‚è¿™ä¼šå¯¼è‡´å†™å…¥æ—¶é—´å˜é•¿ï¼Œå¹¶ä¸”éœ€è¦é¢å¤–çš„å­˜å‚¨ï¼Œè¿™å¯¹å‚ç›´æ‰©å±•çš„ç³»ç»Ÿå½±å“è¾ƒå¤§ã€‚
- en: '**Pro Tip #8** ğŸ’ƒ: there is no free lunch.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“ä¸šæç¤º #8** ğŸ’ƒï¼šä¸–ä¸Šæ²¡æœ‰å…è´¹çš„åˆé¤ã€‚'
- en: Good optimization optionsğŸ¤ğŸ»
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è‰¯å¥½çš„ä¼˜åŒ–é€‰é¡¹ğŸ¤ğŸ»
- en: 'I wonâ€™t delve into too many details as this blog is already quite long. These
    are the first things one might want to tackle when he has slow queries:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä¸ä¼šæ·±å…¥è®²è§£å¤ªå¤šç»†èŠ‚ï¼Œå› ä¸ºè¿™ç¯‡åšå®¢å·²ç»ç›¸å½“é•¿äº†ã€‚è¿™äº›æ˜¯å½“ä½ é‡åˆ°æ…¢æŸ¥è¯¢æ—¶ï¼Œå¯èƒ½é¦–å…ˆéœ€è¦è§£å†³çš„é—®é¢˜ï¼š
- en: Picking the right scan method.
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é€‰æ‹©æ­£ç¡®çš„æ‰«ææ–¹æ³•ã€‚
- en: Picking the right join method.
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é€‰æ‹©æ­£ç¡®çš„è¿æ¥æ–¹æ³•ã€‚
- en: Picking the right join order.
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é€‰æ‹©æ­£ç¡®çš„è¿æ¥é¡ºåºã€‚
- en: Push Filters as soon as possible.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°½æ—©æ¨é€è¿‡æ»¤å™¨ã€‚
- en: Reducing disk IO operations when needed.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åœ¨éœ€è¦æ—¶å‡å°‘ç£ç›˜IOæ“ä½œã€‚
- en: In order to manually check specific optimization one can enable/disable settings.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†æ‰‹åŠ¨æ£€æŸ¥ç‰¹å®šçš„ä¼˜åŒ–ï¼Œå¯ä»¥å¯ç”¨/ç¦ç”¨ä¸€äº›è®¾ç½®ã€‚
- en: '[PRE4]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '**Warning #3** âš ï¸: enable/disable settings only after you tried the most basic
    optimizations as most of the time, PostgreSQL knows what it is doing.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '**è­¦å‘Š #3** âš ï¸ï¼šåªæœ‰åœ¨ä½ å°è¯•è¿‡æœ€åŸºæœ¬çš„ä¼˜åŒ–ä¹‹åï¼Œæ‰å¯ä»¥å¯ç”¨/ç¦ç”¨è®¾ç½®ï¼Œå› ä¸ºå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒPostgreSQLçŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚'
- en: Arenâ€™t there easier ways?!ğŸ™
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: éš¾é“æ²¡æœ‰æ›´ç®€å•çš„æ–¹æ³•å—ï¼Ÿï¼ğŸ™
- en: 'Unfortunately, *Explain* is not perfect and there are reasons why itâ€™s not
    in every developer toolbox:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å¹¸çš„æ˜¯ï¼Œ*Explain*å¹¶ä¸å®Œç¾ï¼Œä¸”æœ‰ä¸€äº›åŸå› å¯¼è‡´å®ƒå¹¶ä¸åœ¨æ¯ä¸ªå¼€å‘è€…çš„å·¥å…·ç®±ä¸­ï¼š
- en: '**You donâ€™t have a history of all the execution plans in production.**'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä½ æ²¡æœ‰ç”Ÿäº§ç¯å¢ƒä¸­æ‰€æœ‰æ‰§è¡Œè®¡åˆ’çš„å†å²è®°å½•ã€‚**'
- en: We can overcome the lack of history by using tools like [auto_explain](https://www.postgresql.org/docs/current/auto-explain.html)
    and [pg_stat_plans](https://github.com/2ndQuadrant/pg_stat_plans) to record the
    execution plans on certain conditions such that they wonâ€™t have a major effect
    on production. Another way is to record what queries run at what time and try
    to reproduce it, but itâ€™s more complicated than it looks.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨åƒ[auto_explain](https://www.postgresql.org/docs/current/auto-explain.html)å’Œ[pg_stat_plans](https://github.com/2ndQuadrant/pg_stat_plans)è¿™æ ·çš„å·¥å…·æ¥è®°å½•åœ¨ç‰¹å®šæ¡ä»¶ä¸‹çš„æ‰§è¡Œè®¡åˆ’ï¼Œä»è€Œå¼¥è¡¥ç¼ºä¹å†å²è®°å½•çš„é—®é¢˜ï¼Œä¸”å®ƒä»¬ä¸ä¼šå¯¹ç”Ÿäº§ç¯å¢ƒé€ æˆé‡å¤§å½±å“ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯è®°å½•å“ªäº›æŸ¥è¯¢åœ¨ä½•æ—¶è¿è¡Œï¼Œå¹¶å°è¯•é‡ç°å®ƒï¼Œä½†è¿™æ¯”çœ‹èµ·æ¥æ›´å¤æ‚ã€‚
- en: '**Tuning complex queries is not a trivial task with â€œbare execution plansâ€**,
    as they tend to be long and challenging to read. Moreover, they often fail to
    provide insights into why a particular optimization is not being utilized or offer
    guidance on how to effectively rewrite the queries for better performance.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '**è°ƒä¼˜å¤æ‚æŸ¥è¯¢å¹¶éä¸€é¡¹ç®€å•ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨â€œè£¸æ‰§è¡Œè®¡åˆ’â€**ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸å¾ˆé•¿ä¸”éš¾ä»¥é˜…è¯»ã€‚æ­¤å¤–ï¼Œå®ƒä»¬å¾€å¾€æ— æ³•æä¾›ä¸ºä½•æŸä¸ªç‰¹å®šä¼˜åŒ–æœªè¢«åˆ©ç”¨çš„æ´å¯Ÿï¼Œä¹Ÿä¸èƒ½æä¾›å¦‚ä½•æœ‰æ•ˆé‡å†™æŸ¥è¯¢ä»¥æå‡æ€§èƒ½çš„æŒ‡å¯¼ã€‚'
- en: 'However, this challenge can be addressed by adopting a highly opinionated structure
    and metadata using specialized tools. **These help you/the LLM focus on what matter**
    (whether its schema, whats the bottlenecks and so on). Some of the most prominent
    tools are:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶è€Œï¼Œè¿™ä¸€æŒ‘æˆ˜å¯ä»¥é€šè¿‡é‡‡ç”¨é«˜åº¦ç‰¹å®šç»“æ„å’Œå…ƒæ•°æ®ï¼Œå¹¶ä½¿ç”¨ä¸“ä¸šå·¥å…·æ¥è§£å†³ã€‚**è¿™äº›å·¥å…·å¸®åŠ©ä½ /LLMä¸“æ³¨äºé‡è¦äº‹é¡¹**ï¼ˆæ— è®ºæ˜¯æ¶æ„ã€ç“¶é¢ˆç­‰ï¼‰ã€‚ä¸€äº›æœ€è‘—åçš„å·¥å…·åŒ…æ‹¬ï¼š
- en: '[eversql](https://www.eversql.com/) â€” a mature solution that aims to suggest
    changes to your *PostgreSQL* queries.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[eversql](https://www.eversql.com/) â€” ä¸€æ¬¾æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨ä¸ºä½ çš„*PostgreSQL*æŸ¥è¯¢æä¾›å˜æ›´å»ºè®®ã€‚'
- en: '[metis](https://www.metisdata.io/) â€” aims to suggest changes as a guarding
    mechanism as part of your development and CI/CD processes for *PostgreSQL* databases.'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[metis](https://www.metisdata.io/) â€” æ—¨åœ¨ä¸ºä½ çš„*PostgreSQL*æ•°æ®åº“æä¾›å˜æ›´å»ºè®®ï¼Œä½œä¸ºå¼€å‘å’ŒCI/CDè¿‡ç¨‹ä¸­çš„ä¸€é¡¹é˜²æŠ¤æœºåˆ¶ã€‚'
- en: '[QueryFlow](https://github.com/eyaltrabelsi/query-flow) â€” an open-source tool
    that allows identifying bugs and performance tuning multiple queries (as the hardest
    queries to debug behave nicely in isolation).'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[QueryFlow](https://github.com/eyaltrabelsi/query-flow) â€” ä¸€æ¬¾å¼€æºå·¥å…·ï¼Œå…è®¸è¯†åˆ«å¤šä¸ªæŸ¥è¯¢çš„é”™è¯¯å’Œæ€§èƒ½è°ƒä¼˜ï¼ˆå› ä¸ºæœ€éš¾è°ƒè¯•çš„æŸ¥è¯¢åœ¨å­¤ç«‹æ—¶è¡¨ç°å¾—å¾ˆå¹³ç¨³ï¼‰ã€‚'
- en: '**Pro Tip #9** ğŸ’ƒ: use tools to make your life easy.'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸“ä¸šæç¤º #9** ğŸ’ƒï¼šä½¿ç”¨å·¥å…·è®©ä½ çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚'
- en: I will give you a taste of how convenient it is to use tools like QueryFlow
    (For more details you can read the following).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å°†ç»™ä½ å±•ç¤ºä½¿ç”¨åƒQueryFlowè¿™æ ·çš„å·¥å…·æœ‰å¤šæ–¹ä¾¿ï¼ˆæ›´å¤šç»†èŠ‚å¯ä»¥é˜…è¯»ä¸‹é¢çš„å†…å®¹ï¼‰ã€‚
- en: '![](../Images/8b7368c085df0fdc6607ce2201a3a0b9.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/8b7368c085df0fdc6607ce2201a3a0b9.png)'
- en: QueryFlow visualization of execution plan focusing on duration
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: QueryFlow æ‰§è¡Œè®¡åˆ’çš„å¯è§†åŒ–ï¼Œä¸“æ³¨äºæŒç»­æ—¶é—´
- en: It should be extremely easy to see that the *Index Only Scan* width is much
    bigger than the aggregation and indicate this is where we should focus. On multiple
    complex queries, other tools tend to lack
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: åº”è¯¥å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œ*ä»…ç´¢å¼•æ‰«æ*çš„å®½åº¦è¿œå¤§äºèšåˆå®½åº¦ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬åº”è¯¥å°†é‡ç‚¹æ”¾åœ¨è¿™é‡Œã€‚åœ¨å¤šä¸ªå¤æ‚æŸ¥è¯¢ä¸­ï¼Œå…¶ä»–å·¥å…·å¾€å¾€ç¼ºä¹è¿™ç§èƒ½åŠ›ã€‚
- en: Last words
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æœ€åçš„è¯
- en: In this article, we reviewed some of the most common reasons that can cause
    otherwise perfectly good SQL to be too slow for any time-sensitive applications,
    and **walk through a mythological way to identify those and avoid them**.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å›é¡¾äº†ä¸€äº›æœ€å¸¸è§çš„åŸå› ï¼Œè¿™äº›åŸå› å¯èƒ½å¯¼è‡´æœ¬æ¥å®Œå…¨æ­£å¸¸çš„ SQL åœ¨ä»»ä½•å¯¹æ—¶é—´æ•æ„Ÿçš„åº”ç”¨ä¸­å˜å¾—è¿‡äºç¼“æ…¢ï¼Œå¹¶**ä»‹ç»äº†ä¸€ç§ç¥è¯èˆ¬çš„æ–¹æ³•æ¥è¯†åˆ«å¹¶é¿å…è¿™äº›é—®é¢˜**ã€‚
- en: Due to the extent of the topic, there are many optimizations I havenâ€™t covered.
    For this reason, I have added additional resources in the end if you want to go
    the extra mile.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºè¯é¢˜çš„å¹¿æ³›æ€§ï¼Œæœ‰è®¸å¤šä¼˜åŒ–æªæ–½æˆ‘æ²¡æœ‰æ¶µç›–ã€‚å› æ­¤ï¼Œå¦‚æœä½ æƒ³æ›´æ·±å…¥äº†è§£ï¼Œæˆ‘åœ¨æœ€åæ·»åŠ äº†é¢å¤–çš„èµ„æºã€‚
- en: I am optimistic about the future. I believe these kinds of tools will be as
    easy as [*opening files in python*](https://www.w3schools.com/python/python_file_open.asp),
    either by integrating into IDEs, and clients, or providing SAS solutions. This
    will enable us to become proactive instead of reactive.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¯¹æœªæ¥å……æ»¡ä¿¡å¿ƒã€‚æˆ‘ç›¸ä¿¡è¿™äº›å·¥å…·å°†å˜å¾—å’Œ [*åœ¨ Python ä¸­æ‰“å¼€æ–‡ä»¶*](https://www.w3schools.com/python/python_file_open.asp)ä¸€æ ·ç®€å•ï¼Œæ— è®ºæ˜¯é€šè¿‡é›†æˆåˆ°
    IDE å’Œå®¢æˆ·ç«¯ï¼Œè¿˜æ˜¯æä¾› SAS è§£å†³æ–¹æ¡ˆã€‚è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿå˜å¾—æ›´åŠ ä¸»åŠ¨ï¼Œè€Œä¸æ˜¯è¢«åŠ¨åº”å¯¹ã€‚
- en: I hope I was able to share my enthusiasm for this fascinating topic and that
    you find it useful, and as always I am open to any kind of constructive feedback.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¸Œæœ›æˆ‘èƒ½å¤Ÿä¼ è¾¾æˆ‘å¯¹è¿™ä¸ªè¿·äººè¯é¢˜çš„çƒ­æƒ…ï¼Œå¹¶ä¸”ä½ è§‰å¾—è¿™äº›å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œåƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘æ„¿æ„æ¥å—ä»»ä½•å»ºè®¾æ€§çš„åé¦ˆã€‚
- en: Additional Resources ğŸ“š
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: é™„åŠ èµ„æº ğŸ“š
- en: '[Deeper Understanding of PostgreSQL Execution Plan (video)](https://www.youtube.com/watch?v=Ls-uE1V31lE&list=WL&index=5&ab_channel=PostgresConference)'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[PostgreSQL æ‰§è¡Œè®¡åˆ’çš„æ›´æ·±å…¥ç†è§£ï¼ˆè§†é¢‘ï¼‰](https://www.youtube.com/watch?v=Ls-uE1V31lE&list=WL&index=5&ab_channel=PostgresConference)'
- en: '[EXPLAIN Explained (video)](https://www.youtube.com/watch?v=mCwwFAl1pBU&ab_channel=SouthernCaliforniaLinuxExpo)'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[EXPLAIN è§£æï¼ˆè§†é¢‘ï¼‰](https://www.youtube.com/watch?v=mCwwFAl1pBU&ab_channel=SouthernCaliforniaLinuxExpo)'
- en: '[Understanding Explain](https://public.dalibo.com/exports/conferences/_archives/_2012/201211_explain/understanding_explain.pdf)'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[ç†è§£ EXPLAIN](https://public.dalibo.com/exports/conferences/_archives/_2012/201211_explain/understanding_explain.pdf)'
