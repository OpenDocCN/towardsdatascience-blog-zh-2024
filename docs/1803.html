<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Using LLMs to Query PubMed Knowledge Bases for BioMedical Research</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Using LLMs to Query PubMed Knowledge Bases for BioMedical Research</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-llms-to-query-pubmed-knowledge-bases-for-biomedical-research-bc00ead9e540?source=collection_archive---------6-----------------------#2024-07-24">https://towardsdatascience.com/using-llms-to-query-pubmed-knowledge-bases-for-biomedical-research-bc00ead9e540?source=collection_archive---------6-----------------------#2024-07-24</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="7dfc" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">AI for fun and profit!</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://medium.com/@jilliandrowe?source=post_page---byline--bc00ead9e540--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="Jillian Rowe" class="l ep by dd de cx" src="../Images/b1445fff6cf2011d270fe36b65123764.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/2*gUOz4cJzMzr5myLJvSs7ag.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--bc00ead9e540--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://medium.com/@jilliandrowe?source=post_page---byline--bc00ead9e540--------------------------------" rel="noopener follow">Jillian Rowe</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--bc00ead9e540--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">11 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jul 24, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">3</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/162ee2641c1ac9a9bde0687955abfffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FK9P8wahsg9O3L3s"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@itfeelslikefilm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">🇸🇮 Janko Ferlič</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="1168" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Part 1: Creating the Knowledge base</h1><p id="54cd" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">In this article, we’ll explore how to leverage large language models (LLMs) to search and scientific papers from <a class="af nc" href="https://www.ncbi.nlm.nih.gov/pmc/tools/openftlist/" rel="noopener ugc nofollow" target="_blank">PubMed Open Access</a> Subset, a free resource for accessing biomedical and life sciences literature. We’ll use Retrieval-Augmented Generation, RAG, to search our digital library.</p><p id="6a9f" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">AWS Bedrock will act as our AI backend, PostgreSQL as the vector database for storing embeddings, and the LangChain library in Python will ingest papers and query the knowledge base.</p><p id="02c8" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">If you only care about the results generated by querying the knowledge base, skip down to the end.</p><p id="9739" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The specific use case we’ll be focusing on is querying papers related to Rheumatoid Arthritis, a chronic inflammatory disorder affecting joints. We’ll use the query <code class="cx pa pb pc pd b">((rheumatoid arthritis) AND gene) AND cell</code> to retrieve around 10,000 relevant papers from PubMed and then sample that down to approximately 5,000 papers for our knowledge base.</p><h1 id="ceee" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Disclaimer</h1><p id="34c5" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Not all research articles or sources have licensing that allows for ingesting with AI!</p><p id="5a5a" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I’m not including all the source code because the AI libraries change so frequently and because there are oodles of ways to configure a knowledge base backend, but I have included some helper functions so you can follow along.</p><h1 id="1c72" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">PGVector: Storing Embeddings in a Vector Database</h1><p id="49f0" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">To make it easier for the LLM to process and understand the textual data from the research papers, we’ll convert the text into numerical embeddings, which are dense vector representations of the text. These embeddings will be stored in a PostgreSQL database using the PGVector library. This step essentially simplifies the text data into a format that the LLM can more easily work with.</p><p id="130c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I’m running a local postgresql database, which is fine for my datasets. Hosting AWS Bedrock Knowledgebases can get expensive, and I’m not trying to run up my AWS bill this month. It’s summer, and I have kids camp to pay for!</p><h1 id="9e05" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">AWS Bedrock: The AI Backend</h1><p id="edb6" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">AWS Bedrock is a managed service provided by Amazon Web Services (AWS), allowing you to easily deploy and operate large language models. In our setup, Bedrock will host the LLM that we’ll use to query and retrieve relevant information from our knowledge base of research papers.</p><h1 id="b118" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">LangChain: Loading and Querying the Knowledge Base</h1><p id="e70d" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">LangChain is a Python library that simplifies building applications with large language models. We’ll use <a class="af nc" href="https://www.langchain.com/" rel="noopener ugc nofollow" target="_blank">LangChain</a> to load our research papers and their associated embeddings into a knowledge base and then query this knowledge base using the LLM hosted on AWS Bedrock.</p><h1 id="0566" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Using PubGet for Data Acquisition</h1><p id="0da7" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">While this setup can work with research papers from any source, we’re using PubMed because it’s a convenient source for acquiring a large volume of papers based on specific search queries. We’ll use the <a class="af nc" href="https://github.com/neuroquery/pubget" rel="noopener ugc nofollow" target="_blank">PubGet</a> tool to retrieve the initial set of 10,000 papers matching our query on Rheumatoid Arthritis, genes, and cells. Behind the scenes pubget fetches articles from the PubMed FTP service.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="b09b" class="ph ne fq pd b bg pi pj l pk pl">pubget run -q "((rheumatoid arthritis) AND gene) AND cell" \<br/> pubget_data</span></pre><p id="daeb" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">This will get us articles in <code class="cx pa pb pc pd b">xml</code> format.</p><h1 id="77d5" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Structuring and Organizing the Dataset</h1><p id="88a3" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Beyond the technical aspects, this article will focus on how to structure and organize your dataset of research papers effectively.</p><ol class=""><li id="380a" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pm pn po bk"><strong class="ob fr">Dataset</strong>: Managing your datasets on a global level using collections.</li><li id="382f" class="nz oa fq ob b go pp od oe gr pq og oh oi pr ok ol om ps oo op oq pt os ot ou pm pn po bk"><strong class="ob fr">Metadata Management</strong>: Handling and incorporating metadata associated with the papers, such as author information, publication dates, and keywords.</li></ol><p id="82d9" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You’ll want to think about this upfront. When using LangChain, you query datasets based on their collections. Each collection has a name and a unique identifier.</p><p id="1869" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">When you load your data, whether it’s pdf papers, xml downloads, markdown files, codebases, powerpoint slides, text documents, etc, you can attach additional metadata. You can later use this metadata to filter your results. The metadata is an open dictionary, and you can add tags, source, phenotype, or anything you think may be relevant.</p><h1 id="ae4b" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Loading and Querying the Knowledge Base</h1><p id="8edd" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">The article will also cover best practices for loading your preprocessed and structured dataset into the knowledge base and provide examples of how to query the knowledge base effectively using the LLM hosted on AWS Bedrock.</p><p id="6760" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">By the end of this article, you should have a solid understanding of how to leverage LLMs to search and retrieve relevant information from a large corpus of research papers, as well as strategies for structuring and organizing your dataset to optimize the performance and accuracy of your knowledge base.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="1b74" class="ph ne fq pd b bg pi pj l pk pl">import boto3<br/>import pprint<br/>import os<br/>import boto3<br/>import json<br/>import hashlib<br/>import funcy<br/>import glob<br/>from typing import Dict, Any, TypedDict, List<br/>from langchain.llms.bedrock import Bedrock<br/>from langchain.retrievers.bedrock import AmazonKnowledgeBasesRetriever<br/>from langchain_core.documents import Document<br/>from langchain_aws import ChatBedrock<br/>from langchain_community.embeddings import BedrockEmbeddings # to create embeddings for the documents.<br/>from langchain_experimental.text_splitter import SemanticChunker # to split documents into smaller chunks.<br/>from langchain_text_splitters import CharacterTextSplitter<br/>from langchain_postgres import PGVector<br/>from pydantic import BaseModel, Field<br/>from langchain_community.document_loaders import (<br/>    WebBaseLoader,<br/>    TextLoader,<br/>    PyPDFLoader,<br/>    CSVLoader,<br/>    Docx2txtLoader,<br/>    UnstructuredEPubLoader,<br/>    UnstructuredMarkdownLoader,<br/>    UnstructuredXMLLoader,<br/>    UnstructuredRSTLoader,<br/>    UnstructuredExcelLoader,<br/>    DataFrameLoader,<br/>)<br/>import psycopg<br/>import uuid</span></pre><h1 id="9d6e" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Set up your database connection</h1><p id="63a0" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I’m running a local <a class="af nc" href="https://supabase.com/" rel="noopener ugc nofollow" target="_blank">Supabase</a> postgresql database running using their <code class="cx pa pb pc pd b">docker-compose</code> setup. In a production setup, I'd recommend using a real database, like AWS AuroraDB or Supabase running someplace besides your laptop. Also, change your password to something besides password.</p><p id="780c" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I didn’t notice any difference in performance for smaller datasets between an AWS-hosted knowledgebase and my laptop, but your mileage may vary.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="8d4f" class="ph ne fq pd b bg pi pj l pk pl">connection = f"postgresql+psycopg://{user}:{password}@{host}:{port}/{database}" <br/># Establish the connection to the database<br/>conn = psycopg.connect(<br/>    conninfo = f"postgresql://{user}:{password}@{host}:{port}/{database}"<br/>)<br/># Create a cursor to run queries<br/>cur = conn.cursor()</span></pre><h1 id="ee3f" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Insert AWS BedRock Embeddings into the table using Langchain</h1><p id="fdc0" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">We’re using AWS Bedrock as our AI Knowledgebase. Most of the companies I work with have some kind of proprietary data, and Bedrock has a guarantee that your data will remain private. You could use any of the AI backends here.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="d6ac" class="ph ne fq pd b bg pi pj l pk pl">os.environ['AWS_DEFAULT_REGION'] = 'us-east-1'<br/>bedrock_client              = boto3.client("bedrock-runtime") <br/>bedrock_embeddings          = BedrockEmbeddings(model_id="amazon.titan-embed-text-v1",client=bedrock_client)<br/>bedrock_embeddings_image    = BedrockEmbeddings(model_id="amazon.titan-embed-image-v1",client=bedrock_client)<br/>llm                         = ChatBedrock(model_id="anthropic.claude-3-sonnet-20240229-v1:0", client=bedrock_client)</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="20a1" class="ph ne fq pd b bg pi pj l pk pl"># function to create vector store<br/># make sure to update this if you change collections!<br/>def create_vectorstore(embeddings,collection_name,conn):                       <br/>    vectorstore = PGVector(<br/>        embeddings=embeddings,<br/>        collection_name=collection_name,<br/>        connection=conn,<br/>        use_jsonb=True,<br/>    )<br/>    return vectorstore</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="1b19" class="ph ne fq pd b bg pi pj l pk pl">def load_and_split_pdf_semantic(file_path, embeddings):<br/>    loader = PyPDFLoader(file_path)<br/>    pages = loader.load_and_split()<br/>    return pages</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="1e5a" class="ph ne fq pd b bg pi pj l pk pl">def load_xml(file_path, embeddings):<br/>    loader = UnstructuredXMLLoader(<br/>        file_path,<br/>    )<br/>    docs = loader.load_and_split()<br/>    return docs</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="78b3" class="ph ne fq pd b bg pi pj l pk pl">def insert_embeddings(files, bedrock_embeddings, vectorstore):<br/>    logging.info(f"Inserting {len(files)}")<br/>    x = 1<br/>    y = len(files)<br/>    for file_path in files:<br/>        logging.info(f"Splitting {file_path} {x}/{y}")<br/>        docs = []<br/>        if '.pdf' in file_path:<br/>            try:<br/>                with funcy.print_durations('process pdf'):                <br/>                    docs = load_and_split_pdf_semantic(file_path, bedrock_embeddings)<br/>            except Exception as e:<br/>                logging.warning(f"Error loading docs")<br/>        if '.xml' in file_path:<br/>            try:<br/>                with funcy.print_durations('process xml'):                <br/>                    docs = load_xml(file_path, bedrock_embeddings)<br/>            except Exception as e:<br/>                logging.warning(e)<br/>                logging.warning(f"Error loading docs")<br/>        filtered_docs = []<br/>        for d in docs:<br/>            if len(d.page_content):<br/>                filtered_docs.append(d)<br/>        # Add documents to the vectorstore<br/>        ids = []<br/>        for d in filtered_docs:<br/>            ids.append(<br/>                hashlib.sha256(d.page_content.encode()).hexdigest()<br/>            )<br/>            <br/>        if len(filtered_docs):<br/>            texts = [ i.page_content for i in filtered_docs] <br/>            # metadata is a dictionary. You can add to it!<br/>            metadatas = [ i.metadata for i in filtered_docs]<br/>            #logging.info(f"Adding N: {len(filtered_docs)}")<br/>            try:<br/>                with funcy.print_durations('load psql'):<br/>                    vectorstore.add_texts(texts=texts, metadatas = metadatas, ids=ids)<br/>            except Exception as e:<br/>                logging.warning(e)<br/>                logging.warning(f"Error {x - 1}/{y}")<br/>            #logging.info(f"Complete {x}/{y}")<br/>        x = x + 1</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="88f1" class="ph ne fq pd b bg pi pj l pk pl">collection_name_text = "MY_COLLECTION" #pubmed, smiles, etc<br/>vectorstore = create_vectorstore(bedrock_embeddings,collection_name_text,connection)</span></pre><h1 id="35ce" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Load and process Pubmed XML Papers</h1><p id="3f52" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Most of our data was fetched using the <code class="cx pa pb pc pd b">pubget</code> tool, and the articles are in XML format. We'll use the LangChain XML Loader to process, split and load the embeddings.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="f5e2" class="ph ne fq pd b bg pi pj l pk pl">files = glob.glob("/home/jovyan/data/pubget_ra/pubget_data/*/articles/*/*/article.xml")</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="203c" class="ph ne fq pd b bg pi pj l pk pl">#I ran this previously<br/>insert_embeddings(files[0:2], bedrock_embeddings, vectorstore)</span></pre><h1 id="0019" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Load and Process Pubmed PDF Papers</h1><p id="8b6c" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">PDFs are easier to read, and I grabbed some for doing QA against the knowledge base.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="ccc3" class="ph ne fq pd b bg pi pj l pk pl">files = glob.glob("/home/jovyan/data/pubget_ra/papers/*pdf")<br/>insert_embeddings(files[0:2], bedrock_embeddings, vectorstor</span></pre><h1 id="8002" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Part 2 — Query the Knowledge base</h1><p id="dc47" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Now that we have our knowledge base setup we can use Retrieval Augmented Generation, RAG methods, to use the LLMs to run queries.</p><p id="8995" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Our queries are:</p><ul class=""><li id="c658" class="nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou pv pn po bk">Tell me about T cell–derived cytokines in relation to rheumatoid arthritis and provide citations and article titles</li><li id="d3d8" class="nz oa fq ob b go pp od oe gr pq og oh oi pr ok ol om ps oo op oq pt os ot ou pv pn po bk">Tell me about single-cell research in rheumatoid arthritis.</li><li id="0a28" class="nz oa fq ob b go pp od oe gr pq og oh oi pr ok ol om ps oo op oq pt os ot ou pv pn po bk">Tell me about protein-protein associations in rheumatoid arthritis.</li><li id="7abe" class="nz oa fq ob b go pp od oe gr pq og oh oi pr ok ol om ps oo op oq pt os ot ou pv pn po bk">Tell me about the findings of GWAS studies in rheumatoid arthritis.</li></ul><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="6b9c" class="ph ne fq pd b bg pi pj l pk pl">import hashlib<br/>import logging<br/>import os<br/>from typing import Optional, List, Dict, Any<br/>import glob<br/>import boto3<br/>from toolz.itertoolz import partition_all<br/>import json<br/>import funcy<br/>import psycopg<br/>from IPython.display import Markdown, display<br/>from langchain.chains import create_retrieval_chain<br/>from langchain.chains.combine_documents import create_stuff_documents_chain<br/>from langchain.prompts import PromptTemplate<br/>from langchain.retrievers.bedrock import (<br/>    AmazonKnowledgeBasesRetriever,<br/>    RetrievalConfig,<br/>    VectorSearchConfig,<br/>)<br/>from aws_bedrock_utilities.models.base import BedrockBase, RAGResults<br/>from aws_bedrock_utilities.models.pgvector_knowledgebase import BedrockPGWrapper<br/>from sklearn.model_selection import train_test_split<br/>import numpy as np<br/>import pandas as pd<br/>from pprint import pprint<br/>import time<br/>import logging<br/>from rich.logging import RichHandler</span></pre><p id="0120" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I don’t list it here, but I’ll always do some QA against my knowlegebase. Choose an article, parse out the summary or findings, and ask the LLM about it. You should get your article back.</p><h1 id="36f7" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Structuring Your Queries</h1><p id="87db" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">You’ll need to first have the collection name you’re querying along with your queries.</p><p id="ac97" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">I always recommend running a few QA queries. Ask the obvious questions in several different ways.</p><p id="3884" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">You’ll also want to adjust the <code class="cx pa pb pc pd b">MAX_DOCS_RETURNED</code> based on your time constraints and how many articles are in your knowledgebase. The LLM will search until it hits that maximum, and then stops. You'll need to increase that number for an exhaustive search.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="a58c" class="ph ne fq pd b bg pi pj l pk pl"># Make sure to keep the collection name consistent!<br/>COLLECTION_NAME   = "MY_COLLECTION"<br/>MAX_DOCS_RETURNED = 50</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="2bf5" class="ph ne fq pd b bg pi pj l pk pl">p = BedrockPGWrapper(collection_name=COLLECTION_NAME)                              credentials.py:1147</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="73f9" class="ph ne fq pd b bg pi pj l pk pl">#model = "anthropic.claude-3-sonnet-20240229-v1:0"<br/>model = "anthropic.claude-3-haiku-20240307-v1:0"</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="4c14" class="ph ne fq pd b bg pi pj l pk pl">model = "anthropic.claude-3-haiku-20240307-v1:0"<br/>queries = [<br/>    "Tell me about T cell–derived cytokines in relation to rheumatoid arthritis and provide citations and article titles",<br/>    "Tell me about single-cell research in rheumatoid arthritis.",<br/>    "Tell me about protein-protein associations in rheumatoid arthritis.",<br/>    "Tell me about the findings of GWAS studies in rheumatoid arthritis.",<br/>    <br/>]<br/>ai_responses = []<br/>for query in queries:<br/>    answer = p.run_kb_chat(query=query, collection_name= COLLECTION_NAME, model_id=model, search_kwargs={'k': MAX_DOCS_RETURNED, 'fetch_k': 50000 })<br/>    ai_responses.append(answer)<br/>    time.sleep(1)</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="d9cf" class="ph ne fq pd b bg pi pj l pk pl">for answer in ai_responses:<br/>    t = Markdown(f"""<br/>### Query <br/>{answer['query']}### Response<br/>{answer['result']}<br/> <br/>    """)<br/>    display(t)</span></pre><h1 id="2e4c" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Part 3: Results!</h1><p id="54e8" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">We’ve built our knowledge base, run some queries, and now we’re ready to look at the results the LLM generated for us.</p><p id="b221" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Each result is a dictionary with the original query, the response, and the relevant snippets of the source document.</p></div></div></div><div class="ab cb pw px py pz" role="separator"><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><blockquote class="qe"><p id="82f2" class="qf qg fq bf qh qi qj qk ql qm qn ou dx">Tell me about T cell–derived cytokines in relation to rheumatoid arthritis and provide citations and article titles</p></blockquote><blockquote class="qo qp qq"><p id="dd09" class="nz oa qr ob b go qs od oe gr qt og oh oi qu ok ol om qv oo op oq qw os ot ou fj bk">T cell-derived cytokines play a key role in the pathogenesis of rheumatoid arthritis (RA). Some key findings include:</p><p id="32d2" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Increased levels of IL-17, a cytokine produced by Th17 cells, have been found in the synovial fluid of RA patients. IL-17 can stimulate fibroblast-like synoviocytes (FLS) and macrophages to produce inflammatory mediators like VEGF, IL-1, IL-6, TNF-α, and prostaglandin E2, and promote osteoclast formation, contributing to joint inflammation and destruction (Honorati et al. 2006, Schurgers et al. 2011).</p><p id="2302" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Th1 cells, which produce IFN-γ, are also implicated in RA pathogenesis. IFN-γ can induce macrophages to polarize towards a pro-inflammatory M1 phenotype (Schurgers et al. 2011, Kebir et al. 2009, Boniface et al. 2010).</p><p id="c80c" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">CD161+ Th17 cells, which can produce both IL-17 and IFN-γ, are enriched in the synovium of RA patients and may contribute to the inflammatory environment (Afzali et al. 2013, Bovenschen et al. 2011, Koenen et al. 2008, Pesenacker et al. 2013).</p><p id="7c76" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Regulatory T cells (Tregs), which normally suppress inflammation, show impaired function in RA, potentially contributing to the dysregulated immune response (Moradi et al. 2014, Samson et al. 2012, Zhang et al. 2018, Walter et al. 2013, Wang et al. 2018, Morita et al. 2016).</p><p id="4c0f" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In summary, the imbalance between pro-inflammatory T cell subsets (Th1, Th17) and anti-inflammatory Tregs is a hallmark of RA pathogenesis, with cytokines like IL-17 and IFN-γ playing central roles in driving joint inflammation and destruction.</p></blockquote></div></div></div><div class="ab cb pw px py pz" role="separator"><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><blockquote class="qe"><p id="5735" class="qf qg fq bf qh qi qj qk ql qm qn ou dx">Tell me about single-cell research in rheumatoid arthritis.</p></blockquote><blockquote class="qo qp qq"><p id="4d7f" class="nz oa qr ob b go qs od oe gr qt og oh oi qu ok ol om qv oo op oq qw os ot ou fj bk">Single-cell research has provided important insights into the pathogenesis of rheumatoid arthritis (RA):</p><p id="b6aa" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Single-cell RNA sequencing (scRNA-seq) studies have identified distinct cell states and subpopulations within the RA synovium, including pathogenic T cell subsets like T peripheral helper (Tph) cells and cytotoxic CD8+ T cells.</p><p id="13ad" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Analyses of the T cell receptor (TCR) repertoire in the RA synovium have revealed clonal expansion of CD4+ and CD8+ T cell populations, suggesting antigen-driven responses.</p><p id="6f79" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">scRNA-seq has also characterized expanded populations of activated B cells, plasmablasts, and plasma cells in the RA synovium that demonstrate substantial clonal relationships.</p><p id="4fe5" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Receptor-ligand analyses from scRNA-seq data have predicted key cell-cell interactions, such as between Tph cells and B cells, that may drive synovial inflammation.</p><p id="fefd" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Overall, single-cell studies have uncovered the cellular and molecular heterogeneity within the RA synovium, identifying specific immune cell subsets and pathways that could serve as targets for more personalized therapeutic approaches.</p></blockquote></div></div></div><div class="ab cb pw px py pz" role="separator"><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><blockquote class="qe"><p id="e03f" class="qf qg fq bf qh qi qj qk ql qm qn ou dx">Tell me about protein-protein associations in rheumatoid arthritis.</p></blockquote><blockquote class="qo qp qq"><p id="2676" class="nz oa qr ob b go qs od oe gr qt og oh oi qu ok ol om qv oo op oq qw os ot ou fj bk">Based on the information provided in the context, some key protein-protein associations in rheumatoid arthritis (RA) include:</p><p id="1f17" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Rheumatoid factor (RF) and anti-citrullinated protein antibodies (ACPAs):</p><p id="c521" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">RF is found in about 80% of patients in the pre-articular phase of RA.</p><p id="f9ca" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">ACPAs are highly specific for RA and can be detected years before the onset of clinical symptoms.</p><p id="ec3a" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Peptidylarginine deiminase (PAD) enzymes and anti-PAD antibodies:</p><p id="566d" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Anti-PAD2 antibodies are associated with a moderate disease course, while anti-PAD4 antibodies are linked to more severe and rapidly progressive RA.</p><p id="a440" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Anti-PAD3/4 antibodies may signal the development of RA-associated interstitial lung disease.</p><p id="de11" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Anti-carbamylated protein (anti-CarP) antibodies:</p><p id="f181" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Anti-CarP antibodies are present in 25–50% of RA patients, independent of RF or ACPA positivity.</p><p id="2900" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Anti-CarP antibodies are associated with poor prognosis and increased morbidity, including RA-associated interstitial lung disease.</p><p id="3321" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Malondialdehyde-acetaldehyde (MAA) adducts and anti-MAA antibodies:</p><p id="b31f" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Anti-MAA antibodies are associated with radiological progression in seronegative RA.</p><p id="0bc2" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Protein-protein interactions in signaling pathways:</p><p id="76d5" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The JAK-STAT, MAPK, PI3K-AKT, and SYK signaling pathways are all implicated in the pathogenesis of RA and are potential targets for therapeutic intervention.</p><p id="35b3" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">In summary, the context highlights several key protein-protein associations in RA, including autoantibodies (RF, ACPAs, anti-PAD, anti-CarP, anti-MAA) and signaling pathway components (JAK, STAT, MAPK, PI3K, SYK), which play important roles in the pathogenesis and progression of the disease.</p></blockquote></div></div></div><div class="ab cb pw px py pz" role="separator"><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc qd"/><span class="qa by bm qb qc"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><blockquote class="qe"><p id="7497" class="qf qg fq bf qh qi qj qk ql qm qn ou dx">Tell me about the findings of GWAS studies in rheumatoid arthritis.</p></blockquote><blockquote class="qo qp qq"><p id="944a" class="nz oa qr ob b go qs od oe gr qt og oh oi qu ok ol om qv oo op oq qw os ot ou fj bk">Here are some key findings from GWAS studies in rheumatoid arthritis:</p><p id="dff5" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Genome-wide association studies (GWAS) have identified over 100 genetic risk loci associated with rheumatoid arthritis susceptibility.</p><p id="01f2" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">The HLA-DRB1 gene is the strongest genetic risk factor, accounting for about 50% of the genetic component of rheumatoid arthritis. Specific HLA-DRB1 alleles containing the “shared epitope” sequence are strongly associated with increased RA risk.</p><p id="e513" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Other notable genetic risk factors identified through GWAS include PTPN22, STAT4, CCR6, PADI4, CTLA4, and CD40. These genes are involved in immune regulation and inflammation pathways.</p><p id="4426" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Genetic risk factors can differ between seropositive (ACPA-positive) and seronegative rheumatoid arthritis. For example, HLA-DRB1 alleles have a stronger association with seropositive RA.</p><p id="f28e" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">GWAS have also identified genetic variants associated with disease severity and response to treatment in rheumatoid arthritis. For example, variants in the FCGR3A and PTPRC genes have been linked to response to anti-TNF therapy.</p><p id="9f88" class="nz oa qr ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">Overall, GWAS have provided important insights into the genetic architecture and pathogenesis of rheumatoid arthritis, which has implications for developing targeted therapies and personalized treatment approaches.</p></blockquote><h1 id="f1cb" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Investigate the Source Documents</h1><p id="6158" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Querying the Knowledge base will return relevant snippets of the source documents. Sometimes the formatting returned by langchain can be a bit off, but you can always go back to the source.</p><pre class="mm mn mo mp mq pe pd pf bp pg bb bk"><span id="364a" class="ph ne fq pd b bg pi pj l pk pl">x = 0<br/>y = 10<br/>for answer in ai_responses:<br/>    for s in answer['source_documents']:<br/>        if x &lt;= y:<br/>            print(s.metadata)<br/>        else:<br/>            break<br/>        x = x + 1</span></pre><pre class="pu pe pd pf bp pg bb bk"><span id="c82b" class="ph ne fq pd b bg pi pj l pk pl">{'page': 6, 'source': '/home/jovyan/data/pubget_ra/papers/fimmu-12-790122.pdf'}<br/>{'source': '/home/jovyan/data/pubget_ra/pubget_data/query_55c6003c0195b20fd4bdc411f67a8dcf/articles/d52/pmcid_11167034/article.xml'}<br/>{'page': 7, 'source': '/home/jovyan/data/pubget_ra/papers/fimmu-12-790122.pdf'}<br/>{'page': 17, 'source': '/home/jovyan/data/pubget_ra/papers/fimmu-12-790122.pdf'}<br/>{'source': '/home/jovyan/data/pubget_ra/pubget_data/query_55c6003c0195b20fd4bdc411f67a8dcf/articles/657/pmcid_11151399/article.xml'}<br/>{'page': 3, 'source': '/home/jovyan/data/pubget_ra/papers/41392_2023_Article_1331.pdf'}<br/>{'page': 4, 'source': '/home/jovyan/data/pubget_ra/papers/41392_2023_Article_1331.pdf'}<br/>{'page': 5, 'source': '/home/jovyan/data/pubget_ra/papers/fimmu-12-790122.pdf'}<br/>{'source': '/home/jovyan/data/pubget_ra/pubget_data/query_55c6003c0195b20fd4bdc411f67a8dcf/articles/e02/pmcid_11219584/article.xml'}<br/>{'page': 8, 'source': '/home/jovyan/data/pubget_ra/papers/fimmu-12-790122.pdf'}<br/>{'source': '/home/jovyan/data/pubget_ra/pubget_data/query_55c6003c0195b20fd4bdc411f67a8dcf/articles/6fb/pmcid_11203675/article.xml'}</span></pre><h1 id="666a" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Wrap Up</h1><p id="e887" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">There you have it! We created a knowledge base on the cheap, used AWS Bedrock to load the embeddings, and then used a Claude LLM to run our queries. Here we used PubMed papers, but we also could have used meeting notes, powerpoint slides, crawled websites, or in house databases.</p><p id="03dc" class="pw-post-body-paragraph nz oa fq ob b go ov od oe gr ow og oh oi ox ok ol om oy oo op oq oz os ot ou fj bk">If you have any questions, comments, or tutorial requests please don’t hesitate to reach out to me by email at jillian@dabbleofdevops.com</p></div></div></div></div>    
</body>
</html>