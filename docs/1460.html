<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Anatomy of Windows Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Anatomy of Windows Functions</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/anatomy-of-windows-functions-08f04938b12b?source=collection_archive---------11-----------------------#2024-06-11">https://towardsdatascience.com/anatomy-of-windows-functions-08f04938b12b?source=collection_archive---------11-----------------------#2024-06-11</a></blockquote><div><div class="em fe ff fg fh fi"/><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><div/><div><h2 id="98d1" class="pw-subtitle-paragraph gn fp fq bf b go gp gq gr gs gt gu gv gw gx gy gz ha hb hc cq dx">Theory and practice of an underappreciated SQL operation</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hd he hf hg hh ab"><div><div class="ab hi"><div><div class="bm" aria-hidden="false"><a href="https://joaopedro214.medium.com/?source=post_page---byline--08f04938b12b--------------------------------" rel="noopener follow"><div class="l hj hk by hl hm"><div class="l ed"><img alt="João Pedro" class="l ep by dd de cx" src="../Images/64a0e14527be213e5fde0a02439fbfa7.png" width="44" height="44" loading="lazy" data-testid="authorPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:88:88/1*AGYCo0LFRlCcch_Ati7jFA.jpeg"/><div class="hn by l dd de em n ho eo"/></div></div></a></div></div><div class="hp ab ed"><div><div class="bm" aria-hidden="false"><a href="https://towardsdatascience.com/?source=post_page---byline--08f04938b12b--------------------------------" rel="noopener follow"><div class="l hq hr by hl hs"><div class="l ed"><img alt="Towards Data Science" class="l ep by br ht cx" src="../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto" data-original-src="https://miro.medium.com/v2/resize:fill:48:48/1*CJe3891yB1A1mzMdqemkdg.jpeg"/><div class="hn by l br ht em n ho eo"/></div></div></a></div></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="hu ab q"><div class="ab q hv"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b hw hx bk"><a class="af ag ah ai aj ak al am an ao ap aq ar hy" data-testid="authorName" href="https://joaopedro214.medium.com/?source=post_page---byline--08f04938b12b--------------------------------" rel="noopener follow">João Pedro</a></p></div></div></div><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span><p class="bf b hw hx dx"><button class="ib ic ah ai aj ak al am an ao ap aq ar id ie if" disabled="">Follow</button></p></div></div></span></div></div><div class="l ig"><span class="bf b bg z dx"><div class="ab cn ih ii ij"><div class="ik il ab"><div class="bf b bg z dx ab im"><span class="in l ig">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar hy ab q" data-testid="publicationName" href="https://towardsdatascience.com/?source=post_page---byline--08f04938b12b--------------------------------" rel="noopener follow"><p class="bf b bg z io ip iq ir is it iu iv bk">Towards Data Science</p></a></div></div></div><div class="h k"><span class="hz ia" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div></div><span class="bf b bg z dx"><div class="ab ae"><span data-testid="storyReadTime">12 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dx">·</span></span></div><span data-testid="storyPublishDate">Jun 11, 2024</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w ea eb q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon ed in kg kh ki"><div class=""><div class="kj kk kl km kn ko kp am kq kr ks ki"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM15.421 1.84l-1.185-.388-.338 2.5zM9.757 1.452l-1.184.389 1.523 2.112zM20.253 11.84 17.75 7.438c-.238-.353-.57-.584-.93-.643a.96.96 0 0 0-.753.183 1.13 1.13 0 0 0-.443.695c.014.019.03.033.044.053l2.352 4.138c1.614 2.95 1.1 5.771-1.525 8.395a7 7 0 0 1-.454.415c.997-.13 1.927-.61 2.773-1.457 2.705-2.704 2.517-5.585 1.438-7.377M12.066 9.01c-.129-.687.08-1.299.573-1.773l-2.062-2.063a1.123 1.123 0 0 0-1.555 0 1.1 1.1 0 0 0-.273.521z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.741 8.309c-.18-.267-.446-.455-.728-.502a.67.67 0 0 0-.533.127c-.146.113-.59.458-.199 1.296l1.184 2.503a.448.448 0 0 1-.236.755.445.445 0 0 1-.483-.248L7.614 6.106A.816.816 0 1 0 6.459 7.26l3.643 3.644a.446.446 0 1 1-.631.63L5.83 7.896l-1.03-1.03a.82.82 0 0 0-1.395.577.81.81 0 0 0 .24.576l1.027 1.028 3.643 3.643a.444.444 0 0 1-.144.728.44.44 0 0 1-.486-.098l-3.64-3.64a.82.82 0 0 0-1.335.263.81.81 0 0 0 .178.89l1.535 1.534 2.287 2.288a.445.445 0 0 1-.63.63l-2.287-2.288a.813.813 0 0 0-1.393.578c0 .216.086.424.238.577l4.403 4.403c2.79 2.79 5.495 4.119 8.681.931 2.269-2.271 2.708-4.588 1.342-7.086z" clip-rule="evenodd"/></svg></div></div></div><div class="pw-multi-vote-count l kt ku kv kw kx ky kz"><p class="bf b dy z dx"><span class="kk">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kj lc ld ab q ee le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"/></svg><p class="bf b dy z dx"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"/><div class="h k"><div><div class="bm" aria-hidden="false"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" data-testid="headerBookmarkButton" class="af ee ah ai aj ak al lh an ao ap id li lj lk" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24" class="av"><path fill="#000" d="M17.5 1.25a.5.5 0 0 1 1 0v2.5H21a.5.5 0 0 1 0 1h-2.5v2.5a.5.5 0 0 1-1 0v-2.5H15a.5.5 0 0 1 0-1h2.5zm-11 4.5a1 1 0 0 1 1-1H11a.5.5 0 0 0 0-1H7.5a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4z"/></svg></button></div></div></div><div class="ep ll cn"><div class="l ae"><div class="ab cb"><div class="lm ln lo lp lq lr ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">Share</p></div></button></div></div></div><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="More options" data-testid="headerStoryOptionsButton" class="af ee ah ai aj ak al lh an ao ap id ls lt lf lu lv lw lx ly s lz ma mb mc md me mf u mg mh mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.385 12c0 .55.2 1.02.59 1.41.39.4.86.59 1.41.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.02.2-1.41.59-.4.39-.59.86-.59 1.41m5.62 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.42.59s1.02-.2 1.41-.59c.4-.39.59-.86.59-1.41s-.2-1.02-.59-1.41a1.93 1.93 0 0 0-1.41-.59c-.55 0-1.03.2-1.42.59s-.58.86-.58 1.41m5.6 0c0 .55.2 1.02.58 1.41.4.4.87.59 1.43.59s1.03-.2 1.42-.59.58-.86.58-1.41-.2-1.02-.58-1.41a1.93 1.93 0 0 0-1.42-.59c-.56 0-1.04.2-1.43.59s-.58.86-.58 1.41" clip-rule="evenodd"/></svg><div class="j i d"><p class="bf b bg z dx">More</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk ml"><img src="../Images/372d1f6e1d8557debca3c91f47c3198b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eoYdypWrGES9hxon"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Photo by <a class="af nc" href="https://unsplash.com/@marcuswoodbridge?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marcus Woodbridge</a> on <a class="af nc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="37fa" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Introduction</h1><p id="c9ef" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">The IT area is known for its constant changes, with new tools, new frameworks, new cloud providers, and new LLMs being created every day. However, even in this busy world, some principles, paradigms, and tools seem to challenge the <em class="ov">status quo</em> of ‘nothing is forever’. And, in the data area, there is no example of this as imposing as the SQL language.</p><p id="d465" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Since its creation back in the 80s, it passed the age of Data Warehouses, materialized itself in the Hadoop/Data-lake/Big Data as Hive, and is still alive today as one of the Spark APIs. The world changed a lot but SQL remained not only alive but very important and present.</p><p id="1dbd" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">But SQL is like chess, easy to understand the basic rules but hard to master! It is a language with many possibilities, many ways to solve the same problem, many functions and keywords, and, unfortunately, many underrated functionalities that, if better known, could help us a lot when building queries.</p><p id="9acd" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Because of this, in this post, I want to talk about one of the not-so-famous SQL features that I found extremely useful when building my daily queries: Window Functions.</p><h1 id="cc91" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">What is a Window Function</h1><p id="575c" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">The traditional and most famous SGBDs (PostgreSQL, MySQL, and Oracle) are based on relational algebra concepts. In it, the lines are called tuples, and, the tables, are relations. A relation is a set (in the mathematical sense) of tuples, i.e. there is no ordering or connection between them. Because of that, there is no default ordering of lines in a table, and the calculus performed on one line does not impact and it is not impacted by the results of another. Even clauses like ORDER BY, only order tables, and it is not possible to make calculus in a line based on the values of other lines.</p><p id="cf9f" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Simply put, window functions fix this, extending the SQL functionalities, and allowing us to perform calculations in one row based on the values ​​of other lines.</p><h1 id="1928" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Basic cases for understanding/ The Anatomy</h1><p id="a940" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk"><strong class="ob fr">1-Aggregating Without Aggregation</strong></p><p id="e5d3" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">The most trivial example to understand Windows functions is the ability to ‘<em class="ov">aggregate without aggregation</em>’.</p><p id="ca0d" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">When we made an aggregation with traditional GROUP BY, the whole table is condensed into a second table, where each line represents a group’s element. With Windows Functions, instead of condensing the lines, it’s possible to create a new column in the same table containing the aggregation results.</p><p id="17c6" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">For example, if you need to add up all the expenses in your expense table, traditionally you would do:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="48cc" class="pf ne fq pc b bg pg ph l pi pj">SELECT SUM(value) AS total FROM myTable</span></pre><p id="e864" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">With Windows functions, you would make something like that:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="a889" class="pf ne fq pc b bg pg ph l pi pj">SELECT *, SUM(value) OVER() FROM myTable<br/>-- Note that the window function is defined at column-level<br/>-- in the query</span></pre><p id="191c" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">The image below shows the results:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pk"><img src="../Images/515a0dd1db51ff15a16402b7e56af807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0mGHUdQ4wLnLppQw1Dxkhg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 1. Traditional Group By vs Windows Functions.</figcaption></figure><p id="ac39" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Rather than creating a new table, it will return the aggregation’s value in a new column. Note that the value is the same, but the table was not ‘<em class="ov">summarized</em>’, the original lines were maintained — we just calculated an <em class="ov">aggregation without aggregating</em> the table ;)</p><p id="6fd4" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">The OVER clause is the indication that we’re creating a window function. This clause defines over which lines the calculation will be made. It is empty in the code above, so it will calculate the SUM() over all the lines.</p><p id="13fc" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">This is useful when we need to make calculations based on totals (or averages, minimums, maximums) of columns. For example, to calculate how much each expense contributes in percentage relative to the total.</p><p id="1b31" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">In real cases, we might also want the detail by some category, like in the example in image 2, where we have company expenses by department. Again, we can achieve the total spent by each department with a simple GROUP BY:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="048d" class="pf ne fq pc b bg pg ph l pi pj">SELECT depto, sum(value) FROM myTable GROUP BY depto</span></pre><p id="9d9a" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Or specify a PARTITION logic in the window function:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="1d0b" class="pf ne fq pc b bg pg ph l pi pj">SELECT *, SUM(value) OVER(PARTITION BY depto) FROM myTable</span></pre><p id="d0c1" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">See the result:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pk"><img src="../Images/0947321d3d95e41d31ad0db854d715d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCzV_stsaA4k9ksr7ZKDBA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 2. Traditional Group By vs Windows Functions II.</figcaption></figure><p id="9a18" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">This example helps to understand why the operation is called a ‘window’ function — the OVER clause defines a set of lines over which the corresponding function will operate, a ‘window’ in the table.</p><p id="2c2b" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">In the case above, the SUM() function will operate in the partitions created by the depto column (RH and SALES) — it will sum all the values in the ‘value’ column for each item in the depto column in isolation. The group the line is part of (RH or SALES) determines the value in the ‘Total’ column.</p><p id="0600" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk"><strong class="ob fr">2 — Time and Ordering awareness</strong></p><p id="c439" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Sometimes we need to calculate the value of a column in a row based on the values of other rows. A classic example is the yearly growth in a country’s GDP, computed using the current and the previous value.</p><p id="6117" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Computations of this kind, where we need the value of the past year, the difference between the current and the next rows, the first value of a series, and so on are a testament to the Windows function’s power. In fact, I don’t know if this behavior could be achieved with standard SQL commands! It probably could, but would be a very complex query…</p><p id="0114" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">But windows functions made it straightforward, see the image below (table recording some child’s height):</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pk"><img src="../Images/d21d9b89afae09daf771815ebdbfa173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71CY0AmciMoR29N4T38QGQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 3. Analytical Function example.</figcaption></figure><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="73d2" class="pf ne fq pc b bg pg ph l pi pj">SELECT <br/>  year, height, <br/>  LAG(height) OVER (ORDER BY year) AS height_last_year<br/>FROM myTable</span></pre><p id="7ce6" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">The function LAG( ‘column’ ) is responsible for referencing the value of ‘column’ in the previous row. You can imagine it as a sequence of steps: In the second line, consider the value of the first; In the third, the value of the second; and so on… The first line doesn’t count (hence the <em class="ov">NULL</em>), as it has no predecessor.</p><p id="3037" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Naturally, some ordering criterion is needed to define what the ‘previous line’ is. And that’s another important concept in Windows functions: <strong class="ob fr">analytical functions</strong>.</p><p id="5864" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">In contrast to traditional SQL functions, analytical functions (like LAG) consider that there exists an ordering in the lines — and this order is defined by the clause ORDER BY inside OVER(), i.e., the concept of first, second, third lines and so on is defined inside the OVER keyword. The main characteristic of these functions is the ability to reference other rows relative to the current row: LAG references the previous row, LEAD references the next rows, FIRST references the first row in the partition, and so on.</p><p id="6c05" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">One nice thing about LAG and LEAD is that both accept a second argument, the offset, which specifies how many rows forward (for LEAD) or backward (for LAG) to look.</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="494d" class="pf ne fq pc b bg pg ph l pi pj">SELECT <br/>    LAG(height,  2) OVER (ORDER BY year) as height_two_years_ago,<br/>    LAG(height,  3) OVER (ORDER BY year) as height_three_years_ago,<br/>    LEAD(height)    OVER (ORDER BY year) as height_next_year<br/>FROM ...</span></pre><p id="b2bd" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">And it is also perfectly possible to perform calculations with these functions:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="a7de" class="pf ne fq pc b bg pg ph l pi pj">SELECT <br/>    100*height/(LAG(height) OVER (ORDER BY year)) <br/>    AS "annual_growth_%"<br/>FROM ...</span></pre><p id="0fa6" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk"><strong class="ob fr">3 — Time Awareness and Aggregation</strong></p><p id="de76" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Time and space are only one — once said Einsteinm, or something like that, I don’t know ¯\_(ツ)_/¯</p><p id="6e7d" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Now that we know how to partition and order, we can use these two together! Going back to the previous example, let’s suppose there are more kids on that table and we need to compute the growth rate of each one. It’s very simple, just combine ordering and partitioning! Let’s order by year and partition by child name.</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="dc91" class="pf ne fq pc b bg pg ph l pi pj">SELECT 1-height/LAG(height) OVER (ORDER BY year PARTITION BY name) ...</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pk"><img src="../Images/922cd5ae7576c1932396cd98d0439a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehdfWQdb1hmX-T9VVSrVMQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 4. ORDER BY + PARTITION BY</figcaption></figure><p id="e1b9" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">The above query does the following — Partitions the table by child and, in each partition, orders the values ​​by year and divides the current year height value with the previous value (and subtracts the result from one).</p><p id="cd23" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">We’re getting closer to the full concept of ‘window’! It’s a table slice, a set of rows grouped by the columns defined in PARTITION BY that are ordered by the fields in ORDER BY, where all the computations are made considering only the rows in the same group (partition) and a specific ordering.</p><p id="eada" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk"><strong class="ob fr">4-Ranking and Position</strong></p><p id="ee12" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Windows functions can be divided into three categories, two of which we already talked about: Aggregation functions ( COUNT, SUM, AVG, MAX, … ) and Analytical Functions ( LAG, LEAD, FIRST_VALUE, LAST_VALUE, … ).</p><p id="7067" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">The third group is the simplest — Ranking Functions, with its greatest exponent being the row_number() function, which returns an integer representing the position of a row in the group (based on the defined order).</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="d603" class="pf ne fq pc b bg pg ph l pi pj">SELECT row_number() OVER(ORDER BY score)</span></pre><p id="6c5a" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Ranking functions, as the name indicates, return values based on the position of the line in the group, defined by the ordering criteria. ROW_NUMBER, RANK, and NTILE are some of the most used.</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/48c1e37784164faa6c962419619ba7d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mk6hLrmaWvf9OpFqvXa_Nw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 5. Ranking Function example</figcaption></figure><p id="7663" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">In the image above, a row number is created based on each player’s score</p><p id="8299" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">… and yes, it commits the atrocious programming sin of starting from 1.</p><p id="1ee7" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk"><strong class="ob fr">5-Window size</strong></p><p id="cd36" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">All the functions presented till this point consider ALL the rows in the partition/group when computing the results. For example, the SUM() described in the first example considers all department’s rows to compute the total.</p><p id="94ae" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">But it is possible to specify a smaller window size, i.e. how many lines before and after the current line should be considered in the computations. This is a helpful functionality to calculate moving averages / rolling windows.</p><p id="eea0" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Let’s consider the following example, with a table containing the daily number of cases of a certain disease, where we need to compute the average number of cases considering the current day and the two previous. Note that it’s possible to solve this problem with the LAG function, shown earlier:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="4328" class="pf ne fq pc b bg pg ph l pi pj">SELECT<br/>( n_cases + LAG(n_cases, 1) + LAG(n_cases, 2) )/3<br/>OVER (ORDER BY date_reference)</span></pre><p id="9ae0" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">But we can achieve the same result more elegantly using the concept of <strong class="ob fr">frames</strong>:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="8f3f" class="pf ne fq pc b bg pg ph l pi pj">SELECT<br/>AVG(n_cases)<br/>OVER (<br/>	ORDER BY date_reference<br/>	ROWS BETWEEN 2 PRECEDING AND CURRENT ROW	<br/>)</span></pre><p id="4449" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">The frame above specifies that we must calculate the average looking only for the two previous (PRECEDING) rows and the current row. If we desire to consider the previous, the current line, and the following line, we can change the frame:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="f26e" class="pf ne fq pc b bg pg ph l pi pj">AVG(n_cases)<br/>OVER (<br/>	ORDER BY date_reference<br/>	ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING<br/>)</span></pre><p id="2395" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">And that’s all a frame is — a way to limit a function’s reach to a specific bound. By default (in most cases), windows functions consider the following frame:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="31c8" class="pf ne fq pc b bg pg ph l pi pj">ROWS BETWEEN UNBOUDED PRECEDING AND CURRENT ROW<br/>-- ALL THE PREVIOUS ROWS + THE CURRENT ROW</span></pre><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/63a58c1627d3e6cb5a9756f33d45be17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PM8G19z30ZBcmybv0Tddtw.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 6. Exploring Window Size definition</figcaption></figure></div></div></div><div class="ab cb pm pn po pp" role="separator"><span class="pq by bm pr ps pt"/><span class="pq by bm pr ps pt"/><span class="pq by bm pr ps"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="1d48" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">I hope this introduction helps you better understand what Windows functions are, how they work, and their syntax in practice. Naturally, many more keywords can be added to Windows functions, but I think this introduction already covers many commands you’ll likely use in everyday life. Now, let’s see some interesting practical applications that I use in my daily routine to solve problems — some are very curious!</p><h1 id="64c4" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Curious and Interesting use cases for windows functions</h1><h2 id="6bb1" class="pu ne fq bf nf pv pw px ni py pz qa nl oi qb qc qd om qe qf qg oq qh qi qj qk bk">Cumulative Sum over time</h2><p id="e954" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">This is one of the most classic cases of using windows functions.</p><p id="8c08" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Imagine a table with your salary per month and you want to know how much you earned in each month cumulatively (considering all previous months), this is how it works:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/8c463284ee60b1bc1514217408428556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1LQvsywmrG1R5Lp-ZcUYg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 7. Practical example — Cumulative SUM</figcaption></figure><p id="dac3" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Pretty simple, right?</p><p id="4398" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">An interesting thing to note in this query is that the SUM() function considers the current row and all previous rows to calculate the aggregation, as mentioned previously.</p><h2 id="4f3b" class="pu ne fq bf nf pv pw px ni py pz qa nl oi qb qc qd om qe qf qg oq qh qi qj qk bk">Duration of events in log tables</h2><p id="6c57" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I recently used this one in my post <a class="af nc" rel="noopener" target="_blank" href="/my-first-billion-of-rows-in-duckdb-11873e5edbb5"><strong class="ob fr">My First Billion (of Rows) in DuckDB</strong></a>, in which I manipulate logs from electronic voting machines in Brazil, it’s worth checking if you’re interested in the processing of large volumes of data.</p><p id="ff55" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">In summary, imagine a log table in which each event is composed of a timestamp that indicates when it started, its name, and a unique identifier. Considering that each event only starts when the previous one ends, we can easily add a column with the event duration as follows:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/c1bd06a9e78748dcf647153074683b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSR_O1VZYlrRXf--ByWKSQ.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 8. Practical example — Event Duration in Logs</figcaption></figure><h2 id="80e0" class="pu ne fq bf nf pv pw px ni py pz qa nl oi qb qc qd om qe qf qg oq qh qi qj qk bk">Fill missing values (With the last occurrence)</h2><p id="9864" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Machine learning classic with pandas! Just do a fillna, bfill or whatever, and that’s it, we fill in the null values with the last valid occurrence.</p><p id="0222" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">How to do this in SQL? Simple!</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/f641b9eb882d0002c966009bd0bf68da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJ8nStGbqnLLKrCSUi1aqA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 8. Practical example — Filling Missing Values I</figcaption></figure><p id="1ae4" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">When we first study machine learning, we work a lot with pandas and get used to their high-level functions. However, when working on a real project, the data volume can be very large, so we may not be lucky enough to use pandas and need to switch to tools such as PySpark, Snowflake, Hive+hadoop, etc — all of which, in one way or another, can be operated in SQL. Therefore, I think it is important to learn how to do these treatments and preprocessing in SQL.</p><h2 id="6dcd" class="pu ne fq bf nf pv pw px ni py pz qa nl oi qb qc qd om qe qf qg oq qh qi qj qk bk">Filling missing values (With the avg of preceding rows)</h2><p id="553f" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">A slightly more elaborate way of filling in null values, but still simple!</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/7c734d992b57a4881e1a4b9376119521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Z-xMWi7xIP6Rs_41PbGPg.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 8. Practical example — Filling Missing Values II</figcaption></figure><p id="ec22" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">This example highlights that, despite seeming complicated and special, windows functions can be used just like normal columns! They can be included in CASE, calculations can be done with them and so on. One of the few restrictions I know of is that they cannot be placed directly in a WHERE clause:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="8241" class="pf ne fq pc b bg pg ph l pi pj">SELECT * FROM<br/>WHERE SUM() OVER() &gt; 10 -- This is not possible in postgres</span></pre><h2 id="77dc" class="pu ne fq bf nf pv pw px ni py pz qa nl oi qb qc qd om qe qf qg oq qh qi qj qk bk">Row Deduplication based on a set of columns</h2><p id="78ad" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Another classic of windows functions! Sometimes we need to deduplicate rows in a table based on just one set of columns.</p><p id="ac05" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Of course, in SQL we have the DISTINCT clause, but it only works if the full line is duplicated. If a table has several lines with the same value in an ID column but with different values ​​in the remaining columns, it’s possible to deduplicate with the following logic:</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/0419e5ca21c880e1c1b1b7585aad7f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BfR-5msK97_U8_Icb0Rm8Q.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 9. Practical example — Deduplication</figcaption></figure><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="6553" class="pf ne fq pc b bg pg ph l pi pj">SELECT *<br/>  FROM (<br/>   SELECT<br/>   ROW_NUMBER() OVER (PARTITION BY id) as row_number<br/>  )<br/>WHERE row_number = 1</span></pre><p id="e92b" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">This operation also allows data versioning! For example, if we save a new line for each time a user changed their name in the system with the date of change (instead of changing the existing line), we can retrieve each user’s current name:</p><pre class="mm mn mo mp mq pb pc pd bp pe bb bk"><span id="b85b" class="pf ne fq pc b bg pg ph l pi pj">SELECT<br/>    *<br/>FROM<br/>(<br/>  SELECT <br/>    name, <br/>    row_number() OVER (PARTITION BY id ORDER BY DATE DESC) AS row_number<br/>  FROM myTable<br/>) AS subquery<br/>WHERE row_number = 1</span></pre><h2 id="23ef" class="pu ne fq bf nf pv pw px ni py pz qa nl oi qb qc qd om qe qf qg oq qh qi qj qk bk">Percentage of occurrences of a group/class over the total number of rows</h2><p id="6064" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">Consider a table that lists various pets, which can be dogs, cats, or birds. We need to add a column to each row indicating the percentage that each pet type represents out of the total count of all pets. This task is solved using not one, but two window functions!</p><figure class="mm mn mo mp mq mr mj mk paragraph-image"><div role="button" tabindex="0" class="ms mt ed mu bh mv"><div class="mj mk pl"><img src="../Images/9510c84678562ece6e866050e410dbb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QJhS7vFukQWzdWc7v_vRpA.png"/></div></div><figcaption class="mx my mz mj mk na nb bf b bg z dx">Image 10. Practical example — Percentage of Occurences</figcaption></figure><p id="4811" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">In the image above, to make it more educational, I added two columns to represent the result of each window function, but only the rightmost column is actually created.</p></div></div></div><div class="ab cb pm pn po pp" role="separator"><span class="pq by bm pr ps pt"/><span class="pq by bm pr ps pt"/><span class="pq by bm pr ps"/></div><div class="fj fk fl fm fn"><div class="ab cb"><div class="ci bh ev ew ex ey"><p id="27eb" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">And you, do you have any interesting windows functions cases that you would like to share? Please leave it in the comments!</p><h1 id="e9b7" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">Conclusion</h1><p id="d72e" class="pw-post-body-paragraph nz oa fq ob b go oc od oe gr of og oh oi oj ok ol om on oo op oq or os ot ou fj bk">I wouldn’t dare say that SQL is vintage or classic, as these, although positive, refer to the past. For me, SQL is present, pervasive, and, without a doubt, an essential language for anyone working in the data area.</p><p id="ba13" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">However, several problems may seem complicated to solve using just SQL itself and, at these times, having a good knowledge of the language and its capabilities is really important. Without windows functions, many problems considered common — when looking from a Pythonic perspective — would be very difficult or even impossible to solve. But we can do magic if we know how to use the tools correctly!</p><p id="979f" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">I hope this post has helped you better understand how Windows functions work and what types of problems they can solve in practice. All the material presented here was mainly based on PostgreSQL syntax and may not necessarily work right away in another database, but the most important thing is the logic itself. As always, I’m not an expert on the subject and I strongly recommend deeper reading — and lots of practice — to anyone interested in the subject.</p><p id="59f6" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">Thank you for reading! ;)</p><h1 id="6a01" class="nd ne fq bf nf ng nh gq ni nj nk gt nl nm nn no np nq nr ns nt nu nv nw nx ny bk">References</h1><blockquote class="ql qm qn"><p id="b667" class="nz oa ov ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">All the code is available in <a class="af nc" href="https://github.com/jaumpedro214/posts/tree/main/sql_window_functions" rel="noopener ugc nofollow" target="_blank">this GitHub repository</a>.<br/>Interested in more works like this one? Visit my <a class="af nc" href="https://github.com/jaumpedro214/posts" rel="noopener ugc nofollow" target="_blank">posts repository</a>.</p></blockquote><p id="d8a6" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk">[1]<em class="ov"> Data processing with PostgreSQL window functions</em>. (n.d.). Timescale. <a class="af nc" href="https://www.timescale.com/learn/postgresql-window-functions" rel="noopener ugc nofollow" target="_blank">Link</a>.<br/>[2] Kho, J. (2022, June 5). An easy guide to advanced SQL window functions — towards data science. <a class="af nc" rel="noopener" target="_blank" href="/a-guide-to-advanced-sql-window-functions-f63f2642cbf9"><em class="ov">Medium</em></a>.<br/>[3] Markingmyname. (2023, November 16). <em class="ov">Funções analíticas (Transact-SQL) — SQL Server</em>. <a class="af nc" href="https://learn.microsoft.com/pt-br/sql/t-sql/functions/analytic-functions-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank">Microsoft Learn</a>.<br/>[4] PostgreSQL Tutorial. (2021, April 27). <em class="ov">PostgreSQL Window Functions: The Ultimate Guide</em>. <a class="af nc" href="https://www.postgresqltutorial.com/postgresql-window-function/" rel="noopener ugc nofollow" target="_blank">Link</a>.<br/>[5] VanMSFT. (2023, May 23). <em class="ov">OVER Clause (Transact-SQL) — SQL Server</em>. <a class="af nc" href="https://learn.microsoft.com/en-us/sql/t-sql/queries/select-over-clause-transact-sql?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank">Microsoft Learn</a>.<br/>[6]<em class="ov"> Window Functions</em>. (n.d.). <a class="af nc" href="https://www.sqlite.org/draft/windowfunctions.html" rel="noopener ugc nofollow" target="_blank">SQLite Official docs</a>. <br/>[7]<em class="ov"> Window Functions</em>. (2014, July 24). <a class="af nc" href="https://www.postgresql.org/docs/8.4/functions-window.html" rel="noopener ugc nofollow" target="_blank">PostgreSQL Documentation</a>.</p><p id="7698" class="pw-post-body-paragraph nz oa fq ob b go ow od oe gr ox og oh oi oy ok ol om oz oo op oq pa os ot ou fj bk"><em class="ov">All images in this post are made by the author.</em></p></div></div></div></div>    
</body>
</html>