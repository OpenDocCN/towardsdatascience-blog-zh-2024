- en: How to Build a RAG System with a Self-Querying Retriever in LangChain
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¦‚ä½•æ„å»ºä¸€ä¸ªå¸¦è‡ªæŸ¥è¯¢æ£€ç´¢å™¨çš„RAGç³»ç»Ÿ
- en: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad?source=collection_archive---------0-----------------------#2024-04-25](https://towardsdatascience.com/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad?source=collection_archive---------0-----------------------#2024-04-25)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://towardsdatascience.com/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad?source=collection_archive---------0-----------------------#2024-04-25](https://towardsdatascience.com/how-to-build-a-rag-system-with-a-self-querying-retriever-in-langchain-16b4fa23e9ad?source=collection_archive---------0-----------------------#2024-04-25)
- en: RAG + Filtering with Metadata = Great Movie Recommendations ğŸ¿
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: RAG + å…ƒæ•°æ®è¿‡æ»¤ = æå¥½çš„ç”µå½±æ¨è ğŸ¿
- en: '[](https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------)[![Ed
    Izaguirre](../Images/c9eded1f06c47571baa662107428483f.png)](https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------)
    [Ed Izaguirre](https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------)[![Ed
    Izaguirre](../Images/c9eded1f06c47571baa662107428483f.png)](https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------)
    [Ed Izaguirre](https://medium.com/@ed.izaguirre?source=post_page---byline--16b4fa23e9ad--------------------------------)'
- en: Â·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------)
    Â·12 min readÂ·Apr 25, 2024
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Â·å‘è¡¨äº [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--16b4fa23e9ad--------------------------------)
    Â·é˜…è¯»æ—¶é—´12åˆ†é’ŸÂ·2024å¹´4æœˆ25æ—¥
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/f25989e1bd8f991ca2ce6d84a27ab9ef.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/f25989e1bd8f991ca2ce6d84a27ab9ef.png)'
- en: Image of a person watching television. Image created in DALLÂ·E 3.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç”µè§†è§‚çœ‹è€…çš„å›¾ç‰‡ã€‚å›¾ç‰‡ç”±DALLÂ·E 3åˆ›å»ºã€‚
- en: Table of Contents
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç›®å½•
- en: '[Retrieving the data](#86c4)'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[æ£€ç´¢æ•°æ®](#86c4)'
- en: '[Upload documents to Pinecone](#53e3)'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[å°†æ–‡æ¡£ä¸Šä¼ åˆ°Pinecone](#53e3)'
- en: '[Creating the self-querying retriever](#21a7)'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[åˆ›å»ºè‡ªæŸ¥è¯¢æ£€ç´¢å™¨](#21a7)'
- en: '[Creating the chat model](#409b)'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[åˆ›å»ºèŠå¤©æ¨¡å‹](#409b)'
- en: '[Demonstration](#3817)'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[æ¼”ç¤º](#3817)'
- en: Links
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: é“¾æ¥
- en: 'Edit: I have updated Film Search and rebranded it as Rosebud. I have also made
    it free to use! [Check out the website here.](https://filmsearch.azurewebsites.net/)'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç¼–è¾‘ï¼šæˆ‘æ›´æ–°äº†ç”µå½±æœç´¢ï¼Œå¹¶å°†å…¶é‡æ–°å‘½åä¸ºRosebudã€‚æˆ‘è¿˜å°†å…¶æ”¹ä¸ºå…è´¹ä½¿ç”¨ï¼ [åœ¨è¿™é‡ŒæŸ¥çœ‹ç½‘ç«™ã€‚](https://filmsearch.azurewebsites.net/)
- en: Also check out my new article improving this app! [Link.](/productionizing-a-rag-app-04c857e0966e)
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¿˜å¯ä»¥æŸ¥çœ‹æˆ‘å…³äºæ”¹è¿›è¿™ä¸ªåº”ç”¨ç¨‹åºçš„æ–°æ–‡ç« ï¼ [é“¾æ¥.](/productionizing-a-rag-app-04c857e0966e)
- en: '[Link to GitHub with code](https://github.com/EdIzaguirre/Rosebud)'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[GitHubä¸Šçš„ä»£ç é“¾æ¥](https://github.com/EdIzaguirre/Rosebud)'
- en: Recently, I was browsing Max trying to find a movie to watch. Typically this
    involves browsing through the various lists presented to me, reading a few descriptions,
    and then picking something that sounds vaguely interesting. Sometimes it is a
    hit, sometimes not so much. I usually only touch the search function if I know
    the title of a film I am trying to watch or know the name of an actor I want.
    Otherwise searching is just not very useful.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€è¿‘ï¼Œæˆ‘åœ¨æµè§ˆMaxï¼Œè¯•å›¾æ‰¾åˆ°ä¸€éƒ¨ç”µå½±è§‚çœ‹ã€‚é€šå¸¸è¿™åŒ…æ‹¬æµè§ˆå‘ˆç°ç»™æˆ‘çš„å„ç§åˆ—è¡¨ï¼Œé˜…è¯»å‡ ä¸ªæè¿°ï¼Œç„¶åæŒ‘é€‰å‡ºå¬èµ·æ¥ç•¥å¾®æœ‰è¶£çš„ä¸œè¥¿ã€‚æœ‰æ—¶å€™è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæœ‰æ—¶å€™åˆ™ä¸å°½å¦‚äººæ„ã€‚å¦‚æœæˆ‘çŸ¥é“è‡ªå·±æƒ³çœ‹çš„ç”µå½±æ ‡é¢˜æˆ–æ¼”å‘˜çš„åå­—ï¼Œæˆ‘é€šå¸¸æ‰ä¼šä½¿ç”¨æœç´¢åŠŸèƒ½ã€‚å¦åˆ™ï¼Œæœç´¢åŠŸèƒ½å°±ä¸å¤ªæœ‰ç”¨äº†ã€‚
- en: 'I was suddenly hit with an idea: why canâ€™t I use natural language to query
    a movie based more on the *vibe* or the *substance* of a movie, rather than just
    a title or actor? For example, why canâ€™t I fire up Max, Netflix, or Hulu and type
    one of the following queries into the search bar:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘çªç„¶æœ‰äº†ä¸€ä¸ªæƒ³æ³•ï¼šä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½ä½¿ç”¨è‡ªç„¶è¯­è¨€ï¼Œæ ¹æ®ç”µå½±çš„*æ°›å›´*æˆ–*å†…å®¹*æ¥æŸ¥è¯¢ç”µå½±ï¼Œè€Œä¸ä»…ä»…æ˜¯åŸºäºæ ‡é¢˜æˆ–æ¼”å‘˜å‘¢ï¼Ÿä¾‹å¦‚ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½æ‰“å¼€Maxã€Netflixæˆ–Huluï¼Œç„¶ååœ¨æœç´¢æ ä¸­è¾“å…¥ä»¥ä¸‹æŸ¥è¯¢ä¹‹ä¸€ï¼š
- en: '*Find me drama movies in English that are less than 2 hours long and feature
    pets.*'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*å¸®æˆ‘æ‰¾ä¸€äº›è‹±æ–‡çš„æˆå‰§ç”µå½±ï¼Œæ—¶é•¿ä¸è¶…è¿‡2å°æ—¶ï¼Œå¹¶ä¸”æœ‰å® ç‰©ã€‚*'
- en: '*Recommend zombie movies, but make sure they are funny.*'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*æ¨èåƒµå°¸ç”µå½±ï¼Œä½†è¦ç¡®ä¿å®ƒä»¬æ˜¯æœ‰è¶£çš„ã€‚*'
- en: '*I liked â€˜Everything Everywhere all at Onceâ€™. Give me a similar film, but darker.*'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*æˆ‘å–œæ¬¢ã€Šç¬æ¯å…¨å®‡å®™ã€‹ã€‚ç»™æˆ‘ä¸€éƒ¨ç±»ä¼¼çš„ç”µå½±ï¼Œä½†æ›´é»‘æš—ä¸€äº›ã€‚*'
- en: The beauty of this approach goes beyond a more natural way to search for films.
    This approach also preserves a userâ€™s privacy. Rather than mine a userâ€™s actions,
    likes, and dislikes to feed to a recommender system, **this system uses no user
    data at all.** The only thing required is a query.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•çš„ç¾å¦™ä¹‹å¤„ä¸ä»…ä»…åœ¨äºæä¾›äº†æ›´è‡ªç„¶çš„æœç´¢ç”µå½±æ–¹å¼ã€‚è¿™ç§æ–¹æ³•è¿˜ä¿æŠ¤äº†ç”¨æˆ·çš„éšç§ã€‚**è¿™ä¸ªç³»ç»Ÿå®Œå…¨ä¸ä½¿ç”¨ä»»ä½•ç”¨æˆ·æ•°æ®**ã€‚æ‰€éœ€çš„å”¯ä¸€å†…å®¹å°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢ã€‚
- en: So I built Film Search. This is a RAG-based system that takes in a userâ€™s query,
    embeds it, and does a similarity search to find similar films. But it goes beyond
    vanilla RAG. This system uses what is called a **self-querying retriever.** What
    this allows for is filtering movies by their metadata, before doing a similarity
    search. So if a user has a query like â€œ*Recommend horror movies made after 1980
    that features lots of explosions*â€, the search will first filter out all films
    that are not â€œhorror movies made after the year 1980â€ before doing a similarity
    search for films that â€œfeature lots of explosionsâ€.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥æˆ‘æ„å»ºäº†ç”µå½±æœç´¢ç³»ç»Ÿã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„ç³»ç»Ÿï¼Œå®ƒæ¥æ”¶ç”¨æˆ·æŸ¥è¯¢ï¼Œå°†å…¶åµŒå…¥å¹¶è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œæ‰¾åˆ°ç±»ä¼¼çš„ç”µå½±ã€‚ä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ™®é€šçš„RAGç³»ç»Ÿã€‚è¿™ä¸ªç³»ç»Ÿä½¿ç”¨äº†æ‰€è°“çš„**è‡ªæŸ¥è¯¢æ£€ç´¢å™¨**ã€‚è¿™ä½¿å¾—åœ¨è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ä¹‹å‰ï¼Œèƒ½å¤Ÿé€šè¿‡ç”µå½±çš„å…ƒæ•°æ®å¯¹å…¶è¿›è¡Œç­›é€‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœç”¨æˆ·çš„æŸ¥è¯¢æ˜¯â€œ*æ¨è1980å¹´ååˆ¶ä½œçš„ææ€–ç”µå½±ï¼Œå¹¶ä¸”åŒ…å«å¤§é‡çˆ†ç‚¸åœºé¢*â€ï¼Œæœç´¢ä¼šé¦–å…ˆè¿‡æ»¤æ‰æ‰€æœ‰ä¸æ˜¯â€œ1980å¹´ååˆ¶ä½œçš„ææ€–ç”µå½±â€çš„å½±ç‰‡ï¼Œç„¶åå†è¿›è¡Œå…³äºâ€œåŒ…å«å¤§é‡çˆ†ç‚¸åœºé¢â€çš„ç›¸ä¼¼æ€§æœç´¢ã€‚
- en: In this article, I will provide a high-level overview of how I made this system.
    The full code is provided in the links above if you want to go deeper.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æä¾›ä¸€ä¸ªå…³äºå¦‚ä½•æ„å»ºè¿™ä¸ªç³»ç»Ÿçš„é«˜å±‚æ¬¡æ¦‚è¿°ã€‚å¦‚æœä½ æƒ³æ·±å…¥äº†è§£ï¼Œå®Œæ•´çš„ä»£ç å¯ä»¥é€šè¿‡ä¸Šé¢çš„é“¾æ¥è·å–ã€‚
- en: Letâ€™s dive in.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ã€‚
- en: Retrieving the data
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è·å–æ•°æ®
- en: 'The data for this project came from [The Movie Database (TMDB)](https://developer.themoviedb.org/docs/getting-started),
    with permission from the owner. Their API was simple to use, well maintained,
    and not heavily rate limited. I pulled the following film attributes from their
    API:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªé¡¹ç›®çš„æ•°æ®æ¥è‡ªäº[The Movie Database (TMDB)](https://developer.themoviedb.org/docs/getting-started)ï¼Œå¹¶ä¸”å¾—åˆ°äº†æ‰€æœ‰è€…çš„è®¸å¯ã€‚ä»–ä»¬çš„APIç®€å•æ˜“ç”¨ï¼Œç»´æŠ¤è‰¯å¥½ï¼Œå¹¶ä¸”é™åˆ¶ä¸å¤šã€‚æˆ‘ä»ä»–ä»¬çš„APIä¸­æå–äº†ä»¥ä¸‹ç”µå½±å±æ€§ï¼š
- en: Title
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç‰‡å
- en: Runtime (minutes)
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç‰‡é•¿ï¼ˆåˆ†é’Ÿï¼‰
- en: Language
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¯­è¨€
- en: Overview
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¦‚è¿°
- en: Release Year
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä¸Šæ˜ å¹´ä»½
- en: Genre
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç±»å‹
- en: Keywords describing the film
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æè¿°ç”µå½±çš„å…³é”®è¯
- en: Actors
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¼”å‘˜
- en: Directors
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¯¼æ¼”
- en: Places to stream
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æµåª’ä½“æ’­æ”¾åœ°ç‚¹
- en: Places to buy
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è´­ä¹°åœ°ç‚¹
- en: Places to rent
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç§Ÿèµåœ°ç‚¹
- en: List of Production Companies
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åˆ¶ä½œå…¬å¸åˆ—è¡¨
- en: 'Below is a snippet of how data was pulled using the TMDB API and the response
    library from Python:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨TMDB APIå’ŒPythonçš„å“åº”åº“æå–æ•°æ®çš„ç‰‡æ®µï¼š
- en: '[PRE0]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Notice that the query requires movie IDs (which were also obtained using TMDB),
    as well as `append_to_response`, which allows me to pull several types of data
    e.g. keywords, watch providers, credits (directors and actors) in additional to
    some basic information about the film. There is also some basic scaffolding code
    in case I hit a rate limit, although this was never observed.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼ŒæŸ¥è¯¢éœ€è¦ç”µå½±IDï¼ˆè¿™äº›IDä¹Ÿæ˜¯é€šè¿‡TMDBè·å¾—çš„ï¼‰ï¼Œä»¥åŠ`append_to_response`ï¼Œå®ƒå…è®¸æˆ‘æ‹‰å–å¤šç§ç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚å…³é”®è¯ã€è§‚çœ‹æä¾›è€…ã€ä¿¡ç”¨ä¿¡æ¯ï¼ˆå¯¼æ¼”å’Œæ¼”å‘˜ï¼‰ä»¥åŠä¸€äº›å…³äºç”µå½±çš„åŸºæœ¬ä¿¡æ¯ã€‚è¿™é‡Œè¿˜åŒ…æ‹¬ä¸€äº›åŸºæœ¬çš„æ¡†æ¶ä»£ç ï¼Œä»¥é˜²æˆ‘é‡åˆ°é€Ÿç‡é™åˆ¶ï¼Œå°½ç®¡æˆ‘ä»æœªé‡åˆ°è¿‡è¿™ç§æƒ…å†µã€‚
- en: 'We then have to parse the JSON response. Here is a snippet showing how this
    was done for parsing the actors and directors who worked on a film:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è§£æJSONå“åº”ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç‰‡æ®µï¼Œå±•ç¤ºäº†å¦‚ä½•è§£æå‚ä¸ç”µå½±åˆ¶ä½œçš„æ¼”å‘˜å’Œå¯¼æ¼”ä¿¡æ¯ï¼š
- en: '[PRE1]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Note that I limited the number of actors to the top five in a film. I also had
    to specify that I was only interested in directors, as the response included other
    types of crew members such as editors, costume designers, etc.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæˆ‘å°†æ¯éƒ¨ç”µå½±çš„æ¼”å‘˜æ•°é‡é™åˆ¶åœ¨å‰äº”åã€‚æˆ‘è¿˜å¿…é¡»æŒ‡å®šåªå…³å¿ƒå¯¼æ¼”ï¼Œå› ä¸ºå“åº”ä¸­è¿˜åŒ…å«äº†å…¶ä»–ç±»å‹çš„å·¥ä½œäººå‘˜ï¼Œæ¯”å¦‚å‰ªè¾‘å¸ˆã€æœè£…è®¾è®¡å¸ˆç­‰ã€‚
- en: All of this data was then compiled into CSV files. Each attribute listed above
    became a column, and each row now represents a particular film. Below is a short
    snippet of films from the `2008_movie_collection_data.csv` file that was created
    programatically. For this project I got roughly the 100 top films from the years
    1920â€“2023.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€æœ‰è¿™äº›æ•°æ®éšåè¢«æ±‡æ€»æˆäº†CSVæ–‡ä»¶ã€‚ä¸Šé¢åˆ—å‡ºçš„æ¯ä¸ªå±æ€§éƒ½å˜æˆäº†ä¸€ä¸ªåˆ—ï¼Œè€Œæ¯ä¸€è¡Œç°åœ¨ä»£è¡¨ä¸€éƒ¨ç‰¹å®šçš„ç”µå½±ã€‚ä»¥ä¸‹æ˜¯ä»`2008_movie_collection_data.csv`æ–‡ä»¶ä¸­æå–çš„ä¸€å°æ®µç”µå½±æ•°æ®ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯é€šè¿‡ç¼–ç¨‹ç”Ÿæˆçš„ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘å¤§çº¦è·å–äº†1920å¹´è‡³2023å¹´é—´çš„100éƒ¨é¡¶çº§ç”µå½±ã€‚
- en: Snippet of movie data for demonstration purposes. By author.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: ç”¨äºæ¼”ç¤ºçš„ç”µå½±æ•°æ®ç‰‡æ®µã€‚ä½œè€…æä¾›ã€‚
- en: Believe it or not, I still have not seen Kung Fu Panda. Perhaps Iâ€™ll have to
    after this project.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: ä¿¡ä¸ä¿¡ç”±ä½ ï¼Œæˆ‘è‡³ä»Šè¿˜æ²¡æœ‰çœ‹è¿‡ã€ŠåŠŸå¤«ç†ŠçŒ«ã€‹ã€‚æˆ–è®¸åœ¨è¿™ä¸ªé¡¹ç›®ä¹‹åæˆ‘å¾—å»çœ‹ä¸€çœ‹ã€‚
- en: Upload documents to Pinecone
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä¸Šä¼ æ–‡æ¡£åˆ°Pinecone
- en: Next I had to upload the csv data to Pinecone. Typically chunking is important
    in a RAG system, but here each â€œdocumentâ€ (row of a CSV file) is fairly short,
    so chunking was not a concern. I first had to convert each CSV file to a LangChain
    document, and then specify which fields should be the primary content and which
    fields should be the metadata.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦å°†csvæ•°æ®ä¸Šä¼ åˆ°Pineconeã€‚åœ¨RAGç³»ç»Ÿä¸­ï¼Œé€šå¸¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†å—ï¼Œä½†è¿™é‡Œæ¯ä¸ªâ€œæ–‡æ¡£â€ï¼ˆCSVæ–‡ä»¶ä¸­çš„ä¸€è¡Œï¼‰éƒ½ç›¸å¯¹è¾ƒçŸ­ï¼Œå› æ­¤ä¸éœ€è¦åˆ†å—ã€‚æˆ‘é¦–å…ˆå°†æ¯ä¸ªCSVæ–‡ä»¶è½¬æ¢ä¸ºLangChainæ–‡æ¡£ï¼Œç„¶åæŒ‡å®šå“ªäº›å­—æ®µåº”è¯¥æ˜¯ä¸»è¦å†…å®¹ï¼Œå“ªäº›å­—æ®µåº”è¯¥æ˜¯metadataã€‚
- en: 'Here is a snippet of code used to construct these documents:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹é¢æ˜¯ç”¨äºæ„å»ºè¿™äº›æ–‡æ¡£çš„ä»£ç ç‰‡æ®µï¼š
- en: '[PRE2]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '`DirectoryLoader` from LangChain takes care of loading all csv files into documents.
    Then I need to specify what should be `page_content` and what should be `metadata`
    . This is an important decision. `page_content` will be embedded and used in similarity
    search during the retrieval phase. `metadata` will be used solely for filtering
    purposes before similarity search is done. I decided to take the `overview` and
    `keywords` properties and embed those, and the rest of the properties would be
    metadata. Further tweaking should be done to see if perhaps `title` should also
    be included in `page_content`, but I found this configuration works well for most
    user queries.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥è‡ªLangChainçš„`DirectoryLoader`è´Ÿè´£å°†æ‰€æœ‰csvæ–‡ä»¶åŠ è½½ä¸ºæ–‡æ¡£ã€‚ç„¶åï¼Œæˆ‘éœ€è¦æŒ‡å®šä»€ä¹ˆå†…å®¹åº”è¯¥æ˜¯`page_content`ï¼Œä»€ä¹ˆå†…å®¹åº”è¯¥æ˜¯`metadata`ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å†³å®šã€‚`page_content`å°†è¢«åµŒå…¥å¹¶åœ¨æ£€ç´¢é˜¶æ®µç”¨äºç›¸ä¼¼åº¦æœç´¢ã€‚`metadata`ä»…åœ¨ç›¸ä¼¼åº¦æœç´¢ä¹‹å‰ç”¨äºè¿‡æ»¤ã€‚
    æˆ‘å†³å®šå°†`overview`å’Œ`keywords`å±æ€§åµŒå…¥åˆ°`page_content`ä¸­ï¼Œè€Œå…¶ä»–å±æ€§åˆ™ä½œä¸ºmetadataã€‚è¿›ä¸€æ­¥è°ƒæ•´åº”è€ƒè™‘æ˜¯å¦å°†`title`ä¹ŸåŒ…å«åœ¨`page_content`ä¸­ï¼Œä½†æˆ‘å‘ç°è¿™ä¸ªé…ç½®å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æŸ¥è¯¢æ•ˆæœå¾ˆå¥½ã€‚
- en: 'Then the documents have to be uploaded to Pinecone. This is a fairly straightforward
    process:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæ–‡æ¡£éœ€è¦ä¸Šä¼ åˆ°Pineconeã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å½“ç›´æ¥çš„è¿‡ç¨‹ï¼š
- en: '[PRE3]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Iâ€™ll just highlight a few things here:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œï¼Œæˆ‘åªæƒ³å¼ºè°ƒå‡ ç‚¹ï¼š
- en: Using an `SQLRecordManager` ensures that duplicate documents are not uploaded
    to Pinecone if this code is run multiple times. If a document is modified, only
    that document is modified in the vector store.
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`SQLRecordManager`å¯ä»¥ç¡®ä¿å¦‚æœè¿™æ®µä»£ç è¿è¡Œå¤šæ¬¡ï¼Œé‡å¤çš„æ–‡æ¡£ä¸ä¼šè¢«ä¸Šä¼ åˆ°Pineconeã€‚å¦‚æœæ–‡æ¡£è¢«ä¿®æ”¹ï¼Œåªæœ‰è¯¥æ–‡æ¡£ä¼šåœ¨å‘é‡å­˜å‚¨ä¸­è¢«æ›´æ–°ã€‚
- en: We are using the classic `text-embedding-ada-002` from OpenAI as our embedding
    model.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯OpenAIçš„ç»å…¸`text-embedding-ada-002`åµŒå…¥æ¨¡å‹ã€‚
- en: Creating the self-querying retriever
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åˆ›å»ºè‡ªæŸ¥è¯¢æ£€ç´¢å™¨
- en: The self-querying retriever will allow us to filter the movies that are retrieved
    during RAG via the metadata we defined earlier. This will dramatically increase
    the usefulness of our film recommender.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: è‡ªæŸ¥è¯¢æ£€ç´¢å™¨å°†å…è®¸æˆ‘ä»¬é€šè¿‡ä¹‹å‰å®šä¹‰çš„metadataè¿‡æ»¤åœ¨RAGè¿‡ç¨‹ä¸­æ£€ç´¢çš„ç”µå½±ã€‚è¿™å°†å¤§å¤§æé«˜æˆ‘ä»¬ç”µå½±æ¨èç³»ç»Ÿçš„å®ç”¨æ€§ã€‚
- en: 'One important consideration when choosing your vector store is to make sure
    that it supports filtering by metadata, because not all do. [Here is a list of
    databases](https://python.langchain.com/docs/integrations/retrievers/self_query)
    by LangChain that support self-querying retrieval. Another important consideration
    is what types of comparators are allowed for each vector store. Comparators are
    the method by which we filter via metadata. For example, we can use the `eq` comparator
    to make sure that our film falls under the science fiction genre: `eq(''Genre'',
    ''Science Fiction'')` . Not all vector stores allow for all comparators. As an
    example, check out the [allowed comparators in Weaviate](https://weaviate.io/developers/weaviate/api/graphql/filters#filter-structure)
    and how they vary from the [comparators in Pinecone](https://docs.pinecone.io/guides/data/filtering-with-metadata#metadata-query-language).
    We need to tell the model about what comparators are allowed to prevent it from
    accidentally writing a forbidden query.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: é€‰æ‹©å‘é‡å­˜å‚¨æ—¶ï¼Œä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ æ˜¯ç¡®ä¿å®ƒæ”¯æŒé€šè¿‡metadataè¿›è¡Œè¿‡æ»¤ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰å‘é‡å­˜å‚¨éƒ½æ”¯æŒã€‚[è¿™æ˜¯LangChainæ”¯æŒè‡ªæŸ¥è¯¢æ£€ç´¢çš„æ•°æ®åº“åˆ—è¡¨](https://python.langchain.com/docs/integrations/retrievers/self_query)ã€‚å¦ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ æ˜¯æ¯ä¸ªå‘é‡å­˜å‚¨å…è®¸å“ªäº›ç±»å‹çš„æ¯”è¾ƒå™¨ã€‚æ¯”è¾ƒå™¨æ˜¯æˆ‘ä»¬é€šè¿‡metadataè¿›è¡Œè¿‡æ»¤çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`eq`æ¯”è¾ƒå™¨æ¥ç¡®ä¿æˆ‘ä»¬çš„ç”µå½±å±äºç§‘å¹»ç±»å‹ï¼š`eq('Genre',
    'Science Fiction')`ã€‚å¹¶éæ‰€æœ‰å‘é‡å­˜å‚¨éƒ½å…è®¸æ‰€æœ‰æ¯”è¾ƒå™¨ã€‚ä½œä¸ºä¾‹å­ï¼Œè¯·æŸ¥çœ‹[Weaviateä¸­å…è®¸çš„æ¯”è¾ƒå™¨](https://weaviate.io/developers/weaviate/api/graphql/filters#filter-structure)ï¼Œä»¥åŠå®ƒä»¬ä¸[Pineconeä¸­çš„æ¯”è¾ƒå™¨](https://docs.pinecone.io/guides/data/filtering-with-metadata#metadata-query-language)çš„å·®å¼‚ã€‚æˆ‘ä»¬éœ€è¦å‘Šè¯‰æ¨¡å‹å…è®¸å“ªäº›æ¯”è¾ƒå™¨ï¼Œä»¥é˜²æ­¢å®ƒæ„å¤–åœ°å†™å‡ºä¸å…è®¸çš„æŸ¥è¯¢ã€‚
- en: In addition to telling the model what comparators exist, we can also feed the
    model examples of user queries and corresponding filters. This is known as **few-shot
    learning**, and it is invaluable to help guide your model.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: é™¤äº†å‘Šè¯‰æ¨¡å‹å­˜åœ¨å“ªäº›æ¯”è¾ƒå™¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»™æ¨¡å‹æä¾›ä¸€äº›ç”¨æˆ·æŸ¥è¯¢çš„ç¤ºä¾‹å’Œç›¸åº”çš„ç­›é€‰æ¡ä»¶ã€‚è¿™è¢«ç§°ä¸º**å°‘é‡æ ·æœ¬å­¦ä¹ **ï¼Œå®ƒå¯¹äºå¸®åŠ©æŒ‡å¯¼ä½ çš„æ¨¡å‹éå¸¸å®è´µã€‚
- en: 'To see where this helps, take a look at the following two user queries:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†çœ‹çœ‹è¿™æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œçœ‹çœ‹ä»¥ä¸‹ä¸¤ä¸ªç”¨æˆ·æŸ¥è¯¢ï¼š
- en: '*â€œRecommend some films by Yorgos Lanthimos.â€*'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*â€œæ¨èä¸€äº›ç”±çº¦å°”æˆˆæ–¯Â·å…°è¥¿è«æ–¯å¯¼æ¼”çš„ç”µå½±ã€‚â€*'
- en: '*â€œFilms similar to Yorgos Lanthmios movies.â€*'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*â€œç±»ä¼¼äºçº¦å°”æˆˆæ–¯Â·å…°è¥¿è«æ–¯ç”µå½±çš„ç”µå½±ã€‚â€*'
- en: It is easy for my metadata filtering model to write the same filter query for
    each of these examples, even though I want them to be treated differently. The
    first should yield only films directed **by** Lanthimos, while the second should
    yield films that have a similar **vibe** to Lanthimos films. To ensure this behavior,
    I spoon-feed the model examples of my desired behavior. The beauty with language
    models is that they can use their â€œreasoningâ€ abilities and world knowledge to
    generalize from these few-shot examples to other user queries.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºæˆ‘çš„å…ƒæ•°æ®ç­›é€‰æ¨¡å‹æ¥è¯´ï¼Œå³ä½¿æˆ‘å¸Œæœ›å®ƒä»¬è¢«ä¸åŒå¯¹å¾…ï¼Œä¹Ÿå¾ˆå®¹æ˜“ä¸ºæ¯ä¸ªç¤ºä¾‹ç¼–å†™ç›¸åŒçš„ç­›é€‰æŸ¥è¯¢ã€‚ç¬¬ä¸€ä¸ªåº”è¯¥åªè¿”å›ç”±**å…°è¥¿è«æ–¯**å¯¼æ¼”çš„ç”µå½±ï¼Œè€Œç¬¬äºŒä¸ªåˆ™åº”è¯¥è¿”å›ä¸å…°è¥¿è«æ–¯ç”µå½±æœ‰ç›¸ä¼¼**æ°›å›´**çš„ç”µå½±ã€‚ä¸ºäº†ç¡®ä¿è¿™ç§è¡Œä¸ºï¼Œæˆ‘å‘æ¨¡å‹æä¾›äº†æˆ‘æœŸæœ›çš„è¡Œä¸ºç¤ºä¾‹ã€‚è¯­è¨€æ¨¡å‹çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œå®ƒä»¬å¯ä»¥åˆ©ç”¨å…¶â€œæ¨ç†â€èƒ½åŠ›å’Œä¸–ç•ŒçŸ¥è¯†ï¼Œä»è¿™äº›å°‘é‡çš„ç¤ºä¾‹ä¸­æ¨å¹¿åˆ°å…¶ä»–ç”¨æˆ·æŸ¥è¯¢ã€‚
- en: '[PRE4]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: In addition to examples, the model also has to know a description of each metadata
    field. This helps it understand what metadata filtering is possible.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: é™¤äº†ç¤ºä¾‹ï¼Œæ¨¡å‹è¿˜å¿…é¡»äº†è§£æ¯ä¸ªå…ƒæ•°æ®å­—æ®µçš„æè¿°ã€‚è¿™æœ‰åŠ©äºå®ƒç†è§£å¯èƒ½çš„å…ƒæ•°æ®ç­›é€‰ã€‚
- en: Finally, we construct our chain. Here `query_model` is an instance of GPT-4
    Turbo using the OpenAI API. I recommend using GPT-4 instead of 3.5 for writing
    these metadata filter queries, since this is a critical step and one that 3.5
    messes up on more frequently. `search_kwargs={'k':10}` tells the retriever to
    pull up the ten most similar films based on the user query.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘ä»¬æ„å»ºæˆ‘ä»¬çš„é“¾æ¡ã€‚è¿™é‡Œçš„`query_model`æ˜¯ä½¿ç”¨OpenAI APIçš„GPT-4 Turboå®ä¾‹ã€‚æˆ‘å»ºè®®ä½¿ç”¨GPT-4è€Œä¸æ˜¯3.5æ¥ç¼–å†™è¿™äº›å…ƒæ•°æ®ç­›é€‰æŸ¥è¯¢ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œè€Œ3.5åœ¨è¿™ä¸€ç‚¹ä¸Šæ›´å®¹æ˜“å‡ºé”™ã€‚`search_kwargs={'k':10}`å‘Šè¯‰æ£€ç´¢å™¨æ ¹æ®ç”¨æˆ·æŸ¥è¯¢æ‹‰å–æœ€ç›¸ä¼¼çš„10éƒ¨ç”µå½±ã€‚
- en: Creating the chat model
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åˆ›å»ºèŠå¤©æ¨¡å‹
- en: Finally, after building the self-querying retriever we can build the standard
    RAG model on top of it. We begin by defining our chat model. This is what I call
    a summary model because it takes in a context (retrieved films + system message)
    and responds with a summary of each recommendation. This model can be GPT-3.5
    Turbo if you are trying to keep costs down, or GPT-4 Turbo if you want the absolute
    best results.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œåœ¨æ„å»ºè‡ªæŸ¥è¯¢æ£€ç´¢å™¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šæ„å»ºæ ‡å‡†çš„RAGæ¨¡å‹ã€‚æˆ‘ä»¬ä»å®šä¹‰èŠå¤©æ¨¡å‹å¼€å§‹ã€‚æˆ‘ç§°ä¹‹ä¸ºæ€»ç»“æ¨¡å‹ï¼Œå› ä¸ºå®ƒæ¥å—ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ˆæ£€ç´¢åˆ°çš„ç”µå½± +
    ç³»ç»Ÿæ¶ˆæ¯ï¼‰ï¼Œå¹¶ä»¥æ¯ä¸ªæ¨èçš„æ‘˜è¦è¿›è¡Œå›åº”ã€‚å¦‚æœä½ æƒ³é™ä½æˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨GPT-3.5 Turboï¼Œæˆ–è€…å¦‚æœä½ æƒ³è¦æœ€å¥½çš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨GPT-4 Turboã€‚
- en: 'In the system message I tell the bot what its goal is, and provide a series
    of recommendations and restrictions, the **most important of which is to not recommend
    a film that is not provided to it by the self-querying retriever.** In testing,
    I was having issues when a user query yielded no films from the database. For
    example, the query: *â€œRecommend some horror films starring Matt Damon directed
    by Wes Anderson made before 1980â€* would cause the self-querying retriever to
    retrieve no films (because as awesome as it sounds that movie doesnâ€™t exist).
    Presented with no film data in its context, the model would use its own (faulty)
    memory to try and recommend some films. This is not good behavior. I donâ€™t want
    a Netflix recommender to discuss films that are not in the database. The system
    message below managed to stop this behavior. I did notice that GPT-4 is better
    at following instructions than GPT-3.5, which is expected.'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ç³»ç»Ÿæ¶ˆæ¯ä¸­ï¼Œæˆ‘å‘Šè¯‰æœºå™¨äººå®ƒçš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œå¹¶æä¾›ä¸€ç³»åˆ—å»ºè®®å’Œé™åˆ¶ï¼Œå…¶ä¸­**æœ€é‡è¦çš„æ˜¯ä¸è¦æ¨èä»»ä½•æ²¡æœ‰é€šè¿‡è‡ªæŸ¥è¯¢æ£€ç´¢å™¨æä¾›çš„ç”µå½±**ã€‚åœ¨æµ‹è¯•ä¸­ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢æ²¡æœ‰ä»æ•°æ®åº“ä¸­æ£€ç´¢åˆ°ç”µå½±æ—¶ï¼Œæˆ‘é‡åˆ°äº†é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ï¼š*â€œæ¨èä¸€äº›ç”±é©¬ç‰¹Â·è¾¾è’™ä¸»æ¼”ã€éŸ¦æ–¯Â·å®‰å¾·æ£®å¯¼æ¼”çš„ææ€–ç‰‡ï¼Œä¸”æ˜¯åœ¨1980å¹´ä¹‹å‰åˆ¶ä½œçš„â€*ä¼šå¯¼è‡´è‡ªæŸ¥è¯¢æ£€ç´¢å™¨æ— æ³•æ£€ç´¢åˆ°ä»»ä½•ç”µå½±ï¼ˆå› ä¸ºè™½ç„¶å¬èµ·æ¥å¾ˆæ£’ï¼Œä½†è¿™æ ·çš„ç”µå½±å¹¶ä¸å­˜åœ¨ï¼‰ã€‚åœ¨æ²¡æœ‰ç”µå½±æ•°æ®çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ¨¡å‹ä¼šä½¿ç”¨å®ƒè‡ªå·±çš„ï¼ˆé”™è¯¯çš„ï¼‰è®°å¿†æ¥å°è¯•æ¨èä¸€äº›ç”µå½±ã€‚è¿™ç§è¡Œä¸ºä¸å¥½ã€‚æˆ‘ä¸å¸Œæœ›Netflixæ¨èç³»ç»Ÿè®¨è®ºæ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„ç”µå½±ã€‚ä¸‹é¢çš„ç³»ç»Ÿæ¶ˆæ¯æˆåŠŸé˜»æ­¢äº†è¿™ç§è¡Œä¸ºã€‚æˆ‘ç¡®å®æ³¨æ„åˆ°ï¼ŒGPT-4æ¯”GPT-3.5æ›´å–„äºéµå¾ªæŒ‡ä»¤ï¼Œè¿™æ˜¯é¢„æœŸä¹‹ä¸­çš„ã€‚
- en: '[PRE5]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '`format_docs` is used to format the information presented to the model so that
    it is easy to understand and parse. We present to the model both the `page_content`
    (overview and keywords) as well as the `metadata` (all other movie properties);
    anything it might need to better recommend a film to the user.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '`format_docs` ç”¨äºæ ¼å¼åŒ–å‘ˆç°ç»™æ¨¡å‹çš„ä¿¡æ¯ï¼Œä»¥ä¾¿å®ƒæ˜“äºç†è§£å’Œè§£æã€‚æˆ‘ä»¬å°† `page_content`ï¼ˆæ¦‚è¿°å’Œå…³é”®è¯ï¼‰ä»¥åŠ `metadata`ï¼ˆæ‰€æœ‰å…¶ä»–ç”µå½±å±æ€§ï¼‰åŒæ—¶å‘ˆç°ç»™æ¨¡å‹ï¼›ä»»ä½•å®ƒå¯èƒ½éœ€è¦çš„ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°å‘ç”¨æˆ·æ¨èç”µå½±ã€‚'
- en: '`rag_chain_from_docs` is a chain that takes the retrieved documents, formats
    them using `format_docs` , feeds the formatted documents into the context that
    the model then uses to answer the question. Finally we create `rag_chain_with_source`
    , which is a `RunnableParallel` that, as its name suggests, runs two operations
    in parallel: the self-querying retriever goes off to retrieve similar documents
    while the the query is simply passed to the model via `RunnablePassthrough()`
    . The results from the parallel components are then combined, and `rag_chain_from_docs`
    is used to generate the answer. Here `source` refers to the retriever, which access
    to all â€˜sourceâ€™ documents.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '`rag_chain_from_docs` æ˜¯ä¸€ä¸ªé“¾æ¡ï¼Œå®ƒæ¥å—æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼Œé€šè¿‡ `format_docs` æ ¼å¼åŒ–ï¼Œç„¶åå°†æ ¼å¼åŒ–åçš„æ–‡æ¡£è¾“å…¥æ¨¡å‹ä¸Šä¸‹æ–‡ä¸­ï¼Œæ¨¡å‹åŸºäºè¿™äº›å†…å®¹å›ç­”é—®é¢˜ã€‚æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºäº†
    `rag_chain_with_source`ï¼Œè¿™æ˜¯ä¸€ä¸ª `RunnableParallel`ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒåŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼šè‡ªæŸ¥è¯¢æ£€ç´¢å™¨å»æ£€ç´¢ç›¸ä¼¼çš„æ–‡æ¡£ï¼Œè€ŒæŸ¥è¯¢åˆ™é€šè¿‡
    `RunnablePassthrough()` ç›´æ¥ä¼ é€’ç»™æ¨¡å‹ã€‚ç„¶åï¼Œæ¥è‡ªå¹¶è¡Œç»„ä»¶çš„ç»“æœè¢«ç»„åˆï¼Œ`rag_chain_from_docs` ç”¨æ¥ç”Ÿæˆç­”æ¡ˆã€‚è¿™é‡Œçš„
    `source` æŒ‡çš„æ˜¯æ£€ç´¢å™¨ï¼Œå®ƒè®¿é—®æ‰€æœ‰çš„â€˜æºâ€™æ–‡æ¡£ã€‚'
- en: 'Because I want the answer to be streamed (e.g. presented to the user chunk
    by chunk like ChatGPT), we use the following code:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: å› ä¸ºæˆ‘å¸Œæœ›ç­”æ¡ˆæ˜¯é€æ­¥æµå¼ä¼ è¾“çš„ï¼ˆä¾‹å¦‚ï¼ŒåƒChatGPTä¸€æ ·é€å—å±•ç¤ºç»™ç”¨æˆ·ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š
- en: '[PRE6]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Demonstration
  id: totrans-80
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ¼”ç¤º
- en: 'Now to the fun part: playing with the model. As mentioned previously, Streamlit
    was used to create the frontend and for hosting the app. I wonâ€™t discuss the code
    for the UI here; please see the raw code for details on the implementation. It
    is fairly straightforward, and there are lots of other examples on the [Streamlit
    website](https://docs.streamlit.io/knowledge-base/tutorials/build-conversational-apps).'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æ˜¯æœ‰è¶£çš„éƒ¨åˆ†ï¼šä¸æ¨¡å‹äº’åŠ¨ã€‚å¦‚å‰æ‰€è¿°ï¼ŒStreamlit è¢«ç”¨æ¥åˆ›å»ºå‰ç«¯å¹¶æ‰˜ç®¡åº”ç”¨ç¨‹åºã€‚æˆ‘åœ¨è¿™é‡Œä¸è®¨è®ºUIçš„ä»£ç ï¼›æœ‰å…³å®ç°çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§åŸå§‹ä»£ç ã€‚å®ƒç›¸å½“ç›´æ¥ï¼Œè€Œä¸”åœ¨[Streamlit
    ç½‘ç«™](https://docs.streamlit.io/knowledge-base/tutorials/build-conversational-apps)ä¸Šæœ‰å¾ˆå¤šå…¶ä»–ç¤ºä¾‹ã€‚
- en: '![](../Images/02b3a62862751b327a753fd250ba3e74.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/02b3a62862751b327a753fd250ba3e74.png)'
- en: Film Search UI. By author.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ç”µå½±æœç´¢ç•Œé¢ã€‚ä½œè€…æä¾›ã€‚
- en: 'There are several suggestions you can use, but letâ€™s try our own query:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å‡ ä¸ªå»ºè®®å¯ä»¥ä½¿ç”¨ï¼Œä½†è®©æˆ‘ä»¬å°è¯•æˆ‘ä»¬è‡ªå·±çš„æŸ¥è¯¢ï¼š
- en: '![](../Images/7ad4d1b3125c7faf549f71d8c1afbacf.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/7ad4d1b3125c7faf549f71d8c1afbacf.png)'
- en: Example query and model response. By author.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: ç¤ºä¾‹æŸ¥è¯¢å’Œæ¨¡å‹å“åº”ã€‚ä½œè€…æä¾›ã€‚
- en: 'Behind the scenes, the self-querying retriever made sure to filter out any
    films that were not in the French language. Then, it performed a similarity search
    for â€œcoming of age storiesâ€, resulting in ten films in the context. Finally the
    summarizer bot selected five films for recommendation. Note the range of films
    suggested: some with release dates as early as 1959 to as late as 2012\. For convenience
    I ensure the bot includes the filmâ€™s runtime, release year, streaming providers,
    and a brief recommendation handcrafted by the bot.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨åå°ï¼Œè‡ªæŸ¥è¯¢æ£€ç´¢å™¨ç¡®ä¿è¿‡æ»¤æ‰ä»»ä½•éæ³•è¯­çš„ç”µå½±ã€‚ç„¶åï¼Œå®ƒæ‰§è¡Œäº†ä¸€ä¸ªâ€œæˆé•¿æ•…äº‹â€çš„ç›¸ä¼¼æ€§æœç´¢ï¼Œç»“æœæ˜¯ä¸Šä¸‹æ–‡ä¸­æœ‰åéƒ¨ç”µå½±ã€‚æœ€åï¼Œæ‘˜è¦æœºå™¨äººé€‰æ‹©äº†äº”éƒ¨ç”µå½±è¿›è¡Œæ¨èã€‚è¯·æ³¨æ„æ¨èçš„ç”µå½±èŒƒå›´ï¼šä¸€äº›ç”µå½±çš„ä¸Šæ˜ æ—¥æœŸæ—©è‡³1959å¹´ï¼Œæœ€æ™šçš„ä¸º2012å¹´ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ç¡®ä¿æœºå™¨äººåŒ…æ‹¬ç”µå½±çš„ç‰‡é•¿ã€ä¸Šæ˜ å¹´ä»½ã€æµåª’ä½“æä¾›å•†ï¼Œä»¥åŠç”±æœºå™¨äººç²¾å¿ƒåˆ¶ä½œçš„ç®€çŸ­æ¨èã€‚
- en: '*(Side note: If you havenâ€™t seen* [*The 400 Blows*](https://en.wikipedia.org/wiki/The_400_Blows)*,
    stop whatever you are doing, and go* [*watch it immediately*](https://www.youtube.com/watch?v=PvjUhgtn_-U)*.)*'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '*(é™„æ³¨ï¼šå¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡* [*400å‡»*](https://en.wikipedia.org/wiki/The_400_Blows)*ï¼Œç«‹åˆ»åœä¸‹ä½ æ­£åœ¨åšçš„äº‹æƒ…ï¼Œå»*
    [*ç«‹å³è§‚çœ‹*](https://www.youtube.com/watch?v=PvjUhgtn_-U)*ã€‚)*'
- en: Qualities that normally are seen as negatives in a large language model, such
    as the non-deterministic nature of its responses, are now positive. Ask the model
    the same question twice and you may get slightly different recommendations.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­ï¼Œé€šå¸¸è¢«è§†ä¸ºè´Ÿé¢çš„ç‰¹æ€§ï¼Œæ¯”å¦‚å…¶å“åº”çš„éç¡®å®šæ€§ï¼Œç°åœ¨å˜æˆäº†ç§¯æçš„ã€‚ä½ å¦‚æœå‘æ¨¡å‹é—®åŒä¸€ä¸ªé—®é¢˜ä¸¤æ¬¡ï¼Œå¯èƒ½ä¼šå¾—åˆ°ç•¥æœ‰ä¸åŒçš„æ¨èã€‚
- en: 'It is important to note some limitations of the current implementation:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: éœ€è¦æ³¨æ„å½“å‰å®ç°çš„ä¸€äº›é™åˆ¶ï¼š
- en: There is no saving of recommendations. Users likely would want to revisit old
    recommendations.
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä¸æ”¯æŒä¿å­˜æ¨èã€‚ç”¨æˆ·å¯èƒ½å¸Œæœ›é‡æ–°è®¿é—®ä»¥å‰çš„æ¨èã€‚
- en: Manual updating of raw data from The Movie Database. Automating this and having
    it update weekly would be a good idea.
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰‹åŠ¨æ›´æ–°æ¥è‡ªç”µå½±æ•°æ®åº“çš„åŸå§‹æ•°æ®ã€‚å°†å…¶è‡ªåŠ¨åŒ–å¹¶æ¯å‘¨æ›´æ–°ä¸€æ¬¡æ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ã€‚
- en: Bad metadata filtering by the self-querying retrieval. For example the query
    â€œBen Affleck filmsâ€ could be problematic. This could mean films where Ben Affleck
    is the **star** or films that have been **directed** by Ben Affleck. This is an
    example where clarification of the query would be helpful.
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è‡ªæŸ¥è¯¢æ£€ç´¢ä¸­çš„å…ƒæ•°æ®è¿‡æ»¤ä¸å‡†ç¡®ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢â€œBen Affleck filmsâ€å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚è¿™å¯èƒ½æŒ‡çš„æ˜¯ç”±æœ¬Â·é˜¿å¼—è±å…‹**ä¸»æ¼”**çš„ç”µå½±ï¼Œæˆ–è€…æ˜¯ç”±æœ¬Â·é˜¿å¼—è±å…‹**æ‰§å¯¼**çš„ç”µå½±ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦æ¾„æ¸…æŸ¥è¯¢çš„ä¾‹å­ã€‚
- en: Possible improvements to this project could be to perform a [re-ranking of documents](https://python.langchain.com/docs/integrations/retrievers/cohere-reranker)
    after retrieval. It could also be interesting to have a chat model that you can
    converse with in multi-turn conversations, rather then just a QA bot. One could
    also create an [agent recommender](https://python.langchain.com/docs/integrations/tools/human_tools)
    that prompts the user with a clarifying question if the query is not clear.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹è¿™ä¸ªé¡¹ç›®çš„å¯èƒ½æ”¹è¿›ä¹‹ä¸€æ˜¯åœ¨æ£€ç´¢åè¿›è¡Œ[æ–‡æ¡£é‡æ–°æ’åº](https://python.langchain.com/docs/integrations/retrievers/cohere-reranker)ã€‚è¿˜å¯ä»¥æœ‰ä¸€ä¸ªèŠå¤©æ¨¡å‹ï¼Œå¯ä»¥è¿›è¡Œå¤šè½®å¯¹è¯ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªé—®ç­”æœºå™¨äººã€‚è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ª[æ¨èä»£ç†](https://python.langchain.com/docs/integrations/tools/human_tools)ï¼Œå¦‚æœæŸ¥è¯¢ä¸æ˜ç¡®ï¼Œå¯ä»¥å‘ç”¨æˆ·æå‡ºæ¾„æ¸…é—®é¢˜ã€‚
- en: Have fun searching for films!
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ç©å¾—å¼€å¿ƒï¼Œæœç´¢ç”µå½±å§ï¼
