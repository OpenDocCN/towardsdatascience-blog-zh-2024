- en: Create an Agent with OpenAI Function Calling Capabilities
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个具有 OpenAI 函数调用功能的代理
- en: 原文：[https://towardsdatascience.com/create-an-agent-with-openai-function-calling-capabilities-ad52122c3d12?source=collection_archive---------3-----------------------#2024-03-31](https://towardsdatascience.com/create-an-agent-with-openai-function-calling-capabilities-ad52122c3d12?source=collection_archive---------3-----------------------#2024-03-31)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://towardsdatascience.com/create-an-agent-with-openai-function-calling-capabilities-ad52122c3d12?source=collection_archive---------3-----------------------#2024-03-31](https://towardsdatascience.com/create-an-agent-with-openai-function-calling-capabilities-ad52122c3d12?source=collection_archive---------3-----------------------#2024-03-31)
- en: OpenAI Function Calling in 2024
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2024 年的 OpenAI 函数调用
- en: '[](https://medium.com/@bianbianzhu123?source=post_page---byline--ad52122c3d12--------------------------------)[![Tianyi
    Li](../Images/40fce472f42c650daa1433641bf732df.png)](https://medium.com/@bianbianzhu123?source=post_page---byline--ad52122c3d12--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--ad52122c3d12--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--ad52122c3d12--------------------------------)
    [Tianyi Li](https://medium.com/@bianbianzhu123?source=post_page---byline--ad52122c3d12--------------------------------)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[](https://medium.com/@bianbianzhu123?source=post_page---byline--ad52122c3d12--------------------------------)[![Tianyi
    Li](../Images/40fce472f42c650daa1433641bf732df.png)](https://medium.com/@bianbianzhu123?source=post_page---byline--ad52122c3d12--------------------------------)[](https://towardsdatascience.com/?source=post_page---byline--ad52122c3d12--------------------------------)[![Towards
    Data Science](../Images/a6ff2676ffcc0c7aad8aaf1d79379785.png)](https://towardsdatascience.com/?source=post_page---byline--ad52122c3d12--------------------------------)
    [Tianyi Li](https://medium.com/@bianbianzhu123?source=post_page---byline--ad52122c3d12--------------------------------)'
- en: ·Published in [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--ad52122c3d12--------------------------------)
    ·15 min read·Mar 31, 2024
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: · 发布于 [Towards Data Science](https://towardsdatascience.com/?source=post_page---byline--ad52122c3d12--------------------------------)
    · 阅读时间 15 分钟 · 2024 年 3 月 31 日
- en: --
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: --
- en: '![](../Images/c3386f14f9203c4c638eb602716bc548.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/c3386f14f9203c4c638eb602716bc548.png)'
- en: Image generated by [DALL·E 3](https://openai.com/dall-e-3)
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 由 [DALL·E 3](https://openai.com/dall-e-3) 生成的图像
- en: '**Authors**: [Tianyi Li](https://medium.com/u/4092d7367010?source=post_page---user_mention--ad52122c3d12--------------------------------),
    [Selina Li](https://medium.com/u/7b9ea39b0d79?source=post_page---user_mention--ad52122c3d12--------------------------------)'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '**作者**： [Tianyi Li](https://medium.com/u/4092d7367010?source=post_page---user_mention--ad52122c3d12--------------------------------),
    [Selina Li](https://medium.com/u/7b9ea39b0d79?source=post_page---user_mention--ad52122c3d12--------------------------------)'
- en: · [Introduction](#bd50)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: · [介绍](#bd50)
- en: · [What AI can do](#8727)
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: · [人工智能能做什么](#8727)
- en: · [Current challenges](#77ee)
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: · [当前挑战](#77ee)
- en: · [How it works](#d52b)
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: · [它是如何工作的](#d52b)
- en: ∘ [Four key concepts that may be confusing at first:](#cfee)
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [四个可能让人困惑的关键概念：](#cfee)
- en: · [Step-by-Step Guide to Building an Agent](#98f6)
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: · [逐步构建代理指南](#98f6)
- en: '∘ [Business Case: Development of a Farm Trip Assistant Agent](#4c18)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [商业案例：开发一个农场旅行助手代理](#4c18)
- en: ∘ [Application Architecture:](#6729)
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [应用架构](#6729)
- en: ∘ [Pre-requisites:](#6df5)
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [前提条件：](#6df5)
- en: '∘ [Step 1: Prepare to call the model:](#b04f)'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [步骤 1：准备调用模型](#b04f)
- en: '∘ [Step 2: Define the tools](#d998)'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [步骤 2：定义工具](#d998)
- en: '∘ [Step 3: Call the model with the messages and the tools](#0df9)'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [步骤 3：使用消息和工具调用模型](#0df9)
- en: '∘ [Step 4: Handling Model Responses](#5cd8)'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [步骤 4：处理模型响应](#5cd8)
- en: '∘ [Step 5: Execute the function and call the model again](#de43)'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [步骤 5：执行函数并再次调用模型](#de43)
- en: '∘ [Step 6: Summarize the results back to the user](#0f4e)'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ∘ [步骤 6：将结果总结反馈给用户](#0f4e)
- en: · [Conclusion](#dbba)
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: · [结论](#dbba)
- en: · [Enjoyed This Story?](#1c90)
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: · [喜欢这个故事吗？](#1c90)
- en: As we navigate through 2024, the rush to develop AI-powered applications is
    unmistakable, thanks to their clear benefits.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们进入2024年，开发 AI 驱动应用程序的热潮显而易见，因为它们具有明显的优势。
- en: Traditionally, creating an app involves writing separate functions or services
    for each feature, like user login or booking a ticket. This process often requires
    users to fill out forms, ticking boxes and entering data, which must then pass
    through various validation checks to ensure that the data is usable. This method,
    especially when involving multiple steps, significantly detracts from the user
    experience.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，创建一个应用程序涉及为每个功能编写独立的函数或服务，例如用户登录或票务预订。这个过程通常需要用户填写表格，勾选框并输入数据，这些数据随后必须通过各种验证检查，以确保数据可用。尤其是在涉及多个步骤时，这种方法显著削弱了用户体验。
- en: 'Consider planning a one-day farm trip for Easter. You’re undecided about the
    date but have specific requirements: the farm must be within a two-hour drive,
    offer certain activities, have cloudy weather (as your child is allergic to the
    sun), and you need to consult your partner before making a decision. The traditional
    approach would involve navigating through multiple pages, steps, and forms — a
    snapshot of the complexities in daily decision-making. This complexity is a key
    reason why, despite the prevalence of booking websites, many still prefer the
    personalized service of a travel agent for planning trips.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你计划为复活节安排一次为期一天的农场之旅。你尚未确定日期，但有一些特定的要求：农场必须在两小时车程内，提供某些活动，天气要阴天（因为你的孩子对阳光过敏），并且在做决定之前需要和伴侣商量。传统的方法将涉及多次浏览不同的页面、步骤和表单——这反映了日常决策的复杂性。这种复杂性是一个关键原因，尽管现在有许多预订网站，很多人仍然更倾向于通过旅行代理人来规划旅行。
- en: What AI can do
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: AI能做什么
- en: 'AI introduces significant improvements by:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: AI通过以下方式带来了显著的改进：
- en: Providing a conversational experience, making interactions feel more natural
    and user-friendly.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提供对话式体验，使互动更加自然、用户友好。
- en: Consolidating app features into a single entry point. Unlike traditional apps,
    where different pages and forms are needed for different functions, AI can interpret
    user inputs and seamlessly select and execute the necessary functions, even handling
    complex requests in a step-by-step manner.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将应用程序功能整合到一个单一的入口点。与传统应用程序不同，传统应用需要不同的页面和表单来执行不同的功能，而AI可以解释用户输入，顺利选择并执行所需功能，甚至可以一步步处理复杂的请求。
- en: 'However, a major challenge remains: dealing with the unstructured text data
    returned by AI models.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，一个主要挑战依然存在：处理AI模型返回的非结构化文本数据。
- en: Traditionally, extracting structured data (like JSON) from model outputs required
    complex prompt engineering or regular expressions (RegEx), which can be error-prone
    and inconsistent due to the unpredictable nature of AI models and the variability
    of user inputs.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，从模型输出中提取结构化数据（如JSON）需要复杂的提示工程或正则表达式（RegEx），由于AI模型的不可预测性和用户输入的多样性，这种方法容易出错且不一致。
- en: 'To address this, OpenAI has rolled out two innovative features: `Json mode`
    and `Function calling`. This article will delve into the Function calling feature,
    illustrating how it streamlines the extraction of structured data from model outputs,
    complemented by TypeScript code examples.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，OpenAI推出了两项创新功能：`Json模式`和`函数调用`。本文将深入探讨函数调用功能，说明它如何简化从模型输出中提取结构化数据的过程，并附有TypeScript代码示例。
- en: Discover all the code examples in this [Github repository](https://github.com/bianbianzhu/openai-function-calling)
    and consider giving it a star if you find it useful.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个[Github代码库](https://github.com/bianbianzhu/openai-function-calling)中发现所有代码示例，如果您觉得有用，可以考虑给它点个星。
- en: Current challenges
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 当前的挑战
- en: 'Structured Data Handling: Previously, developers relied on RegEx or intricate
    prompt engineering to parse text data, a process fraught with complexity and errors.
    Function Calling simplifies this by allowing models to process user-defined functions,
    generating structured outputs like JSON without the need for cumbersome techniques.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 结构化数据处理：以前，开发人员依赖正则表达式或复杂的提示工程来解析文本数据，这个过程充满了复杂性和错误。函数调用通过允许模型处理用户定义的函数，简化了这一过程，使模型能够生成如JSON等结构化输出，而不需要繁琐的技术手段。
- en: 'Consistency and Predictability: Function Calling ensures consistent and predictable
    outcomes from AI models by enabling the definition of custom functions for precise
    information extraction. This guarantees structured and reliable outputs across
    varied inputs, essential for applications requiring dependable data extraction
    for text summarization, document analysis, and integrations with external APIs
    or databases.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一致性和可预测性：函数调用通过允许定义自定义函数来精确提取信息，从而确保AI模型输出的一致性和可预测性。这保证了在各种输入下生成结构化且可靠的输出，对于需要可靠数据提取的应用至关重要，例如文本摘要、文档分析以及与外部API或数据库的集成。
- en: How it works
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 它是如何工作的
- en: 'According to [OpenAI’s documentation](https://platform.openai.com/docs/guides/function-calling),
    the basic sequence of steps for function calling is as follows:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 根据[OpenAI的文档](https://platform.openai.com/docs/guides/function-calling)，函数调用的基本步骤如下：
- en: Call the model with the user query and a set of functions defined in the functions(tools)
    parameter.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用用户查询和在functions（工具）参数中定义的一组函数来调用模型。
- en: 'The model can choose to call one or more functions; if so, the content will
    be a stringified JSON object adhering to your custom schema (note: the model may
    hallucinate parameters).'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 模型可以选择调用一个或多个函数；如果选择调用，内容将是一个符合您自定义架构的字符串化JSON对象（注意：模型可能会产生虚假的参数）。
- en: Parse the string into JSON in your code, and call your function with the provided
    arguments if they exist.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在代码中将字符串解析为JSON，并在提供的参数存在时调用相应的函数。
- en: Call the model again by appending the function response as a new message, and
    let the model summarize the results back to the user.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过将函数响应作为新消息附加来再次调用模型，让模型将结果总结并反馈给用户。
- en: '![](../Images/2f7e826c238feb17d00a04b394e00016.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/2f7e826c238feb17d00a04b394e00016.png)'
- en: A sequence diagram of how OpenAI function calling works
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: OpenAI函数调用工作原理的序列图
- en: 'Four key concepts that may be confusing at first:'
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 四个可能一开始会让人困惑的关键概念：
- en: '**Tools**: The term `Functions` is depreciated and replaced by `Tools`. Currently,
    `Tools` exclusively support what is essentially the function type. Essentially,
    this change is in name and syntax'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**工具**：术语`Functions`已被弃用，并由`Tools`替代。目前，`Tools`专门支持本质上是函数类型的功能。实质上，这一变化仅体现在名称和语法上。'
- en: '**Tools Description**: When we say you’re passing “tools” to the model, think
    of it as providing a list or menu of what the model can do, not the actual functions.
    It’s like telling the model, “Here are the actions you can choose to perform,”
    without giving it the direct means to do so.'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**工具描述**：当我们说将“工具”传递给模型时，可以理解为提供了模型可以执行的操作列表或菜单，而不是实际的函数。这就像是告诉模型：“这是你可以选择执行的操作”，而不直接给它实现这些操作的手段。'
- en: '**Function Call Returns**: When the model suggests a function call, it’s essentially
    saying, “I think we should use this tool and here’s what we need for it,” by naming
    the function and specifying any required information (`arguments`). However, at
    this point, it''s just a suggestion; the actual action is carried out in your
    application.'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**函数调用返回**：当模型建议调用一个函数时，本质上是在说：“我认为我们应该使用这个工具，这就是我们所需的”，通过命名该函数并指定任何必要的信息（`arguments`）。然而，这时它只是一个建议；实际操作是在您的应用程序中执行的。'
- en: '**Using Responses to Inform the Next Steps**: Once a function is actually executed
    in your application and you have the results, you feed these results back to the
    model as part of a new prompt. This helps the model understand what happened and
    guides it in making the next move or response.'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**使用响应来指导下一步**：一旦在应用程序中实际执行了一个函数并获得结果，您将这些结果作为新提示的一部分反馈给模型。这有助于模型理解发生了什么，并引导它做出下一步的操作或回应。'
- en: Step-by-Step Guide to Building an Agent
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建代理的分步指南
- en: 'Business Case: Development of a Farm Trip Assistant Agent'
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 商业案例：农场旅行助手代理的开发
- en: 'We aim to develop a farm trip assistant agent designed to enhance the user
    experience in planning farm visits. This digital assistant will offer comprehensive
    support by:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标是开发一个农场旅行助手代理，旨在提升用户在规划农场参访时的体验。这个数字助手将通过以下方式提供全面支持：
- en: Identifying top farm destinations tailored to user location.
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据用户的位置识别最适合的农场目的地。
- en: Providing detailed information on available activities at each farm.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供每个农场可用活动的详细信息。
- en: Facilitating the booking of selected activities.
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 促进所选活动的预订。
- en: Offering a straightforward process for filing complaints, if necessary.
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供一个简便的投诉流程（如有需要）。
- en: 'Application Architecture:'
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 应用架构：
- en: 'This flowchart shows the architecture of the application:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 这个流程图展示了应用程序的架构：
- en: '![](../Images/41b3331d39fbdf6b9b01c9b61286959c.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/41b3331d39fbdf6b9b01c9b61286959c.png)'
- en: The flowchart of the agent
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 代理的流程图
- en: 'Pre-requisites:'
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 前提条件：
- en: '**OpenAI API key**: You can obtain this from the OpenAI platform.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**OpenAI API 密钥**：您可以从 OpenAI 平台获得此密钥。'
- en: 'Step 1: Prepare to call the model:'
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第一步：准备调用模型：
- en: 'To initiate a conversation, begin with a system message and a user prompt for
    the task:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始对话，请从系统消息和用户任务提示开始：
- en: Create a `messages` array to keep track of the conversation history.
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个`messages`数组，用于跟踪对话历史。
- en: Include a system message in the `messages` array to to establish the assistant's
    role and context.
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在`messages`数组中包含一个系统消息，以建立助手的角色和上下文。
- en: Welcome the users with a greeting message and prompt them to specify their task.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用问候消息迎接用户，并提示他们指定任务。
- en: Add the user prompt to the `messages` array.
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将用户的提示添加到`messages`数组中。
- en: '[PRE0]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As my personal preference, all the prompts are stored in objects for easy access
    and modification. Please refer to the following code snippets for all the prompts
    used in the application. Feel free to adopt or modify this approach as suits you.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 作为个人偏好，所有提示都存储在对象中，以便于访问和修改。请参考以下代码片段，了解应用程序中使用的所有提示。请根据需要采用或修改此方法。
- en: '**StaticPrompts**: Static messages that are used throughout the conversation.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**StaticPrompts**：在整个对话中使用的静态消息。'
- en: '[PRE1]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '**UserPrompts**: User messages that are generated based on user input.'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**UserPrompts**：根据用户输入生成的用户消息。'
- en: '[PRE2]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '**SystemPrompts**: System messages that are generated based on system context.'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SystemPrompts**：根据系统上下文生成的系统消息。'
- en: '[PRE3]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '**FunctionPrompts**: Function messages that are basically the return values
    of the functions.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**FunctionPrompts**：基本上是函数的返回值的功能消息。'
- en: '[PRE4]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Step 2: Define the tools'
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第2步：定义工具
- en: 'As mentioned earlier, `tools` are essentially the descriptions of functions
    that the model can call. In this case, we define four tools to meet the requirements
    of the farm trip assistant agent:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，`tools`本质上是模型可以调用的函数描述。在这种情况下，我们定义了四个工具来满足农场旅行助手代理的需求：
- en: '`get_farms`: Retrieves a list of farm destinations based on user''s location.'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`get_farms`：根据用户的位置检索农场目的地列表。'
- en: '`get_activities_per_farm`: Provides detailed information on activities available
    at a specific farm.'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`get_activities_per_farm`：提供特定农场的活动详细信息。'
- en: '`book_activity`: Facilitates the booking of a selected activity.'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`book_activity`：方便用户预定选择的活动。'
- en: '`file_complaint`: Offers a straightforward process for filing complaints.'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`file_complaint`：提供一个简单的投诉流程。'
- en: 'The following code snippet demonstrates how these tools are defined:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码片段演示了这些工具如何被定义：
- en: '[PRE5]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '**Understanding Function Descriptions**'
  id: totrans-90
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**理解功能描述**'
- en: 'Function descriptions require the following keys:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 功能描述需要以下键：
- en: '`name`: Identifies the function.'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`name`：标识函数。'
- en: '`description`: Provides a summary of what the function does.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`description`：提供函数功能的总结。'
- en: '`parameters`: Defines the function''s parameters, including their `type`, `description`,
    and whether they are `required`.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`parameters`：定义函数的参数，包括它们的`type`、`description`以及是否为`required`。'
- en: '`type`: Specifies the parameter type, typically an object.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`type`：指定参数类型，通常是对象。'
- en: '`properties`: Details each parameter, including its type and description.'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`properties`：详细描述每个参数，包括其类型和描述。'
- en: '`required`: Lists the parameters that are essential for the function to operate.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`required`：列出函数操作所需的必选参数。'
- en: '**Adding a New Function**'
  id: totrans-98
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '**添加新功能**'
- en: 'To introduce a new function, proceed as follows:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 引入新功能，请按以下步骤进行：
- en: Extend DescribedFunctionName with a new enum, such as `DoNewThings`.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 扩展DescribedFunctionName，添加一个新枚举，例如`DoNewThings`。
- en: Define a Props type for the parameters, e.g., `DoNewThingsProps`.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为参数定义一个Props类型，例如`DoNewThingsProps`。
- en: Insert a new entry in the *FunctionDescriptions* object.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在*FunctionDescriptions*对象中插入一个新条目。
- en: Implement the new function in the function directory, naming it after the enum
    value.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在函数目录中实现新功能，并根据枚举值命名它。
- en: 'Step 3: Call the model with the messages and the tools'
  id: totrans-104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第3步：使用消息和工具调用模型
- en: With the messages and tools set up, we’re ready to call the model using them.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 设置好消息和工具后，我们就可以使用它们来调用模型。
- en: It’s important to note that as of March 2024, function calling is supported
    only by the `gpt-3.5-turbo-0125` and `gpt-4-turbo-preview` models.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，直到2024年3月，只有`gpt-3.5-turbo-0125`和`gpt-4-turbo-preview`模型支持函数调用。
- en: 'Code implementation:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 代码实现：
- en: '[PRE6]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '`**tool_choice**` **Options**'
  id: totrans-109
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`**tool_choice**` **选项**'
- en: 'The `tool_choice` option controls the model''s approach to function calls:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '`tool_choice`选项控制模型的函数调用方式：'
- en: '`Specific Function`: To specify a particular function, set `tool_choice` to
    an object with `type: "function"` and include the function''s name and details.
    For instance, `tool_choice: { type: "function", function: { name: "get_farms"}}`
    tells the model to call the `get_farms` function regardless of the context. Even
    a simple user prompt like "Hi." will trigger this function call.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Specific Function`：要指定特定功能，请将`tool_choice`设置为一个对象，包含`type: "function"`，并包括函数的名称和详细信息。例如，`tool_choice:
    { type: "function", function: { name: "get_farms"}}` 告诉模型无论上下文如何都调用`get_farms`函数。即使是一个简单的用户提示，如"Hi."，也会触发此函数调用。'
- en: '`No Function`: To have the model generate a response without any function calls,
    use `tool_choice: "none"`. This option prompts the model to rely solely on the
    input messages for generating its response.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`无功能`: 若希望模型生成没有任何函数调用的回应，可以使用 `tool_choice: "none"`。这个选项让模型仅依赖输入消息来生成回应。'
- en: '`Automatic Selection`: The default setting, `tool_choice: "auto"`, lets the
    model autonomously decide if and which function to call, based on the conversation''s
    context. This flexibility is beneficial for dynamic decision-making regarding
    function calls.'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`自动选择`: 默认设置 `tool_choice: "auto"` 让模型根据对话上下文自动决定是否调用某个函数以及调用哪个函数。这种灵活性有助于在函数调用的决策过程中做出动态选择。'
- en: 'Step 4: Handling Model Responses'
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 步骤 4：处理模型回应
- en: 'The model’s responses fall into two primary categories, with a potential for
    errors that necessitate a fallback message:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 模型的回应大致可分为两类，同时可能存在错误，需要回退消息：
- en: '![](../Images/1d5be5b5218c97887adba782d1ee01a1.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/1d5be5b5218c97887adba782d1ee01a1.png)'
- en: '**Function Call Request**: The model indicates a desire to call function(s).
    This is the true potential of function calling. The model intelligently selects
    which function(s) to execute based on context and user queries. For instance,
    if the user asks for farm recommendations, the model may suggest calling the `get_farms`
    function.'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**函数调用请求**: 模型表明希望调用一个或多个函数。这是函数调用的真正潜力。模型会根据上下文和用户查询智能选择需要执行的函数。例如，如果用户请求农场推荐，模型可能会建议调用
    `get_farms` 函数。'
- en: But it doesn’t just stop there, the model also analyzes the user input to determine
    if it contains the necessary information (`arguments`) for the function call.
    If not, the model would prompt the user for the missing details.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 但模型不仅止步于此，它还会分析用户输入，判断其中是否包含进行函数调用所需的必要信息（`arguments`）。如果缺少必要信息，模型会提示用户提供缺失的细节。
- en: Once it has gathered all required information (`arguments`), the model returns
    a JSON object detailing the function name and arguments. This structured response
    can be effortlessly translated into a JavaScript object within our application,
    enabling us to invoke the specified function seamlessly, thereby ensuring a fluid
    user experience.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦收集了所有必需的信息（`arguments`），模型会返回一个 JSON 对象，详细说明函数名称和参数。这种结构化的回应可以轻松地转化为我们应用程序中的
    JavaScript 对象，从而无缝地调用指定的函数，确保流畅的用户体验。
- en: Additionally, the model can choose to call multiple functions, either simultaneously
    or in sequence, each requiring specific details. Managing this within the application
    is crucial for smooth operation.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，模型还可以选择调用多个函数，这些函数可以是同时执行或顺序执行的，每个函数都可能需要特定的细节。在应用程序中管理这一过程对于顺利操作至关重要。
- en: '**Example of model’s response:**'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '**模型回应示例:**'
- en: '[PRE7]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '**2\. Plain Text Response**: The model provides a direct text response. This
    is the standard output we’re accustomed to from AI models, offering straightforward
    answers to user queries. Simply returning the text content suffices for these
    responses.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '**2\. 纯文本回应**: 模型提供直接的文本回应。这是我们从 AI 模型中最常见的标准输出，能够为用户查询提供直接的回答。仅返回文本内容即可满足这些回应要求。'
- en: '**Example of model’s response:**'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '**模型回应示例:**'
- en: '[PRE8]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The key distinction is the presence of a `tool_calls` key for `function calls`.
    If `tool_calls` is present, the model is requesting to execute a function; otherwise,
    it delivers a straightforward text response.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 关键的区别在于是否存在 `tool_calls` 键用于表示函数调用。如果 `tool_calls` 存在，说明模型正在请求执行某个函数；否则，模型返回的是一个简单的文本回应。
- en: 'To process these responses, consider the following approach based on the response
    type:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 要处理这些回应，可以根据回应类型采取以下方法：
- en: '[PRE9]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The `arguments` extracted from the function calls are then used to execute the
    actual functions in the application, while the text content helps to carry on
    the conversation.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 从函数调用中提取的 `arguments` 被用来在应用程序中执行实际的函数，而文本内容则帮助继续对话。
- en: 'Below is an **if-else block** illustrating how this process unfolds:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个**if-else 语句块**，展示了该过程的展开：
- en: '[PRE10]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Step 5: Execute the function and call the model again'
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 步骤 5：执行函数并再次调用模型
- en: When the model requests a function call, we execute that function in our application
    and then update the model with the new messages. This keeps the model informed
    about the function’s result, allowing it to give a pertinent reply to the user.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 当模型请求函数调用时，我们会在应用程序中执行该函数，并随后使用新的消息更新模型。这使得模型能够了解函数的结果，从而给出与用户需求相关的答复。
- en: Maintaining the correct sequence of function executions is crucial, especially
    when the model chooses to execute multiple functions in a sequence to complete
    a task. Using a `for` loop instead of `Promise.all` preserves the execution order,
    essential for a successful workflow. However, if the functions are independent
    and can be executed in parallel, consider custom optimizations to enhance performance.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 保持函数执行顺序的正确性至关重要，特别是当模型选择按顺序执行多个函数以完成任务时。使用`for`循环而不是`Promise.all`可以保持执行顺序，这对成功的工作流至关重要。然而，如果函数是独立的并且可以并行执行，可以考虑自定义优化以提升性能。
- en: 'Here’s how to execute the function:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 这是执行该函数的方式：
- en: '[PRE11]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'And here’s how to update the messages array with the function response:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 这是如何通过函数响应来更新消息数组的方式：
- en: '[PRE12]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Example of the functions that can be called:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 可调用的函数示例：
- en: '[PRE13]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Example of the `tool` message with function response:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '`tool` 消息与函数响应示例：'
- en: '[PRE14]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Step 6: Summarize the results back to the user'
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第6步：总结结果并反馈给用户
- en: After running the functions and updating the message array, we re-engage the
    model with these updated messages to brief the user on the outcomes. This involves
    repeatedly invoking the ***startChat*** function via a loop.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行函数并更新消息数组后，我们通过重新调用这些更新的消息来重新激活模型，以向用户简要介绍结果。这涉及通过循环反复调用***startChat***函数。
- en: To avoid endless looping, it’s crucial to monitor for user inputs signaling
    the end of the conversation, like “Goodbye” or “End,” ensuring the loop terminates
    appropriately.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免无休止的循环，至关重要的是要监控用户输入，识别出表示对话结束的信号，如“再见”或“结束”，确保循环能够适当终止。
- en: 'Code implementation:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 代码实现：
- en: '[PRE15]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Conclusion
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结论
- en: OpenAI’s function calling represents a major advancement in AI, allowing models
    to perform custom functions in response to user queries. This feature simplifies
    obtaining structured data from outputs, improving user interaction and enabling
    more complex exchanges.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: OpenAI的函数调用代表了人工智能的一大进步，允许模型根据用户查询执行自定义函数。此功能简化了从输出中获取结构化数据的过程，改善了用户交互，并支持更复杂的交流。
- en: Enjoyed This Story?
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 喜欢这个故事吗？
- en: '**Selina Li** ([Selina Li](https://medium.com/u/7b9ea39b0d79), [LinkedIn](https://www.linkedin.com/in/selina-zhuohang-li-3b7355120/))
    is a Principal Data Engineer working at [Officeworks](https://www.officeworks.com.au/)
    in Melbourne Australia. Selina is passionate about AI/ML, data engineering and
    investment.'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '**Selina Li**（[Selina Li](https://medium.com/u/7b9ea39b0d79)，[LinkedIn](https://www.linkedin.com/in/selina-zhuohang-li-3b7355120/)）是位于澳大利亚墨尔本的[Officeworks](https://www.officeworks.com.au/)的首席数据工程师。Selina
    对人工智能/机器学习、数据工程和投资充满热情。'
- en: '**Jason Li** ([Tianyi Li](https://medium.com/u/4092d7367010), [LinkedIn](https://www.linkedin.com/in/tianyi-li-jason/))
    is a Full-stack Developer working at [Mindset Health](https://www.mindsethealth.com/)
    in Melbourne Australia. Jason is passionate about AI, front-end development and
    space related technologies.'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '**Jason Li**（[Tianyi Li](https://medium.com/u/4092d7367010)，[LinkedIn](https://www.linkedin.com/in/tianyi-li-jason/)）是位于澳大利亚墨尔本的[Mindset
    Health](https://www.mindsethealth.com/)的全栈开发工程师。Jason 对人工智能、前端开发和与太空相关的技术充满热情。'
- en: Selina and Jason would love to explore technologies to help people achieve their
    goals.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: Selina 和 Jason 希望探索能够帮助人们实现目标的技术。
- en: '*Unless otherwise noted, all images are by the authors.*'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '*除非另有说明，所有图片均由作者提供。*'
